<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Server Hot Swap with Failover Cluster - NAVITHOR USER INSTRUCTIONS</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Front page</a></li><li class="chapter-item expanded affix "><li class="part-title">Configuration</li><li class="chapter-item expanded "><a href="Installation_NavithorHardwareRequirements.html"><strong aria-hidden="true">1.</strong> System Hardware Requirement Specifications</a></li><li class="chapter-item expanded "><a href="Installation_SQLServerAndDatabaseInstallationGuide.html"><strong aria-hidden="true">2.</strong> Configuring database</a></li><li class="chapter-item expanded "><a href="fleetSim.html"><strong aria-hidden="true">3.</strong> Fleet Simulator - Setup and Configuration</a></li><li class="chapter-item expanded "><a href="Installation_NavithorServerAsAService.html"><strong aria-hidden="true">4.</strong> Server as a service</a></li><li class="chapter-item expanded "><a href="Installation_ConfiguringHotSwap.html" class="active"><strong aria-hidden="true">5.</strong> Server Hot Swap with Failover Cluster</a></li><li class="chapter-item expanded "><a href="Installation_RebrandingNavithor.html"><strong aria-hidden="true">6.</strong> Server and Client Rebranding</a></li><li class="chapter-item expanded "><a href="Machinetool.html"><strong aria-hidden="true">7.</strong> Machine Tool</a></li><li class="chapter-item expanded "><a href="MesTester3.html"><strong aria-hidden="true">8.</strong> MES Tester</a></li><li class="chapter-item expanded affix "><li class="part-title">Desktop client</li><li class="chapter-item expanded "><a href="navithorServerAndClientMegaDocument.html"><strong aria-hidden="true">9.</strong> System Overview and user instructions for Client UI</a></li><li class="chapter-item expanded "><a href="Feature_ClientUpdater.html"><strong aria-hidden="true">10.</strong> Client Updater</a></li><li class="chapter-item expanded affix "><li class="part-title">Web client</li><li class="chapter-item expanded "><a href="Installation_SettingUpNavithorWebServer.html"><strong aria-hidden="true">11.</strong> Setting up Web server to enable Web client</a></li><li class="chapter-item expanded "><a href="webClient.html"><strong aria-hidden="true">12.</strong> Web Client - User Instructions</a></li><li class="chapter-item expanded affix "><li class="part-title">Guides</li><li class="chapter-item expanded "><a href="bestProductionPractices.html"><strong aria-hidden="true">13.</strong> Best Practices for Creating Production Area</a></li><li class="chapter-item expanded affix "><li class="part-title">Logs</li><li class="chapter-item expanded "><a href="Navithor logs.html"><strong aria-hidden="true">14.</strong> Navithor Logs</a></li><li class="chapter-item expanded "><a href="Feature_VisualReplay.html"><strong aria-hidden="true">15.</strong> Visual Replay</a></li><li class="chapter-item expanded "><a href="Feature_DownloadManager.html"><strong aria-hidden="true">16.</strong> Log Download Manager</a></li><li class="chapter-item expanded affix "><li class="part-title">Users</li><li class="chapter-item expanded "><a href="Installation_UsingActiveDirectoryForAuthentication.html"><strong aria-hidden="true">17.</strong> User authentication against Active Directory</a></li><li class="chapter-item expanded "><a href="userRoles.html"><strong aria-hidden="true">18.</strong> User Management</a></li><li class="chapter-item expanded "><a href="userRolesRightsMatrix.html"><strong aria-hidden="true">19.</strong> Default User roles and User rights matrix</a></li><li class="chapter-item expanded affix "><li class="part-title">Features</li><li class="chapter-item expanded "><a href="symbolicPointGroups.html"><strong aria-hidden="true">20.</strong> Symbolic Point Groups</a></li><li class="chapter-item expanded "><a href="ResourceHandling.html"><strong aria-hidden="true">21.</strong> Resource handling</a></li><li class="chapter-item expanded "><a href="hold-release.html"><strong aria-hidden="true">22.</strong> Hold-Release reasoning and production order lists</a></li><li class="chapter-item expanded "><a href="transfer requests.html"><strong aria-hidden="true">23.</strong> Transfer requests</a></li><li class="chapter-item expanded "><a href="racking.html"><strong aria-hidden="true">24.</strong> Using warehouse racking feature</a></li><li class="chapter-item expanded "><a href="bufferLanes.html"><strong aria-hidden="true">25.</strong> Using Buffer Lanes</a></li><li class="chapter-item expanded "><a href="Feature_ChargingManagement.html"><strong aria-hidden="true">26.</strong> Managing Battery Levels</a></li><li class="chapter-item expanded "><a href="oneMachineZones.html"><strong aria-hidden="true">27.</strong> Using One Machine Zones</a></li><li class="chapter-item expanded "><a href="distanceControlZones.html"><strong aria-hidden="true">28.</strong> Distance Control Zones</a></li><li class="chapter-item expanded "><a href="FireAlarmZones.html"><strong aria-hidden="true">29.</strong> Fire Alarm Zones</a></li><li class="chapter-item expanded "><a href="Zone status use cases.html"><strong aria-hidden="true">30.</strong> Zone status use cases</a></li><li class="chapter-item expanded "><a href="tagStatuses.html"><strong aria-hidden="true">31.</strong> Tag Statuses</a></li><li class="chapter-item expanded "><a href="Trafficlights.html"><strong aria-hidden="true">32.</strong> Traffic Lights</a></li><li class="chapter-item expanded "><a href="Feature_Elevators.html"><strong aria-hidden="true">33.</strong> Elevators</a></li><li class="chapter-item expanded "><a href="ProductionBreak.html"><strong aria-hidden="true">34.</strong> Production Break</a></li><li class="chapter-item expanded "><a href="DynamicSafetyBounds.html"><strong aria-hidden="true">35.</strong> Virtual Dynamic Safety Bounds</a></li><li class="chapter-item expanded "><a href="WaitingSlots.html"><strong aria-hidden="true">36.</strong> Wait Queue Locations</a></li><li class="chapter-item expanded "><a href="CoupledDrive.html"><strong aria-hidden="true">37.</strong> Coupled Drive</a></li><li class="chapter-item expanded "><a href="Feature_StoppingPointOffsetsForSymbolicPoints.html"><strong aria-hidden="true">38.</strong> Stopping Point Offsets</a></li><li class="chapter-item expanded "><a href="TCStopPoint.html"><strong aria-hidden="true">39.</strong> Safe stopping point calculation</a></li><li class="chapter-item expanded "><a href="Navithor statistics.html"><strong aria-hidden="true">40.</strong> System Statistics</a></li><li class="chapter-item expanded "><a href="MachineInterfaces.html"><strong aria-hidden="true">41.</strong> Machine Interfaces</a></li><li class="chapter-item expanded affix "><li class="part-title">Interfaces</li><li class="chapter-item expanded "><a href="Communication specification between Navithor and MES.html"><strong aria-hidden="true">42.</strong> MES Interface</a></li><li class="chapter-item expanded "><a href="NavithorHttpApi.html"><strong aria-hidden="true">43.</strong> HTTP API</a></li><li class="chapter-item expanded "><a href="NavithorWebApi.html"><strong aria-hidden="true">44.</strong> WebSocket API</a></li><li class="chapter-item expanded "><a href="opcuadoc.html"><strong aria-hidden="true">45.</strong> OPC UA Server interface</a></li><li class="chapter-item expanded affix "><li class="part-title">Alarms</li><li class="chapter-item expanded "><a href="Fleet Control Alarms.html"><strong aria-hidden="true">46.</strong> Alarms</a></li><li class="chapter-item expanded "><a href="Alarms configuration override.html"><strong aria-hidden="true">47.</strong> Alarms configuration override</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dark">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NAVITHOR USER INSTRUCTIONS</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="configuring-hot-swap"><a class="header" href="#configuring-hot-swap">Configuring hot swap</a></h1>
<p>This document contains information on Navithor cluster failover requirements and scenarios</p>
<p>Updated 07.02.2023</p>
<h2 id="version-history"><a class="header" href="#version-history">Version History</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Version</th><th>Date</th><th>Author</th><th>Change</th></tr></thead><tbody>
<tr><td>1.0</td><td>09.10.2018</td><td>Antti Parkkonen</td><td>First version</td></tr>
<tr><td>2.0</td><td>15.01.2021</td><td>Tommi Kärki</td><td>Converted to markdown</td></tr>
<tr><td>2.1</td><td>11.06.2021</td><td>Aleksi Ålander</td><td>Renamed title</td></tr>
<tr><td>2.2</td><td>07.02.2023</td><td>Aleksi Ålander</td><td>Updated the document</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<p>Setting up the environment requires some general IT knowledge and
understanding how networking and Windows environment works.</p>
<h2 id="hardware-requirements"><a class="header" href="#hardware-requirements">Hardware requirements</a></h2>
<p>The hardware requirements are adopted from Microsoft developer network
documentation, as our testing was set up in Microsoft Azure Cloud
environment. The information provided in this section is not tested
fully and minor changes might be necessary.</p>
<ul>
<li>
<p>Servers used in the failover cluster should have identical hardware
or at least similar components.</p>
</li>
<li>
<p>Servers need networking capabilities.</p>
</li>
<li>
<p>Servers are on the same network subnet.</p>
</li>
<li>
<p>Servers need to pass the hardware requirements for running Navithor
Server.</p>
</li>
</ul>
<h2 id="software-requirements"><a class="header" href="#software-requirements">Software requirements</a></h2>
<ul>
<li>
<p>Windows Server 2016, 2019 or 2022 Operating system. 2022 is preferred. All
servers need the same version.</p>
</li>
<li>
<p>Failover Cluster feature installed on each computer that is used as
a part of the cluster.</p>
</li>
<li>
<p>All servers to be added as cluster nodes need to be joined to the
same Active Directory domain.</p>
</li>
<li>
<p>Account used to create the cluster has to be a domain user who has
administrator rights on all servers to be added as cluster nodes.</p>
</li>
<li>
<p>The user who creates the cluster has the Create Computer objects
permission to the OU or the container where the servers that will
form the cluster reside<br />
OR<br />
Ask a domain administrator to pre-stage a cluster computer object for
the cluster.<br />
(<a href="https://docs.microsoft.com/en-us/windows-server/failover-clustering/prestage-cluster-adds">https://docs.microsoft.com/en-us/windows-server/failover-clustering/prestage-cluster-adds</a>)</p>
</li>
</ul>
<h2 id="extra"><a class="header" href="#extra">Extra</a></h2>
<p>More information and documentation can be found on multiple languages:<br />
https://docs.microsoft.com/en-us/windows-server/failover-clustering/create-failover-cluster</p>
<h3 id="how-does-the-hot-swap-work"><a class="header" href="#how-does-the-hot-swap-work">How does the hot swap work?</a></h3>
<p>Hot swapping Navithor server from one computer to another pre-configured
computer can be done manually or automatically in case of failure.
Manual switching is initiated from the Failover cluster manager (Windows
server tool) and can be used for example when the software needs to be
updated or other maintenance on the computer running Navithor is needed.
Automatic switching occurs in case of Navithor server stops for some
reason. The most obvious reason for this is that the computer crashes or
is faulted.</p>
<p>Switching to another computer lasts at least 10 (t<sub>1</sub>) seconds.
Switching time depends on the size of the production area and the
cluster configuration. Switching time is longer if also the database is
configured to the cluster. After a switch all information will be loaded
back to the new Navithor server instance from the database (t<sub>2</sub>).
This means that if server parameter</p>
<p>ProductionManager_TakeMachinesIntoProductionAutomaticallyRule</p>
<p>is set true, production will continue automatically after the timeout
(t<sub>3</sub>) set in the</p>
<p>TrafficController_TAKE_INTO_PRODUCTION_TIMER_SEC</p>
<p>parameter. In conclusion, the total time the hot swap takes
t<sub>1</sub> + t<sub>2</sub> + t<sub>3</sub> amount of time, which is around 40 seconds for
a medium sized environment with default settings. For faster switching
setting the TrafficController_TAKE_INTO_PRODUCTION_TIMER_SEC to 0
is a good first step.</p>
<p>All production orders set to Navithor Server will be continued after the
switch. For the people monitoring the system a switch will only be
visible as a disconnection and reconnection. The same applies also for
the machines. Below are some simple use cases that illustrate the hot
swap capabilities.</p>
<h3 id="use-case-1-windows-updates"><a class="header" href="#use-case-1-windows-updates">Use case 1: Windows updates</a></h3>
<h4 id="situation"><a class="header" href="#situation">Situation</a></h4>
<p>Microsoft publishes critical security updates for Windows operating systems. These updates need to be installed as soon as possible to minimize security  risks. Navithor Server is running in a Failover cluster that consists of computers 1 and 2.</p>
<h4 id="user-actions"><a class="header" href="#user-actions">User actions</a></h4>
<ol>
<li>User takes a connection to a  PC in the Failover cluster.</li>
<li>User moves all related clustered resources to Computer 1 in the cluster.</li>
<li>Computer 1 now runs Navithor server.</li>
<li>User installs Windows updates to Computer 2 and restarts the computer.</li>
<li>User moves all related  clustered resources to Computer 1.</li>
<li>User installs Windows updates to Computer 1 and restarts the computer.</li>
</ol>
<h4 id="end-result"><a class="header" href="#end-result">End result</a></h4>
<ol>
<li>Both computers have the latest security updates.</li>
<li>AGV's are running the internal logistics in the production.</li>
<li>Production was stopped 2 times for 30 seconds during the updating process.</li>
</ol>
<h4 id="exceptions"><a class="header" href="#exceptions">Exceptions</a></h4>
<p>No exceptions should occur in this use case.</p>
<h3 id="use-case-2-navithor-update"><a class="header" href="#use-case-2-navithor-update">Use case 2: Navithor update</a></h3>
<h4 id="situation-1"><a class="header" href="#situation-1">Situation</a></h4>
<p>New Navithor features have been developed to optimize client's production.</p>
<p>Navithor Server is running in a Failover cluster that consists of computers 1 and 2.</p>
<h4 id="user-actions-1"><a class="header" href="#user-actions-1">User actions</a></h4>
<ol>
<li>User takes a connection to a PC in the Failover cluster.</li>
<li>User moves all related clustered resources to Computer 1 in the cluster.</li>
<li>Computer 1 now runs Navithor server.</li>
<li>User updates Navithor server on computer 2.</li>
<li>User moves all related clustered resources to Computer 2.</li>
<li>User updates Navithor server on Computer 1.</li>
</ol>
<h4 id="end-result-1"><a class="header" href="#end-result-1">End result</a></h4>
<ol>
<li>Both computers have the latest Navithor server.</li>
<li>AGV's are running the internal logistics in the production.</li>
<li>Production was stopped 2 times for 30 seconds during the updating process.</li>
</ol>
<h4 id="exceptions-1"><a class="header" href="#exceptions-1">Exceptions</a></h4>
<p>No exceptions should occur in this case.</p>
<h3 id="use-case-3-computer-running-navithor-server-crashes"><a class="header" href="#use-case-3-computer-running-navithor-server-crashes">Use case 3: Computer running Navithor server crashes</a></h3>
<h4 id="situation-2"><a class="header" href="#situation-2">Situation</a></h4>
<p>Navithor server is running in a Failover cluster that consists computers 1 and 2. Clustered resources are running on Computer 1 and Computer 1 crashes.</p>
<h4 id="user-actions-2"><a class="header" href="#user-actions-2">User actions</a></h4>
<p>No actions needed.</p>
<h4 id="end-result-2"><a class="header" href="#end-result-2">End result</a></h4>
<ol>
<li>Navithor server runs on Computer 2</li>
<li>AGV's are running the internal logistics in the production.</li>
<li>Production was stopped for 30 seconds during the switch.</li>
</ol>
<h4 id="exceptions-2"><a class="header" href="#exceptions-2">Exceptions</a></h4>
<h5 id="computer-2-is-also-faulted"><a class="header" href="#computer-2-is-also-faulted">Computer 2 is also faulted.</a></h5>
<p>In this case the production will automatically continue when either one of the computers is fixed and Failover cluster is started.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Installation_NavithorServerAsAService.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="Installation_RebrandingNavithor.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Installation_NavithorServerAsAService.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="Installation_RebrandingNavithor.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
