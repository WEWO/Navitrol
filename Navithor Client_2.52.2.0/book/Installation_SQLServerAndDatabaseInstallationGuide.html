<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuring database - NAVITHOR USER INSTRUCTIONS</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Front page</a></li><li class="chapter-item expanded affix "><li class="part-title">Configuration</li><li class="chapter-item expanded "><a href="Installation_NavithorHardwareRequirements.html"><strong aria-hidden="true">1.</strong> System Hardware Requirement Specifications</a></li><li class="chapter-item expanded "><a href="Installation_SQLServerAndDatabaseInstallationGuide.html" class="active"><strong aria-hidden="true">2.</strong> Configuring database</a></li><li class="chapter-item expanded "><a href="fleetSim.html"><strong aria-hidden="true">3.</strong> Fleet Simulator - Setup and Configuration</a></li><li class="chapter-item expanded "><a href="Installation_NavithorServerAsAService.html"><strong aria-hidden="true">4.</strong> Server as a service</a></li><li class="chapter-item expanded "><a href="Installation_ConfiguringHotSwap.html"><strong aria-hidden="true">5.</strong> Server Hot Swap with Failover Cluster</a></li><li class="chapter-item expanded "><a href="Installation_RebrandingNavithor.html"><strong aria-hidden="true">6.</strong> Server and Client Rebranding</a></li><li class="chapter-item expanded "><a href="Machinetool.html"><strong aria-hidden="true">7.</strong> Machine Tool</a></li><li class="chapter-item expanded "><a href="MesTester3.html"><strong aria-hidden="true">8.</strong> MES Tester</a></li><li class="chapter-item expanded affix "><li class="part-title">Desktop client</li><li class="chapter-item expanded "><a href="navithorServerAndClientMegaDocument.html"><strong aria-hidden="true">9.</strong> System Overview and user instructions for Client UI</a></li><li class="chapter-item expanded "><a href="Feature_ClientUpdater.html"><strong aria-hidden="true">10.</strong> Client Updater</a></li><li class="chapter-item expanded affix "><li class="part-title">Web client</li><li class="chapter-item expanded "><a href="Installation_SettingUpNavithorWebServer.html"><strong aria-hidden="true">11.</strong> Setting up Web server to enable Web client</a></li><li class="chapter-item expanded "><a href="webClient.html"><strong aria-hidden="true">12.</strong> Web Client - User Instructions</a></li><li class="chapter-item expanded affix "><li class="part-title">Guides</li><li class="chapter-item expanded "><a href="bestProductionPractices.html"><strong aria-hidden="true">13.</strong> Best Practices for Creating Production Area</a></li><li class="chapter-item expanded affix "><li class="part-title">Logs</li><li class="chapter-item expanded "><a href="Navithor logs.html"><strong aria-hidden="true">14.</strong> Navithor Logs</a></li><li class="chapter-item expanded "><a href="Feature_VisualReplay.html"><strong aria-hidden="true">15.</strong> Visual Replay</a></li><li class="chapter-item expanded "><a href="Feature_DownloadManager.html"><strong aria-hidden="true">16.</strong> Log Download Manager</a></li><li class="chapter-item expanded affix "><li class="part-title">Users</li><li class="chapter-item expanded "><a href="Installation_UsingActiveDirectoryForAuthentication.html"><strong aria-hidden="true">17.</strong> User authentication against Active Directory</a></li><li class="chapter-item expanded "><a href="userRoles.html"><strong aria-hidden="true">18.</strong> User Management</a></li><li class="chapter-item expanded "><a href="userRolesRightsMatrix.html"><strong aria-hidden="true">19.</strong> Default User roles and User rights matrix</a></li><li class="chapter-item expanded affix "><li class="part-title">Features</li><li class="chapter-item expanded "><a href="symbolicPointGroups.html"><strong aria-hidden="true">20.</strong> Symbolic Point Groups</a></li><li class="chapter-item expanded "><a href="ResourceHandling.html"><strong aria-hidden="true">21.</strong> Resource handling</a></li><li class="chapter-item expanded "><a href="hold-release.html"><strong aria-hidden="true">22.</strong> Hold-Release reasoning and production order lists</a></li><li class="chapter-item expanded "><a href="transfer requests.html"><strong aria-hidden="true">23.</strong> Transfer requests</a></li><li class="chapter-item expanded "><a href="racking.html"><strong aria-hidden="true">24.</strong> Using warehouse racking feature</a></li><li class="chapter-item expanded "><a href="bufferLanes.html"><strong aria-hidden="true">25.</strong> Using Buffer Lanes</a></li><li class="chapter-item expanded "><a href="Feature_ChargingManagement.html"><strong aria-hidden="true">26.</strong> Managing Battery Levels</a></li><li class="chapter-item expanded "><a href="oneMachineZones.html"><strong aria-hidden="true">27.</strong> Using One Machine Zones</a></li><li class="chapter-item expanded "><a href="distanceControlZones.html"><strong aria-hidden="true">28.</strong> Distance Control Zones</a></li><li class="chapter-item expanded "><a href="FireAlarmZones.html"><strong aria-hidden="true">29.</strong> Fire Alarm Zones</a></li><li class="chapter-item expanded "><a href="Zone status use cases.html"><strong aria-hidden="true">30.</strong> Zone status use cases</a></li><li class="chapter-item expanded "><a href="tagStatuses.html"><strong aria-hidden="true">31.</strong> Tag Statuses</a></li><li class="chapter-item expanded "><a href="Trafficlights.html"><strong aria-hidden="true">32.</strong> Traffic Lights</a></li><li class="chapter-item expanded "><a href="Feature_Elevators.html"><strong aria-hidden="true">33.</strong> Elevators</a></li><li class="chapter-item expanded "><a href="ProductionBreak.html"><strong aria-hidden="true">34.</strong> Production Break</a></li><li class="chapter-item expanded "><a href="DynamicSafetyBounds.html"><strong aria-hidden="true">35.</strong> Virtual Dynamic Safety Bounds</a></li><li class="chapter-item expanded "><a href="WaitingSlots.html"><strong aria-hidden="true">36.</strong> Wait Queue Locations</a></li><li class="chapter-item expanded "><a href="CoupledDrive.html"><strong aria-hidden="true">37.</strong> Coupled Drive</a></li><li class="chapter-item expanded "><a href="Feature_StoppingPointOffsetsForSymbolicPoints.html"><strong aria-hidden="true">38.</strong> Stopping Point Offsets</a></li><li class="chapter-item expanded "><a href="TCStopPoint.html"><strong aria-hidden="true">39.</strong> Safe stopping point calculation</a></li><li class="chapter-item expanded "><a href="Navithor statistics.html"><strong aria-hidden="true">40.</strong> System Statistics</a></li><li class="chapter-item expanded "><a href="MachineInterfaces.html"><strong aria-hidden="true">41.</strong> Machine Interfaces</a></li><li class="chapter-item expanded affix "><li class="part-title">Interfaces</li><li class="chapter-item expanded "><a href="Communication specification between Navithor and MES.html"><strong aria-hidden="true">42.</strong> MES Interface</a></li><li class="chapter-item expanded "><a href="NavithorHttpApi.html"><strong aria-hidden="true">43.</strong> HTTP API</a></li><li class="chapter-item expanded "><a href="NavithorWebApi.html"><strong aria-hidden="true">44.</strong> WebSocket API</a></li><li class="chapter-item expanded "><a href="opcuadoc.html"><strong aria-hidden="true">45.</strong> OPC UA Server interface</a></li><li class="chapter-item expanded affix "><li class="part-title">Alarms</li><li class="chapter-item expanded "><a href="Fleet Control Alarms.html"><strong aria-hidden="true">46.</strong> Alarms</a></li><li class="chapter-item expanded "><a href="Alarms configuration override.html"><strong aria-hidden="true">47.</strong> Alarms configuration override</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dark">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NAVITHOR USER INSTRUCTIONS</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sql-server-and-database-installation-guide"><a class="header" href="#sql-server-and-database-installation-guide">SQL Server and Database installation guide</a></h1>
<p>This document contains information on how to install and configure SQL Server for Navithor.</p>
<p>Updated 11.06.2021</p>
<h2 id="version-history"><a class="header" href="#version-history">Version History</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Version</th><th>Date</th><th>Author</th><th>Change</th></tr></thead><tbody>
<tr><td>1.0</td><td>18.12.2020</td><td>Tommi Kärki</td><td>Rewrote document</td></tr>
<tr><td>1.1</td><td>16.04.2021</td><td>Evgenii Kuzminskii</td><td>Corrected the name for &quot;Creating an SQL login for Windows authentication mode&quot; chapter</td></tr>
<tr><td>1.2</td><td>11.06.2021</td><td>Aleksi Ålander</td><td>Renamed title</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="applications-referred-to-in-this-guide"><a class="header" href="#applications-referred-to-in-this-guide">Applications referred to in this guide</a></h2>
<p>SQL Server</p>
<ul>
<li>Hosts databases</li>
</ul>
<p>SQL Server Configuration Manager</p>
<ul>
<li>Configuring SQL server connections</li>
<li>Can also be found as: SQLServerManager15.msc (number depends on version)</li>
</ul>
<p>SQL Server Management Studio</p>
<ul>
<li>Configuring SQL Server settings</li>
<li>Configuring SQL Server logins</li>
</ul>
<p>Navithor Database Tools</p>
<ul>
<li>Ships with Navithor Fleet Control</li>
<li>Configuring connection to SQL Server and specifying name of database to connect to</li>
<li>Performing installation and upgrade</li>
<li>Taking database backups</li>
</ul>
<p>Navithor Server</p>
<ul>
<li>Fleet control software</li>
<li>Requires database connection</li>
</ul>
<p>Navithor Tools</p>
<ul>
<li>Environment and route editing Tool</li>
<li>Required database connection</li>
</ul>
<h2 id="installing-sql-server"><a class="header" href="#installing-sql-server">Installing SQL Server</a></h2>
<p>Navithor Server uses SQL Server as the database of choice. SQL Server Express is free to use and sufficient for most production areas. Express edition comes with following major limitations at time of writing:</p>
<ul>
<li>Database size is limited to 10 GB</li>
<li>1 socket or 4 cores</li>
<li>High availability is not supported</li>
</ul>
<p>See: https://docs.microsoft.com/en-us/sql/sql-server/editions-and-components-of-sql-server-version-15?view=sql-server-ver15 for full comparison.</p>
<p>This document will cover Express installation but we also support other editions.</p>
<h3 id="downloading"><a class="header" href="#downloading">Downloading</a></h3>
<p>Choose Express. Developer version contains all features of SQL Server but license does not allow usage for production.</p>
<p><a href="https://www.microsoft.com/en-us/sql-server/sql-server-downloads">https://www.microsoft.com/en-us/sql-server/sql-server-downloads</a></p>
<p><img src="./Images/sql-server-installation-choose-edition.png" alt="Choose SQL Server edition" /></p>
<blockquote>
<p>Screen capture of site on 18.12.2020, current version might look different.</p>
</blockquote>
<h3 id="installation"><a class="header" href="#installation">Installation</a></h3>
<p>After download has been completed, launch the installer.</p>
<p><img src="./Images/installing-initial-window.png" alt="Installation initial window" /></p>
<blockquote>
<p>Initial pop-up window. If you have internet connection on your device choose &quot;Basic&quot;</p>
</blockquote>
<p>If you are installing on a device without internet connection the setup files need to be transferred manually. To do so:</p>
<ol>
<li>Launch installer on another device that has internet connection</li>
<li>Click on &quot;Download Media&quot;</li>
<li>Follow instructions on screen</li>
<li>Copy the setup files to device without internet connection</li>
<li>Launch installer again. It will ask for Setup files when needed.</li>
</ol>
<p><img src="./Images/installing-tos.png" alt="Installation license agreement" /></p>
<blockquote>
<p>License terms. Read and click Accept</p>
</blockquote>
<p><img src="./Images/installing-location.png" alt="Installation location" /></p>
<blockquote>
<p>Choose where to install.</p>
</blockquote>
<p><img src="./Images/installing-downloading-install-packages.png" alt="Installation downloading" /></p>
<blockquote>
<p>SQL Server is downloading and installing on background</p>
</blockquote>
<p><img src="./Images/installing-completed.png" alt="Installation completed" /></p>
<blockquote>
<p>SQL Server has been installed</p>
</blockquote>
<p><em>Next steps:</em></p>
<ul>
<li>Click on &quot;Install SSMS&quot; to Install SQL Server Management Studio which will be used for configuration</li>
<li>Install Navithor Fleet Control database</li>
<li>Configure SQL Server authentication with SSMS</li>
<li>Configure external connection using Named Pipes or TCP connection</li>
</ul>
<p>Launch SQL Server Management Studio (SSMS) on the device you installed SQL Server on and you will be greeted with this popup</p>
<p><img src="./Images/ssms-login-prompt.png" alt="Installation completed" /></p>
<blockquote>
<p>Connect window</p>
</blockquote>
<p>By default the server name should be local host (if this is the only installation of SQL Server on device) and Windows Authentication is enabled. Administrator rights are required To map Active Directory users, if you installed the SQL Server on your current account then these should be automatically granted. If not, contact your IT support.</p>
<p>Configuring server name and different types of authentication will be covered later in the document.</p>
<p>Click on Connect. <strong>If this fails take a look at <code>Configuring connection</code> or <code>Troubleshooting</code> for instructions</strong></p>
<h2 id="configuring-connection"><a class="header" href="#configuring-connection">Configuring connection</a></h2>
<h3 id="using-integrated-security"><a class="header" href="#using-integrated-security">Using Integrated Security</a></h3>
<p>An important thing know about Integrated security option is that the credentials of the user who launched the application will be used when authenticating. Generally this means the user that is logged in to the computer.  Application can be run as a different user by shift + right-clicking on the application or by running the application as a Windows service.</p>
<p>Windows authentication for remote connections work only if the accounts are defined in an Active Directory forest or in a Workgroup. It is not possible to use Windows authentication if the SQL Server and the Navithor Server application are not in the same domain, unless the domain where Navithor Server exists is marked as a trusted domain.</p>
<h3 id="using-navithor-database-tools-to-configure-connection-string"><a class="header" href="#using-navithor-database-tools-to-configure-connection-string">Using Navithor Database Tools to configure Connection string</a></h3>
<p>Navithor Database Tools provides user interface which can be used to build connection string. Connection string defines which server to connect to, with which protocol and what type of authentication to use among other things.</p>
<p><img src="./Images/troubleshooting-wrong-instance-name-dbtools-fix.png" alt="Default installation configuration" /></p>
<blockquote>
<p>Default installation configuration</p>
</blockquote>
<p>Overview of different options.</p>
<div class="table-wrapper"><table><thead><tr><th>Setting name</th><th>Usage</th></tr></thead><tbody>
<tr><td>DataSource</td><td>Where SQL Server instance is located. How to fill this field depends on connection type but generally it is <code>&lt;server address&gt;\&lt;instance name&gt;</code>. For example: <code>localhost\SQLEXPRESS</code></td></tr>
<tr><td>Integrated Security</td><td>Whether to use Microsoft authentication. If not specified Microsoft Authentication will be used. If set to false then <code>SQL Server authentication</code> which requires configuring SQL Server separately to allow this type of authentication.</td></tr>
<tr><td>User ID</td><td>If Microsoft authentication is used then this should not be used. Otherwise this will be SQL User name/id.</td></tr>
<tr><td>Password</td><td>If Microsoft authentication is used then this should not be used. Otherwise this will be SQL User password.</td></tr>
<tr><td>Network Library</td><td>Which protocol to use when connection to SQL Server instance. Generally best available connection protocol will be automatically picked based on DataSource.</td></tr>
<tr><td>Encrypt</td><td>Whether to enable SSL encryption for data transfer. Not that when TrustServerCertificate is false and Encrypt is true, the server name (or IP address) in a SQL Server SSL certificate must exactly match the server name (or IP address) specified in the connection string. Otherwise, the connection attempt will fail.</td></tr>
<tr><td>Trust Server Certificate</td><td>When encrypt is set to true this specifies whether to trust certificate without walking the certificate chain. If encrypt is set to false this doesn't do anything meaningful. More information at. <a href="https://docs.microsoft.com/en-us/sql/relational-databases/native-client/features/using-encryption-without-validation?view=sql-server-2017">Microsoft article</a></td></tr>
<tr><td>Failover Partner</td><td>Failover partner. More information at: <a href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/database-mirroring-in-sql-server">Microsoft article</a></td></tr>
</tbody></table>
</div>
<h3 id="allowing-sql-user-authentication"><a class="header" href="#allowing-sql-user-authentication">Allowing SQL user authentication</a></h3>
<p>By default, SQL Server only allows logins using Integrated Security (Windows authentication) and denies SQL Server user login attempts. If you plan to use SQL server authentication instead of integrated then the database has to be configured to allow it. To enable SQL Server authentication:</p>
<ol>
<li>Open SQL Server Management Studio on user account and PC that can access SQL Server</li>
<li>Login</li>
<li>Right click SQL Server instance on top of object explorer</li>
<li>Select properties</li>
<li>Select security</li>
<li>Change server authentication to allow SQL Server and Windows authentication mode if required.</li>
</ol>
<p><img src="Images/cheatsheet_ServerInstance_AuthenticationMode.png" alt="" /></p>
<h3 id="configuring-sql-server-logins"><a class="header" href="#configuring-sql-server-logins">Configuring SQL Server logins</a></h3>
<p>SQL server requires configuring Logins which allows users and applications to access the database. It's possible to create a new SQL server user for this purpose, the created user will only have access to database and will not have any access to operating system. Other option is to map operating system user (or Active Directory user) to SQL Server login. Each login can be configured to have one or many predefined roles or individual rights. Rights is for example ability to create new database or delete rows in a table.</p>
<p>For full installation following rights are required:</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Required rights</th></tr></thead><tbody>
<tr><td>1. Configuring ntconn</td><td>CONNECT (testing connection)</td></tr>
<tr><td>2. Creating a new database</td><td>CREATE DATABASE</td></tr>
<tr><td>3. Install schemas and tables</td><td>CREATE SCHEMA, CREATE TABLE, ALTER TABLE</td></tr>
<tr><td>4. Insert initial data</td><td>CONNECT, UPDATE, DELETE</td></tr>
<tr><td>5. Upgrade database version</td><td>CREATE TABLE, ALTER TABLE</td></tr>
</tbody></table>
</div>
<p>Easiest configuration is to use Login with 'sysadmin' server role for installation. It is strongly recommended to use Login with less rights after installation.</p>
<p>For installing tables and schemas to existing empty database following rights are required:</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Required rights</th></tr></thead><tbody>
<tr><td>1. Configuring ntconn</td><td>CONNECT (testing connection)</td></tr>
<tr><td>2. Install schemas and tables</td><td>CREATE SCHEMA, CREATE TABLE, ALTER TABLE</td></tr>
<tr><td>3. Insert initial data</td><td>CONNECT, UPDATE, DELETE</td></tr>
<tr><td>4. Upgrade database version</td><td>CREATE TABLE, ALTER TABLE</td></tr>
</tbody></table>
</div>
<p>These rights can be configured per database and thus it's recommended to allow Login for Navithor Server to keep above user rights to simplify database update.</p>
<p>Minimum Rights required for operation after installation:</p>
<div class="table-wrapper"><table><thead><tr><th>Required rights</th></tr></thead><tbody>
<tr><td>CONNECT</td></tr>
<tr><td>UPDATE</td></tr>
<tr><td>DELETE</td></tr>
</tbody></table>
</div>
<h4 id="creating-an-sql-login-for-sql-server-authentication-mode"><a class="header" href="#creating-an-sql-login-for-sql-server-authentication-mode">Creating an SQL login for SQL server authentication mode</a></h4>
<ol>
<li>Open SQL Server Management studio</li>
<li>Fill in credentials and click Connect</li>
</ol>
<p><img src="Images/addingUser_SSMS_Mainscreen.png" alt="" /></p>
<ol start="3">
<li>Navigate to Security -&gt; Logins and right click Login -&gt; New login...</li>
</ol>
<p><img src="Images/addingUser_SSMS_NewLogin.png" alt="" /></p>
<ol start="4">
<li>Select SQL User and fill information</li>
</ol>
<p><img src="Images/addingUser_SSMS_NewUser_Filled.png" alt="" /></p>
<h4 id="creating-an-sql-login-for-windows-authentication-mode"><a class="header" href="#creating-an-sql-login-for-windows-authentication-mode">Creating an SQL login for Windows authentication mode</a></h4>
<p>Setting up users for integrated security works the same way as adding SQL users. The only difference is that instead of creating an account for the SQL Server the account needs to be searched for from the domain.</p>
<p><img src="images/searchingUsersIntegratedSecurity.png" alt="" /></p>
<h3 id="configuration-cheatsheet"><a class="header" href="#configuration-cheatsheet">Configuration cheatsheet</a></h3>
<p>SQL Server Express on same PC</p>
<p><img src="./Images/cheatsheet_samePcExpress.png" alt="" /></p>
<hr />
<p>SQL Server (non express) on same PC</p>
<p><img src="Images/cheatsheet_samePcNonExpress.png" alt="" /></p>
<hr />
<p>Multiple instances on same PC</p>
<p><img src="Images/cheatsheet_samePcMultipleInstances_Config.png" alt="" /></p>
<p><img src="Images/cheatsheet_samePcMultipleInstances.png" alt="" /></p>
<hr />
<p>Multiple instances on remote PC (SQL Server Browser Enabled and working)</p>
<p><img src="Images/cheatsheet_diffrentIpMultipleInstances_Config.png" alt="" /></p>
<p><img src="Images/cheatsheet_diffrentIpMultipleInstances.png" alt="" /></p>
<hr />
<p>Multiple instances on remote PC (Manually configured port)</p>
<p><img src="images/cheatsheet_explicitConfig_DBTools.png" alt="" /></p>
<p><img src="Images/cheatsheet_explicitConfig_SQLConfigManager.png" alt="" /></p>
<p><img src="Images/cheatsheet_explicitConfig_SQLConfigManager_Protocol.png" alt="" /></p>
<h2 id="installing-database"><a class="header" href="#installing-database">Installing database</a></h2>
<p>Steps to create a functional database for Fleet control:</p>
<ol>
<li>Create database</li>
<li>Install initial schemas and tables</li>
<li>Insert initial data</li>
<li>Upgrade database version</li>
</ol>
<p>Step 1 requires: <code>CONNECT</code>, <code>CREATE DATABASE</code> rights.
Steps 2-4 require: <code>CREATE SCHEMA</code>, <code>CREATE TABLE</code>, <code>ALTER TABLE</code> rights.</p>
<p>Automatically doing full installation is recommended but step 1 can be done beforehand. Refer to <code>Adding Navithor data to existing database</code>.</p>
<h3 id="automatic-installation"><a class="header" href="#automatic-installation">Automatic installation</a></h3>
<p>Open database tools and fill in your connection details.</p>
<p><img src="./Images/troubleshooting-wrong-instance-name-dbtools-fix.png" alt="Default installation configuration" /></p>
<blockquote>
<p>Default installation configuration</p>
</blockquote>
<p>Click on &quot;Test connection&quot;, if there are no errors popup should say &quot;Connection ok&quot; and previously greyed out buttons should be available. If error popped up, refer to &quot;Troubleshooting&quot;.</p>
<p>Navithor Server is capable of creating new database, installing schemas, creating tables and filling out initial data on it's own. Next step is to click on <em>Generate ntconn file</em> which will generate encrypted file containing database connection information and database names. If Database Tools was opened using Navithor Server GUI the file should already be in correct location. Otherwise copy the generated <code>ntconn</code> file to same directory <code>Navithor Server.exe</code> is located at.</p>
<h3 id="custom-installation"><a class="header" href="#custom-installation">Custom installation</a></h3>
<h4 id="changing-database-name"><a class="header" href="#changing-database-name">Changing database name</a></h4>
<p>Database name can be changed by clicking on <em>Edit database names</em> button. This will open up a new pop-up window.</p>
<p><img src="./Images/dbtools-customize-installation-change-database-name.png" alt="Changing database name" /></p>
<blockquote>
<p>Changing database name</p>
</blockquote>
<p>Navithor is using 2 separate databases. Optionally enabled statistics database will contain generated statistics and is safe to read data from. Everything else goes inside main database that should not be used as interface for other programs. Using main database as interface is not supported.</p>
<p>Specify the desired names for databases and click <code>Save</code>.</p>
<h4 id="manually-creating-database-with-database-tools"><a class="header" href="#manually-creating-database-with-database-tools">Manually creating database with Database Tools</a></h4>
<p>It is possible to temporarily login with more privileged user account for database installation. This will make installation and updating more cumbersome but allows restricting the rights of user account <code>Navithor Server</code> uses to minimal. First connect to database with credentials that have <code>CONNECT, CREATE DATABASE, CREATE SCHEMA, CREATE TABLE, ALTER TABLE</code> rights, easiest is to login with database admin credentials. Configure the database names you want to use and then click on <code>Test connection</code> to unlock rest of controls. Finally click on <code>Open Install and Restore Tool</code>.</p>
<p><img src="./Images/dbtools-install-and-restore-tool.png" alt="Install and Restore Tool" /></p>
<p>Tool will give you choice on which database to perform actions on, the choices are generated from contents written in <code>Edit database names</code>. If names are wrong close the Tool, edit names and open Tool again.</p>
<p>To install new fresh database choose which database to install from top and then click on <code>Full install</code> button. This will:</p>
<ul>
<li>Create database</li>
<li>Create schema</li>
<li>Update database to latest version supported to Tool. This involves creating new tables, inserting data and altering existing tables.</li>
</ul>
<p>This will generate a fresh database which has all the data Navithor needs to function. Next step would be to configure SQL User for Navithor to use.</p>
<h4 id="adding-navithor-data-to-existing-database"><a class="header" href="#adding-navithor-data-to-existing-database">Adding Navithor data to existing database</a></h4>
<p>In some cases an empty database has already been created on SQL Server but it is missing data required by Navithor Server. This data will be automatically created by launching <code>Navithor Server</code> but this can also be done manually using <code>Install and Restore Tool</code>. Open the Tool and click on <code>Install tables only</code>. This will create the missing tables and upgrade database to newest version.</p>
<p><img src="./Images/dbtools-install-and-restore-tool.png" alt="Install and Restore Tool" /></p>
<h4 id="manually-upgrading-to-newest-version"><a class="header" href="#manually-upgrading-to-newest-version">Manually upgrading to newest version</a></h4>
<p>Open DatabaseTool and connect to SQL Server with admin credentials. Click on <code>Test connection</code> and then open <code>Install and Restore Tool</code>. Finally click on <code>Upgrade to latest</code>.</p>
<p>![Install and Restore Tool](./Images/dbtools-install-and-restore-tool.png</p>
<h2 id="adding-and-configuring-sql-server-user-for-navithor-sql-server-authentication-only"><a class="header" href="#adding-and-configuring-sql-server-user-for-navithor-sql-server-authentication-only">Adding and configuring SQL Server user for Navithor (SQL server authentication only)</a></h2>
<p>Not required for Integrated Security. Should be done after installing database.</p>
<ol>
<li>Open Login properties (Security -&gt; Logins -&gt; Right click user -&gt; Properties)</li>
<li>Select User Mapping and choose user rights. Following picture has recommended rights</li>
</ol>
<p><img src="Images/configuringRights_UserMapping_Filled.png" alt="" /></p>
<ol>
<li>Open Database Properties (Databases -&gt; Right click database (default: NTDB_PRODUCTION) -&gt; Properties</li>
<li>Select Permissions</li>
</ol>
<p><img src="Images/configuringRights_DatabaseRights.png" alt="" /></p>
<ol start="5">
<li>Ensure that user has at least following Effective Rights:</li>
</ol>
<ul>
<li>CONNECT</li>
<li>UPDATE</li>
<li>DELETE</li>
<li>SELECT</li>
</ul>
<ol start="6">
<li>For updating database version additional Effective Rights are required:</li>
</ol>
<ul>
<li>CREATE TABLE</li>
<li>ALTER TABLE</li>
</ul>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="tcp-connection-server-not-found"><a class="header" href="#tcp-connection-server-not-found">TCP connection, Server not found</a></h3>
<p>Example connection string: <code>Data Source=localhost,12345\SQLEXPRESS;Integrated Security=True</code></p>
<p>Most common reason for failure is that TCP is not configured correctly or at all. In the picture below is a typical error message when there is no configuration done.</p>
<p><img src="./Images/troubleshooting-tcp-connection-failure.png" alt="TCP connection failure" /></p>
<blockquote>
<p>Failed to connect, no response for TCP connection</p>
</blockquote>
<p>Make sure that TCP/IP is allowed for the SQL Server instance. In the picture below it is disabled.</p>
<p><img src="./Images/troubleshooting-tcp-not-allowed.png" alt="TCP connection not allowed" /></p>
<p>To fix the issue, navigate to <code>SQL Server network Configuration</code> -&gt; <code>Properties for &lt;INSTANCE_NAME&gt;</code> -&gt; <code>TCP/IP</code> -&gt; <code>Properties</code>. Enable the protocol and restart the SQL Server instance by navigating to <code>SQL Server Services</code> -&gt; <code>SQL Server (&lt;INSTANCE_NAME&gt;)</code> -&gt; <code>Restart</code>.</p>
<p><img src="./Images/troubleshooting-tcp-properties-enable.png" alt="TCP enabled" /></p>
<p><img src="./Images/troubleshooting-restart-instance.png" alt="Restart instance" /></p>
<p>If custom port was specified (,12345 in example connection string) or the connection still fails the next step is to verify which ports and ips are allowed otherwise the same error message as above will be shown.</p>
<p>Navigate to <code>SQL Server network Configuration</code> -&gt; <code>Properties for &lt;INSTANCE_NAME&gt;</code> -&gt; <code>TCP/IP</code> -&gt; <code>Properties</code> -&gt; <code>IP Addresses</code>. There should be pre-configured entries for network adapters found on device but all of the connections will be disabled.</p>
<p><img src="./Images/troubleshooting-tcp-ip-config-not-configured.png" alt="Addresses not configured" /></p>
<p>To enable connection for specific ip address change:</p>
<ul>
<li><code>Enabled</code> value to <code>Yes</code></li>
<li><code>IP Address</code> value to which remote IP to allow access to</li>
<li><code>TCP Dynamic Ports</code> to <code>0</code> to allow connection to any port or remove the value to use specific port</li>
<li>If dynamic ports was disabled, set <code>TCP Port</code> value to desired value. <em>IN BOTH CASES THE FIREWALL MUST ALLOW THE CONNECTION!</em>.</li>
</ul>
<p>To enable connection for any ip but specific port:</p>
<ul>
<li>Scroll down to bottom to find entry for IPALL</li>
<li>Change <code>TCP Dynamic Ports</code> to <code>0</code> to allow connection to any port</li>
<li>Remove value on<code>TCP Dynamic Ports</code> and fill out desired port to <code>TCP Port</code> to allow connections to specific port.</li>
</ul>
<p>After this, restart the SQL Server instance again.</p>
<h3 id="named-pipes-server-not-found"><a class="header" href="#named-pipes-server-not-found">Named pipes, Server not found</a></h3>
<p>Example connection string: <code>Data Source=localhost;Integrated Security=True</code></p>
<p><img src="./Images/dbtools-connection-failure-error-40.png" alt="DBTools error 40" />
<img src="./Images/connection-failure-error-2.png" alt="SSMS Error 2" /></p>
<blockquote>
<p>Failed to connect</p>
</blockquote>
<p>Likely cause for this image is that there are multiple SQL Server installations on same device or that instance name was not written correctly. Verify instance name using SQL Server Manager (SQLServerManager15.msc).</p>
<p><img src="./Images/troubleshooting-wrong-instance-name.png" alt="Installation completed" /></p>
<blockquote>
<p>SQL Server Configuration Manager</p>
</blockquote>
<p>We can see that there is SQL Server running with the name of SQLEXPRESS and that SQL Server Browser is disabled.</p>
<p>This can be fixed by explicitly specifying name of SQL instance in connection string.</p>
<p><img src="./Images/troubleshooting-wrong-instance-name-ssms-fix.png" alt="SSMS wrong instance name fix" /></p>
<blockquote>
<p>Fix for SSMS. Make sure your \ is pointing to correct direction</p>
</blockquote>
<p><img src="./Images/troubleshooting-wrong-instance-name-dbtools-fix.png" alt="DBTools wrong instance name fix" /></p>
<blockquote>
<p>Fix for Database tools</p>
</blockquote>
<p>Corrected connection string: <code>Data Source=localhost\SQLEXPRESS;Integrated Security=True</code></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Installation_NavithorHardwareRequirements.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="fleetSim.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Installation_NavithorHardwareRequirements.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="fleetSim.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
