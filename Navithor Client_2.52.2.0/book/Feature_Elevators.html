<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Elevators - NAVITHOR USER INSTRUCTIONS</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Front page</a></li><li class="chapter-item expanded affix "><li class="part-title">Configuration</li><li class="chapter-item expanded "><a href="Installation_NavithorHardwareRequirements.html"><strong aria-hidden="true">1.</strong> System Hardware Requirement Specifications</a></li><li class="chapter-item expanded "><a href="Installation_SQLServerAndDatabaseInstallationGuide.html"><strong aria-hidden="true">2.</strong> Configuring database</a></li><li class="chapter-item expanded "><a href="fleetSim.html"><strong aria-hidden="true">3.</strong> Fleet Simulator - Setup and Configuration</a></li><li class="chapter-item expanded "><a href="Installation_NavithorServerAsAService.html"><strong aria-hidden="true">4.</strong> Server as a service</a></li><li class="chapter-item expanded "><a href="Installation_ConfiguringHotSwap.html"><strong aria-hidden="true">5.</strong> Server Hot Swap with Failover Cluster</a></li><li class="chapter-item expanded "><a href="Installation_RebrandingNavithor.html"><strong aria-hidden="true">6.</strong> Server and Client Rebranding</a></li><li class="chapter-item expanded "><a href="Machinetool.html"><strong aria-hidden="true">7.</strong> Machine Tool</a></li><li class="chapter-item expanded "><a href="MesTester3.html"><strong aria-hidden="true">8.</strong> MES Tester</a></li><li class="chapter-item expanded affix "><li class="part-title">Desktop client</li><li class="chapter-item expanded "><a href="navithorServerAndClientMegaDocument.html"><strong aria-hidden="true">9.</strong> System Overview and user instructions for Client UI</a></li><li class="chapter-item expanded "><a href="Feature_ClientUpdater.html"><strong aria-hidden="true">10.</strong> Client Updater</a></li><li class="chapter-item expanded affix "><li class="part-title">Web client</li><li class="chapter-item expanded "><a href="Installation_SettingUpNavithorWebServer.html"><strong aria-hidden="true">11.</strong> Setting up Web server to enable Web client</a></li><li class="chapter-item expanded "><a href="webClient.html"><strong aria-hidden="true">12.</strong> Web Client - User Instructions</a></li><li class="chapter-item expanded affix "><li class="part-title">Guides</li><li class="chapter-item expanded "><a href="bestProductionPractices.html"><strong aria-hidden="true">13.</strong> Best Practices for Creating Production Area</a></li><li class="chapter-item expanded affix "><li class="part-title">Logs</li><li class="chapter-item expanded "><a href="Navithor logs.html"><strong aria-hidden="true">14.</strong> Navithor Logs</a></li><li class="chapter-item expanded "><a href="Feature_VisualReplay.html"><strong aria-hidden="true">15.</strong> Visual Replay</a></li><li class="chapter-item expanded "><a href="Feature_DownloadManager.html"><strong aria-hidden="true">16.</strong> Log Download Manager</a></li><li class="chapter-item expanded affix "><li class="part-title">Users</li><li class="chapter-item expanded "><a href="Installation_UsingActiveDirectoryForAuthentication.html"><strong aria-hidden="true">17.</strong> User authentication against Active Directory</a></li><li class="chapter-item expanded "><a href="userRoles.html"><strong aria-hidden="true">18.</strong> User Management</a></li><li class="chapter-item expanded "><a href="userRolesRightsMatrix.html"><strong aria-hidden="true">19.</strong> Default User roles and User rights matrix</a></li><li class="chapter-item expanded affix "><li class="part-title">Features</li><li class="chapter-item expanded "><a href="symbolicPointGroups.html"><strong aria-hidden="true">20.</strong> Symbolic Point Groups</a></li><li class="chapter-item expanded "><a href="ResourceHandling.html"><strong aria-hidden="true">21.</strong> Resource handling</a></li><li class="chapter-item expanded "><a href="hold-release.html"><strong aria-hidden="true">22.</strong> Hold-Release reasoning and production order lists</a></li><li class="chapter-item expanded "><a href="transfer requests.html"><strong aria-hidden="true">23.</strong> Transfer requests</a></li><li class="chapter-item expanded "><a href="racking.html"><strong aria-hidden="true">24.</strong> Using warehouse racking feature</a></li><li class="chapter-item expanded "><a href="bufferLanes.html"><strong aria-hidden="true">25.</strong> Using Buffer Lanes</a></li><li class="chapter-item expanded "><a href="Feature_ChargingManagement.html"><strong aria-hidden="true">26.</strong> Managing Battery Levels</a></li><li class="chapter-item expanded "><a href="oneMachineZones.html"><strong aria-hidden="true">27.</strong> Using One Machine Zones</a></li><li class="chapter-item expanded "><a href="distanceControlZones.html"><strong aria-hidden="true">28.</strong> Distance Control Zones</a></li><li class="chapter-item expanded "><a href="FireAlarmZones.html"><strong aria-hidden="true">29.</strong> Fire Alarm Zones</a></li><li class="chapter-item expanded "><a href="Zone status use cases.html"><strong aria-hidden="true">30.</strong> Zone status use cases</a></li><li class="chapter-item expanded "><a href="tagStatuses.html"><strong aria-hidden="true">31.</strong> Tag Statuses</a></li><li class="chapter-item expanded "><a href="Trafficlights.html"><strong aria-hidden="true">32.</strong> Traffic Lights</a></li><li class="chapter-item expanded "><a href="Feature_Elevators.html" class="active"><strong aria-hidden="true">33.</strong> Elevators</a></li><li class="chapter-item expanded "><a href="ProductionBreak.html"><strong aria-hidden="true">34.</strong> Production Break</a></li><li class="chapter-item expanded "><a href="DynamicSafetyBounds.html"><strong aria-hidden="true">35.</strong> Virtual Dynamic Safety Bounds</a></li><li class="chapter-item expanded "><a href="WaitingSlots.html"><strong aria-hidden="true">36.</strong> Wait Queue Locations</a></li><li class="chapter-item expanded "><a href="CoupledDrive.html"><strong aria-hidden="true">37.</strong> Coupled Drive</a></li><li class="chapter-item expanded "><a href="Feature_StoppingPointOffsetsForSymbolicPoints.html"><strong aria-hidden="true">38.</strong> Stopping Point Offsets</a></li><li class="chapter-item expanded "><a href="TCStopPoint.html"><strong aria-hidden="true">39.</strong> Safe stopping point calculation</a></li><li class="chapter-item expanded "><a href="Navithor statistics.html"><strong aria-hidden="true">40.</strong> System Statistics</a></li><li class="chapter-item expanded "><a href="MachineInterfaces.html"><strong aria-hidden="true">41.</strong> Machine Interfaces</a></li><li class="chapter-item expanded affix "><li class="part-title">Interfaces</li><li class="chapter-item expanded "><a href="Communication specification between Navithor and MES.html"><strong aria-hidden="true">42.</strong> MES Interface</a></li><li class="chapter-item expanded "><a href="NavithorHttpApi.html"><strong aria-hidden="true">43.</strong> HTTP API</a></li><li class="chapter-item expanded "><a href="NavithorWebApi.html"><strong aria-hidden="true">44.</strong> WebSocket API</a></li><li class="chapter-item expanded "><a href="opcuadoc.html"><strong aria-hidden="true">45.</strong> OPC UA Server interface</a></li><li class="chapter-item expanded affix "><li class="part-title">Alarms</li><li class="chapter-item expanded "><a href="Fleet Control Alarms.html"><strong aria-hidden="true">46.</strong> Alarms</a></li><li class="chapter-item expanded "><a href="Alarms configuration override.html"><strong aria-hidden="true">47.</strong> Alarms configuration override</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dark">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NAVITHOR USER INSTRUCTIONS</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="elevators"><a class="header" href="#elevators">Elevators</a></h1>
<p>This document introduces Elevators feature.</p>
<p>Updated 30.06.2021</p>
<h2 id="version-history"><a class="header" href="#version-history">Version History</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Version</th><th>Date</th><th>Author</th><th>Change</th></tr></thead><tbody>
<tr><td>1.0</td><td>30.06.2021</td><td>Toni Liski</td><td>Document created</td></tr>
<tr><td>1.1</td><td>06.10.2021</td><td>Aleksi Ålander</td><td>Added new parameters</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Navithor Fleet Control supports currently simple implementation of multi-level environment. It means that in the same production area, there is possibility to define separate areas which are linked together with so called <em>LevelChange</em> points. These points can lead to several floors in the building (connected to several <em>LevelChange</em> points) and Fleet Control can plan the routes from the area to another using these links.</p>
<p><img src="./Images/elevators/example1.png" alt="" /></p>
<blockquote>
<p>Figure: Simple environment with two levels. Connection between levels is shown with a red arrow.</p>
</blockquote>
<h2 id="navithor-tools"><a class="header" href="#navithor-tools">Navithor Tools</a></h2>
<p>Activating the built-in elevator logic requires two steps to be done in Navithor Tools.</p>
<ul>
<li>All <em>LevelChange</em> points must have <strong>Level ID</strong> specified</li>
<li>All <em>LevelChange</em> points and <em>Doors</em> in the same Elevator must be grouped to same SymbolicPoint group</li>
</ul>
<h3 id="add-levelchange-points"><a class="header" href="#add-levelchange-points">Add LevelChange points</a></h3>
<p>Firstly, environment must be built normally. In the example Figure below, the Elevator is built so that route is cut inside the Elevator to prevent machines from using Elevator as a drive-through route. This means that route end-point must have <em>LevelChange</em> point which leads to another level (SymbolicPoint <em>1158</em> in this example), and route start-point must have <em>LevelChange</em> point which is the target point from another level (symbolic point <em>1157</em>).</p>
<p><img src="./Images/elevators/two_levelchange_points.png" alt="Two LevelChange points on the same floor." /></p>
<blockquote>
<p>Figure: Two LevelChange points defined for one floor to prevent driving through the Elevator.</p>
</blockquote>
<p>To create LevelChange point:</p>
<ul>
<li>Create normal SymbolicPoint on the route</li>
<li>Select any <em>Type</em>, for example, <strong>Stop</strong></li>
<li>Tick <em>LevelChange</em> from Symbolic Point Settings</li>
<li>Specify <em>Level ID</em> in the field shown in the picture.</li>
</ul>
<p><img src="./Images/elevators/setLevelId.png" alt="Set LevelId for LevelChange point in Tools." /></p>
<blockquote>
<p>Figure: Set Level ID for LevelChange point in Tools.</p>
</blockquote>
<p>To specify the target point where this LevelChange point leads, go to <strong>Edit Destinations and Resources</strong> section and select <strong>Allowed Destinations</strong> tab.</p>
<p><img src="./Images/elevators/allowedDestinations.png" alt="Set LevelId for LevelChange point in Tools." /></p>
<blockquote>
<p>Figure: Specify LevelChange point in Navithor Tools.</p>
</blockquote>
<p>From there you can add target level by clicking first <strong>Add Destination</strong>, select the target LevelChange symbolic point (ID 1258 in this example) and press <strong>Add Destination</strong> again to confirm the selection. If multiple floors can be accessed from this point, add all LevelChange points which should be connected.</p>
<p>If the link is only one-way, then this is all what is required. If routing back from another floor to this point should be possible, allow routing to opposite direction by adding this symbolic point to list of Allowed Destinations of opposite symbolic point (ID 1258 in this example).</p>
<h3 id="define-elevator-doors"><a class="header" href="#define-elevator-doors">Define Elevator Doors</a></h3>
<p>Elevator needs always a door on each floor to control the access to/from elevator. Door can be placed at the physical door location, and changing <em>Door Distance</em> parameters it is possible to make machine to stop at the intended distance in front of the elevator. If elevator is only one-sided, it is good practice to make machine to stop in front of the elevator so that outgoing machine can bypass the incoming machine.</p>
<p><img src="./Images/elevators/doors.png" alt="" /></p>
<blockquote>
<p>Figure: Define Door SymbolicPoints for Elevator.</p>
</blockquote>
<h3 id="define-symbolicpoint-groups"><a class="header" href="#define-symbolicpoint-groups">Define SymbolicPoint Groups</a></h3>
<p>For two floor environments it would be enough just to define LevelChange points, link them together and add doors. Doors could be controlled as a normal door and PLC will handle the elevator requests with sensors, for example. However, in order to enable <em>full elevator logic</em> (recommended), it is required to group all the symbolicpoints in single elevator together. There are two options:</p>
<ol>
<li>Only group LevelChange points and handle doors separately with TagStatus messages</li>
<li>Group Doors and LevelChange points in the same group, and everything will be controlled with ElevatorRequest/ElevatorStatus messages</li>
</ol>
<p>To create a symbolic point group, navigate to <em>Manage Symbolic Point Groups</em> in the left menu. Enter the <em>name</em> and <em>ID</em> for the Elevator, as shown in Figure, and press <strong>Create</strong>. Select the newly created Symbolic Point Group from the dropdown menu and click <strong>Add Point</strong>. Now click all the symbolicpoints in the map, which belong to the same elevator group. Symbolic point will get a bolded circle around it when it is grouped successfully. When all points have been added, press <strong>Add Point</strong> again to confirm the selection. Repeat this process for each elevator in the system.</p>
<p><img src="./Images/elevators/SymbolicPointGroup.png" alt="" /></p>
<blockquote>
<p>Figure: Add Elevator group.</p>
</blockquote>
<h2 id="elevators-in-navithor-fleet-control"><a class="header" href="#elevators-in-navithor-fleet-control">Elevators in Navithor Fleet Control</a></h2>
<p>Navithor creates Elevators automatically based on the given route network. If there exists any LevelChange point which belongs to SymbolicPoint Group, it is considered as Elevator. The Elevator container will join together all LevelChange points in the same group, and all Doors which belong to the group and are found close enough to the LevelChange points.</p>
<p>To enable Elevator control, MES client must subscribe the ElevatorRequest messages. According to the ElevatorStatus messages from MES client, the Elevator can be used for routing, and depending the current level and reservations, the Elevator will have different penalties.</p>
<h3 id="parameters"><a class="header" href="#parameters">Parameters</a></h3>
<p>Elevators can be adjusted with following Navithor parameters.</p>
<h4 id="missionmanager_elevatoraveragetimetomovefromfloortofloor"><a class="header" href="#missionmanager_elevatoraveragetimetomovefromfloortofloor">MissionManager_ElevatorAverageTimeToMoveFromFloorToFloor</a></h4>
<p>This parameter can be used to estimate time to reach target floor, if more detailed information from MES is not available.</p>
<h4 id="missionmanager_elevatorrequesttimebeforearrival"><a class="header" href="#missionmanager_elevatorrequesttimebeforearrival">MissionManager_ElevatorRequestTimeBeforeArrival</a></h4>
<p>This parameter can be used to define how much earlier the machine is estimated to arrive at the elevator it should request the elevator to that floor. Defined as a time instead of distance, so that different routes to different elevators would be considered.</p>
<h4 id="missionmanager_elevatorreservationtimeout"><a class="header" href="#missionmanager_elevatorreservationtimeout">MissionManager_ElevatorReservationTimeout</a></h4>
<p>This parameter can be used to define a period of time that machine should keep the same elevator reserved to itself, even if machine is in estop or error and the drive task is not progressing. After the timeout, the elevator reservation is released and the AGV will recalculate the whole route after it can progress the task again. If machine is disabled, the reservation is released immediately.</p>
<p>Situations where machine task is considered as interrupted:</p>
<ul>
<li>Machine is driving towards the elevator and speed is near zero</li>
<li>No LevelChange point is found on the route anymore</li>
<li>Machine has EStop or Error active</li>
<li>Machine state is not AUTO</li>
<li>Machine is no more in production</li>
</ul>
<h4 id="routeplanner_levelchangelocationprioritypenalty"><a class="header" href="#routeplanner_levelchangelocationprioritypenalty">RoutePlanner_LevelChangeLocationPriorityPenalty</a></h4>
<p>Additional routeplanning penalty based on the location priority set to the level change point. Applied when crossing through a level change point.</p>
<h4 id="routeplanner_levelchangedrivingthroughallowed"><a class="header" href="#routeplanner_levelchangedrivingthroughallowed">RoutePlanner_LevelChangeDrivingThroughAllowed</a></h4>
<p>This parameter defines if driving through the level change point without changing level is allowed or not. On default set to true, which means driving through level change points is allowed.</p>
<h4 id="missionmanager_elevatorreservationresetdistance"><a class="header" href="#missionmanager_elevatorreservationresetdistance">MissionManager_ElevatorReservationResetDistance</a></h4>
<p>This parameter defines the maximum distance in meters to the current elevator reservation to keep the reservation, in case machine is taken out of production. If machine is further away, discard the reservation without waiting for the timeout. On default parameter is set to 10 meters to avoid accidentally giving away a reservation of the elevator for machine that is already very close to the elevator. This could easily cause issues with traffic, in case the elevator would be then reserved by another machine.</p>
<h3 id="mes-interface"><a class="header" href="#mes-interface">MES Interface</a></h3>
<p>To control Elevators over the MES interface, at least the following messages must be implemented (see detailed specification in the <em>MES Interface documentation</em>).</p>
<ul>
<li><strong>MESMessageSubscription</strong></li>
<li><strong>ElevatorStatus</strong></li>
<li><strong>ElevatorRequest</strong></li>
</ul>
<p>Requests for each elevator must be subscribed by at least one Client (PLC). Subscription is done using <em>MESMessageSubscription</em> message for type <strong>ElevatorRequest</strong>. Once requests are subscribed, Navithor starts sending <em>ElevatorRequest</em> messages to request the <em>ElevatorStatus</em> message from the Client, or to control Elevator to given floor. Intervals for sending the requests can be specified in seconds, when making the subscription.</p>
<p>If there are no machines planned to use Elevator, the ElevatorRequest has a RequestType = 0 (Status request) specified. In this case Navithor is only requesting the ElevatorStatus message, containing in which floor Elevator currently is, the operational status etc.</p>
<p>If there is a machine planned to use the elevator, and machine is close enough to elevator (see parameter <strong>MissionManager_ElevatorRequestTimeBeforeArrival</strong>), the ElevatorRequest message has a RequestType = 1 (RequestToFloor). Then more data about machine and target floors are added in the ElevatorRequest message.</p>
<blockquote>
<p><strong>Note!</strong> Both RequestTypes should be always replied with ElevatorStatus message. No separate request is sent for status message, if machine is requesting the Elevator to specific floor.</p>
</blockquote>
<p>In addition to new messages, <em>AgvStatus</em> message has been updated to contain new fields <strong>NextLevelChangePoint</strong> and <strong>DistanceToNextLevelChange</strong>, which can be used to detect if machine is going through any Elevator. See <em>MES Interface specification</em> for more detailed information.</p>
<h3 id="elevator-request-logic-in-navithor"><a class="header" href="#elevator-request-logic-in-navithor">Elevator Request Logic in Navithor</a></h3>
<p>Once machine gets order assigned, next part is to plan route to from machine location to target location. Route planner algorithm tries to minimize the cost (penalty) of the route in order to select the best possible route. Elevator logic adds now possibility to specify penalties for elevators based on the LevelChange point location penalty, and in addition to penalties which are caused by the delay that Elevator actually needs to drive to correct floor first, in case it is on another floor. See more details in the Section <em>Penalty Calculation</em>.</p>
<p>Once the best route is found, machine starts driving towards the elevator. At  that moment Elevator logic is still requesting only Elevator status over the MES interface. When machine proceeds and reaches the point where the estimated travel time to elevator is less than the parameter <em>MissionManager_ElevatorRequestTimeBeforeArrival</em>, Elevator will send request over the MES to move Elevator to floor where machine is going to enter the Elevator from.</p>
<p>Once Elevator reaches the target floor, doors must be opened (controlled by PLC), and this Elevator and Door status information must be sent to Navithor over the ElevatorStatus message.</p>
<p>When the doors are open, machine can enter the Elevator. Machine drives into Elevator until it reaches the LevelChange symbolic point defined. When machine as at the symbolic point, Elevator logic will request Elevator to move the target floor, by sending the ElevatorRequest message and having there RequestToFloor level as a target floor level.</p>
<p>Once Elevator reaches the target floor, opens door and sends the status over ElevatorStatus message, machine can drive out and continue it's task.</p>
<p>Once Machine exits the doors, the machine reservation for the Elevator is automatically deleted and Elevator is considered free. No more RequestToFloor messages are sent, instead only Elevator status request.</p>
<h3 id="multiple-reservations"><a class="header" href="#multiple-reservations">Multiple Reservations</a></h3>
<p>It is possible to reserve elevator for multiple machines simultaneously. For each floor, <strong>two</strong> machines can plan the route through the elevator simultaneously. <u>First reservation is always the priority reservation</u>, but in case another machine has made a reservation for the Elevator to enter from another floor and following conditions are fulfilled, the priority reservation changes. In order to change the priority machine:</p>
<ol>
<li>Only machine which is closest to elevator can be changed to priority machine</li>
<li>If closest machine is arriving from the same floor as priority machine, priority machine cannot be changed</li>
<li>If closest machine is arriving from the same floor where elevator currently is, it is changed to priority machine</li>
<li>If closest machine is arriving from another floor where elevator currently is, but  the arrival time is later than parameter <strong>MissionManager_ElevatorAverageTimeToMoveFromFloorToFloor</strong> defines, closest machine can be changed to priority machine.</li>
</ol>
<h3 id="penalty-calculation"><a class="header" href="#penalty-calculation">Penalty Calculation</a></h3>
<p>There will be an additional penalty based on the existing elevator reservations and its current floor calculated with the following steps:</p>
<ol>
<li>
<p>Each existing reservation will add <strong>MissionManager_ElevatorAverageTimeToMoveFromFloorToFloor</strong> value as a penalty for using this elevator on the route. This means that even if the reservation starts from and targets the same floor (driving through the elevator) the penalty is added.</p>
</li>
<li>
<p>Each change of the elevator floor in between the existing reservations will add the same <strong>MissionManager_ElevatorAverageTimeToMoveFromFloorToFloor</strong> value as a penalty. For example, the previous reservation targets the first floor and the next reservation starts from the second floor. This step also takes into account the initial change of the elevator floor if its current floor differs from the floor where the first reservation starts from. However, no penalty is added if there is no change of the elevator floor in between the reservations and the elevator's initial state (the elevator stays at the same floor).</p>
</li>
<li>
<p>After all the reservations are taken into account the resulting elevator floor (the current floor in case there were no reservations) is checked against the floor of the source LevelChange location on the route. If they differ then the same <strong>MissionManager_ElevatorAverageTimeToMoveFromFloorToFloor</strong> value is added as a penalty. Else no penalty is added at this step.</p>
</li>
<li>
<p>At this point if the accumulated penalty is less than the estimated driving time for the machine to reach the elevator then the elevator call penalty is considered to be zero (the elevator must be already on the correct floor when the machine arrives). Otherwise, the elevator call penalty is the difference between the accumulated penalty and the estimated driving time (the machine will wait for the elevator).</p>
</li>
<li>
<p>Finally, <strong>MissionManager_ElevatorAverageTimeToMoveFromFloorToFloor</strong> value is added to the elevator call penalty and the result is considered as the actual penalty for using the elevator on the route. This means that even if the elevator is used for driving through it the penalty is added.</p>
</li>
</ol>
<p>Amount of additional penalty based on LevelChange location priority can be configured with parameter <strong>RoutePlanner_LevelChangeLocationPriorityPenalty</strong>.
If parameter value is zero, no additional location priority penalty is applied.</p>
<p>Additional penalty is calculated by the following formula:
<code>AdditionalPenalty = (Priority.HIGHEST - LevelChangeSymbolicPointLocationPriority) * RoutePlanner_LevelChangeLocationPriorityPenalty</code></p>
<h3 id="elevator-status-visualization-in-navithor-client"><a class="header" href="#elevator-status-visualization-in-navithor-client">Elevator Status Visualization in Navithor Client</a></h3>
<p>When the elevator group is defined, this elevator state is visualized in Client with an icon displaying current status, current level and name of the elevator. Elevator icon is displayed nearby one of LevelChange locations on the map, one for each elevator at each floor.</p>
<p>Displayed elevator states:</p>
<div class="table-wrapper"><table><thead><tr><th>State</th><th>Icon</th></tr></thead><tbody>
<tr><td>Not defined</td><td><img src="./Images/elevators/ElevatorState_Unknown.png" alt="" /></td></tr>
<tr><td>Init</td><td><img src="./Images/elevators/ElevatorState_Init.png" alt="" /></td></tr>
<tr><td>Automatic</td><td><img src="./Images/elevators/ElevatorState_Automatic.png" alt="" /></td></tr>
<tr><td>AutomaticMoving</td><td><img src="./Images/elevators/ElevatorState_AutomaticMoving.png" alt="" /></td></tr>
<tr><td>Manual</td><td><img src="./Images/elevators/ElevatorState_Manual.png" alt="" /></td></tr>
<tr><td>OutOfService</td><td><img src="./Images/elevators/ElevatorState_OutOfService.png" alt="" /></td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Trafficlights.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="ProductionBreak.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Trafficlights.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="ProductionBreak.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
