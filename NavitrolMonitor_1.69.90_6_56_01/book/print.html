<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NAVITROL USER INSTRUCTIONS - Navitec Systems Oy CONFIDENTIAL</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="MdBook/MdbookFrontPage.html">Front page</a></li><li class="chapter-item expanded affix "><li class="part-title">Introduction</li><li class="chapter-item expanded "><a href="Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html"><strong aria-hidden="true">1.</strong> Navitrol user instructions</a></li><li class="chapter-item expanded "><a href="Introduction/Licensing/Licensing-en.html"><strong aria-hidden="true">2.</strong> Licensing</a></li><li class="chapter-item expanded "><a href="Introduction/OdometrySource/OdometrySource-en.html"><strong aria-hidden="true">3.</strong> Odometry source</a></li><li class="chapter-item expanded "><a href="Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html"><strong aria-hidden="true">4.</strong> Initial calibration guide</a></li><li class="chapter-item expanded "><a href="Miscellaneous/ParameterReconfiguration/ParameterReconfiguration-en.html"><strong aria-hidden="true">5.</strong> Parameter reconfiguration</a></li><li class="chapter-item expanded "><a href="Introduction/Parameters/Parameters.html"><strong aria-hidden="true">6.</strong> Parameter listing</a></li><li class="chapter-item expanded "><a href="Introduction/Parameters/JsonConfigurationFile-en.html"><strong aria-hidden="true">7.</strong> JSON configuration file</a></li><li class="chapter-item expanded "><a href="Introduction/TeachingInstructions/TeachingInstructions-en.html"><strong aria-hidden="true">8.</strong> Teaching instructions</a></li><li class="chapter-item expanded "><a href="Introduction/FeatureMatrix/FeatureMatrix-en.html"><strong aria-hidden="true">9.</strong> Feature Matrix</a></li><li class="chapter-item expanded affix "><li class="part-title">Device interfaces</li><li class="chapter-item expanded "><a href="AgvInterfaces/SupportedDevices/SupportedDevices-en.html"><strong aria-hidden="true">10.</strong> Supported devices</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/GenericInterfaces/GenericInterfacesHeading.html"><strong aria-hidden="true">11.</strong> Generic interfaces</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html"><strong aria-hidden="true">11.1.</strong> Ethernet Supervisor</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html"><strong aria-hidden="true">11.2.</strong> CAN communication</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AgvInterfaces/GenericInterfaces/CanSupervisorInterface/CanSupervisorInterface-en.html"><strong aria-hidden="true">11.2.1.</strong> CAN Supervisor</a></li></ol></li><li class="chapter-item expanded "><a href="AgvInterfaces/GenericInterfaces/EthercatCommunication/EthercatCommunication-en.html"><strong aria-hidden="true">11.3.</strong> EtherCAT Communication</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/GenericInterfaces/Simove/SimoveInterface-en.html"><strong aria-hidden="true">11.4.</strong> SIMOVE</a></li></ol></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/MotorControllersHeading.html"><strong aria-hidden="true">12.</strong> Motor controllers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html"><strong aria-hidden="true">12.1.</strong> Motor controller common</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerSetupInstructions/SchwarzmuellerSetupInstructions-en.html"><strong aria-hidden="true">12.2.</strong> Schwarzmueller setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/SchwarzmuellerParameterSetupInstructions-en.html"><strong aria-hidden="true">12.2.1.</strong> Schwarzmueller parameters</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerTroubleshooting/SchwarzmuellerTroubleshooting-en.html"><strong aria-hidden="true">12.2.2.</strong> Schwarzmueller troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html"><strong aria-hidden="true">12.3.</strong> Curtis</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Engel/EngelMotorController-en.html"><strong aria-hidden="true">12.4.</strong> Engel</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Kinco/KincoMotorController-en.html"><strong aria-hidden="true">12.5.</strong> Kinco</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html"><strong aria-hidden="true">12.6.</strong> Nanotec</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Oriental/OrientalMotorController-en.html"><strong aria-hidden="true">12.7.</strong> Oriental</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Synapticon/SynapticonMotorController-en.html"><strong aria-hidden="true">12.8.</strong> Synapticon</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Roboteq/RoboteqOpenLoopControllerConfiguration-en.html"><strong aria-hidden="true">12.9.</strong> Roboteq Open loop</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/Roboteq/RoboteqClosedLoopControllerConfiguration-en.html"><strong aria-hidden="true">12.10.</strong> Roboteq Closed loop</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html"><strong aria-hidden="true">12.11.</strong> MiControl</a></li></ol></li><li class="chapter-item expanded "><a href="AgvInterfaces/ScannerConfigurations/ScannerHeading.html"><strong aria-hidden="true">13.</strong> Laser scanners</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AgvInterfaces/ScannerConfigurations/ScannerConfigurations-en.html"><strong aria-hidden="true">13.1.</strong> Scanner configurations</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/ScannerCommunicationTroubleshoot/ScannerCommunicationTroubleshoot-en.html"><strong aria-hidden="true">13.2.</strong> Scanner communication troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="AgvInterfaces/OpticalCodeReader/OpticalCodeReader.html"><strong aria-hidden="true">14.</strong> Optical code reader</a></li><li class="chapter-item expanded "><a href="AgvInterfaces/Encoders/EncoderHeading.html"><strong aria-hidden="true">15.</strong> Encoders</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AgvInterfaces/Encoders/EthercatEncoders/EthercatEncoders-en.html"><strong aria-hidden="true">15.1.</strong> EtherCAT encoders</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">User interfaces</li><li class="chapter-item expanded "><a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html"><strong aria-hidden="true">16.</strong> Navitrol Monitor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="CustomerUis/NavitrolMonitor3rdPartyLicenses/NavitrolMonitor3rdPartyLicenses-en.html"><strong aria-hidden="true">16.1.</strong> Navitrol Monitor third party licenses</a></li></ol></li><li class="chapter-item expanded "><a href="CustomerUis/WebInterface/WebInterface-en.html"><strong aria-hidden="true">17.</strong> Navitrol web interface</a></li><li class="chapter-item expanded "><a href="CustomerUis/Parameter Tool/ParameterTool-en.html"><strong aria-hidden="true">18.</strong> Parameter Tool Beta</a></li><li class="chapter-item expanded affix "><li class="part-title">Localization</li><li class="chapter-item expanded "><a href="Localization/PositionConfidence/PositionConfidence-en.html"><strong aria-hidden="true">19.</strong> Position confidence</a></li><li class="chapter-item expanded "><a href="Localization/ScannerCalibration/ScannerCalibration-en.html"><strong aria-hidden="true">20.</strong> Scanner calibration</a></li><li class="chapter-item expanded "><a href="Localization/EnvironmentGuidelines/EnvironmentGuidelines-en.html"><strong aria-hidden="true">21.</strong> Environment guidelines</a></li><li class="chapter-item expanded "><a href="Localization/AutomaticOdometryCorrection/AutomaticOdometryCorrection-en.html"><strong aria-hidden="true">22.</strong> Automatic odometry correction</a></li><li class="chapter-item expanded "><a href="Localization/ReflectorBasedPositionInitialization/ReflectorBasedPositionInitialization-en.html"><strong aria-hidden="true">23.</strong> Reflector based position initialization</a></li><li class="chapter-item expanded "><a href="Localization/PrecisionPositioning/PrecisionPositioning-en.html"><strong aria-hidden="true">24.</strong> Precision positioning</a></li><li class="chapter-item expanded "><a href="Localization/LocalizationScannerChangeOnTheFly/LocalizationScannerChangeOnTheFly-en.html"><strong aria-hidden="true">25.</strong> Changing scanner on the fly</a></li><li class="chapter-item expanded "><a href="Localization/RampZones/RampZones-en.html"><strong aria-hidden="true">26.</strong> Ramp zones</a></li><li class="chapter-item expanded "><a href="Localization/GpsPositioning/GpsPositioning-en.html"><strong aria-hidden="true">27.</strong> GPS Positioning</a></li><li class="chapter-item expanded "><a href="Localization/ImuAndSensorFusion/ImuAndSensorFusion-en.html"><strong aria-hidden="true">28.</strong> IMU and sensor fusion</a></li><li class="chapter-item expanded "><a href="Localization/ExternalLocalization/ExternalLocalization-en.html"><strong aria-hidden="true">29.</strong> External localization</a></li><li class="chapter-item expanded "><a href="Localization/DynamicMapping/DynamicMappingServer/DynamicMappingServer-en.html"><strong aria-hidden="true">30.</strong> Dynamic mapping server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Localization/DynamicMapping/DynamicMappingServerAndClientCompatibility/DynamicMappingServerAndClientCompatibility-en.html"><strong aria-hidden="true">30.1.</strong> Dynamic mapping client/server compatibility</a></li><li class="chapter-item expanded "><a href="Localization/DynamicMapping/DynamicMappingServerHardwareRequirements/DynamicMappingServerHardwareRequirements.html"><strong aria-hidden="true">30.2.</strong> Dynamic mapping client/server hardware requirements</a></li></ol></li><li class="chapter-item expanded "><a href="Localization/WheelSlipping/WheelSlipping-en.html"><strong aria-hidden="true">31.</strong> Wheel slipping diagnostic</a></li><li class="chapter-item expanded "><a href="Localization/3dPositioning/3dPositioning-en.html"><strong aria-hidden="true">32.</strong> 3D positioning</a></li><li class="chapter-item expanded affix "><li class="part-title">Position control</li><li class="chapter-item expanded "><a href="PositionControl/StartOffsetSlowdown/StartOffsetSlowdown-en.html"><strong aria-hidden="true">33.</strong> Start offset slowdown</a></li><li class="chapter-item expanded "><a href="PositionControl/CoupledDriving/CoupledDrivingFeature-en.html"><strong aria-hidden="true">34.</strong> Coupled driving</a></li><li class="chapter-item expanded "><a href="PositionControl/MagneticLineFollowing/MagneticLineFollowing-en.html"><strong aria-hidden="true">35.</strong> Magnetic line following</a></li><li class="chapter-item expanded "><a href="PositionControl/TrailerTransport/TrailerTransport-en.html"><strong aria-hidden="true">36.</strong> Trailer transport</a></li><li class="chapter-item expanded "><a href="PositionControl/BarrierStop/BarrierStop-en.html"><strong aria-hidden="true">37.</strong> Barrier stop</a></li><li class="chapter-item expanded "><a href="PositionControl/DataMatrixDocking/DataMatrixDockingDMC-en.html"><strong aria-hidden="true">38.</strong> Data Matrix Code Docking V2</a></li><li class="chapter-item expanded "><a href="PositionControl/Docking/Docking-en.html"><strong aria-hidden="true">39.</strong> Docking</a></li><li class="chapter-item expanded affix "><li class="part-title">Drive control</li><li class="chapter-item expanded "><a href="DriveControl/DrivingOptions/DrivingOptions-en.html"><strong aria-hidden="true">40.</strong> Driving options</a></li><li class="chapter-item expanded "><a href="DriveControl/Standalone/Standalone-en.html"><strong aria-hidden="true">41.</strong> Standalone</a></li><li class="chapter-item expanded "><a href="DriveControl/StopAndHold/StopAndHold-en.html"><strong aria-hidden="true">42.</strong> Stop-and-hold</a></li><li class="chapter-item expanded "><a href="DriveControl/VDA5050/VDA5050-en.html"><strong aria-hidden="true">43.</strong> VDA 5050</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="DriveControl/VDA5050/VDA5050FeatureMatrix-en.html"><strong aria-hidden="true">43.1.</strong> VDA 5050 Support status</a></li></ol></li><li class="chapter-item expanded "><a href="DriveControl/ReturnToRoute/ReturnToRoute-en.html"><strong aria-hidden="true">44.</strong> Return to route</a></li><li class="chapter-item expanded "><a href="DriveControl/ObstacleAvoidance/ObstacleAvoidance-en.html"><strong aria-hidden="true">45.</strong> Obstacle avoidance</a></li><li class="chapter-item expanded "><a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html"><strong aria-hidden="true">46.</strong> Obstacle avoidance V2</a></li><li class="chapter-item expanded "><a href="DriveControl/ContainerDriving/ContainerDriving-en.html"><strong aria-hidden="true">47.</strong> Container driving</a></li><li class="chapter-item expanded "><a href="DriveControl/RecordAndPlay/RecordAndPlay-en.html"><strong aria-hidden="true">48.</strong> Record and Play</a></li><li class="chapter-item expanded "><a href="DriveControl/RouteFreeNavigation/RouteFreeNavigation-en.html"><strong aria-hidden="true">49.</strong> Route free navigation</a></li><li class="chapter-item expanded affix "><li class="part-title">Kinematics</li><li class="chapter-item expanded "><a href="Kinematics/OmniSteerLimit/OmniSteerLimit-en.html"><strong aria-hidden="true">50.</strong> Omni steer limit</a></li><li class="chapter-item expanded "><a href="Kinematics/OneDriveWheelOmni/OneDriveWheelOmni-en.html"><strong aria-hidden="true">51.</strong> Omni one drive wheel</a></li><li class="chapter-item expanded affix "><li class="part-title">Pickup and drop-off</li><li class="chapter-item expanded "><a href="LoadHandling/ActuatorControl/ActuatorControl-en.html"><strong aria-hidden="true">52.</strong> Actuator control</a></li><li class="chapter-item expanded "><a href="LoadHandling/ScannerLiftActuator/ScannerLiftActuator-en.html"><strong aria-hidden="true">53.</strong> Scanner lift actuator</a></li><li class="chapter-item expanded "><a href="LoadHandling/Racking/Racking-en.html"><strong aria-hidden="true">54.</strong> Racking</a></li><li class="chapter-item expanded "><a href="LoadHandling/BufferLanes/BufferLanes-en.html"><strong aria-hidden="true">55.</strong> Buffer lanes</a></li><li class="chapter-item expanded "><a href="LoadHandling/StackLoading/StackLoading-en.html"><strong aria-hidden="true">56.</strong> Loading from a stack</a></li><li class="chapter-item expanded "><a href="LoadHandling/BlockStacking/BlockStacking-en.html"><strong aria-hidden="true">57.</strong> Unloading to a stack</a></li><li class="chapter-item expanded "><a href="LoadHandling/DistanceToTarget/DistanceToTarget-en.html"><strong aria-hidden="true">58.</strong> Distance to target estimation</a></li><li class="chapter-item expanded affix "><li class="part-title">Target and obstacle detection</li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/PalletDetection/PalletDetection-en.html"><strong aria-hidden="true">59.</strong> Pallet detection</a></li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/3dTargetDetection/3dTargetDetection-en.html"><strong aria-hidden="true">60.</strong> 3D Target detection</a></li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/PatternDetection/PatternDetection-en.html"><strong aria-hidden="true">61.</strong> Pattern detection</a></li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/ObstacleDetection/ObstacleDetection-en.html"><strong aria-hidden="true">62.</strong> Obstacle detection</a></li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/ExternalTargetDetection/ExternalTargetDetection-en.html"><strong aria-hidden="true">63.</strong> External target detection</a></li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/TableDetection/TableDetection-en.html"><strong aria-hidden="true">64.</strong> Table detection</a></li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/Wallmonitoring/Wallmonitoring-en.html"><strong aria-hidden="true">65.</strong> Wall monitoring</a></li><li class="chapter-item expanded "><a href="TargetAndObstacleDetection/OccupancyCheck/OccupancyCheck-en.html"><strong aria-hidden="true">66.</strong> Occupancy check</a></li><li class="chapter-item expanded affix "><li class="part-title">Miscellaneous</li><li class="chapter-item expanded "><a href="Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html"><strong aria-hidden="true">67.</strong> Error descriptions</a></li><li class="chapter-item expanded "><a href="Miscellaneous/Logging/Logging-en.html"><strong aria-hidden="true">68.</strong> Logging</a></li><li class="chapter-item expanded "><a href="Miscellaneous/LinuxImageInstallation/LinuxImagesHeading.html"><strong aria-hidden="true">69.</strong> Linux image installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Miscellaneous/LinuxImageInstallation/CanDrivers/CanDrivers-en.html"><strong aria-hidden="true">69.1.</strong> CAN drivers</a></li><li class="chapter-item expanded "><a href="Miscellaneous/LinuxImageInstallation/Clonezilla/ClonezillaInstallation-en.html"><strong aria-hidden="true">69.2.</strong> Clonezilla</a></li><li class="chapter-item expanded "><a href="Miscellaneous/LinuxImageInstallation/DebianBuster/DebianBusterInstallation-en.html"><strong aria-hidden="true">69.3.</strong> Debian Buster</a></li><li class="chapter-item expanded "><a href="Miscellaneous/LinuxImageInstallation/DebianBullseye/DebianBullseyeInstallation-en.html"><strong aria-hidden="true">69.4.</strong> Debian Bullseye</a></li></ol></li><li class="chapter-item expanded "><a href="Miscellaneous/ParameterZones/ParameterZones-en.html"><strong aria-hidden="true">70.</strong> Parameter zones</a></li><li class="chapter-item expanded "><a href="Miscellaneous/Reflectors/Reflectors-en.html"><strong aria-hidden="true">71.</strong> Reflectors</a></li><li class="chapter-item expanded "><a href="Miscellaneous/SslCertificates/SslCertificates-en.html"><strong aria-hidden="true">72.</strong> SSL Certificate configuration</a></li><li class="chapter-item expanded "><a href="Miscellaneous/BatteryOvertemperatureActions/BatteryOvertemperatureActions.html"><strong aria-hidden="true">73.</strong> Battery overtemperature actions</a></li><li class="chapter-item expanded "><a href="Miscellaneous/Charging/Charging-en.html"><strong aria-hidden="true">74.</strong> Charging and battery management</a></li><li class="chapter-item expanded "><a href="Miscellaneous/HardwareRequirements/HardwareRequirements-en.html"><strong aria-hidden="true">75.</strong> Hardware requirements</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dark">Dark</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">NAVITROL USER INSTRUCTIONS - Navitec Systems Oy CONFIDENTIAL</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div style="text-align: center;">
<img style="display: var(--show-light-logo);margin-left: auto;margin-right: auto;width: 60%;margin-bottom: 50px;margin-top:250px;" src="MdBook/./logo_for_light_bg.png" alt="Navitec Logo">
<img style="display: var(--show-dark-logo);margin-left: auto;margin-right: auto;width: 80%;margin-bottom: 50px;margin-top:250px;" src="MdBook/./logo_for_dark_bg.svg" alt="Navitec Logo">
<h1 style="display:block;margin-left: auto; margin-right: auto;width: 80%">NAVITROL USER INSTRUCTIONS</h1>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-instructions"><a class="header" href="#user-instructions">User Instructions</a></h1>
<p>Updated 20.06.2024</p>
<hr />
<h2 id="glossary"><a class="header" href="#glossary">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Navitrol navigation software for positioning</td></tr>
<tr><td>Navigation computer</td><td>The computer system running Navitrol.</td></tr>
<tr><td>Navithor Tools</td><td>A tool to create the environment model from the teaching data.</td></tr>
<tr><td>NavitrolUpdater</td><td>SW tool to install &amp; update Navitrol and parameter overrides</td></tr>
<tr><td>AGV control</td><td>The software controlling the operation of the AGV including dead reckoning positioning. Communicates with Navitrol.</td></tr>
<tr><td>Supervisor</td><td>On-board PLC controlling some components of the AGV. Communicates with Navitrol.</td></tr>
<tr><td>RSSI</td><td>Laser scanner signal strength value</td></tr>
<tr><td>IPC</td><td>Industrial PC</td></tr>
</tbody></table>
<hr />
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<h3 id="introduction"><a class="header" href="#introduction">Introduction</a></h3>
<p>Navitrol is a positioning and navigation software for AGVs designed by Navitec Systems. While positioning and navigation are the main features, Navitrol is capable of large variety of AGV control tasks, such as:</p>
<ul>
<li>Target and Obstacle detection</li>
<li>Pickup and drop-off functionalities</li>
<li><a href="Introduction/NavitrolUserInstructions/../../Localization/ImuAndSensorFusion/ImuAndSensorFusion-en.html">Sensor fusion</a></li>
</ul>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/agv_front_page.png" alt="" /></p>
<blockquote>
<p>AGV executing a navigation and load-handling task</p>
</blockquote>
<p>The positioning feature provides the position of an AGV in map coordinates. The positioning is based on dead reckoning data combined with laser scanner corrections. The laser scanner corrections are based on matching received 2D measurements to the taught environment. It is possible to use Navitrol for positioning only applications. In these applications Navitrol is typically used for position correction source by control software running on separate hardware. </p>
<p>In the case when Navitrol is being used to control the AGV directly, the Navigation computer is connected directly to the motor controllers and Navitrol controls the output of the motors or commands are sent to other controlling hardware through the <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet Supervisor Interface</a>. The navigation feature provides control references for an AGV to drive along predefined routes combining position control with the positioning.</p>
<p>Navitrol requires an environment model for positioning. This model is created by first teaching the environment by driving the AGV manually around the production area and then using Windows-based Tools software to generate environment and routes. In addition a CAD model of the environment can be used for correcting scaling and misalignment issues.</p>
<p>Navitrol is a Linux software run on an IPC installed on the AGV capable of communicating with various sensors and control devices (See <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/SupportedDevices/SupportedDevices-en.html">Supported Devices</a>).</p>
<h3 id="requirements"><a class="header" href="#requirements">Requirements</a></h3>
<ul>
<li>
<p>Navitrol software runs on Linux Debian operating system.</p>
<ul>
<li>Supported Debian versions are Buster (10) and Bullseye (11). Recommended version for new installations is Bullseye (11)</li>
<li>See <a href="Introduction/NavitrolUserInstructions/../../Miscellaneous/LinuxImageInstallation/LinuxImagesHeading.html">Linux Image installation</a></li>
</ul>
</li>
<li>
<p>IPC must fulfill the <a href="Introduction/NavitrolUserInstructions/../../Miscellaneous/HardwareRequirements/HardwareRequirements-en.html">Hardware Requirements</a></p>
</li>
<li>
<p>Navitrol software needs a license to be run. See <a href="Introduction/NavitrolUserInstructions/../Licensing/Licensing-en.html">Licensing</a> for detailed information.</p>
</li>
</ul>
<hr />
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<h3 id="quick-start"><a class="header" href="#quick-start">Quick start</a></h3>
<ol>
<li>Install and power up the IPC <a href="Introduction/NavitrolUserInstructions/../../Miscellaneous/LinuxImageInstallation/LinuxImagesHeading.html">Linux Image installation</a></li>
<li><a href="Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html#set-up-the-ipc-software-for-navitrol">Set up the IPC Software for Navitrol</a></li>
<li><a href="Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html#install-or-update-navitrol">Install or update Navitrol</a></li>
<li><a href="Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html#configure-scanners-and-setup-odometry-source-for-the-navigation-ipc">Configure scanners and setup odometry source for the navigation IPC</a></li>
<li><a href="Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html#initial-navitrol-run">Initial Navitrol run</a></li>
<li><a href="Introduction/NavitrolUserInstructions/../InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial calibration</a> (AGV calibration + teaching the environment)</li>
</ol>
<h3 id="set-up-the-ipc-software-for-navitrol"><a class="header" href="#set-up-the-ipc-software-for-navitrol">Set up the IPC Software for Navitrol</a></h3>
<p>Navitrol is run on Linux. Commands are given using a SSH terminal connection over Ethernet. Linux has a Samba file server for transferring files.</p>
<h4 id="passwords"><a class="header" href="#passwords">Passwords</a></h4>
<p>There are two user accounts that are already set up.</p>
<table><thead><tr><th>User level</th><th>User name</th><th>Password</th></tr></thead><tbody>
<tr><td>root</td><td>root</td><td>navitrol</td></tr>
<tr><td>user</td><td>navitec</td><td>navitrol</td></tr>
</tbody></table>
<h4 id="ssh-terminal-connection"><a class="header" href="#ssh-terminal-connection">SSH Terminal Connection</a></h4>
<p>The SSH connection is used for giving commands to Linux. A recommended program for taking connection is Putty.</p>
<p>Putty can be downloaded from: <a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html">chiark.greenend.org.uk/~sgtatham/putty</a></p>
<p>Set up the IP address to the Host name field and press open to make a connection.</p>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/putty_configuration.png" alt="" /></p>
<blockquote>
<p>Putty configuration</p>
</blockquote>
<h4 id="ipc-network-connections"><a class="header" href="#ipc-network-connections">IPC Network connections</a></h4>
<p>The default IP address of the Navigation computer is 10.10.6.100.
If the IP address needs to be changed the modification is done in the
location <strong>/etc/network/interfaces.</strong> Network configurations are explained more detail in:</p>
<ul>
<li><a href="Introduction/NavitrolUserInstructions/../../Miscellaneous/LinuxImageInstallation/DebianBullseye/DebianBullseyeInstallation-en.html#network-configuration">Debian 11 Bullseye Installation - Network configuration</a></li>
<li><a href="Introduction/NavitrolUserInstructions/../../Miscellaneous/LinuxImageInstallation/Buster/../DebianBuster/DebianBusterInstallation-en.html#ethernet-configurations">Debian 10 Buster Installation - Ethernet configurations</a></li>
</ul>
<p>After changing the network configuration a reboot is needed.</p>
<h4 id="transferring-files"><a class="header" href="#transferring-files">Transferring Files</a></h4>
<p>The onboard Linux of the Navigation computer runs as a samba server for transferring files between your Windows computer and the IPC.</p>
<p>The connection can be made using Windows explorer.</p>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/file_explorer_samba.png" alt="" /></p>
<blockquote>
<p>Setting the address in Windows explorer</p>
</blockquote>
<p>After making the connection the user name and password is asked. Enter the user name navitec and password navitrol.</p>
<p>The simplest way to access Samba network drive is to type <code>\\IPC_IP\\navitec\</code> to Windows Explorer address line, and then type in credentials. As described above. This can however fail in different ways: Windows may fail to connect at all, or the authentication fails because of Windows trying to force specific domain or username. In all those cases it is worth trying to map the network share as a drive.
Mapping can be done with File Explorer or with command prompt.</p>
<p>Other option is to use WinSCP to transfer files: <a href="https://winscp.net/eng/index.php">https://winscp.net/eng/index.php</a></p>
<h5 id="map-network-drive"><a class="header" href="#map-network-drive">Map network drive</a></h5>
<ul>
<li>Right click &quot;This PC&quot; in File Explorer</li>
<li>Select &quot;Map network drive...&quot;</li>
<li>Add path <code>\\IPC_IP\\navitec\</code> to Folder, and check &quot;Connect using different credentials&quot;
<ul>
<li>Don't use windows credentials, instead insert username and password matching Navitrol IPC configuration.</li>
</ul>
</li>
</ul>
<h5 id="mount-with-command-line"><a class="header" href="#mount-with-command-line">Mount with command line</a></h5>
<pre><code class="language-console">net use DRIVE: \\\\IPC_IP\\navitec /user:USERNAME PASSWORD
</code></pre>
<p>Example:</p>
<pre><code class="language-console"> net use K: \\\\192.168.1.100\\navitec /user:navitec navitrol
</code></pre>
<h3 id="install-or-update-navitrol"><a class="header" href="#install-or-update-navitrol">Install or Update Navitrol</a></h3>
<p>Since version 6.28.00 Navitrol software is distributed as Debian installation package. There are two alternative ways to handle software installation. User can either use NavitrolUpdater or directly use Debian Package Manager to handle the installation. Use of NavitrolUpdater is the preferred way when updating several AGV's at a time.</p>
<p><strong>NOTE</strong>: 
If you are installing Navitrol the first time, installation is done from command line</p>
<h4 id="command-line"><a class="header" href="#command-line">Command line</a></h4>
<p>The package name is Navitrol_version_architecture.deb, for example <code>Navitrol_6.28-0_amd64.deb</code>.</p>
<p>Installation:</p>
<ol>
<li>
<p>Copy the installation package to the Navigation computer using SCP or samba</p>
</li>
<li>
<p>Open SSH connection to Navigation computer</p>
</li>
<li>
<p>Gain root privileges using 'su -' command.</p>
</li>
<li>
<p>Install package with <code>dpkg -i Navitrol_6.28-0_amd64.deb</code> command on linux terminal</p>
</li>
<li>
<p>Navitrol is now installed to run at startup, but it still needs a licence and the parameter file params.txt </p>
<ol>
<li><ins>Contact Navitec <a href="mailto:support@navitec.fi">support</a> for the license and base params.txt file<ins></li>
</ol>
</li>
</ol>
<h4 id="navitrolupdater"><a class="header" href="#navitrolupdater">NavitrolUpdater</a></h4>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/navitrolupdater.png" alt="" /></p>
<ol>
<li>
<p>Choose what do you want to update, any combination can be selected</p>
<ul>
<li>
<p>If Navitrol, check &quot;Update Navitrol&quot; and click &quot;Browse&quot; to select used Navitrol installation package (*.deb)</p>
</li>
<li>
<p>If parameters, check &quot;Update params.txt&quot;</p>
</li>
<li>
<p>If override parameters, check &quot;Update params_override.txt&quot;</p>
</li>
<li>
<p>If environment file, check &quot;Upload Environment file&quot;</p>
</li>
</ul>
</li>
<li>
<p>Choose the files for each checked option with by pressing &quot;Browse&quot; button for each file</p>
</li>
<li>
<p>Choose the AGVs that you want to update</p>
<ul>
<li>
<p>You can add AGVs to list</p>
</li>
<li>
<p>Only the AGVs that where &quot;Update&quot; is checked are updated</p>
</li>
</ul>
</li>
<li>
<p>Hit the &quot;Update Selected Navitrol Clients&quot;</p>
</li>
</ol>
<h5 id="navitrolupdater---trouble-shooting"><a class="header" href="#navitrolupdater---trouble-shooting">NavitrolUpdater - Trouble shooting</a></h5>
<p><strong>Updater does not accept the correct password</strong></p>
<p><strong>Reason:</strong> The linux system on the IPC does not allow direct login as super user.</p>
<p><strong>Solution:</strong> Enable direct login as super user</p>
<ol>
<li>
<p>Open terminal in the IPC running Navitrol.</p>
</li>
<li>
<p>Login as super user using &quot;<strong>su -</strong>&quot; command and <strong>navitrol</strong> as password</p>
</li>
<li>
<p>Open sshd_config file using <strong>nano /etc/ssh/sshd_config</strong> command</p>
</li>
<li>
<p>Add new line to the file: <strong>PermitRootLogin yes</strong> (the place of the line does not matter)</p>
</li>
<li>
<p>Save file with ctrl+s and close it with ctrl+x</p>
</li>
<li>
<p>Restart the ssh process with <strong>/etc/init.d/ssh restart</strong> command</p>
</li>
</ol>
<h3 id="configure-scanners-and-setup-odometry-source-for-the-navigation-ipc"><a class="header" href="#configure-scanners-and-setup-odometry-source-for-the-navigation-ipc">Configure scanners and setup odometry source for the navigation IPC</a></h3>
<p>The default IPC that Navitrol is run on is:<br />
<strong>VBOX-3121-i3, i3-6300U @ 2.3 GHz, 2 core, 4 threads, 4 GB RAM memory</strong></p>
<p>In order to run Navitrol, the IPC needs to be set up. Minimum setup to use Navitrol for localization:</p>
<ul>
<li>Configure scanners and the IPC ports for the scanners</li>
<li>Odometry source for the IPC
<ul>
<li>Enable and configure communication interface(s), see <a href="Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html#configure-odometry-source">Configure odometry source</a></li>
<li>Connect to communication interface(s) used</li>
</ul>
</li>
</ul>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/IPC_backside.jpeg" alt="" /></p>
<blockquote>
<p>Communication interfaces at the back of the IPC</p>
</blockquote>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/IPC_frontside.jpeg" alt="" /></p>
<blockquote>
<p>Communication interface on the front of the IPC</p>
</blockquote>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/IPC_powercablewiring.png" alt="" /></p>
<blockquote>
<p>Power cable wiring for the IPC</p>
</blockquote>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/CAN_RS422_ports.jpeg" alt="" /></p>
<blockquote>
<p>CAN and RS422 serial interface ports</p>
</blockquote>
<h4 id="configure-scanners"><a class="header" href="#configure-scanners">Configure Scanners</a></h4>
<p>Most scanners communicate over Ethernet, but for example the SICK S300 scanners require RS422 serial interface with a communication rate of 500 kbaud.
For this communication a standard serial port is replaced with a dual RS422 card. The card is from Diamond Systems, therefore the mark DS below the port, see the figure below.
The detailed scanner configuration instructions for each scanner can be found here: <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/ScannerConfigurations/ScannerConfigurations-en.html">Scanner configurations</a></p>
<p><img src="Introduction/NavitrolUserInstructions/./media-en/lidar.png" alt="" /></p>
<blockquote>
<p>R2000 UHD LiDAR scanner</p>
</blockquote>
<h4 id="configure-odometry-source"><a class="header" href="#configure-odometry-source">Configure odometry source</a></h4>
<p>The most common way to provide odometry data is either through CAN bus or Ethernet supervisor interface. Other options currently are EtherCAT and serial.</p>
<p>In most machine types odometry source is selected automatically, and related communication interface enabled automatically as well. When using specific machine types, such as <strong>machine_type_id</strong> 44xxxx, odometry source must be defined using parameter <strong>odometry_source</strong>. More detailed information on odometry source selection and configuration can be found from 
<a href="Introduction/NavitrolUserInstructions/../OdometrySource/OdometrySource-en.html">Odometry Source</a>, that document describing also the parameters used to enable other communication interfaces.</p>
<p>Further instructions for setting up and using different communication interfaces:</p>
<ul>
<li>CAN <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a></li>
<li>Ethernet interface <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet Supervisor Interface</a></li>
<li>EtherCAT interface <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/GenericInterfaces/EthercatCommunication/EthercatCommunication-en.html">EtherCAT communication</a></li>
<li>Serial bus, with Roboteq motor controllers only <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/MotorControllers/Roboteq/RoboteqOpenLoopControllerConfiguration-en.html">Roboteq Controller Configuration</a></li>
</ul>
<p>Check also the list of supported devices or ask additional information from Navitrol support. List of supported devices: <a href="Introduction/NavitrolUserInstructions/../../AgvInterfaces/SupportedDevices/SupportedDevices-en.html">Supported Devices</a></p>
<hr />
<h3 id="initial-navitrol-run"><a class="header" href="#initial-navitrol-run">Initial Navitrol run</a></h3>
<p>To run Navitrol on the IPC, the following prerequisites have to be done:</p>
<ul>
<li>IPC installed with Debian Buster (10) or Debian Bullsey (11)</li>
<li>Navitrol software package (.deb) installed under /home/navitec folder</li>
</ul>
<p>After this the initial Navitrol parameters are needed. The initial parameter file is provided by Navitec support.</p>
<h4 id="parameters"><a class="header" href="#parameters">Parameters</a></h4>
<p>Parameters affecting the operation of Navitrol are in the file params.txt in the /home/Navitec folder. It is a text file which can be edited with any editor which can output a plain text file. Parameters that are not listed in params.txt file are used in Navitrol with their default value</p>
<p>A line in the parameter file may be either a comment line or a parameter line. A comment line starts with # and a parameter line with the parameter type indicator F (Float), S (String), I (Integer) or U (Unsigned Integer).</p>
<p>In addition to the parameter type a parameter line consists of the name of the parameter and the current value. Then there is an optional comment about the parameter. A comma is required between each obligatory item of a parameter definition.</p>
<p>Navitrol reads in the parameter file when it starts. If not being able to parse the parameter file Navitrol does not start but writes about the problem on the terminal. A typical error in the parameter file could be a value outside the minimum and maximum limits. If the real parameter value needs to be set outside the minimum or maximum then the limits must be changed accordingly.</p>
<h5 id="general-parameters"><a class="header" href="#general-parameters">General Parameters</a></h5>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>machine_type_id</td><td>Int</td><td>0</td><td>ID of the machine type. Provided by Navitec Systems, check <a href="Introduction/NavitrolUserInstructions/../InitialCalibrationGuide/InitialCalibrationGuide-en.html#machine-types">Machine types</a></td></tr>
<tr><td>machine_type_key</td><td>Uint</td><td>0</td><td>Verification key corresponding to the machine type ID. Provided by Navitec systems</td></tr>
<tr><td>dim_front</td><td>Float</td><td>1.0</td><td>Dimension of the AGV in meters from the navigation point to the front outer dimension. Beams falling inside the perimeter of the vehicle are skipped. Has to be positive</td></tr>
<tr><td>dim_rear</td><td>Float</td><td>-1.0</td><td>Dimension of the AGV in meters from the navigation point to the rear outer dimension. Beams falling inside the perimeter of the vehicle are skipped. Has to be negative</td></tr>
<tr><td>dim_left</td><td>Float</td><td>1.0</td><td>Dimension of the AGV in meters from the navigation point to the left outer dimension. Beams falling inside the perimeter of the vehicle are skipped. Has to be positive</td></tr>
<tr><td>dim_right</td><td>Float</td><td>-1.0</td><td>Dimension of the AGV in meters from the navigation point to the right outer dimension. Beams falling inside the perimeter of the vehicle are skipped. Has to be negative</td></tr>
<tr><td>supervisor_eth_enabled</td><td>Int</td><td>0</td><td>Determines if Navitrol should be expecting messages through the Supervisor or AGV controller interface. 1 for enabled, 0 for disabled.</td></tr>
<tr><td>supervisor_eth_ip</td><td>String</td><td>192.168.2.141</td><td>Supervisor IP address. Needed if Supervisor works as a server</td></tr>
<tr><td>supervisor_eth_port</td><td>Int</td><td>5015</td><td>Supervisor communication server side port</td></tr>
<tr><td>supervisor_eth_server</td><td>Int</td><td>0</td><td>Defines whether Supervisor is server or client, 0 - client, 1 - server</td></tr>
<tr><td>supervisor_eth_endianness</td><td>Int</td><td>0</td><td>Defines Supervisor data endianness, 0 - little endian, 1 - big endian</td></tr>
<tr><td>veh_inte_error_message_mode</td><td>Int</td><td>2</td><td>0 to not send errors/warnings to PLC/agv controller, 1 to send active errors, 2 to send active errors and warnings</td></tr>
<tr><td>veh_inte_heartbeat_interval</td><td>Int</td><td>0</td><td>How often to send active errors/warnings to PLC/agv controller in ms</td></tr>
<tr><td>loc_xy_max_corr</td><td>Float</td><td>0.0015</td><td>Maximum single localization correction for X and Y in meters</td></tr>
<tr><td>loc_h_max_corr</td><td>Float</td><td>0.1500</td><td>Maximum single localization correction for heading in degrees.</td></tr>
<tr><td>odo_max_interval_ms</td><td>Int</td><td>60</td><td>Maximum odometry receive interval in milliseconds. Navitrol gives ERROR_DEADREC_HIGH_DT if time from last odometry update is highen than this parameter</td></tr>
</tbody></table>
<h5 id="general-position-control-system-parameters"><a class="header" href="#general-position-control-system-parameters">General Position Control System parameters</a></h5>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>control_interval_us</td><td>Int</td><td>30000</td><td>AGV position control and vehicle interface control interval.</td></tr>
<tr><td>control_interval_error_ratio</td><td>Float</td><td>1.1</td><td>Defines how much measured control interval can deviate from target (e.g. 1.1 means 10%)</td></tr>
<tr><td>control_interval_max_stdev_us</td><td>Int</td><td>1000</td><td>Defines how much measured control interval standard deviation can be in us</td></tr>
<tr><td>fleet_control_type</td><td>Int</td><td>1</td><td>0 - No fleet control, 1 - Navitec Systems fleet control, 2 - External fleet control, 3 - VD(M)A fleet control</td></tr>
<tr><td>fleet_control_port</td><td>Int</td><td>6007</td><td>TCP port number used for communication with the fleet control server.</td></tr>
<tr><td>machine_id</td><td>Int</td><td>1</td><td>Machine ID number reported to fleet control and other systems</td></tr>
</tbody></table>
<p>Example format of parameter set from params.txt (with Schwarzmueller Omni drive AGV):</p>
<pre><code># Parameters specific to each vehicle type
I,machine_type_id,                                            180007 # Id of vehicle type
U,machine_type_key,                                       2381850774 # Verification key of machine type id
F,dim_front,                                                2.300000 # min 0.010000, max 100.000000
F,dim_rear,                                                -1.510000 # min -100.000000, max -0.010000
F,dim_left,                                                 0.870000 # min 0.010000, max 100.000000
F,dim_right,                                               -0.870000 # min -100.000000, max -0.010000
S,supervisor_eth_ip,                                    172.16.12.49 # Supervisor IP address
I,supervisor_eth_server,                                           1 #
</code></pre>
<p>More detailed parameters can be found in documents specifying the specific feature in the software. For example, parameters related to actuators can be found in the document <a href="Introduction/NavitrolUserInstructions/../../LoadHandling/ActuatorControl/ActuatorControl-en.html">Actuator Control</a>.</p>
<h4 id="navitrol-test-run"><a class="header" href="#navitrol-test-run">Navitrol test run</a></h4>
<p>After you have the initial parameters to params.txt under /home/navitec, you can run Navitrol with Linux terminal command (as root user):</p>
<pre><code class="language-console">./Navitrol
</code></pre>
<p>After a successful test run (Navitrol starts running on terminal), proceed to the <a href="Introduction/NavitrolUserInstructions/../InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial calibration Guide</a>.</p>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="most-common-issues"><a class="header" href="#most-common-issues">Most Common issues</a></h3>
<h4 id="navitrol-does-not-run-with-command-navitrol"><a class="header" href="#navitrol-does-not-run-with-command-navitrol">Navitrol does not run with command ./Navitrol</a></h4>
<ul>
<li>Check that you have installed Navitrol to /home/navitec: </li>
</ul>
<pre><code class="language-console">dpkg -s navitrol
</code></pre>
<ul>
<li>Check that you have working parameters that Navitrol can parse. Navitec Support will provide you the parameters</li>
</ul>
<h3 id="cannot-change-parameters-from-paramstxt"><a class="header" href="#cannot-change-parameters-from-paramstxt">Cannot change parameters from params.txt</a></h3>
<p>params.txt file might need permissions for reading and writing. The permissions can be added with linux command:</p>
<pre><code class="language-console">cd /home/navitec
chmod +rw params.txt
</code></pre>
<h3 id="advanced-troubleshooting"><a class="header" href="#advanced-troubleshooting">Advanced Troubleshooting</a></h3>
<h4 id="logging-functions"><a class="header" href="#logging-functions">Logging Functions</a></h4>
<p>Navitrol provides a list of commands that can be used in order to write specific log messages to files and/or view them in real time. Amount of log lines and the threads of interest can be also specified manually. Loggings functionalities are explained on their own document <a href="Introduction/NavitrolUserInstructions/../../Miscellaneous/Logging/Logging-en.html">Logging</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="navitrol-licensing"><a class="header" href="#navitrol-licensing">Navitrol Licensing</a></h1>
<p>Updated 11.06.2024</p>
<h2 id="glossary-1"><a class="header" href="#glossary-1">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Fingerprinting</td><td>A method for uniquely identifying the target where application runs.</td></tr>
<tr><td>Device-locked license</td><td>Device-locked licensing uses target fingerprinting and locks the license to the target.</td></tr>
<tr><td>Floating license</td><td>Floating license is not locked to any specific target/HW. When a licensed software is started it leases a license from the License Server and frees the license when it shuts down. With Floating license the number of simultaneously running instances is limited by the license.</td></tr>
<tr><td>Lease duration</td><td>A time that a Floating license lease is valid without renewal.</td></tr>
<tr><td>License Server</td><td>Navitec Systems application that manages creation and updates of all licenses.</td></tr>
<tr><td>Server sync interval</td><td>The interval for server syncs by a licensed software when using online (Floating license) licensing model.</td></tr>
<tr><td>Trusted Platform Module (TPM)</td><td>TPM is an international standard for a secure crypto-processor, and it is designed to provide hardware-based, security-related functions.</td></tr>
</tbody></table>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>Navitrol supports two different licensing methods, <a href="Introduction/Licensing/Licensing-en.html#legacy-license">Legacy license</a> and <a href="Introduction/Licensing/Licensing-en.html#regular-license">Regular license</a>. Legacy licensing model has been used from the early days of Navitrol. It does however have multiple practical limitations, and therefore new licensing method, Regular licensing, has been introduced. </p>
<p>Regular licensing is the recommended future-proof solution. Existing Legacy licenses are still supported, but all new (or future) licensed features are not supported by Legacy licensing method.</p>
<h3 id="current-license-details"><a class="header" href="#current-license-details">Current license details</a></h3>
<p>Detailed information about Navitrol license for a connected Navitrol can be seen in Monitor by selecting &quot;Help-About&quot; from menu.</p>
<p><img src="Introduction/Licensing/./media-en/MonitorAbout.png" alt="" /></p>
<p>All this information is also logged in the beginning of each text log file (startlog.txt and log.txt). Examples of logged data are shown in the following chapters.</p>
<p><strong>NOTE</strong>: Hardware and license details are different in each case, as they depend on the hardware, licensing model and licensed options in use. Therefore, any license details shown in this document are just examples of one specific case.</p>
<h3 id="licensing-method-selection"><a class="header" href="#licensing-method-selection">Licensing method selection</a></h3>
<p>Licensing method (Regular vs. Legacy) used is selected at run-time by Navitrol. Regular licensing is prioritized, and it is used if license file <code>LicenseDetails.json</code> exists on the system. See <a href="Introduction/Licensing/Licensing-en.html#regular-license">Regular license</a> below for details. If there is no <code>LicenseDetails.json</code> file, Navitrol switches to Legacy licensing method for backward compatibility. It is only the existence of this file that matters. If license file exists, but has invalid data or format, then Navitrol still sticks to Regular licensing and raises a related error.</p>
<p>In the beginning of each text log file there is some information about run-time system and licensing method used. The section that shows license information is referred here as a <code>license section</code>. </p>
<p>In case of Regular licensing being used, text logs starts with:</p>
<pre><code>Mon May 27 10:36:26 2024

Navitrol 6.53.02 99083666 2024-05-27T07:31:25+00:00 for machine type 440001
Debian GNU/Linux 11 (bullseye)
RT Kernel 5.10.0-23-rt-amd64

Board SMB-2600 by Sintrones Technology Corp.
BIOS by American Megatrends Inc.
CPU Intel(R) Celeron(R) 2980U @ 1.60GHz
CPU 2 cores, clock 1596.38 MHz
TotalMem 7869 MiB, TotalSwap 3905 MiB, TotalStorage 52.56 GiB

REGULAR licensing used (LibVer 3.21.2) - Activation mode DeviceLocked
Normal Fingerprint
LicenseKey 0744E5-925FE1-40BCAB-0D53DE-1207EB-614120
</code></pre>
<p>In case of Legacy licensing being used, <code>license section</code> starts with:</p>
<pre><code>LEGACY licensing used
License id,key 4091113304772258577,13541695821371515033
</code></pre>
<h3 id="license-models"><a class="header" href="#license-models">License models</a></h3>
<p>Regular licensing supports different licensing models. The currently available ones are </p>
<ul>
<li>Offline Device-locked license</li>
<li>Floating license</li>
</ul>
<p>Legacy licensing supports only Offline Device-locked licenses. </p>
<h3 id="backward-and-forward-compatibility"><a class="header" href="#backward-and-forward-compatibility">Backward and forward compatibility</a></h3>
<p>Navitrol can use any license created for older SW version, assuring full backward compatibility.</p>
<p>Regular licensing provides full forward compatibility as well. Legacy licensing on the other hand has limitations with forward compatibility. It is not guaranteed that license created for a specific Navitrol version would be usable with older Navitrol versions. </p>
<h3 id="basic-license"><a class="header" href="#basic-license">Basic license</a></h3>
<p>A basic license is simply a license to run Navitrol without additional licensed options.</p>
<h3 id="license-with-options"><a class="header" href="#license-with-options">License with options</a></h3>
<p>A license with options is a license to run Navitrol with predefined additional licensed options. A license in this case includes information about all enabled licensed options/features.</p>
<p>In Legacy licensing all licensed features are enabled by specific parameters. </p>
<p>Regular licensing uses the same parameters and mechanisms for old license options, but licensed option can also be tied to something else than parameter values (like kinematic type of the machine).</p>
<p>All enabled license options are logged into beginning of the text log files in <code>license section</code>:</p>
<pre><code>LEGACY licensing used
License id,key 9439414948331747385,14605972011522150860
Valid license with options in use
License for option &quot;Dynamic Mapping Server&quot; in use
License for option &quot;Route Driver&quot; in use
License for option &quot;Precision Positioning&quot; in use
License for option &quot;Target Detection&quot; in use
License for option &quot;External Localization&quot; in use
License for option &quot;Obstacle Avoidance&quot; in use
License for option &quot;Warehouse Racking&quot; in use
License for option &quot;3D Object detection&quot; in use
</code></pre>
<hr />
<h2 id="regular-license"><a class="header" href="#regular-license">Regular license</a></h2>
<p>Regular licensing has several benefits over Legacy licensing from user point of view, like:</p>
<ul>
<li>More license models - supports currently Offline Device-locked license and Floating license. More options available later.</li>
<li>All current and future license options/features are supported.</li>
<li>Full forward and backward compatibility for licenses created for other SW version.</li>
<li>License validation time is quite deterministic, typically instant. Time may vary with Online licensing models (Floating license).</li>
<li>Possibility for time limited trial licenses.</li>
<li>Possibility for more tailored licensing models and fingerprinting methods in the future.</li>
</ul>
<h3 id="activation-mode"><a class="header" href="#activation-mode">Activation mode</a></h3>
<p>License models in Regular license concept are called <code>activation modes</code>. The two Regular license activation modes at the moment are:</p>
<ul>
<li><strong>DeviceLocked</strong> - Uses Offline Device-locked license. Device-locked license uses target fingerprinting and locks the license to the target.</li>
<li><strong>Floating</strong> - Floating license is not locked to any specific target/HW. When a licensed software is started it leases a license from the License Server. The License Server allocates a license for that instance (or target) if there is a free license available. Licensed software needs to renew the lease periodically, and finally free the license when it shuts down. This method limits the number of instances that can run at the same time. All licensed software instances need an Internet connection for communicating with the License Server at run time.</li>
</ul>
<h3 id="files"><a class="header" href="#files">Files</a></h3>
<p>Files related to the use of a Regular license are described in the table below.</p>
<table><thead><tr><th>File</th><th>Content and scope</th><th>Offline<br>activation</th><th>Online<br>activation</th></tr></thead><tbody>
<tr><td>License file<br><strong>LicenseDetails.json</strong></td><td>Provides information to Navitrol for license activation and validation.<br>Required for all licensing models. Format and content shown below.</td><td>X</td><td>X</td></tr>
<tr><td>Offline activation request file<br><strong>LicenseOfflineRequest.gz</strong></td><td>Created by Navitrol on user request.<br>Content used by License Server for offline activation.</td><td>X</td><td>-</td></tr>
<tr><td>Offline activation response file<br><strong>LicenseOfflineResponse.dat</strong></td><td>Created by the License Server when making offline activation on the server side.<br>Navitrol uses this file as input for offline activation at target.</td><td>X</td><td>-</td></tr>
</tbody></table>
<p><strong>NOTE:</strong> All of these files are automatically generated and should never be modified manually. Regular licensing has cross-checks for all the relevant information built-in. If information in these files is modified, license activation or validation fails.</p>
<h4 id="license-file-licensedetailsjson"><a class="header" href="#license-file-licensedetailsjson">License file LicenseDetails.json</a></h4>
<p>A license file in a target system is mandatory for Regular licensing to work. License file is required for all licensing models. This JSON formatted file provides information for license activation and validation, most important ones being the <code>LicenseKey</code> and <code>ActivationMode</code>.</p>
<p>Mandatory license file information from Navitrol point of view include:</p>
<ul>
<li><strong>Product</strong> – Shall be <code>NavigationSoftware</code>. Anything else results in license file rejection as license is not meant to be used with Navitrol.</li>
<li><strong>LicenseKey</strong> – Created by the License Server. License key is used for license activation and validation.</li>
<li><strong>ActivationMode</strong> – Activation mode to be used by Navitrol (shall be one of the predefined values: <code>DeviceLocked</code>, <code>Floating</code>).</li>
</ul>
<p>An example license file content having mandatory information only is shown below.</p>
<pre><code class="language-json">  {
    &quot;LicenseKey&quot;: &quot;3A432A-E840E3-42F7AB-A35E2E-6D0317-F69792&quot;,
    &quot;ActivationMode&quot; : &quot;DeviceLocked&quot;,
    &quot;Product&quot;: &quot;NavigationSoftware&quot;
  }
</code></pre>
<p>A license file may contain additional information as well. Optional license file information includes:</p>
<ul>
<li><strong>FileGenerationDate</strong> - License generation date is typically included, but not regarded as mandatory information by Navitrol.</li>
<li>Custom fingerprinting - License can be defined by the License Server to use a specific custom fingerprinting method. In such a case, details are defined in a license file.</li>
</ul>
<h3 id="how-to-set-up-a-regular-license"><a class="header" href="#how-to-set-up-a-regular-license">How to set up a Regular license</a></h3>
<p>Steps to set up a Regular license are:</p>
<ul>
<li>Order a license from Navitec Systems. Process starts with creating the license in the License Server. Basic information needed in this phase are:
<ul>
<li>License options that shall be included in the license, including machine kinematics.</li>
<li>Target system - Navitrol running on a bare HW, a Virtual machine or a Container. <strong>NOTE</strong>: Navitec Systems may limit the target options available. Trying to activate license in a VM/Container if that is not allowed, results in an error.</li>
<li>Other things to decide at this phase are
<ul>
<li>Fingerprinting method - Valid for Node-Locked licenses only.</li>
<li>Validity 
<ul>
<li>Time - By default a license is perpetual, like in Legacy licensing. There is a possibility to define a limited Validity time.</li>
<li>SW versions - By default a license is not version limited. License can be limited up to a specific SW release version only. </li>
</ul>
</li>
<li>Possible trial license and trial period </li>
<li>+ more</li>
</ul>
</li>
</ul>
</li>
<li>When detailed license information is known, license can be created in the License Server.</li>
<li>License Server provides the license file <code>LicenseDetails.json</code>.</li>
<li>License file <code>LicenseDetails.json</code> is copied to target system sub-folder <code>./license</code> (/home/navitec/license).</li>
<li>After that license needs to be activated and validated. Steps required for activation depend on a license activation mode used. See <a href="Introduction/Licensing/Licensing-en.html#license-activation">License activation</a> and <a href="Introduction/Licensing/Licensing-en.html#license-validation">License validation</a> below for details.</li>
</ul>
<h3 id="license-activation"><a class="header" href="#license-activation">License activation</a></h3>
<p>Unlike in the Legacy licensing method, each license must be activated before being valid. License activation always involves the License Server which keeps track of created and activated licenses.</p>
<p>Prerequisite is the license file <code>LicenseDetails.json</code> existing in target system sub-folder <code>./license</code> (/home/navitec/license).</p>
<h4 id="activating-offline-device-locked-license"><a class="header" href="#activating-offline-device-locked-license">Activating Offline Device-locked license</a></h4>
<p>Offline Device-locked license activation is clearly separated from validation. Creating offline request file and offline activation are done only on user request using commands shown below. Running these commands requires root privileges. </p>
<p>Steps are:</p>
<ol>
<li>
<p>Generate offline request file <code>LicenseOfflineRequest.gz</code> file on sub-folder <code>./license</code> by issuing the command </p>
<pre><code>root@navitec:~$ ./Navitrol licreq
</code></pre>
<p>On successful command one should see on the console:</p>
<pre><code>Packed license request files to: &quot;./license/LicenseOfflineRequest.gz&quot;
DeviceLocked license request file creation SUCCESSFUL
</code></pre>
</li>
<li>
<p>Provide the <code>LicenseOfflineRequest.gz</code> file generated in target HW for license generation.</p>
</li>
<li>
<p>Offline response file <code>LicenseOfflineResponse.dat</code> is generated on the License Server using offline request file as input. </p>
</li>
<li>
<p>Offline response file is transferred/copied to Navitrol <code>./license</code> folder.</p>
</li>
<li>
<p>Activate license in Navitrol by issuing command </p>
<pre><code>root@navitec:~$ ./Navitrol licact
</code></pre>
<p>This command uses the license file and the offline response file as input. On successful activation one should see on the console:</p>
<pre><code>DeviceLocked license activation SUCCESSFUL
</code></pre>
</li>
</ol>
<h4 id="activating-floating-license"><a class="header" href="#activating-floating-license">Activating Floating license</a></h4>
<p>Floating license activation (license leasing) is performed automatically at each startup. After successful activation/lease, Navitrol periodically validates and renews the license.</p>
<h4 id="license-deactivation"><a class="header" href="#license-deactivation">License deactivation</a></h4>
<p>Floating licenses are automatically deactivated by Navitrol at each exit/shut-down, which frees the leased license for someone else to lease. If Navitrol for any reason fails to do that (like communication not working), license re-activation or leasing is not possible until lease time is over. When lease time expires without client sync to server, license lease will be freed by the License Server. Server sync interval is defined in the license by the License Server.</p>
<p>Other than Floating licenses are never deactivated by Navitrol.</p>
<h3 id="license-validation"><a class="header" href="#license-validation">License validation</a></h3>
<p>Successful license activation already means that license itself is valid at that time. At run-time Navitrol periodically validates the license and in case of Floating license renews the license. License validation may fail at any time for example if some license option is used without having such an option included in the license. Floating license validation may fail also if connection to License Server is lost for too long time.</p>
<p>There are more possibilities why validation can fail, like license expiry in case of time limited license.</p>
<h4 id="validity---time"><a class="header" href="#validity---time">Validity - time</a></h4>
<p>By default licenses are created perpetual, i.e. for unlimited time. If a license has a limited Validity time, that is checked by Navitrol at run-time. Navitrol logs validity information and expiration time in text log, and optionally raises a warning WARNING_LICENSE_EXPIRATION when a time limited license is about to expire soon. This warning period is defined with a parameter <strong>license_warning_period_days</strong>. Warning can be disabled by setting this parameter to 0.</p>
<h4 id="validity---sw-version"><a class="header" href="#validity---sw-version">Validity - SW version</a></h4>
<p>If a license has SW release version limitation, that is checked by Navitrol at start-up. Navitrol uses two digit version number (MAJOR.MINOR) to check this, which means that hotfixes are always allowed even if SW version limitation is defined.</p>
<h3 id="system-time"><a class="header" href="#system-time">System time</a></h3>
<p>System time being wrong or being tampered with, may result in license activation or validation to fail.</p>
<p>Navitrol checks and monitors also system time on target to</p>
<ul>
<li>be close enough the network time (Online).</li>
<li>not being tampered with, like time moved backwards.</li>
</ul>
<p>Time is allowed to move backwards only a limited amount to allow time changes related to day-time saving. If substantially larger time adjustments are detected, this is indicated as an error when activating or validating the license.</p>
<h3 id="trial-license"><a class="header" href="#trial-license">Trial license</a></h3>
<p>Trial licenses can be created for testing purposes. </p>
<p><strong>NOTE:</strong> Navitrol requires that each Trial license is time limited. If a Validity time is not defined (unlimited) in a Trial license, Navitrol raises an error ERROR_LICENSE_CONTENT.</p>
<h3 id="parameter-summary"><a class="header" href="#parameter-summary">Parameter summary</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>license_server_addr</td><td>String</td><td>&quot;&quot;</td><td>License Server URL used for Floating license - ask for correct setting from Navitec Systems support</td></tr>
<tr><td>license_warning_period_days</td><td>Int</td><td>0</td><td>Defines pre-warning time for time limited license expiry</td></tr>
<tr><td>ads_enabled</td><td>Int</td><td>0</td><td>Enables ADS feature -  see note below</td></tr>
<tr><td>ads_server_ip</td><td>String</td><td>0</td><td>IP adress for remote ADS Server -  see note below</td></tr>
<tr><td>ads_server_netid</td><td>String</td><td>0</td><td>NetID for remote ADS server -  see note below</td></tr>
</tbody></table>
<p><strong>NOTE: ads_*</strong> parameters are relevant from licensing point of view only if Navitrol is run in Beckhoff IPC. Contact Navitec support for detailed information.</p>
<hr />
<h2 id="legacy-license"><a class="header" href="#legacy-license">Legacy license</a></h2>
<p>Legacy licensing method is supported for now for backwards compatibility. Missing license will result in immediate ERROR_NO_LICENSE_CODE, so there is no more option to drive without a license.</p>
<p>Legacy licensing has some practical limitations and short-comings from user point of view, like:</p>
<ul>
<li>Limited license models - supports only Offline Device-locked license.</li>
<li>Limited amount of license options/features supported. Any recently created or future license options are not supported.</li>
<li>Limited forward compatibility for licenses created for other SW version.</li>
<li>License validation time can be rather long - in the worst case validation can take minutes.</li>
<li>No trial licenses.</li>
</ul>
<h3 id="how-to-set-up-a-legacy-license"><a class="header" href="#how-to-set-up-a-legacy-license">How to set up a Legacy license</a></h3>
<p>Steps to set up a Legacy license are:</p>
<ul>
<li>After Navitrol has run once successfully, a <code>license.txt</code> file is generated in folder <code>/home/navitec</code>.</li>
<li>When ordering a license, one needs to define all the license options shall be included in the license.</li>
<li>Provide the <code>license.txt</code> file generated in target HW for license generation.</li>
<li>License is generated by the License Server and license is provided as a <code>licensekey.txt</code> file.</li>
<li>File <code>licensekey.txt</code> is copied to Navitrol run folder (/home/navitec).</li>
<li>License is validated each time Navitrol is restarted.</li>
</ul>
<hr />
<h2 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h2>
<h3 id="logging-and-console-output"><a class="header" href="#logging-and-console-output">Logging and console output</a></h3>
<p>All details related to logging and console output are subject to change. The basic principles will not however change.</p>
<h4 id="text-log-license-section"><a class="header" href="#text-log-license-section">Text log license section</a></h4>
<p>Licensing method, license options enabled, and other relevant license information are logged in the <code>license section</code> beginning of each text log file. </p>
<p>Invalid license</p>
<pre><code>REGULAR licensing used - License model DeviceLocked
Normal Fingerprint
LicenseKey 3A432A-E830E3-42FFAB-A35E2E-6D0317-F69792
License validation error: The release version is not allowed.
No valid license or license not validated
</code></pre>
<p>Valid license without options and limitations</p>
<pre><code>REGULAR licensing used - License model Floating
LicenseKey 258487-493DB4-4E0797-0896F5-4BA43D-988381
License is not time limited
License is not limited by SW version
Valid license with no options in use
</code></pre>
<p>Valid license with options and limitations</p>
<pre><code>REGULAR licensing used - License model Floating
LicenseKey 258487-493DB4-4E0797-0896F5-4BA43D-988381
License Expiry 2024.10.30
License is limited to SW version 6.58
Valid license with options in use
License for option &quot;WarehouseRacking&quot; in use
License for option &quot;DrivingDiffSteer&quot; in use
</code></pre>
<h4 id="logging-prefix"><a class="header" href="#logging-prefix">Logging prefix</a></h4>
<p>License related logging in text logs has a prefix &quot;LIC:&quot;, making search for license related log lines easier.</p>
<pre><code>0.7046 [-1:6]  LIC: License file read OK (status 1), KEY &quot;3A432A-E830E3-42FFAB-A35E2E-6D0317-F69792&quot;
0.7050 [-1:2]  LIC: SetProductData - Success
0.7056 [-1:2]  LIC: SetProductId - Success
0.7061 [-1:2]  LIC: SetLicenseKey - Success
0.7061 [-1:2]  LIC: SetReleaseVersion - Success
0.7340 [-1:2]  LIC: IsLicenseGenuine - The release version is not allowed.
0.7340 [-1:6]  LIC: License is not valid or not activated
</code></pre>
<p>This prefix is not used on console commands, like <code>./Navitrol licact</code>. </p>
<pre><code>0.1363 [-9:2]  SetProductData - Success
0.1369 [-9:2]  SetProductId - Success
0.1376 [-9:2]  SetLicenseKey - Success
0.1376 [-9:2]  SetReleaseVersion - Success
</code></pre>
<h4 id="license-method"><a class="header" href="#license-method">License method</a></h4>
<p>License method used is logged in <code>license section</code> of text logs:</p>
<p>In case of Regular licensing being used this <code>license section</code> starts with:</p>
<pre><code>REGULAR licensing used (LibVer 3.21.2) - Activation mode DeviceLocked
Normal Fingerprint
LicenseKey 0744E5-925FE1-40BCAB-0D53DE-1207EB-614120
</code></pre>
<p>In case of Legacy licensing being used this <code>license section</code> starts with:</p>
<pre><code>LEGACY licensing used
License id,key 4091113304772258577,13541695821371515033
</code></pre>
<h4 id="enabled-license-options"><a class="header" href="#enabled-license-options">Enabled license options</a></h4>
<p>All enabled license options are logged in <code>license section</code> of text log files. All options are logged in same style, regardless whether they are tied to parameters or something else:</p>
<pre><code>LEGACY licensing used
License id,key 9439414948331747385,14605972011522150860
Valid license with options in use
License for option &quot;Dynamic Mapping Server&quot; in use
License for option &quot;Route Driver&quot; in use
License for option &quot;Precision Positioning&quot; in use
License for option &quot;Target Detection&quot; in use
License for option &quot;External Localization&quot; in use
License for option &quot;Obstacle Avoidance&quot; in use
License for option &quot;Warehouse Racking&quot; in use
License for option &quot;3D Object detection&quot; in use
</code></pre>
<h4 id="obsolete-license-options"><a class="header" href="#obsolete-license-options">Obsolete license options</a></h4>
<p>License may contain obsolete options. Those are logged as shown below, telling also which option should be used instead.</p>
<pre><code>LEGACY licensing used
License id,key 9439414948331747385,14605972011522150860
Valid license with options in use
License for obsolete option &quot;Line Following&quot; defined - license for option &quot;External Localization&quot; is expected instead
License for obsolete option &quot;External Localization - Docking&quot; defined - license for option &quot;External Localization&quot; is expected instead
</code></pre>
<h4 id="missing-license-options"><a class="header" href="#missing-license-options">Missing license options</a></h4>
<p>Logging/console output for missing license options based on parameters looks like</p>
<pre><code>1.4530 [-1:1]  LIC: Required License Option missing for StandAlone – parameter: I,route_driver_enabled
</code></pre>
<p>There is same kind of output for options not based on parameters</p>
<pre><code>0.7627 [-1:1]  LIC: Required License Option missing for DrivingDiffSteer
</code></pre>
<h3 id="errors-and-warnings"><a class="header" href="#errors-and-warnings">Errors and Warnings</a></h3>
<h4 id="351-warning_license_expiration"><a class="header" href="#351-warning_license_expiration">351 WARNING_LICENSE_EXPIRATION</a></h4>
<p>Time limited license is about to expire soon. Time period is defined with parameter <strong>license_warning_period_days</strong>. Warning can be disabled by setting this parameter to 0.</p>
<h4 id="106-error_no_license_code"><a class="header" href="#106-error_no_license_code">106 ERROR_NO_LICENSE_CODE</a></h4>
<p>No valid license or license not yet activated.</p>
<h4 id="217-error_license_option_missing"><a class="header" href="#217-error_license_option_missing">217 ERROR_LICENSE_OPTION_MISSING</a></h4>
<p>License doesn't include permission to use a feature that has been activated.</p>
<h4 id="228-error_license_file"><a class="header" href="#228-error_license_file">228 ERROR_LICENSE_FILE</a></h4>
<p>License file invalid - missing or conflicting data in license file. Typical reason is:</p>
<ul>
<li>License file is manually manipulated.</li>
</ul>
<h4 id="229-error_license_content"><a class="header" href="#229-error_license_content">229 ERROR_LICENSE_CONTENT</a></h4>
<p>License file information conflicts with the license content or license content is inconsistent. Possible reasons are:</p>
<ul>
<li>License file is manually manipulated.</li>
<li>Trial license defined without validity.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odometry-source"><a class="header" href="#odometry-source">Odometry Source</a></h1>
<p>Updated 15.03.2024</p>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<h3 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h3>
<p>Very fundamental functionality for Navitrol in all installations is positioning. Positioning is in most situations based on odometry data combined with other sensor data.</p>
<p>The interface for providing the odometry data is called odometry source. This same interface is assumed to be the primary control interface as well. It is quite typical that several Navitrol communication interfaces, such as CAN and Ethernet supervisor, are used at the same time. In all cases, one of the interfaces is selected to be the odometry source.</p>
<hr />
<h2 id="setup-1"><a class="header" href="#setup-1">Setup</a></h2>
<h3 id="configuring-odometry-source"><a class="header" href="#configuring-odometry-source">Configuring odometry source</a></h3>
<p>With most machine types (parameter <strong>machine_type_id</strong>) odometry source is selected automatically, and then related communication interface is also enabled automatically. Corresponding parameter values (<strong>odometry_source</strong> and specific &quot;bus_enabled&quot; parameter for corresponding interface) are in those cases ignored. Additional communication interfaces can be enabled as needed using parameters (see table below). </p>
<p>When using some specific machine types, such as <strong>machine_type_id</strong> 44xxxx (meaning 440000 - 449999), the odometry source must be explicitly defined using parameter <strong>odometry_source</strong>. Also in this case corresponding primary communication interface is enabled automatically. Any additional communication interfaces used must be enabled using corresponding parameters. </p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>odometry_source</td><td>Int</td><td>0</td><td>Odometry source (primary control interface)<br>0 = Undefined <br>1 = CAN <br>2 = Supervisor Ethernet<br>3 = EtherCAT <br>4 = Serial <br><br>Effective only for  <strong>machine_type_id</strong> 44xxxx.</td></tr>
<tr><td>can_enabled</td><td>Int</td><td>0</td><td>0 - CAN interface not enabled<br>1 - CAN interface enabled<br><br>Effective only if odometry source is not CAN</td></tr>
<tr><td>supervisor_eth_enabled</td><td>Int</td><td>0</td><td>0 - Supervisor Ethernet interface not enabled<br> 1 - Supervisor Ethernet interface enabled <br><br> Effective only if odometry source is not Supervisor Ethernet</td></tr>
<tr><td>ethercat_enabled</td><td>Int</td><td>0</td><td>0 - EtherCAT interface not enabled<br> 1 - EtherCAT interface enabled <br><br> Effective only if odometry source is not EtherCAT</td></tr>
</tbody></table>
<p><strong>NOTE:</strong> There is no specific parameter to enable serial interface. Serial interface is always enabled automatically for any device using serial communication.</p>
<h3 id="machine-types-and-odometry-source"><a class="header" href="#machine-types-and-odometry-source">Machine types and odometry source</a></h3>
<p>As already mentioned, with most machine types the odometry source is selected automatically. Machine type to use is always defined by Navitec Systems, and set in parameter <strong>machine_type_id</strong>.</p>
<p>The following table shows odometry source for different machines types.</p>
<table><thead><tr><th>Machine Type Id</th><th>Odometry source</th></tr></thead><tbody>
<tr><td>10009</td><td>Serial</td></tr>
<tr><td>10012</td><td>CAN</td></tr>
<tr><td>10013 -10014</td><td>Serial</td></tr>
<tr><td>10016</td><td>CAN</td></tr>
<tr><td>10017 - 10021</td><td>Ethernet Supervisor</td></tr>
<tr><td>10022</td><td>CAN</td></tr>
<tr><td>10024 - 10025</td><td>Ethernet Supervisor</td></tr>
<tr><td>2xxxx</td><td>Ethernet Supervisor - Positioning only</td></tr>
<tr><td>30001</td><td>Proprietary</td></tr>
<tr><td>31001</td><td>Ethernet Supervisor</td></tr>
<tr><td>5xxxx - 7xxxx</td><td>Ethernet Supervisor - Positioning only</td></tr>
<tr><td>90001</td><td>Ethernet Supervisor - Positioning only</td></tr>
<tr><td>90002 - 90003</td><td>Ethernet Supervisor</td></tr>
<tr><td>11xxxx -13xxxx</td><td>CAN</td></tr>
<tr><td>14xxxx - 15xxxx</td><td>Ethernet Supervisor - Positioning only<br>150001 is the recommended generic positioning only machine type</td></tr>
<tr><td>160001 - 160003</td><td>Serial</td></tr>
<tr><td>160004</td><td>CAN</td></tr>
<tr><td>17xxxx - 18xxxx</td><td>CAN</td></tr>
<tr><td>190001</td><td>Serial</td></tr>
<tr><td>190002 - 190004</td><td>Ethernet Supervisor</td></tr>
<tr><td>20xxxx - 26xxxx</td><td>CAN</td></tr>
<tr><td>27xxxx</td><td>Ethernet Supervisor</td></tr>
<tr><td>28xxxx - 29xxxx</td><td>CAN</td></tr>
<tr><td>31xxxx</td><td>Ethernet Supervisor</td></tr>
<tr><td>32xxxx - 40xxxx</td><td>CAN</td></tr>
<tr><td>41xxxx</td><td>EtherCAT</td></tr>
<tr><td>42xxxx</td><td>CAN</td></tr>
<tr><td>43xxxx</td><td>Proprietary</td></tr>
<tr><td>44xxxx</td><td>Configured using parameter <strong>odometry_source</strong></td></tr>
<tr><td>45xxxx</td><td>CAN</td></tr>
</tbody></table>
<hr />
<h2 id="troubleshooting-2"><a class="header" href="#troubleshooting-2">Troubleshooting</a></h2>
<p>There are very few things that can go wrong with odometry source configuration, especially as it is in most cases automatically selected.</p>
<h3 id="errors-and-warnings-1"><a class="header" href="#errors-and-warnings-1">ERRORS AND WARNINGS</a></h3>
<h4 id="error_odometry_source"><a class="header" href="#error_odometry_source">ERROR_ODOMETRY_SOURCE</a></h4>
<p>Description: </p>
<ul>
<li>This error indicates that the odometry source is not defined preventing Navitrol from positioning.</li>
</ul>
<p>Possible error reason:</p>
<ul>
<li>Parameter <strong>odometry_source</strong> has not been properly defined.</li>
</ul>
<p>How to recover:</p>
<ul>
<li>If you are using one of the 44xxxx machine types, check that odometry source is defined using parameter <strong>odometry_source</strong>.</li>
<li>If you are not using one of the 44xxxx machine types, contact Navitec Systems support.</li>
</ul>
<h4 id="error_veh_inte_not_ready"><a class="header" href="#error_veh_inte_not_ready">ERROR_VEH_INTE_NOT_READY</a></h4>
<p>Description: </p>
<ul>
<li>This error indicates that Navitrol's primary vehicle interface is not operational preventing operation.</li>
</ul>
<p>Possible error reasons:</p>
<ul>
<li>Odometry source improperly defined.</li>
<li>Communication interface for odometry source not properly configured.</li>
<li>Communication interface for odometry source not properly connected.</li>
<li>Communication interface bus for odometry source not operational.</li>
</ul>
<p>How to recover:</p>
<ul>
<li>If you are using one of the 44xxxx machine types, check that right odometry source is defined using parameter <strong>odometry_source</strong>. </li>
<li>Check that all communication related parameters are properly defined, and all connections are ok.</li>
<li>Check that selected communication bus is operational.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="initial-calibration-guide"><a class="header" href="#initial-calibration-guide">Initial Calibration Guide</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="introduction-2"><a class="header" href="#introduction-2">Introduction</a></h2>
<p>Navitrol determines the position of the vehicle based on its two main data sources: odometry and scanner data. The odometry is used for the dead reckoning calculation which the scanner data then validate and correct. If these do not comply with the reality, the AGV might lose its position and/or drive very poorly. Thus, the calibration process is one of the most fundamental steps in the commissioning of an AGV and it is only possible to achieve good results if it is done properly.</p>
<p>The procedure can be divided into several steps as it ranges from adjusting scanner positions to tuning the control gains of advanced position control features.
To achieve the best results, it is recommended to follow the order given in this document.
Furthermore, since Navitrol supports several different kinematic types (see section 2.1), some sections might be redundant for the vehicle of interest.
Therefore, sections relevant to only some kinematic types are marked by their abbreviations.</p>
<h3 id="machine-types"><a class="header" href="#machine-types">Machine Types</a></h3>
<p>Navitrol supports a variety of different kinematic types. In this document, the following ones are covered:</p>
<ul>
<li>Differential drive (D)</li>
<li>Mecanum drive (M)</li>
<li>Omni drive (O)</li>
<li>Steer drive (S)</li>
<li>Differential sub-unit for Steer (DS) and Omni (DO)</li>
</ul>
<p>In addition to this, there are different communication alternatives and other options that can be tailored for the specific vehicle and since the control process varies a lot between the different combinations, it is important that Navitrol knows how to distinguish between them. This is defined by the so-called machine type ID and the associated machine type key in the Navitrol parameter file <em>params.txt</em>:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,machine_type_id</strong></td><td>ID of the machine type.</td></tr>
<tr><td><strong>U,machine_type_key</strong></td><td>Verification key corresponding to the machine type ID.</td></tr>
</tbody></table>
<p>The values for these parameters are provided by Navitec Systems.</p>
<h3 id="vehicle-coordinate-system"><a class="header" href="#vehicle-coordinate-system">Vehicle Coordinate System</a></h3>
<p>Each vehicle has its own internal coordinate system with its origin in the so-called navigation point. The system orientation in relation to the vehicle frame is defined such that the x-axis points towards the front of the vehicle and the y-axis towards the vehicle's left side, see Figure 1.</p>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1: Vehicle coordinate system.</p>
</blockquote>
<h2 id="initial-configurations"><a class="header" href="#initial-configurations">Initial Configurations</a></h2>
<p>Navitrol relies on measurements and configuration settings specified by the user when computing the dead reckoning and position corrections using scanner data. It is important that these are set precisely as even small offsets can cause large deviations in the position calculation and if the reader has access to the CAD model it is recommended to start from this.
All coordinates are given in relation to the vehicles internal coordinate system.</p>
<p>At this stage of the calibration process, it is recommended to keep the vehicle off the ground to minimize the risk of any accident.</p>
<h3 id="deactivate-features-disturbing-the-calibration"><a class="header" href="#deactivate-features-disturbing-the-calibration">Deactivate Features Disturbing The Calibration</a></h3>
<p>Some features of Navitrol should be disabled during the calibration process as they otherwise have a negative impact on the result:</p>
<ul>
<li>
<p>Disable sensor fusion by setting <strong>I,sf_use_sensor_fusion</strong> to zero.</p>
</li>
<li>
<p>Disable the automatic odometry correction by setting the following parameter to zero:</p>
<ul>
<li><strong>F,odo_err_est_alpha</strong></li>
</ul>
</li>
</ul>
<h3 id="control-interval"><a class="header" href="#control-interval">Control Interval</a></h3>
<p>The control interval specifies at what rate Navitrol should expect to receive the control messages. If Navitrol has a direct connection to the motor controller, then this would be the message time interval between Navitrol and the motor controller itself.
However, if Navitrol is connected to the motor controllers via a PLC/PC, then the control interval is defined between Navitrol and PLC/PC instead.</p>
<p>Set the specified interval and error ratios with the following parameters:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,control_interval_us</strong></td><td>Control message interval in microseconds.</td></tr>
<tr><td><strong>F,control_interval_error_ratio</strong></td><td>Defines how much the measured control interval can deviate from target (e.g. 1.1 means 10%).</td></tr>
<tr><td><strong>I,control_interval_max_stdev_us</strong></td><td>Defines how much the measured control interval standard deviation can be in microseconds.</td></tr>
</tbody></table>
<h3 id="vehicle-frame-dimensions"><a class="header" href="#vehicle-frame-dimensions">Vehicle Frame Dimensions</a></h3>
<p>Scanner points hitting objects within the vehicle frame needs to be filtered out to avoid their negative impact on the localization properties.
If the dimensions are set properly, one will see that Navitrol Monitor renders these points as gray:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,dim_front</strong></td><td>distance from the navigation point to the front of the vehicle along the x-axis.</td></tr>
<tr><td><strong>F,dim_rear</strong></td><td>distance from the navigation point to the rear of the vehicle along the x-axis.</td></tr>
<tr><td><strong>F,dim_left</strong></td><td>distance from the navigation point to the left side of the vehicle along the y-axis.</td></tr>
<tr><td><strong>F,dim_right</strong></td><td>distance from the navigation point to the left side of the vehicle along the y-axis.</td></tr>
</tbody></table>
<h3 id="localization-scanners"><a class="header" href="#localization-scanners">Localization Scanners</a></h3>
<p>Navitrol supports up to two separate localization scanners and their orientations and positions are defined by the following parameters in <em>params.txt</em>:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,scan_rear_x</strong></td><td>rear scanner x-coordinate.</td></tr>
<tr><td><strong>F,scan_rear_y</strong></td><td>rear scanner y-coordinate.</td></tr>
<tr><td><strong>F,scan_front_x</strong></td><td>front scanner x-coordinate.</td></tr>
<tr><td><strong>F,scan_front_y</strong></td><td>front scanner y-coordinate.</td></tr>
<tr><td><strong>I,scan_rear_upside_down</strong></td><td>1 if rear scanner is mounted upside down.</td></tr>
<tr><td><strong>I,scan_front_upside_down</strong></td><td>1 if front scanner is mounted upside down.</td></tr>
<tr><td><strong>F,scan_rear_sen_ang</strong></td><td>angular offset between the coordinate system of the rear scanner and the coordinate system of the vehicle.</td></tr>
<tr><td><strong>F,scan_front_sen_ang</strong></td><td>angular offset between the coordinate system of the front scanner and the coordinate system of the vehicle.</td></tr>
</tbody></table>
<p><strong>NOTE!</strong> Depending on how many scanners that are used for localization or target detection, some of these parameters might be redundant.
Navitrol Monitor can be used to visually estimate whether the values are roughly correct, for example by placing the vehicle next to straight wall and verifying that the scanner views are matching.</p>
<h2 id="vehicle-wheel-positions-and-configurations"><a class="header" href="#vehicle-wheel-positions-and-configurations">Vehicle Wheel Positions and Configurations</a></h2>
<p>The dead reckoning calculation uses the wheel positions and the encoder information to determine how the vehicle is moving. Depending on the kinematic type, different information is required. If not mentioned specifically, distance parameters should also include the sign according to the vehicle's coordinate system.</p>
<p><strong>Differential drive</strong></p>
<p>For the differential drive, the wheel positions are specified by a single parameter as they are symmetrical around the navigation point:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,wheel_track</strong></td><td>absolute distance between the driving wheels along the y-axis.</td></tr>
</tbody></table>
<p><strong>Mecanum drive</strong></p>
<p>In addition to the <strong>wheel_track</strong> parameter, mecanum vehicles also require information about the distance to the driving wheels along the x-axis:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,wheel_track</strong></td><td>absolute distance between the driving wheels along the y-axis.</td></tr>
<tr><td><strong>F,wheel_dist</strong></td><td>absolute distance between the driving wheels along the x-axis.</td></tr>
</tbody></table>
<p><strong>Omni drive</strong></p>
<p>Since Navitrol supports up to six individual omni wheels, most of the omni specific parameters are defined as arrays with index <strong>i = 0,1,...,5</strong>.
These indices may be defined arbitrary by the user but should start from zero and remain consistent between the parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,wheel_x[i]</strong></td><td>x-coordinate of the wheel with index <strong>i</strong>.</td></tr>
<tr><td><strong>F,wheel_y[i]</strong></td><td>y-coordinate of the wheel with index <strong>i</strong>.</td></tr>
<tr><td><strong>F,wheel_y_off[i]</strong></td><td>wheel offset from turning axle of the wheel with index <strong>i</strong> (y in vehicle coordinates when straight).</td></tr>
</tbody></table>
<p>The dead reckoning is computed based on encoder data from two individual wheels.
The wheels that are used for this are specified in the Navitrol parameter file with the parameter <strong>I,omni_deadrec_ref_axle[i]</strong>.
A general guideline is that the selected wheels should not be lined up parallel to either the x-axis or the y-axis and that the greater the distance between them the better.
An example of this can bee seen in Figure 2.</p>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2: Example of which combination of wheels that together are viable for dead reckoning. The wheels with the same color make a viable pair.</p>
</blockquote>
<p><strong>I,mot_ctrl_omni_speed_control_used[<strong>i</strong>]</strong> should be set to determine which wheels are used for speed control and finally <strong>I,maintain_omni_kinematics</strong> should be set to 1 if the motor controller is not able to handle rapid large changes in the reference value, otherwise it should be 0.</p>
<p><strong>Steer drive</strong></p>
<p>Steer driven vehicles require two parameters to specify the wheel configuration:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,wheel_dist</strong></td><td>distance from the navigation point to the center point of the driving wheel along the x-axis.</td></tr>
<tr><td><strong>F,wheel_off_center</strong></td><td>distance from the navigation point to the center point of the driving wheel along the y-axis.</td></tr>
</tbody></table>
<p><strong>Differential Sub-unit</strong></p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><em>Omni</em></td><td></td></tr>
<tr><td><strong>F,wheel_x[i]</strong></td><td>x-coordinate of the sub-unit center point with sub-unit index <strong>i</strong>.</td></tr>
<tr><td><strong>F,wheel_y[i]</strong></td><td>y-coordinate of the sub-unit center point with sub-unit index <strong>i</strong>.</td></tr>
<tr><td><em>Steer</em></td><td></td></tr>
<tr><td><strong>F,wheel_dist</strong></td><td>Distance between navigation point and sub-unit center point.</td></tr>
<tr><td><em>Common for both Omni and Steer</em></td><td></td></tr>
<tr><td><strong>F,sub_diff_wheel_track</strong></td><td>Distance between the centers of the wheels in differential steer-drive wheel unit.</td></tr>
</tbody></table>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image19.png" alt="" /></p>
<blockquote>
<p>w = <strong>sub_diff_wheel_track</strong> parameter.</p>
</blockquote>
<h3 id="wheel-control-source"><a class="header" href="#wheel-control-source">Wheel Control source</a></h3>
<p>The wheel control source depends on the motor controllers and interface being used (for example CAN, Ethercat or Ethernet Supervisor). Configure the parameters based on what control source/communication interface is utilized. The different wheel control source parameters can be found from the following documents:</p>
<ul>
<li>CAN and EtherCat wheel control source configurations : <a href="Introduction/InitialCalibrationGuide/../../AgvInterfaces/MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html#quick-start">Motor controllers common</a></li>
<li>Ethernet Supervisor wheel control source configurations : <a href="Introduction/InitialCalibrationGuide/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Communication specification between Navitrol and Ethernet supervisor</a></li>
</ul>
<h3 id="steer-encoders-o-s-do-ds"><a class="header" href="#steer-encoders-o-s-do-ds">Steer Encoders (O, S, DO, DS)</a></h3>
<p>Two of the kinematic types, omni drive and steer drive (+ differential sub-units), rely on an absolute encoder to determine the orientation of their wheels. Due to variations among the different models, Navitrol requires the user to define the specifications in <em>params.txt</em>. Among other things, this includes defining the resolution of the encoder.</p>
<p><strong>Omni drive</strong></p>
<p>The parameters that should be defined/calibrated if Navitrol receives the raw data directly from the encode are:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>U,omni_steer_enc_pulses_overflow[i]</strong></td><td>should be set to the decimal value of the total resolution. This means that if the total resolution is given by e.g. 25 bits, then the parameter should be set to 33.554.431.</td></tr>
<tr><td><strong>U,omni_steer_enc_pulses_per_rev[i]</strong></td><td>should be set to the amount of pulses per wheel revolution of the encoder. A possible gear ratio must be considered.</td></tr>
<tr><td><strong>U,omni_steer_enc_zero[i]</strong></td><td>should be set to the pulse count that corresponds to the zero angle (wheel facing forward).<br>This needs to be calibrated after the mounting of the encoder.</td></tr>
<tr><td><strong>I,omni_enc_steer_node_id[i]</strong></td><td>is the CANOpen id of the steer encoder.</td></tr>
<tr><td><strong>I,can_steer_enc_model</strong></td><td>should be set to either<br>0 = generic (no config)<br>1 = Leine&amp;Linde (RSA608)<br>2 = Sick (AHS/AHM36)</td></tr>
</tbody></table>
<p>The only parameter that must be tuned manually is <strong>omni_steer_enc_zero</strong> since the rest of the parameters are not dependent on the mounting. At this stage, estimate the zero level by physically setting the steer wheel as straight as possible and read the pulse count from terminal with the command:
<code>.\\Navitrol dumpl 0 &quot;CanAbsEncoderParseRxMsg RPDO1 node&quot;</code>
or 
<code>.\\Navitrol dumpl 0 &quot;CanAbsEncoderParseRxMsg RPDO2 node&quot;</code> depending on the encoder model.</p>
<p>If EtherCAT is used as a control interface, check the encoder parameters and command for tuning encoder zero from <a href="Introduction/InitialCalibrationGuide/../../AgvInterfaces/Encoders/EthercatEncoders/EthercatEncoders-en.html">Ethercat encoder</a> document.</p>
<p>When Navitrol is not receiving raw encoder data directly from absolute encoder, then it is possible to calibrate the zero angle by adjusting the angular offset with the parameter <strong>F,omni_steer_ang_offset_deg[i]</strong> [deg].</p>
<p><strong>Steer drive:</strong></p>
<p>The parameters that should be defined/calibrated if Navitrol receives the raw data directly from the encode are:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>U,steer_enc_pulses_overflow</strong></td><td>should be set to the decimal value of the total resolution. This means that if the total resolution is given by e.g. 25 bits, then the parameter should be set to 33.554.431.</td></tr>
<tr><td><strong>I,steer_enc_pulses_per_rev</strong></td><td>should be set to the amount of pulses per wheel revolution of the encoder. An possible gear ratio must be considered.</td></tr>
<tr><td><strong>I,can_steer_enc_zero</strong></td><td>should be set to the pulse count that corresponds to angle 0 (wheel facing forward). This needs to be calibrated after the mounting of the encoder.</td></tr>
<tr><td><strong>I,can_enc_steer_node_id</strong></td><td>Is the CANOpen id of the steer encoder.</td></tr>
<tr><td><strong>I,can_steer_enc_model</strong></td><td>Should be set to either<br>0 = generic (no config)<br>1 = Leine&amp;Linde (RSA608)<br>2 = Sick (AHS/AHM36)</td></tr>
</tbody></table>
<p>The only parameter that must be tuned manually is <strong>can_steer_enc_zero</strong> since the rest of the parameters are not dependent on the mounting.
At this stage, estimate the zero level by physically setting the steer wheel as straight as possible and read the pulse count from terminal with the command:
<code>.\Navitrol dumpl 0 &quot;CanAbsEncoderParseRxMsg RPDO1 node&quot;</code>
or 
<code>.\Navitrol dumpl 0 &quot;CanAbsEncoderParseRxMsg RPDO2 node&quot;</code> depending on the encoder model.</p>
<p>When Navitrol is not receiving raw encoder data directly from a CAN absolute encoder, then it is possible to calibrate the zero angle by adjusting the angular offset with the parameter <strong>F,mot_ctrl_steer_ang_offset_deg</strong> [deg].</p>
<h3 id="odometry-scale"><a class="header" href="#odometry-scale">Odometry Scale</a></h3>
<p>Since Navitrol often receives odometry information expressed in angular velocities or in encoder pulses, it is necessary to convert these values internally to something that might be used for the dead reckoning calculations.
How this conversion is done depends on the source of the odometry.</p>
<h4 id="velocity-calculated-from-encoder-pulses"><a class="header" href="#velocity-calculated-from-encoder-pulses">Velocity Calculated from Encoder Pulses</a></h4>
<p>If the odometry is read from an incremental encoder or through the Supervisor interface, the conversion rate from a single pulse to meters needs to be defined. The scaling factor is defined by:</p>
<p>\( odometry\ scale = \frac{\pi\ \ *(\ Wheel\ diameter\ \lbrack m\rbrack)}{(Pulses\ per\ revolution)\ *(Gear\ ratio)} \)</p>
<p>It is set by the Navitrol parameter <strong>F,mot_ctrl_drive_dist_scale</strong> for all kinematic types except for differential drive which uses <strong>F,mot_ctrl_left_dist_scale</strong> and
<strong>F,mot_ctrl_right_dist_scale</strong> for the left and right wheel respectively.</p>
<h4 id="velocity-calculated-from-motor-rpm"><a class="header" href="#velocity-calculated-from-motor-rpm">Velocity Calculated from Motor RPM</a></h4>
<p>If the odometry is calculated from an RPM value stated by the motor controller, then the scaling factor is defined by:</p>
<p>\( odometry\ scale = \frac{\pi\ \ *(\ Wheel\ diameter\ \lbrack m\rbrack)}{60 *(Gear\ ratio)} \)</p>
<p>It is set by the Navitrol parameter <strong>mot_ctrl_drive_rpm_to_m_per_s</strong>.</p>
<h3 id="wheel-spinning-and-steering-direction"><a class="header" href="#wheel-spinning-and-steering-direction">Wheel Spinning and Steering Direction</a></h3>
<p>Depending on how the mechanical parts have been mounted it might be necessary to invert the input and/or output speed such that the sign of the calculated velocity is correct. The verification is commonly done using the keyboard control of Navitrol Monitor.</p>
<p>The Navitrol parameters that regulate the sign of the input and output depends on the machine type of the vehicle, although the idea is the same:</p>
<ul>
<li>
<p>If the wheels physically spin in the opposite direction of the reference, then the output should be inverted.</p>
</li>
<li>
<p>If the wheel spinning direction in Navitrol monitor is incorrect, then the input should be inverted (see Figure 3).</p>
</li>
</ul>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image5.png" alt="" />
<img src="Introduction/InitialCalibrationGuide/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 3: The wheel spinning direction is visualized by the wheel arrows in Navitrol Monitor. Green corresponds to forward/positive while red corresponds to reverse/negative.</p>
</blockquote>
<p>Additionally, for machine types with steering wheels, one should also verify the steering direction of the wheels.</p>
<p><strong>Differential drive</strong></p>
<ul>
<li>
<p><strong>I,mot_ctrl_left_inv_out</strong> = 1 to invert output for the left motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_right_inv_out</strong> = 1 to invert output for the right motor.</p>
</li>
<li>
<p>Change the sign of <strong>F,mot_ctrl_left_dist_scale</strong> to invert the input.</p>
</li>
<li>
<p>Change the sign of <strong>F,mot_ctrl_right_dist_scale</strong> to invert the input.</p>
</li>
</ul>
<p><strong>Mecanum drive</strong></p>
<ul>
<li>
<p><strong>I,mot_ctrl_mecanum_inv_output[i]</strong> = 1 to invert output for the motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_mecanum_inv_input[i]</strong> = 1 to invert input for the motor.</p>
</li>
</ul>
<p><strong>Omni drive</strong></p>
<ul>
<li>
<p><strong>I,mot_ctrl_omni_speed_inv_output[i]</strong> = 1 to invert the output for the drive motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_omni_speed_inv_input[i]</strong> = 1 to invert the input for the drive motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_omni_steer_inv_output[i]</strong> = 1 to invert the output for the steer motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_omni_steer_inv_input[i]</strong> = 1 to invert the input for the steer motor.</p>
</li>
</ul>
<p><strong>Steer drive</strong></p>
<ul>
<li>
<p><strong>I,mot_ctrl_wheel_v_inv_out</strong> = 1 to invert the output for the drive motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_steer_v_inv_out</strong> = 1 to invert the output for the steer motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_steer_v_inv_in</strong> = 1 to invert the input for the steer motor.</p>
</li>
</ul>
<p><strong>Differential Sub-units</strong></p>
<p><em>Do not use Omni or Steer inversion parameters with differential sub-units.</em></p>
<p>Navitrol Monitor shows normally the main kinematic wheels (Omni or Steer), but the sub-unit wheels can be shown from the following setting:</p>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image17.png" alt="" /></p>
<blockquote>
<p>Show sub-unit wheels on Navitrol Monitor.</p>
</blockquote>
<p>Easy way to check omni sub-units driving directions is to first enable only one sub-unit by setting the <strong>omni_steer_nbr</strong> parameter to 1 and check that both right and left spins to correct directions in real and in Navitrol Monitor. Then increasing the <strong>omni_steer_nbr</strong> by one and checking the next sub-unit and so on until all sub-units are correct.</p>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/sub_unit_one_omni_wheel.png" alt="" /> <img src="Introduction/InitialCalibrationGuide/./media-en/sub_unit_one_omni_wheel2.png" alt="" /> </p>
<blockquote>
<p>Showing Omni wheel 0 index as normal wheel (left figure) and as sub-unit (right figure). Wheels spinning forward.</p>
</blockquote>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/sub_unit_two_omni_wheels.png" alt="" /> <img src="Introduction/InitialCalibrationGuide/./media-en/sub_unit_two_omni_wheels2.png" alt="" /></p>
<blockquote>
<p>Showing Omni wheels 0 and 1 indices as normal wheels (left figure) and as sub-units (right figure). Wheels spinning forward.</p>
</blockquote>
<p>i = index of the wheel. For Steer drive, i is always 0. For Omni Drive, i is the omni wheel index.</p>
<ul>
<li>
<p><strong>I,mot_ctrl_diffunit_left_inv_output[i], =</strong> 1 to invert output for the left motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_diffunit_right_inv_output[i], =</strong> 1 to invert output for the right motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_diffunit_left_inv_input[i], =</strong> 1 to invert input for the left motor.</p>
</li>
<li>
<p><strong>I,mot_ctrl_diffunit_right_inv_input[i], =</strong> 1 to invert input for the right motor.</p>
</li>
</ul>
<p>After all differential sub-units have been configured, open <a href="Introduction/InitialCalibrationGuide/../../AgvInterfaces/MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html#motor-controller-test-form---differential-unit">Motor controller test form</a> from NavitrolMonitor. From the test form it is possible to give reference angle and speed for each individual sub-unit. Test that all the sub-units are turning correctly and spinning in the right direction. </p>
<h2 id="velocity-and-steering-controller-calibration"><a class="header" href="#velocity-and-steering-controller-calibration">Velocity and Steering Controller Calibration</a></h2>
<p>Sections marked with <strong>PID only</strong> refer to a case where Navitrol directly controls the output of the motor and are not necessary if Navitrol is just reporting target velocity.
From this point forwards it is necessary to have the vehicle on the ground such that it can freely drive around.</p>
<h3 id="calibrate-wheel-velocity-control-pid-only"><a class="header" href="#calibrate-wheel-velocity-control-pid-only">Calibrate Wheel Velocity Control (PID only)</a></h3>
<p>Even though the parameters that define the properties of the wheel velocity control vary between the different kinematic types, the process for tuning them is the same:</p>
<ul>
<li>
<p>Set the initial values for the wheel velocity control parameters to zero.</p>
</li>
<li>
<p>Give a drive command either forward or reverse from Navitrol Monitor to generate a reference step.</p>
</li>
<li>
<p>Increase the proportional gain stepwise while monitoring how the measured velocity is reaching the target velocity in the control chart for the relevant kinematic type. Repeat until the measured speed starts to oscillate.</p>
</li>
<li>
<p>Increase the derivative gain until the overshoot of the measured speed is controlled to less than 5% of the target.</p>
</li>
<li>
<p>Repeat the two former steps until the fastest rise time with less than 10% overshoot is reached.</p>
</li>
</ul>
<p><strong>Differential drive (D, DS)</strong></p>
<p>The proportional gain is adjusted by Navitrol parameters <strong>F,mot_ctrl_left_p</strong> and <strong>F,mot_ctrl_right_p</strong> while the derivative gain is adjusted by <strong>F,mot_ctrl_left_d</strong> and <strong>F,mot_ctrl_right_d</strong>. The control chart relevant for this part of the calibration can be found in Navitrol Monitor under <em>Navitrol Monitor Charts Differential Drive Motors Drive Motor Speed Control</em>.</p>
<p><strong>Mecanum drive</strong></p>
<p>For mecanum drives, the wheels are indexed by <strong>i = 0,...,3</strong> where 0 = FL, 1 = FR, 2 = RL and 3 = RR. The Navitrol parameters for the proportional and derivative gains are <strong>F,mot_ctrl_mecanum_p[i]</strong> and <strong>F,mot_ctrl_mecanum_d[i]</strong> respectively. The control chart relevant for this part of the calibration can be found in Navitrol Monitor under <em>Navitrol Monitor Charts Mecanum Drive Motors Speed Control)</em>.</p>
<p><strong>Omni drive (O, DO)</strong></p>
<p>The Navitrol parameters for the proportional and derivative gains are <strong>F, mot_ctrl_omni_speed_p[i]</strong> and <strong>F, mot_ctrl_omni_speed_d[i]</strong> respectively. The control chart relevant for this part of the calibration can be found in Navitrol Monitor under <em>Navitrol Monitor Charts Omni Drive Motors PD Control</em>**.**</p>
<p><strong>Steer drive</strong></p>
<p>The Navitrol parameters for the proportional and derivative gains for the forward direction are <strong>F,mot_ctrl_wheel_v_p</strong> and <strong>F,mot_ctrl_wheel_v_d</strong> respectively. The corresponding parameters for the reverse direction are <strong>F,mot_ctrl_wheel_v_rev_p</strong> and <strong>F,mot_ctrl_wheel_v_rev_d</strong>, which often may be set to the same values as the forward gains. The control chart relevant for this part of the calibration can be found in Navitrol Monitor under <em>Navitrol Monitor Charts Steer Drive Motors Drive Motor Speed Control (steer)</em>.</p>
<h3 id="calibrate-wheel-steer-control-pid-only-o-s-do-ds"><a class="header" href="#calibrate-wheel-steer-control-pid-only-o-s-do-ds">Calibrate Wheel Steer Control (PID only, O, S, DO, DS)</a></h3>
<p>Just as for the wheel velocity controller, the parameters that needs to be configured for the wheel steer controller differ between the kinematic types although the process of calibrating them is the same.
The control gains are tuned in a similar manner as previously, however now there is also an integral part to take into consideration:</p>
<ul>
<li>
<p>Set the initial values for the wheel steer control parameters to zero.</p>
</li>
<li>
<p>Give a drive reference with curvature from Navitrol Monitor to generate a steering reference value.</p>
</li>
<li>
<p>Increase the proportional gain stepwise while monitoring how the measured angle is reaching the target angle in the control chart for the relevant kinematic type. Repeat until the measured angle shows stable oscillations.</p>
</li>
<li>
<p>Increase the derivative gain in small steps until the system does no longer oscillate.</p>
</li>
<li>
<p>Repeat the two former steps until the system is responsive enough without having oscillations.</p>
</li>
<li>
<p>Adjust the integral gain to minimize the static error while keeping the overshoot and oscillations low.</p>
</li>
</ul>
<p><strong>Omni drive</strong></p>
<p>The Navitrol parameters for the proportional, derivative and integral gains are <strong>F,mot_ctrl_omni_steer_p[i],</strong> <strong>F,mot_ctrl_omni_steer_d[i]</strong> and <strong>F,mot_ctrl_omni_steer_i[i]</strong> respectively. The control chart relevant for this part of the calibration can be found in Navitrol Monitor under <em>Navitrol Monitor Charts Steer Drive Motors Steering</em>.</p>
<p>It is important to set the target steer angle to a reasonable and safe value during the calibration that is well within the steering limits.
This is enabled by the parameter <strong>I,omni_steer_limit_enable[i] = 1</strong> and defined by <strong>F,omni_steer_limit_CCW_angle_deg[i]</strong> in the counter clockwise direction and
<strong>F,omni_steer_limit_CW_angle_deg[i]</strong> in the clockwise direction.</p>
<p><strong>Steer drive</strong></p>
<p>The Navitrol parameters for the proportional, derivative and integral gains are <strong>F,mot_ctrl_steer_ang_p, F,mot_ctrl_steer_ang_d</strong> and <strong>F,mot_ctrl_steer_ang_i</strong> respectively. The control chart relevant for this part of the calibration can be found in Navitrol Monitor under <em>Navitrol Monitor Charts Steer Drive Motors Steering</em>.</p>
<p>It is important to set the target steer angle to a reasonable and safe value during the calibration that is well within the steering limits by adjusting <strong>F, mot_ctrl_max_steer_ang_deg</strong> and <strong>F,mot_ctrl_min_steer_ang_deg.</strong></p>
<h2 id="odometry-calibration"><a class="header" href="#odometry-calibration">Odometry Calibration</a></h2>
<p>A good odometry calibration is necessary to achieve good performance while driving autonomously as it is the foundation behind the dead reckoning calculations.</p>
<h3 id="steer-encoders-o-s-do-ds-1"><a class="header" href="#steer-encoders-o-s-do-ds-1">Steer Encoders (O, S, DO, DS)</a></h3>
<p>After the initial estimation of the steer encoder zero level has been done it is important to verify the performance and if it does not fulfill the requirements, one should continue to calibrate it until it does. The procedure can be divided into the following steps:</p>
<ul>
<li>
<p>Put the AGV on the ground, aligned with a reference line, and manually drive it straight for at least 10 meters using the Navitrol Monitor keyboard control. It is important that the wheels are at the zero position when starting the drive.</p>
</li>
<li>
<p>Measure the physical distance and angle deviation from the straight line.</p>
</li>
<li>
<p>If the distance deviation is larger than 5 centimeters and/or the heading deviation is larger than 1 degree, estimate which wheel is causing the offset and change the zero level values correspondingly. Repeat the previous steps.</p>
</li>
</ul>
<p>Additionally, for omni drive vehicles, when the deviation during straight driving falls within the tolerances, one should verify that the by Navitrol perceived driving is straight as well:</p>
<ul>
<li>
<p>Initialize the AGVs position such that it is aligned with the grid in the main window of Navitrol Monitor and make sure that there is no environment around it to avoid scanner corrections during the calibration process. The heading should be zero.</p>
</li>
<li>
<p>Give a reference straight forward.</p>
</li>
<li>
<p>If the drive path visualized by Monitor deviates from a straight physical path, abort the Monitor connection and use the playback function (bottom slider) to analyze the wheel orientation. If the wheel orientation is not close to zero it is possible to adjust the measured angles with the parameter <strong>F,omni_steer_ang_offset_deg[i]</strong>.</p>
</li>
</ul>
<h3 id="odometry-scale-1"><a class="header" href="#odometry-scale-1">Odometry Scale</a></h3>
<p>Assuming that the scanner positions and angles are adequately configured at this point, one can utilize Navitrol Monitor to fine tune the odometry scale. The procedure can be broken down to the following steps:</p>
<ul>
<li>
<p>In Navitrol Monitor, initialize the vehicle position far from any predefined environment such that there will be no match between the scanner points and the defined map. It is preferable to align the vehicle frame with the grid network in Navitrol Monitor.</p>
</li>
<li>
<p>In Navitrol Monitor, select the option to freeze the data.</p>
</li>
<li>
<p>Give a drive reference straight forward using the keyboard control of Navitrol Monitor. Keep driving for around ten meters or more if possible.</p>
</li>
<li>
<p>If the odometry is correct and the scanner angle is properly defined, then there should be no offset between the frozen scanner data and the live data. If there is a lengthwise offset, measure this using the Navitrol Monitor measurement tool and calculate the ratio between the driven distance and the measured offset.</p>
</li>
<li>
<p>Adjust the odometry scale parameter according to the calculated ratio.</p>
</li>
<li>
<p>Repeat the procedure until the lengthwise offset has been eliminated.</p>
</li>
</ul>
<h3 id="wheel-positions"><a class="header" href="#wheel-positions">Wheel Positions</a></h3>
<p>At the point when the odometry scale and possible steer encoders (O, S) have been properly tuned, the vehicle should be able to drive straight and correctly estimate the driven distance. However, to make precise and accurate turns it is important to also calibrate the positions of the wheels carefully. This is done by the following steps:</p>
<ul>
<li>
<p>In Navitrol Monitor, initialize the vehicle position far from any predefined environment such that there will be no matching environment. It is preferable to align the vehicle frame with the grid network in Navitrol Monitor.</p>
</li>
<li>
<p>In Navitrol Monitor, select the option to freeze the data.</p>
</li>
<li>
<p>Make a turn in slow speed with a small turn radius. If the mechanical construction of the vehicle allows for pivoting, then that is preferred.</p>
</li>
<li>
<p>Compare the frozen scanner points with the live view. If there is an angular offset, adjust the wheel position parameters accordingly.</p>
</li>
</ul>
<p>If the frozen scanner points deviate from the live view, it means that the dead reckoning estimation is not correct. Since the odometry scale has already been calibrated, as well as the steer encoders, the most probable cause for this is the wheel placement. For example, if the estimated pivoting angle is less than the actual pivoting angle for a
differential driven vehicle, it is likely that the length of the differential axle has been overestimated.</p>
<h2 id="scanner-calibration"><a class="header" href="#scanner-calibration">Scanner Calibration</a></h2>
<p>Before performing the Navitrol scanner calibration, it is vital for the navigation that the height and seen angle of laser scanners are first mechanically adjusted to be as level as possible in relation to the ground.</p>
<h3 id="scanner-positions-and-angles"><a class="header" href="#scanner-positions-and-angles">Scanner Positions and Angles</a></h3>
<h4 id="automatic-scanner-calibration"><a class="header" href="#automatic-scanner-calibration">Automatic Scanner Calibration</a></h4>
<p>If the AGV is using two laser scanners for localization it is of high importance that these are well-aligned with each other. If this is not done correctly, the environment that is used for navigation can be seen differently depending on the orientation of the vehicle and on which laser scanner sees the environment.</p>
<p>Navithor Tools implements a feature that automates this process by matching recorded measurements to each other. It is accessed from the top bar under <em>Tools --&gt; Calibrate Scanners</em> and requires a teach file with clearly seen environment to work. Preferably, the teach file should cover the AGV driving the path of a figure 8 three times in slow speed.</p>
<h4 id="manual-fine-tuning-of-scanner-angles"><a class="header" href="#manual-fine-tuning-of-scanner-angles">Manual Fine Tuning of Scanner Angles</a></h4>
<p>After the localization scanners have been aligned with each other they will still need to be aligned with the vehicle frame. This is important also for systems with a single scanner used for localization. If this is not done carefully there will be discrepancies between measured odometry and scanner data which in turn will have a negative impact on the performance of the vehicle, causing false position corrections. This discrepancy usually shows up as large lateral corrections and a good performance is only achieved after these have been reduced to fulfill the defined requirements.</p>
<p>The lateral corrections should be monitored under <em>Navitrol Monitor</em> --&gt; <em>Charts --&gt; Odometry Correction --&gt; Position Correction Averages</em> while the AGV is driving on a straight route. The target is to reach a lateral correction within [-0.1, 0.1] [cm/m]. If the average correction is not within the acceptable limits, manual tuning of the
scanner angles is required. This can be broken down into the following steps:</p>
<ul>
<li>
<p>Disable the rear scanner by setting <strong>I,scan_rear_front_selection = 2 and I,scan_rear_front_localization_selection = 2.</strong></p>
</li>
<li>
<p>Reload the parameter file from Navitrol Monitor under <em>Navitrol -&gt; Reload Parameter file</em>.</p>
</li>
<li>
<p>Record a teach file where only one scanner is activated and create a new project with clearly defined environment and a straight route of 3-10 meters, longer is better. Make sure that one of the lanes is set to reverse.</p>
</li>
<li>
<p>Raise the average position correction gain by increasing <strong>F,odo_err_est_alpha</strong> from <strong>0.002</strong> to <strong>0.006</strong>.</p>
</li>
<li>
<p>Create a drive order between the two endpoints of the route and set the AGV driving back and forth in an endless loop.</p>
</li>
<li>
<p>Adjust the defined scanner angle with the parameter <strong>F,scan_front_sen_angle</strong> until the lateral corrections are within the acceptable range. Start by both increasing and lowering it by 1 degree to determine which direction it should be adjusted in before tuning it more accurately. NOTE! If the lateral correction chart displays large jumps during the calibration process it is likely that the environment is not good enough and should be redefined.</p>
</li>
<li>
<p>When the front scanner has been well aligned with the odometry the final calibration step is to activate and adjust the angle of the rear scanner accordingly. E.g. if <strong>scan_front_sen_ang</strong> was decreased from 90 to 89, one must also adjust <strong>scan_rear_sen_ang</strong> from -90 to -91.</p>
</li>
<li>
<p>Finally, set <strong>odo_err_est_alpha</strong>, <strong>scan_rear_front_selection</strong> and <strong>scan_rear_front_localization_selection</strong> back to their original values and analyse the corrections once again. If the scanners are not matching each other, start by adjusting scan_rear_sen_ang. The scanner points should match each other on both sides of the  vehicle.</p>
</li>
</ul>
<p><strong>NOTE!</strong> Matching the scanner views to each other is the most vital part of the scanner calibration process. Once the front scanner is calibrated according to the procedure and it is time to calibrate the rear scanner, pay more attention to matching the scanner views than the correction charts.</p>
<h3 id="odometry-to-scanner-delay"><a class="header" href="#odometry-to-scanner-delay">Odometry to Scanner Delay</a></h3>
<p>If there is delay between the incoming odometry data and the incoming scanner measurements, the delay needs to be specified for Navitrol so that it can be taken into consideration. The delay can be measured by performing the following steps:</p>
<ul>
<li>
<p>Connect to Navitrol with Navitrol Monitor.</p>
</li>
<li>
<p>Drive the vehicle manually towards and away from a wall that is perpendicular to the vehicles heading.</p>
</li>
<li>
<p>Monitor the possible delay from <em>Navitrol Monitor</em> -&gt; <em>Charts</em> -&gt; <em>Odometry Correction</em> -&gt; <em>Scan Delay Calibration</em> (check the affecting parameters from the table below)</p>
</li>
<li>
<p>Calculate the time difference between the moment when Navitrol has received input of the vehicle moving from the scanner measurements (green graph for front scanner and red graph for rear scanner) to the moment when Navitrol has received odometry stating that there is movement. Set the parameter</p>
<pre><code>  F, scan_delay [ms]
</code></pre>
</li>
</ul>
<p>accordingly (negative if scanner is slower than odometry).</p>
<h4 id="scan-delay-calibration-parameters"><a class="header" href="#scan-delay-calibration-parameters">Scan Delay Calibration parameters</a></h4>
<p>These parameters can be adjusted to change the threshold for drawing the scanner measurements in the <em>Scan Delay Calibration</em> chart in Navitrol Monitor. The default values should be usually sufficient</p>
<table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,calib_scan_delay_min_dist</strong></td><td>0.2</td><td>Minimum beam distance to environment to activate scanner delay calculation. [m]</td></tr>
<tr><td><strong>F,calib_scan_delay_max_dist</strong></td><td>5.0</td><td>Maximum beam distance to environment to activate scanner delay calculation. [m]</td></tr>
<tr><td><strong>I,calib_scan_delay_n_dist_beams</strong></td><td>31</td><td>Maximum/ideal number of beams considered when calculating the average distance to the wall.</td></tr>
<tr><td><strong>I,calib_scan_delay_min_ok_beams</strong></td><td>20</td><td>Minimum number of beams that have to be valid.</td></tr>
<tr><td><strong>F,calib_scan_delay_dev_limit</strong></td><td>0.05</td><td>Maximum deviation of the distance measured by a single beam from the average measured distance. Beams not fulfilling this are not used for the scanner delay calibration. [m]</td></tr>
<tr><td><strong>F,scan_delay</strong></td><td>0.0</td><td>Delay of scanner measurement [ms] relative to odometry measurements.</td></tr>
</tbody></table>
<h2 id="position-controller-calibration"><a class="header" href="#position-controller-calibration">Position Controller Calibration</a></h2>
<p>After the odometry and scanner positions are calibrated accurately, it is vital to make sure that also the position controller works properly.
It calculates reference values for speed and steering and is responsible for keeping the vehicle on track while driving.</p>
<h3 id="define-limitations"><a class="header" href="#define-limitations">Define Limitations</a></h3>
<p>For the position controller to be able to give reasonable reference values that the vehicle can follow, it is possible to enforce limitations on velocity, turning rate and steer rate etc.:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,mot_ctrl_max_wheel_v_fw</strong></td><td>Max drive wheel velocity when driving forwards [m/s].</td></tr>
<tr><td><strong>F,mot_ctrl_max_wheel_v_bw</strong></td><td>Max drive wheel velocity when driving in reverse [m/s].</td></tr>
<tr><td><strong>F,mot_ctrl_max_wheel_acc</strong></td><td>Max acceleration [m/s^2].</td></tr>
<tr><td><strong>F,mot_ctrl_max_wheel_dec</strong></td><td>Max deceleration [m/s^2].</td></tr>
<tr><td><strong>F,max_turn_rate_deg_p_s</strong></td><td>Maximum turning rate of the vehicle [deg/s]. Limit is applied to the speed of the planned trajectory.</td></tr>
<tr><td><strong>F,mot_ctrl_max_steer_rate_deg_p_s</strong></td><td>Maximum turning rate of the steering wheels [deg/s]. Limit is applied to the speed of the planned trajectory (O, S).</td></tr>
<tr><td><strong>F,mot_ctrl_max_steer_rate_scale</strong></td><td>Scale factor for mot_ctrl_max_steer_rate_deg_p_s used during driving to limit the reference steering angle change (S).</td></tr>
<tr><td><strong>F,sub_diff_max_turn_wheel_speed</strong></td><td>Maximum diffunit turning speed [m/s] for each wheel (DS, DO).</td></tr>
</tbody></table>
<h3 id="output-and-feedback-delay"><a class="header" href="#output-and-feedback-delay">Output and Feedback Delay</a></h3>
<p>When Navitrol sets a velocity or RPM target, there is always some amount of delay until this results in physical movement of the motor.
In practice, it is important to minimize this delay as it worsens the performance of the system and makes it unresponsive in certain situations.
However, Navitrol does implement a way to minimize the effect for small delays of this kind by predicting the upcoming control sequence.
The delay can be visually estimated based on the speed control chart in Navitrol Monitor:</p>
<ul>
<li>
<p>Give the vehicle a manual drive command using Navitrol Monitor keyboard control.</p>
</li>
<li>
<p>Monitor the results from <em>Navitrol Monitor Charts Speed Control Final Speed Control.</em></p>
</li>
<li>
<p>Calculate the time difference between the moment Navitrol sets a target velocity (orange graph) to the moment Navitrol receives odometry measurements indicating movement, see Figure 5.</p>
</li>
<li>
<p>Change the Navitrol parameter <strong>I,pc_predict_ms</strong> to the calculated value.</p>
</li>
</ul>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image7.png" alt="" />
<img src="Introduction/InitialCalibrationGuide/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 4: Feedback delay in Navitrol Monitor is calculated by subtracting the corresponding timestamps, in this case 42998.6183 s -- 42998.4700 s = 0.1483 s = 148.3 [ms].</p>
</blockquote>
<p>The drive performance with the estimated value should be evaluated on a pre-defined route:</p>
<ul>
<li>
<p>Let the vehicle drive in a loop in automatic mode along a route with at least two defined curves of 90 degrees, see Figure 5.</p>
</li>
<li>
<p>Monitor the point where the vehicle begins the turn in relation to its trajectory.</p>
</li>
<li>
<p>Adjust the delay time. If the vehicle starts turning too late it often means that the delay time has been underestimated and vice versa.</p>
</li>
</ul>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 5: Example route for fine tuning the output and feedback delay. The straight path should be long enough for the vehicle to stabilize between the turns.</p>
</blockquote>
<h3 id="distance-and-heading-control-gains"><a class="header" href="#distance-and-heading-control-gains">Distance and Heading Control Gains</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pc_pid_heading_p</td><td>Float</td><td>4.0</td><td>Position control heading gain</td></tr>
<tr><td>pc_pid_dist_p</td><td>Float</td><td>4.0</td><td>Position control distance gain</td></tr>
</tbody></table>
<p>The part of the position controller that is responsible for keeping the vehicle on the route while driving can be split into two main parts: distance control and heading control.
The purpose of the distance control is to minimize the distance between the navigation point of the vehicle and the route while the heading control works to align the vehicle's frame heading with the route tangent.
The influence of each term might be adjusted by the corresponding gain parameters, as the optimal values heavily depend on the vehicle model itself.</p>
<p>The idea is to reach a highly accurate and responsive control while still minimizing the oscillations and overshoot. Often, oscillation is caused by either an inaccurate delay estimation (<strong>pc_predict_ms</strong>) or non-optimal position control gains. In general, oscillation decreases as the heading gain is increased but the higher the gain, the more
important it is that the delay parameter is accurate and the delay consistent. If there are large delays in the steer controller, increasing the heading gain may have the opposite effect.</p>
<p>Large distance gains might give a more responsive system, but they might also introduce overshoot and oscillation. Additionally, they require an accurate positioning since noise in the localization always will propagate to the position control. Thus, it is often viable to not set the distance gain too high.</p>
<p>Oscillations are more prone to appear as the driving speed increases.
To deal with this, Navitrol implements a way to define the position control gains in speed dependent sets according to Figure 6. If the speed settings are not implemented, then only the first set of control gains are necessary.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pc_pid_speed_setting[]</td><td>Float</td><td>0.0</td><td>Change PID settings after the speed is higher than given here (0.0 == disabled)</td></tr>
<tr><td>pc_pid_speed_dist_p[]</td><td>Float</td><td>0.0</td><td>Position control distance gain for different speed values</td></tr>
<tr><td>pc_pid_speed_heading_p[]</td><td>Float</td><td>0.0</td><td>Position control heading gain for different speed values</td></tr>
</tbody></table>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 6: Visualization of how the position control gains relate to the speed settings. The names of the speed settings and control gains reflect the corresponding Navitrol parameters.</p>
</blockquote>
<p>The process of calibrating the position control may be divided into the following steps:</p>
<ul>
<li>
<p>Starting at the lowest speed setting, set both control gains to low values. 1 is a good starting point for both.</p>
</li>
<li>
<p>Let the vehicle drive in a loop on route with two turns of 270 degrees, see Figure 7.</p>
</li>
<li>
<p>Monitor how well the vehicle is following the route and how responsive it is to distance and heading offsets.</p>
</li>
<li>
<p>Adjust the control gains to increase the performance of the system according to the guidelines mentioned previously, starting with the distance gain.</p>
</li>
<li>
<p>Increase the speed and introduce a new speed setting when it is evident that the previously defined control gains cannot work properly anymore.</p>
</li>
<li>
<p>Repeat until the full speed range of the vehicle has been covered. For high speeds it might be necessary to adapt the route layout.</p>
</li>
</ul>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image11.png" alt="" /></p>
<blockquote>
<p>Figure 7: Route for tuning position control gains.</p>
</blockquote>
<h4 id="distance-and-heading-control-gains-for-loaded-agv"><a class="header" href="#distance-and-heading-control-gains-for-loaded-agv">Distance and Heading Control Gains for loaded AGV</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pc_pid_heading_p_loaded</td><td>Float</td><td>0.0</td><td>PosCont head gain for loaded AGV (0.0 == use non-loaded value)</td></tr>
<tr><td>pc_pid_dist_p_loaded</td><td>Float</td><td>0.0</td><td>PosCont dist gain for loaded AGV (0.0 == use non-loaded value)</td></tr>
<tr><td>pc_pid_speed_setting_loaded[]</td><td>Float</td><td>0.0</td><td>Change PID settings for loaded AGV after the speed is higher than given here (0.0 == disabled)</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded[]</td><td>Float</td><td>0.0</td><td>PosCont head gains for loaded AGV for different speed values (0.0 == disabled)</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded[]</td><td>Float</td><td>0.0</td><td>PosCont dist gains for loaded AGV for different speed values (0.0 == disabled)</td></tr>
</tbody></table>
<p>In many applications, the vehicle is meant to transport resources between different points along the route. For heavy and/or large resources it is common that the kinematic properties of the vehicle change noticeably between the loaded and unloaded state. To reduce the effect of this, Navitrol implements a way to adapt the control gains
based on the current load state of the vehicle. It works together with its corresponding speed settings as seen in Figure 8.</p>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image12.png" alt="" /></p>
<blockquote>
<p>Figure 8: Visualization of how the position control gains relate to the speed settings for a loaded vehicle. The names of the speed settings and control gains reflect the corresponding Navitrol parameters.</p>
</blockquote>
<h4 id="distance-and-heading-control-gains-based-on-load-weight"><a class="header" href="#distance-and-heading-control-gains-based-on-load-weight">Distance and Heading Control Gains based on load weight</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pc_pid_load_weight_kg[]</td><td>Float</td><td>0.0</td><td>Change PosContPID settings for loaded AGV when load weight is higher than given here (0.0 == disabled).</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded1[]</td><td>Float</td><td>0.0</td><td>PosContPID settings using two dim gain array (0.0 == disabled). <br> See the <em>Speed/Load</em> array below how these parameters are used.</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded1[]</td><td>Float</td><td>0.0</td><td>PosContPID settings using two dim gain array (0.0 == disabled)</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded2[]</td><td>Float</td><td>0.0</td><td>PosContPID settings using two dim gain array (0.0 == disabled)</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded2[]</td><td>Float</td><td>0.0</td><td>PosContPID settings using two dim gain array (0.0 == disabled)</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded3[]</td><td>Float</td><td>0.0</td><td>PosContPID settings using two dim gain array (0.0 == disabled)</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded3[]</td><td>Float</td><td>0.0</td><td>PosContPID settings using two dim gain array (0.0 == disabled)</td></tr>
</tbody></table>
<p>Note that Navitrol needs to get the load weight through some interface to be able to define what weight gain should be used. This information is not provided through every interface, so ask Navitec if your setup is able to use this.</p>
<p>If all of these gain parameters that are listed in this Chapter are enabled, the correlation between speed and load weights would look like this table below.</p>
<p>Priority of the gains:</p>
<ol>
<li>Use the weight gains: if <strong>pc_pid_load_weight[0]</strong> &gt; 0.0.</li>
<li>Use the loaded speed gains: if <strong>pc_pid_speed_setting_loaded[i]</strong>, <strong>pc_pid_speed_dist_p_loaded[i]</strong> and <strong>pc_pid_speed_heading_p_loaded[i]</strong> are all &gt; 0.0.</li>
<li>Use the standard loaded gains: if <strong>pc_pid_dist_p_loaded</strong> and <strong>pc_pid_heading_p_loaded</strong> are &gt; 0.0.</li>
<li>Use non-loaded speed gains: if <strong>pc_pid_speed_setting[i]</strong>, <strong>pc_pid_speed_dist_p[i]</strong> and <strong>pc_pid_speed_heading_p[i]</strong> are all &gt; 0.0.</li>
<li>Use non-loaded basic gain values <strong>pc_pid_heading_p</strong> and <strong>pc_pid_dist_p</strong>.</li>
</ol>
<table><thead><tr><th>Speed/Load</th><th>Not loaded</th><th>&lt; weight0</th><th>&lt; weight1</th><th>&lt; weight2</th><th>&gt; weight2</th></tr></thead><tbody>
<tr><td><strong>&lt; speed0</strong></td><td>pc_pid_heading_p <br> pc_pid_dist_p</td><td>pc_pid_heading_p_loaded <br>  pc_pid_dist_p_loaded</td><td>pc_pid_speed_heading_p_loaded1[0] <br> pc_pid_speed_dist_p_loaded1[0]</td><td>pc_pid_speed_heading_p_loaded2[0] <br> pc_pid_speed_dist_p_loaded2[0]</td><td>pc_pid_speed_heading_p_loaded3[0] <br> pc_pid_speed_dist_p_loaded3[0]</td></tr>
<tr><td><strong>&lt; speed1</strong></td><td>pc_pid_speed_heading_p[0] <br> pc_pid_speed_dist_p[0]</td><td>pc_pid_speed_heading_p_loaded[0] <br> pc_pid_speed_dist_p_loaded[0]</td><td>pc_pid_speed_heading_p_loaded1[1] <br> pc_pid_speed_dist_p_loaded1[1]</td><td>pc_pid_speed_heading_p_loaded2[1] <br> pc_pid_speed_dist_p_loaded2[1]</td><td>pc_pid_speed_heading_p_loaded3[1] <br> pc_pid_speed_dist_p_loaded3[1]</td></tr>
<tr><td><strong>&lt; speed2</strong></td><td>pc_pid_speed_heading_p[1] <br> pc_pid_speed_dist_p[1]</td><td>pc_pid_speed_heading_p_loaded[1] <br> pc_pid_speed_dist_p_loaded[1]</td><td>pc_pid_speed_heading_p_loaded1[2] <br> pc_pid_speed_dist_p_loaded1[2]</td><td>pc_pid_speed_heading_p_loaded2[2] <br> pc_pid_speed_dist_p_loaded2[2]</td><td>pc_pid_speed_heading_p_loaded3[2] <br> pc_pid_speed_dist_p_loaded3[2]</td></tr>
<tr><td><strong>&gt; speed2</strong></td><td>pc_pid_speed_heading_p[2] <br> pc_pid_speed_dist_p[2]</td><td>pc_pid_speed_heading_p_loaded[2] <br> pc_pid_speed_dist_p_loaded[2]</td><td>pc_pid_speed_heading_p_loaded1[3] <br> pc_pid_speed_dist_p_loaded1[3]</td><td>pc_pid_speed_heading_p_loaded2[3] <br> pc_pid_speed_dist_p_loaded2[3]</td><td>pc_pid_speed_heading_p_loaded3[3] <br> pc_pid_speed_dist_p_loaded3[3]</td></tr>
</tbody></table>
<p><strong>Example set of parameters:</strong></p>
<pre><code class="language-bash">F,pc_pid_load_weight_kg[0], 350 		# weight parameter array size ==3     =&gt;  gives 4 ranges
F,pc_pid_load_weight_kg[1], 700 	    # Weight0 &lt; Weight1 &lt; Weight2
F,pc_pid_load_weight_kg[2], 900

F,pc_pid_speed_setting_loaded[0], 0.5	# speed parameter array size ==3     =&gt;  gives 4 ranges
F,pc_pid_speed_setting_loaded[1], 1.0	# speed0 &lt; speed1 &lt; speed2 (when AGV is loaded)
F,pc_pid_speed_setting_loaded[2], 1.5

F,pc_pid_speed_setting[0], 0.8	        # speed parameter array size ==3     =&gt;  gives 4 ranges
F,pc_pid_speed_setting[1], 1.2	        # speed0 &lt; speed1 &lt; speed2 (when AGV is not loaded)
F,pc_pid_speed_setting[2], 1.7

F,pc_pid_speed_heading_p_loaded1[0], 4.1
F,pc_pid_speed_heading_p_loaded1[1], 6.6
F,pc_pid_speed_heading_p_loaded1[2], 3.2
F,pc_pid_speed_heading_p_loaded1[3], 10.5

F,pid_speed_dist_p_loaded1[0], 4.3
F,pid_speed_dist_p_loaded1[1], 3.0
F,pid_speed_dist_p_loaded1[2], 7.5
F,pid_speed_dist_p_loaded1[3], 10.0

F,pc_pid_speed_heading_p_loaded2[0], 5.5
</code></pre>
<h3 id="stopping-accuracy"><a class="header" href="#stopping-accuracy">Stopping Accuracy</a></h3>
<p>Accurate stopping is a requirement for most applications and Navitrol implements different methods to facilitate this, such as crawl mode, stop offsets and distance-based control gains:</p>
<ul>
<li>
<p>Let the vehicle drive in a loop on a route with two stop points and a 90 degree turn in-between, see Figure 9. The speed of the route should be low, just as it would be in a real application.</p>
</li>
<li>
<p>Monitor where the vehicle stops in relation to the route. If there is an offset, first try to modify the crawl mode parameters:</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,slow_down_crawl_dist</strong></td><td>How far from the stopping point that the crawl mode is activated.</td></tr>
<tr><td><strong>F,min_slow_down_speed</strong></td><td>Speed while in crawl mode.</td></tr>
</tbody></table>
<ul>
<li>For systematic and constant stopping deviations there is a possibility to define a stopping offset:</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,pc_stop_distance_offset</strong></td><td>Stopping distance offset from last point (positive if stops too early)</td></tr>
</tbody></table>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>Figure 9: Route for tuning stopping accuracy.</p>
</blockquote>
<p><strong>Steer drive and differential drive</strong></p>
<p>Furthermore, Navitrol includes an accurate stopping feature that dynamically adjusts the position controller gains when arriving at a stop point. It can be activated by setting the parameter <strong>F,pc_end_gain_dist</strong> [m] to a value larger than zero and then adjusting the different gains/gain limits specified by the parameters:</p>
<ul>
<li>
<p><strong>F,pc_end_gain1 --</strong> Used in the dynamic calculation of the proportional gains for position control of both heading and
distance.</p>
</li>
<li>
<p><strong>F,pc_end_max_gain --</strong> Maximum proportional gain for position control of both heading and distance.</p>
</li>
<li>
<p><strong>F,pc_end_min_gain --</strong> Minimum proportional gain for position control of distance.</p>
</li>
</ul>
<p>The effect of the parameter <strong>pc_end_gain1</strong> is illustrated in Figure 10 and one can see how an increased parameter value increases the heading gain but reduces the distance gain.</p>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image14.png" alt="" />
<img src="Introduction/InitialCalibrationGuide/./media-en/image15.png" alt="" /></p>
<blockquote>
<p>Figure 10: Illustration of how the pc_end_gain1 parameter affects the heading and distance position control gains.</p>
</blockquote>
<h3 id="pivoting"><a class="header" href="#pivoting">Pivoting</a></h3>
<p>If the mechanical construction of the vehicle allows for pivoting, where the vehicle is turning around its navigation point without any translational movement, then also this should be configured:</p>
<ul>
<li>
<p>Set the required target accuracy in degrees to the Navitrol parameter <strong>F,pivot_target_head_diff_deg</strong>. Setting it too low can result in issues as the position controller is not able to fulfill it.</p>
</li>
<li>
<p>Let the vehicle drive in a loop on a route with two pivot points, see Figure 11.</p>
</li>
<li>
<p>Monitor the pivoting speed and adjust it if necessary by changing the Navitrol parameter <strong>F,pivot_speed</strong>.</p>
</li>
<li>
<p>Monitor the angular stopping accuracy. Navitrol decreases the speed reference when reaching the end of the pivot and these quantities can be adjusted by the parameters</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,pivot_crawl_speed</strong></td><td>Drive point velocity during pivot when close to target.</td></tr>
<tr><td><strong>F,pivot_crawl_head_diff_deg</strong></td><td>Slow driving angular distance during pivot [deg].</td></tr>
<tr><td><strong>F,pivot_dec_head_deg</strong></td><td>Angular difference from stop target before decelerating from pivot speed to slowdown speed during pivot [deg].</td></tr>
</tbody></table>
<p><img src="Introduction/InitialCalibrationGuide/./media-en/image16.png" alt="" /></p>
<blockquote>
<p>Figure 11: Route for tuning pivoting.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parameter-reconfiguration"><a class="header" href="#parameter-reconfiguration">Parameter reconfiguration</a></h1>
<p>Updated 19.07.2024</p>
<hr />
<h2 id="overview-3"><a class="header" href="#overview-3">Overview</a></h2>
<p>Sometimes parameters used by Navitrol for some specific purpose need to be changed when Navitrol software is updated. There are numerous possible reasons for this, some examples being</p>
<ul>
<li>Unifying parameter usage</li>
<li>Replacing some previously used machine types with new ones</li>
</ul>
<p>At start-up, Navitrol checks any need for such parameter configuration. If reconfiguration is needed, error <strong>ERROR_PARAMETER_RECONFIGURE_NEEDED</strong> is raised, and parameter reconfiguration is required before Navitrol can be run again. This error may be triggered by an issue in any of the parameter files used by Navitrol.</p>
<p>Navitrol provides command line utility to check for needed parameter changes. This utility lists all the changes needed to console and stores the same information to a log file <code>.\params_backup\params_reconfigure_log.txt</code>. This utility is even able to fix the parameter files automatically in many cases, if given a permission to do so.</p>
<p><strong>Important note:</strong> Parameter changes needed may be related to basic driving. If that is the case, it is recommended to verify updated parameters and all driving directions having AGV lifted off the ground.</p>
<h2 id="reconfiguration-policy"><a class="header" href="#reconfiguration-policy">Reconfiguration policy</a></h2>
<p>Parameter reconfiguration rules are called reconfiguration policies. Each Navitrol version may include any number of reconfiguration policies, and each policy has different rules for changing parameters.</p>
<p>Navitrol 6.54 has one reconfiguration defined policy, <a href="Miscellaneous/ParameterReconfiguration/ParameterReconfiguration-en.html#reconfiguration-policy-roboteqdistscale">RoboteqDistScale</a>.</p>
<h2 id="how-to-use"><a class="header" href="#how-to-use">How to use</a></h2>
<h3 id="preconditions"><a class="header" href="#preconditions">Preconditions</a></h3>
<ul>
<li>Minimum software version requirements
<ul>
<li>Navitrol 6.54.00</li>
</ul>
</li>
</ul>
<h3 id="basics"><a class="header" href="#basics">Basics</a></h3>
<p>If error <strong>ERROR_PARAMETER_RECONFIGURE_NEEDED</strong> is raised, parameters need to be reconfigured.</p>
<p>Issue cmd</p>
<pre><code>./Navitrol paramsreconfigure
</code></pre>
<p>Navitrol examines all available parameter files and reports whether</p>
<ul>
<li>No reconfiguration is needed.</li>
<li>Manual reconfiguration is needed; this may be necessary for different reasons, Navitrol listing the issues why automatic reconfiguration is not possible.</li>
<li>Automatic reconfiguration is possible; parameter changes are listed and then user given the possibility to either allow or deny the writing of the updated information to parameter file.</li>
</ul>
<p>Reconfiguration rules may be different to main parameter file params.txt and override files (params_override.txt, params_zone*.txt).</p>
<p><strong>NOTE:</strong> Navitrol updating the parameter file means that any manually added user comments and parameter regrouping is lost. That is why user is always given the option to make the suggested parameter changes manually.</p>
<h3 id="reconfiguration-policies"><a class="header" href="#reconfiguration-policies">Reconfiguration policies</a></h3>
<h4 id="reconfiguration-policy-roboteqdistscale"><a class="header" href="#reconfiguration-policy-roboteqdistscale">Reconfiguration policy RoboteqDistScale</a></h4>
<p>This reconfiguration policy checks parameters used for scaling speed as reported by Roboteq motor controllers. Parameter <strong>mot_ctrl_drive_rpm_to_m_per_s</strong> should be used for that purpose, but some old machine types have used distance scaling parameters instead. Starting from Navitrol software version 6.54, <strong>mot_ctrl_drive_rpm_to_m_per_s</strong> is used for all machine types.</p>
<p>Machine types affected and parameters involved are listed in a table below.</p>
<table><thead><tr><th>Machine type id</th><th>Kinematic type</th><th>Scaling parameter(s)<br>SW version 6.52 and older</th><th>Scaling parameter<br>SW version 6.54 and later</th><th>Inversion parameter(s)</th></tr></thead><tbody>
<tr><td>10012</td><td>Omni</td><td>mot_ctrl_drive_dist_scale</td><td>mot_ctrl_drive_rpm_to_m_per_s</td><td>mot_ctrl_omni_speed_inv_input[]<br>mot_ctrl_omni_speed_inv_output[]</td></tr>
<tr><td>10016</td><td>Diff</td><td>mot_ctrl_left_dist_scale<br>mot_ctrl_right_dist_scale</td><td>mot_ctrl_drive_rpm_to_m_per_s</td><td>mot_ctrl_left_inv_in<br>mot_ctrl_right_inv_in<br>mot_ctrl_left_inv_out<br>mot_ctrl_right_inv_out</td></tr>
<tr><td>230003</td><td>Diff</td><td>mot_ctrl_left_dist_scale<br>mot_ctrl_right_dist_scale</td><td>mot_ctrl_drive_rpm_to_m_per_s</td><td>mot_ctrl_left_inv_in<br>mot_ctrl_right_inv_in<br>mot_ctrl_left_inv_out<br>mot_ctrl_right_inv_out</td></tr>
<tr><td>340001</td><td>Diff</td><td>mot_ctrl_left_dist_scale<br>mot_ctrl_right_dist_scale</td><td>mot_ctrl_drive_rpm_to_m_per_s</td><td>mot_ctrl_left_inv_in<br>mot_ctrl_right_inv_in<br>mot_ctrl_left_inv_out<br>mot_ctrl_right_inv_out</td></tr>
<tr><td>340002</td><td>Mecanum</td><td>mot_ctrl_drive_dist_scale</td><td>mot_ctrl_drive_rpm_to_m_per_s</td><td>mot_ctrl_mecanum_inv_input[]<br>mot_ctrl_mecanum_inv_output[]</td></tr>
<tr><td>340004</td><td>Mecanum</td><td>mot_ctrl_drive_dist_scale</td><td>mot_ctrl_drive_rpm_to_m_per_s</td><td>mot_ctrl_mecanum_inv_input[]<br>mot_ctrl_mecanum_inv_output[]</td></tr>
</tbody></table>
<p>Parameter <strong>mot_ctrl_drive_rpm_to_m_per_s</strong> has been mistakenly obligatory parameter for many machine types that have not used it all. If parameter file contains both old style dist_scale parameters and <strong>mot_ctrl_drive_rpm_to_m_per_s</strong>, automatic reconfiguration is not possible. In such a case reconfiguration suggests manual configuration, and reports what prevents automatic configuration:</p>
<pre><code>ISSUE: Both mot_ctrl_left_dist_scale/mot_ctrl_right_dist_scale and mot_ctrl_drive_rpm_to_m_per_s defined
</code></pre>
<p>If one knows that dist_scale parameters have right values, it is possible to overcome this issue by simply removing <strong>mot_ctrl_drive_rpm_to_m_per_s</strong> from parameter file.</p>
<p><strong>NOTE:</strong> Inversion parameters are modified by this policy only for &quot;main&quot; parameter file params.txt. As Navitrol version 6.52 supported only open loop control with Roboteq motor controllers, output inversion parameters are never modified.</p>
<h3 id="parameter-backup-files"><a class="header" href="#parameter-backup-files">Parameter backup files</a></h3>
<p>Whenever any of the current parameter files is modified by reconfiguration, backup file is stored to folder <code>./params_backup</code>. File name of each such a backup file:</p>
<ul>
<li>starts with original file name</li>
<li>includes <code>reconfigure</code> to indicate that backup was created by reconfiguration</li>
<li>includes date and time</li>
</ul>
<p>Backup files are named like:</p>
<ul>
<li>params_reconfigure_backup_2024.04.16_10.50.27.txt</li>
<li>params_override_reconfigure_backup_2024.04.16_11.48.37.txt</li>
<li>params_zone0_reconfigure_backup_2024.04.16_14.21.30.txt</li>
</ul>
<h3 id="console-output-and-logging"><a class="header" href="#console-output-and-logging">Console output and logging</a></h3>
<p>Console output and information stored to log by command <code>./Navitrol paramsreconfigure</code> are almost identical. Some additional information is stored to log file, including Navitrol software version used, date and time.</p>
<p>The following shows an example of logged data for all three possible cases as mentioned above; no reconfiguration needed, manual reconfiguration needed and automatic reconfiguration possible.</p>
<pre><code>#####################################################################################
Parameter reconfiguration
Date: 2024.04.16_10.30.48
SWVer 6.54.00
#####################################################################################

Check for reconfiguration need for file params.txt, machine type 10016 using policy RoboteqDistScale
Parameter reconfiguration not required for params.txt

Check for reconfiguration need for file params_override.txt, machine type 10016 using policy RoboteqDistScale
Parameter reconfiguration not required for params_override.txt


#####################################################################################
Parameter reconfiguration
Date: 2024.04.16_10.35.27
SWVer 6.54.00
#####################################################################################

Check for reconfiguration need for file params.txt, machine type 10016 using policy RoboteqDistScale
Manual parameter reconfiguration needed for params.txt
ISSUE: Both mot_ctrl_left_dist_scale/mot_ctrl_right_dist_scale and mot_ctrl_drive_rpm_to_m_per_s defined
Actions:
1. Add/change mot_ctrl_drive_rpm_to_m_per_s to right value in parameter file (check value of mot_ctrl_left_dist_scale/mot_ctrl_right_dist_scale)
2. Add/change in/out inversion parameters to parameter file if old dist_scale used was negative
3. Remove parameters mot_ctrl_left_dist_scale and mot_ctrl_right_dist_scale


#####################################################################################
Parameter reconfiguration
Date: 2024.04.16_10.48.25
SWVer 6.54.00
#####################################################################################

Check for reconfiguration need for file params.txt, machine type 10016 using policy RoboteqDistScale
Parameter reconfiguration needed for params.txt - configuring changes
Add:        F,mot_ctrl_drive_rpm_to_m_per_s, 0.001440
Add/Change: I,mot_ctrl_left_inv_in, 1
Add/Change: I,mot_ctrl_right_inv_in, 0
Remove:     F,mot_ctrl_left_dist_scale, -0.001440
Remove:     F,mot_ctrl_right_dist_scale, -0.001440
Changes are not stored to file params.txt

Check for reconfiguration need for file params_override.txt, machine type 10016 using policy RoboteqDistScale
Parameter reconfiguration needed for params_override.txt - configuring changes
Add:        F,mot_ctrl_drive_rpm_to_m_per_s, 0.011100
Remove:     F,mot_ctrl_left_dist_scale, -0.011100
Remove:     F,mot_ctrl_right_dist_scale, 0.011100
Storing changes to file params_override.txt
</code></pre>
<p><strong>NOTE:</strong> Stored override parameter files might not include all parameters listed in this output. If the value matches with basic parameters, then values are not stored in override file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="navitrol-parameters"><a class="header" href="#navitrol-parameters">Navitrol parameters</a></h1>
<p>Updated 19.09.2024</p>
<p>This document lists all Navitrol parameters. Some of the listed parameters are applicable only for specific machine types.</p>
<h2 id="agv-identification-and-dimensions"><a class="header" href="#agv-identification-and-dimensions">AGV Identification and dimensions</a></h2>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>machine_type_id</td><td>int</td><td>0</td><td>Id of vehicle type</td></tr>
<tr><td>machine_type_key</td><td>uint</td><td>0</td><td>Verification key of machine type id</td></tr>
<tr><td>dim_front</td><td>float</td><td>1.3</td><td>AGV lengthwise dimension from navigation point to the front end. Positive value.</td></tr>
<tr><td>dim_rear</td><td>float</td><td>-0.51</td><td>AGV lengthwise dimension from navigation point to the rear end. Negative value.</td></tr>
<tr><td>dim_left</td><td>float</td><td>0.27</td><td>AGV dimension from navigation point to the left side. Positive value.</td></tr>
<tr><td>dim_right</td><td>float</td><td>-0.27</td><td>AGV dimension from navigation point to the right side. Negative value.</td></tr>
<tr><td>machine_id</td><td>int</td><td>1</td><td>Machine ID number reported to fleet control and other systems.</td></tr>
<tr><td>wheel_dist</td><td>float</td><td>0.5</td><td>Lengthwise offset of steering wheel from navigation point, positive is toward the front of the machine.</td></tr>
<tr><td>wheel_off_center</td><td>float</td><td>0.0</td><td>Sideways offset of steering wheel from navigation point, positive is to the left.</td></tr>
<tr><td>wheel_track</td><td>float</td><td>0.248</td><td>Distance between the centers of the differential drive wheels.</td></tr>
<tr><td>reported_machine_type</td><td>int</td><td>0</td><td>Override machine type reported to fleet control. 0 = no override</td></tr>
<tr><td>wheel_x</td><td>float[]</td><td>0.0</td><td>Longitudinal position of wheel relative to vehicle navigation point. Positive towards front. Indexes according to customer wheel numbering.</td></tr>
<tr><td>wheel_y</td><td>float[]</td><td>0.0</td><td>Lateral position of wheel relative to vehicle center point. Positive to the left. Indexes according to customer wheel numbering.</td></tr>
<tr><td>wheel_y_off</td><td>float[]</td><td>0.0</td><td>Wheel offset from its turning axle, lateral distance when wheel is straight. Positive to the left. Indexes according to customer wheel numbering.</td></tr>
</tbody></table>
<h2 id="agv-interfaces"><a class="header" href="#agv-interfaces">AGV Interfaces</a></h2>
<h3 id="scanners"><a class="header" href="#scanners">Scanners</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>scanner_sends_every_nth_meas</td><td>int[]</td><td>1</td><td>Scanner sends only every nth meas - not Navigation SW controllable, valid for specific scanners only</td></tr>
<tr><td>scanner_meas_model</td><td>int[]</td><td>-1</td><td>Measurement scanner model. Same as scanner_model_front</td></tr>
<tr><td>scanner_meas_addr</td><td>string[]</td><td>1.1.1.1:500</td><td>1.1.1.1:500</td></tr>
<tr><td>scanner_meas_use_nth_meas</td><td>int[]</td><td>1</td><td>Use only every nth measurement beam from each scan.</td></tr>
<tr><td>scanner_meas_upside_down</td><td>int[]</td><td>0</td><td>Mounting orientation: 0 = normal, 1 = upside down</td></tr>
<tr><td>scanner_meas_dang_factor</td><td>float[]</td><td>-1.0</td><td>Scanner angular resolution (dAng) scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995...1.005)</td></tr>
<tr><td>scanner_meas_x</td><td>float[]</td><td>0.0</td><td>Scanner lengthwise mounting position relative to navigation point. Positive is towards the front of the machine.</td></tr>
<tr><td>scanner_meas_y</td><td>float[]</td><td>0.0</td><td>Scanner lateral mounting position relative to navigation point. Positive is left from the machine center line.</td></tr>
<tr><td>scanner_meas_sen_ang_deg</td><td>float[]</td><td>0.0</td><td>Scanner mounting angle relative to machine frame.</td></tr>
<tr><td>scanner_meas_beam_min_ang_deg</td><td>float[]</td><td>0.0</td><td>Scanner beam min&amp;max angles define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam</td></tr>
<tr><td>scanner_meas_beam_max_ang_deg</td><td>float[]</td><td>360.0</td><td>Scanner beam min&amp;max angles define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam</td></tr>
<tr><td>scanner_meas_scan_delay</td><td>float[]</td><td>0.0</td><td>Delay of scanner measurements[ms] relative to odometry measurements (negative if scanner measurement is older than odometry)</td></tr>
<tr><td>scanner_meas_scan_rot_cor_invert_dir</td><td>int[]</td><td>0</td><td>Invert direction in scanner rotation correction.</td></tr>
<tr><td>scanner_meas_offset_mm</td><td>int[]</td><td>0</td><td>Scanner measurement offset correction [mm].</td></tr>
<tr><td>scanner_meas_loc_override_level</td><td>int</td><td>-1</td><td>Minimum floor level for using measurement scanner for localization: -1 = disable, 0 = forced override (all levels), &gt;0 = normal minimum level</td></tr>
<tr><td>scanner_meas_safety_zone_dir</td><td>int[]</td><td>0</td><td>Which direction should the slowdown and stops happen on safety zone triggers. 0 = none, 1 = backward only, 2 = forward only, 3 = both directions</td></tr>
<tr><td>scanner_model_front</td><td>int</td><td>0</td><td>Front scanner model: 0 = Sick Ethernet, 1 = Sick S300, 2 = Omron OS32C, 3 = P+F R2000 UHD 4 = obsolete, 5 = Leuze RSL400, 6 = Hokuyo UAM-05LP, 7 = Keyence SZ-V 32N, 8 = Sick uScan, 9 = Sick S300 TCP/IP, 10 = Reserved, 11 = Quanergy M1, 12 = Hokuyo SCIP, 15 = DDS, 16 = Leuze RSL200</td></tr>
<tr><td>scanner_model_rear</td><td>int</td><td>0</td><td>Rear scanner model. Value range same as in scanner_model_front.</td></tr>
<tr><td>scan_rear_front_selection</td><td>int</td><td>3</td><td>Defines which scanners are connected: 0 = no scanners, 1 = rear scanner only, 2 = front scanner only, 3 = both rear and front scanners</td></tr>
<tr><td>scan_rear_front_localization_selection</td><td>int</td><td>3</td><td>Defines which scanners are used for localization: 0 = no scanners, 1 = rear scanner only, 2 = front scanner only, 3 = both rear and front scanners</td></tr>
<tr><td>scanner_to_move</td><td>int</td><td>0</td><td>Scanner to move: 0 = disable, 1 = rear scanner, 2 = front scanner</td></tr>
<tr><td>front_scanner_serial_port</td><td>string</td><td>/dev/ttyS0</td><td>Insert serial port name here. E.g. ttyRX0 if using external serial card and ttyS0 if using Debian Jessie</td></tr>
<tr><td>rear_scanner_serial_port</td><td>string</td><td>/dev/ttyS1</td><td>Insert serial port name here. E.g. ttyRX1 if using external serial card and ttyS1 if using Debian Jessie</td></tr>
<tr><td>front_scanner_ip</td><td>string</td><td></td><td>Front scanner IP</td></tr>
<tr><td>rear_scanner_ip</td><td>string</td><td></td><td>Rear scanner IP</td></tr>
<tr><td>front_scanner_port</td><td>int</td><td>44818</td><td>Front scanner port: Sick 2111, PEF 80, Omron 44818, Velodyne 2368, Hokuyo 10940, Leuze 9999, Keyence 8800, QuanergyM1 4141</td></tr>
<tr><td>rear_scanner_port</td><td>int</td><td>44818</td><td>Rear scanner port: Sick 2111, PEF 80, Omron 44818, Velodyne 2368, Hokuyo 10940, Leuze 9999, Keyence 8800, QuanergyM1 4141</td></tr>
<tr><td>safety_scanner_model</td><td>int[]</td><td>-1</td><td>Safety scanner model. Same as scanner_model_front</td></tr>
<tr><td>safety_scanner_addr</td><td>string[]</td><td></td><td></td></tr>
<tr><td>scan_virtual_z_min</td><td>float</td><td>0.0</td><td>3D scanner Z-coordinate minimum value to use for 2D projection.</td></tr>
<tr><td>scan_virtual_z_max</td><td>float</td><td>0.0</td><td>3D scanner Z-coordinate maximum value to use for 2D projection.</td></tr>
<tr><td>scan_front_use_nth_meas</td><td>int</td><td>1</td><td>Use only every nth measurement beam from each scan for front scanner.</td></tr>
<tr><td>scan_rear_use_nth_meas</td><td>int</td><td>1</td><td>Use only every nth measurement beam from each scan for rear scanner.</td></tr>
<tr><td>scan_rear_upside_down</td><td>int</td><td>0</td><td>Mounting orientation: 0 = normal, 1 = upside down</td></tr>
<tr><td>scan_front_upside_down</td><td>int</td><td>0</td><td>Mounting orientation: 0 = normal, 1 = upside down</td></tr>
<tr><td>scan_rear_offset_mm</td><td>int</td><td>0</td><td>Scanner measurement offset correction [mm].</td></tr>
<tr><td>scan_front_offset_mm</td><td>int</td><td>0</td><td>Scanner measurement offset correction [mm].</td></tr>
<tr><td>idle_front_scanner_warning_zone_set</td><td>int</td><td>0</td><td>Idle warning zone set for front scanner. For example used in ethernet supervisor warning zone section.</td></tr>
<tr><td>idle_rear_scanner_warning_zone_set</td><td>int</td><td>0</td><td>Idle warning zone set for rear scanner. For example used in ethernet supervisor warning zone section.</td></tr>
<tr><td>scan_delay</td><td>float</td><td>0.0</td><td>Delay of scanner measurement [ms] relative to odometry measurements.</td></tr>
<tr><td>scan_timing_mode</td><td>int</td><td>1</td><td>Enable automatic scanner timestamp variation correction.</td></tr>
<tr><td>scan_rear_x</td><td>float</td><td>-0.09</td><td>Rear scanner lengthwise mounting position relative to navigation point. Positive is towards the front of the machine.</td></tr>
<tr><td>scan_rear_y</td><td>float</td><td>0.0</td><td>Rear scanner lateral mounting position relative to navigation point. Positive is left from the machine center line.</td></tr>
<tr><td>scan_front_x</td><td>float</td><td>0.99</td><td>Front scanner lengthwise mounting position relative to navigation point. Positive is towards the front of the machine.</td></tr>
<tr><td>scan_front_y</td><td>float</td><td>0.0</td><td>Front scanner lateral mounting position relative to navigation point. Positive is left from the machine center line.</td></tr>
<tr><td>scan_rear_sen_ang</td><td>float</td><td>90.0</td><td>Rear scanner mounting angle relative to machine frame. Scanner's X-axis is towards the right side of the scanner. Therefore a scanner that points towards the front of the machine has a mounting angle of -90 degrees.</td></tr>
<tr><td>scan_front_sen_ang</td><td>float</td><td>90.0</td><td>Front scanner mounting angle relative to machine frame. Scanner's X-axis is towards the right side of the scanner. Therefore a scanner that points towards the front of the machine has a mouting angle of -90 degrees.</td></tr>
<tr><td>scan_front_beam_min_ang_deg</td><td>float</td><td>0.0</td><td>Scanner beam min&amp;max angles define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam.</td></tr>
<tr><td>scan_front_beam_max_ang_deg</td><td>float</td><td>360.0</td><td>Scanner beam min&amp;max angles define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam.</td></tr>
<tr><td>scan_rear_beam_min_ang_deg</td><td>float</td><td>0.0</td><td>Scanner beam min&amp;max angles define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam.</td></tr>
<tr><td>scan_rear_beam_max_ang_deg</td><td>float</td><td>360.0</td><td>Scanner beam min&amp;max angles define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam.</td></tr>
<tr><td>calib_scan_delay_n_dist_beams</td><td>int</td><td>31</td><td>Maximum/ideal number of beams considered when calculating the average distance to the wall.</td></tr>
<tr><td>calib_scan_delay_min_ok_beams</td><td>int</td><td>20</td><td>Minimum number of beams that have to be valid.</td></tr>
<tr><td>calib_scan_delay_dev_limit</td><td>float</td><td>0.05</td><td>Maximum deviation of the distance measured by a single beam from the average measured distance. Beams not fulfilling this are not used for the scanner delay calibration.</td></tr>
<tr><td>calib_scan_delay_min_dist</td><td>float</td><td>0.2</td><td>Minimum beam distance to environment to activate scanner delay calculation [m]</td></tr>
<tr><td>calib_scan_delay_max_dist</td><td>float</td><td>5.0</td><td>Maximum beam distance to environment to activate scanner delay calculation [m]</td></tr>
<tr><td>scan_min_dist</td><td>float</td><td>0.2</td><td>Scanner minimum distance measurement to use.</td></tr>
<tr><td>scan_front_beam_disable_start_ang_deg_arr</td><td>float[]</td><td>-1.0</td><td>Defines the start points of disabled scanner measurement zones for front scanner with 0 deg being the first measurement beam. -1 = Disabled, 0 = Min, 360 = Max</td></tr>
<tr><td>scan_front_beam_disable_end_ang_deg_arr</td><td>float[]</td><td>-1.0</td><td>Defines the end points of disabled scanner measurement zones for front scanner with 0 deg being the first measurement beam. -1 = Disabled, 0 = Min, 360 = Max</td></tr>
<tr><td>scan_rear_beam_disable_start_ang_deg_arr</td><td>float[]</td><td>-1.0</td><td>Defines the start points of disabled scanner measurement zones for rear scanner with 0 deg being the first measurement beam. -1 = Disabled, 0 = Min, 360 = Max</td></tr>
<tr><td>scan_rear_beam_disable_end_ang_deg_arr</td><td>float[]</td><td>-1.0</td><td>Defines the end points of disabled scanner measurement zones for rear scanner with 0 deg being the first measurement beam. -1 = Disabled, 0 = Min, 360 = Max</td></tr>
<tr><td>scan_s300_max_dist</td><td>float</td><td>29.9</td><td>Sick S300 scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_sick_eth_max_dist</td><td>float</td><td>65.0</td><td>Sick LMS/Tim scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_pef_max_dist</td><td>float</td><td>131.0</td><td>Pepperl+Fuchs scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_omron_max_dist</td><td>float</td><td>65.5</td><td>Omron scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_hokuyo_max_dist</td><td>float</td><td>39.9</td><td>Hokuyo scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_leuze_rsl400_max_dist</td><td>float</td><td>65.5</td><td>Leuze scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_leuze_rsl200_max_dist</td><td>float</td><td>25.0</td><td>Leuze rsl200 scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_velodyne_max_dist</td><td>float</td><td>100.0</td><td></td></tr>
<tr><td>scan_keyence_max_dist</td><td>float</td><td>60.0</td><td></td></tr>
<tr><td>scan_uscan_max_dist</td><td>float</td><td>65.5</td><td>Sick micro/nanoScan scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_ros_max_dist</td><td>float</td><td>100.0</td><td>Maximum (virtual) scanner distance measurement from ROS [m].</td></tr>
<tr><td>scan_quanergy_m1_max_dist</td><td>float</td><td>65.5</td><td>Quanergy scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_dds_max_dist</td><td>float</td><td>100.0</td><td>DDS scanner maximum distance measurement to use.</td></tr>
<tr><td>scan_halo_ang</td><td>float</td><td>1.5</td><td>Angle [deg] for measurements to disable around detected reflectors.</td></tr>
<tr><td>scan_max_dt_err_ms</td><td>int</td><td>5</td><td>Maximum allowed difference in detected scan interval [ms] compared to expected interval.</td></tr>
<tr><td>scan_rot_cor</td><td>int</td><td>1</td><td>Enable scanner rotation correction.</td></tr>
<tr><td>scan_rot_cor_invert_dir</td><td>int</td><td>0</td><td>Invert direction in front/rear scanner rotation correction.</td></tr>
<tr><td>scan_s300_reconnect_fail_mode</td><td>int</td><td>0</td><td>Defines behaviour when reconnecting fails more than scan_s300_max_reconnect_retries times: 0 = keep reconnecting, 1 = reboot navigation software, 2 = reboot whole computer</td></tr>
<tr><td>scan_s300_max_reconnect_retries</td><td>int</td><td>0</td><td>Maximum number of reconnect retries, &gt; 3 recommended (see also scan_s300_reconnect_fail_mode).</td></tr>
<tr><td>scan_leuze_freq_ms</td><td>float</td><td>40.0</td><td></td></tr>
<tr><td>scan_omron_set_warning_zones</td><td>int</td><td>0</td><td>Enables changing Omron active scanner warning zones.</td></tr>
<tr><td>scan_leuze_use_two_prot_funcs</td><td>int</td><td>0</td><td>Select use of protective function with Leuze: 0 = only single protective function, 1 = two protective functions (4 zones in total). Only for RSL 400.</td></tr>
<tr><td>scan_leuze_warning_zone_mode</td><td>int</td><td>0</td><td>Select which warning zones to trigger from the Leuze status message. With single protective functio: 0 = protection + warning zone 1, 2 = protection + warning zone 2, 5 = warning zones 1 + 2. Only for RSL 400.</td></tr>
<tr><td>scan_pef_use_dang_old</td><td>int</td><td>0</td><td>P&amp;F angular resolution calculated using: 0 = corrected method, 1 = old method w. known issues</td></tr>
<tr><td>scan_pef_samples_per_scan</td><td>int</td><td>2400</td><td>P&amp;F scanner number of samples per scan. For example: 2400, 3600, 5040, 7200. Refer to the documentation for more valid values.</td></tr>
<tr><td>scan_pef_freq</td><td>int</td><td>25</td><td>P&amp;F scanner measurement frequency [Hz]. Refer to the documentation for valid frequency/samples per scan values.</td></tr>
<tr><td>scan_pef_use_nth_scan</td><td>int</td><td>1</td><td>Use every nth scan from scanner.</td></tr>
<tr><td>scan_pef_display_on</td><td>int</td><td>0</td><td>Determines whether the scanner led display should be left on.</td></tr>
<tr><td>scanner_dAng_factor</td><td>float</td><td>-1.0</td><td>Common scanner dAng scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995 ... 1.005)</td></tr>
<tr><td>scanner_dAng_factor_front</td><td>float</td><td>-1.0</td><td>Front scanner dAng scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995 ... 1.005)</td></tr>
<tr><td>scanner_dAng_factor_rear</td><td>float</td><td>-1.0</td><td>Rear scanner dAng scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995 ... 1.005)</td></tr>
<tr><td>scan_pef_lcm_mode</td><td>int</td><td>0</td><td>Lens Contamination Monitor (LCM) sensitivity: 0 = disabled, 1 = low, 2 = medium, 3 = high</td></tr>
<tr><td>scan_leuze_dAng_custom_increment_enabled</td><td>int</td><td>0</td><td>Enable Leuze specific custom angular resolution (dAng) correction.</td></tr>
<tr><td>scan_sick_protection_zone_safety_cutoff_path</td><td>int</td><td>0</td><td>Sick nano/microScan SafeCutOffPath number used to check protection zone violation. 0 = disabled</td></tr>
<tr><td>scan_sick_warning_zone1_safety_cutoff_path</td><td>int</td><td>0</td><td>Sick nano/microScan NonSafeCutOffPath number used to check warning zone 1 violation. 0 = disabled</td></tr>
<tr><td>scan_sick_warning_zone2_safety_cutoff_path</td><td>int</td><td>0</td><td>Sick nano/microScan NonSafeCutOffPath number used to check warning zone 2 violation. 0 = disabled</td></tr>
<tr><td>scanner_protection_zone_sensitivity</td><td>int</td><td>1</td><td>Number of consecutive scanner protection zone violations required.</td></tr>
<tr><td>scanner_front_distance_correction_leuze</td><td>float</td><td>0.0</td><td>Leuze only: Front scanner distance measurement correction value [m].</td></tr>
<tr><td>scanner_rear_distance_correction_leuze</td><td>float</td><td>0.0</td><td>Leuze only: Rear scanner distance measurement correction value [m].</td></tr>
<tr><td>scan_n_buffered_meas</td><td>int</td><td>0</td><td>Defines how many measurements that are kept in the buffer for sick s300.</td></tr>
<tr><td>scan_rot_corr_max_ninterp</td><td>int</td><td>5</td><td></td></tr>
<tr><td>scanner_heading_offset_gain</td><td>float</td><td>0.01</td><td>Heading auto correction gain for right scanner when using two scanners for reflector pattern detection, 0 to disable.</td></tr>
<tr><td>scanner_pos_x_offset_gain</td><td>float</td><td>0.01</td><td>Scanner x-position auto correction gain for right scanner when using two scanners for reflector pattern detection, 0 to disable.</td></tr>
<tr><td>scanner_pos_y_offset_gain</td><td>float</td><td>0.01</td><td>Scanner y-position auto correction gain for right scanner when using two scanners for reflector pattern detection, 0 to disable.</td></tr>
</tbody></table>
<h3 id="ethernet-supervisor"><a class="header" href="#ethernet-supervisor">Ethernet supervisor</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>supervisor_safety_scanner_enabled</td><td>int</td><td>0</td><td>Enables supervisor safety scanner.</td></tr>
<tr><td>supervisor_speedlimit_clear_on_standby</td><td>int</td><td>1</td><td>When state is changed to STANDBY: 0 = Do not clear speed limit, 1 = Clear speed limit</td></tr>
<tr><td>supervisor_ctrl_max_nbr_invalid_feedback</td><td>int</td><td>1</td><td>Maximum number of consecutive invalid feedback messages from Supervisor.</td></tr>
<tr><td>veh_inte_heartbeat_interval</td><td>int</td><td>0</td><td>Defines how often the error message is sent to supervisor [ms]. 0 = Periodic sending disabled.</td></tr>
<tr><td>veh_inte_error_message_type</td><td>int</td><td>0</td><td>Defines which error message will be sent: 0 = basic (201), 1 = with error levels (202)</td></tr>
<tr><td>veh_inte_error_message_mode</td><td>int</td><td>2</td><td>Defines if active errors, warnings or both are sent in supervisor error message: 0 = Do not send the error message, 1 = Send only errors, 2 = send errors and warnings.</td></tr>
<tr><td>veh_inte_error_message_send_only_on_request</td><td>int</td><td>1</td><td>0 = send errors/warnings if active errors change, 1 = send active errors only on request (or periodically, if veh_inte_heartbeat_interval &gt; 0).</td></tr>
<tr><td>veh_inte_error_message_send_only_active_errors</td><td>int</td><td>1</td><td>0 = send errors/warnings if they have been active and not sent yet, 1 = send only active errors/warnings.</td></tr>
<tr><td>veh_inte_env_read_rply_msg</td><td>int</td><td>1</td><td>Defines if environment read message (1108) will be sent every time environment is loaded: 0 = disabled, 1 = enabled.</td></tr>
<tr><td>veh_inte_sym_point_rply_msg</td><td>int</td><td>1</td><td>Defines if symbolic point data message (3103) will be sent every time when segment file is loaded: 0 = disabled, 1 = enabled.</td></tr>
<tr><td>veh_inte_send_drive_ready_msg</td><td>int</td><td>0</td><td>Defines if drive ready message (3129) will be sent every time AGV finishes a drive order: 0 = disabled, 1 = enabled.</td></tr>
<tr><td>veh_inte_target_symbolic_point_info_interval_ms</td><td>int</td><td>0</td><td>Defines the time interval [ms] for sending target symbolic point information message (6103). 0 = disabled.</td></tr>
<tr><td>supervisor_ctrl_speed_scale_in</td><td>float</td><td>1.0</td><td>Speed scale for supervisor controlled machine types. Incoming speed measurements are multiplied by this value.</td></tr>
<tr><td>supervisor_ctrl_speed_scale_out</td><td>float</td><td>1.0</td><td>Speed scale for supervisor controlled machine types. Outgoing speed references are divided by this value.</td></tr>
<tr><td>eth_ctrl_check_brake</td><td>int</td><td>1</td><td>Enables check for brake release before driving.</td></tr>
<tr><td>eth_set_speed_ref_prior_to_drive</td><td>int</td><td>0</td><td>Enables setting speed reference before driving. Can be useful e.g. to give direction of movement to safety system.</td></tr>
<tr><td>supervisor_eth_ip</td><td>string</td><td>192.168.2.141</td><td>Supervisor IP address. Needed if Supervisor works as a server.</td></tr>
<tr><td>supervisor_eth_port</td><td>int</td><td>5015</td><td>Supervisor communication server side port</td></tr>
<tr><td>supervisor_eth_server</td><td>int</td><td>1</td><td>Defines whether Supervisor is server or client: 0 = client, 1 = server</td></tr>
<tr><td>supervisor_eth_endianness</td><td>int</td><td>0</td><td>Defines Supervisor data endianness, 0 - little endian, 1 - big endian</td></tr>
<tr><td>supervisor_eth_enabled</td><td>int</td><td>0</td><td>Enables Supervisor interface</td></tr>
<tr><td>supervisor_eth_odometry_receive_timeout_ms</td><td>int</td><td>250</td><td>Defines a communication alive time limit for supervisor communication when odometry is received from supervisor. If no messages are received within the defined time, Navitrol tries to reconnect to socket.</td></tr>
<tr><td>supervisor_eth_receive_timeout_ms</td><td>int</td><td>5000</td><td>Defines a communication alive time limit for supervisor communication. If no messages are received within the defined time, Navitrol tries to reconnect to socket.</td></tr>
<tr><td>supervisor_eth2_ip</td><td>string</td><td>1.1.1.1</td><td>Secondary Supervisor IP address. Needed if Supervisor works as a server.</td></tr>
<tr><td>supervisor_eth2_port</td><td>int</td><td>5016</td><td>Secondary Supervisor communication server side port.</td></tr>
<tr><td>supervisor_eth2_server</td><td>int</td><td>1</td><td>Defines whether secondary Supervisor is server or client: 0 = client, 1 = server</td></tr>
<tr><td>supervisor_eth2_endianness</td><td>int</td><td>0</td><td>Defines secondary Supervisor data endianness: 0 = little endian, 1 = big endian</td></tr>
<tr><td>supervisor_eth2_enabled</td><td>int</td><td>0</td><td>Enables secondary Supervisor interface.</td></tr>
<tr><td>agv_supervisor_custom_errors_max</td><td>int</td><td>0</td><td>Maximum number of supervisor errors/warnings sent to fleet control.</td></tr>
<tr><td>eth_ctrl_msgnum_validate</td><td>int</td><td>1</td><td>When enabled Navitrol will validate that the message numbers in received supervisor control messages increase by one between each message: 0 = disabled, 1 = Enabled</td></tr>
<tr><td>veh_inte_cums_overflow</td><td>uint</td><td>0xFFFFFFFFU</td><td>Defines the encoder overflow value when using differential drive odometry.</td></tr>
<tr><td>veh_inte_manual_ang_vel</td><td>float</td><td>0.785</td><td>Maximum angular velocity [rad/s] for manual control from supervisor.</td></tr>
<tr><td>supervisor_remote_ctrl_speed_scale_pct</td><td>float</td><td>50.0</td><td>Speed scale 10-100% from maximum wheel speed. Applied when remote control status section is used in the Ethernet supervisor interface.</td></tr>
<tr><td>agv_plc_ip</td><td>string</td><td>192.168.1.158</td><td>IP address of the onboard PLC.</td></tr>
<tr><td>use_supervisor_standard_comms</td><td>int</td><td>0</td><td>0 = use custom messages, 1 = use standard supervisor messages</td></tr>
<tr><td>use_supervisor_standard_drive_ctrl_section</td><td>int</td><td>0</td><td>0 = Using custom manual (e-15 key) feature, 1 = Use standard drive control section</td></tr>
<tr><td>supervisor_can_enabled</td><td>int</td><td>0</td><td>Enables CAN based supervisor interface.</td></tr>
<tr><td>supervisor_can_nodeid_arr</td><td>int[]</td><td>0</td><td>CAN node ID of supervisor PLC. 0 = disabled</td></tr>
<tr><td>supervisor_can_nodeid_mode_arr</td><td>int[]</td><td>0</td><td>Mode for node ID at corresponding index: 0 = slave - Navigation SW transmits RPDOs, 1 = master - Navigation SW transmits TPDOs.</td></tr>
<tr><td>supervisor_can_rx_timeout_ms</td><td>int</td><td>0</td><td>Timeout of PDOs received by Navigation SW.</td></tr>
<tr><td>supervisor_can_tx_interval_ms</td><td>int</td><td>0</td><td>Tranmsission interval of PDOs transmitted by Navigation SW.</td></tr>
<tr><td>supervisor_can_tx1_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message transmitted by Navigation SW to CAN bus on PDO 1.</td></tr>
<tr><td>supervisor_can_tx2_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message transmitted by Navigation SW to CAN bus on PDO 2.</td></tr>
<tr><td>supervisor_can_tx3_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message transmitted by Navigation SW to CAN bus on PDO 3.</td></tr>
<tr><td>supervisor_can_tx4_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message transmitted by Navigation SW to CAN bus on PDO 4.</td></tr>
<tr><td>supervisor_can_rx1_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message received by Navigation SW from CAN bus on PDO 1.</td></tr>
<tr><td>supervisor_can_rx2_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message received by Navigation SW from CAN bus on PDO 2.</td></tr>
<tr><td>supervisor_can_rx3_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message received by Navigation SW from CAN bus on PDO 3.</td></tr>
<tr><td>supervisor_can_rx4_typeid_arr</td><td>int[]</td><td>0</td><td>Type ID of message received by Navigation SW from CAN bus on PDO 4.</td></tr>
</tbody></table>
<h3 id="motor-controller"><a class="header" href="#motor-controller">Motor controller</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>mot_ctrl_watchdog_ms</td><td>int</td><td>200</td><td>Motor control hardware watchdog timeout [ms].</td></tr>
<tr><td>mot_ctrl_drive_angle_diag_time_ms</td><td>int</td><td>200</td><td>Maximum time [ms] steer angle is detected to be controlled in the wrong direction. Value 0 disables diagnostics.</td></tr>
<tr><td>mot_ctrl_drive_dir_diag_time_ms</td><td>int</td><td>250</td><td>Maximum time [ms] motor is detected to run in wrong direction. Value 0 disables diagnostics.</td></tr>
<tr><td>mot_ctrl_serial_port</td><td>string</td><td>/dev/ttyS2</td><td>Serial port for first Roboteq controller (steer/diff).</td></tr>
<tr><td>mot_ctrl_serial_port2</td><td>string</td><td>/dev/ttyS2</td><td>Serial port for second Roboteq controller (mecanum).</td></tr>
<tr><td>mot_ctrl_left_inv_in</td><td>int</td><td>-1</td><td>Input inversion for the left wheel of diff drive: -1 = copies value of mot_ctrl_left_inv_out, 0 = disabled, 1 = enabled</td></tr>
<tr><td>mot_ctrl_right_inv_in</td><td>int</td><td>-1</td><td>Input inversion for the right wheel of diff drive: -1 = copies value of mot_ctrl_right_inv_out, 0 = disabled, 1 = enabled</td></tr>
<tr><td>mot_ctrl_left_inv_out</td><td>int</td><td>0</td><td>Output inversion for the left wheel of diff drive: 0 = disabled, 1 = enabled</td></tr>
<tr><td>mot_ctrl_right_inv_out</td><td>int</td><td>0</td><td>Output inversion for the right wheel of diff drive: 0 = disabled, 1 = enabled</td></tr>
<tr><td>mot_ctrl_steer_v_inv_out</td><td>int</td><td>0</td><td>Enables inversion of steering motor output.</td></tr>
<tr><td>mot_ctrl_steer_v_inv_in</td><td>int</td><td>0</td><td>Enables inversion of steer angle input.</td></tr>
<tr><td>mot_ctrl_wheel_v_inv_in</td><td>int</td><td>-1</td><td>Input inversion for the driving wheel of steer drive: -1 = copies value of mot_ctrl_wheel_v_inv_out, 0 = disabled, 1 = enabled</td></tr>
<tr><td>mot_ctrl_wheel_v_inv_out</td><td>int</td><td>0</td><td>Output inversion for the driving wheel of steer drive: 0 = disabled, 1 = enabled</td></tr>
<tr><td>mot_ctrl_drive_min_output</td><td>int</td><td>0</td><td>Minimum output (absolute value) sent to the motor controller (cutoff point). Not used for steer drive.</td></tr>
<tr><td>mot_ctrl_drive_max_output</td><td>int</td><td>1000</td><td>Maximum output (absolute value) sent to the motor controller (cutoff point). Not used for steer drive.</td></tr>
<tr><td>mot_ctrl_drive_max_stall_output_pct</td><td>float</td><td>40.0</td><td>Percentage of maximum output sent to the motor controller when AGV is at stall (AGV not moving with non-zero reference).</td></tr>
<tr><td>mot_ctrl_max_output_current_percent</td><td>int</td><td>100</td><td>Maximum output current (percent) sent to the motor controller.</td></tr>
<tr><td>mot_ctrl_enable_ctrl_token_switching</td><td>int</td><td>0</td><td>Enables Ctrl token switching.</td></tr>
<tr><td>mot_ctrl_left_dist_scale</td><td>float</td><td>-0.000001</td><td>Convert encoder pulses of the left wheel to driven distance [m] (differential drive).</td></tr>
<tr><td>mot_ctrl_right_dist_scale</td><td>float</td><td>-0.000001</td><td>Convert encoder pulses of the right wheel to driven distance [m] (differential drive).</td></tr>
<tr><td>mot_ctrl_drive_dist_scale</td><td>float</td><td>-0.000001</td><td>Convert encoder pulses of the drive wheels to driven distance [m] (steer, mecanum, omni).</td></tr>
<tr><td>mot_ctrl_drive_rpm_to_m_per_s</td><td>float</td><td>0.0001</td><td>Convert measured RPM of the wheel's motor to the velocity of the wheel [m/s].</td></tr>
<tr><td>mot_ctrl_steer_ang_offset_deg</td><td>float</td><td>0.0</td><td>Offset to correct error in AGV's steering angle [deg].</td></tr>
<tr><td>mot_ctrl_steer_ang_scale</td><td>float</td><td>1.0</td><td>Multiplier to correct error in AGV's steering angle scale.</td></tr>
<tr><td>mot_ctrl_turn_rate_in_scale</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>mot_ctrl_turn_rate_out_scale</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>mot_ctrl_speed_in_long_scale</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>mot_ctrl_speed_out_long_scale</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>mot_ctrl_speed_in_lat_scale</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>mot_ctrl_speed_out_lat_scale</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>mot_ctrl_max_wheel_v_fw</td><td>float</td><td>0.8</td><td>Default maximum drive wheel velocity when driving forwards [m/s]</td></tr>
<tr><td>mot_ctrl_max_wheel_v_bw</td><td>float</td><td>0.8</td><td>Default maximum drive wheel velocity when driving in reverse [m/s]</td></tr>
<tr><td>mot_ctrl_max_wheel_acc</td><td>float</td><td>0.5</td><td>Default maximum drive wheel acceleration [m/s^2]. The reference speed is ramped up based on this value.</td></tr>
<tr><td>mot_ctrl_max_wheel_dec</td><td>float</td><td>0.5</td><td>Default maximum drive wheel deceleration [m/s^2]. The reference speed is ramped down based on this value.</td></tr>
<tr><td>mot_ctrl_output_lowpass_alpha</td><td>float</td><td>1.0</td><td>Applies filter to steer and velocity outputs. Default value for no filtering</td></tr>
<tr><td>mot_ctrl_max_steer_rate_deg_p_s</td><td>float</td><td>30.0</td><td>Maximum wheel steering rate [deg/s]. Limits the speed of the planned trajectory.</td></tr>
<tr><td>mot_ctrl_max_steer_rate_scale</td><td>float</td><td>3.0</td><td>Scale factor for mot_ctrl_max_steer_rate_deg_p_s used during driving to limit the reference steering angle change.</td></tr>
<tr><td>mot_ctrl_max_steer_ang_deg</td><td>float</td><td>90.0</td><td>Maximum angle limit for the steer wheel.</td></tr>
<tr><td>mot_ctrl_min_steer_ang_deg</td><td>float</td><td>-90.0</td><td>Minimum angle limit for the steer wheel.</td></tr>
<tr><td>mot_ctrl_max_wheel_dec_ramped_fast_stop</td><td>float</td><td>0.0</td><td>Maximum wheel deceleration during ramped fast stop. Only used if larger than mot_ctrl_max_wheel_dec</td></tr>
<tr><td>mot_ctrl_forced_velocity_ramping_enabled</td><td>int</td><td>0</td><td>Enabels that the speed reference is forced to always follow acc and dec ramps.</td></tr>
<tr><td>mot_ctrl_max_wheel_v_fw_arr</td><td>float[]</td><td>0.8</td><td>Default maximum drive wheel velocity when driving forwards [m/s] that can be selected to replace the default limit.</td></tr>
<tr><td>mot_ctrl_max_wheel_v_bw_arr</td><td>float[]</td><td>0.8</td><td>Default maximum drive wheel velocity when driving in reverse [m/s] that can be selected to replace the default limit.</td></tr>
<tr><td>mot_ctrl_max_wheel_acc_arr</td><td>float[]</td><td>0.5</td><td>Default maximum drive wheel acceleration [m/s^2] that can be selected to replace the default limit. The reference speed is ramped up based on this value.</td></tr>
<tr><td>mot_ctrl_max_wheel_dec_arr</td><td>float[]</td><td>0.5</td><td>Default maximum drive wheel deceleration [m/s^2] that can be selected to replace the default limit. The reference speed is ramped down based on this value.</td></tr>
<tr><td>mot_ctrl_max_steer_rate_deg_p_s_arr</td><td>float[]</td><td>30.0</td><td>Maximum wheel steering rate [deg/s] that can be selected to replace the default limit. Limits the speed of the planned trajectory.</td></tr>
<tr><td>mot_ctrl_steer_ang_p</td><td>float</td><td>1.0</td><td>Proportional gain for steering motor control.</td></tr>
<tr><td>mot_ctrl_steer_ang_d</td><td>float</td><td>1.0</td><td>Derivative gain for steering motor control.</td></tr>
<tr><td>mot_ctrl_steer_ang_i</td><td>float</td><td>1.0</td><td>Integral gain for steering motor control.</td></tr>
<tr><td>mot_ctrl_steer_ang_deadband_deg</td><td>float</td><td>0.25</td><td>Steering angle deadband.</td></tr>
<tr><td>mot_ctrl_wheel_v_p</td><td>float</td><td>1.0</td><td>Proportional gain for driving motor in forward direction.</td></tr>
<tr><td>mot_ctrl_wheel_v_d</td><td>float</td><td>1.0</td><td>Derivative gain for driving motor in forward direction.</td></tr>
<tr><td>mot_ctrl_wheel_v_i</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>mot_ctrl_wheel_v_rev_p</td><td>float</td><td>1.0</td><td>Proportional gain for driving motor in backward direction.</td></tr>
<tr><td>mot_ctrl_wheel_v_rev_d</td><td>float</td><td>1.0</td><td>Derivative gain for driving motor in backward direction.</td></tr>
<tr><td>mot_ctrl_diffunit_left_inv_input</td><td>int[]</td><td>0</td><td>Enables input inversion for diffunit left wheel.</td></tr>
<tr><td>mot_ctrl_diffunit_right_inv_input</td><td>int[]</td><td>0</td><td>Enables input inversion for diffunit right wheel.</td></tr>
<tr><td>mot_ctrl_diffunit_left_inv_output</td><td>int[]</td><td>0</td><td>Enables output inversion for diffunit left wheel.</td></tr>
<tr><td>mot_ctrl_diffunit_right_inv_output</td><td>int[]</td><td>0</td><td>Enables output inversion for diffunit right wheel.</td></tr>
<tr><td>mot_ctrl_left_p</td><td>float</td><td>1.0</td><td>Proportional gain for controlling left motor speed. Valid only for motor controllers that do not have internal PID.</td></tr>
<tr><td>mot_ctrl_left_d</td><td>float</td><td>1.0</td><td>Derivative gain for controlling left motor speed. Valid only for motor controllers that do not have internal PID.</td></tr>
<tr><td>mot_ctrl_right_p</td><td>float</td><td>1.0</td><td>Proportional gain for controlling right motor speed. Valid only for motor controllers that do not have internal PID.</td></tr>
<tr><td>mot_ctrl_right_d</td><td>float</td><td>1.0</td><td>Derivative gain for controlling right motor speed. Valid only for motor controllers that do not have internal PID.</td></tr>
<tr><td>mot_ctrl_mecanum_roboteq1_channel1_wheel</td><td>int</td><td>0</td><td>Maps channel of roboteq controller to wheel index.  Indexes are 0 = FL (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right). For example, mot_ctrl_mecanum_roboteq1_channel1_wheel, 0 would mean that channel 1 of motor controller with node id defined in can_roboteq_nodeid[0] would be wheel 0 = FL.</td></tr>
<tr><td>mot_ctrl_mecanum_roboteq1_channel2_wheel</td><td>int</td><td>1</td><td>Maps channel of roboteq controller to wheel index.  Indexes are 0 = FL (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right). For example, mot_ctrl_mecanum_roboteq1_channel2_wheel, 1 would mean that channel 2 of motor controller with node id defined in can_roboteq_nodeid[0] would be wheel 1 = FR.</td></tr>
<tr><td>mot_ctrl_mecanum_roboteq2_channel1_wheel</td><td>int</td><td>2</td><td>Maps channel of roboteq controller to wheel index.  Indexes are 0 = FL (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right). For example, mot_ctrl_mecanum_roboteq2_channel1_wheel, 2 would mean that channel 1 of motor controller with node id defined in can_roboteq_nodeid[1] would be wheel 2 = RL.</td></tr>
<tr><td>mot_ctrl_mecanum_roboteq2_channel2_wheel</td><td>int</td><td>3</td><td>Maps channel of roboteq controller to wheel index.  Indexes are 0 = FL (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right). For example, mot_ctrl_mecanum_roboteq2_channel2_wheel, 3 would mean that channel 2 of motor controller with node id defined in can_roboteq_nodeid[1] would be wheel 3 = RR.</td></tr>
<tr><td>mot_ctrl_mecanum_roboteq3_channel1_wheel</td><td>int</td><td>2</td><td>Maps channel of roboteq controller to wheel index.  Indexes are 0 = FL (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right).</td></tr>
<tr><td>mot_ctrl_mecanum_roboteq4_channel1_wheel</td><td>int</td><td>3</td><td>Maps channel of roboteq controller to wheel index.  Indexes are 0 = FL (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right).</td></tr>
<tr><td>mot_ctrl_mecanum_nodeid</td><td>int[]</td><td>0</td><td>CANopen NodeId. 0 = not defined, Indexes are 0 = FF (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right).</td></tr>
<tr><td>mot_ctrl_mecanum_inv_output</td><td>int[]</td><td>0</td><td>Enables output inversion for mecanum AGV. Indexes are 0 = FL, 1 = FR, 2 = RL, 3 = RR.</td></tr>
<tr><td>mot_ctrl_mecanum_inv_input</td><td>int[]</td><td>0</td><td>Enables input inversion for mecanum AGV. Indexes are 0 = FL, 1 = FR, 2 = RL, 3 = RR.</td></tr>
<tr><td>mot_ctrl_mecanum_p</td><td>float[]</td><td>1.0</td><td>Proportional gain for motor speed. Used for motor controllers without internal PID controller. Indexes are 0 = FL, 1 = FR, 2 = RL, 3 = RR.</td></tr>
<tr><td>mot_ctrl_mecanum_d</td><td>float[]</td><td>1.0</td><td>Derivative gain for motor speed. Used for motor controllers without internal PID controller. Indexes are 0 = FL, 1 = FR, 2 = RL, 3 = RR.</td></tr>
<tr><td>mot_ctrl_nanotec_p_gain</td><td>int</td><td>60000</td><td>Nanotec motor controller proportional gain.</td></tr>
<tr><td>mot_ctrl_nanotec_i_gain</td><td>int</td><td>500</td><td>Nanotec motor controller integral gain.</td></tr>
<tr><td>mot_ctrl_steer_min_output</td><td>float</td><td>5.0</td><td>Minimum output sent to the steering motor. Not used if array parameters (mot_ctrl_steer_min_output_arr[] mot_ctrl_steer_max_output_arr[]) defined.</td></tr>
<tr><td>mot_ctrl_steer_min_output_arr</td><td>float[]</td><td>1.0</td><td>Minimum output sent to the steering motor. If set, non-array parameters (mot_ctrl_steer_min_output, mot_ctrl_steer_max_output) are not used.</td></tr>
<tr><td>mot_ctrl_steer_max_output</td><td>float</td><td>999.0</td><td>Maximum output sent to the steering motor. Not used if array parameters (mot_ctrl_steer_min_output_arr[] mot_ctrl_steer_max_output_arr[]) defined.</td></tr>
<tr><td>mot_ctrl_steer_max_output_arr</td><td>float[]</td><td>4999.0</td><td>Maximum output sent to the steering motor. If set, non-array parameters (mot_ctrl_steer_min_output, mot_ctrl_steer_max_output) are not used.</td></tr>
<tr><td>mot_ctrl_wheel_v_min</td><td>float</td><td>0.0005</td><td>Vehicle is thought to be standing still when measured wheel speed is below this value [m/s].</td></tr>
<tr><td>mot_ctrl_wheel_v_out_dead_band</td><td>float</td><td>20.0</td><td></td></tr>
<tr><td>mot_ctrl_steer_ang_out_dead_band</td><td>float</td><td>20.0</td><td>Steering motor deadband.</td></tr>
<tr><td>mot_ctrl_steer_ang_stopped_deadband_deg</td><td>float</td><td>2.0</td><td>Steering angle deadband when AGV is stopped.</td></tr>
<tr><td>mot_ctrl_steer_ang_meas_min_limit_deg</td><td>float</td><td>-120.0</td><td>Minimum limit for measured steering angle. Used for unit conversion.</td></tr>
<tr><td>mot_ctrl_steer_ang_meas_max_limit_deg</td><td>float</td><td>120.0</td><td>Maximum limit for measured steering angle. Used for unit conversion.</td></tr>
<tr><td>mot_ctrl_steer_ang_target_min_limit_deg</td><td>float</td><td>-90.0</td><td>Minimum limit for target steering angle. Used for unit conversion.</td></tr>
<tr><td>mot_ctrl_steer_ang_target_max_limit_deg</td><td>float</td><td>90.0</td><td>Maximum limit for target steering angle. Used for unit conversion.</td></tr>
<tr><td>mot_ctrl_steer_driving_min_output</td><td>float</td><td>0.0</td><td>Minimum output sent to the driving motor. Applicable only for steer AGV.</td></tr>
<tr><td>mot_ctrl_steer_driving_max_output</td><td>float</td><td>9999.0</td><td>Maximum output sent to the driving motor. Applicable only for steer AGV.</td></tr>
<tr><td>mot_ctrl_v_deadband</td><td>float</td><td>0.05</td><td>Wheel speed deadband.</td></tr>
<tr><td>mot_ctrl_calib_v0</td><td>float</td><td>0.5</td><td>Motor controller calibration speed 0.</td></tr>
<tr><td>mot_ctrl_calib_v1</td><td>float</td><td>0.1</td><td>Motor controller calibration speed 1.</td></tr>
<tr><td>mot_ctrl_odo_from_speed</td><td>int</td><td>1</td><td></td></tr>
<tr><td>mot_ctrl_odo_steer_type_irob</td><td>int</td><td>0</td><td>0 = rear odo, front steer, 1 = bicycle model</td></tr>
<tr><td>mot_ctrl_steer_angle_hard_limit_deg</td><td>float</td><td>90.0</td><td>Steer drive AGV hard angle limit. 0.0 to disable.</td></tr>
<tr><td>mot_ctrl_steer_torque_mNm</td><td>int</td><td>0</td><td>Torque set to the steering motor controller.</td></tr>
<tr><td>mot_ctrl_drive_torque_mNm</td><td>int</td><td>0</td><td>Torque set to the driving motor controller.</td></tr>
<tr><td>mot_ctrl_reset_errors_timer</td><td>int</td><td>500</td><td>After the defined time [ms] Navigation SW tries automatically reset motor control faults. Value 0 = fault reset disabled</td></tr>
<tr><td>mot_ctrl_curtis_reboot_controller_timer_ms</td><td>int</td><td>5000</td><td>After the defined time [ms] Navigation SW tries to reboot Curtis motor controller in order to clear faults. Value 0 = controller reboot disabled</td></tr>
<tr><td>mot_ctrl_curtis_max_number_reboot_controller</td><td>int</td><td>2</td><td>Maximum number of attemts to reboot the motor controller in order to clear faults.</td></tr>
<tr><td>mot_ctrl_odometry_from_rpm</td><td>int</td><td>1</td><td>Source of odometry: 0 = encoder, 1 = rpm</td></tr>
<tr><td>filt_gain_raw_speed_input</td><td>float</td><td>0.0</td><td>Smoothing raw speed input from motor controller.</td></tr>
<tr><td>mot_ctrl_disable_main_contactor_ms</td><td>int</td><td>0</td><td>Disable main contactor to save energy after standing still for the defined time. 0 = disable this feature.</td></tr>
<tr><td>mot_ctrl_disable_delay_ms</td><td>int</td><td>1000</td><td>Motor controller disabling delay [ms] after activating brakes: -1 = never disable, 0 = no delay</td></tr>
<tr><td>mot_ctrl_startup_delay_main_contactor_ms</td><td>int</td><td>0</td><td>Time given for main contactor to stabilize before enabling drive. 0 = no delay, 500 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_startup_delay_drive_enable_ms</td><td>int</td><td>0</td><td>Time given for driveEnable to take hold before releasing brakes. 0 = no delay, 100 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_startup_delay_brake_release_ms</td><td>int</td><td>0</td><td>Time given for brakes to fully open before giving rpm out. 0 = no delay, 200 = recommended for Schwarzmueller, 100..300 = recommended for Curtis.</td></tr>
<tr><td>mot_ctrl_omni_steer_angle_hard_limit_deg_pos</td><td>float[]</td><td>0.0</td><td>Sets an error if the control or sensor value exceeds this value. The CAN control output is cut at this positive limit. Value 0.0 for no limit. Only used for omnis with CAN interface.</td></tr>
<tr><td>mot_ctrl_omni_steer_angle_hard_limit_deg_neg</td><td>float[]</td><td>0.0</td><td>Sets error if the control or sensor value goes below this value. The CAN control output is cut at this negative limit. Value 0.0 for no limit. Only used for omnis with CAN interface.</td></tr>
<tr><td>mot_ctrl_steer_type</td><td>int[]</td><td>1</td><td>Type of the motor controller for steering: 1 = Schwarzmueller, 2 = Engel</td></tr>
<tr><td>mot_ctrl_omni_speed_inv_input</td><td>int[]</td><td>0</td><td>Inversion of speed input if the sensor gives negative speed when the wheel is rotated forwards. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_speed_inv_output</td><td>int[]</td><td>0</td><td>Inversion of speed output if a positive reference gives a negative speed. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_speed_p</td><td>float[]</td><td>1.0</td><td>Speed control proportional gain for each wheel. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_speed_d</td><td>float[]</td><td>1.0</td><td>Speed control derivative gain for each wheel. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_steer_inv_input</td><td>int[]</td><td>0</td><td>Inversion of steer angle input if the sensor value increases clockwise. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_steer_inv_output</td><td>int[]</td><td>0</td><td>Inversion of steer motor output if a positive reference gives a clockwise wheel turning. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_steer_p</td><td>float[]</td><td>1.0</td><td>Steer control proportional gain for each wheel. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_steer_d</td><td>float[]</td><td>1.0</td><td>Steer control derivative gain for each wheel. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_steer_i</td><td>float[]</td><td>1.0</td><td>Steer control integral gain for each wheel. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_omni_speed_control_used</td><td>int[]</td><td>0</td><td>1 indicates wheels with speed control. Indexes according to customer wheel numbering.</td></tr>
<tr><td>mot_ctrl_engel_p_gain</td><td>float</td><td>0.2</td><td>Engel motor controller proportinal gain.</td></tr>
<tr><td>mot_ctrl_engel_i_time_ms</td><td>float</td><td>4.0</td><td>Engel motor controller integration time [ms].</td></tr>
<tr><td>mot_ctrl_engel_home_offset</td><td>int</td><td>0</td><td>Engel motor controller homing offset.</td></tr>
<tr><td>mot_ctrl_engel_estop_enabled</td><td>int</td><td>1</td><td>Engel emergency stop activation. Emergency stop activation comes from digital input 8 (BU-RD wire). DI8 should be powered in normal mode.</td></tr>
<tr><td>mot_ctrl_micontrol_estop_check_enabled</td><td>int</td><td>1</td><td>Activates MiControl E-STOP check. Emergency stop activation comes from digital input 6 and 7 (STO-A and STO-B).</td></tr>
<tr><td>mot_ctrl_simulated_drive_controller_type_arr</td><td>int[]</td><td>MOTOR_CONTROLLER_TYPE_SIMULATED</td><td>Type of the simulated drive motor controller: -1 - Single channel simulated motor controller</td></tr>
<tr><td>mot_ctrl_drive_controller_type_arr</td><td>int[]</td><td>MOTOR_CONTROLLER_TYPE_NOT_DEFINED</td><td>Type of the drive motor controller: 0 - none, 1 - Schwarzmueller (not implemented), 2 - Engel (not implemented) 3 - Nanotec, 4 - Kinco, 5 - Roboteq single channel, 6 - Roboteq dual channel 1, 7 - Roboteq dual channel 2</td></tr>
<tr><td>mot_ctrl_drive_can_nodeid_arr</td><td>int[]</td><td>0</td><td>Motor controller CAN node id for drive motor controller. 0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_drive_inv_input_arr</td><td>int[]</td><td>0</td><td>Invert drive motor controller input. 0 = no inversion, 1 = invert input</td></tr>
<tr><td>mot_ctrl_drive_inv_output_arr</td><td>int[]</td><td>0</td><td>Invert drive motor controller output. 0 = no inversion, 1 = invert output,</td></tr>
<tr><td>mot_ctrl_drive_min_output_arr</td><td>int[]</td><td>-1</td><td>Minimum output sent to the drive motor controller (cutoff point). -1 = this parameter not used</td></tr>
<tr><td>mot_ctrl_drive_max_output_arr</td><td>int[]</td><td>-1</td><td>Maximum output sent to the drive motor controller (cutoff point). -1 = this parameter not used</td></tr>
<tr><td>mot_ctrl_drive_max_stall_output_pct_arr</td><td>float[]</td><td>0.0</td><td>Percentage of maximum output sent to the drive motor controller when AGV is at stall (AGV not moving with non-zero reference). 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_dist_scale_arr</td><td>float[]</td><td>0.0</td><td>Distance scale for drive motor controller. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_rpm_to_m_per_s_arr</td><td>float[]</td><td>0.0</td><td>Value used to convert drive motor controller rpm to m/s. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_torque_mNm_arr</td><td>int[]</td><td>-1</td><td>Torque value (milli Newton meter) send to drive motor controller. -1 = this parameter not used</td></tr>
<tr><td>mot_ctrl_drive_p_arr</td><td>float[]</td><td>0.0</td><td>P value of the drive motor controller. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_i_arr</td><td>float[]</td><td>0.0</td><td>I value of the drive motor controller. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_d_arr</td><td>float[]</td><td>0.0</td><td>D value of the drive motor controller. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_estop_enabled_arr</td><td>int[]</td><td>-1</td><td>Emergency stop activation for drive motor controller, -1 = this parameter not used, 0 = estop not used, 1 = estop used</td></tr>
<tr><td>mot_ctrl_drive_disable_delay_ms_arr</td><td>int[]</td><td>-1</td><td>Drive motor controller disabling delay after activating brakes in ms, -1 = this parameter not used, 0 = no delay, 300 = recommended for Schwarzmueller</td></tr>
<tr><td>mot_ctrl_drive_startup_delay_main_contactor_ms_arr</td><td>int[]</td><td>-1</td><td>Time given in ms for drive motor controller main contactor to stabilize before enabling drive. -1 = this parameter not used, 0 = no delay, 500 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_drive_startup_delay_drive_enable_ms_arr</td><td>int[]</td><td>-1</td><td>Time given in ms for driveEnable to take hold before releasing brakes on drive motor controller. -1 = this parameter not used, 0 = no delay, 100 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_drive_startup_delay_brake_release_ms_arr</td><td>int[]</td><td>-1</td><td>Time given in ms for brakes to fully open before giving rpm out to drive motor controller. -1 = this parameter not used, 0 = no delay, 200 = recommended for Schwarzmueller, 100..300 = recommended for Curtis</td></tr>
<tr><td>mot_ctrl_drive_reset_errors_timer_ms_arr</td><td>int[]</td><td>-1</td><td>After the defined time (ms) Navigation SW tries automatically reset drive motor controller faults. -1 = this parameter not used, 0 = fault reset disabled</td></tr>
<tr><td>mot_ctrl_drive_disable_main_contactor_ms_arr</td><td>int[]</td><td>-1</td><td>Disable drive motor controller main contactor to save energy after standing still for the defined time (ms), -1 = this parameter not used, 0 = disable this feature</td></tr>
<tr><td>mot_ctrl_drive_encoder_pulses_per_rev_arr</td><td>uint[]</td><td>0</td><td>Encoder resolution (pulses per revolution) used to calculate RPM if drive motor controller does not provide that. 0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_drive_p</td><td>float</td><td>0.0</td><td>P value of the drive motor controller. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_i</td><td>float</td><td>0.0</td><td>I value of the drive motor controller. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_d</td><td>float</td><td>0.0</td><td>D value of the drive motor controller. 0.0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_estop_enabled</td><td>int</td><td>-1</td><td>Emergency stop activation for drive motor controller, -1 = this parameter not used, 0 = estop not used, 1 = estop used</td></tr>
<tr><td>mot_ctrl_drive_disable_delay_ms</td><td>int</td><td>-1</td><td>Drive motor controller disabling delay after activating brakes in ms, -1 = this parameter not used, 0 = no delay, 300 = recommended for Schwarzmueller</td></tr>
<tr><td>mot_ctrl_drive_startup_delay_main_contactor_ms</td><td>int</td><td>-1</td><td>Time given in ms for drive motor controller main contactor to stabilize before enabling drive. -1 = this parameter not used, 0 = no delay, 500 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_drive_startup_delay_drive_enable_ms</td><td>int</td><td>-1</td><td>Time given in ms for driveEnable to take hold before releasing brakes on drive motor controller. -1 = this parameter not used, 0 = no delay, 100 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_drive_startup_delay_brake_release_ms</td><td>int</td><td>-1</td><td>Time given in ms for brakes to fully open before giving rpm out to drive motor controller. -1 = this parameter not used, 0 = no delay, 200 = recommended for Schwarzmueller, 100..300 = recommended for Curtis</td></tr>
<tr><td>mot_ctrl_drive_reset_errors_timer_ms</td><td>int</td><td>-1</td><td>After the defined time (ms) Navigation SW tries automatically reset drive motor controller faults. -1 = this parameter not used, 0 = fault reset disabled</td></tr>
<tr><td>mot_ctrl_drive_disable_main_contactor_ms</td><td>int</td><td>-1</td><td>Disable drive motor controller main contactor to save energy after standing still for the defined time (ms), -1 = this parameter not used, 0 = disable this feature</td></tr>
<tr><td>mot_ctrl_drive_encoder_pulses_per_rev</td><td>uint</td><td>0</td><td>Encoder resolution (pulses per revolution) used to calculate RPM if drive motor controller does not provide that.</td></tr>
<tr><td>mot_ctrl_simulated_steer_controller_type_arr</td><td>int[]</td><td>MOTOR_CONTROLLER_TYPE_SIMULATED</td><td>Type of the simulated motor controller for steering: -1 - Single channel simulated motor controller</td></tr>
<tr><td>mot_ctrl_steer_controller_type_arr</td><td>int[]</td><td>MOTOR_CONTROLLER_TYPE_NOT_DEFINED</td><td>Type of the motor controller for steering: Same values as mot_ctrl_drive_controller_type_arr</td></tr>
<tr><td>mot_ctrl_steer_can_nodeid_arr</td><td>int[]</td><td>0</td><td>Motor controller CAN node id for steer motor. 0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_inv_input_arr</td><td>int[]</td><td>0</td><td>Invert steer angle input. 0 = no inversion, 1 = invert input</td></tr>
<tr><td>mot_ctrl_steer_inv_output_arr</td><td>int[]</td><td>0</td><td>Invert steer motor controller output. 0 = no inversion, 1 = invert output</td></tr>
<tr><td>mot_ctrl_steer_torque_mNm_arr</td><td>int[]</td><td>-1</td><td>Torque value send to steer motor controller. -1 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_p_arr</td><td>float[]</td><td>0.0</td><td>P value of the steer motor controller. 0.0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_i_arr</td><td>float[]</td><td>0.0</td><td>I value of the steer motor controller. 0.0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_d_arr</td><td>float[]</td><td>0.0</td><td>D value of the steer motor controller. 0.0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_estop_enabled_arr</td><td>int[]</td><td>-1</td><td>Emergency stop activation for steer motor controller, -1 = this parameter not used, 0 = estop not used, 1 = estop used</td></tr>
<tr><td>mot_ctrl_steer_disable_delay_ms_arr</td><td>int[]</td><td>-1</td><td>Steer motor controller disabling delay after activating brakes in ms, -1 = this parameter not used, 0 = no delay, 300 = recommended for Schwarzmueller</td></tr>
<tr><td>mot_ctrl_steer_startup_delay_main_contactor_ms_arr</td><td>int[]</td><td>-1</td><td>Time given in ms for steer motor controller main contactor to stabilize before enabling drive. -1 = this parameter not used, 0 = no delay, 500 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_steer_startup_delay_drive_enable_ms_arr</td><td>int[]</td><td>-1</td><td>Time given in ms for driveEnable to take hold before releasing brakes on steer motor controller. -1 = this parameter not used, 0 = no delay, 100 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_steer_startup_delay_brake_release_ms_arr</td><td>int[]</td><td>-1</td><td>Time given in ms for brakes to fully open before giving rpm out to steer motor controller. -1 = this parameter not used, 0 = no delay, 200 = recommended for Schwarzmueller, 100..300 = recommended for Curtis</td></tr>
<tr><td>mot_ctrl_steer_reset_errors_timer_ms_arr</td><td>int[]</td><td>-1</td><td>After the defined time (ms) Navigation SW tries automatically reset steer motor controller faults. -1 = this parameter not used, 0 = fault reset disabled</td></tr>
<tr><td>mot_ctrl_steer_disable_main_contactor_ms_arr</td><td>int[]</td><td>-1</td><td>Disable steer motor controller main contactor to save energy after standing still for the defined time (ms), -1 = this parameter not used, 0 = disable this feature</td></tr>
<tr><td>mot_ctrl_steer_encoder_pulses_per_rev_arr</td><td>uint[]</td><td>0</td><td>Encoder resolution (pulses per revolution) used to calculate RPM if steer motor controller does not provide that. 0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_p</td><td>float</td><td>0.0</td><td>P value of the steer motor controller. 0.0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_i</td><td>float</td><td>0.0</td><td>I value of the steer motor controller. 0.0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_d</td><td>float</td><td>0.0</td><td>D value of the steer motor controller. 0.0 = this parameter not used</td></tr>
<tr><td>mot_ctrl_steer_estop_enabled</td><td>int</td><td>-1</td><td>Emergency stop activation for steer motor controller, -1 = this parameter not used, 0 = estop not used, 1 = estop used</td></tr>
<tr><td>mot_ctrl_steer_disable_delay_ms</td><td>int</td><td>-1</td><td>Steer motor controller disabling delay after activating brakes in ms, -1 = this parameter not used, 0 = no delay, 300 = recommended for Schwarzmueller</td></tr>
<tr><td>mot_ctrl_steer_startup_delay_main_contactor_ms</td><td>int</td><td>-1</td><td>Time given in ms for steer motor controller main contactor to stabilize before enabling drive. -1 = this parameter not used, 0 = no delay, 500 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_steer_startup_delay_drive_enable_ms</td><td>int</td><td>-1</td><td>Time given in ms for driveEnable to take hold before releasing brakes on steer motor controller. -1 = this parameter not used, 0 = no delay, 100 = recommended for Schwarzmueller.</td></tr>
<tr><td>mot_ctrl_steer_startup_delay_brake_release_ms</td><td>int</td><td>-1</td><td>Time given in ms for brakes to fully open before giving rpm out to steer motor controller. -1 = this parameter not used, 0 = no delay, 200 = recommended for Schwarzmueller, 100..300 = recommended for Curtis</td></tr>
<tr><td>mot_ctrl_steer_reset_errors_timer_ms</td><td>int</td><td>-1</td><td>After the defined time (ms) Navigation SW tries automatically reset steer motor controller faults. -1 = this parameter not used, 0 = fault reset disabled</td></tr>
<tr><td>mot_ctrl_steer_disable_main_contactor_ms</td><td>int</td><td>-1</td><td>Disable steer motor controller main contactor to save energy after standing still for the defined time (ms), -1 = this parameter not used, 0 = disable this feature</td></tr>
<tr><td>mot_ctrl_steer_encoder_pulses_per_rev</td><td>uint</td><td>0</td><td>Encoder resolution (pulses per revolution) used to calculate RPM if steer motor controller does not provide that.</td></tr>
</tbody></table>
<h3 id="roboteq"><a class="header" href="#roboteq">Roboteq</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>roboteq_check_echo</td><td>int</td><td>1</td><td>0 = do not check command echo, 1 = check command echo, 2 = old obsolete value (behaves as 1).</td></tr>
<tr><td>roboteq_channel1_right</td><td>int</td><td>1</td><td>Defines which motor is controlled by channel one of the motor controller: 0 = left, 1 = right</td></tr>
<tr><td>roboteq_brake_output1</td><td>int</td><td>-1</td><td>Digital out number for first brake, -1 if disabled.</td></tr>
<tr><td>roboteq_brake_output2</td><td>int</td><td>-1</td><td>Digital out number for second brake, -1 if disabled.</td></tr>
<tr><td>roboteq_angle_sensor_type</td><td>int</td><td>1</td><td>Roboteq motor controller's angle sensor type: 0 = Hall, Sine Cosine and Resolver sensors, 1 = encoders</td></tr>
<tr><td>roboteq_angle_sensor_type_arr</td><td>int[]</td><td>-1</td><td>Override values for roboteq_angle_sensor_type when CAN interface is used and sensor type is not the same for all controllers.</td></tr>
<tr><td>roboteq_channel1_steer</td><td>int</td><td>1</td><td>1 = channel one of Motor controller is right steering, 0 = driving.</td></tr>
</tbody></table>
<h3 id="nanotec"><a class="header" href="#nanotec">Nanotec</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>nanotec_emergency_stop_IO_enabled</td><td>int</td><td>0</td><td>Nanotec internal emergency stop activation. Emergency stop activation comes from digital inputs 1 and 2.</td></tr>
</tbody></table>
<h3 id="syntron"><a class="header" href="#syntron">Syntron</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>syntron_profiled_acceleration</td><td>uint</td><td>327408</td><td>Syntron motor controller acceleration slope [pulses/s^2]</td></tr>
<tr><td>syntron_profiled_deceleration</td><td>uint</td><td>327679</td><td>Syntron motor controller deceleration slope [pulses/s^2]</td></tr>
<tr><td>syntron_max_acceleration</td><td>uint</td><td>3537456</td><td>Syntron motor controller maximum acceleration [pulses/s^2]</td></tr>
<tr><td>syntron_max_deceleration</td><td>uint</td><td>3537648</td><td>Syntron motor controller maximum deceleration [pulses/s^2]</td></tr>
<tr><td>syntron_max_torque</td><td>uint</td><td>43513</td><td>Syntron motor controller maximum torque [mNm].</td></tr>
</tbody></table>
<h3 id="quicktron"><a class="header" href="#quicktron">Quicktron</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>quicktron_nodeid</td><td>int</td><td>0</td><td>0 = not defined, &gt;0 Node ID for quicktron can Card. In default setup the node ID is 1.</td></tr>
<tr><td>quicktron_zero_encoders</td><td>int</td><td>0</td><td>0 = no zeroing, 1 = Reset angle data to 0, needed only for calibration.</td></tr>
</tbody></table>
<h3 id="dunker"><a class="header" href="#dunker">Dunker</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>dunker_mot_ctrl_drive_cmd</td><td>uint</td><td>117</td><td>DriveCommand used: 116 (x74) Speed mode, 117 (x75) Sub Speed mode</td></tr>
<tr><td>dunker_mot_ctrl_start_delay_ms</td><td>uint</td><td>100</td><td>Start delay [ms]. Must be &gt; t1 + t2 (Brake_Management_OffDelay1 + Brake_Management_OffDelay2).</td></tr>
<tr><td>dunker_mot_ctrl_cooldown_time_ms</td><td>uint</td><td>200</td><td>Cooldown time [ms] before reactivating drive.</td></tr>
<tr><td>dunker_mot_ctrl_drive_values_override</td><td>int</td><td>0</td><td>Enables Dunkermotoren OD parameter values written using Navigation SW parameters in params.txt.</td></tr>
<tr><td>dunker_mot_ctrl_drive_vel_kp</td><td>uint[]</td><td>100</td><td>VEL_Kp - P-gain of the speed/position PID-controller.</td></tr>
<tr><td>dunker_mot_ctrl_drive_svel_kp</td><td>uint[]</td><td>600</td><td>SVEL_Kp - P-gain of the SVEL-PI-controller.</td></tr>
<tr><td>dunker_mot_ctrl_drive_svel_ki</td><td>uint[]</td><td>60</td><td>SVEL_Ki - I-gain of the SVEL-PI-controller.</td></tr>
<tr><td>dunker_mot_ctrl_drive_curr_kp</td><td>uint[]</td><td>20</td><td>CURR_Kp - P-gain of the PI-current-controller.</td></tr>
<tr><td>dunker_mot_ctrl_drive_curr_ki</td><td>uint[]</td><td>10</td><td>CURR_Ki - I-gain of the PI-current-controller.</td></tr>
<tr><td>dunker_mot_ctrl_drive_vel_kvff</td><td>uint[]</td><td>1000</td><td>VEL_Kvff - defines the velocity feed-forward control.</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_type</td><td>uint[]</td><td>1</td><td>MOTOR_Type: 0 = Brush type motor (DC), 1 = Brushless motor (BLDC).</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_poln</td><td>uint[]</td><td>8</td><td>MOTOR_PolN - number of poles in motor.</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_polarity</td><td>uint[]</td><td>2</td><td>MOTOR_Polarity - change sign/unit by setting corresponding bit for, PWM (Bit0), Hall sensor (Bit1), Encoder (Bit3), Abs  Encoder (Bit4).</td></tr>
<tr><td>dunker_mot_ctrl_drive_vel_feedback</td><td>uint[]</td><td>2378</td><td>VEL_Feedback - feedback source of the velocity and the positioning controller, 0 = Auto, 256 = AIN0, 274 = EMF feedback, 2378 = HALL, 2410 = Encoder, 2426 = Absolute Encoder.</td></tr>
<tr><td>dunker_mot_ctrl_drive_svel_feedback</td><td>uint[]</td><td>2378</td><td>SVEL_Feedback - source of the SVEL feedback, 0 = Auto, 274 = EMF feedback, 2378 = HALL, 2410 = Encoder, 2426 = Absolute Encoder.</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_enc_resolution</td><td>uint[]</td><td>24</td><td>MOTOR_ENC_Resolution - resolution [pulses per revolution] of the incremental encoder.</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_curr_limitmaxpos</td><td>uint[]</td><td>50000</td><td>CURR_LimitMaxPos - maximum current [mA] for the positive range.</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_curr_limitmaxneg</td><td>uint[]</td><td>50000</td><td>CURR_LimitMaxNeg - maximum current [mA] for the negative range.</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_curr_dynlimitmode</td><td>uint[]</td><td>1</td><td>CURR_DynLimitMode - activates and deactivates the dynamic limitation of the current: 0 = limitation deactivated, 1 = limitation activated</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_curr_dynlimitpeak</td><td>uint[]</td><td>50000</td><td>CURR_DynLimitPeak - Dynamic current limit I*t - Peak current [mA].</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_curr_dynlimitcont</td><td>uint[]</td><td>16900</td><td>CURR_DynLimitCont - Dynamic current limit I*t - Continuous current [mA].</td></tr>
<tr><td>dunker_mot_ctrl_drive_motor_curr_dynlimittime</td><td>uint[]</td><td>2000</td><td>CURR_DynLimitTime - maximum time [ms] for the peak current.</td></tr>
<tr><td>dunker_mot_ctrl_drive_velocity_acc_delta_v</td><td>uint[]</td><td>3000</td><td>Velocity Acceleration - Delta v [rpm]</td></tr>
<tr><td>dunker_mot_ctrl_drive_velocity_dec_delta_v</td><td>uint[]</td><td>3000</td><td>Velocity Deceleration - Delta v [rpm]</td></tr>
<tr><td>dunker_mot_ctrl_drive_pid_vel_kaff</td><td>uint[]</td><td>150</td><td>VEL_Kaff - PID-Controller Acceleration Feed Forward [mA].</td></tr>
</tbody></table>
<h3 id="can-configuration"><a class="header" href="#can-configuration">CAN Configuration</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>can_steer_drive_steering_nodeid</td><td>int</td><td>30</td><td>Node ID for steer drive steering controller.</td></tr>
<tr><td>can_steer_drive_driving_nodeid</td><td>int</td><td>31</td><td>Node ID for steer drive driving controller.</td></tr>
<tr><td>can_diffunit_left_nodeid</td><td>int[]</td><td>0</td><td>CANOpen Node ID for diffunit left motor controllers.</td></tr>
<tr><td>can_diffunit_right_nodeid</td><td>int[]</td><td>0</td><td>CANOpen Node ID for diffunit right motor controllers.</td></tr>
<tr><td>can_diff_drive_left_nodeid</td><td>int</td><td>30</td><td>Node ID for diff drive left motor controller.</td></tr>
<tr><td>can_diff_drive_right_nodeid</td><td>int</td><td>31</td><td>Node ID for diff drive right motor controller.</td></tr>
<tr><td>can_sick_mls_event_timer_ms</td><td>int</td><td>10</td><td>Can sick mls event timer for TPDO1.</td></tr>
<tr><td>can_sick_mls_calibrate_offset</td><td>int[]</td><td>0</td><td>Trigger offset calibration - see SICK MLS manual for instructions.</td></tr>
<tr><td>can_sick_mls_factory_reset</td><td>int[]</td><td>0</td><td>Factory reset the can sick mls sensor - see SICK MLS manual for instructions.</td></tr>
<tr><td>can_enabled</td><td>int</td><td>0</td><td>Enables CAN communication.</td></tr>
<tr><td>can_nmt_master</td><td>int</td><td>1</td><td>Enables Navigation SW to work as CANOpen NMT master on primary CAN.</td></tr>
<tr><td>can_sync</td><td>int</td><td>1</td><td>Navigation SW (Primary CAN) role for CANOpen SYNC messages: 0 = None, 1 = SYNC producer, 2 = SYNC consumer</td></tr>
<tr><td>can_sync_rx_mode</td><td>int</td><td>1</td><td>Select sync receive PDOs: 0 = Legacy (all predefined), 1 = True CANOpen SYNC PDOs only. Ignored if can_sync=0 or no CANOpen SYNC PDOs exist.</td></tr>
<tr><td>can_send_nmt_start_always</td><td>int</td><td>0</td><td>Defines when Navigation SW (Primary CAN) sends CIA301_NMT_CMD_START: 0 = Only on state change, 1 = Periodically every 1 second.</td></tr>
<tr><td>can_ch</td><td>int</td><td>0</td><td>Primary CAN channel number. Assumes device names like can0, can1,...</td></tr>
<tr><td>can_device</td><td>string</td><td></td><td>Primary CAN device name; overrides can_ch if defined.</td></tr>
<tr><td>can_bitrate_k</td><td>int</td><td>250</td><td>Primary CAN bus bitrate [Kbit/s]: 125, 250, 500 or 1000</td></tr>
<tr><td>can_min_tx_interval_us</td><td>int</td><td>0</td><td>Primary CAN minimum transmit interval: 0 = not defined, &gt;0 = Mininimu interval [us].</td></tr>
<tr><td>can_primary_any_id</td><td>int</td><td>0</td><td>Primary CAN valid PDO id's that can be registered: 0 = Only valid PDO id's can be registered, 1 = Any id can be registered.</td></tr>
<tr><td>can_sdo_interval_ms</td><td>int</td><td>100</td><td>Primary CAN SDO message interval [ms] used by Navigation software.</td></tr>
<tr><td>can_sdo_timeout_ms</td><td>int</td><td>500</td><td>Primary CAN SDO message response timeout [ms] used by Navigation software.</td></tr>
<tr><td>can_sdo_write_from_file</td><td>int</td><td>0</td><td>Enables SDO writes from file sdo_write.txt for primary CAN.</td></tr>
<tr><td>can_heartbeat_producer_enable</td><td>int</td><td>0</td><td>Enables Navigation software to be Heartbeat producer for primary CAN.</td></tr>
<tr><td>can_pdo_timeout_redefine</td><td>int</td><td>0</td><td>CAN PDO timeouts/intervals: 0 = Using fixed defaults , 1 = Redefines based on parameters (control_interval_us, control_interval_error_ratio).</td></tr>
<tr><td>can_nodeguard_guard_time_ms</td><td>int</td><td>200</td><td>Nodeguarding guard time [ms]: 0 = Nodeguard disabled</td></tr>
<tr><td>can_reconnect_timer_ms</td><td>int</td><td>200</td><td>CAN reconnect delay [ms] after fatal issue has been detected.</td></tr>
<tr><td>can_comms_restart_timer_ms</td><td>int</td><td>0</td><td>0 = disabled</td></tr>
<tr><td>can_bypass_failed_sdo_timer_secs</td><td>int</td><td>0</td><td>After this time [s] CAN will be forced to OPERATIONAL state(with ERROR), even if all SDO writes are not successful. 0 = disabled</td></tr>
<tr><td>can_reset_flush_all</td><td>int</td><td>0</td><td></td></tr>
<tr><td>can_error_logging_interval_ms</td><td>int</td><td>5000</td><td>The interval [ms] for logging CAN not rxed</td></tr>
<tr><td>can2_ch</td><td>int</td><td>-1</td><td>Secondary CAN channel number: -1 = disabled. Assumes device names like can0, can1,...</td></tr>
<tr><td>can2_device</td><td>string</td><td></td><td>Secondary CAN device name; overrides can2_ch if defined.</td></tr>
<tr><td>can2_bitrate_k</td><td>int</td><td>250</td><td>Secondary CAN bus bitrate [Kbit/s]: 125, 250, 500 or 1000.</td></tr>
<tr><td>can2_min_tx_interval_us</td><td>int</td><td>0</td><td>Secondary CAN minimum transmit interval: 0 = not defined, &gt;0 = Minimum interval [us]</td></tr>
<tr><td>can2_sync</td><td>int</td><td>0</td><td>Enables Navigation software to send SYNC messages to secondary CAN (tied to primary CAN SYNC).</td></tr>
<tr><td>can2_send_nmt_start</td><td>int</td><td>0</td><td>Enables Navigation software to send NMT start messages to secondary CAN (tied to primary CAN NMT start).</td></tr>
<tr><td>can_enable_tpdo_transmit</td><td>int[]</td><td>1</td><td>Enables sending of each corresponding TPDO. All enabled by default, so these parameters can be used to disable sending of specific TPDOs.</td></tr>
<tr><td>can_use_drive_encoders</td><td>int</td><td>0</td><td>Select whether external CAN drive encoders are used for a steer/diff AGV: 0 = not used, 1= external drive encoder(s) used.</td></tr>
<tr><td>external_navigation_controller_node_id</td><td>int</td><td>0</td><td>External Navigation Controller Node ID: 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>navigation_software_node_id</td><td>int</td><td>0</td><td>Navigation Software CANOpen Node ID: 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_steer_enc_model</td><td>int</td><td>0</td><td>Steering encoder model: 0 = generic (no config), 1 = Leine&amp;Linde (RSA608), 2 = Sick (AHS/AHM36)</td></tr>
<tr><td>can_roboteq_nodeid</td><td>int[]</td><td>-1</td><td>Roboteq controller CAN node ID.</td></tr>
<tr><td>can_roboteq_listen_nodeid</td><td>int[]</td><td>-1</td><td>Roboteq controller CAN listen node ID.</td></tr>
<tr><td>can_roboteq_comms_mode</td><td>int</td><td>0</td><td>0 = miniCAN, 1 = CANOpen; common setting for all Roboteq controllers.</td></tr>
<tr><td>can_roboteq_drive_ctrl_index</td><td>int[]</td><td>0</td><td>Maps roboteq drive controller node ID to wheel index. For example, can_roboteq_drive_ctrl_index[0], 0 would mean that node ID defined can_roboteq_nodeid[0] would be drive wheel 0.</td></tr>
<tr><td>can_roboteq_steer_ctrl_index</td><td>int[]</td><td>1</td><td>Maps roboteq steer controller node ID to wheel index. For example, can_roboteq_steer_ctrl_index[0], 1 would mean that node ID defined can_roboteq_nodeid[1] would be steer wheel 0.</td></tr>
<tr><td>can_roboteq_right_ctrl_index</td><td>int[]</td><td>0</td><td>Maps roboteq right controller node ID to wheel index. For example, can_roboteq_right_ctrl_index[0], 0 would mean that node ID defined can_roboteq_nodeid[0] would be right wheel 0.</td></tr>
<tr><td>can_roboteq_left_ctrl_index</td><td>int[]</td><td>1</td><td>Maps roboteq left controller node ID to wheel index. For example, can_roboteq_left_ctrl_index[0], 1 would mean that node ID defined can_roboteq_nodeid[1] would be left wheel 0.</td></tr>
<tr><td>can_omni_steer_ctrl_nodeid</td><td>int[]</td><td>0</td><td>Node ID for omni steering controller (array index = wheel number). 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_omni_drive_ctrl_nodeid</td><td>int[]</td><td>0</td><td>Node ID for omni drive controller (array index = wheel number). 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_extbatt_if_node_id</td><td>int</td><td>0</td><td>Can node ID for battery managment system: 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_extbatt_if_secondary_bus</td><td>int</td><td>0</td><td>Defines which CAN bus is used by BMS: 0 = Primary CAN Bus, 1 = Secondary CAN Bus</td></tr>
<tr><td>can_actuator_ctrl_node_id</td><td>int[]</td><td>0</td><td>CAN node ID of the actuator: 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_actuator_ctrl_model</td><td>int[]</td><td>0</td><td>CAN actuator controller model: 0 = None, 1 = Schwarzmueller (reference). 2 = Curtis (reference/binary)</td></tr>
<tr><td>can_actuator_ctrl_torque</td><td>int[]</td><td>0</td><td>Motor control torque.</td></tr>
<tr><td>can_actuator_ctrl_rpm_to_m_per_s</td><td>float[]</td><td>1.0</td><td>Motor control convert rpm to m/s. For Curtis, should be set between to actuator max speed / 32767.</td></tr>
<tr><td>can_actuator_ctrl_prop_valve_idx</td><td>int[]</td><td>0</td><td>Proportional valve index. For Schwarzmueller - 1 (pin27) or 2 (pin16). For Curtis F2-T - 0 (pin 2) or 1 (pin 19).</td></tr>
<tr><td>can_actuator_ctrl_prop_valve_max</td><td>int[]</td><td>200</td><td>Proportional valve max output. For Curtis, should be set between 0-32767.</td></tr>
<tr><td>can_actuator_ctrl_prop_valve_min</td><td>int[]</td><td>0</td><td>Proportional valve min output.</td></tr>
</tbody></table>
<h3 id="encoder"><a class="header" href="#encoder">Encoder</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>rls_absolute_serial_port</td><td>string</td><td>/dev/ttyS3</td><td>RS422 interfaced RLS absolute encoder serial port path</td></tr>
<tr><td>steer_enc_zero</td><td>int</td><td>0</td><td>Pulse encoder value corresponding to zero angle of steer wheel.</td></tr>
<tr><td>can_enc_drive_node_id</td><td>int</td><td>0</td><td>Drive encoder node ID for a separate can drive encoder: -1 = disabled, 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_enc_steer_node_id</td><td>int</td><td>0</td><td>Steer encoder node ID for a separate can steer encoder: -1 = disabled, 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>ethercat_enc_steer_addr</td><td>int</td><td>0</td><td>Physical EtherCAT address for steering absolute encoder in steer drive. 0 = disabled</td></tr>
<tr><td>ethercat_enc_steer_model</td><td>int</td><td>1</td><td>Ethercat encoder model in steer drive: 1 = Generic (Sick AFS/AFM60)</td></tr>
<tr><td>steer_enc_pulses_per_rev</td><td>int</td><td>1000</td><td>Steering encoder pulses per full 360 degrees revolution (for steer/diff_steer AGVs).</td></tr>
<tr><td>steer_enc_pulses_overflow</td><td>uint</td><td>0xFFFFFFFU</td><td>Steering encoder pulses overflow value. Maximum value + 1.</td></tr>
<tr><td>enc_zero_auto_update_enabled</td><td>int</td><td>1</td><td>Enables automatic encoder zero offset redefiniton when using multi-turn encoder.</td></tr>
<tr><td>can_rls_sen_nodeid</td><td>int[]</td><td>-1</td><td>RLS absolute encoder CAN node ID: 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_enc_actuator_node_id</td><td>int[]</td><td>0</td><td>CAN node ID of the actuator's encoder: 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_enc_actuator_coeff</td><td>float[]</td><td>1.0</td><td>Coefficient to convert encoder pulses to correct unit (length/height [m], angle [rad]).</td></tr>
<tr><td>can_enc_actuator_calib_val_enc</td><td>int[]</td><td>0</td><td>Encoder value that matches actuator calibration value.</td></tr>
<tr><td>can_enc_actuator_calib_val_act</td><td>float[]</td><td>0</td><td>Actuator value that matches encoder calibration value. Value in correct unit depending on the actuator type (length/height [m], angle [rad]).</td></tr>
<tr><td>can_enc_actuator_pulses_overflow</td><td>uint[]</td><td>0xFFFFFFFU</td><td>Maximum encoder value.</td></tr>
<tr><td>can_enc_actuator_pulses_per_rev</td><td>int[]</td><td>1000</td><td>Encoder pulses per revolution.</td></tr>
<tr><td>can_enc_actuator_inv</td><td>uint[]</td><td>0</td><td>Inverse the value from encoder.</td></tr>
<tr><td>can_enc_actuator_model</td><td>int[]</td><td>0</td><td>Actuator's encoder model: 0 = generic (no config), 1 = Leine&amp;Linde (RSA608), 2 = Sick (AHS/AHM36)</td></tr>
<tr><td>ethercat_enc_omni_addr_arr</td><td>int[]</td><td>0</td><td>Physical EtherCAT address for steering absolute encoder in omni drive (index - wheel number). 0 - disabled</td></tr>
<tr><td>ethercat_enc_omni_model_arr</td><td>int[]</td><td>1</td><td>Ethercat encoder model in omni drive (index - wheel number), 1 = Generic (Sick AFS/AFM60).</td></tr>
<tr><td>can_enc_drive_node_id_arr</td><td>int[]</td><td>0</td><td>CAN node ID of drive controller encoder (array index = wheel number): 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>can_enc_drive_pulses_overflow_arr</td><td>uint[]</td><td>0xFFFFFFFU</td><td>Maximum encoder value.</td></tr>
<tr><td>can_enc_drive_pulses_per_rev_arr</td><td>uint[]</td><td>1000</td><td>Encoder pulses per revolution.</td></tr>
<tr><td>can_enc_drive_model_arr</td><td>int[]</td><td>0</td><td>CAN drive controller encoder model:0 = generic (no config) 1 = Leine&amp;Linde (RSA608), 2 = Sick (AHS/AHM36)</td></tr>
<tr><td>wheel_speed_measured_arr</td><td>int[]</td><td>0</td><td>1-wheel with separate speed encoder measurement as a substitute for the speed measurement from a speed controller. Indexes according to customer wheel numbering.</td></tr>
</tbody></table>
<h3 id="fieldbus"><a class="header" href="#fieldbus">Fieldbus</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ethercat_enabled</td><td>int</td><td>0</td><td>Enables EtherCAT communication.</td></tr>
<tr><td>ethercat_mode</td><td>int</td><td>0</td><td>EtherCAT mode: 0 = Master single, 1 = Master redundant</td></tr>
<tr><td>ethercat_inte_primary</td><td>string</td><td></td><td>Primary Ethernet interface used for EtherCAT communication.</td></tr>
<tr><td>ethercat_inte_redundant</td><td>string</td><td></td><td>Redundant Ethernet interface used for EtherCAT communication.</td></tr>
<tr><td>profinet_enabled</td><td>int</td><td>0</td><td>Enables Profinet communication</td></tr>
<tr><td>profinet_endianness</td><td>int</td><td>0</td><td>Defines profinet data endianness, 0 - little endian, 1 - big endian</td></tr>
<tr><td>profinet_port_name</td><td>string</td><td>eth0</td><td>IPC ethernet portname used by Profinet</td></tr>
<tr><td>profinet_ip</td><td>string</td><td>10.10.6.100</td><td>IP address of the IPC that is sent to Profinet master</td></tr>
<tr><td>profinet_gateway</td><td>string</td><td>10.10.6.255</td><td>Gateway adress of the IPC that is sent to Profinet master</td></tr>
<tr><td>profinet_netmask</td><td>string</td><td>255.255.255.0</td><td>Netmask adress of the IPC that is sent to Profinet master</td></tr>
<tr><td>ethercat_steer_drive_steering_ctrl_addr</td><td>int</td><td>1</td><td>Physical EtherCAT address of steer drive steering motor controller.</td></tr>
<tr><td>ethercat_steer_drive_driving_ctrl_addr</td><td>int</td><td>2</td><td>Physical EtherCAT address of steer drive driving motor controller.</td></tr>
<tr><td>ethercat_diff_drive_left_ctrl_addr</td><td>int</td><td>1</td><td>Physical EtherCAT address of diff drive left motor controller.</td></tr>
<tr><td>ethercat_diff_drive_right_ctrl_addr</td><td>int</td><td>2</td><td>Physical EtherCAT address of diff drive right motor controller.</td></tr>
<tr><td>ethercat_mot_ctrl_mecanum_ctrl_addr</td><td>int[]</td><td>0</td><td>Physical EtherCAT address for mecanum motor controllers. 0 = not defined. Indexes are 0 = FF (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right).</td></tr>
<tr><td>modbus_enabled</td><td>int</td><td>1</td><td>Enables Modbus communication.</td></tr>
<tr><td>modbus_ip</td><td>string</td><td>10.10.6.105</td><td>IP address of Modbus TCP device.</td></tr>
<tr><td>modbus_port</td><td>int</td><td>502</td><td>Modbus communication TCP port.</td></tr>
<tr><td>modbus_device_selection</td><td>int</td><td>0</td><td>Defines which Modbus device is connected: 0 = Beckhoff EK9000.</td></tr>
<tr><td>ethercat_omni_steer_ctrl_addr</td><td>int[]</td><td>0</td><td>Physical EtherCAT address for omni steering controller (array index - wheel number). 0 = disabled</td></tr>
<tr><td>ethercat_omni_drive_ctrl_addr</td><td>int[]</td><td>0</td><td>Physical EtherCAT address for omni drive controller (array index - wheel number). 0 = disabled</td></tr>
</tbody></table>
<h3 id="extra-sensors"><a class="header" href="#extra-sensors">Extra sensors</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>uss_type</td><td>int</td><td>0</td><td>0 = no Ultrasonic Sensors, 1 = Neobtoix USS CAN</td></tr>
<tr><td>uss_sensors_installed</td><td>uint</td><td>0</td><td>Ultrasonic sensors installed in system as a bitmask. For example 3855 = 111100001111b means sensors 1-4 and 9-12 are installed in the system. Maximum number of sensors is 16.</td></tr>
<tr><td>uss_select_active_sensors_property</td><td>int</td><td>0</td><td>Define which custom property is used as bitmap to activate sensors:  0 = all sensors active, 1-5 use custom attribute 1-5 protection zone, for example decimal 19 in binary 10011 means activate sensors 1, 2 and 5, others deactivated.</td></tr>
<tr><td>uss_activate_sensors_based_on_driving_dir</td><td>int</td><td>0</td><td>0 = use only custom properties to determine active scanners, 1 = activate sensors based on driving direction (naive approach, currently checks only sign of the velocity)</td></tr>
<tr><td>uss_sensor_facing_backwards</td><td>uint</td><td>0</td><td>Mark sensors that are facing backwards. Otherwise sensor is forwards. Bitmapped value, so for example value 240 = 11110000b means sensors 1-4 are forwards and 5-8 backwards.</td></tr>
<tr><td>uss_trigger_zones</td><td>int</td><td>0</td><td>Enables triggering of slow down/stopping zones from ultrasonic sensors.</td></tr>
<tr><td>uss_slow_speed_limit</td><td>float</td><td>0.2</td><td>If speed is higher than this (fw or bw), use the distances for fast speed to trigger zones.</td></tr>
<tr><td>uss_sensor_zone1_dist_fast</td><td>float[]</td><td>0.70</td><td>Trigger protection zone from ultrasonic sensors (fast speed), if reading of sensor is smaller than the defined parameter. Distance can be defined to each sensor individually.</td></tr>
<tr><td>uss_sensor_zone2_dist_fast</td><td>float[]</td><td>1.00</td><td>Trigger warning zone 1 from ultrasonic sensors (fast speed), if reading of sensor is smaller than the defined parameter. Distance can be defined to each sensor individually.</td></tr>
<tr><td>uss_sensor_zone3_dist_fast</td><td>float[]</td><td>1.50</td><td>Trigger warning zone 2 from ultrasonic sensors (fast speed), if reading of sensor is smaller than the defined parameter. Distance can be defined to each sensor individually.</td></tr>
<tr><td>uss_sensor_zone1_dist_slow</td><td>float[]</td><td>0.20</td><td>Trigger protection zone from ultrasonic sensors (slow speed), if reading of sensor is smaller than the defined parameter. Distance can be defined to each sensor individually.</td></tr>
<tr><td>uss_sensor_zone2_dist_slow</td><td>float[]</td><td>0.40</td><td>Trigger warning zone 1 from ultrasonic sensors (slow speed), if reading of sensor is smaller than the defined parameter. Distance can be defined to each sensor individually.</td></tr>
<tr><td>uss_sensor_zone3_dist_slow</td><td>float[]</td><td>1.50</td><td>Trigger warning zone 2 from ultrasonic sensors (slow speed), if reading of sensor is smaller than the defined parameter. Distance can be defined to each sensor individually.</td></tr>
<tr><td>uss_set_active_sensors_only_on_change</td><td>int</td><td>1</td><td>Defines sending of active channels: 0 = default interval, 1 = if sensor setting changed.</td></tr>
<tr><td>uss_delay_to_ignore_dist_after_change_ms</td><td>int</td><td>0</td><td>Delay [ms] to ignore distance data for triggering zones after sending a command to change active sensors.</td></tr>
<tr><td>uss_enable_disabled_sensors_after_ms</td><td>uint</td><td>0</td><td>Delay [ms] to enable ultrasonic sensors disabled by the user. 0 = timer disabled.</td></tr>
<tr><td>rfid_check_enabled</td><td>int</td><td>0</td><td>Enables RFID (aka. container type ID) verification.</td></tr>
</tbody></table>
<h3 id="simove"><a class="header" href="#simove">SIMOVE</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>simove_navigation_port_in</td><td>int</td><td>4001</td><td>Navigation SW inbound data TCP/IP (UDP) port for SIMOVE navigation interface</td></tr>
<tr><td>simove_navigation_port_out</td><td>int</td><td>12345</td><td>Navigation SW outbound data TCP/IP (UDP) port for SIMOVE navigation interface</td></tr>
<tr><td>simove_navigation_ip</td><td>string</td><td>0.0.0.0</td><td>IP address of the PLC / device onboard the AGV for SIMOVE navigation interface</td></tr>
<tr><td>simove_navigation_endianess</td><td>int</td><td>1</td><td>Endianess for SIMOVE navigation interface: 0 = little endian, 1 = big endian</td></tr>
<tr><td>simove_navigation_odometry_source</td><td>int</td><td>0</td><td>Used odometry source: 0 = velocity, 1 = position</td></tr>
<tr><td>simove_velocity_xy_norm</td><td>float</td><td>160.0</td><td>Normalizing factor for velocity vector's Vx and Vy in SIMOVE interface</td></tr>
<tr><td>simove_velocity_angular_norm</td><td>float</td><td>PI/180</td><td>Normalizing factor for angular velocity in SIMOVE interface</td></tr>
<tr><td>simove_controller_port</td><td>int</td><td>5001</td><td>TCP/IP port for SIMOVE controller custom interface</td></tr>
<tr><td>simove_controller_ip</td><td>string</td><td>0.0.0.0</td><td>IP address of the PLC / device onboard the AGV for SIMOVE controller custom interface</td></tr>
<tr><td>simove_controller_version</td><td>uint</td><td>118</td><td>SIMOVE controller custom interface version</td></tr>
</tbody></table>
<h2 id="position-control"><a class="header" href="#position-control">Position control</a></h2>
<h3 id="position-control-related"><a class="header" href="#position-control-related">Position control related</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>control_interval_us</td><td>int</td><td>30000</td><td>Requested or expected nominal control interval [us].</td></tr>
<tr><td>control_interval_error_ratio</td><td>float</td><td>1.2</td><td>Defines how much measured control interval can deviate from requested/nominal (e.g. 1.3 means 30%).</td></tr>
<tr><td>control_interval_max_stdev_us</td><td>int</td><td>1000</td><td>Maximum standard deviation of measured control interval [us].</td></tr>
<tr><td>nav_point_x_offset</td><td>float</td><td>0.0</td><td>Navigation point longitudinal offset from vehicle center, positive forwards.</td></tr>
<tr><td>nav_point_y_offset</td><td>float</td><td>0.0</td><td>Navigation point lateral offset from vehicle center, positive to the left.</td></tr>
<tr><td>pc_predict_ms</td><td>int</td><td>100</td><td>Motor controller delay from output value change to change in feedback.</td></tr>
<tr><td>pc_max_dist_err</td><td>float</td><td>0.2</td><td>Maximum distance error from the route.</td></tr>
<tr><td>pc_max_head_err</td><td>float</td><td>180.0</td><td>Maximum heading error to the target heading on the route.</td></tr>
<tr><td>pc_start_err_factor</td><td>float</td><td>1.0</td><td>Determines maximum distance error [m] from the route at the start of drive order (multiplies pc_max_dist_err).</td></tr>
<tr><td>pc_start_err_max_travelled_dist</td><td>float</td><td>1.0</td><td>Maximum travelled distance [m] from the start of drive order when larger deviation from route is allowed</td></tr>
<tr><td>pc_start_err_max_dist_to_traj_start</td><td>float</td><td>FLT_MAX</td><td>Maximum distance [m] to the first point of trajectory to allow the larger deviation at start to activate.</td></tr>
<tr><td>pc_pid_heading_p</td><td>float</td><td>4.0</td><td>Position control gain for the heading error. The higher the gain the faster the AGV tries to minimize the heading error on the route.</td></tr>
<tr><td>pc_pid_dist_p</td><td>float</td><td>4.0</td><td>Position control gain for the distance error. The higher the gain the faster the AGV tries to minimize the distance error on the route.</td></tr>
<tr><td>pc_pid_rot_dt</td><td>float</td><td>0.05</td><td>Interval [s] defining travel distance for final heading compensation of curvature generated distance error in position controller, approx equal to control interval.</td></tr>
<tr><td>pc_starting_speed</td><td>float</td><td>0.1</td><td>Speed at the start of trajectory. Target speed is set to this speed at minimum, even with slower acceleration parameter. Set 0.0 to disable.</td></tr>
<tr><td>pc_pid_speed_setting</td><td>float[]</td><td>0.0</td><td>Change position control gain parameters based on speed. This parameter array defines the speed thresholds [m/s] to apply the associated control parameters. 0.0 = disabled</td></tr>
<tr><td>pc_pid_speed_dist_p</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's distance error in different speeds. Speed thresholds are defined with parameter array pc_pid_speed_setting.</td></tr>
<tr><td>pc_pid_speed_heading_p</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's heading error in different speeds. Speed thresholds are defined wiht parameter array pc_pid_speed_setting.</td></tr>
<tr><td>pc_pid_docking_dist_limit</td><td>float[]</td><td>0.0</td><td>Change position control gain paramters after the distance to docking target is smaller than the threshold defined in this parameter array. 0.0 = disabled</td></tr>
<tr><td>pc_pid_docking_dist_p</td><td>float[]</td><td>0.0</td><td>Position control gains to minimze AGV's distance error based on the distance to the docking target. Distance thresholds are defined in parameter array pc_pid_docking_dist_limit.</td></tr>
<tr><td>pc_pid_docking_heading_p</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's heading error based on the distance to the docking target. Distance thresholds are defined in the parameter array pc_pid_docking_dist_limit.</td></tr>
<tr><td>pc_start_drive_with_pivot_if_head_err_deg</td><td>float</td><td>5.0</td><td>Defines the minimum heading error of the AGV to the reference that the AGV is commanded to pivot at the start of the drive. Enable with pc_start_drive_with_pivot.</td></tr>
<tr><td>pc_predict_use_acc</td><td>int</td><td>1</td><td>Use acceleration in predicting future machine position.</td></tr>
<tr><td>pc_predict_acc_filter_coef</td><td>float</td><td>0.3</td><td>Acceleration lowpass filter coefficient for position prediction.</td></tr>
<tr><td>pc_fuzzy_control_enabled</td><td>int</td><td>0</td><td>Position control, distance and heading, performed by fuzzy controller, instead of P-controller.</td></tr>
<tr><td>pc_pid_heading_p_loaded</td><td>float</td><td>0.0</td><td>Position control gains to minimize AGV's heading error when AGV is carrying a load. 0.0 = disabled</td></tr>
<tr><td>pc_pid_dist_p_loaded</td><td>float</td><td>0.0</td><td>Position control gains to minimize AGV's distance error when AGV is carrying a load. 0.0 = disabled</td></tr>
<tr><td>pc_pid_speed_setting_loaded</td><td>float[]</td><td>0.0</td><td>Change position control gain parameters for loaded AGV based on speed. This parameter defines the speed thresholds [m/s] to apply the assoiciated control parameters. 0.0 = disabled</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's heading error in different speeds when AGV is carrying a load. Speed thresholds are defined with parameter array pc_pid_speed_setting_loaded.</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's distance error in different speeds when AGV is carrying a load. Speed thresholds are defined wiht parameter array pc_pid_speed_setting_loaded.</td></tr>
<tr><td>pc_pid_load_weight_kg</td><td>float[]</td><td>0.0</td><td>Change position control gain parameters based on the load weight. This parameter array defines the weight thresholds [kg] to apply the associated control parameters. 0.0 = disabled</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded1</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's heading error in different speeds when over the first weight threshold.</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded1</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's distance error in different speeds when over the first weight threshold.</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded2</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's heading error in different speeds when over the second weight threshold.</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded2</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's distance error in different speeds when over the second weight threshold.</td></tr>
<tr><td>pc_pid_speed_heading_p_loaded3</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's heading error in different speeds when over the third weight threshold.</td></tr>
<tr><td>pc_pid_speed_dist_p_loaded3</td><td>float[]</td><td>0.0</td><td>Position control gains to minimize AGV's distance error in different speeds when over the third weight threshold.</td></tr>
<tr><td>pc_min_ref_v</td><td>float</td><td>0.001</td><td>Minimum reference speed [m/s].</td></tr>
<tr><td>pc_stop_distance_offset</td><td>float</td><td>0.0</td><td>Stopping distance offset if AGV stops too early or too late to reach the end point. Apply negative offset if AGV stops too late.</td></tr>
<tr><td>pc_direction_change_wait_ms</td><td>int</td><td>500</td><td>Time to be stopped when changing direction, 0 to change direction without zeroing reference velocity.</td></tr>
<tr><td>pc_final_speed_lim_enable</td><td>int</td><td>0</td><td></td></tr>
<tr><td>pc_virtual_tag_active</td><td>int</td><td>1</td><td>Defines the reported virtual tags: 0 = report last seen virtual tag, 1 = report only active virtual tag</td></tr>
<tr><td>pc_s300_zone_violation_as_warning_zone2</td><td>int</td><td>1</td><td>1 = use S300 protection zone violation bits as warning zone 2, meaning only slowing down on zone violation.</td></tr>
<tr><td>pc_fstop_on_estop</td><td>int</td><td>1</td><td>1 = go to FSTOP state when emergency stop is active.</td></tr>
<tr><td>pc_soft_stop_enabled</td><td>int</td><td>0</td><td>Enables slowing down with a speed ramp in case of error, drive abort or pause.</td></tr>
<tr><td>pc_soft_stop_obs_wheel_dec</td><td>float</td><td>0.5</td><td>Deceleration rate when slowing down due to an obstacle.</td></tr>
<tr><td>pc_soft_slow_wheel_speed</td><td>float</td><td>0.3</td><td>The maximum wheel speed reference during soft slow. Speed is ramped down to this value if it was higher.</td></tr>
<tr><td>pc_soft_slow_raw_conf_limit</td><td>float</td><td>0.0</td><td>When raw position confidence drops below this value, soft slow will be triggered.</td></tr>
<tr><td>pc_soft_slow_conf_limit</td><td>float</td><td>0.0</td><td>When filtered position confidence drops below this value, soft slow will be triggered.</td></tr>
<tr><td>pc_abort_drive_if_curtrajpoint_not_moving_timer_ms</td><td>int</td><td>0</td><td>Defines how long the wheels must be moving while the AGV does not before drive is aborted. 0 = check disabled</td></tr>
<tr><td>pc_abort_drive_if_curtrajpoint_not_moving_max_dist_from_end</td><td>float</td><td>0.3</td><td>Distance from the trajectory end within which aborting the drive is allowed based on wheel slipping.</td></tr>
<tr><td>pc_abort_drive_if_curtrajpoint_not_moving_activate_error</td><td>int</td><td>1</td><td>Defines if an abort from navigation point not moving should raise an error that requires acknowledgement.</td></tr>
<tr><td>pc_max_wait_time_for_agv_to_stop_before_braking_ms</td><td>int</td><td>2000</td><td>Maximum time to wait after sending zero references for the AGV to stop before applying brakes.</td></tr>
<tr><td>pc_end_gain_dist</td><td>float</td><td>0.0</td><td>Distance from stop point to activate end position control gains which are dynamically adjusted when arriving the stop point. 0 = disable, recommended value 1</td></tr>
<tr><td>pc_end_gain1</td><td>float</td><td>6.0</td><td>Used in the dynamic calculation of the end proportional gains for position control of both heading and distance.</td></tr>
<tr><td>pc_end_gain2</td><td>float</td><td>0.02</td><td>Used in the dynamic calculation of the end proportional gains for position control of both heading and distance.</td></tr>
<tr><td>pc_end_max_gain</td><td>float</td><td>4.0</td><td>Maximum proportional gain to adjust the end position control gain values.</td></tr>
<tr><td>pc_end_min_gain</td><td>float</td><td>1.0</td><td>Sets a minimum for the end position control gain value for distance.</td></tr>
<tr><td>pc_on_route_err_scale</td><td>float</td><td>0.8</td><td>Multiplier for distance and heading error limits to apply for on route check (has to be &lt; 1 to avoid false positives).</td></tr>
<tr><td>pc_max_nearpoint_lookahead_dist_m</td><td>float</td><td>1.0</td><td>Limit position controller nearpoint lookahead distance [m]. This prevents loop skipping in long segments.</td></tr>
<tr><td>ref_speed_scale</td><td>float</td><td>1.0</td><td>Scale for reference speed [m/s].</td></tr>
<tr><td>poscont_max_interval_ms</td><td>int</td><td>400</td><td>Maximum allowed interval [ms] between position control updates.</td></tr>
<tr><td>pc_max_end_dist</td><td>float</td><td>0.2</td><td>Defines the AGV’s distance from destination symbolic point to consider target being reached after the drive is ready.</td></tr>
<tr><td>pc_same_point_dist</td><td>float</td><td>0.002</td><td>Distance limit to consider two route points to be the same.</td></tr>
<tr><td>pc_step_length</td><td>float</td><td>0.01</td><td>Distance [m] between trajectory points.</td></tr>
<tr><td>pc_step_length_error_tolerance</td><td>float</td><td>0.01</td><td>Defines the acceptable error tolerance [%] for the trajectory step length.</td></tr>
<tr><td>max_speed_diff</td><td>float</td><td>0.1</td><td>Expected accuracy of the speed control. Error will be set if measured value differs from the reference for speed_timer_s amount of time.</td></tr>
<tr><td>max_prediction_dist</td><td>float</td><td>0.3</td><td>Maximum distance the AGV’s position is predicted on the route for position control.</td></tr>
<tr><td>pc_speed_resolution</td><td>float</td><td>0.001</td><td>Resolution for speed.</td></tr>
<tr><td>pc_stopped_speed_limit</td><td>float</td><td>0.0005</td><td>Speeds lower than this limit are regarded as not moving.</td></tr>
<tr><td>pc_stopped_time_limit_ms</td><td>int</td><td>1000</td><td>Minimum time limit [ms] for speed to be higher then pc_stopped_speed_limit so AGV will be considered as moving.</td></tr>
</tbody></table>
<h3 id="pivoting-1"><a class="header" href="#pivoting-1">Pivoting</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pivot_min_head_diff_for_activation_deg</td><td>float</td><td>2.0</td><td>A frame heading difference [deg] smaller than this is not corrected by vehicle pivoting. The steer vector is pivoted instead if that change is big. Small differences are corrected during normal driving.</td></tr>
<tr><td>pivot_target_head_diff_deg</td><td>float</td><td>1.0</td><td>Target heading difference for ending pivot.</td></tr>
<tr><td>pivot_max_dist_err</td><td>float</td><td>0.1</td><td>Maximum allowed distance error to the pivot origin point during pivoting. If the AGV drifts further away a position error is triggered.</td></tr>
<tr><td>pivot_speed</td><td>float</td><td>0.2</td><td>Maximum wheel speed during pivot.</td></tr>
<tr><td>pivot_crawl_speed</td><td>float</td><td>0.1</td><td>Maximum wheel speed during pivot when close to the target heading.</td></tr>
<tr><td>pivot_crawl_head_diff_deg</td><td>float</td><td>10.0</td><td>Angular distance from the pivot target heading to activate crawl speed.</td></tr>
<tr><td>pivot_dec_head_deg</td><td>float</td><td>30.0</td><td>Angular distance from the pivot target heading to ramp pivot speed down to crawl speed.</td></tr>
<tr><td>pivot_traj_calc_stop_h_diff_deg</td><td>float</td><td>10.0</td><td>Minimum angular difference [deg] between pivot start and end point heading to make a stop for pivoting in trajectory handling. Points with smaller difference are always driven through.</td></tr>
<tr><td>pivot_stop_distance_offset</td><td>float</td><td>0.0</td><td>Defines stopping distance offset from turn points such as pivot and direction change points. Apply negative offset if AGV stops too late.</td></tr>
<tr><td>pivot_max_wheel_diff_ignore_180</td><td>int</td><td>0</td><td>If 1 both right angle and angle +-180 degrees are ok for ending the pivoting.</td></tr>
<tr><td>pivot_with_mode_change</td><td>int</td><td>0</td><td>If 1 pivoting is done with mode change in PLC.</td></tr>
<tr><td>pivot_over_long_angle</td><td>int</td><td>0</td><td>If 1 pivoting is done over the longer angle, default 0 for short angle.</td></tr>
</tbody></table>
<h3 id="docking"><a class="header" href="#docking">Docking</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>dist_to_target_enabled</td><td>int</td><td>0</td><td>Distance calculation from AGV to target. Calculates distance from AGV to pallet when AGV is docking, and distance from AGV to unload point when AGV is driving to unload point with a pallet.</td></tr>
<tr><td>dist_to_target_angle_tolerance_deg</td><td>float</td><td>30.0</td><td>Allowed rotation angle of the pallet with respect to the AGV when distance calculation is enabled.</td></tr>
<tr><td>dist_to_target_max_calc_dist</td><td>float</td><td>4.0</td><td>Maximum distance from agv to unload point when calculation starts.</td></tr>
<tr><td>docking_to_target_enabled</td><td>int</td><td>0</td><td>1 = Enables docking to target. 2 = docking with custom route. If target_detection_type_selection = 0, won't do anything.</td></tr>
<tr><td>docking_with_only_distance_control_enabled</td><td>int</td><td>0</td><td>Enables docking to target with only distance control. docking_to_target_enabled must be 1.</td></tr>
<tr><td>docking_max_start_distance</td><td>float</td><td>3.5</td><td>Beyond maximum distance docking won't be triggered.</td></tr>
<tr><td>docking_max_start_angle</td><td>float</td><td>15.0</td><td>Maximum angle difference from navigation point to the target compared to tarjectory's end point's heading, when starting to dock [+-degrees fov].</td></tr>
<tr><td>docking_max_start_heading</td><td>float</td><td>5.0</td><td>Maximum angle diff for vehicle heading and trajectory's end point heading, when starting to dock [+-degrees fov].</td></tr>
<tr><td>docking_max_dist_error_from_end_point</td><td>float</td><td>0.5</td><td>Maximum distance difference for the stopping point compared to the symbolic point.</td></tr>
<tr><td>docking_max_target_angle</td><td>float</td><td>15.0</td><td>Maximum difference between target and end point's headings.</td></tr>
<tr><td>docking_stop_distance</td><td>float</td><td>0.50</td><td>Defines how close to the target vehicle tries to drive (calculated from navigation point to target).</td></tr>
<tr><td>docking_y_offset</td><td>float</td><td>0.0</td><td>Offset in y-coordinate for docking (in machine coordinates).</td></tr>
<tr><td>docking_use_route_heading</td><td>int</td><td>0</td><td>Defines how the docking end heading is selected. 0 = Detected heading of the target is used requiring more space for manouvering. 1 = Route heading is used allowing a heading offset to the target. Only used when docking_to_target_enabled = 1.</td></tr>
<tr><td>docking_approach_dist</td><td>float</td><td>1.25</td><td>After this distance vehicle stops, if the approach error is too big.</td></tr>
<tr><td>docking_approach_max_dist_err</td><td>float</td><td>0.10</td><td>If distance error is bigger than this in approach area, vehicle stops.</td></tr>
<tr><td>docking_approach_max_h_err_deg</td><td>float</td><td>5.0</td><td>If heading error is bigger than this [deg] in approach area, vehicle stops.</td></tr>
<tr><td>docking_allow_maneuver</td><td>int</td><td>0</td><td>If errors are too high on approach, 0 = stop the machine, 1 = try to maneuver back and forward.</td></tr>
<tr><td>docking_small_gains_dist</td><td>float</td><td>0.50</td><td>The distance before stopping where curvature is limited with docking_limit_curv_on_approach.</td></tr>
<tr><td>docking_limit_corr_dist</td><td>float</td><td>0.50</td><td>The distance before stopping which is driven only with odometry. Location correction disabled or limited with docking_max_xy_corr and docking_max_h_corr.</td></tr>
<tr><td>docking_small_gains</td><td>int</td><td>1</td><td>Enables curvature limit that uses docking_limit_curv_on_approach and docking_limit_curv_on_approach_dist.</td></tr>
<tr><td>docking_max_xy_corr</td><td>float</td><td>0.0001</td><td>Maximum XY-corrections while approaching target.</td></tr>
<tr><td>docking_max_h_corr</td><td>float</td><td>0.003</td><td>Maximum heading corrections [deg] while approaching target.</td></tr>
<tr><td>docking_limit_curv_on_approach</td><td>float</td><td>0.1</td><td>Fraction to limit the calculated curvature. For example, 0.1 means that the curvature is 10% from the calculated value.</td></tr>
<tr><td>docking_limit_curv_on_leave</td><td>float</td><td>0.05</td><td>Fraction to limit the calculated curvature. For example, 0.05 means that the curvature is 5% from the calculated value. Used only when docking_leave_unload_loc_straight is set to 1.</td></tr>
<tr><td>docking_approach_warning_to_error_timeout_s</td><td>int</td><td>-1</td><td>Defines a time [s] after which the WARNING_TARGET_APPROACH_ERROR activates the ERROR_DOCKING_FAILED. -1 = Never.</td></tr>
<tr><td>docking_activate_when_inside_symbolic_point</td><td>int</td><td>1</td><td>Defines if the docking is activated when inside a symbolic point that has the docking tag in addition to basic conditions. 0 = Extra condition not used (recommended), 1 = Extra condition used. Has effect only when reflector docking is in use.</td></tr>
<tr><td>docking_limit_drive_vector_angle_change_on_leave</td><td>float</td><td>0.01</td><td>Fraction to limit the drive vector angle change when leaving a docking situation. For example, 0.05 means that the drive vector change is 5% from the calculated value. Used only when docking_leave_unload_loc_straight is set to 1.</td></tr>
<tr><td>docking_dist_gain</td><td>float</td><td>1.0</td><td>Factor for the position control distance gain when docking. 0 = use pc_pid_dist_p.</td></tr>
<tr><td>docking_heading_gain</td><td>float</td><td>1.0</td><td>Factor for the position control heading gain when docking. 0 = use pc_pid_heading_p.</td></tr>
<tr><td>docking_ref_v_source</td><td>int</td><td>0</td><td>Speed source when doing docking: 0 = calculated from distance to target, 1 = using route velocity value, 2 = use fixed parameter docking_speed.</td></tr>
<tr><td>docking_speed</td><td>float</td><td>0.3</td><td>Speed while docking, if docking_ref_v_source == 2. If it is 0, this is minimum starting speed for the docking drive.</td></tr>
<tr><td>docking_limit_leave_speed</td><td>float</td><td>0.2</td><td>Limit speed while driving out from docking location, if docking_limit_leave_speed_and_actuator_height_dist &gt; 0. If it is below 0, speed is not limited.</td></tr>
<tr><td>docking_limit_leave_speed_and_actuator_height_dist</td><td>float</td><td>-1.0</td><td>Distance from the unload location, where the speed is limited to docking_limit_leave_speed and fork height kept at the measured value. If negative, they are not limited. If enabled, must be smaller than docking_mode_to_fleet_control_dist parameter.</td></tr>
<tr><td>docking_leave_unload_loc_straight</td><td>int</td><td>0</td><td>Enables limit curvature when leaving unload or docking location.</td></tr>
<tr><td>docking_leave_unload_loc_straight_dist</td><td>float</td><td>1.0</td><td>Limit curvature until this distance from load or unload.</td></tr>
<tr><td>docking_mode_to_fleet_control_dist</td><td>float</td><td>2.5</td><td>Keep the reported docking mode for fleet control active for this distance after leaving the docking location. The distance is measured from the navigation point position at the end of previous docking to its current position.</td></tr>
<tr><td>docking_notify_approach_dist</td><td>float</td><td>0.50</td><td>Distance from docking target when a notification is sent to the AGV control.</td></tr>
<tr><td>docking_stopping_point_offset_mode</td><td>int</td><td>0</td><td>0 = Use general stopping offsets, 1 = offsets are defined individually for each pallet model with parameters.</td></tr>
<tr><td>docking_follow_route_properties</td><td>int</td><td>1</td><td>Use defined properties on the route while creating custom route for docking.</td></tr>
<tr><td>docking_refpoint_max_err</td><td>float</td><td>-0.5</td><td>Maximum error [m] for the docking point after started docking. Indicate pushing pallet. If negative, not used.</td></tr>
<tr><td>docking_actuator_height_control_mode</td><td>int</td><td>0</td><td>Defines how lift / fork actuator is controlled in relation to the detected target height during docking. 0 = Disabled, 1 = Direct control. Detected target height is given directly as actuator height reference. 2 = Relative control. Actuator is controlled so that detected height matches value defined by docking_actuator_target_height</td></tr>
<tr><td>docking_actuator_target_height</td><td>float</td><td>0.0</td><td>Defines the desired target height [m] during docking. Actuator is controlled so that height of the detected target mathes this value. Only used when docking_actuator_height_control_mode is set to 2</td></tr>
<tr><td>docking_actuator_height_strict_dist</td><td>float</td><td>0.0</td><td>Defines a distance [m] from the docking target point within which actuator height must be on the reference or the drive is stopped.</td></tr>
<tr><td>docking_actuator_height_start_dist</td><td>float</td><td>20.0</td><td>Defines a distance [m] from the docking target point within which the actuator height control is allowed.</td></tr>
<tr><td>docking_control_point_1_dist_from_machine</td><td>float</td><td>0.20</td><td>Minimum required distance for the node straight to the AGV heading. The start node is calculated automatically, but if it is closer to the AGV than this paramaeter, an error is set. Used to avoid driving too sharp curves.</td></tr>
<tr><td>docking_control_point_2_dist_from_target</td><td>float</td><td>0.80</td><td>Distance for the node to create straight route before target.</td></tr>
<tr><td>docking_allow_custom_route_update</td><td>int</td><td>0</td><td>0 = custom route is locked after it is created, 1 = custom route is updated if the target changes.</td></tr>
<tr><td>docking_custom_route_min_xy_diff</td><td>float</td><td>0.02</td><td>Minimum distance difference [m] between the old pallet and the new to update the last part of the custom route. If set to positive, custom route is updated. Also uses target_detection_max_diff_in_xy_results to check that the difference is not too large.</td></tr>
<tr><td>docking_custom_route_min_angle_diff</td><td>float</td><td>2.0</td><td>Minimum angle difference [deg] between the old pallet and the new to update the last part of the custom route. If set to positive, custom route is updated. Also uses target_detection_max_diff_in_angle_results to check that the difference is not too large.</td></tr>
<tr><td>docking_custom_route_max_allowed_xy_diff_for_target</td><td>float</td><td>0.2</td><td>Maximum limit [m] for the custom route update related to the initial target. The custom route is not updated if the new target is further away than this parameter from the initial target (target location when the custom route is created for the first time).</td></tr>
<tr><td>docking_to_agv_mode</td><td>int</td><td>0</td><td>Defines if the AGV is the docking AGV or the target of docking when docking two AGVs together. 0 = docking AGV, 1 = target.</td></tr>
<tr><td>docking_to_agv_connection_dist</td><td>float</td><td>20.0</td><td>Defines the distance between docking AGV and target AGV within which a connection is required.</td></tr>
</tbody></table>
<h3 id="synchronized-driving"><a class="header" href="#synchronized-driving">Synchronized driving</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>coupled_drive_enabled</td><td>int</td><td>0</td><td>Enables coupled-driving feature.</td></tr>
<tr><td>coupled_pid_heading_err_p</td><td>float</td><td>2.0</td><td>Proportional controller gain for heading error between AGV nominal and reference heading in formation.</td></tr>
<tr><td>coupled_pid_heading_err_i</td><td>float</td><td>0.0</td><td>Integral controller gain for heading error between AGV nominal and reference heading in formation.</td></tr>
<tr><td>coupled_pid_lon_dist_err_p</td><td>float</td><td>2.0</td><td>Proportional controller gain for longitudinal distance error between AGV nominal and reference position in formation.</td></tr>
<tr><td>coupled_pid_lon_dist_err_i</td><td>float</td><td>0.0</td><td>Integral controller gain for longitudinal distance error between AGV nominal and reference position in formation.</td></tr>
<tr><td>coupled_pid_trans_dist_err_p</td><td>float</td><td>2.0</td><td>Proportional controller gain for lateral distance error between AGV nominal and reference position in formation.</td></tr>
<tr><td>coupled_pid_trans_dist_err_i</td><td>float</td><td>0.0</td><td>Integral controller gain for lateral distance error between AGV nominal and reference position in formation.</td></tr>
<tr><td>coupled_pid_delta_v_lim</td><td>float</td><td>0.2</td><td>Maximum allowed velocity change from reference due to formation error.</td></tr>
<tr><td>coupled_pid_delta_c_lim</td><td>float</td><td>0.3</td><td>Maximum allowed curvature change from reference due to formation error.</td></tr>
<tr><td>coupled_max_dist_err_cm</td><td>float</td><td>3.0</td><td>Maximum allowed distance error between nominal and current position of AGVs in coupled drive before an error is raised.</td></tr>
<tr><td>coupled_max_head_err_deg</td><td>float</td><td>2.0</td><td>Maximum allowed heading error between nominal and current position of AGVs in coupled drive before an error is raised.</td></tr>
<tr><td>coupled_max_drive_v</td><td>float</td><td>0.30</td><td>Maximum allowed formation velocity [m/s] during coupled drive.</td></tr>
<tr><td>coupled_formation_err_sensor</td><td>uint</td><td>0</td><td>Formation error sensortype: 0 = from Navigation SW positioning, 1 = external sensor, 2 = pattern detection.</td></tr>
<tr><td>coupled_formation_offset_max_read_fail_count</td><td>uint</td><td>5</td><td>Maximum consecutive cycles of missing measurements from formation error sensor before an error is raised.</td></tr>
<tr><td>coupled_formation_err_h_can_enc_idx</td><td>int</td><td>-1</td><td>Index in can_enc_actuator parameter arrays for coupled drive formation heading error CAN sensor.</td></tr>
<tr><td>coupled_formation_err_x_can_enc_idx</td><td>int</td><td>-1</td><td>Index in can_enc_actuator parameter arrays for coupled drive formation longitudinal (x) error sensor.</td></tr>
<tr><td>coupled_formation_err_disable_route_property</td><td>string</td><td>FormationErrCtrlDisabled</td><td>Route property to disable formation error control on specific routes.</td></tr>
<tr><td>coupled_formation_localize_mode</td><td>int</td><td>0</td><td>Formation localization mode: 0 = From AGV position and formation errors, 1 = From Leader and Follower position.</td></tr>
<tr><td>coupled_pid_override_lon_dist_err_cm</td><td>float</td><td>0.0</td><td>Coupled drive longitudinal distance error controller will use override gains if error is below this distance.</td></tr>
<tr><td>coupled_pid_override_trans_dist_err_cm</td><td>float</td><td>0.0</td><td>Coupled drive transversal distance error controller will use override gains if error is below this distance.</td></tr>
<tr><td>coupled_pid_override_head_err_deg</td><td>float</td><td>0.0</td><td>Coupled drive heading error controller will use override gains if error is below this limit.</td></tr>
<tr><td>coupled_pid_override_heading_err_p</td><td>float</td><td>0.0</td><td>Coupled drive controller gain for heading error control in override control region.</td></tr>
<tr><td>coupled_pid_override_lon_dist_err_p</td><td>float</td><td>0.0</td><td>Coupled drive controller gain for longitudinal distance error control in override control region.</td></tr>
<tr><td>coupled_pid_override_trans_dist_err_p</td><td>float</td><td>0.0</td><td>Coupled drive controller gain for lateral distance error control in override control region.</td></tr>
<tr><td>coupled_comm_status_update_interval_ms</td><td>int</td><td>100</td><td>Interval of periodic status and control updates between coupled AGVs.</td></tr>
<tr><td>coupled_comm_control_ref_timeout_ms</td><td>int</td><td>200</td><td>Timeout for control reference from leader AGV.</td></tr>
<tr><td>coupled_comm_loss_stop_time</td><td>float</td><td>2.0</td><td>Deceleration time in case of coupled communicaiton loss.</td></tr>
<tr><td>coupled_comm_loss_fstop_timeout</td><td>float</td><td>5.0</td><td>Coupled driving state is changed to FStop if communication between coupled AGVs is lost for more than this period.</td></tr>
<tr><td>coupled_actuator_control</td><td>int</td><td>0</td><td>Enables coupled drive actuator control feature.</td></tr>
<tr><td>coupled_barrier_stop_signal_max_wait_time_ms</td><td>int</td><td>3000</td><td>Maximum wait time from the first AGV stopped signal to the other before error is set and barrier stop aborted.</td></tr>
<tr><td>navicomm_inte_ip</td><td>string</td><td></td><td>IP address of Navigation SW IPC for navicomm communication interface.</td></tr>
<tr><td>navicomm_inte_port</td><td>int</td><td>1236</td><td>Port for navicomm communication interface.</td></tr>
</tbody></table>
<h3 id="trailer-transport"><a class="header" href="#trailer-transport">Trailer transport</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>trailer_transport_enabled</td><td>int</td><td>0</td><td>Enables trailer transport feature.</td></tr>
<tr><td>trailer_error_timer_ms</td><td>int</td><td>60000</td><td>Error timer for trailer (un)coupling operations. If the system does not change to the requested coupling status within this time an error is raised.</td></tr>
<tr><td>trailer_kingpin_approach_max_dist</td><td>float</td><td>1.0</td><td>The maximum drive distance when approaching kingpin during coupling. An error is set if kingpin is not detected within this distance.</td></tr>
<tr><td>trailer_kingpin_approach_max_v</td><td>float</td><td>0.2</td><td>The maximum drive speed when approaching kingpin during coupling.</td></tr>
<tr><td>trailer_uncoupling_straight_leave_dist</td><td>float</td><td>0.5</td><td>The straight drive distance for leaving kingpin after uncoupling.</td></tr>
<tr><td>trailer_uncoupling_straight_leave_max_v</td><td>float</td><td>0.2</td><td>The straight drive maximum velocity for leaving kingpin after uncoupling.</td></tr>
<tr><td>trailer_max_heading_err_close_deg</td><td>float</td><td>7.0</td><td>Error is set, if trailer angle error is larger than this value and scanner telescope length is less than the distance to frontmost axle.</td></tr>
<tr><td>trailer_max_heading_err_far_deg</td><td>float</td><td>1.5</td><td>Error is set, if trailer angle error is larger than this value and scanner telescope length is larger than the distance to frontmost axle.</td></tr>
<tr><td>trailer_transport_pid_heading_err_p</td><td>float</td><td>3.0</td><td>Controller gain for Trailer-AGV heading error control in trailer transport.</td></tr>
</tbody></table>
<h3 id="magnetic-line-following"><a class="header" href="#magnetic-line-following">Magnetic line following</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>line_following_sensor_communication</td><td>int</td><td>0</td><td>0 = disabled, 1 = CAN enabled, 2 = Ethernet UDP</td></tr>
<tr><td>line_following_sensor_model</td><td>int[]</td><td>0</td><td>0 = None, 1 = Sick MLS</td></tr>
<tr><td>line_following_sensor_nodeid</td><td>int[]</td><td>0</td><td>CANOpen Node ID. 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>line_following_sensor_pos_x</td><td>float[]</td><td>0.0</td><td>The sensor x-position with respect to navigation point (local coordinates).</td></tr>
<tr><td>line_following_sensor_pos_y</td><td>float[]</td><td>0.0</td><td>The sensor y-position with respect to navigation point (local coordinates).</td></tr>
<tr><td>line_following_sensor_offset_y</td><td>float[]</td><td>0.0</td><td>The y deviation from the nominal sensor position.</td></tr>
<tr><td>line_following_sensor_flipped</td><td>int[]</td><td>0</td><td>The sensor is flipped, the measurements are not in same coordinate system as AGV, measurements rotated 180 degrees.</td></tr>
<tr><td>line_following_max_dist_since_last_meas</td><td>float</td><td>0.1</td><td>The maximum Euclidean distance the AGV can drive in map coordinates without receiving measurements before giving error.</td></tr>
<tr><td>line_following_swap_bytes</td><td>int</td><td>0</td><td>Swap bytes in line following ethernet interface: 0 = Little endian, 1 = Big endian</td></tr>
<tr><td>line_following_sensor_eth_port</td><td>int[]</td><td>5333</td><td>Port of the device.</td></tr>
</tbody></table>
<h2 id="localization"><a class="header" href="#localization">Localization</a></h2>
<h3 id="odometry-configuration"><a class="header" href="#odometry-configuration">Odometry configuration</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>odo_timing_mode</td><td>int</td><td>1</td><td>Enable automatic odometry timestamp variation correction.</td></tr>
<tr><td>odo_max_interval_ms</td><td>int</td><td>60</td><td>Maximum interval between two consecutive odometry data updates [ms].</td></tr>
<tr><td>odo_max_interval_stdev_us</td><td>int</td><td>2500</td><td>Maximum standard deviation of odometry update intervals [us].</td></tr>
<tr><td>odo_use_dsdr_calc</td><td>int</td><td>1</td><td>Use distance and heading mode for odometry calculation. Old ethernet communication protocol.</td></tr>
<tr><td>odo_err_est_alpha</td><td>float</td><td>0.002</td><td>Positioning error averaging weight, must be higher than odo_auto_corr_alpha_*.</td></tr>
<tr><td>odo_auto_corr_alpha_dh</td><td>float</td><td>0.000</td><td>Relative amount of averaged positioning error applied on odometry turning rate correction, must be lower than odo_err_est_alpha, set to 0 to disable, ex. value 0.001.</td></tr>
<tr><td>odo_auto_corr_alpha_ds</td><td>float</td><td>0.000</td><td>Relative amount of averaged positioning error applied on odometry distance correction, must be lower than odo_err_est_alpha, set to 0 to disable, ex. value 0.001.</td></tr>
<tr><td>odo_auto_corr_alpha_h</td><td>float</td><td>0.000</td><td>Relative amount of averaged positioning error applied on odometry heading correction, must be lower than odo_err_est_alpha, set to 0 to disable, ex. value 0.001.</td></tr>
<tr><td>odo_auto_corr_h_mode</td><td>int</td><td>0</td><td>How odometry heading correction is applied: 0 = to scanner heading(s), 1 = to driving axle heading</td></tr>
<tr><td>odo_auto_corr_max_curv_deg_p_m</td><td>float</td><td>10.0</td><td>Maximum curvature [deg/m] for odometry correction to be applied.</td></tr>
<tr><td>odo_auto_corr_max_dherr_deg</td><td>float</td><td>4.0</td><td>Maximum odometry turning correction amount [deg/m].</td></tr>
<tr><td>odo_auto_corr_max_dserr</td><td>float</td><td>0.08</td><td>Maximum odometry distance correction amount, relative amount of travelled distance.</td></tr>
<tr><td>odo_auto_corr_max_herr_deg</td><td>float</td><td>4.0</td><td>Maximum odometry heading correction amount [deg].</td></tr>
<tr><td>odo_jump_max_speed</td><td>float</td><td>5.0</td><td>Speed limit for raw odometry to be detected as invalid [m/s].</td></tr>
<tr><td>odo_jump_max_turn_rate_deg_p_s</td><td>float</td><td>180.0</td><td>Turn rate limit for raw odometry to be detected as invalid.</td></tr>
<tr><td>odo_max_extrapolate_ms</td><td>int</td><td>300</td><td>Determines the maximum time difference of current pose and the time of scanner measurement which is still accepted to be used for calculating the AGV’s pose at the time of scanner measurement.</td></tr>
</tbody></table>
<h3 id="position-initialization"><a class="header" href="#position-initialization">Position initialization</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>start_pos_ini_enabled</td><td>int</td><td>1</td><td>Enables position initialization on startup. Requires that the vehicle has been stationary since turned off. 0 = disabled, 1 = enabled, 2 = Like mode \</td></tr>
<tr><td>pos_init_max_wait_time</td><td>int</td><td>2000</td><td>Defines the timeout limit for the position initialization. If the timeout is  triggered, the position initialization algorithm will be interrupted.</td></tr>
<tr><td>pos_ini_min_conf</td><td>float</td><td>70.0</td><td>Position initialization will not be accepted if the position confidence is lower than this threshold.</td></tr>
<tr><td>pos_init_pos_conf_gain</td><td>float</td><td>0.667</td><td>This gain defines how quickly the position confidence reacts to changes during position initialization.</td></tr>
<tr><td>require_position_initialization</td><td>int</td><td>1</td><td>Defines what input is required for position initialization: 0 = Position will automatically be initialized if the confidence is high enough but a warning will be raised, 1= External position initialization is required, 2 = Position will automatically be initialized if the confidence is high enough.</td></tr>
<tr><td>pos_ini_max_history_cumds</td><td>float</td><td>0.0</td><td>0 = off, default recommended value 1.</td></tr>
<tr><td>pos_ini_max_history_dist_err</td><td>float</td><td>0.07</td><td></td></tr>
<tr><td>pos_ini_max_history_h_deg_err</td><td>float</td><td>4.0</td><td></td></tr>
<tr><td>pos_ini_max_total_dxy</td><td>float</td><td>0.0</td><td>Defines the maximum allowed movement from initialization point along both the x-axis and y-axis. Position initialization will stop after this threshold is breached. To avoid any limitation, set this parameter to 0.</td></tr>
<tr><td>pos_ini_max_total_dh_deg</td><td>float</td><td>0.0</td><td>Defines the maximum allowed heading correction from the heading of the initialization point. Position initialization will stop after this threshold is breached. To avoid any direct limitation, set this parameter to 0.</td></tr>
<tr><td>pos_ini_no_dr_chk_ms</td><td>int</td><td>0</td><td>If &gt;0, dead reckoning checks will be disabled during position initialization and for the specified time [ms] after the position has been initialized.</td></tr>
<tr><td>pos_ini_remaining_diff_xy</td><td>float</td><td>0.011</td><td>Position initialization will not finish before the position corrections in x and y are below this threshold.</td></tr>
<tr><td>pos_ini_remaining_diff_h</td><td>float</td><td>0.5</td><td>Position initialization will not finish before the heading corrections are below this threshold.</td></tr>
<tr><td>pos_ini_min_reflectors_seen</td><td>int</td><td>0</td><td>Minimum number of reflectors required to be seen when initializing position.</td></tr>
<tr><td>pos_ini_max_reflector_pos_err</td><td>float</td><td>0.05</td><td>Maximum deviation [m] in the reflector position compared to its taught map position for it to be counted as valid during position initialization.</td></tr>
<tr><td>pos_ini_refl_check_enable</td><td>int</td><td>0</td><td>If enabled, the navigation software tracks the reflectors after position initialization.</td></tr>
<tr><td>pos_ini_min_refl_seen_while_driving</td><td>int</td><td>2</td><td>Defines the minimum number of reflectors to be seen at least once while driving. Active during reflector tracking after position initialization.</td></tr>
<tr><td>pos_ini_max_dist_refl_seen_while_driving</td><td>float</td><td>10.0</td><td>Defines the upper threshold to the driving distance [m] during tracking. The tracking process must succeed within this distance.</td></tr>
<tr><td>pos_ini_min_dist_refl_seen_while_driving</td><td>float</td><td>1.0</td><td>Minimum distance specified [m] for vehicle to decide if it has seen pos_ini_conf_min_refl_seen number of reflectors otherwise set posInitDone to 0</td></tr>
<tr><td>pos_ini_refl_based_enable</td><td>int</td><td>0</td><td>Enables position initialisation based on reflector triangulation.</td></tr>
<tr><td>pos_ini_refl_based_co_dist_refl</td><td>float</td><td>20.0</td><td>Reflector-based position initialization - Distance (cutoff) between the reflectors to consider determining angles between them.</td></tr>
<tr><td>pos_ini_refl_dist_match_eps</td><td>float</td><td>0.1</td><td>Maximum distance difference between distances of the map reflectors vs the measured reflectors for automatic position initialization.</td></tr>
<tr><td>pos_ini_refl_ang_match_eps</td><td>float</td><td>1.0</td><td>Maximum angle difference [deg] between the observed angle and the calculated angle created at a particular reflector point by vectors joing any other two reflectors.</td></tr>
<tr><td>pos_ini_refl_min_allowed_ang</td><td>float</td><td>1.0</td><td>Minimum allowed angle formed by 3 reflectors for reflector-based position initialization.</td></tr>
<tr><td>pos_ini_refl_max_allowed_ang</td><td>float</td><td>179.0</td><td>Max allowed angle formed by 3 reflectors for reflector-based position initialization.</td></tr>
<tr><td>pos_ini_refl_auto_repos_en</td><td>int</td><td>0</td><td>Enables automatic position initialization based on reflectors when AGV has lost position.</td></tr>
<tr><td>pos_ini_refl_try_count</td><td>int</td><td>10</td><td>Max number of attempts to initialize position via reflector matching algorithm; by any position initialization this counter will be reset. (max value: 1000)</td></tr>
<tr><td>pos_ini_refl_number_sets</td><td>int</td><td>10</td><td>Number of reflector sets to be formed from the reflectors seen by the scanner. Modify this to reduce the time taken by algorithm and also the computational cost.</td></tr>
<tr><td>pos_ini_refl_matching_interval_ms</td><td>int</td><td>1000</td><td>Time interval (in milliseconds) between two consecutive position initialization attempts.</td></tr>
<tr><td>pos_ini_refl_min_conf</td><td>float</td><td>70.0</td><td>Automatic reflector position initialization should not be triggered if position confidence is above this threshold.</td></tr>
<tr><td>pos_init_xyh_min_gain</td><td>float</td><td>0.2</td><td>Defines a minimum map confidence gain for scaling the amount of applied heading correction when initializing position.</td></tr>
<tr><td>start_info_save_interval_secs</td><td>int</td><td>30</td><td>Save interval [s] of startinfo file at run time. 0 = disable saving at run time</td></tr>
<tr><td>start_info_save_stopped_time_secs</td><td>int</td><td>5</td><td>Save startinfo file after specified time [s] after AGV has stopped. Note that start_info_save_interval_secs = 0 disables also this saving.</td></tr>
<tr><td>start_pos_ini_max_dist_err</td><td>float</td><td>0.06</td><td>Defines the maximum deviation between a live scanner point and its value stored in the start info for it to be considered as matching during position initialization from start info.</td></tr>
<tr><td>start_pos_ini_min_match_rate</td><td>float</td><td>0.5</td><td>Defines how large the fraction of scanners points matching the data stored in the start info should be for position initialization to go through.</td></tr>
<tr><td>start_pos_ini_ext_loc_xy_err</td><td>float</td><td>0.1</td><td>Maximum external localization xy err for start position initialization.</td></tr>
<tr><td>start_pos_ini_ext_loc_h_err_deg</td><td>float</td><td>2.0</td><td>Maximum external localization heading err for start position initialization.</td></tr>
</tbody></table>
<h3 id="positioning"><a class="header" href="#positioning">Positioning</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>loc_corr_onedir_in_use</td><td>int</td><td>0</td><td>Enables one dimensional corrections and weight dampening in one-dimensional environments. Used in environments such as corridors, where the natural features are only seen along one direction.</td></tr>
<tr><td>loc_xy_max_corr</td><td>float</td><td>0.01</td><td>Sets an upper threshold to the position corrections in the xy-plane. Position corrections larger than this are limited to the specified value.</td></tr>
<tr><td>loc_h_max_corr</td><td>float</td><td>0.3</td><td>Sets an upper threshold to the heading corrections. Heading corrections larger than this are limited to the specified value [deg].</td></tr>
<tr><td>loc_corr_when_stationary</td><td>int</td><td>1</td><td>0 = position is not corrected when odometry indicates that the vehicle is stationary, 1 = position is corrected at all times.</td></tr>
<tr><td>loc_cum_xy_corr_warn</td><td>float</td><td>0.0</td><td>If larger than 0.0f, this sets an upper threshold to the cumulative position corrections in the xy-plane per driven meter. If the limit is exceeded, WARNING_LARGE_CUM_XY_CORRECTION is set.</td></tr>
<tr><td>loc_cum_h_corr_warn</td><td>float</td><td>0.0</td><td>If larger than 0.0f, this sets an upper threshold to the cumulative heading correction per driven meter. If the limit is exceeded, WARNING_LARGE_CUM_HEADING_CORRECTION is set.(degrees)</td></tr>
<tr><td>loc_slip_det_max_dir_diff_deg</td><td>float</td><td>360.0</td><td>Maximum difference between slipping direction and machine heading.</td></tr>
<tr><td>loc_slip_det_speed_lim</td><td>float</td><td>0.1</td><td>Maximum speed for slip detection to ignore speed and direction difference limits.</td></tr>
<tr><td>loc_slip_det_small_xy_corr</td><td>float</td><td>0.0</td><td>Minimum xy correction to be detected as small slipping: 0 = disabled</td></tr>
<tr><td>loc_slip_det_large_xy_corr</td><td>float</td><td>0.0</td><td>Minimum xy correction to be detected as large slipping: 0 = disabled</td></tr>
<tr><td>loc_slip_det_large_h_corr_deg</td><td>float</td><td>0.0</td><td>Minimum h correction to be detected as large slipping: 0 = disabled</td></tr>
<tr><td>loc_slip_det_small_v_drop</td><td>float</td><td>0.40</td><td>Minimum velocity drop to trigger position correction for small xy slip: 0.0 = always enabled</td></tr>
<tr><td>loc_odo_v_drop_alpha</td><td>float</td><td>0.1</td><td>Odometry speed averaging gain.</td></tr>
<tr><td>loc_slip_det_corr_apply_mode</td><td>int</td><td>0</td><td>Correction mode for slip detection: 0 = apply both h and xy correction completely, 1 = apply only h correction completely, 2 = apply only xy correction completely</td></tr>
<tr><td>loc_slip_det_xy_corr_limit</td><td>float</td><td>1.0</td><td>How much xy correction is allowed when slipping.</td></tr>
<tr><td>loc_slip_det_xy_corr_increase_per_cycle</td><td>float</td><td>0.10</td><td>The increase in maximum xy correction in each cycle when wheel slip is detected.</td></tr>
<tr><td>loc_slip_det_h_corr_increase_per_cycle_deg</td><td>float</td><td>1.0</td><td>The increase in maximum h correction in each cycle when wheel slip is detected [deg].</td></tr>
<tr><td>corr_refl_conf_new</td><td>int</td><td>0</td><td></td></tr>
<tr><td>corr_refl_conf_max_dist_err</td><td>float</td><td>0.1</td><td>Sets an upper threshold to the distance deviation for a single reflector for the position confidence calculation. Only used in the corr_refl_conf_new mode.</td></tr>
<tr><td>corr_refl_conf_min_dist_err</td><td>float</td><td>0.01</td><td>Sets a lower threshold to the distance deviation for a single reflector for the position confidence calculation. Only used in the corr_refl_conf_new mode.</td></tr>
<tr><td>corr_refl_conf_max_ang_err_deg</td><td>float</td><td>1.0</td><td>Sets an upper threshold to the heading deviation for a single reflector for the position confidence calculation. Only used in the corr_refl_conf_new mode.</td></tr>
<tr><td>corr_refl_conf_min_ang_err_deg</td><td>float</td><td>0.02</td><td>Sets a lower threshold to the heading deviation for a single reflector for the position confidence calculation. Only used in the corr_refl_conf_new mode.</td></tr>
<tr><td>loc_xy_max_corr_ini_pos</td><td>float</td><td>0.05</td><td>Defines an upper threshold to the position corrections in xy-plane during position initialization.</td></tr>
<tr><td>loc_h_max_corr_ini_pos</td><td>float</td><td>4.0</td><td>Defines an upper threshold to the heading corrections during position initialization.</td></tr>
<tr><td>loc_xy_max_corr_monitor_ini_pos</td><td>float</td><td>0.01</td><td>Defines an upper threshold to the position corrections in the xy-plane during position initialization triggered by Monitor.</td></tr>
<tr><td>loc_h_max_corr_monitor_ini_pos</td><td>float</td><td>1.0</td><td>Defines an upper threshold to the heading corrections during position initialization triggered by Monitor.</td></tr>
<tr><td>teach_file_format</td><td>int</td><td>5</td><td>Saved teach file format version: 1 = old format, 2 = new format released with new segment files (1.0.9.6), 3 = new format with high resolution reflector data (Tools 2.01), 4 = support for array parameters (Tools 2.20), 5 = support for external localization (Tools 2.5X)</td></tr>
<tr><td>map_cell_width</td><td>float</td><td>0.2</td><td>Square cell side length for calculating map table indices from xy.</td></tr>
<tr><td>map_area_cell_width_multiplier</td><td>int</td><td>5</td><td>map_cell_width * value</td></tr>
<tr><td>corr_peak_edge_dist</td><td>float</td><td>0.1</td><td>Sets the upper threshold for the peak edge distance which is used when calculating the peak edge scale for the position confidence. If the peak edge distance is larger than this, the peak edge scale is set to 0.</td></tr>
<tr><td>corr_other_peak_min_dist</td><td>float</td><td>0.05</td><td></td></tr>
<tr><td>corr_peak_edge_ratio</td><td>float</td><td>0.98</td><td>Defines the ratio of the peak that has to be within a certain distance when calculating the peak edge scale.</td></tr>
<tr><td>corr_scan_max_weight_dist</td><td>float</td><td>8.0</td><td>Sets an upper limit to weight a single scanner point based on distance.</td></tr>
<tr><td>corr_scan_min_dist</td><td>float</td><td>0.5</td><td></td></tr>
<tr><td>corr_resolution</td><td>float</td><td>0.02</td><td>Defines the resolution used in positioning.</td></tr>
<tr><td>corr_range</td><td>float</td><td>0.26</td><td>Defines the range where new position is searched from. Only position corrections within this distance are considered.</td></tr>
<tr><td>corr_table_pad_mode</td><td>int</td><td>1</td><td>Defines how padding is applied. 0 = no padding, 1 = min padding, 2 = avg padding.</td></tr>
<tr><td>corr_range_ini_pos</td><td>float</td><td>1.0</td><td>Defines the range where new position is searched from during position initialization. Only position corrections within this distance are considered.</td></tr>
<tr><td>corr_blur_radius</td><td>float</td><td>2.5</td><td></td></tr>
<tr><td>corr_xyh_pol_resolution</td><td>float</td><td>0.25</td><td>Defines the heading correction resolution [deg].</td></tr>
<tr><td>corr_pol_range</td><td>float</td><td>5.0</td><td>Defines the allowed range for heading corrections [deg].</td></tr>
<tr><td>corr_pol_range_ini_pos</td><td>float</td><td>20.0</td><td>Defines the allowed range for heading correction [deg] when initializing position.</td></tr>
<tr><td>corr_refl_pol_blur_radius</td><td>float</td><td>5.0</td><td></td></tr>
<tr><td>corr_pol_max_dr</td><td>float</td><td>0.025</td><td></td></tr>
<tr><td>corr_pol_max_pt_dist</td><td>float</td><td>0.3</td><td></td></tr>
<tr><td>corr_pol_peak_min_val</td><td>float</td><td>0.0</td><td></td></tr>
<tr><td>corr_pol_max_peak_ratio</td><td>float</td><td>0.9</td><td></td></tr>
<tr><td>corr_refl_pol_new_mode_max_dist</td><td>float</td><td>1.5</td><td>Maximum distance between rotation center and AGV position to use rotation center.</td></tr>
<tr><td>corr_refl_pol_new_mode_refl_min_dist</td><td>float</td><td>3.0</td><td>At least two reflectors must be further than min distance from each other to use new mode.</td></tr>
<tr><td>corr_refl_pol_new_mode_nav_point_weight</td><td>float</td><td>0.30</td><td>Weight of navigation point in calculation of polar rotation point.</td></tr>
<tr><td>corr_refl_pol_new_mode_use_always</td><td>int</td><td>1</td><td></td></tr>
<tr><td>corr_refl_pol_min_dist_from_rot_axis</td><td>float</td><td>0.0</td><td>Minimum distance between reflector and rotation axis.</td></tr>
<tr><td>loc_refl_dist_corr</td><td>float</td><td>0.025</td><td></td></tr>
<tr><td>loc_refl_point_sel_dist</td><td>float</td><td>0.5</td><td>Maximum distance between seen and map position to match the reflector.</td></tr>
<tr><td>loc_refl_max_dist_diff</td><td>float</td><td>0.1</td><td>Maximum distance to reflector difference between two sequential beams.</td></tr>
<tr><td>loc_refl_tot_dist_err</td><td>float</td><td>0.55</td><td>Cumulative distance errors for all reflectors seen.</td></tr>
<tr><td>loc_refl_max_angle_corr</td><td>float</td><td>5.0</td><td>Maximum angle difference between map and seen angles in reflector pair.</td></tr>
<tr><td>loc_refl_min_detected_amount</td><td>int</td><td>2</td><td>Minimum number of detected reflectors to be used in localization.</td></tr>
<tr><td>loc_refl_single_min_dist</td><td>float</td><td>2.0</td><td>Minimum distance to use the reflector in case of single reflectors seen.</td></tr>
<tr><td>loc_refl_pos_filter_amount</td><td>float</td><td>0.8</td><td>Coefficient for filtering reflectors points to a cluster.</td></tr>
<tr><td>corr_h_map_weight_conf_scale_limit</td><td>float</td><td>50.0</td><td>Parameter is used to calculate a weight between the heading correction results from map and reflectors. [%]</td></tr>
<tr><td>corr_h_map_max_weight_conf</td><td>float</td><td>90.0</td><td>Reflectors are not used for heading correction if map confidence is higher than this limit [%].</td></tr>
<tr><td>corr_h_map_min_weight_conf</td><td>float</td><td>80.0</td><td>Defines a lower threshold for scaling the weight for the applied heading correction based on the map and reflectors. [%]</td></tr>
<tr><td>loc_refl_h_corr_base_weight</td><td>float</td><td>5000.0</td><td>Base weight for reflector points.</td></tr>
<tr><td>loc_refl_h_corr_dist_weight</td><td>float</td><td>100.0</td><td>Gain for distance related weight for reflector points.</td></tr>
<tr><td>loc_refl_h_corr_dr_weight</td><td>int</td><td>1</td><td>Enables reflector weight calculation based on radial distance between map reflector position and actual position.</td></tr>
<tr><td>loc_refl_pos_filter_min_npts</td><td>int</td><td>4</td><td>Maximum number of scanner points forming a reflector cluster. Affects on accuracy of distance to reflector measurement.</td></tr>
<tr><td>loc_same_sign_gain</td><td>float</td><td>2.0</td><td></td></tr>
<tr><td>loc_same_single_reflector_dist</td><td>float</td><td>0.2</td><td>The position difference between a single reflector as seen by the scanner and on the map.</td></tr>
<tr><td>corr_pol_peak_edge_dist_deg</td><td>float</td><td>1.5</td><td>Defines the edge of the highest peak. The peak must be narrow enough to use the corresponding heading correction.</td></tr>
<tr><td>corr_peak_edge_min_dist</td><td>float</td><td>0.04</td><td>Sets the lower threshold for the peak edge distance which is used when calculating the peak edge scale for the position confidence. If the peak edge distance is smaller than this, the peak edge scale is set to 1.</td></tr>
<tr><td>corr_refl_max_dist_err</td><td>float</td><td>0.03</td><td>Maximum distance error for reflector measurements.</td></tr>
<tr><td>corr_refl_max_ang_err_deg</td><td>float</td><td>2.0</td><td>Angle error of reflector measurements</td></tr>
<tr><td>corr_refl_single_max_ang_err_multiplier</td><td>float</td><td>1.0</td><td>Multiplier for angle error of reflector measurements when only one is seen, recommended value at least 2.</td></tr>
<tr><td>corr_refl_pos_ini_max_ang_err_deg</td><td>float</td><td>2.0</td><td>Maximum angle error for reflector measurements for position initialization.</td></tr>
<tr><td>corr_refl_weight</td><td>float</td><td>1.0</td><td>Gain that sets the relation in weight between the reflector points and regular environment points in case if multiple reflectors are seen.</td></tr>
<tr><td>corr_refl_weight_single</td><td>float</td><td>1.0</td><td>Gain that sets the relation in weight between the reflector points and regular scanner points in case if single reflector is seen.</td></tr>
<tr><td>loc_refl_dist_penalty</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>corr_refl_conf_dist</td><td>float</td><td>0.02</td><td>Gain for reflector position confidence. Should be increased to increase reflector position confidence. Used only when corr_refl_conf_new is set to 0.</td></tr>
<tr><td>corr_refl_dist_err</td><td>float</td><td>0.01</td><td>Addition to the total error of reflector distance error. Should be decreased to increase reflector position confidence. Used only when corr_refl_conf_new is set to 0.</td></tr>
<tr><td>loc_onedir_max_err</td><td>float</td><td>0.02</td><td>Determines a threshold for the estimated error of the 1D LSQ fit. One-dimensional corrections will not be applied if the error exceeds this value.</td></tr>
<tr><td>loc_onedir_min_scale</td><td>float</td><td>0.2</td><td>This defines a threshold for the peak-edge-scale. One-dimensional corrections will not be applied if the peak-edge-scale exceeds this value.</td></tr>
<tr><td>loc_onedir_new_scale</td><td>float</td><td>0.3</td><td>If one-dimensional corrections are applied, this is the peak-edge-scale.</td></tr>
<tr><td>corr_1d_ang_max_err</td><td>float</td><td>0.03</td><td>Determines a threshold for the estimated error of the 1D LSQ fit. 1D weight dampening will not be applied if the error exceeds this value.</td></tr>
<tr><td>corr_1d_max_portion</td><td>float</td><td>0.5</td><td>Determines how large ratio of the weight are originating from points classified as one-dimensional.</td></tr>
<tr><td>corr_1d_min_pt_weight</td><td>float</td><td>0.025</td><td>Sets a lower limit to the weight for individual points classified as one-dimensional. Points with lower weights will be limited to this value.</td></tr>
<tr><td>corr_1d_max_pt_weight</td><td>float</td><td>0.5</td><td>Sets an upper limit to the weight for individual points classified as one-dimensional. Points with higher weights will be limited to this value.</td></tr>
<tr><td>corr_1d_damping_pt_dirv_min_rn</td><td>int</td><td>3</td><td>Defines the minimum number of neighboring points on each side during the weight scale calculation for the weight dampening of points considered to be one-dimensional.</td></tr>
<tr><td>corr_1d_damping_pt_dirv_min_r</td><td>float</td><td>0.1</td><td>Defines the minimum distance on each side for which the points closer than this should be checked during the weight scale calculation for the weight dampening of points considered to be one-dimensional.</td></tr>
<tr><td>corr_1d_damping_pt_dirv_min_err</td><td>float</td><td>0.02</td><td>Defines the lower threshold for the error during the 1D weight dampening calculation. Errors smaller than this give an initial scale of 0.</td></tr>
<tr><td>corr_1d_damping_pt_dirv_max_err</td><td>float</td><td>0.06</td><td>Defines the upper threshold for the error during the 1D weight dampening calculation. Errors larger than this give an initial scale of 1.</td></tr>
<tr><td>corr_1d_damping_mask_ratio</td><td>float</td><td>0.5</td><td>During the 1D weight dampening process, this ratio defines the masking threshold used to filter out unwanted points.</td></tr>
<tr><td>loc_use_points_inside_frame</td><td>int</td><td>0</td><td>Enable the use of scanner points inside vehicle frame.</td></tr>
<tr><td>corr_xyh_resolution</td><td>float</td><td>0.02</td><td>Defines the resolution for heading corrections.</td></tr>
<tr><td>corr_xyh_table_radius</td><td>int</td><td>7</td><td></td></tr>
<tr><td>corr_xyh_blur_radius</td><td>float</td><td>1.5</td><td></td></tr>
<tr><td>corr_xyh_pol_blur_radius</td><td>float</td><td>0.0</td><td></td></tr>
<tr><td>corr_xyh_pol_interp</td><td>int</td><td>1</td><td></td></tr>
<tr><td>corr_xyh_max_n_groups</td><td>int</td><td>100</td><td></td></tr>
<tr><td>corr_xyh_div_search_start_interval</td><td>int</td><td>1</td><td></td></tr>
<tr><td>corr_xyh_max_range</td><td>float</td><td>0.26</td><td>Defines the range where new position is searched from. Usage is for heading corrections.</td></tr>
<tr><td>corr_xyh_group_resolution</td><td>float</td><td>0.02</td><td></td></tr>
<tr><td>localize_sleep_time_us</td><td>int</td><td>1000</td><td>Time [ms] how long localize is forced to sleep after each position correction cycle.</td></tr>
</tbody></table>
<h3 id="reflector-positioning"><a class="header" href="#reflector-positioning">Reflector positioning</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>reflector_rssi_min_ratio</td><td>float</td><td>0.85</td><td>RSSI ratio for reflector detection: Omron 0.85, Sick &amp; Pef 0.75, Hokuyo 0.50, Leuze 0.80</td></tr>
<tr><td>min_reflectors_seen</td><td>int</td><td>0</td><td>Sets an error if number of reflectors seen is less this parameter value. 0 = disabled</td></tr>
<tr><td>loc_reflector_max_ind_diff</td><td>int</td><td>3</td><td>Maximum index difference between two reflectors.</td></tr>
<tr><td>loc_reflector_min_dist</td><td>float</td><td>0.1</td><td>Minimum distance to use the reflector in case of multiple reflectors seen.</td></tr>
<tr><td>loc_reflector_max_dist</td><td>float</td><td>15.0</td><td>Maximum distance [m] to use the reflector.</td></tr>
<tr><td>loc_reflector_pair_match_dist</td><td>float</td><td>0.07</td><td>Maximum distance error for two reflectors between map and scanner positions to create a pair.</td></tr>
<tr><td>loc_reflector_filter_duplicates</td><td>int</td><td>1</td><td>Filters away duplicate reflectors.</td></tr>
<tr><td>use_single_reflector_without_pair_matching</td><td>int</td><td>1</td><td>Defines if a single reflector may be used for position correction: 0 = do not correct the position based on a single reflector, 1 = correct the position based on a single reflector.</td></tr>
<tr><td>refl_max_dist_from_line</td><td>float</td><td>0.05</td><td>Maximum deviation from line for discarding a reflector detection from the reflector pattern.</td></tr>
<tr><td>refl_discard_undersized</td><td>int</td><td>0</td><td>1 to discard undersized reflector detections from the reflector pattern.</td></tr>
<tr><td>refl_height_detection_gap_reflector_angle_deg</td><td>float</td><td>45.0</td><td>The angle A of the gap reflector CCW from vertical, gives the gap width W between the triangles as W = reflW / cos(A)</td></tr>
<tr><td>refl_height_detection_gap_reflector_width</td><td>float</td><td>0.050</td><td>The width W of the vertical reflectors and the gap angle A from vertical, gives the gap reflector width reflW = W * cos(A)</td></tr>
<tr><td>refl_height_detection_gap_reflector_index</td><td>int</td><td>2</td><td>Index of the gap reflector in the reflector pattern, preferably two vertical reflectors on each side to ensure correct pattern detection despite disturbances</td></tr>
<tr><td>refl_height_detection_reflector_height</td><td>float</td><td>0.4</td><td>The height of the vertical reflectors and the vertical height of the gap angle reflector. Gives the range of use in height detection. The height detection zero point is in the low end of the reflectors.</td></tr>
<tr><td>refl_height_detection_pattern_height_offset</td><td>float</td><td>0.0</td><td>The height offset between the low end of the reflector pattern and the ground or the reference plane on a vehicle. Positive distance when pattern above the reference level, else negative.</td></tr>
<tr><td>refl_height_detection_scanner_height_offset</td><td>float</td><td>0.0</td><td>The height offset between the scanner and the reference plane on a vehicle. Positive distance when scanner above the reference level, else negative.</td></tr>
</tbody></table>
<h3 id="position-confidence"><a class="header" href="#position-confidence">Position confidence</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pos_conf_limit</td><td>float</td><td>25.0</td><td>Defines the minimum position confidence for the machine to be able to operate.</td></tr>
<tr><td>pos_conf_gain</td><td>float</td><td>0.9</td><td>This gain defines how quickly the reported position confidence reacts to the drop of confidence.</td></tr>
<tr><td>pos_conf_odo_dist_scale</td><td>float</td><td>0.0</td><td>Traveled distance for which a change in the calculated xy-confidence will gradually be applied over. 0 = disable distance-based position confidence gradient. &gt; 0 to set the distance.</td></tr>
<tr><td>corr_conf_dte_use_peak</td><td>int</td><td>0</td><td>Defines whether the position confidence is based on the dte correlation peak which corresponds to the corrected position of the vehicle. If not activated, confidence is based on the current position of the vehicle. 0 = use the current vehicle position, 1 = use the peak.</td></tr>
<tr><td>corr_conf_min_dist_to_env</td><td>float</td><td>0.01</td><td>Sets the lower threshold for the median value of the distance to environment when calculating the dte scale for the position confidence. If the median value is lower than this, the scale is set to 1.</td></tr>
<tr><td>corr_conf_max_dist_to_env</td><td>float</td><td>0.05</td><td>Sets the upper threshold for the median value of the distance to environment when calculating the dte scale for the position confidence. If the median value is larger than this, the scale is set to 0.</td></tr>
<tr><td>corr_conf_dte_hist_portion</td><td>float</td><td>0.5</td><td>Defines where in the dte histogram we get the value that we base the dte scaling on.</td></tr>
<tr><td>corr_conf_dte_hist_max_dist</td><td>float</td><td>0.1</td><td>Defines the distance threshold for a point to be considered as matching the environment during the dte calculation. If a point is closer to the environment than this limit, it is considered as matching.</td></tr>
<tr><td>corr_conf_min_scale_npts</td><td>int</td><td>50</td><td>This defines the lower threshold for the number of points that has to match the environment. If this is not reached, the confidence will be zero.</td></tr>
<tr><td>corr_conf_max_scale_npts</td><td>int</td><td>150</td><td>This defines the upper threshold for the number of points that are matching to the environment. The confidence is scaled linearly between corr_conf_min_scale_npts and this value for which the confidence will reach its highest level.</td></tr>
<tr><td>corr_conf_min_scale_npts_override</td><td>int</td><td>0</td><td>Override value for corr_conf_min_scale_npts. 0 = disabled, &gt; 0 = override value. Activated by scanner_meas_loc_override_level.</td></tr>
<tr><td>corr_conf_max_scale_npts_override</td><td>int</td><td>0</td><td>Override value for corr_conf_max_scale_npts. 0 = disabled, &gt; 0 = override value. Activated by scanner_meas_loc_override_level.</td></tr>
<tr><td>corr_conf_dist_scale_slope</td><td>float</td><td>40.0</td><td>Defines how the dte scale for position confidence is formed based on the median value of the distance to environment.</td></tr>
<tr><td>corr_conf_max_dist_ramp_area</td><td>float</td><td>10.0</td><td>Traveled distance for which a drop in the calculated xy-confidence will be gradually applied over while inside a ramp area. 0 = disable distance-based position confidence gradient. &gt;0 to set the distance.</td></tr>
<tr><td>corr_conf_single_dim_max_dist</td><td>float</td><td>15.0</td><td>Max. odometry distance since last update.</td></tr>
<tr><td>corr_conf_dyn_map_lite_max_dist</td><td>float</td><td>10.0</td><td>Travelled distance for which a change in the calculated xy-confidence will gradually be applied over.</td></tr>
<tr><td>corr_conf_decrease_alpha_min_speed</td><td>float</td><td>0.0</td><td>Minimum limit for position confidence decrease rate. Assume that at least this distance has been travelled between scanner measurements [m].</td></tr>
<tr><td>corr_conf_precision_max_dist</td><td>float</td><td>5.0</td><td>Filters position confidence based on travelled distance in precision positioning zone. It takes roughly the parameter amount to fully apply the new confidence value.</td></tr>
<tr><td>corr_conf_precision_no_match_max_dist</td><td>float</td><td>0.1</td><td>Filters position confidence based on travelled distance in precision positioning zone (no match to environment). It takes roughly the parameter amount to fully apply the new confidence value.</td></tr>
</tbody></table>
<h3 id="sensor-fusion"><a class="header" href="#sensor-fusion">Sensor fusion</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>sf_use_sensor_fusion</td><td>int</td><td>0</td><td>Enables sensor fusion.</td></tr>
<tr><td>sf_state_init_pxy_std</td><td>float</td><td>0.010000</td><td>Standard deviation of initial px and py states for P matrix.</td></tr>
<tr><td>sf_state_init_vxy_std</td><td>float</td><td>0.001000</td><td>Standard deviation of initial vx and vy states for P matrix.</td></tr>
<tr><td>sf_state_init_axy_std</td><td>float</td><td>0.000001</td><td>Standard deviation of initial accx and accy states for P matrix.</td></tr>
<tr><td>sf_state_init_axybias_std</td><td>float</td><td>0.001000</td><td>Standard deviation of initial accxbias and accybias states for P matrix.</td></tr>
<tr><td>sf_state_init_thxyz_std_deg</td><td>float</td><td>0.010000</td><td>Standard deviation of initial thx, thy and thz states for P matrix.</td></tr>
<tr><td>sf_state_init_wxyz_std_deg</td><td>float</td><td>0.001000</td><td>Standard deviation of initial wx, wy and wz states for P matrix.</td></tr>
<tr><td>sf_state_init_wxyzbias_std_deg</td><td>float</td><td>0.050000</td><td>Standard deviation of initial thx, thy and thz states for P matrix.</td></tr>
<tr><td>sf_state_axy_std</td><td>float</td><td>0.04</td><td>Standard deviation of accx and accy states for Q matrix.</td></tr>
<tr><td>sf_state_wxy_std_deg</td><td>float</td><td>0.50000</td><td>Standard deviation of wx and wy states for Q matrix.</td></tr>
<tr><td>sf_state_wz_std_deg</td><td>float</td><td>5.0000</td><td>Standard deviation of wz state for Q matrix.</td></tr>
<tr><td>sf_state_axybias_std</td><td>float</td><td>0.000001</td><td>Standard deviation of accxbias and accybias states for Q matrix.</td></tr>
<tr><td>sf_state_wxybias_std_deg</td><td>float</td><td>0.001050</td><td>Standard deviation of wxbias and wybias states for Q matrix.</td></tr>
<tr><td>sf_state_wzbias_std_deg</td><td>float</td><td>0.001050</td><td>Standard deviation of wzbias state for Q matrix.</td></tr>
<tr><td>sf_state_pxy_std_extra</td><td>float</td><td>0.001</td><td>Extra standard deviation for px and py states for Q matrix.</td></tr>
<tr><td>sf_state_vxy_std_extra</td><td>float</td><td>0.000</td><td>Extra standard deviation for vx and vy states for Q matrix.</td></tr>
<tr><td>sf_state_thxy_std_extra_deg</td><td>float</td><td>0.100</td><td>Extra standard deviation for roll and pitch states for Q matrix.</td></tr>
<tr><td>sf_state_thz_std_extra_deg</td><td>float</td><td>0.100</td><td>Extra standard deviation for yaw state for Q matrix.</td></tr>
<tr><td>sf_laser_x_std</td><td>float</td><td>0.0010</td><td>Standard deviation of x of laser R matrix [m].</td></tr>
<tr><td>sf_laser_y_std</td><td>float</td><td>0.0010</td><td>Standard deviation of y of laser R matrix [m].</td></tr>
<tr><td>sf_laser_h_std_deg</td><td>float</td><td>0.0500</td><td>Standard deviation of h of laser R matrix [deg].</td></tr>
<tr><td>sf_extloc_x_std</td><td>float</td><td>0.0001</td><td>Standard deviation of x of external loc R matrix [m].</td></tr>
<tr><td>sf_extloc_y_std</td><td>float</td><td>0.0001</td><td>Standard deviation of y of external loc R matrix [m].</td></tr>
<tr><td>sf_extloc_h_std_deg</td><td>float</td><td>0.0010</td><td>Standard deviation of h of external loc R matrix [deg].</td></tr>
<tr><td>sf_abspos_only</td><td>int</td><td>0</td><td>If set to 1, only sensors in sf_abspos_source_arr will be used for localization.</td></tr>
<tr><td>sf_abspos_source_arr</td><td>int[]</td><td>-1</td><td>Type of external localization source: 0 = none, 1 = GPS, 2 = DMC, 3 = ROS based localization</td></tr>
<tr><td>sf_abspos_x_std_arr</td><td>float[]</td><td>0.0001</td><td>Standard deviation of x of external loc R matrix [m].</td></tr>
<tr><td>sf_abspos_y_std_arr</td><td>float[]</td><td>0.0001</td><td>Standard deviation of y of external loc R matrix [m].</td></tr>
<tr><td>sf_abspos_h_std_deg_arr</td><td>float[]</td><td>0.0010</td><td>Standard deviation of h of external loc R matrix [deg].</td></tr>
<tr><td>sf_abspos_limit_corr_arr</td><td>int[]</td><td>0</td><td>Limits the filter of the maximum correction in each cycle for selected sensor.</td></tr>
<tr><td>sf_abspos_h_max_corr_deg_arr</td><td>float[]</td><td>0.3</td><td>Maximum heading correction per cycle for selected sensor [deg]. Only used if sf_abspos_limit_corr for corresponding index is 1.</td></tr>
<tr><td>sf_abspos_xy_max_corr_arr</td><td>float[]</td><td>0.01</td><td>Maximum xy correction per cycle by selected sensor [m]. Only used if corresponding sf_extloc_limit_corr_arr is 1.</td></tr>
<tr><td>sf_abspos_max_time_since_valid_meas_ms_arr</td><td>int[]</td><td>100</td><td>The maximum time [ms] since last valid absolute positioning measurement.</td></tr>
<tr><td>sf_abspos_max_time_since_valid_conf_ms_arr</td><td>int[]</td><td>1500</td><td>The maximum time [ms] since last valid absolute positioning measurement confidence.</td></tr>
<tr><td>sf_abspos_max_position_deviation</td><td>float</td><td>0.15</td><td>The maximum position deviation (x,y) between current and new absolute positioning pose.</td></tr>
<tr><td>sf_abspos_max_angle_deviation_deg</td><td>float</td><td>5.0</td><td>The maximum angular deviation [deg] between current and new absolute positioning pose.</td></tr>
<tr><td>sf_gps_x_std</td><td>float</td><td>0.0010</td><td>Standard deviation of x of gps loc R matrix [m].</td></tr>
<tr><td>sf_gps_y_std</td><td>float</td><td>0.0010</td><td>Standard deviation of y of gps loc R matrix [m].</td></tr>
<tr><td>sf_gps_h_std_deg</td><td>float</td><td>0.1000</td><td>Standard deviation of h of gps loc R matrix [m].</td></tr>
<tr><td>sf_gps_limit_corr</td><td>int</td><td>0</td><td>Limits the filter of the maximum gps correction in each cycle.</td></tr>
<tr><td>sf_gps_h_max_corr_deg</td><td>float</td><td>0.3</td><td>Maximum heading correction per cycle by gps [deg]. Recommended to have same value as loc_h_max_corr_deg. Only used if sf_gps_limit_corr is 1.</td></tr>
<tr><td>sf_gps_xy_max_corr</td><td>float</td><td>0.01</td><td>Maximum xy correction per cycle by gps [m]. Only used if sf_gps_limit_corr is 1.</td></tr>
<tr><td>sf_odom_vx_std</td><td>float</td><td>0.0050</td><td>Standard deviation of Vx of odom R matrix.</td></tr>
<tr><td>sf_odom_vy_std</td><td>float</td><td>0.0050</td><td>Standard deviation of Vy of odom R matrix.</td></tr>
<tr><td>sf_odom_wz_std_deg</td><td>float</td><td>0.5000</td><td>Standard deviation of Wz of odom R matrix.</td></tr>
<tr><td>sf_imu_ax_std</td><td>float</td><td>0.1000</td><td>Standard deviation of ax of imu R matrix.</td></tr>
<tr><td>sf_imu_ay_std</td><td>float</td><td>0.1000</td><td>Standard deviation of ay of imu R matrix.</td></tr>
<tr><td>sf_imu_az_std</td><td>float</td><td>0.1000</td><td>Standard deviation of az of imu R matrix.</td></tr>
<tr><td>sf_imu_wx_std_deg</td><td>float</td><td>0.3300</td><td>Standard deviation of wx of imu R matrix.</td></tr>
<tr><td>sf_imu_wy_std_deg</td><td>float</td><td>0.3300</td><td>Standard deviation of wy of imu R matrix.</td></tr>
<tr><td>sf_imu_wz_std_deg</td><td>float</td><td>0.3300</td><td>Standard deviation of wz of imu R matrix.</td></tr>
<tr><td>sf_imu_roll_deg</td><td>float</td><td>10.000</td><td>Standard deviation of roll measurement of imu R matrix. Very noisy, and only used in mode 3.</td></tr>
<tr><td>sf_imu_pitch_deg</td><td>float</td><td>10.000</td><td>Standard deviation of pitch measurement of imu R matrix. Very noisy, and only used in mode 3.</td></tr>
<tr><td>sf_imu_mode</td><td>int</td><td>0</td><td>IMU usage mode: 0 = Dont use, 1 = Only gyro, 2 = Gyro and acc without tilt estimation, 3 = 3D gyro and acc with instantenous tilt measurements, 4 = 3D gyro and acc</td></tr>
<tr><td>sf_full_ekf</td><td>int</td><td>1</td><td>Defines if derivatives are used with respect to angles.</td></tr>
<tr><td>sf_laser_quality_mode</td><td>int</td><td>1</td><td>Choose mode of laser quality: 0 = Disregard laser quality, 1 = Apply quality scale to x and y, 2 = Apply quality scale to x, y heading</td></tr>
<tr><td>sf_laser_quality_max</td><td>float</td><td>0.70</td><td>Laser quality above this will be treated as full quality. Between 0.01 and 1.</td></tr>
<tr><td>sf_laser_quality_scale</td><td>int</td><td>10</td><td>How much quality should affect the filtering. Between 10 and 100.</td></tr>
<tr><td>sf_imu_placement_comp</td><td>int</td><td>1</td><td>Defines, if centrifugal acceleration on IMU around navigation point should be compensated.</td></tr>
<tr><td>sf_imu_centri_full_ekf</td><td>int</td><td>1</td><td>Defines if derivatives are used with wrt angles for centrifugal compensation.</td></tr>
<tr><td>sf_conf_max_dist</td><td>float</td><td>50.0</td><td>The maximum traveled distance where xy pos conf drop will be fully reported.</td></tr>
<tr><td>sf_linear_acc_comp_for_tilt</td><td>int</td><td>0</td><td>Defines if IMU mode 3 should compensate for linear accelerations when calculating tilt. Not recommend to use for inclined environments.</td></tr>
<tr><td>sf_stop_stationary_imu</td><td>int</td><td>0</td><td>Defines if IMU updates stop when on standby outside of environment.</td></tr>
<tr><td>sf_gyro_bias_mode</td><td>int</td><td>0</td><td>Mode of estimating gyroscope bias: 0 = With filter, 1 = With filter and recalibrate when stationary, 2 = Only recalibration when stationary</td></tr>
<tr><td>sf_loc_at_standstill_enabled</td><td>int</td><td>1</td><td>The sensor fusion localization is active at standstill.</td></tr>
<tr><td>sf_gyro_max_turnrate_recalib_deg_per_s</td><td>float</td><td>0.5</td><td>The maximum gyroscope turnrate degrees per second to recalibrate bias.</td></tr>
<tr><td>sf_stationary_max_speed_m_per_s</td><td>float</td><td>0.01</td><td>The maximum odometry speed m/s to define AGV being stationary.</td></tr>
<tr><td>sf_stationary_max_turnrate_deg_per_s</td><td>float</td><td>0.5</td><td>The maximum odometry turnrate degrees/s to define AGV being stationary.</td></tr>
<tr><td>sf_imu_mounting_x_angle_deg</td><td>float</td><td>0.000</td><td>IMU installation angle around vehicle x axis [deg].</td></tr>
<tr><td>sf_imu_mounting_y_angle_deg</td><td>float</td><td>0.000</td><td>IMU installation angle around vehicle y axis [deg].</td></tr>
<tr><td>sf_imu_mounting_z_angle_deg</td><td>float</td><td>0.000</td><td>IMU installation angle around vehicle z axis [deg].</td></tr>
<tr><td>sf_imu_mounting_x_pos</td><td>float</td><td>0.000</td><td>IMU installation position in x axis.</td></tr>
<tr><td>sf_imu_mounting_y_pos</td><td>float</td><td>0.000</td><td>IMU installation position in y axis.</td></tr>
<tr><td>sf_imu_mounting_z_pos</td><td>float</td><td>0.000</td><td>IMU installation position in z axis.</td></tr>
<tr><td>imu_type</td><td>int</td><td>0</td><td>0 = no IMU, 1 = LPMS-CU2/URS2 USB, 2 = LPMS-URS2 serial, 3 = LPMS-CU2 CANOpen, 4 = LPMS IG1 USB, 5 = LPMS IG1 CANOpen, 6 = LPMS-CU3/URS3 USB, 7 = LPMS-CU3 CANOpen, 8 = LPMS-URS3 serial</td></tr>
<tr><td>imu_lpms_data_size</td><td>int</td><td>0</td><td>LPMS USB/serial data element size: 0 = 16 bit data, 1 = 32 bit data. This parameter is only valid for CU2 and URS2.</td></tr>
<tr><td>imu_serial_port</td><td>string</td><td>/dev/ttyS0</td><td>Serial port to be used for IMU communication</td></tr>
<tr><td>imu_id</td><td>int</td><td>1</td><td>ID number of the IMU. If it is a CAN type IMU, then this is the node I. Valid range is from 1 to 127.</td></tr>
<tr><td>imu_dh_use</td><td>int</td><td>0</td><td>Use IMU for dead reckoning:  0 = never use imu, 1 = use imu dh as is, 2 = use combination</td></tr>
<tr><td>imu_deg_p_sec_diff_max</td><td>float</td><td>1000.0</td><td>IMU angular speed max diff when compared to Deadreck dh, if greater use IMU only. Only relevant if imu_dh_use is 2.</td></tr>
<tr><td>imu_deg_p_sec_lo</td><td>float</td><td>1000.0</td><td>IMU angular speed low limit. Only relevant if imu_dh_use is 2.</td></tr>
<tr><td>imu_deg_p_sec_hi</td><td>float</td><td>1000.0</td><td>IMU angular speed hihg limit. Only relevant if imu_dh_use is 2.</td></tr>
<tr><td>imu_gain_lo</td><td>float</td><td>0.0</td><td>IMU gain at low limit.</td></tr>
<tr><td>imu_gain_hi</td><td>float</td><td>0.0</td><td>IMU gain at high limit.</td></tr>
<tr><td>imu_disable_after_in_standstill_ms</td><td>int</td><td>0</td><td>Disable IMU usage after given time [ms] standing still. 0 = never disable based on movement.</td></tr>
<tr><td>imu_max_timeout_ms</td><td>int</td><td>100</td><td>Maximum time [ms] without IMU data for error to be raised.</td></tr>
<tr><td>gps_receiver_type</td><td>int</td><td>0</td><td>GPS receiver to be used in localization: 0 = Disable GPS based localization, 1 = Septentrio AsterXProDirect</td></tr>
<tr><td>gps_teach_enabled</td><td>int</td><td>0</td><td>Enables the GPS data for teach files.</td></tr>
<tr><td>gps_teach_interval_ms</td><td>int</td><td>5000</td><td>Save GPS poses with this interval when teaching.</td></tr>
<tr><td>gps_data_type</td><td>int</td><td>1</td><td>Type of GPS data to use in localization: 0 = Common GGA and HDT, 1 = Septentrio RBP and HRP</td></tr>
<tr><td>gps_receiver_ip</td><td>string</td><td>192.168.10.223</td><td>IP address of the GPS receiver.</td></tr>
<tr><td>gps_receiver_port</td><td>int</td><td>600</td><td>Ethernet port number of GPS receiver.</td></tr>
<tr><td>gps_simulate</td><td>int</td><td>0</td><td>Simulate the GPS data for testing.</td></tr>
<tr><td>gps_initialize_posion</td><td>int</td><td>0</td><td>Enables automatic position initialization from GPS.</td></tr>
<tr><td>gps_init_pos_cont_percentage</td><td>float</td><td>90.0</td><td>The position confidence assigned when position is initialized with gps measurement.</td></tr>
<tr><td>gps_base_station_pos_x</td><td>float</td><td>0.000</td><td>X position of the base station in the map.</td></tr>
<tr><td>gps_base_station_pos_y</td><td>float</td><td>0.000</td><td>Y position of the base station in the map.</td></tr>
<tr><td>gps_main_antenna_offset_x</td><td>float</td><td>0.000</td><td>X position of antenna in the vehicle frame.</td></tr>
<tr><td>gps_main_antenna_offset_y</td><td>float</td><td>0.000</td><td>Y position of antenna in the vehicle frame.</td></tr>
<tr><td>gps_main_antenna_offset_z</td><td>float</td><td>0.000</td><td>Z position of antenna in the vehicle frame.</td></tr>
<tr><td>gps_disable_laser_corr</td><td>int</td><td>0</td><td>Disable laser updates in sensor fusion when gps fix is available: 0 = Apply laser corrections, 1 = Prevent laser corrections</td></tr>
<tr><td>gps_disabled_area_mode</td><td>int</td><td>0</td><td>How GPS behaves in the GPS disabled areas: 0 = Completely disable GPS, 1 = Use GPS position but not heading</td></tr>
</tbody></table>
<h3 id="precision-positioning"><a class="header" href="#precision-positioning">Precision positioning</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>precision_positioning_enable</td><td>int</td><td>0</td><td>Enables precision positioning feature.</td></tr>
<tr><td>precision_positioning_in_pos_init_enabled</td><td>int</td><td>0</td><td>Enables precision positioning areas when initializing position.</td></tr>
<tr><td>precision_pos_corr_blur_radius</td><td>float</td><td>2.5</td><td>Correlation blur radius for precision positioning: 0.0f to disable, recommended value 2.5.</td></tr>
<tr><td>precision_map_max_dist_m</td><td>float</td><td>0.2</td><td>Maximum distance offset of the vehicle navigation point in meters when driving into or out of a precision positioning area and switching from positioning between only the environment within the area and the environment outside of it. Recommended start value 0.2.</td></tr>
<tr><td>precision_map_max_hdiff_deg</td><td>float</td><td>30.0</td><td>Maximum heading offset of the vehicle in degrees when driving into or out of a precision positioning area and switching from positioning between only the environment within the area and the environment outside of it. Recommended start value 30.</td></tr>
<tr><td>precision_min_point_dist</td><td>float</td><td>0.02</td><td>Minimum distance in meters between precision positioning points generated from the environment within the precision positioning area. Recommended start value 0.02.</td></tr>
<tr><td>precision_reflectors_only</td><td>int</td><td>0</td><td>Defines to use only reflectors within precision positioning areas.</td></tr>
<tr><td>precision_refl_conf_multiplier</td><td>float</td><td>2.0</td><td>Multiplier for position confidence gained by detected reflectors. Recommended start value 2.</td></tr>
<tr><td>precision_refl_max_dist_err</td><td>float</td><td>0.2</td><td>Maximum position error [m] for the reflector to be considered.</td></tr>
<tr><td>precision_refl_max_ang_err_deg</td><td>float</td><td>2.0</td><td>Maximum angular error [deg] for the reflector to be considered.</td></tr>
<tr><td>precision_large_xy</td><td>float</td><td>0.01</td><td>If the xy-correction residual is larger than the parameter value, the maximum xy-correction is limited to precision_xy_corr_large, otherwise precision_xy_corr_small. Valid inside the precision positioning zones.</td></tr>
<tr><td>precision_large_h</td><td>float</td><td>0.1</td><td>If the h-correction residual is larger than the parameter value, the maximum h-correction is limited to precision_h_corr_large, otherwise precision_h_corr_small. Valid inside the precision positioning zones.</td></tr>
<tr><td>precision_xy_corr_large</td><td>float</td><td>0.001</td><td>Maximum larger distance (XY) precision correction limit.</td></tr>
<tr><td>precision_xy_corr_small</td><td>float</td><td>0.0003</td><td>Maximum smaller distance (XY) precision correction limit.</td></tr>
<tr><td>precision_h_corr_large</td><td>float</td><td>0.05</td><td>Maximum larger heading correction limit.</td></tr>
<tr><td>precision_h_corr_small</td><td>float</td><td>0.01</td><td>Maximum smaller heading correction limit.</td></tr>
<tr><td>precision_positioning_enable_optional_parameters</td><td>int</td><td>0</td><td>If set to 1, enables optional parameter file, when driving inside a precision positioning area.</td></tr>
</tbody></table>
<h3 id="dynamic-mapping"><a class="header" href="#dynamic-mapping">Dynamic mapping</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>dyn_map_lite_pos_corr</td><td>int</td><td>1</td><td>Enables position correction based on dynamic mapping lite.</td></tr>
<tr><td>dyn_map_lite_n_meas</td><td>int</td><td>0</td><td>Determines how many measurements to keep in dynamic map lite. Has to be &gt;0 for dynamic mapping to be enabled. Recommended value 50.</td></tr>
<tr><td>dyn_map_lite_only_on_auto</td><td>int</td><td>0</td><td>1 to only update dynamic map when auto driving, 0 for all driving.</td></tr>
<tr><td>dyn_map_lite_resolution</td><td>float</td><td>0.02</td><td>Resolution of dynamic mapping points. Points closer than this distance [m] are merged together. Recommended value 0.02.</td></tr>
<tr><td>dyn_map_lite_meas_interval_m</td><td>float</td><td>0.05</td><td>Minimum distance between measurements added to map.</td></tr>
<tr><td>dyn_map_lite_meas_interval_deg</td><td>float</td><td>10.0</td><td>Minimum heading difference between measurements added to map.</td></tr>
<tr><td>dyn_map_lite_update_max_hcorr_deg</td><td>float</td><td>0.5</td><td>Dynamic map is not updated if the heading was corrected more than this limit.</td></tr>
<tr><td>dyn_map_lite_update_max_xycorr</td><td>float</td><td>0.04</td><td>Dynamic map is not updated if position was corrected more than this limit.</td></tr>
<tr><td>dyn_map_lite_remove_cum_hcorr_deg</td><td>float</td><td>0.0</td><td>Dynamic map measurements are removed if the cumulative heading correction exceeds this limit. 0 to disable, 5.0 recommended.</td></tr>
<tr><td>dyn_map_lite_remove_cum_xycorr</td><td>float</td><td>0.0</td><td>Dynamic map measurements are removed if the cumulative heading correction exceeds this limit. 0 to disable, 0.1 recommended.</td></tr>
<tr><td>dyn_map_lite_update_min_env_conf</td><td>float</td><td>0.0</td><td>Minimum position confidence [%] to update dynamic map. 0-100 %</td></tr>
<tr><td>dyn_map_lite_pt_weight</td><td>float</td><td>0.002</td><td>Multiplier for the weights of points added by dynamic mapping lite.</td></tr>
<tr><td>dyn_map_lite_wait_dist_after_pos_lost</td><td>float</td><td>0.2</td><td>Distance required to travel after position had been lost before starting to update dynamic map.</td></tr>
<tr><td>dyn_map_lite_conf_pt_dist</td><td>float</td><td>0.05</td><td>The distance at which dynamic mapping points are included for position confidence calculation.</td></tr>
<tr><td>dyn_map_lite_conf_min_base_conf</td><td>float</td><td>75.0</td><td>Minimum limit for base confidence calculated from laser measurement distance to known environment. When dynamic mapping is in use the base confidence doesn't go below this for the purposes of correction gain calculation. 0-100 %</td></tr>
<tr><td>dyn_map_lite_conf_gain</td><td>float</td><td>0.05</td><td>Lowpass filter gain for dynamic mapping lite based position confidence.</td></tr>
<tr><td>dyn_map_lite_conf_max_drop_rate</td><td>float</td><td>0.7</td><td>The detection limit for dynamic map position confidence drop that would trigger Navitrol to stop trusting the dynamic map. Relative to the current confidence level.</td></tr>
<tr><td>dyn_map_lite_excluded_areas</td><td>int</td><td>0</td><td>1 to use dynamic mapping excluded areas and not add points within them, 0 to disable.</td></tr>
<tr><td>dyn_map_pt_min_weight_logged</td><td>float</td><td>0.05</td><td>Minimum weight for dynamic mapping points to be written to log or sent to Monitor. Recommended 0.0 - 0.2</td></tr>
<tr><td>dyn_map_lite_make_xy_corrs</td><td>int</td><td>0</td><td>Enables daynamic mapping to do xy corrections outside of static environment.</td></tr>
<tr><td>dyn_map_lite_pos_init_mode</td><td>int</td><td>0</td><td>0 disable position initializing from dynamic mapping, 1 initialize position and restore confidence if AGV's surrounding has not been changed significantly.</td></tr>
<tr><td>dyn_map_lite_pos_init_weight</td><td>float</td><td>0.03</td><td>Weight of dynamic mapping points added during position initialization.</td></tr>
<tr><td>dyn_map_server_enable</td><td>int</td><td>0</td><td>Enables dynamic mapping server.</td></tr>
<tr><td>dyn_map_server_ip</td><td>string</td><td></td><td>The IP address that the dynamic mapping server is listening on.</td></tr>
<tr><td>dyn_map_server_port</td><td>int</td><td>6089</td><td>The TCP port that the dynamic mapping server is listening on.</td></tr>
<tr><td>dyn_map_server_update_interval_ms</td><td>int</td><td>500</td><td>How often to send an update to the dynamic mapping server.</td></tr>
<tr><td>dyn_map_server_update_min_n_new_meas</td><td>int</td><td>20</td><td>Only send measurment data when there are at least this many new measurements.</td></tr>
<tr><td>dyn_map_update_process_time_margin_ms</td><td>int</td><td>5</td><td>Dynamic map updates are processed per localize cycle until time until next scanner update is less than this.</td></tr>
<tr><td>dyn_map_update_process_min_time_ms</td><td>int</td><td>2</td><td>Dynamic map updates are processed at least until this time has passed.</td></tr>
<tr><td>dyn_map_pt_weight_resolution</td><td>float</td><td>0.00001</td><td>Points are removed from the map when their weight is less than this limit.</td></tr>
<tr><td>dyn_map_server_max_disappeared_point_dist</td><td>float</td><td>0.0</td><td>Maximum distance for detecting disappeared server points, 0 to disable.</td></tr>
<tr><td>dyn_map_server_disappeared_point_ang_margin_deg</td><td>float</td><td>2.0</td><td>For a point to be detected as disappeared, all scanner beams within +- this value need to pass through the point.</td></tr>
<tr><td>dyn_map_server_disappeared_point_dist_margin</td><td>float</td><td>0.1</td><td>For a scanner beam to be defined as having passed through a point, the beam has to travel further than this distance away from the point.</td></tr>
<tr><td>dyn_map_server_disappeared_point_min_n_seen_through</td><td>int</td><td>20</td><td>Number of laser scans required to have seen through a point for the point to be marked as disappeared.</td></tr>
<tr><td>dyn_map_server_recv_timeout_ms</td><td>int</td><td>5000</td><td>Connection is detected as broken if no data is received within this time.</td></tr>
<tr><td>dyn_map_update_enable</td><td>int</td><td>0</td><td></td></tr>
<tr><td>dyn_map_min_point_dist</td><td>float</td><td>0.005</td><td>Only add the points to table map if they are further than this from an existing point.</td></tr>
<tr><td>dyn_map_same_point_d</td><td>float</td><td>0.03</td><td></td></tr>
<tr><td>dyn_map_update_min_conf_ini</td><td>float</td><td>80.0</td><td>Position confidence must be above this limit to start updating the map.</td></tr>
<tr><td>dyn_map_update_min_conf</td><td>float</td><td>60.0</td><td>Position confidence must be above this limit to update the map if the map has been updated before.</td></tr>
<tr><td>dyn_map_update_base_weight_up</td><td>float</td><td>0.03</td><td></td></tr>
<tr><td>dyn_map_update_ini_weight_up</td><td>float</td><td>0.90</td><td></td></tr>
<tr><td>dyn_map_update_base_weight_down</td><td>float</td><td>0.03</td><td></td></tr>
<tr><td>dyn_map_point_del_weight</td><td>float</td><td>0.10</td><td></td></tr>
<tr><td>dyn_map_dist_front_object</td><td>float</td><td>0.03</td><td></td></tr>
<tr><td>dyn_map_min_dist_to_point</td><td>float</td><td>0.05</td><td></td></tr>
<tr><td>dyn_map_min_scan_dist</td><td>float</td><td>0.50</td><td></td></tr>
<tr><td>dyn_map_min_dist_to_static</td><td>float</td><td>0.30</td><td></td></tr>
<tr><td>dyn_map_close_to_static</td><td>float</td><td>0.10</td><td></td></tr>
<tr><td>dyn_map_ldist_to_update_dyn</td><td>float</td><td>0.03</td><td></td></tr>
<tr><td>dyn_map_dist_to_update_dyn</td><td>float</td><td>0.10</td><td></td></tr>
<tr><td>dyn_map_x_margin</td><td>float</td><td>10.0</td><td>Margin to add to the map size for dynamic points.</td></tr>
<tr><td>dyn_map_y_margin</td><td>float</td><td>10.0</td><td>Margin to add to the map size for dynamic points.</td></tr>
</tbody></table>
<h2 id="drive-control"><a class="header" href="#drive-control">Drive control</a></h2>
<h3 id="drive-control-1"><a class="header" href="#drive-control-1">Drive control</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>creeping_speed_limit_for_zeroing</td><td>float</td><td>0.00005</td><td>Prevent position creeping by zeroing flickering odometer dS value below parameter (currently only omni), 0 = no action.</td></tr>
<tr><td>min_slow_down_speed</td><td>float</td><td>0.1</td><td>Speed [m/s] for slowdown when approaching the end of the trajectory.</td></tr>
<tr><td>slow_down_crawl_dist</td><td>float</td><td>0.1</td><td>Distance [m] from trajectory end to drive with a slower speed. See parameter min_slow_down_speed.</td></tr>
<tr><td>max_turn_rate_deg_p_s</td><td>float</td><td>30.0</td><td>Maximum turning rate of the vehicle. Limits AGV's speed on the trajectory.</td></tr>
<tr><td>allow_drive_max_wheel_ang_diff_deg</td><td>float</td><td>5.0</td><td>Maximum angle difference [deg] for wheels before AGV is allowed to start driving.</td></tr>
<tr><td>auto_moving_delay_msec</td><td>int</td><td>0</td><td>Delay the start of the drive by given time [ms]. 0 = disable</td></tr>
<tr><td>stop_and_hold_moving_delay_msec</td><td>int</td><td>2000</td><td>Delay time [ms] before AGV is released from StopAndHold symbolic point when timer-based release is used.</td></tr>
<tr><td>stop_and_hold_mode</td><td>int</td><td>0</td><td>Defines release behavior at StopAndHold point after stopping: -1 = ignore stopAndHold points, 0 = release with timer, 1 = release with supervisor actuator section signal, 2 = release with fleet control signal, 3 = release with supervisor message 3011</td></tr>
<tr><td>stop_and_hold_stop_distance_offset</td><td>float</td><td>0.0</td><td>Stopping distance offset from stop-and-hold point. Aooly negative offset if AGV stops too late.</td></tr>
<tr><td>start_offset_slowdown_enabled</td><td>int</td><td>0</td><td>Enables start offset slowdown feature that limits speed and acceleration if the error relative to the path is larger than start_offset_slowdown_heading_limit_deg or start_offset_slowdown_dist_limit when starting a drive.</td></tr>
<tr><td>start_offset_slowdown_heading_limit_deg</td><td>float</td><td>2.0</td><td>Start offset slowdown is activated if AGV's heading offset from the route is more than the given value [deg].</td></tr>
<tr><td>start_offset_slowdown_dist_limit</td><td>float</td><td>0.1</td><td>Start offset slowdown is activated if AGV's distance offset from the route is more than the given value [m].</td></tr>
<tr><td>start_offset_slowdown_release_delay_ms</td><td>int</td><td>500</td><td>If start offset slowdown has been activated, the offset values must be within the slowdown_heading_offset_limit and slowdown_dist_offset_limit for the given release delay before the slowdown is released.</td></tr>
<tr><td>start_offset_slowdown_mot_ctrl_max_wheel_v_fw</td><td>float</td><td>0.8</td><td>Maximum drive wheel forwards velocity when start offset slowdown is active [m/s]. Only used if smaller than the original limit.</td></tr>
<tr><td>start_offset_slowdown_mot_ctrl_max_wheel_v_bw</td><td>float</td><td>0.8</td><td>Maximum drive wheel backwards velocity when start offset slowdown is active [m/s]. Only used if smaller than the original limit.</td></tr>
<tr><td>start_offset_slowdown_mot_ctrl_max_wheel_acc</td><td>float</td><td>0.5</td><td>Maximum aceleration when start offset slowdown is active [m/s^2]. Only used if smaller than the original limit.</td></tr>
<tr><td>max_turn_rate_deg_p_s_arr</td><td>float[]</td><td>30.0</td><td>Maximum turning rate of the vehicle that can be selected to replace the default limit. Limits AGV's speed on the trajectory.</td></tr>
<tr><td>symbol_point_enter_dist</td><td>float</td><td>0.2</td><td>Determine entry distance from a symbolic point that AGV is occupying. Used to trigger virtual tags on symbolic points.</td></tr>
<tr><td>symbol_point_exit_dist</td><td>float</td><td>0.25</td><td>Determine exit distance from a symbolic point that AGV is occupying. Used to trigger virtual tags on symbolic points.</td></tr>
<tr><td>symbol_point_path_ready_machine_reported_inside_dist</td><td>float</td><td>1.0</td><td>If path is ready and AGV is closer than this distance to the drive order end symbolic point, the AGV is considered to be inside the symbolic point. Does not include buffer lanes.</td></tr>
<tr><td>max_c_change_limit</td><td>float</td><td>1.0</td><td></td></tr>
<tr><td>speed_timer_s</td><td>int</td><td>10</td><td>Set error on two conditions: 1) If measured speed differs for the given time from reference (by at least max_speed_diff). 2) If AGV is not starting to move within the given time from reference increase (for motor controllers without internal PID).</td></tr>
<tr><td>go_to_stby_delay_msec</td><td>int</td><td>4000</td><td>Delay when changing from manual state or estop to standby.</td></tr>
<tr><td>spd_ctrl_max_steer_ang_err_deg</td><td>float</td><td>5.0</td><td>Limits AGV's speed if steering angle differs more than the parameter value from the target value. Note: For omni AGV's this must be enabled by omni_steer_ang_err_speed_limit_enabled.</td></tr>
<tr><td>spd_ctrl_max_dist_err_per_s</td><td>float</td><td>0.1</td><td></td></tr>
<tr><td>veh_steer_angle_corr_coeff</td><td>float</td><td>1.0</td><td>The offset corrected steer angle measurement is multiplied with this coefficient to correct a ratio error between measurement angle and wheel angle.</td></tr>
<tr><td>veh_steer_control_rev_corr</td><td>float</td><td>1.0</td><td>Steer angle correction coefficient compensating for a steering to curvature error proportional to the steering angle when reversing.</td></tr>
<tr><td>veh_steer_control_fwd_corr</td><td>float</td><td>1.0</td><td>Steer angle correction coefficient compensating for a steering to curvature error proportional to the steering angle when driving forwards.</td></tr>
<tr><td>veh_steer_angle_corr_offset</td><td>float</td><td>0.0</td><td>Offset correctng the zero-angle error of the raw steer angle measurement.</td></tr>
<tr><td>park_brake_on_delay_ms</td><td>int</td><td>1000</td><td>Delay for setting the park brake after vehicle has been stopped.</td></tr>
<tr><td>speed_inversion_in_mode_change</td><td>int</td><td>0</td><td>Changes speed direction in mode change pivoting to make the mode change wheel positions result in the same pivoting direction as normal pivoting.</td></tr>
<tr><td>stop_on_specified_route_points</td><td>int</td><td>0</td><td>Enables stop enroute points feature. When enabled, AGV will StopAndHold at enroute STOP points specified in the drive order.</td></tr>
<tr><td>stop_enroute_max_curpos_diff_from_stop_pt_meters</td><td>float</td><td>0.01</td><td>Maximum straight-line distance [m] from enroute STOP point when StopAndHold can trigger.</td></tr>
<tr><td>stop_enroute_speed_mps</td><td>float</td><td>0.02</td><td>Driving reference speed [m/s] when approaching stop point.</td></tr>
<tr><td>stop_enroute_speed_activation_dist_m</td><td>float</td><td>0.1</td><td>Distance [m] from enroute stop point when slowdown speed should be used as a reference.</td></tr>
<tr><td>stop_enroute_minimum_point_to_point_pose_dist_to_stop_point</td><td>float</td><td>0.02</td><td>Maximum distance [m] along trajectory from enroute STOP point when StopAndHold can trigger.</td></tr>
<tr><td>drive_order_along_route_start_max_diff_heading_deg</td><td>float</td><td>15.0</td><td>Maximum heading difference [deg] between the vehicle and a segment point for it to be considered a start candidate.</td></tr>
<tr><td>drive_order_along_route_start_max_diff_dist</td><td>float</td><td>0.2</td><td>Maximum distance [m] between the vehicle and a segment point for it to be considered a start candidate.</td></tr>
<tr><td>drive_order_along_route_start_max_diff_alt_dist</td><td>float</td><td>0.05</td><td>Close segment points are considered alternative start candidates if their distance from the vehicle is shorter than the distance to the closest accepted segment point + this parameter.</td></tr>
<tr><td>drive_order_along_route_direction</td><td>int</td><td>0</td><td>The drive direction of binary drive order: 0 = reverse, 1 = forward.</td></tr>
<tr><td>drive_order_along_route_max_v</td><td>float</td><td>0.5</td><td>The maximum velocity [m/s] during binary drive order</td></tr>
<tr><td>drive_order_along_route_max_dist</td><td>float</td><td>0.5</td><td>The maximum distance [m] of binary drive order along the closest route</td></tr>
<tr><td>drive_offset_max_lon</td><td>float</td><td>0.05</td><td>Maximum requested longitudinal offset [m] from route when driving to a symbolic point.</td></tr>
<tr><td>drive_offset_max_trans</td><td>float</td><td>0.05</td><td>Maximum requested transversal offset [m] from route when driving to a symbolic point.</td></tr>
<tr><td>drive_offset_max_heading</td><td>float</td><td>4.0</td><td>Maximum requested heading offset [deg] from route when driving to a symbolic point.</td></tr>
<tr><td>drive_offset_enable_speed_ramp</td><td>int</td><td>0</td><td>Enables speed ramp when arriving to the symbolic point with offset.</td></tr>
<tr><td>drive_offset_apply_dist</td><td>float</td><td>-1.0</td><td>Distance [m] from drive order end point before drive offsets will start to apply. Negative value enables offsets always.</td></tr>
<tr><td>drive_offset_apply_mode</td><td>int</td><td>0</td><td>0 = Negative speed flips transversal offset. 1 = Apply offsets as is given. Speed direction does not affect offsets.</td></tr>
</tbody></table>
<h3 id="standalone-route-driver"><a class="header" href="#standalone-route-driver">Standalone route driver</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>route_driver_enabled</td><td>int</td><td>0</td><td>Enables standalone/route drive feature.</td></tr>
<tr><td>route_driver_max_diff_h_deg</td><td>float</td><td>15.0</td><td>Maximum heading difference [deg] between the vehicle and a segment point for it to be considered a start candidate.</td></tr>
<tr><td>route_driver_max_diff_dist_m</td><td>float</td><td>0.2</td><td>Maximum distance [m] between the vehicle and a segment point for it to be considered a start candidate.</td></tr>
<tr><td>route_driver_max_diff_alt_dist_m</td><td>float</td><td>0.05</td><td>Close segment points are considered alternative start candidates if their distance from the vehicle is shorter than the distance to the closest accepted segment point + this parameter.</td></tr>
<tr><td>route_driver_max_seg_cnt_in_drive_order</td><td>int</td><td>30</td><td>Maximum number of segments in one drive order.</td></tr>
<tr><td>route_driver_dest_update_enabled</td><td>int</td><td>0</td><td>Enables option of updating destination during drive.</td></tr>
<tr><td>route_driver_dest_update_stop_dist</td><td>float</td><td>0.0</td><td>Maximum distance [m] to drive when planning route for destination update during drive. No stopping if zero.</td></tr>
<tr><td>route_driver_start_drive_angle_cost_per_deg</td><td>float</td><td>0.08</td><td>Start angle cost (angle between AGV frame and start-segment heading) that is added to the route length when calculating shortest to drive. No angle cost if zero.</td></tr>
<tr><td>route_driver_end_segment_angle_cost_per_deg</td><td>float</td><td>0.00</td><td>End angle cost (angle between AGV frame and end-segment heading) that is added to the route length when calculating shortest route to drive. No angle cost if zero.</td></tr>
<tr><td>route_driver_pivot_point_turning_cost_per_deg</td><td>float</td><td>0.08</td><td>Pivot point cost (if needed to pivot) that is added to the route length when calculating shortest route to drive. No angle cost if zero.</td></tr>
</tbody></table>
<h3 id="return-to-route"><a class="header" href="#return-to-route">Return to route</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>rtr_use_custom_route</td><td>int</td><td>1</td><td>Sets the return to route mode: 0 = Shortest possible straight route, 1 = Custom route, 2 = Strictly curvature limited custom route.</td></tr>
<tr><td>rtr_max_dist</td><td>float</td><td>2.0</td><td>Defines the maximum search distance [m] for the first target point on the route.</td></tr>
<tr><td>rtr_speed</td><td>float</td><td>0.3</td><td>Upper threshold [m/s] for the rtr trajectory speed.</td></tr>
<tr><td>rtr_max_head_err_deg</td><td>float</td><td>5.0</td><td>Lower threshold for the angle [deg] between the vehicle and the route for return to route to be possible.</td></tr>
<tr><td>rtr_already_on_route_dist</td><td>float</td><td>0.1</td><td>If the distance to nearest route segment point is smaller than this value AGV is considered to be on route. The return route is calculated but not driven.</td></tr>
<tr><td>rtr_max_head_diff</td><td>float</td><td>90.0</td><td>Maximum heading difference between the vehicle and the target point on the route.</td></tr>
<tr><td>rtr_control_point_dist</td><td>float</td><td>2.5</td><td>Defines the maximum distance from close point (see rtr_max_dist) to a custom return to route target point.</td></tr>
<tr><td>rtr_control_point_start_smooth_dist</td><td>float</td><td>0.8</td><td>Defines the distance to the first control point in the custom route creation.</td></tr>
<tr><td>rtr_control_point_end_smooth_dist</td><td>float</td><td>0.8</td><td>Defines the minimum distance between the last two control points in the custom route creation.</td></tr>
<tr><td>rtr_safe_steer_angle_margin_deg</td><td>float</td><td>4.0</td><td>For very limited steering cases the margin to the steering angle limits determines route acceptance, if the margin exceeds this limit the shortest route is selected.</td></tr>
<tr><td>rtr_omni_steer_limit_recovery_time_ms</td><td>int</td><td>20000</td><td>Heavily limited omni stuck in warning_limited_steering_active too long time trigger limited steering recovery. Active only when rtr_use_custom_route is set to value 2.</td></tr>
</tbody></table>
<h3 id="vda5050"><a class="header" href="#vda5050">VDA5050</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>vdma_host</td><td>string</td><td>127.0.0.1</td><td>Hostname or IP of the MQTT broker the VDMA interface should connect to.</td></tr>
<tr><td>vdma_port</td><td>int</td><td>1883</td><td>The port the MQTT broker for VDMA interface is on.</td></tr>
<tr><td>vdma_manufacturer</td><td>string</td><td>Navitec</td><td>The name of the AGV manufacturer for the VDMA interface.</td></tr>
<tr><td>vdma_serial_number</td><td>string</td><td>0001</td><td>The serial number of the AGV for the VDMA interface.</td></tr>
<tr><td>vdma_interface_name</td><td>string</td><td>uagv</td><td>The interface name part of the MQTT topics</td></tr>
<tr><td>vdma_visualization_interval_ms</td><td>int</td><td>1000</td><td>The update interval [ms] for the visualization topic. 0 = disable.</td></tr>
<tr><td>vdma_topic_override_version</td><td>int</td><td>0</td><td>Override the version number part of the MQTT topic name. 0 = use default (no override).</td></tr>
<tr><td>vdma_mqtt_user</td><td>string</td><td></td><td>Username for connecting to the MQTT broker.</td></tr>
<tr><td>vdma_mqtt_password</td><td>string</td><td></td><td>Password for connecting to the MQTT broker.</td></tr>
<tr><td>vdma_ssl_mode</td><td>int</td><td>1</td><td>0 = disabled, 1 = follow the general Navitrol settings (default), 2 = enable with separate settings (even if SSL is otherwise disabled).</td></tr>
<tr><td>vdma_ssl_agv_certificate_file</td><td>string</td><td></td><td>The name of the certificate file to be used by the AGV. Used only when vdma_ssl_mode set to 2.</td></tr>
<tr><td>vdma_ssl_agv_key_file</td><td>string</td><td></td><td>The name of the key file to be used by the AGV. Used only when vdma_ssl_mode set to 2.</td></tr>
<tr><td>vdma_ssl_pem_password</td><td>string</td><td></td><td>The password that is used to unlock key file. Used only when vdma_ssl_mode set to 2.</td></tr>
<tr><td>vdma_ssl_ca_file</td><td>string</td><td></td><td>The PEM file containing the trusted CA certificates for verification. Used only when vdma_ssl_mode set to 2.</td></tr>
<tr><td>vdma_ssl_cipher_list</td><td>string</td><td></td><td>The cipher list for SSL. Used only when vdma_ssl_mode set to 2.</td></tr>
<tr><td>vdma_ssl_version</td><td>int</td><td>2</td><td>The TLS/SSL version to use. 0 = TLS v1, 1 = TLS v1.1, 2 = TLS v1.2</td></tr>
<tr><td>vdma_ssl_verify_hostname</td><td>int</td><td>1</td><td>Enables verification of the server hostname. 0 = Do not verify, 1 = Verify</td></tr>
<tr><td>vdma_area_name_override</td><td>string</td><td></td><td>Override the area name from map</td></tr>
<tr><td>vdma_version</td><td>int</td><td>2</td><td>VDMA version - 0 = v1.01.2, 1 = v1.1, 2 = v.2.0.</td></tr>
<tr><td>vdma_drive_order_type</td><td>int</td><td>2</td><td>VDMA drive order type - 0 = JSON mapped segment (v.1.01.2), 1 = Segment based driveOrder (v1.1 and v2.0), 2 = Trajectory based (v1.1 and v2.0).</td></tr>
<tr><td>vdma_actions_check_sp</td><td>int</td><td>1</td><td>Should vdma actions require compatible symbolic point.</td></tr>
<tr><td>vdma_actions_sp_close_dist</td><td>float</td><td>0.3</td><td>How close [m] a symbolic point needs to be to be accepted.</td></tr>
<tr><td>vdma_loadunload_check_load_state</td><td>int</td><td>1</td><td>Should vdma load&amp;unload actions check the AGV load state.</td></tr>
<tr><td>vdma_default_drive_speed_m_p_s</td><td>float</td><td>2.0</td><td>Default speed for VDMA trajectories when speed is not limited.</td></tr>
<tr><td>vdma_traj_pt_dist_m</td><td>float</td><td>0.1</td><td>Desired distance between trajectory points when interpolating VDA trajectories.</td></tr>
<tr><td>vdma_traj_min_radius_m</td><td>float</td><td>0.5</td><td>Turning radius for the VDA trajectory interpolation.</td></tr>
<tr><td>vdma_debug_topic_enabled</td><td>int</td><td>0</td><td>Enable sending of extra debug info to MQTT broker.</td></tr>
<tr><td>vdma_traj_interpolation_type</td><td>int</td><td>2</td><td>0 = Trajectory interpolation disabled, 1 = Dubins curve interpolation, 2 - Linear interpolation (default)</td></tr>
<tr><td>vdma_treat_all_loads_as_racks</td><td>int</td><td>0</td><td>Make the VDA5050 interface treat all loads &amp; unloads as if they were racks.</td></tr>
<tr><td>vdma_trivially_reach_multiple_nodes</td><td>int</td><td>1</td><td>Make the VDA5050 interface treat multiple nodes in the beginning of the order as trivially reachable.</td></tr>
<tr><td>vdma_use_symbolic_points_for_actions</td><td>int</td><td>0</td><td>Use virtual symbolic points to implement actions. Currently only used for racking</td></tr>
<tr><td>vdma_pivot_generation_angle_deg</td><td>float</td><td>30.0</td><td>Automatically generate pivots if there are sharper corners in the route than this</td></tr>
<tr><td>vdma_rotation_on_edge_margin_points</td><td>int</td><td>2</td><td>When rotating on an edge, reach the target orientation this many (linear interpolation) points before the end of the edge. Increase if the AGV doesn't reach the target orientation in time.</td></tr>
<tr><td>vdma_reverse_tolerance_deg</td><td>float</td><td>90.0</td><td>Tolerance for reversing on an edge, in degrees. AGV will reverse when edge has tangential orientation that deviates from PI at most by this margin</td></tr>
<tr><td>vdma_clear_order_when_losing_position</td><td>int</td><td>1</td><td>Make the VDA5050 interface clear the order if position is not initialized.</td></tr>
<tr><td>vdma_escalate_errors_to_fatal_timeout_s</td><td>float</td><td>0.0</td><td>Timeout for escalating errors to fatal. Navitrol errors are initially reported as 'warnings' and changed to 'fatal' after this time. 0 = disabled (immediately fatal).</td></tr>
<tr><td>vdma_error_reporting_policy</td><td>int</td><td>0</td><td>Error reporting policy for VDMA interface. 0 = report only active navitrol errors and drive rejections, 1 = keep errors that happen during drive order active</td></tr>
</tbody></table>
<h3 id="trajectory-and-curvature-related"><a class="header" href="#trajectory-and-curvature-related">Trajectory and curvature related</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>curvature_limits_angle_error_deg</td><td>float</td><td>0.0</td><td>Additional margin for error checking when checking steer limits.E.g. if steer limit is 50 degrees and error is 5 degrees, AGV can drive curvature that requires 55 degrees of steering.</td></tr>
<tr><td>traj_ref_dec_reduction</td><td>float</td><td>1.0</td><td>Deceleration reduction in route speed reference calculation to leave control margin during driving.</td></tr>
<tr><td>traj_tight_curve_turning_radius_limit</td><td>float</td><td>0.1</td><td>Defines maximum limit for trajectory's turning radius [m] for which the trajectory is considered to be a tight curve.</td></tr>
<tr><td>curv_pos_corr</td><td>float</td><td>1.0</td><td>Coeeficient for correcting positive curvature references.</td></tr>
<tr><td>curv_neg_corr</td><td>float</td><td>1.0</td><td>Coefficient for correcting negative curvature references.</td></tr>
<tr><td>custom_route_start_node_min_dist_m</td><td>float</td><td>0.3</td><td>Minimum distance for the second node from the start.</td></tr>
<tr><td>custom_route_start_node_max_dist_m</td><td>float</td><td>1.0</td><td>Maximum distance for the second node from the start.</td></tr>
<tr><td>custom_route_start_node_dist_ratio</td><td>float</td><td>0.25</td><td>Fraction value of percentage from the vector length that is used to calculate node location. For example, if vector length is 2.0m and the percentage is 25.0%, the second node is place 0.5m from the start. After this percentage the minimum and maximum limits are checked.</td></tr>
<tr><td>custom_route_end_node_min_dist_m</td><td>float</td><td>0.3</td><td>Minimum distance for the second last node before target.</td></tr>
<tr><td>custom_route_end_node_max_dist_m</td><td>float</td><td>1.0</td><td>Maximum distance for the second last node before target.</td></tr>
<tr><td>custom_route_end_node_dist_ratio</td><td>float</td><td>0.5</td><td>Fraction value of percentage from the vector length that is used to calculate node location. For example if vector length is 2.0m and the ratio is 50.0%, the secon dlast node is place 1.0m from the target. After this percentage, the minimum and maximum limits are checked.</td></tr>
<tr><td>custom_route_max_support_node_angle_deg</td><td>float</td><td>90.0</td><td>Maximum angle for support node on both start and end [deg].</td></tr>
<tr><td>custom_route_min_support_node_angle_deg</td><td>float</td><td>0.0</td><td>Minimum angle for support node on both start and end [deg].</td></tr>
</tbody></table>
<h3 id="barrier-stop"><a class="header" href="#barrier-stop">Barrier stop</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>barrier_stop_check_dist</td><td>float</td><td>0.0</td><td>Barrier stop signals are only checked withing this distance [m] of symbolic point that has Barrier stop tag. 0 = barrier stop disabled.</td></tr>
<tr><td>barrier_stop_signal_max_wait_time_ms</td><td>int</td><td>2000</td><td>Maximum wait time from first wheel stop signal to another before error is set and barrier stop aborted.</td></tr>
</tbody></table>
<h2 id="kinematics"><a class="header" href="#kinematics">Kinematics</a></h2>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>sub_diff_wheel_track</td><td>float</td><td>0.10</td><td>Distance between the centers of the wheels in differential steer-drive wheel unit.</td></tr>
<tr><td>coupled_axle_steer_coupling_ratio</td><td>float</td><td>2.0</td><td>Ratio between front steering wheel angle to rear axle steering e.g. value 2.0 indicates front steering wheel turns twice as much as rear axle.</td></tr>
<tr><td>coupled_axle_steer_nav_pt_dist</td><td>float</td><td>0.2</td><td>Distance of navigation point from rear axle towards front of coupled axle steer AGV.</td></tr>
<tr><td>sub_diff_max_turn_wheel_speed</td><td>float</td><td>0.5</td><td>Maximum diffunit turning speed [m/s] for each wheel.</td></tr>
<tr><td>omni_steer_nbr</td><td>int</td><td>0</td><td>Number of controlled steering wheels</td></tr>
<tr><td>omni_steer_ang_offset_deg</td><td>float[]</td><td>0.0</td><td>Offset added to sensor angle value to give zero angle when the wheel is straight forwards.</td></tr>
<tr><td>omni_can_enc_steer_node_id</td><td>int[]</td><td>0</td><td>CAN node ID of the angle encoder on each wheel: 0 = not defined, 1-127 = valid node ID.</td></tr>
<tr><td>omni_steer_enc_pulses_overflow_arr</td><td>uint[]</td><td>0xFFFFFFFU</td><td>Maximum pulse value of the steering encoder of each wheel.</td></tr>
<tr><td>omni_steer_enc_pulses_per_rev_arr</td><td>uint[]</td><td>1000</td><td>Pulse count corresponding to one revolution of the steering encoder on each wheel.</td></tr>
<tr><td>omni_steer_enc_zero_arr</td><td>uint[]</td><td>0</td><td>Pulse encoder value corresponding to zero angle of wheel.</td></tr>
<tr><td>omni_steer_limit_enable</td><td>int[]</td><td>0</td><td>Enables the steer limit for each omni wheel seperately.</td></tr>
<tr><td>omni_steer_limit_CCW_angle_deg</td><td>float[]</td><td>179.9</td><td>Steer angle limit measured from wheel's zero angle in CCW direction. Maximum value 179,9 deg. This parameter must be enabled by corresponding omni_steer_limit_enable.</td></tr>
<tr><td>omni_steer_limit_CW_angle_deg</td><td>float[]</td><td>179.9</td><td>Steer angle limit measured from wheel's zero angle in CW direction. Maximum value 179,9 deg. This parameter must be enabled by corresponding omni_steer_limit_enable.</td></tr>
<tr><td>omni_steer_limit_angle_tolerance_deg</td><td>float</td><td>20.0</td><td>Determines the tolerance from the minimum and maximum steer limits, where an automatic wheel swapping is initiated by changing the angle reference by 180 degrees.</td></tr>
<tr><td>omni_steer_limit_max_reference_diff_deg</td><td>float</td><td>1.0</td><td>Determines the difference to the minimum and maximum steer limits where the reference is limit. Range 0-90 degrees. Example: limit 180, value 1, maximum reference is 179.</td></tr>
<tr><td>omni_steer_limit_swap_turn_tolerance_deg</td><td>float</td><td>2.0</td><td>Determines how close to the target angle the wheel must be turned before swapping is considered done. Range 0.1-90 derees.</td></tr>
<tr><td>omni_steer_limit_hard_stop_buffer_deg</td><td>float</td><td>5.0</td><td>Determines the margin of the measured wheel angle to the minimum and maximum steer limits for activating a hard stop.</td></tr>
<tr><td>omni_steer_limit_active_control_before_stopping_buffer_deg</td><td>float</td><td>3.0</td><td>Margin of the measured wheel angle from the minimum and maximum steer limits for actively repelling te steer reference while vehicle is moving.</td></tr>
<tr><td>omni_steer_limit_adjust_additional_wheels_buffer_deg</td><td>float</td><td>20.0</td><td>When one wheel has reached the limit. This value will be added to 'angle_tolerance_deg' to check if multiple wheels should be adjusted simultaneously.</td></tr>
<tr><td>omni_steer_limit_soft_slow_buffer_deg</td><td>float</td><td>10.0</td><td>This value will be added to 'angle_tolerance_deg' to slow down when nearing the limit. Does not activate wheel adjusting.</td></tr>
<tr><td>omni_steer_limit_max_control_difference_deg</td><td>float</td><td>30.0</td><td>Determines the maximum difference between reference and measured angle during wheel swapping.</td></tr>
<tr><td>omni_deadrec_ref_axle</td><td>int[]</td><td>0</td><td>Only two wheels (preferably not collinear) should be selected for deadreckoning. Set 1 for selecting. Indexes according to customer wheel numbering.</td></tr>
<tr><td>maintain_omni_kinematics</td><td>int</td><td>0</td><td>Set to 1 if all wheel axes shall intersect in the turning point defined by the radius and steer vector references at all times (no divergence from kinematic solution, causes excessive wheel turning).</td></tr>
<tr><td>omni_parallel_wheels_check_enabled</td><td>int</td><td>0</td><td>0 = always use parameter defined wheels for dead reckoning, 1 to change dead reackoning wheels if defined wheels are parallel, 2 to use always the wheels with biggest angle difference.</td></tr>
<tr><td>omni_parallel_wheels_check_angle_diff_deg</td><td>float</td><td>1.0</td><td>Angle difference between wheels considering them parallel enough to temporarily select other wheels for dead reckoning if selection is activated.</td></tr>
<tr><td>omni_deadreck_calc_parallel_wheels_angle_deadband_deg</td><td>float</td><td>2.0</td><td>Angle difference between wheels for considering them parallel and calculating vehicle turning based on speed differential instead of turning point in the intersection of their axes.</td></tr>
<tr><td>omni_steer_ang_err_speed_limit_enabled</td><td>int</td><td>0</td><td>Functionality limits driving speed if steering angle error is too high.</td></tr>
<tr><td>omni_steer_ang_err_speed_limit_gain</td><td>float</td><td>0.001</td><td>How fast the speed is limited if steering cannot follow reference. Value 0.00001 limits the speed very slowly, value 1 limits instantly to lowest speed.</td></tr>
<tr><td>omni_steer_ang_err_speed_limit_timer_ms</td><td>int</td><td>1500</td><td>How long the speed limitation will be enabled after steering follows references again. Works also as a time hysteresis for the angle error monitoring.</td></tr>
<tr><td>kinematic_free_limited_driving</td><td>int</td><td>0</td><td>AGV with kinematic free interface has driving limitations: 0 = None, 1 = Speed vector restricted to longitudinal only (nonholonomic)</td></tr>
<tr><td>omni_joystick_sector_limit_1_deg</td><td>float</td><td>0.0</td><td>Lower limit on the possible web UI joystick directions in parallel drive. From 0 (up) counter clockwise to 360.</td></tr>
<tr><td>omni_joystick_sector_limit_2_deg</td><td>float</td><td>0.0</td><td>Upper limit on the possible web UI joystick directions in parallel drive. From 0 (up) counter clockwise to 360.</td></tr>
<tr><td>omni_joystick_deadband</td><td>float</td><td>0.0</td><td>Joystick deadband for parallel driving. Movements smaller than this are ignored. 0 is no deadband, 1 is the full movement range of the joystick.</td></tr>
</tbody></table>
<h2 id="load-handling"><a class="header" href="#load-handling">Load handling</a></h2>
<h3 id="actuator-and-load-handling"><a class="header" href="#actuator-and-load-handling">Actuator and load handling</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>speed_set_while_loaded</td><td>int</td><td>0</td><td>Used to select the speed set that is used when the AGV has a load aboard. For example, value 1 activates speed settings defined in array index 0.</td></tr>
<tr><td>actuator_type</td><td>int</td><td>0</td><td>Type of the actuator: 0 = disabled, 1 = no control commands (data visualized), 2 = reference value controlled actuator, 3 = IO-controlled actuator (low/high position only)</td></tr>
<tr><td>actuator_simulate</td><td>int</td><td>1</td><td>Simulate actuator in simulation mode.</td></tr>
<tr><td>actuator_inner_tolerance_mm</td><td>int</td><td>-1</td><td>Actuator is being controlled until measured value is inside tolerance. -1 = inner tolerance is disabled</td></tr>
<tr><td>actuator_inner_tolerance_timer_ms</td><td>int</td><td>0</td><td>Time [ms] that measured value has to be inside inner tolerance value until actuator control is stopped.</td></tr>
<tr><td>actuator_outer_tolerance_mm</td><td>int</td><td>0</td><td>Actuator control is started when measured value differs more than tolerance from target value.</td></tr>
<tr><td>actuator_tolerance_reach_mm</td><td>int</td><td>0</td><td>Tolerance for the reach. Reach of the fork is controlled until the measured value is inside the tolerance from the target value.</td></tr>
<tr><td>actuator_tolerance_tilt_deg</td><td>float</td><td>0.0</td><td>Tolerance for the tilt. Tilt of the fork is controlled until the measured value is inside the tolerance from the target value.</td></tr>
<tr><td>actuator_tolerance_side_mm</td><td>int</td><td>0</td><td>Tolerance for side shift. Side shift of the fork is controlled until the measured value is inside the tolerance from the target value.</td></tr>
<tr><td>actuator_tolerance_scanner_lift_mm</td><td>int</td><td>2</td><td>Tolerance for scanner lift. Actuator is being controlled until measured value is inside tolerance.</td></tr>
<tr><td>actuator_min_val</td><td>int</td><td>0</td><td>Minimum value of the actuator.</td></tr>
<tr><td>actuator_load_min_val</td><td>int</td><td>200</td><td>Minimum value of the actuator when AGV is loaded.</td></tr>
<tr><td>actuator_max_val</td><td>int</td><td>800</td><td>Maximum value of the actuator.</td></tr>
<tr><td>actuator_home_val_mm</td><td>int</td><td>0</td><td>Normal actuator height while driving without a load.</td></tr>
<tr><td>actuator_load_aboard_offset_mm</td><td>int</td><td>0</td><td>Offset to the reference actuator value when AGV is loading / carrying a load.</td></tr>
<tr><td>actuator_timer_s</td><td>int</td><td>20</td><td>Timer [s] for detecting that measured actuator value reaches target value in time. Triggers an error.</td></tr>
<tr><td>actuator_only_on_sp</td><td>int</td><td>0</td><td>Allow loading/unloading only on Pick-Up/Drop-Off symbolic point.</td></tr>
<tr><td>actuator_max_dist_err_from_sp</td><td>float</td><td>0.0</td><td>Maximum distance error from Pick-Up/Drop-Off symbolic point when starting loading/unloading. Only used if actuator_only_on_sp is enabled and parameter value &gt; 0.</td></tr>
<tr><td>actuator_allow_activation_mode</td><td>int</td><td>1</td><td>Actuator activation mode: 0 = actuator control allowed only in load state, 1 = actuator control allowed in auto &amp; load state, 2 = enable protection zone override in standby&amp;auto</td></tr>
<tr><td>actuator_trust_io_load_status</td><td>int</td><td>0</td><td>Mode for determining load status: 0 = Load status from load detection sensor. If no sensor, load status determined from Load/Unload actions, 1 = Load status from high/low limit, 2 = Load status determined comparing measured value to minimum load value (actuator_load_min_val).</td></tr>
<tr><td>actuator_val_io</td><td>int</td><td>-1</td><td>Actuator value to fleet control. Overrides one physical Integer input value, -1 = disabled.</td></tr>
<tr><td>actuator_load_det_io</td><td>int</td><td>-1</td><td>If load sensor is used or parameter actuator_trust_io_load_status activated, sends the load status to the fleet control as a Physical Binary Input, -1 = disabled.</td></tr>
<tr><td>actuator_load_det_io_type</td><td>int</td><td>0</td><td>Define what load status type is sent to fleet control via binary input. 0 = load sensor raw data, 1 = AGV load status</td></tr>
<tr><td>actuator_load_status_io</td><td>int</td><td>-1</td><td>Load status to fleet control as a Physical Binary Input, -1 = disabled</td></tr>
<tr><td>actuator_reach_enabled</td><td>int</td><td>0</td><td>Enable actuator with reach functionality (e.g. reach truck).</td></tr>
<tr><td>actuator_reach_home_val</td><td>int</td><td>0</td><td>Value of the reach actuator when at home position.</td></tr>
<tr><td>actuator_reach_load_val</td><td>int</td><td>0</td><td>Value of the reach actuator when moved to loading position</td></tr>
<tr><td>actuator_reach_unload_val</td><td>int</td><td>0</td><td>Value of the reach actuator when moved to unloading position.</td></tr>
<tr><td>actuator_tilt_enabled</td><td>int</td><td>0</td><td>Enable actuator with tilt functionality (e.g. forklift).</td></tr>
<tr><td>actuator_tilt_home_val_deg</td><td>float</td><td>0.0</td><td>Value of the tilt actuator when at home position.</td></tr>
<tr><td>actuator_tilt_dn_val_deg</td><td>float</td><td>0.0</td><td>Value of the tilt actuator when at down position.</td></tr>
<tr><td>actuator_tilt_up_val_deg</td><td>float</td><td>0.0</td><td>Value of the tilt actuator when at upper position.</td></tr>
<tr><td>actuator_side_shift_enabled</td><td>int</td><td>0</td><td>Enable actuator with side shift functionality.</td></tr>
<tr><td>actuator_side_shift_home_val</td><td>int</td><td>0</td><td>Value of the side shift actuator when at home position.</td></tr>
<tr><td>actuator_side_shift_left_val</td><td>int</td><td>0</td><td>Value of the side shift actuator when at left position.</td></tr>
<tr><td>actuator_side_shift_right_val</td><td>int</td><td>0</td><td>Value of the side shift actuator when at right position.</td></tr>
<tr><td>actuator_auxiliary_lift_enabled</td><td>int</td><td>0</td><td>Enable actuator with auxiliary lift.</td></tr>
<tr><td>actuator_auxiliary_lift_type</td><td>int</td><td>2</td><td>1 = manual control, 2 = reference value controlled actuator, 3 = binary controlled actuator (low/high pos only)</td></tr>
<tr><td>actuator_auxiliary_lift_tolerance_mm</td><td>int</td><td>0</td><td>Auxiliary lift tolerance.</td></tr>
<tr><td>actuator_auxiliary_lift_min_val_mm</td><td>int</td><td>0</td><td>Auxiliary lift minimum value.</td></tr>
<tr><td>actuator_auxiliary_lift_max_val_mm</td><td>int</td><td>3000</td><td>Auxiliary lift maximum value.</td></tr>
<tr><td>actuator_auxiliary_lift_load_val_mm</td><td>int</td><td>100</td><td>Auxiliary lift loaded value.</td></tr>
<tr><td>actuator_auxiliary_lift_as_secondary_lifting_device</td><td>int</td><td>0</td><td>Auxiliary lift is used as secondary lifting device meaning that both main lift and secondary lift can have load separately.</td></tr>
<tr><td>actuator_rotate_enabled</td><td>int</td><td>0</td><td>Actuator with rotate feature.</td></tr>
<tr><td>actuator_rotate_tolerance_deg</td><td>float</td><td>1.0</td><td>Rotate tolerance [deg].</td></tr>
<tr><td>actuator_rotate_min_val_deg</td><td>float</td><td>0.0</td><td>Rotate min value [deg].</td></tr>
<tr><td>actuator_rotate_max_val_deg</td><td>float</td><td>180.0</td><td>Rotate max value [deg].</td></tr>
<tr><td>actuator_rotate_middle_val_deg</td><td>float</td><td>0.0</td><td>Rotate middle value [deg]. Relative to the AGV frame.</td></tr>
<tr><td>actuator_rotate_right_val_deg</td><td>float</td><td>0.0</td><td>Rotate right value [deg]. Relative to the AGV frame.</td></tr>
<tr><td>actuator_rotate_left_val_deg</td><td>float</td><td>0.0</td><td>Rotate left value [deg]. Relative to the AGV frame.</td></tr>
<tr><td>actuator_filter_single_zeros</td><td>int</td><td>0</td><td>Enables filtering a single zero from actuator measurements.</td></tr>
<tr><td>actuator_keep_height_after_dropoff_aborted_distance_m</td><td>float</td><td>2.0</td><td>Distance from aborted dropoff location in meters to keep the actuator at current height.</td></tr>
<tr><td>actuator_periodic_status_update_interval_ms</td><td>int</td><td>0</td><td>Time interval [ms] for sending actuator status to fleet control. 0 = Periodic update disabled.</td></tr>
<tr><td>actuator_scanner_lift_enabled</td><td>int</td><td>0</td><td>Enables scanner lift that is attached to fork.</td></tr>
<tr><td>actuator_scanner_lift_type</td><td>int</td><td>2</td><td>1 = manual control, 2 = reference value controlled actuator, 3 = binary controlled actuator (low/high pos only)</td></tr>
<tr><td>actuator_scanner_lift_home_val_mm</td><td>int</td><td>0</td><td>Home value for scanner. Should be safe with any fork height and a bit above the fork level if used for load detection.</td></tr>
<tr><td>actuator_scanner_lift_detection_level_val_mm</td><td>int</td><td>-150</td><td>Scanner height value in which the scanner can see past a loaded resource.</td></tr>
<tr><td>actuator_scanner_lift_min_safe_val_mm</td><td>int</td><td>100</td><td>Minimum scanner height from the fork's zero level.</td></tr>
<tr><td>actuator_scanner_lift_used_for_load_det</td><td>int</td><td>0</td><td>Defines if scanner in lift is used for load detection.</td></tr>
<tr><td>actuator_lower_scanner_before_unload_buffer_dist</td><td>float</td><td>0.6</td><td>Distance [m] from unload buffer when scanner is lowered.</td></tr>
<tr><td>actuator_frame_longitudinal_tilt_tolerance_deg</td><td>float</td><td>1.0</td><td>Frame longitudinal tilt tolerance [deg]. The actuator is controlled until measured value is within this tolerance from the reference value.</td></tr>
<tr><td>actuator_frame_longitudinal_tilt_home_val_deg</td><td>float</td><td>0.0</td><td>Value [deg] of the tilt actuator when at home position.</td></tr>
<tr><td>actuator_frame_longitudinal_tilt_automatic_activation</td><td>int</td><td>0</td><td>Defines if the longitudinal tilt actuator is automatically activated when driving. 0 = Default actuator activation. 1 = In addition actuator is activated always when in auto or manual state.</td></tr>
<tr><td>actuator_frame_longitudinal_tilt_automatic_activation_acc_limit</td><td>float</td><td>0.0</td><td>Frame longitudinal tilt balancing is only active, if AGV:s navigation point acceleration or deceleration is smaller than this limit. 0 = unlimited</td></tr>
<tr><td>actuator_eth_ctrl_scale</td><td>int</td><td>10</td><td>Scale how fast reference value for actuator (e.g. lift height) changes when using remote control section via Supervisor interface.</td></tr>
<tr><td>actuator_load_sequence</td><td>int[]</td><td>0</td><td>Loading sequence: 0=none, 1=load, 2=unload, 3=reachFw, 4=reachHome, 5=tiltDn, 6=tiltHome, 7=tiltUp, 8=sideLeft, 9=sideHome, 10=sideRight, 11=notUsed, 12=auxLiftUp, 13=auxLiftDown</td></tr>
<tr><td>actuator_unload_sequence</td><td>int[]</td><td>0</td><td>Unloading sequence: 0=none, 1=load, 2=unload, 3=reachFw, 4=reachHome, 5=tiltDn, 6=tiltHome, 7=tiltUp, 8=sideLeft, 9=sideHome, 10=sideRight, 11=notUsed, 12=auxLiftUp, 13=auxLiftDown</td></tr>
<tr><td>actuator_disable_load_sensor_distance</td><td>float</td><td>0.8</td><td>Within the distance from loading/unloading point, load detection sensor is not used when driving</td></tr>
<tr><td>actuator_check_load_sensor_status_before_loading</td><td>int</td><td>0</td><td>1 = check that load sensor detecs a load, before loading.</td></tr>
<tr><td>actuator_check_load_sensor_status_after_loading</td><td>int</td><td>1</td><td>1 = check that load sensor detects a load, after loading.</td></tr>
<tr><td>actuator_check_load_sensor_status_after_unloading</td><td>int</td><td>0</td><td>1 = check that load sensor shows empty, after unloading.</td></tr>
<tr><td>actuator_move_allowed_while_driving_loaded</td><td>int</td><td>1</td><td>Allow moving the actuator while AGV is driving and carrying a load.</td></tr>
<tr><td>actuator_move_allowed_while_driving_not_loaded</td><td>int</td><td>1</td><td>Allow moving the actuator while AGV is driving and not carrying a load.</td></tr>
<tr><td>actuator_not_in_home_position_limit_agv_speed</td><td>int</td><td>0</td><td>Limit AGV speed if actuator is not in home position: 0 = Speed not limited, 1 = Speed limited</td></tr>
<tr><td>actuator_not_in_home_position_agv_speed_loaded_m_per_s</td><td>float</td><td>1.0</td><td>AGV speed [m/s] when actuator is not in home position and actuator is loaded.</td></tr>
<tr><td>actuator_not_in_home_position_agv_speed_unloaded_m_per_s</td><td>float</td><td>1.0</td><td>AGV speed [m/s] when actuator is not in home position and actuator is not loaded.</td></tr>
<tr><td>actuator_input_source_arr</td><td>int[]</td><td>0</td><td>Defines from which source actuator input is read: 0 = System selects, 1 = CAN Actuator/Encoder, 2 = Supervisor status section, 3 = Supervisor msg 1031, 4 = ROS, 10 = Custom CAN, 11 = Custom Modbus, 12 = Custom Supervisor</td></tr>
<tr><td>actuator_input_type_arr</td><td>int[]</td><td>0</td><td>Defines the actuator input source for specific actuator type: 0 = All types, 1 = Lift, 2 = Secondary Lift, 3 = Reach, 4 = Tilt up/down, 5 = Turn fork, 6 = Side shift, 7 = Sensor lift</td></tr>
<tr><td>actuator_number_of_binary_outputs</td><td>int</td><td>0</td><td>Number of generic binary outputs on the AGV</td></tr>
<tr><td>actuator_home_pos_safety_margin_meters</td><td>float</td><td>0.5</td><td>Safe area around AGV to keep the actuator at the home position.</td></tr>
<tr><td>actuator_strict_for_home_pos_zone</td><td>int</td><td>1</td><td>AGV is commanded to stop while controlling the actuator to the home position.</td></tr>
<tr><td>actuator_safety_zone_margin_meters</td><td>float</td><td>0.5</td><td>Safe area around AGV to prevent moving actuator near racks.</td></tr>
<tr><td>change_load_status_only_on_load_state</td><td>int</td><td>0</td><td>0 = Load status can be changed in every state based on load sensor, 1 = Load status can be changed only in Load state based on load sensor, 2 = Same as mode 1 but load status can change also to empty when both Fleet control and load sensor signal so and current load status is full.</td></tr>
<tr><td>min_distance_to_check_the_load_sensor</td><td>float</td><td>0.3</td><td>Minimum distance to check the load sensor. Used to avoid false checks if sensor gives bad data. The check starts at actuator_disable_load_sensor_distance. If set to -1.0, check is not used.</td></tr>
<tr><td>load_sensor_conflict_goes_to_manual</td><td>int</td><td>0</td><td>0 = Load sensor conflict raises error. 1 = Conflict changes the state to Manual. load_sensor_conflict_manual_reset_source parameter tells the source to release the Manual state after the load sensor is okay.</td></tr>
<tr><td>load_sensor_conflict_manual_reset_source</td><td>int</td><td>1</td><td>0 = none, 1 = Manual state is released from supervisor, 2 = Manual state is released using touchscreen UI</td></tr>
<tr><td>load_sensor_conflict_mode</td><td>int</td><td>2</td><td>0 = disable, 1 = Trigger error if sensor does not match with the Navithor load status. Check is done at actuator_disable_load_sensor_distance from symbolic point, at the beginning of the buffer lanes and when state is changed from Manual. 2 = Trigger error if sensor does not match with the Navithor load status in Auto state.</td></tr>
<tr><td>load_sensor_status_change_timer_ms</td><td>int</td><td>2000</td><td>Error is set if load sensor status changes in Auto state and stays in new value for this amount of time [ms].</td></tr>
<tr><td>disable_safety</td><td>int</td><td>0</td><td>Disables safety message is send to supervisor.</td></tr>
<tr><td>actuator_disable_safety_max_value_mm</td><td>int</td><td>0</td><td>Disable safety request is set if actuator is lower than this value. 0 = not used</td></tr>
<tr><td>disable_safety_distance_to_load_or_unload</td><td>float</td><td>-1.0</td><td>Disable safety request is set if driving closer than this distance to load or unload. 0 = not used</td></tr>
<tr><td>disable_safety_distance_on_buffer</td><td>float</td><td>-1.0</td><td>Disable safety if driving closer than this distance to target in load or unload buffer. 0 = not used.</td></tr>
<tr><td>disable_safety_limit_speed</td><td>float</td><td>0.2</td><td>Limit speed when safety is disabled, if disable_safety_distance_to_load_or_unload &gt; 0. If it is below 0, speed is not limited.</td></tr>
<tr><td>normal_unload_or_load_slow_down_distance</td><td>float</td><td>-1.0</td><td>Distance to start slow down before load or unload symbolic point [m]. Uses the disable_safety_limit_speed. 0 = Not used. Also not used if docking and pallet detection are used in load point.</td></tr>
<tr><td>actuator_ctrl_i</td><td>float[]</td><td>1.0</td><td>I control value for the actuator.</td></tr>
<tr><td>actuator_ctrl_p</td><td>float[]</td><td>1.0</td><td>P control value for the actuator.</td></tr>
<tr><td>actuator_ctrl_speed</td><td>float[]</td><td>0.2</td><td>Speed target for the actuator.</td></tr>
<tr><td>actuator_ctrl_max_acc</td><td>float[]</td><td>1.0</td><td>Acceleration ramps for actuator control.</td></tr>
<tr><td>actuator_ctrl_min_output</td><td>float[]</td><td>30.0</td><td>Minimum output for actuator control.</td></tr>
<tr><td>actuator_ctrl_max_output</td><td>float[]</td><td>5000.0</td><td>Maximum output for actuator control. For curtis, should be typically set to 32767.</td></tr>
<tr><td>actuator_ctrl_slow_fraction</td><td>float[]</td><td>0.5</td><td>Limits the maximum output by the fraction value in percentage 0-100% when soft stop is active. 100 means no limitation.</td></tr>
<tr><td>actuator_ctrl_pos_multi</td><td>float[]</td><td>1.0</td><td>Control output multiplier for positive control direction.</td></tr>
<tr><td>actuator_ctrl_inv_out</td><td>int[]</td><td>0</td><td>Inverse control output.</td></tr>
<tr><td>actuator_crawl_speed</td><td>float</td><td>0.01</td><td>Actuator speed when close to target.</td></tr>
<tr><td>actuator_crawl_dist</td><td>float</td><td>0.05</td><td>Distance [m] from stopping point to move actuator with slower speed.</td></tr>
<tr><td>actuator_speed_lowpass_alpha</td><td>float</td><td>0.25</td><td>Low-pass filter coefficient for the calculated actuator speed measurement.</td></tr>
<tr><td>trigger_load_unload_sequence_from_poscont</td><td>int</td><td>0</td><td>0 = No action, 1 = Trigger load/unload sequence when AGV arrives at Pick-Up/Drop-Off symbolic point. Load or unload action is decided based on load status.</td></tr>
<tr><td>fork_raise_cmd</td><td>int</td><td>400</td><td>Output value for lifting the forks.</td></tr>
<tr><td>fork_low_cmd</td><td>int</td><td>-400</td><td>Output value for lowering the forks.</td></tr>
<tr><td>actuator_up_output_percentage</td><td>int</td><td>60</td><td>Actuator control value in percentage when lifting actuator.</td></tr>
<tr><td>actuator_down_output_percentage</td><td>int</td><td>0</td><td>Actuator control value in percentage when lowering the actuator.</td></tr>
<tr><td>fork_pos_x</td><td>float</td><td>0.0</td><td>Fork coordinate X with respect to the AGV navigation point.</td></tr>
<tr><td>fork_pos_y</td><td>float</td><td>0.0</td><td>Fork coordinate Y with respect to the AGV navigation point.</td></tr>
<tr><td>apply_actuator_offset_dist</td><td>float</td><td>0.5</td><td>Distance [m] from end symbolic point to start applying actuator stop offset. If AGV is going to stop before symbolic point, fork_pos_x is added to this distance. If AGV is going to stop after, custom route is created when AGV is within this distance. Not used if fork_pos_x is 0.0.</td></tr>
<tr><td>actuator_speed_loaded_mm_per_s</td><td>float</td><td>1000.0</td><td>Actuator speed [mm/s] while loaded.</td></tr>
<tr><td>actuator_speed_not_loaded_mm_per_s</td><td>float</td><td>1000.0</td><td>Actuator speed [mm/s] while not loaded.</td></tr>
</tbody></table>
<h3 id="racking"><a class="header" href="#racking">Racking</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>empty_space_area_width_addition_m</td><td>float</td><td>0.00</td><td>Positive value increases the width of the empty space detection area. This value is added to the pallet width to both directions. If this value is 0.05m and width is 0.8m the safety area width is 0.9m.</td></tr>
<tr><td>empty_space_area_length_addition_m</td><td>float</td><td>0.00</td><td>Positive value increases the length of the empty space detection area. This value is added to the pallet length to both directions. If this value is 0.05m and length is 1.25m the safety area length is 1.35m.</td></tr>
<tr><td>racking_mode</td><td>int</td><td>0</td><td>Enables racking feature.</td></tr>
<tr><td>racking_min_dist_rack_to_move_actuator_meters</td><td>float</td><td>2.0</td><td>Minimum AGV distance [m] from rack to be allowed to move the actuator.</td></tr>
<tr><td>racking_check_point_before_min_dist_rack_offset_m</td><td>float</td><td>0.5</td><td>Check before entering the minimum distance from rack that actuator is in target height. Used also when leaving rack to make sure that it is safe to start lowering the actuator.</td></tr>
<tr><td>racking_max_dist_from_rack_begin_lift_actuator_meters</td><td>float</td><td>5.0</td><td>The distance [m] of the earliest point to start moving the actuator to rack level.</td></tr>
<tr><td>racking_empty_space_det_height_mm</td><td>int</td><td>1000</td><td>How far from the current shelf we can lift the actuator to check the empty space. By default, the height is taken from the shelf above, but if it is not found this parameter is used.</td></tr>
<tr><td>racking_shelf_height_mm</td><td>int</td><td>20</td><td>Height of the shelf. Used in empty space detection to get the detection height below the rack above. Also used in shelf detection to control the fork below the shelf.</td></tr>
<tr><td>racking_empty_space_check_mode</td><td>int</td><td>0</td><td>0 = Disable the check, 1 = Check to the height of the rack above, 2 = Use only racking_empty_space_det_height_mm parameter to define the height.</td></tr>
<tr><td>racking_pallet_det_mode</td><td>int</td><td>0</td><td>0 = disabled, 1 = check that pallet is found on Precheck state, 2 = check that pocket is found on Precheck state, 3 = marker detection to localize load.</td></tr>
<tr><td>racking_shelf_max_angle_err_deg</td><td>float</td><td>10.0</td><td>Maximum allowed angle error for the shelf related to the target symbolic point.</td></tr>
<tr><td>racking_shelf_max_dist_err_m</td><td>float</td><td>0.2</td><td>Maximum allowed distance error for the detected shelf center related to the target symbolic point.</td></tr>
<tr><td>racking_shelf_height_to_fork_offset_mm</td><td>int</td><td>50</td><td>Offset for the fork to safely drive in to the shelf. Used in Beam detection, where the shelf height is detected using scanner. This offset is added to the detected height so the fork is on the correct height for driving in.</td></tr>
<tr><td>racking_shelf_height_detection_enabled</td><td>int</td><td>0</td><td>0 = disabled, 1 = Use the scanner to search for the shelf height on the Precheck state. Used only when driving to unload.</td></tr>
<tr><td>racking_shelf_min_width</td><td>float</td><td>2.0</td><td>Minimum width of the beam when searhing the shelf height. Used only when racking_shelf_height_detection_enabled is set.</td></tr>
<tr><td>racking_pallet_drag_push_detect_enable</td><td>int</td><td>0</td><td>Enables pallet drag/push detection feature.</td></tr>
<tr><td>racking_pallet_drag_push_dist_tolerance</td><td>float</td><td>0.05</td><td>Specifies the tolerance [m] for the pallet to be considered as being pushed or following the AGV.</td></tr>
<tr><td>racking_pallet_drag_push_dist_equality_tolerance</td><td>float</td><td>0.01</td><td>Specifies the equality tolerance [m] for the pallet to be considered as being pushed or following the AGV.</td></tr>
<tr><td>racking_pallet_drag_push_max_dist_rack_use_pallet_detection</td><td>float</td><td>0.5</td><td>Specifies the distance [m] between the AGV and the rack to use pallet detection for detecting if the pallet is pushed or dragged.</td></tr>
<tr><td>racking_pallet_drag_push_dist_to_pall_loc</td><td>float</td><td>0.02</td><td>Specifies the distance [m] between the AGV and the pallet while driving towards pallet location.</td></tr>
<tr><td>racking_enable_raise_err_pall_not_detected</td><td>int</td><td>0</td><td>Enables raising of error if pallet detection does not detect the pallet and if the distance to pallet is not available.</td></tr>
<tr><td>racking_pallet_drag_push_timer_lower_limit_us</td><td>int</td><td>400000</td><td>Timer minimum value for pallet drag push feature. The distance to pallet is sampled after the timer value surpasses this value.</td></tr>
<tr><td>racking_pallet_drag_push_timer_upper_limit_us</td><td>int</td><td>500000</td><td>Timer maximum value for pallet drag push feature. The distance to pallet is considered valid if obtained before the timer value surpasses this value.</td></tr>
<tr><td>racking_disable_symbol_point_cache</td><td>int</td><td>0</td><td>Disables the symbol point cacheing optimization feature.</td></tr>
</tbody></table>
<h3 id="buffer-lanes"><a class="header" href="#buffer-lanes">Buffer lanes</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>buffer_allow_drive_end_update_when_safety_is_disabled</td><td>int</td><td>0</td><td>If new drive order is received to the same destination when fork is set to floor level: 0 = keep the previous drive end, 1 = allows to update drive end point. Related to parameter disable_safety_distance_on_buffer. If AGV has pallet detection scanner that can be used when fork is at floor level, set this to 1, otherwise 0.</td></tr>
<tr><td>buffer_stop_dist_from_object_when_unloading</td><td>float</td><td>-2.0</td><td>Stopping distance [m] from the closest object, when unloading in a buffer. Calculated from navigation point to the scanner measurements seen on the buffer zone.</td></tr>
<tr><td>buffer_lanes_enabled</td><td>int</td><td>0</td><td>Enables buffer lane feature.</td></tr>
<tr><td>load_buffer_mode</td><td>int</td><td>3</td><td>0 = none, 1 = detect any objects based on scanner measurements, 2 = detect a pallet, 3 = external sensor (Load Detected bit on Supervisor status actuator section or CAN).</td></tr>
<tr><td>unload_buffer_mode</td><td>int</td><td>1</td><td>0 = none, 1 = detect any objects based on scanner measurements, 2 = detect a pallet.</td></tr>
<tr><td>buffer_check_start_dist_offset_m</td><td>float</td><td>2.0</td><td>Higher the value, earlier the machine starts checking, if the buffer is free for unloading or if there is pallet for loading.</td></tr>
<tr><td>buffer_stop_dist_from_object_when_loading</td><td>float</td><td>0.0</td><td>Stopping offset [m] for load buffer. Calculated from navigation point to the object or to the point where the external sensor is triggered.</td></tr>
<tr><td>buffer_trigger_unload_with_pause_message</td><td>int</td><td>0</td><td>0 = normal pause mode, 1 = trigger unload if Pause (supervisor message 3006) is received on the unload buffer area.</td></tr>
<tr><td>buffer_max_dist_from_route_to_target</td><td>float</td><td>0.2</td><td>Maximum transverse distance where the target can be from the route. If target is further away than this parameter, AGV is stopped. Also used as docking start condition (if it is enabled).</td></tr>
<tr><td>buffer_stop_AGV_when_decreasing_fork_before_load</td><td>int</td><td>1</td><td>0 = Allow AGV drive while lowering the fork, 1 = stop the AGV until the fork is decreased to the floor level. Used only if disable_safety_distance_to_load_or_unload is used.</td></tr>
<tr><td>buffer_stop_distance_from_unwanted_object</td><td>float</td><td>1.0</td><td>Distance to stop the AGV in front of object if using pallet detection. The distance is calculated from AGV frame. The AGV should continue driving when object is removed. Negative value stops the AGV immediately.</td></tr>
<tr><td>load_buffer_slow_down_distance</td><td>float</td><td>-1.0</td><td>Distance to start slow down before target in m. Uses the disable_safety_limit_speed. Negative not used.</td></tr>
<tr><td>unload_buffer_slow_down_distance</td><td>float</td><td>-1.0</td><td>Distance to start slow down before target in m. Uses the disable_safety_limit_speed. Negative not used.</td></tr>
<tr><td>unload_buffer_error_when_lane_full</td><td>int</td><td>0</td><td>Trigger fatal error if unload buffer lane is detected to be full when bringing a load.</td></tr>
</tbody></table>
<h3 id="blockstacking"><a class="header" href="#blockstacking">Blockstacking</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>stack_loading_enabled</td><td>int</td><td>0</td><td>Enables stackloading feature.</td></tr>
<tr><td>stack_loading_step_mm</td><td>int</td><td>1</td><td>How much [mm] the lift reference is changed in each step when scanning the stack.</td></tr>
<tr><td>stack_loading_occupancy_min_hits</td><td>int</td><td>0</td><td>Minimum scanner points required in occupancy area, 0 = disable occupancy check.</td></tr>
<tr><td>stack_loading_min_hits_top_legs</td><td>int</td><td>2</td><td>How many times the legs are required to detect before the pocket low level is stored.</td></tr>
<tr><td>stack_loading_min_hits_false</td><td>int</td><td>7</td><td>How many false detections are required before stopping the lifting.</td></tr>
<tr><td>stack_loading_stop_increase</td><td>int</td><td>3</td><td>What method is used for stopping lifting: 0 = none, 1 = leg detection, 2 = line model and leg detection, 3 = occupancy check, 4 = 3D camera, 5 = fork is moved to estimated height.</td></tr>
<tr><td>stack_loading_max_dist_to_pallet_m</td><td>float</td><td>1.0</td><td>Disable pallets if they are further detected than this value [m]. Used only with target_detection_type_selection = 2. Calculated from the scanner to the pallet front side.</td></tr>
<tr><td>stack_loading_dist_to_start_increase_m</td><td>float</td><td>1.0</td><td>Distance from navigation point to target stopping point to start lifting the fork.</td></tr>
<tr><td>stack_loading_min_pocket_size_mm</td><td>int</td><td>10</td><td>Minimum pocket size [mm] to allow docking. If pocket is smaller, choose the next pocket.</td></tr>
<tr><td>stack_loading_max_pocket_size_mm</td><td>int</td><td>150</td><td>Maximum pocket size [mm] to allow docking. If pocket is higher, choose the next pocket.</td></tr>
<tr><td>stack_loading_min_false_hits_legs</td><td>int</td><td>2</td><td>How many times the legs are required to false detect before detecting it as a false.</td></tr>
<tr><td>stack_loading_enable_soft_stop</td><td>int</td><td>0</td><td>0 = Softstop is used only when lifting the fork to the top pallet level, 1 = Enable softstop also when lowering the fork back to route level after driving out.</td></tr>
<tr><td>stack_loading_max_height_mm</td><td>int</td><td>3000</td><td>The maximum fork height for the scan. If the fork reaches this value, error is set or lifting is stopped and fork is lowered to the pocket. Depending on stack_loading_max_height_raises_error.</td></tr>
<tr><td>stack_loading_max_height_raises_error</td><td>int</td><td>1</td><td>If the fork height goes over the maximum allowed height 0 = stop lifting the fork and lower it to found pocket, 1 = set error.</td></tr>
<tr><td>stack_loading_max_height_to_load_from_floor_mm</td><td>int</td><td>2000</td><td>The maximum fork height after scan is ready where the fork can still be lowered to floor. If the fork is higher than this value and the pocket is found on the floor, error is set. Used to avoid picking multiple pallets.</td></tr>
<tr><td>stack_loading_stop_increase_height_mm</td><td>int</td><td>0</td><td>Lifting is stopped when the legs are not seen within this height. If set to 0, the stack_loading_min_hits_false is used for stop.</td></tr>
<tr><td>stack_loading_max_decrease_val_after_scan_mm</td><td>int</td><td>0</td><td>Maximum allowed lowering when the scan is done. Used to avoid selecting pocket from too low height. Recommended value is the maximum pallet height + some error. 0 not used</td></tr>
<tr><td>stack_loading_min_decrease_val_after_scan_mm</td><td>int</td><td>0</td><td>Minimum allowed lowering when the scan is done. Used to avoid selecting pocket too close to the stack top. Recommended value is the minimum pallet height - some error. 0 not used</td></tr>
<tr><td>stack_loading_max_retry_if_scanning_fails</td><td>int</td><td>0</td><td>Maximum number of retries if scanning doesn't find the pocket.</td></tr>
<tr><td>stack_loading_disable_linear_model_while_increasing</td><td>int</td><td>0</td><td>Disables pallet detection linear model if it is activated while scanning the stack.</td></tr>
<tr><td>stack_loading_dist_from_stack_to_move_actuator</td><td>float</td><td>1.5</td><td>Distance [m] from navigation point to the detected pallet front line where actuator can be controlled safely without hitting the stack.</td></tr>
<tr><td>block_stacking_mode</td><td>int</td><td>0</td><td>Mode for detecting the top pallet: 0 = none, 1 = Occupancy check, 2 = pallet detection, 3 = fork sensor, 4 = 3D camera, 5 = fork is moved to estimated height.</td></tr>
<tr><td>block_stacking_offset_mm</td><td>int</td><td>0</td><td>Offset [mm] from the sensor detection height to the actuator.</td></tr>
<tr><td>block_stacking_reference_step_mm</td><td>int</td><td>2</td><td>Increase value [mm] added to the current height on each step.</td></tr>
<tr><td>block_stacking_max_detection_wait_time_ms</td><td>int</td><td>30000</td><td>Max wait time in ms for target detection in front of the stack. Used in both dropoff and pickup and with 3D camera and external target detection.</td></tr>
<tr><td>block_stacking_use_scanner_to_check_safety</td><td>int</td><td>0</td><td>Use scanner to check if blockstacking is safe to start. Checks occupancy on top of the pallet where the blockstacking should be done. If there is already something, blockstacking is not started. 1 = rear, 2 = front scanner</td></tr>
<tr><td>block_stacking_max_diff_on_target_pos</td><td>float</td><td>0.2</td><td>Maximum difference allowed to the target location.</td></tr>
<tr><td>block_stacking_dist_to_check_load_sensor</td><td>float</td><td>-1.0</td><td>Distance from the unload location to AGV to check if load sensor detects still pallet when driving away from unload location. AGV is stopped if the sensor detects pallet. Negative = not used.</td></tr>
<tr><td>block_stacking_dist_to_unload</td><td>float</td><td>-2.0</td><td>Distance [m] from detected target to the unload location. Calculated from target's front line to the navigation point.</td></tr>
<tr><td>block_stacking_target_max_diff_from_route</td><td>float</td><td>0.1</td><td>How far [m] the target can be from the route to start block stacking sequence. If the target is too far, normal unload is done.</td></tr>
<tr><td>block_stacking_min_actuator_val_after_ready_mm</td><td>int</td><td>200</td><td>&gt; 0 Use softstop to move the fork to this parameter value when driving away from stack. 0 = move the fork while driving</td></tr>
<tr><td>block_stacking_target_max_heading_diff_deg</td><td>float</td><td>15.0</td><td>The maximum angle difference between target and the AGV for starting the sequence [deg].</td></tr>
<tr><td>block_stacking_overshoot_height_mm</td><td>int</td><td>150</td><td>How much [mm] the actuator should be lifted when the sensor does not see anything. Used to check that we are actually on top of the stack and not on the pocket when using fork sensors. Recommended value is bit higher than the height of the pocket.</td></tr>
<tr><td>block_stacking_max_height_mm</td><td>int</td><td>799</td><td>Maximum allowed height [mm] for actuator during the lifting phase. If actuator goes over this height, unload is done to the floor if AGV is inside the buffer area. If AGV is outside the buffer area, it waits for new drive order.</td></tr>
<tr><td>block_stacking_max_dist_to_target</td><td>float</td><td>2.0</td><td>Distance [m] from navigation point to target to start block stacking sequence.</td></tr>
<tr><td>block_stacking_max_extend_drive</td><td>float</td><td>0.2</td><td>Maximum allowed distance [m] to extend the drive after stopped with unload buffer if fork sensor is not triggered.</td></tr>
<tr><td>block_stacking_verify_unload_height_mm</td><td>int</td><td>0</td><td>0 = not used. Verify unload with load sensor, by lowering the actuator for value of this parameter and checking the sensor status. If sensor detects the pallet when lowered by this amount, error is triggered. If the sensor doesn't detect the pallet during the decrease, actuator is stopped and unload is considered to be ready.</td></tr>
<tr><td>block_stacking_verify_unload_height_sensor_offset_mm</td><td>int</td><td>0</td><td>0 = not used. Offset value for the actuator when the actuator is stopped using the load sensor.</td></tr>
<tr><td>block_stacking_disable_fork_sensor_dist</td><td>float</td><td>1.2</td><td>Distance from unload location to navigation point to disable fork sensor triggering normal unload after the height is set and when approaching to unload position.</td></tr>
<tr><td>block_stacking_reset_distance_from_increase_location</td><td>float</td><td>0.5</td><td>Distance to reset the state machine if AGV is far enough from the location where the increase starts.</td></tr>
<tr><td>block_stacking_max_unload_error_behind_SP</td><td>float</td><td>0.05</td><td>Tolerance for calculated unload point behind symbolic point. If it is more than this parameter, stacking is not done and unload will be done in front of the pallet.</td></tr>
<tr><td>block_stacking_pyramid_length_offset_mm</td><td>int</td><td>0</td><td>The length offset for pyramid stacking. Only enabled if the pyramid stacking flag is received from Fleet Control.</td></tr>
<tr><td>block_stacking_dist_from_stack_to_move_actuator</td><td>float</td><td>0.0</td><td>Distance [m] from navigation point to the detected pallet front line where actuator can be controlled safely without hitting the stack.</td></tr>
<tr><td>block_stacking_resource_height_mm</td><td>int</td><td>0</td><td>Hardcoded pallet height. Can be used to test without sensor data.</td></tr>
</tbody></table>
<h2 id="target-and-obstacle-detection"><a class="header" href="#target-and-obstacle-detection">Target and obstacle detection</a></h2>
<h3 id="target-detection"><a class="header" href="#target-detection">Target detection</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>target_detection_type_selection</td><td>int</td><td>0</td><td>Selects type of target detection: 0 = disabled, 1 = reflector detection, 2 = pallet detection, 3 = pallet detection ver 2, 4 = external target detection, 5 = supervisor controlled.</td></tr>
<tr><td>target_detection_always_enabled</td><td>int</td><td>0</td><td>Enables always target detection algorithm, otherwise target is only detected when docking.</td></tr>
<tr><td>target_detection_scan_selection</td><td>int</td><td>1</td><td>Defines which scanners are used for target detection: 0 = enable target_detection_multi_scan_selection, 1 = rear scanner only, 2 = front scanner only, 3 = both scanners (not supported with target_detection_type_selection = 2), 4 = use scanner in driving direction (front or rear), 5 = alternate between scanners.</td></tr>
<tr><td>target_detection_multi_scan_selection</td><td>int[]</td><td>0</td><td>Selects which scanner to use for target detection in different situations. Indexes: 0=rear, 1=front, 2=meas0, 3=meas1. 1 = use as only scanner, 2 = together with others (all at once), 3 = alternating with other as primary, 4 = alternating with other as secondary, 5 = use when driving forwards, 6 = use when driving backwards, 7 = use when driving transversal right, 8 = use when driving transversal left, 9 = use when AGV has load, 10 = use when AGV doesn't have load.</td></tr>
<tr><td>target_detection_scan_use_local_coordinates</td><td>int</td><td>0</td><td>0 = Use scanner data in world coordinates, 1 = local coordinates.</td></tr>
<tr><td>target_detection_results_dampening</td><td>float</td><td>0.3</td><td>Dampening value for the results: minimum = 0, maximum = 1.</td></tr>
<tr><td>target_detection_height_result_dampening</td><td>float</td><td>0.3</td><td>Dampening value for the target height detection: minimum = 0, maximum = 1.</td></tr>
<tr><td>target_detection_max_diff_in_xy_results</td><td>float</td><td>0.20</td><td>How much difference [m] is allowed in xy-location before the new result is updated without dampening.</td></tr>
<tr><td>target_detection_max_diff_in_angle_results</td><td>float</td><td>5.0</td><td>How much difference [deg] is allowed in angle before the new result is updated without dampening.</td></tr>
<tr><td>target_detection_max_diff_in_height_results</td><td>float</td><td>0.15</td><td>How much difference [m] is allowed in height before the new result is updated without dampening.</td></tr>
<tr><td>target_min_n_times_detected</td><td>int</td><td>20</td><td>Minimum number of times target must be detected before giving results.</td></tr>
<tr><td>target_max_n_times_missing</td><td>int</td><td>300</td><td>Maximum number of times last known location for target is given if no target detected: Minimum = 0</td></tr>
<tr><td>target_detection_max_dist_to_symbolic_point</td><td>float</td><td>6.0</td><td>Maximum distance from AGV to the end point to start the algorithm.</td></tr>
<tr><td>target_detection_simulation_enabled</td><td>int</td><td>0</td><td>0 = disabled, 1 = If simulating Navigation SW, gives some fixed results from the target detection function, 2 = force fixed simulated results even Navigation SW not on sim mode.</td></tr>
<tr><td>target_detection_supervisor_update_message_enabled</td><td>int</td><td>1</td><td>0 = Disabled, 1 = Use message 4101, 2 = Use message 4105 (contains more info).</td></tr>
<tr><td>target_detection_supervisor_update_message_interval_ms</td><td>int</td><td>200</td><td>Defines the send interval of the target detection update message. 0 = minimum (send on every cycle), 10000 = maximum.</td></tr>
<tr><td>target_detection_actuator_offset_to_scanner_mm</td><td>int</td><td>0</td><td>Scanner height offset relative to the actuator. Negative means that scanner is below the actuator. Used in racking pocket detection and stackloading.</td></tr>
<tr><td>target_detection_max_rendering_distance_from_sym_point</td><td>float</td><td>3.1</td><td>Target is only rendered if it is closer to the symbolic point than this distance.</td></tr>
<tr><td>target_detection_maximum_iterations</td><td>int</td><td>10</td><td>The maximum number of target detection iterations.</td></tr>
<tr><td>target_detection_min_search_radius</td><td>float</td><td>0.0</td><td>Defines the minimum search radius [m] around the expected target location, such as symbolic point, from which the target is searched.</td></tr>
<tr><td>target_verification_distance_from_sym_point</td><td>float</td><td>0.08</td><td>Stopping for target position verification at this distance from symbolic point.</td></tr>
<tr><td>target_marker_search_height_mm</td><td>int</td><td>0</td><td>Additional lifting of the actuator over its nominal level for detection purposes.</td></tr>
<tr><td>target_marker_sensor_nbr</td><td>int</td><td>0</td><td>External localisation sensor configured for target marker detection.</td></tr>
<tr><td>target_marker_position_offset</td><td>float</td><td>0.0</td><td>Position offset between marker and lifting (mid) point of the load. Positive value when the marker is on the right of the lifting point when the load is seen from the AGV.</td></tr>
<tr><td>target_marker_stop_accuracy_limit</td><td>float</td><td>0.01</td><td>Required stopping accuracy to end point of the correction drive.</td></tr>
<tr><td>refl_det_num_of_reflectors</td><td>int</td><td>4</td><td>Number of reflectors used for docking calculations. Must be either 2 or 4.</td></tr>
<tr><td>refl_det_refl_width</td><td>float</td><td>0.15</td><td>Width of the reflectors used for target detection purposes [m].</td></tr>
<tr><td>refl_det_refl_dist_A</td><td>float</td><td>0.55</td><td>The distance between the reflectors in the middle [m] (from one centre point of a reflector to another centre point).</td></tr>
<tr><td>refl_det_refl_dist_B</td><td>float</td><td>0.65</td><td>The distance between the reflector on the sides [m] (not used with 2 refs, with 4 refs left and right pair).</td></tr>
<tr><td>refl_det_refl_width_max_error</td><td>float</td><td>0.05</td><td>Maximum allowed error for the width of the reflector [m].</td></tr>
<tr><td>refl_det_refl_dist_max_error</td><td>float</td><td>0.06</td><td>Maximum allowed error for the distance between reflectors [m].</td></tr>
<tr><td>refl_det_min_points_in_cluster</td><td>int</td><td>5</td><td>Minimum number of meas points in reflectors, recommended value 5.</td></tr>
<tr><td>refl_det_lin_mod_point_threshold</td><td>float</td><td>0.07</td><td>Linear threshold [m].</td></tr>
<tr><td>refl_det_refl_dist_pattern</td><td>float[]</td><td>0.0</td><td>Distances [m] between reflectors in pattern measured from center to center of the reflectors. The array should contain distances from leftmost [0] to rightmost [N].</td></tr>
<tr><td>refl_det_version</td><td>int</td><td>1</td><td>Use reflector detection version 1-symmetric, 2-pattern 3-pattern with height detection. Defaults to old symmetric version.</td></tr>
<tr><td>target_detection_combine_max_xy_diff</td><td>float</td><td>0.02</td><td>How much difference [m] is allowed in xy-location to combine results from different scanners.</td></tr>
<tr><td>target_detection_combine_max_ang_diff_deg</td><td>float</td><td>0.1</td><td>How much angle difference [deg] is allowed to combine results from different scanners.</td></tr>
<tr><td>refl_det_scan_offset_cancel</td><td>int</td><td>2</td><td>How many times a measurement can differ much before the scanner offset is considered out of range.</td></tr>
<tr><td>refl_det_scan_offset_confirm</td><td>int</td><td>20</td><td>How many times measurements must be within range before the scanner offset is considered stable.</td></tr>
<tr><td>pattern_detection_refl_board_pos_x</td><td>float</td><td>0.0</td><td>The x deviation between navigation point and pattern detection board's centre.</td></tr>
<tr><td>pattern_detection_refl_board_pos_y</td><td>float</td><td>0.0</td><td>The y deviation between navigation point and pattern detection board's centre.</td></tr>
<tr><td>pattern_detection_refl_board_angle_deg</td><td>float</td><td>0.0</td><td>The heading deviation between pattern detection board and AGV frame heading.</td></tr>
<tr><td>pallet_model_enabled</td><td>int[]</td><td>-1</td><td>Enables that pallet model to be used for detection.</td></tr>
<tr><td>pallet_model_description</td><td>string[]</td><td></td><td></td></tr>
<tr><td>pallet_model_width_y</td><td>float[]</td><td>0.0</td><td>Total width of the pallet (measured from stringer board).</td></tr>
<tr><td>pallet_model_length_x</td><td>float[]</td><td>0.0</td><td>Total length of the pallet.</td></tr>
<tr><td>pallet_model_n_legs_x</td><td>int[]</td><td>0</td><td>Number of legs (2 or 3) in X-direction (lengthwise).</td></tr>
<tr><td>pallet_model_n_legs_y</td><td>int[]</td><td>0</td><td>Number of legs (2 or 3) in Y-direction (widthwise).</td></tr>
<tr><td>pallet_model_mid_leg_width_y</td><td>float[]</td><td>0.0</td><td>Width (y-dimension) of the legs in middle column.</td></tr>
<tr><td>pallet_model_mid_leg_length_x</td><td>float[]</td><td>0.0</td><td>Length (x-dimension) of the legs in middle column.</td></tr>
<tr><td>pallet_model_side_leg_width_y</td><td>float[]</td><td>0.0</td><td>Width (y-dimension) of the legs on both side columns.</td></tr>
<tr><td>pallet_model_side_leg_length_x</td><td>float[]</td><td>0.0</td><td>Length (x-dimension) of the legs on both side columns.</td></tr>
<tr><td>pallet_model_y_offset</td><td>float[]</td><td>0.0</td><td>Offset in y-coordinate for docking (in machine coordinates).</td></tr>
<tr><td>pallet_model_stop_distance</td><td>float[]</td><td>0.0</td><td>Defines how close to the target vehicle tries to drive (calculated from navigation point to target).</td></tr>
<tr><td>pallet_model_min_dist_from_nav_point_to_traj_end</td><td>float[]</td><td>-1.0</td><td>Model specific distance from navigation point to trajectory end where the target is locked and not updated anymore. -1.0 = disabled and the generic parameter pallet_det_2_min_dist_from_nav_point_to_traj_end is used instead.</td></tr>
<tr><td>pallet_model_discard_outlier_points</td><td>int[]</td><td>0</td><td>Discard outlier points on leg cluster. Uses average distance on cluster to detect outliers. Might be useful if the leg length is small and there are no points to see on the side.</td></tr>
<tr><td>pallet_model_max_pocket_points</td><td>int[]</td><td>10</td><td>How many points are allowed to be between front row legs, that does not belong to any leg. If found more points between the legs, solution is discarded.</td></tr>
<tr><td>pallet_model_pocket_area_front_line_add</td><td>float[]</td><td>-0.02</td><td>How much the pocket area front line is moved [m], positive is towards the rear of the pallet.</td></tr>
<tr><td>pallet_model_pocket_area_rear_line_add</td><td>float[]</td><td>0.00</td><td>How much the pocket area rear line is moved [m], positive is towards the rear of the pallet.</td></tr>
<tr><td>pallet_model_definition_mode</td><td>int</td><td>1</td><td>Defines where the pallet model information is to be obtained: 0 = None, 1 = Parameters, 2 = Supervisor</td></tr>
<tr><td>pallet_det_linear_models_enabled</td><td>int</td><td>1</td><td>Enables pallet detection from stringer board (top part of the pallet), which can be seen as a line.</td></tr>
<tr><td>pallet_det_object_det_enabled</td><td>int</td><td>0</td><td>Enables object detection so that instead of pallets any cluster of scanner points inside the search area is detected as a target. target_detection_type_selection must have value 3 for this parameter to have an effect.</td></tr>
<tr><td>pallet_det_lin_mod_point_threshold</td><td>float</td><td>0.07</td><td>Maximum distance between points [m], when detecting a pallet from stringer board.</td></tr>
<tr><td>pallet_det_limit_initial_search_ang</td><td>float</td><td>20.0</td><td>Limits the search field of view in front of the scanner for the first leg [+-deg].</td></tr>
<tr><td>pallet_det_use_dynamic_search_ang</td><td>int</td><td>1</td><td>If set to 1, algorithm dynamically makes the search field of view bigger, if the target to be detected is closer and vice versa (pallet det v2 does not use this paramter).</td></tr>
<tr><td>pallet_det_limit_search_space</td><td>float</td><td>3.00</td><td>Limits the searching space in front of the laser scanner. Maximum distance [m] sideways for points to be considered for pallet. (pallet det v2 does not use this parameter)</td></tr>
<tr><td>pallet_det_first_leg_ang_weight</td><td>float</td><td>0.75</td><td>The two factors deciding the location for the first leg of the pallet we try to detect are angle and distance compared to the expected location. If parameter is bigger, having small angle errors is more important than distance error.</td></tr>
<tr><td>pallet_det_point_filter_dist</td><td>float</td><td>0.10</td><td>Filters all the points from calculations, which don't have any close neighbours within this distance [m]. Not used with pallet dev v2.</td></tr>
<tr><td>pallet_det_leg_dist_err</td><td>float</td><td>0.5</td><td>Scales how much error is allowed for the points in the side legs (measured from the supposed center points). Allowed distance error is this parameter multiplied with pallet leg width, so the dimensions of the model also affect the result.</td></tr>
<tr><td>pallet_det_leg_dist_err_back</td><td>float</td><td>0.07</td><td>How much distance error [m] is allowed for points in clusters behind the first row.</td></tr>
<tr><td>pallet_det_leg_ang_err</td><td>float</td><td>7.0</td><td>How many degrees of error is allowed for individual points in the first row of legs.</td></tr>
<tr><td>pallet_det_leg_ang_err_back</td><td>float</td><td>2.5</td><td>After detecting the legs and correcting the cluster locations, how many degrees of errors is allowed for the cluster location compared to expected for the legs behind the first row to be valid.</td></tr>
<tr><td>pallet_det_max_leg_dist_err</td><td>float</td><td>0.07</td><td>How many meters of distance error is allowed for the cluster locations compared to expected in the first row of legs for the whole solution to be valid. If error is bigger, solution is not accepted at all.</td></tr>
<tr><td>pallet_det_max_leg_ang_err</td><td>float</td><td>7.0</td><td>How many degrees of error is allowed for the cluster locations compared to expected in the first row of legs for the whole solution to be valid. If error is bigger, solution is not accepted at all.</td></tr>
<tr><td>pallet_det_min_points_in_cluster</td><td>int[]</td><td>5</td><td>Minimum number of measurement points in leg, second limit for a smaller leg, recommended values 5 for first and 4 for second. Index 0: How many points are required on a cluster to define it as a leg. Index 1: If the side leg width (pallet_model_side_leg_width_y) is smaller than 0.11, this parameter is used instead.</td></tr>
<tr><td>pallet_det_wall_check</td><td>int[]</td><td>0</td><td>Enable wall checks, can be 0, 1 or 2, recommended values 1 for first and 0 for second. With value 1 on the first, the algorithm discards the solution, if between the legs the holes are not seen, or if on the sides of the legs it looks like there is a wall instead of empty space. With value 2, a single wall is enough to discard the model. With value 1 on the second parameter, the solution is discarded if the holes between the legs are not detected and there is no wall next to the outer legs. Used for example, if the detected model is actually larger than should be (outer legs detected instead of the inner ones).</td></tr>
<tr><td>pallet_det_wall_check_points</td><td>int</td><td>6</td><td>Affects how many points at maximum from the leg are checked in the wall checks, before a decision is made that if there is empty space or not.</td></tr>
<tr><td>pallet_det_wall_point_dist_threshold</td><td>float</td><td>0.05</td><td>Maximum distance [m] between points, that they are estimated to be linked together in the wall checks.</td></tr>
<tr><td>pallet_det_new_validity_check</td><td>int</td><td>1</td><td>New check for pallet validity. Pallet model is discarded if at least validity_check_discard_ratio of points are further away than pallet_det_wall_point_dist_threshold * 10.</td></tr>
<tr><td>pallet_det_new_validity_check_min_discard_ratio</td><td>float</td><td>0.3</td><td>Percentage of how many outlier points are required from the total point count before pallet model is discarded.</td></tr>
<tr><td>pallet_det_correction_recursion_enabled</td><td>int</td><td>1</td><td>If set to 1, if cluster correction algorithm doesn't find points that could be used for correcting the location, the function can be called recursively (for max 10 times) with a wider search angle. If 0, the search angles are always fixed and wider.</td></tr>
<tr><td>pallet_det_cluster_correction_angle_offset</td><td>float</td><td>0.0</td><td>On default no offset given, but if the shape of the leg requires this (some non-standard non-square shape). Changing off the offset requires in most case testing with different values to see how it exactly behaves, so no clear instructions can't be given for how to use it.</td></tr>
<tr><td>pallet_det_cluster_corr_mode</td><td>int</td><td>0</td><td>On default setting of 0 tries to correct X- and Y- directions independently. On 1, tries to check points only on the nearest corner to the scanner and corrects both directions based on this.</td></tr>
<tr><td>pallet_det_y_corr_threshold_ang</td><td>float</td><td>4.0</td><td>If the angle difference from laser to the leg compared to leg heading is really small (smaller than this parameter), we don't really see either side of the leg so it's better to just calculate an average of the Y-direction.</td></tr>
<tr><td>pallet_det_cluster_corr_min_points</td><td>int</td><td>1</td><td>Minimum number of points used when correcting pallet legs. If 0 points found, making a correction is not possible. If there is a lot of variance and noice in individual points, should be set higher than 1.</td></tr>
<tr><td>pallet_det_cluster_dist</td><td>float[]</td><td>0.90</td><td>Distance check multiplier for leg points in first row of legs. Index 0: Distance check multiplier for leg points in first row of legs. Index 1: Distance check multiplier for leg points in second and third row of legs. Index 2: Diagonal distance multiplier.</td></tr>
<tr><td>pallet_det_front_row_weight</td><td>float</td><td>3.0</td><td>How much weight is given for the front row of legs compared to other legs, when calculating the final result of XYH for pallet. Front row is usually seen more accurately, so on default it has more weight.</td></tr>
<tr><td>pallet_det_fitness_weight</td><td>float[]</td><td>1.0</td><td>Array to change weight of the different parts for how good a solution is considered to be, if several are found (bigger scale means bigger weight). fit0 is the first found leg on the middle. fit1 how many legs found in the first row. fit2 number of legs in the back rows, solutions with more found legs are preferred. fit3 the difference between center of the pallet compared to the expected location. fit4 angle of the target compared to the expected (symbolic point heading basically). fit5 cluster width compared to model leg width. fit6 cluster outer distance compared to model width. fit7 is for determining the heading ambiguity of asymmetric pallets.</td></tr>
<tr><td>pallet_det_allow_only_middle_leg</td><td>int</td><td>0</td><td>If set to 1, accept only solutions for 3-leg pallets, where the closest leg to a line drawn from the navigation point towards the direction of the scanner (straight fw or bw) is the middle leg instead of a side leg.</td></tr>
<tr><td>pallet_det_split_threshold</td><td>float</td><td>0.06</td><td>Used for deciding, if one cluster should be splitted into separate clusters. A line is calcualted between start and end point and then the distance of cluster points is compared to this line. If there is a point with longer distance from the line defined by this parameter [m], cluster is splitted.</td></tr>
<tr><td>pallet_det_linear_model_max_err</td><td>float</td><td>0.07</td><td>Maximum difference [m] between the found line model and width of the pallet model for solution to be accepted.</td></tr>
<tr><td>pallet_det_min_dist_from_scanner</td><td>float</td><td>0.20</td><td>Minimum distance from scanner to pallet that pallet position is updated. Pallet det v2 uses this only to discard points that are closer to the scanner than this parameter.</td></tr>
<tr><td>pallet_det_min_points_close_to_first_point</td><td>int</td><td>3</td><td>Minimum number of points next to the first point we are searching for.</td></tr>
<tr><td>pallet_det_heading_offset</td><td>float</td><td>0.0</td><td>Heading offset [deg] added to the target angle.</td></tr>
<tr><td>pallet_det_2_min_dist_from_nav_point_to_traj_end</td><td>float</td><td>0.50</td><td>Minimum distance from navigation point to trajectory end that pallet position is locked and not updatedd anymore. This parameter is ignored, if model specific distances are defined.</td></tr>
<tr><td>pallet_det_2_max_dist_to_first_point</td><td>float</td><td>0.05</td><td>Maximum difference between consecutive closest points.</td></tr>
<tr><td>pallet_det_2_initial_search_model_width_add</td><td>float</td><td>0.50</td><td>Increase the search area by adding this value to the model width.</td></tr>
<tr><td>pallet_det_2_detect_only_front_legs</td><td>int</td><td>0</td><td>If set to 1, algorithm detects only first legs and calculates target position based on this. Sometimes increases accuracy, because front legs are seen most accurately.</td></tr>
<tr><td>pallet_det_2_max_dist_to_route</td><td>float</td><td>0.2</td><td>Maximum distance to the route (line that is aligned to the route heading). Calculated from the pallet centre. If the pallet is found further that this parameter, that result is discarded.</td></tr>
<tr><td>pallet_det_2_cluster_only_based_on_distance_and_index</td><td>int</td><td>0</td><td>Create clusters based on distance between points (pallet_det_lin_mod_point_threshold) and index.</td></tr>
<tr><td>pallet_det_2_min_leg_cluster_coverage</td><td>float</td><td>0.7</td><td>Minimum average fraction value of percentage for legs to cover the cluster. If the percentage is lower, that model is discarded. Uses fit5 value as the percentage.</td></tr>
<tr><td>pallet_det_2_max_pallet_width_error</td><td>float</td><td>0.2</td><td>Maximum error between pallet width compared to side legs outer distance [m]. If the error is higher, that model is discarded. Uses fit6 value as the error.</td></tr>
<tr><td>pallet_det_2_fitness_cost_percentage_for_unwanted_cluster</td><td>float</td><td>0.8</td><td>Fraction value of percentage cost for the total fitness if found cluster between the side legs. Used only with two-legged pallets and only on the front row. Negative values discards the result.</td></tr>
<tr><td>pallet_det_2_min_points_to_create_unwanted_cluster</td><td>int</td><td>4</td><td>How many scanner points are required between the side legs to try creating unwanted cluster.</td></tr>
<tr><td>pallet_det_2_max_point_diff_for_unwanted_cluster</td><td>int</td><td>4</td><td>How many points less are needed on the cluster on the middle related to the amount on the side legs. Used to find only similar size cluster as the side legs.</td></tr>
<tr><td>pallet_det_2_max_pallet_angle_error</td><td>float</td><td>30.00</td><td>Maximum angle [deg] for the pallet related to the symbolic point heading.</td></tr>
<tr><td>pallet_det_2_max_error_multiplier_for_outlier_point</td><td>float</td><td>1.4</td><td>Multiplier for maximum distance error for outlier points. Used to discard points from cluster if pallet_model_discard_outlier_points is enabled.</td></tr>
<tr><td>pallet_det_2_lock_model_if_found_number_of_times</td><td>int</td><td>0</td><td>0 = not used. How many times same model is required to detect in a row before searching only that model.</td></tr>
<tr><td>pallet_det_linear_model_max_point_idx_diff</td><td>int</td><td>3</td><td>Maximum difference between consecutive points when searching the linear model.</td></tr>
<tr><td>pallet_det_maximum_target_pose_error</td><td>float</td><td>0.2</td><td>Maximum target distance deviation between estimated centre point and target.</td></tr>
<tr><td>pallet_det_polygon_cluster_margin_width</td><td>float</td><td>0.1</td><td>Margin for width of polygon for clustering.</td></tr>
<tr><td>pallet_det_polygon_cluster_margin_length</td><td>float</td><td>0.1</td><td>Margin for length of polygon for clustering.</td></tr>
<tr><td>pallet_det_2_relative_target_det_after_locking</td><td>int</td><td>0</td><td>Enables relative target detection (in local machine coordinates) after target has been locked.</td></tr>
<tr><td>pallet_det_table_leg_cluster_coverage</td><td>float</td><td>0.5</td><td>Minimum fraction of legs to cover the cluster. If the fraction is lower, that cluster is discarded. Too small may result in false-positive, too large in false-negative.</td></tr>
<tr><td>occup_check_enabled</td><td>int</td><td>0</td><td>Enables occupancy check around symbolic point. AGV stops if it detects that zone linked to symbolic point is occupied.</td></tr>
<tr><td>occup_check_start_dist</td><td>float</td><td>3.0</td><td>Distance [m] to symbolic point to trigger occupancy check. Measured from the front or rear of the vehicle depending of driving direction.</td></tr>
<tr><td>occup_check_stop_dist</td><td>float</td><td>0.2</td><td>Distance [m] to symbolic point to stop checking occupancy.</td></tr>
<tr><td>occup_check_min_hits</td><td>int</td><td>1</td><td>Minimum hits required in occupancy area to stop the vehicle.</td></tr>
<tr><td>occup_check_min_hits_mode</td><td>int</td><td>1</td><td>How the minimum hits are calculated: 1 = Total points from all assigned scanners, 2 = Points from at least one assigned scanner, 3 = Points from every assigned scanner.</td></tr>
<tr><td>occup_check_scan_selection</td><td>int</td><td>1</td><td>Defines which scanners are used for occupancy check: Bit 0 = rear scanner, Bit 1 = front scanner, Bit 2 = measurement 0 scanner, Bit 3 = measurement 1 scanner.</td></tr>
<tr><td>occup_check_mode</td><td>int</td><td>0</td><td>Occupancy check mode: 0 = check always, 1 = disable when AGV is not carrying a load, 2 = disable when AGV carries a load, 3 = disable for a Pick up symbolic point when AGV is not carrying a load.</td></tr>
<tr><td>ext_target_det_sensor_x_pos</td><td>float</td><td>0.0</td><td>External target detection sensor x position with respect to the AGV navigation point.</td></tr>
<tr><td>ext_target_det_sensor_y_pos</td><td>float</td><td>0.0</td><td>External target detection sensor y position with respect to the AGV navigation point.</td></tr>
<tr><td>ext_target_det_sensor_angle_deg</td><td>float</td><td>0.0</td><td>External target detection sensor heading with respect to the AGV heading.</td></tr>
<tr><td>ext_target_det_sensor_update_rate_ms</td><td>int</td><td>500</td><td>External target detection data is sent to supervisor every second when target is not detected. This parameter defines the update interval when target detection is activated. 0 = Expect target detection only once when requested.</td></tr>
<tr><td>ext_target_det_measurement_delay_ms</td><td>int</td><td>50</td><td>Delay of sensor measurement [ms] relative to AGV position measurements.</td></tr>
<tr><td>ext_target_min_dist_from_traj_end_to_nav_point</td><td>float</td><td>0.40</td><td>Minimum distance from navigation point to trajectory end that target position is still updated.</td></tr>
<tr><td>ext_target_det_target_rendering_width</td><td>float</td><td>0.9</td><td>External target detection target width when rendered to Monitor. Does not affect to any calculations.</td></tr>
<tr><td>ext_target_det_target_rendering_length</td><td>float</td><td>0.4</td><td>External target detection target length when rendered to Monitor. Does not affect to any calculations.</td></tr>
<tr><td>ext_target_det_height_mode</td><td>int</td><td>0</td><td>0 = External target detection z value is used as reference height for actuator. E.g. z = 0.9m, actuator reference will be 900mm. 1 = z value is in sensor coordinates. E.g. value 0.2m would lift actuator 200mm from its current height.</td></tr>
<tr><td>ext_target_det_response_timeout_ms</td><td>int</td><td>2000</td><td>Time to wait [ms] for target detection response. Error is set if Navitrol doesn't receive response within this time. If set to 0, error is never set. Only used when ext_target_det_sensor_update_rate_ms is 0.</td></tr>
</tbody></table>
<h3 id="3d-target-detection"><a class="header" href="#3d-target-detection">3D Target detection</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>obj_reg_3d_region_of_interest_min_x</td><td>float</td><td>1.0</td><td>Minimum x value for passthrough filtering - sensor coordinates.</td></tr>
<tr><td>obj_reg_3d_region_of_interest_max_x</td><td>float</td><td>4.5</td><td>Maximum x value for passthrough filtering - sensor coordinates.</td></tr>
<tr><td>obj_reg_3d_region_of_interest_min_z</td><td>float</td><td>0.0</td><td>Minimum z value for passthrough filtering - w.r.t. floor level.</td></tr>
<tr><td>obj_reg_3d_region_of_interest_max_z</td><td>float</td><td>0.6</td><td>Maximum z value for passthrough filtering - w.r.t. floor level.</td></tr>
<tr><td>obj_reg_3d_number_of_pointcloud_logs</td><td>int</td><td>0</td><td>The number of error pointcloud logs dumped to directory.</td></tr>
<tr><td>obj_reg_3d_pointcloud_logging</td><td>int</td><td>0</td><td>A pointcloud log is dumped each iteration, regardless of error.</td></tr>
<tr><td>obj_reg_3d_sensor_translation_x</td><td>float[]</td><td>0.0</td><td>Sensor calibration from AGV centre point x [m].</td></tr>
<tr><td>obj_reg_3d_sensor_translation_y</td><td>float[]</td><td>0.0</td><td>Sensor calibration from AGV centre point y [m].</td></tr>
<tr><td>obj_reg_3d_sensor_translation_z</td><td>float[]</td><td>0.0</td><td>Sensor calibration from actuator height [m].</td></tr>
<tr><td>obj_reg_3d_sensor_internal_rotation_roll_deg</td><td>float[]</td><td>0.0</td><td>Sensor calibration roll. Sensor's internal coordinate frame.</td></tr>
<tr><td>obj_reg_3d_sensor_internal_rotation_pitch_deg</td><td>float[]</td><td>0.0</td><td>Sensor calibration pitch. Sensor's internal coordinate frame.</td></tr>
<tr><td>obj_reg_3d_sensor_internal_rotation_yaw_deg</td><td>float[]</td><td>0.0</td><td>Sensor calibration yaw. Sensor's internal coordinate frame.</td></tr>
<tr><td>obj_reg_3d_sensor_external_rotation_yaw_deg</td><td>float[]</td><td>0.0</td><td>The angular deviation between the 3d sensor's forward direction and AGV's X in machine coordinate frame (heading).</td></tr>
<tr><td>obj_reg_3d_distance_between_pallet_legs</td><td>float[]</td><td>0.0</td><td>Distance between pallet legs, to minimize false positives.</td></tr>
<tr><td>obj_reg_3d_object_length</td><td>float[]</td><td>0.0</td><td>The length of the object.</td></tr>
<tr><td>obj_reg_3d_object_width</td><td>float[]</td><td>0.0</td><td>The width of the object.</td></tr>
<tr><td>obj_reg_3d_object_height</td><td>float[]</td><td>0.0</td><td>The height of the object.</td></tr>
<tr><td>obj_reg_3d_model_name</td><td>string[]</td><td></td><td></td></tr>
<tr><td>obj_reg_3d_cluster_tolerance_dist</td><td>float</td><td>0.096</td><td>Euclidean clustering distance tolerance [m].</td></tr>
<tr><td>obj_reg_3d_cluster_min_size</td><td>int</td><td>40</td><td>Minimum cluster size.</td></tr>
<tr><td>obj_reg_3d_minimum_model_inlier</td><td>float</td><td>0.25</td><td>The minimum inlier fraction between model and scene pointcloud.</td></tr>
<tr><td>obj_reg_3d_intensity_filter_scale</td><td>float</td><td>0.85</td><td>Intensity filter scale factor (0-1.0).</td></tr>
<tr><td>obj_reg_3d_stop_for_target_detection_dist</td><td>float</td><td>2.0</td><td>Maximum distance from the object before AGV stops and tries detection on standstill. Distance from AGV's navigation point to the detected object.</td></tr>
<tr><td>obj_reg_3d_target_min_n_times_validated_consecutively</td><td>int</td><td>2</td><td>Minimum number of times target must be validated consecutively before giving results.</td></tr>
<tr><td>obj_reg_3d_target_max_n_times_measured_while_stopped</td><td>int</td><td>15</td><td>The maximum detection attempts at standstill until driving closer to target.</td></tr>
<tr><td>obj_reg_3d_max_diff_in_xy_results</td><td>float</td><td>0.03</td><td>How much difference [m] is allowed in xy-location between two consecutive object positions.</td></tr>
<tr><td>obj_reg_3d_max_diff_in_angle_results_deg</td><td>float</td><td>2.5</td><td>How much difference [deg] is allowed in angle between two consecutive object positions.</td></tr>
<tr><td>obj_reg_3d_sensor_model</td><td>int[]</td><td>0</td><td>3D sensor model: -1 = Unity, 0 = disabled, 1 = IFM O3D, 2 = SICK Visionary-T Mini, 3 = Fastdds</td></tr>
<tr><td>obj_reg_3d_sensor_ip</td><td>string[]</td><td></td><td></td></tr>
<tr><td>obj_reg_3d_sensor_height_fixed</td><td>int[]</td><td>0</td><td>The 3d sensor height is independent of actuator: 0 = dynamic height, 1 = static</td></tr>
<tr><td>obj_reg_3d_sensor_fov_vertical_deg</td><td>float[]</td><td>0.0</td><td>The sensor's vertical field of view [deg]. Used for empty space detection and pose verification.</td></tr>
<tr><td>obj_reg_3d_sensor_fov_horizontal_deg</td><td>float[]</td><td>0.0</td><td>The sensor horizontal field of view [deg]. Used for empty space detection and pose verification.</td></tr>
<tr><td>obj_reg_3d_enabled</td><td>int</td><td>0</td><td>Enables 3D detection feature.</td></tr>
<tr><td>obj_reg_3d_min_rack_beam_width</td><td>float</td><td>1.2</td><td>Minimum detected rack beam width.</td></tr>
<tr><td>obj_reg_3d_empty_space_min_material_width</td><td>float</td><td>0.3</td><td>Minimum solid material width beneath empty space.</td></tr>
<tr><td>obj_reg_3d_empty_space_width_margin</td><td>float</td><td>0.1</td><td>Empty space width margin [m].</td></tr>
<tr><td>obj_reg_3d_empty_space_length_margin</td><td>float</td><td>0.1</td><td>Empty space length margin [m].</td></tr>
<tr><td>obj_reg_3d_empty_space_height_margin</td><td>float</td><td>0.1</td><td>Empty space height margin [m].</td></tr>
<tr><td>obj_reg_3d_empty_space_max_cluster_density</td><td>int</td><td>50</td><td>Maximum number of allowed measurement points per cubic meter inside empty space.</td></tr>
<tr><td>obj_reg_3d_view_blocked_by_load_aboard</td><td>int</td><td>0</td><td>Define if 3d camera view is blocked by pallet onboard.</td></tr>
</tbody></table>
<h3 id="obstacle-detection-and-avoidance"><a class="header" href="#obstacle-detection-and-avoidance">Obstacle detection and avoidance</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>obst_av_mode</td><td>int</td><td>0</td><td>Defines the obstacle avoidance mode: 0 = disabled, 1 = only detect obstacles, 2 = detect and drive around the obstacles.</td></tr>
<tr><td>obst_free_zone_left</td><td>float</td><td>0.25</td><td>The margin [m] around the AGV left dimension that has to be free of obstacles.</td></tr>
<tr><td>obst_free_zone_right</td><td>float</td><td>0.25</td><td>The margin [m] around the AGV right dimension that has to be free of obstacles.</td></tr>
<tr><td>obst_free_zone_front</td><td>float</td><td>0.25</td><td>The margin [m] around the AGV front dimension that has to be free of obstacles.</td></tr>
<tr><td>obst_free_zone_rear</td><td>float</td><td>0.25</td><td>The margin [m] around the AGV rear dimension that has to be free of obstacles.</td></tr>
<tr><td>obst_distance_to_begin_planning</td><td>float</td><td>8.0</td><td>Distance [m] along the trajectory from AGV to obstacle to begin planning the bypass.</td></tr>
<tr><td>obst_bypass_velocity</td><td>float</td><td>0.3</td><td>Maximum speed [m/s] during the obstacle bypass when out of nominal route.</td></tr>
<tr><td>obst_detect_obstacles_dist</td><td>float</td><td>9.</td><td>Maximum distance [m] from which obstacles are polled along the trajectory.</td></tr>
<tr><td>obst_moving_det_treshold</td><td>float</td><td>0.5</td><td>Minimum obstacle speed [m/s] to count it as moving.</td></tr>
<tr><td>obst_detect_min_scan_points</td><td>int</td><td>4</td><td>Amount of colliding scan points required to start obstacle avoidance.</td></tr>
<tr><td>obst_detect_resolution_cm</td><td>int</td><td>5</td><td>Resolution of collision detection [cm].</td></tr>
<tr><td>obst_moving_wait_time_ms</td><td>int</td><td>4000</td><td>Time [ms] to wait if obstacle moves before replanning.</td></tr>
<tr><td>obst_return_wait_time_s</td><td>int</td><td>10</td><td>Time [s] to try replanning before returning back to nominal route.</td></tr>
<tr><td>obst_replan_wait_time_ms</td><td>int</td><td>2000</td><td>Time [ms] to wait between consecutive replans.</td></tr>
<tr><td>obst_avoidance_sleep_ms</td><td>int</td><td>300</td><td>Minimum time [ms] between obstacle avoidance checks.</td></tr>
<tr><td>obst_bypass_edge_safety_addition</td><td>float</td><td>0.25</td><td>Additional free space between obstacle and AGV during bypass for the trajectory. Compensates scanner noise and should be set according to that.</td></tr>
<tr><td>obst_bypass_trajectory_max_angle_deg</td><td>float</td><td>45.0</td><td>Maximum angle [deg] that the AGV has to turn when bypassing-</td></tr>
<tr><td>obst_detection_scanners</td><td>int</td><td>3</td><td>Defines which localization scanners are used for obstacle detection: 0 = none, 1 = rear scanner only, 2 = front scanner only, 3 = both scanners</td></tr>
<tr><td>obst_detection_meas_scanners</td><td>int</td><td>0</td><td>Defines which measurement scanners are used for obstacle detection: 0 = none, 1 = first scanner only, 2 = second scanner only, 3 = both scanners</td></tr>
<tr><td>obst_use_zones</td><td>int</td><td>1</td><td>1 = Only bypass in obstacle avoidance zones defined in tools, 2 = Detect and bypass obstacles only inside zones</td></tr>
<tr><td>obst_detect_moving</td><td>int</td><td>1</td><td>Detects if obstacles are moving.</td></tr>
<tr><td>obst_omni_constant_frame_heading</td><td>int</td><td>1</td><td>Uses constant frame heading for omni machines when driving around the obstacle.</td></tr>
<tr><td>obst_max_obstacle_bypassed</td><td>float</td><td>100.0</td><td>Limit for bypass length in meters along the nominal trajectory.</td></tr>
<tr><td>obst_bypass_through_static_environment</td><td>int</td><td>0</td><td>0 = disabled, bypass is not planned through map points. 1 = only scanner points used in bypass route planning</td></tr>
<tr><td>obst_first_nodes_parallel_to_traj</td><td>int</td><td>0</td><td>Creates the first nodes parallel to current trajectory instead of bypass route.</td></tr>
<tr><td>obst_drive_near_close_obstacle</td><td>int</td><td>0</td><td>Whether to keep going when an obstacle is too close but not clashing directly with agv frame. 0 = stop, 1 = keep going</td></tr>
<tr><td>obst_close_obstacle_safety_zone</td><td>float</td><td>0.05</td><td>Distance [m] around the agv that is used to check close obstacles when obst_drive_near_close_obstacle is set to 1.</td></tr>
<tr><td>obst_return_to_nominal_max_dist_diff</td><td>float</td><td>0.10</td><td>Maximum distance to return to nominal route target point to determine returning is complete.</td></tr>
<tr><td>obst_return_to_nominal_max_angle_diff_deg</td><td>float</td><td>5.0</td><td>Maximum angle to return to nominal route target point to determine returning is complete.</td></tr>
<tr><td>obst_dist_to_stop_before_obstacle</td><td>float</td><td>0.5</td><td>Safety distance [m] to stop close to the obstacle. If 0, AGV should stop to the crashing point, but there might be some error.</td></tr>
<tr><td>obst_windowlen</td><td>int</td><td>10</td><td></td></tr>
<tr><td>obst_limit</td><td>float</td><td>0.25</td><td></td></tr>
<tr><td>obst_npointslimit</td><td>int</td><td>0</td><td></td></tr>
<tr><td>obst_detection_mode</td><td>int</td><td>0</td><td>Enables obstacle detection feature.</td></tr>
<tr><td>obst_detection_tx_every_nth</td><td>int</td><td>1</td><td>Send obstacle detection data once for every nth scanner measurement.</td></tr>
<tr><td>obst_detection_max_dist_in_object</td><td>float</td><td>0.200</td><td>Maximum distance between scan points for them to be considered the same detected object.</td></tr>
<tr><td>obst_detection_max_dist_from_line</td><td>float</td><td>0.050</td><td>Maximum distance a scan point can have from the detected line.</td></tr>
</tbody></table>
<h2 id="customer-ui"><a class="header" href="#customer-ui">Customer UI</a></h2>
<h3 id="navitrol-monitor-tools-and-fleet-control"><a class="header" href="#navitrol-monitor-tools-and-fleet-control">Navitrol Monitor, Tools and fleet control</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>monitoring_software_port</td><td>int</td><td>1234</td><td>Defines the port that monitor software tries to connect.</td></tr>
<tr><td>monitoring_software_allow_control_take</td><td>int</td><td>1</td><td>Enables Monitor to take control from already connected Monitor.</td></tr>
<tr><td>tools_software_port</td><td>int</td><td>6079</td><td>Port for TCP communication with Navithor Tools.</td></tr>
<tr><td>compress_remote_mon_continous_data</td><td>int</td><td>1</td><td>Compress continous data sent from Navitrol to Monitor.</td></tr>
<tr><td>compress_remote_mon_event_data</td><td>int</td><td>1</td><td>Compress event data sent from Navitrol to Monitor.</td></tr>
<tr><td>compress_remote_mon_static_data</td><td>int</td><td>1</td><td>Compress static data (environment, routes and parameters) sent from Navitrol to Monitor.</td></tr>
<tr><td>fleet_control_port</td><td>int</td><td>6007</td><td>TCP/IP Port where the AGV listens for connections from fleet control.</td></tr>
<tr><td>fleet_control_device_errors_mode</td><td>int</td><td>0</td><td>Controls what device errors are sent to fleet control: 0 = none, 1 = errors received from supervisor, 2 = errors from all devices</td></tr>
<tr><td>fleet_control_err_msg_min_interval_ms</td><td>int</td><td>1000</td><td>Controls how often active errors are sent to fleet control [ms].</td></tr>
<tr><td>fleet_control_type</td><td>int</td><td>1</td><td>0 = No fleet control, 1 = Our own fleet control, 2 = External fleet control, 3 = VD(M)A fleet control</td></tr>
<tr><td>set_going_to_id_from_all_drive_orders</td><td>int</td><td>0</td><td>1 = Set going to ID to all trajectory's ending at a symbolic point, even if the ID is not sent in the drive order.</td></tr>
<tr><td>fleet_control_wait_time_for_answer_s</td><td>int</td><td>10</td><td>Maximum time [s] for waiting an answer from the fleet control. After that obstacle avoidance status will be reset. Used also when asking permission to drive other custom routes, error is set on timeout.</td></tr>
<tr><td>send_fleet_every_nth_trajectory_point</td><td>int</td><td>5</td><td>When sending obstacle bypass or custom route trajectory to fleet control, send every nth point to send less data.</td></tr>
<tr><td>remote_mon_min_send_interval_ms</td><td>int</td><td>500</td><td>Maximum acceptable data update and send interval [ms] to Monitor.</td></tr>
<tr><td>remote_mon_send_timeout_ms</td><td>int</td><td>2000</td><td>Maximum acceptable time [ms] for sending single data packet to Monitor.</td></tr>
<tr><td>remote_mon_recv_timeout_ms</td><td>int</td><td>2000</td><td>Maximum time [ms] to wait data packet from Monitor. Exceeding this time results in reconnect.</td></tr>
<tr><td>report_pp_status</td><td>int</td><td>0</td><td>Defines which message will be sent in response to a received position correction message: 0 = Send basic reply, 1 = Send reply with precision positioning data.</td></tr>
<tr><td>periodic_st_interv</td><td>int</td><td>100</td><td>How often [ms] to report AGV status to fleet control.</td></tr>
<tr><td>fleet_control_recv_timeout_ms</td><td>int</td><td>5000</td><td>Timeout [ms] before detecting the fleet control as disconnected.</td></tr>
<tr><td>fleet_control_abort_on_disconnect</td><td>int</td><td>0</td><td>Abort drive, if connection lost to fleet control.</td></tr>
<tr><td>remote_ctrl_watchdog_ms</td><td>int</td><td>1000</td><td>Remote control is disabled if no update is received within this time [ms].</td></tr>
<tr><td>remote_ctrl_idle_start_ms</td><td>int</td><td>2000</td><td>After (re)connection all joystick data is required to be 0 for this amount of time [ms] before manual control can be activated.</td></tr>
<tr><td>remote_ctrl_nbr_consecutive_manual_mode</td><td>int</td><td>3</td><td>Number of consecutive manual mode messages required for manual mode activation (glitch filtering).</td></tr>
<tr><td>keyb_ctrl_max_speed</td><td>float</td><td>0.5</td><td>Maximum speed [m/s] with keyboard control.</td></tr>
<tr><td>keyb_ctrl_acceleration_rate</td><td>int</td><td>2</td><td>Acceleration rate with keyboard control.</td></tr>
<tr><td>keyb_ctrl_deceleration_rate</td><td>int</td><td>4</td><td>Deceleration rate with keyboard control.</td></tr>
<tr><td>keyb_ctrl_increase_curv_rate</td><td>int</td><td>1</td><td>Curvature increase rate in remote control.</td></tr>
<tr><td>keyb_ctrl_decrease_curv_rate</td><td>int</td><td>2</td><td>Curvature decrease rate in remote control.</td></tr>
<tr><td>keyb_ctrl_max_pivot_speed</td><td>float</td><td>0.1</td><td>Keyboard control maximum speed [m/s] in pivot.</td></tr>
<tr><td>keyb_ctrl_max_curv</td><td>float</td><td>1.0</td><td>Maximum curvature [1/m] for remote control in normal driving.</td></tr>
<tr><td>web_ctrl_speed_multiplier</td><td>float</td><td>1.0</td><td>Multiplier for velocity when using old version of the supervisor remote control section. Otherwise obsolete.</td></tr>
<tr><td>remote_ctrl_stop_ramp_dec</td><td>float</td><td>0.8</td><td>Deceleration ramp when AGV is commanded to stop in remote control.</td></tr>
<tr><td>remote_ctrl_max_steer_rate_enabled</td><td>int</td><td>0</td><td>Enable steering rate limitations in remote control.</td></tr>
<tr><td>remote_ctrl_max_steer_rate_deg_p_s</td><td>float</td><td>80.0</td><td>Reference steering rate limit [Deg/s] when using remote control.</td></tr>
<tr><td>web_ctrl_actuator_max_speed_mm_per_s</td><td>int</td><td>2500</td><td>Maximum speed [mm/s] of actuator when controlled with webinterface.</td></tr>
<tr><td>use_long_machine_type_message</td><td>int</td><td>1</td><td>Send long machine type (32bit) to fleet control instead of short (16bit).</td></tr>
<tr><td>agv_status_message_version</td><td>int</td><td>2</td><td>What version of AGV status message to send to fleet control: 0 = old status message, 1 = fleetControlLoadStatus added, 2 = AGVStatusVer2</td></tr>
<tr><td>prevent_fleet_ctrl_driving_in_manual</td><td>int</td><td>0</td><td>Prevent any drive orders from fleet control in manual (e-15 key).</td></tr>
</tbody></table>
<h3 id="tcpip-communication-and-encryption"><a class="header" href="#tcpip-communication-and-encryption">TCP/IP Communication and encryption</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>network_ipv6_enabled</td><td>int</td><td>0</td><td>Enables IPv6 support for server sockets.</td></tr>
<tr><td>network_multicast_interface_name</td><td>string</td><td></td><td>Name of the specific interface used to receive multicast UDP messages</td></tr>
<tr><td>ssl_enabled</td><td>int</td><td>0</td><td>Enables SSL connections.</td></tr>
<tr><td>ssl_verify_server_cert</td><td>int</td><td>1</td><td>1 = verify server certificate.</td></tr>
<tr><td>ssl_verify_client_cert</td><td>int</td><td>1</td><td>1 = verify client certificate.</td></tr>
<tr><td>ssl_agv_certificate_file</td><td>string</td><td>./agv_certs/agv.crt</td><td>The name of the certificate file to be used by the AGV.</td></tr>
<tr><td>ssl_agv_key_file</td><td>string</td><td>./agv_certs/agv.key</td><td>The name of the key file to be used by the AGV.</td></tr>
<tr><td>ssl_pem_password</td><td>string</td><td></td><td>The password that is used to unlock key&amp;certificate.</td></tr>
<tr><td>ssl_ca_file</td><td>string</td><td>./agv_certs/root.crt</td><td>The PEM file containing the trusted CA certificates for verification.</td></tr>
<tr><td>ssl_cipher_list</td><td>string</td><td></td><td>The cipher list for OpenSSL.</td></tr>
<tr><td>ssl_dh_param_file</td><td>string</td><td>./agv_certs/dh_param_2048.pem</td><td>The DH parameter file for OpenSSL.</td></tr>
<tr><td>nav_ipc_ip</td><td>string</td><td>0.0.0.0</td><td>IP address of the device running Navigation SW. This address is sent to the ROS.</td></tr>
<tr><td>output_trigger_duration_ms</td><td>int</td><td>500</td><td>Duration [ms] to keep output (for example estop) on before resetting it.</td></tr>
<tr><td>ads_server_ip</td><td>string</td><td></td><td>IP adress for remote ADS Server.</td></tr>
<tr><td>ads_server_netid</td><td>string</td><td></td><td>NetID for remote ADS server.</td></tr>
<tr><td>ads_enabled</td><td>int</td><td>0</td><td>Enables ADS feature.</td></tr>
</tbody></table>
<h2 id="pgv-camera"><a class="header" href="#pgv-camera">PGV Camera</a></h2>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ext_loc_enabled</td><td>int</td><td>0</td><td>Enables External localization.</td></tr>
<tr><td>ext_loc_docking_enabled</td><td>int</td><td>0</td><td>Enables Docking feature (no teaching of lines).</td></tr>
<tr><td>ext_loc_docking_version</td><td>int</td><td>1</td><td>Data matrix code (DMC) Docking version: 1 = Version 1 (V1), 2 = Version 2 (V2)</td></tr>
<tr><td>ext_loc_docking_pos_conf_low_allowed</td><td>int</td><td>0</td><td>Allowd focking with external localization when position confidence low-</td></tr>
<tr><td>ext_loc_teach_mode</td><td>int</td><td>2</td><td>Select how to teach the data matrix tape: 0 = pose not saved, 1 = save pose with a time interval (ext_loc_teach_interval_ms), 2 = save pose only on demand (e.g. Save Pos pressed in WebUI), 3 = save pose with a distance interval (ext_loc_teach_interval_dist).</td></tr>
<tr><td>ext_loc_teach_interval_ms</td><td>int</td><td>2000</td><td>Save poses with a time interval [ms] when teach mode is 1.</td></tr>
<tr><td>ext_loc_teach_interval_dist</td><td>float</td><td>0.1</td><td>Save poses with a distance interval when teach mode is 3.</td></tr>
<tr><td>ext_loc_x_offset</td><td>float[]</td><td>0.0</td><td>Nominal X-coordinate of the sensor in machine coordinate system.</td></tr>
<tr><td>ext_loc_y_offset</td><td>float[]</td><td>0.0</td><td>Nominal Y-coordinate of the sensor in machine coordinate system.</td></tr>
<tr><td>ext_loc_h_offset_deg</td><td>float[]</td><td>0.0</td><td>Heading of the sensor [deg] in machine coordinate system. Heading angle of focal axis when the axis is in the vertical plane.</td></tr>
<tr><td>ext_loc_focal_orientation_deg</td><td>float[]</td><td>0.0</td><td>Orientation of camera coordinates around focal axis when mounted vertically, zero when x-right and y-up seen from camera along focal axis.</td></tr>
<tr><td>ext_loc_dist_from_line</td><td>float</td><td>0.2</td><td>Maximum distance between the sensor and the data matrix line in map coordinates for the external locaization feature to be activated.</td></tr>
<tr><td>ext_loc_for_pos_ctrl_mode</td><td>int</td><td>0</td><td>Select how PGV sensors are used for position control: 0 = disabled (follow virtual route), 1 = use only one sensor input, 2 = use two sensor when applicable, 3 = always require two sensors.</td></tr>
<tr><td>ext_loc_pos_ctrl_axis</td><td>int</td><td>0</td><td>Data matrix code line lateral coordinate axis: 0 = y-axis, 1 = x-axis</td></tr>
<tr><td>ext_loc_pos_ctrl_max_h_err</td><td>int</td><td>45</td><td>Maximum difference between the route heading and the data matrix line heading in map coordinates. The AGV follows the route normally if the heading difference is too big.</td></tr>
<tr><td>ext_loc_max_time_since_last_meas_ms</td><td>int</td><td>3000</td><td>Maximum time [ms] since last valid measurement when inside external localization area. 0 = disabled</td></tr>
<tr><td>ext_loc_max_dist_since_last_meas</td><td>float</td><td>0.0</td><td>Maximum distance [m] since last valid measurement when inside external localization area. 0.0 = disabled</td></tr>
<tr><td>ext_loc_strict_max_dist_since_last_meas</td><td>float</td><td>0.03</td><td>Strict maximum distance [m] since last valid measurement when close to symbolic point. Used with data matrix docking (ext_loc_docking_enabled).</td></tr>
<tr><td>ext_loc_heading_filt_alpha</td><td>float</td><td>1.0</td><td>Filtering gain for the heading measurement of the PGV sensor.</td></tr>
<tr><td>ext_loc_pos_ctrl_only</td><td>int</td><td>0</td><td>Use PGV sensor for position control only, not for localization.</td></tr>
<tr><td>ext_loc_pos_ctrl_dist_err_only</td><td>int</td><td>0</td><td>Use only distance error measurement for position control, when just one sensor is one the line. Suitable for diff/steer vehicles with sensor(s) outside of navigation point.</td></tr>
<tr><td>ext_loc_max_h_err_deg</td><td>float</td><td>10.0</td><td>Maximum change between the last heading of the AGV and the calculated heading from the data matrix code. Measurement is interpreted as invalid if change is too much.</td></tr>
<tr><td>ext_loc_max_xy_err</td><td>float</td><td>0.1</td><td>Maximum change between the last position of the AGV and the calculated position from the data matrix code. Measurement is interpreted as invalid if the change is too much.</td></tr>
<tr><td>ext_loc_pid_heading_p</td><td>float</td><td>0.0</td><td>Position control gain for heading when external localization is used. 0.0 = disabled</td></tr>
<tr><td>ext_loc_pid_dist_p</td><td>float</td><td>0.0</td><td>Position control gain for distance when external localization is used. 0.0 = disabled</td></tr>
<tr><td>ext_loc_stop_point_enabled</td><td>int</td><td>0</td><td>Stop point can be given in external localization coordinates.</td></tr>
<tr><td>ext_loc_stop_point</td><td>float[]</td><td>0.0</td><td>External localization stop point X-value. 0.0 = disabled</td></tr>
<tr><td>ext_loc_stop_point_min_agv_dist_from_sp</td><td>float</td><td>0.5</td><td>AGV needs to be within this distance from the target symbolic point to start checking for the stop point.</td></tr>
<tr><td>ext_loc_check_path_ready_dist</td><td>float</td><td>0.1</td><td>Determines if AGV is close to a stop point. It defines the area for handling the final stopping of the AGV and erroneous driving situations.</td></tr>
<tr><td>ext_loc_stop_distance_offset</td><td>float</td><td>0.0</td><td>Additional offset for stopping if stop point given in external localization coordinates. Apply negative offset if AGV stops too late.</td></tr>
<tr><td>ext_loc_path_ready_max_dist_err</td><td>float</td><td>0.003</td><td>Maximum distance from external localization stop point at the start of drive to decide if drive is ready.</td></tr>
<tr><td>ext_loc_h_diff_use_two_lines_deg</td><td>float</td><td>15.0</td><td>Deduction for using two lines instead of one. When heading difference between data matrix line and line through sensors is higher than parameter value, use two lines.</td></tr>
<tr><td>ext_loc_localize_without_pos_ctrl_checks</td><td>int</td><td>0</td><td>0 = external localization is ignored when position control sanity checks are not passed (e.g. route heading differs too much from line heading), 1 = localize without pos ctrl checks.</td></tr>
<tr><td>ext_loc_docking_max_h_err_deg</td><td>float</td><td>30.0</td><td>Maximum heading error to the defined target heading when docking is active (ext_loc_docking_enabled).</td></tr>
<tr><td>ext_loc_eth_model</td><td>int[]</td><td>-1</td><td>Model of ethernet external localization sensor: 0 = PGV camera, 1 = reserved, 2 = SICK Lector</td></tr>
<tr><td>ext_loc_eth_ip</td><td>string[]</td><td></td><td></td></tr>
<tr><td>ext_loc_eth_port</td><td>int[]</td><td>5333</td><td>Port of the device.</td></tr>
<tr><td>ext_loc_eth_protocol</td><td>int[]</td><td>2</td><td>Protocol for PGV ethernet connection: 1 = Stream, 2 = DGRAM</td></tr>
<tr><td>ext_loc_eth_swap_bytes</td><td>int</td><td>0</td><td>Swap bytes in PGV external localization ethernet interface: 0 = little endian, 1 = big endian.</td></tr>
<tr><td>ext_loc_config_file</td><td>string[]</td><td></td><td></td></tr>
<tr><td>ext_loc_config_msg_interval_ms</td><td>int[]</td><td>100</td><td>SICK Lector sensor configuration command transmit interval [ms].</td></tr>
<tr><td>pgv_enabled</td><td>uint</td><td>0</td><td>PGV sensor enabled.</td></tr>
<tr><td>pgv_x_offset</td><td>float[]</td><td>0.0</td><td>X-offset [m] from the nominal position of the device.</td></tr>
<tr><td>pgv_y_offset</td><td>float[]</td><td>0.0</td><td>Y-offset [m] from the nominal position of the device.</td></tr>
<tr><td>pgv_z_offset</td><td>float[]</td><td>0.0</td><td>Z-offset [m] from the nominal position of the device.</td></tr>
<tr><td>pgv_angle_offset_deg</td><td>float[]</td><td>0.0</td><td>Angle offset [deg] from the nominal position of the device.</td></tr>
<tr><td>pgv_can_node_id</td><td>int[]</td><td>0</td><td>Node ID of PGV camera: 0 = disabled, 1...127 = valid node ID.</td></tr>
<tr><td>pgv_model</td><td>int[]</td><td>0</td><td>0 = Not defined, 1 = safePGV.</td></tr>
<tr><td>pgv_max_missing_msg</td><td>int</td><td>5</td><td>Amount of missing messages for error to be triggered.</td></tr>
<tr><td>pgv_cam_res_x</td><td>float</td><td>0.0001</td><td>The x-axis resolution [m] of the PGV cameras.</td></tr>
<tr><td>pgv_cam_res_y</td><td>float</td><td>0.0001</td><td>The y-axis resolution [m] of the PGV cameras.</td></tr>
<tr><td>pgv_cam_res_h</td><td>float</td><td>0.1</td><td>The heading resolution [deg] of the PGV cameras.</td></tr>
<tr><td>pgv_looking_upwards</td><td>int</td><td>0</td><td>PGV looking upwards to QR code above the machine.</td></tr>
<tr><td>pgv_to_supervisor_nth_sync</td><td>int</td><td>1</td><td>PGV data is send to supervisor every n:th time after it is received.</td></tr>
</tbody></table>
<h2 id="ros"><a class="header" href="#ros">ROS</a></h2>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_enabled</td><td>int</td><td>0</td><td>Enable ROS Interface.</td></tr>
<tr><td>ros_log_mode</td><td>int</td><td>1</td><td>Save ROS logs: 0 = No logs, 1 = Text logs, 2 = Text and binary data logs</td></tr>
<tr><td>ros_log_duration_s</td><td>int</td><td>100</td><td>Maximum age [s] for ROS logs to be saved before getting removed.</td></tr>
<tr><td>ros_ip</td><td>string</td><td>0.0.0.0</td><td>IP address of the device running ROS.</td></tr>
<tr><td>ros_port_in</td><td>int</td><td>13579</td><td>Navigation SW port number for receiving ROS messages.</td></tr>
<tr><td>ros_port_out</td><td>int</td><td>24680</td><td>ROS port number.</td></tr>
<tr><td>ros_auto_config</td><td>int</td><td>1</td><td>Convert automatically Navitrol parameters into ROS format: 0 = No, 1 = All, 2 = All except URDF</td></tr>
<tr><td>ros_send_scan_data</td><td>int</td><td>0</td><td>Bitmapped number that determines which scanner data should be sent to ROS. Bit 0 = Rear, Bit 1 = Front, Bit 2 = Measurement 0, Bit 3 = Measurement 1</td></tr>
<tr><td>ros_localization_enabled</td><td>int</td><td>0</td><td>Use external pose from ROS.</td></tr>
<tr><td>ros_pose_topic_name</td><td>string</td><td>ros_agv_pose</td><td>ROS's pose topic name.</td></tr>
<tr><td>ros_pose_topic_type</td><td>int</td><td>1</td><td>ROS's pose topic type: 1 = geometry_msgs/msg/PoseWithCovarianceStamped, 2 = nav_msgs/msg/Odometry</td></tr>
<tr><td>ros_pose_quality_topic_name</td><td>string</td><td>position_confidence</td><td>ROS's pose quality topic name.</td></tr>
<tr><td>ros_pose_quality_min_value</td><td>float</td><td>0.0</td><td>ROS's pose quality minimum value.</td></tr>
<tr><td>ros_pose_quality_max_value</td><td>float</td><td>100.0</td><td>ROS's pose quality maximum value.</td></tr>
<tr><td>ros_odo_enabled</td><td>int</td><td>0</td><td>Use external odometry from ROS.</td></tr>
<tr><td>ros_odo_topic_name</td><td>string</td><td>odom</td><td>ROS's odometry topic name.</td></tr>
<tr><td>ros_odo_topic_type</td><td>int</td><td>1</td><td>ROS's odometry topic type: 1 = nav_msgs/msg/Odometry, 2 = geometry_msgs/msg/TwistStamped</td></tr>
<tr><td>ros_drive_agv</td><td>int</td><td>0</td><td>Defines if Navitrol drives ROS AGV.</td></tr>
<tr><td>ros_use_fork</td><td>int</td><td>0</td><td>Use ROS fork actuator.</td></tr>
<tr><td>ros_fork_height_min_value_offset</td><td>float</td><td>0.0</td><td>Zero position offset for ROS fork height actuator [m].</td></tr>
<tr><td>ros_fork_reach_min_value_offset</td><td>float</td><td>0.0</td><td>Zero position offset for ROS fork reach actuator [m].</td></tr>
<tr><td>ros_fork_height_negative_increment</td><td>int</td><td>0</td><td>ROS fork height actuator increases with negative sign.</td></tr>
<tr><td>ros_fork_reach_negative_increment</td><td>int</td><td>0</td><td>ROS fork reach actuator increases with negative sign.</td></tr>
<tr><td>ros_fork_test_mode</td><td>int</td><td>0</td><td>Use ros_fork_*_test parameters for ROS fork command.</td></tr>
<tr><td>ros_fork_height_test</td><td>float</td><td>0.0</td><td>ROS fork height value.</td></tr>
<tr><td>ros_fork_reach_test</td><td>float</td><td>0.0</td><td>ROS fork reach value.</td></tr>
<tr><td>ros_scan_mute_test</td><td>int</td><td>0</td><td>Mute ROS scanner.</td></tr>
<tr><td>ros_publish_map_to_odom_tf</td><td>int</td><td>1</td><td>Publish Navitrol's transform of coordinate frames map -&gt; odometry in ROS.</td></tr>
<tr><td>ros_publish_odom_to_agv_tf</td><td>int</td><td>1</td><td>Publish Navitrol's transform of coordinate frames odometry -&gt; AGV in ROS.</td></tr>
<tr><td>ros_publish_agv_tf</td><td>int</td><td>1</td><td>Publish AGV (static) transforms (AGV -&gt; sensor) in ROS.</td></tr>
<tr><td>ros_slam_enabled</td><td>int</td><td>0</td><td>Enables ROS simultaneous localization and mapping.</td></tr>
<tr><td>ros_slam_scanner</td><td>int</td><td>1</td><td>Scanner to use for SLAM: 0 = Rear, 1 = Front, 2 = Measurement 0, 3 = Measurement 1</td></tr>
<tr><td>ros_slam_map_resolution</td><td>float</td><td>0.05</td><td>Grid resolution to use for the map created by SLAM [m]. Recommended to keep at 0.05 m.</td></tr>
<tr><td>ros_camera_type</td><td>int</td><td>0</td><td>ROS camera type: 0 = No camera, 1 = RealSense D400 series</td></tr>
<tr><td>ros_camera_pos_x</td><td>float</td><td>0.0</td><td>ROS camera position on x-axis in AGV coordinates [m].</td></tr>
<tr><td>ros_camera_pos_y</td><td>float</td><td>0.0</td><td>ROS camera position on y-axis in AGV coordinates [m].</td></tr>
<tr><td>ros_camera_pos_z</td><td>float</td><td>0.0</td><td>ROS camera position on z-axis in AGV coordinates [m].</td></tr>
<tr><td>ros_camera_angle_roll</td><td>float</td><td>0.0</td><td>ROS camera orientation on x-axis in AGV coordinates [deg].</td></tr>
<tr><td>ros_camera_angle_pitch</td><td>float</td><td>0.0</td><td>ROS camera orientation on y-axis in AGV coordinates [deg].</td></tr>
<tr><td>ros_camera_angle_yaw</td><td>float</td><td>0.0</td><td>ROS camera orientation on z-axis in AGV coordinates [deg].</td></tr>
<tr><td>ros_camera_min_obstacle_height</td><td>float</td><td>0.05</td><td>Minimum height from ground to mark item as an obstacle [m].</td></tr>
<tr><td>ros_camera_max_obstacle_height</td><td>float</td><td>2.0</td><td>Maximum height from ground to mark item as an obstacle [m].</td></tr>
<tr><td>ros_camera_max_obstacle_distance</td><td>float</td><td>3.0</td><td>Maximum distance from sensor to mark item as an obstacle [m].</td></tr>
<tr><td>ros_camera_obstacle_remembering_time</td><td>float</td><td>15.0</td><td>How long to remember an obstacle outside of camera's field of view [s].</td></tr>
<tr><td>ros_camera_vertical_fov</td><td>float</td><td>58.0</td><td>ROS camera's vertical field of view [deg].</td></tr>
<tr><td>ros_camera_horizontal_fov</td><td>float</td><td>87.0</td><td>ROS camera's horizontal field of view [deg].</td></tr>
<tr><td>ros_obst_det_scanner_enabled_arr</td><td>int[]</td><td>0</td><td>Use ROS scanner for obstacle detection and avoidance (up to 4).</td></tr>
<tr><td>ros_obst_det_scanner_topic_arr</td><td>string[]</td><td></td><td></td></tr>
<tr><td>ros_obst_det_scanner_frame_arr</td><td>string[]</td><td></td><td></td></tr>
<tr><td>ros_obst_det_create_scanner_frame_arr</td><td>int[]</td><td>1</td><td>0 = Don't create coordinate frame, 1 = Create coordinate frame and transform for the scanner using ros_obst_det_scanner_&lt;x/y/h/upside_down&gt;_arr parameters</td></tr>
<tr><td>ros_obst_det_scanner_x_arr</td><td>float[]</td><td>0.0</td><td>ROS scanner x-coordinate with respect to navigation point [m].</td></tr>
<tr><td>ros_obst_det_scanner_y_arr</td><td>float[]</td><td>0.0</td><td>ROS scanner y-coordinate with respect to navigation point [m].</td></tr>
<tr><td>ros_obst_det_scanner_h_arr</td><td>float[]</td><td>0.0</td><td>ROS scanner orientation with respect to navigation point [deg].</td></tr>
<tr><td>ros_obst_det_scanner_upside_down_arr</td><td>int[]</td><td>0</td><td>Defines, if the ROS scanner is installed upside down.</td></tr>
<tr><td>ros_scan_filter_mode</td><td>int</td><td>0</td><td>Filter scan measurements for noisy data: 0 = Disabled, 1 = Cluster filter, 2 = Intense filter</td></tr>
<tr><td>ros_scan_filter_max_range_diff</td><td>float</td><td>0.1</td><td>How much an individual scan point's range can differ at max from the surrounding scan points to prevent filtering out [m].</td></tr>
<tr><td>ros_scan_filter_sector_size</td><td>int</td><td>3</td><td>Amount of surrounding scan points (from one side) to take into comparison with the current scan point.</td></tr>
<tr><td>ros_scan_filter_min_cluster_size</td><td>int</td><td>3</td><td>Minimum amount of scan points needed in a cluster group to prevent filtering out.</td></tr>
<tr><td>ros_pointcloud_scanner_enabled</td><td>int</td><td>0</td><td>Convert ROS2 PointCloud2 messages to 2D laser scanner measurements</td></tr>
<tr><td>ros_pointcloud_scanner_selection</td><td>int</td><td>0</td><td>For which 2D scanner to convert pointcloud data: 0 - Rear, 1 - Front, 2 - Measurement 0, 3 - Measurement 1</td></tr>
<tr><td>ros_pointcloud_scanner_resolution</td><td>float</td><td>1.0</td><td>Target angle resolution for 2D scan output [deg]</td></tr>
<tr><td>ros_pointcloud_scanner_input_topic</td><td>string</td><td></td><td>ROS topic name for pointcloud data</td></tr>
<tr><td>ros_pointcloud_scanner_min_height</td><td>float</td><td>0.0</td><td>Minimum height of pointcloud data (with respect to AGV frame) to project for 2D laser scanner measurement [m]</td></tr>
<tr><td>ros_pointcloud_scanner_max_height</td><td>float</td><td>2.0</td><td>Maximum height of pointcloud data (with respect to AGV frame) to project for 2D laser scanner measurement [m]</td></tr>
<tr><td>ros_obst_av_mode</td><td>int</td><td>ROS_OBST_AV_MODE_NONE</td><td>Use Obstacle avoidance V2. 0 = Disabled, 1 = Enabled</td></tr>
<tr><td>ros_obst_av_zone_mode</td><td>int</td><td>1</td><td>Defines the behavior of obstacle avoidance zones. 0 = Obstacle detection and avoidance allowed everywhere, 1 = Obstacle detection allowed everywhere and avoidance only inside zones, 2 = Obstacle detection and avoidance allowed only inside zones</td></tr>
<tr><td>ros_path_send_every_nth_point</td><td>int</td><td>5</td><td>When sending path to ROS, send every nth point. 0 = send all points</td></tr>
<tr><td>ros_obst_av_bypass_velocity</td><td>float</td><td>0.3</td><td>Maximum velocity [m/s] during the ros obstacle bypass when out of nominal route.</td></tr>
<tr><td>ros_obst_av_max_wait_time_sec</td><td>int</td><td>10</td><td>Maximum waiting time [s] during bypass for a valid ros path before raising a warning WARNING_UNABLE_TO_BYPASS_OBSTACLE. 0 = never raise an error</td></tr>
<tr><td>ros_obst_av_soft_stop_enabled</td><td>int</td><td>1</td><td>Enable soft stops during obstacle avoidance V2. 0 = Disabled, do hard stop. 1 = Enabled, do soft stop</td></tr>
<tr><td>ros_obst_av_reverse_to_nominal_mode</td><td>int</td><td>0</td><td>Reversing mode to nominal route if agv is stuck during bypass: 0 = Don't reverse, 1 = Backtrack the driven path</td></tr>
<tr><td>ros_obst_av_max_wait_time_before_reversing_sec</td><td>int</td><td>10</td><td>Time [s] to wait replanning before returning back to nominal route. Only relevant if ros_obst_av_reverse_to_nominal_mode is not zero.</td></tr>
<tr><td>ros_obst_av_return_to_nominal_max_dist_diff</td><td>float</td><td>0.05</td><td>After reaching this distance [m] from the diverge point, the return is considered completed.</td></tr>
<tr><td>ros_obst_av_return_to_nominal_max_angle_diff_deg</td><td>float</td><td>5.0</td><td>After reaching this angle difference [deg] from the diverge point, the return is considered completed.</td></tr>
<tr><td>ros_obst_av_bypass_start_slow_dist</td><td>float</td><td>1.5</td><td>Distance [m] before bypass diverge point from nominal to start soft slow.</td></tr>
<tr><td>ros_obst_av_fleet_control_request_timeout_s</td><td>int</td><td>10</td><td>Maximum time [s] to wait for Fleet Control response on bypass request. Request is considered rejected on timeout.</td></tr>
<tr><td>ros_obst_det_slow_dist</td><td>float</td><td>5.0</td><td>Distance [m] before detected collision point where the AGV will activate soft slow. Collision point is the first traj point where obstacle would enter the obst_free zones.</td></tr>
<tr><td>ros_obst_det_stop_dist</td><td>float</td><td>2.0</td><td>Distance [m] before detected collision point where the AGV will stop. Collision point is the first traj point where obstacle would enter the obst_free zones.</td></tr>
<tr><td>ros_obst_free_zone_left</td><td>float</td><td>0.10</td><td>The margin [m] around the AGV left dimension that has to be free of obstacles when using obstacle avoidance V2.</td></tr>
<tr><td>ros_obst_free_zone_right</td><td>float</td><td>0.10</td><td>The margin [m] around the AGV right dimension that has to be free of obstacles when using obstacle avoidance V2.</td></tr>
<tr><td>ros_obst_free_zone_front</td><td>float</td><td>0.10</td><td>The margin [m] around the AGV front dimension that has to be free of obstacles when using obstacle avoidance V2.</td></tr>
<tr><td>ros_obst_free_zone_rear</td><td>float</td><td>0.10</td><td>The margin [m] around the AGV rear dimension that has to be free of obstacles when using  obstacle avoidance V2.</td></tr>
<tr><td>ros_obst_free_zone_gain_for_planning</td><td>float</td><td>1.3</td><td>Multiplier for the AGV obstacle free zone for route planning.</td></tr>
<tr><td>ros_obst_det_dist</td><td>int</td><td>10</td><td>How far ahead to check for collisions along the trajectory [m].</td></tr>
<tr><td>ros_obst_det_max_scan_dist</td><td>float</td><td>0.0</td><td>Scanner range measurements exceeding the value [m] are ignored for collision detection / bypass route planning. 0.0 = Use values from ros_obst_det_dist / ros_obst_av_max_plan_dist.</td></tr>
<tr><td>ros_obst_av_min_turning_radius</td><td>float</td><td>0.4</td><td>Minimum turning radius for obstacle avoidance V2 routes [m].</td></tr>
<tr><td>ros_obst_av_bypass_trigger_wait_time</td><td>float</td><td>0.0</td><td>How long to wait [s] before triggering bypass route calculation when distance to the obstacle is less than ros_obst_av_bypass_planning_dist.</td></tr>
<tr><td>ros_obst_av_bypass_trigger_reset_time</td><td>float</td><td>0.0</td><td>How long to wait [s] before resetting the bypass route calculation trigger (e.g. if obstacle is detected only momentarily).</td></tr>
<tr><td>ros_obst_av_bypass_planning_dist</td><td>float</td><td>3.0</td><td>How much before the (first) collision point to start looking for bypass route [m] (maximum value). This value should be bigger than ros_obst_av_bypass_start_dist.</td></tr>
<tr><td>ros_obst_av_bypass_start_dist</td><td>float</td><td>1.0</td><td>How much before the (first) collision point to diverge the bypass route from nominal [m] (maximum value).</td></tr>
<tr><td>ros_obst_av_bypass_end_dist</td><td>float</td><td>1.0</td><td>How much after the (last) collision point to merge the bypass route to nominal [m] (minimum value).</td></tr>
<tr><td>ros_obst_av_plan_step_dist</td><td>float</td><td>1.0</td><td>Incremential distance for next planning target after failed one [m].</td></tr>
<tr><td>ros_obst_av_max_plan_dist</td><td>float</td><td>20.0</td><td>How far ahead (along the nominal trajectory) to check collisions and free space for a return point to nominal trajectory [m].</td></tr>
<tr><td>ros_obst_av_max_plan_dist_prioritized</td><td>int</td><td>0</td><td>Prioritize calculating bypass routes directly to the maximum planning distance ahead.</td></tr>
<tr><td>ros_obst_av_min_diverge_dist</td><td>float</td><td>0.3</td><td>Minimum distance to use for suggested diverge point from current AGV location [m].</td></tr>
<tr><td>ros_obst_av_publish_map</td><td>int</td><td>1</td><td>Whether to publish ROS global costmap (for logging purposes). 0 = Disabled, 1 = Only costmap updates, 2 = Full costmap</td></tr>
</tbody></table>
<h2 id="miscellaneous"><a class="header" href="#miscellaneous">Miscellaneous</a></h2>
<h3 id="logging"><a class="header" href="#logging">Logging</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_trigger_pass_to_supervisor</td><td>int</td><td>0</td><td>If set to 1, then fleet control/Monitor log triggers are passed to Supervisor</td></tr>
<tr><td>log_events</td><td>int</td><td>0</td><td>Enables logging of all internal events between different threads.</td></tr>
<tr><td>log_scanner</td><td>int</td><td>0</td><td>Log the laser scanner data details. 5 = max level.</td></tr>
<tr><td>log_correlation</td><td>int</td><td>0</td><td>Log correlation calculations used for localization. 5 = max level.</td></tr>
<tr><td>log_positioning</td><td>int</td><td>0</td><td>Log localization calculations. 5 = max level.</td></tr>
<tr><td>log_deadrec</td><td>int</td><td>0</td><td>Log dead reckoning calculations. 5 = max level.</td></tr>
<tr><td>log_reflector_pos</td><td>int</td><td>0</td><td>Log reflector based localization details. 5 = max level.</td></tr>
<tr><td>log_thrd_localize</td><td>int</td><td>0</td><td>Log state and events of localize thread.</td></tr>
<tr><td>log_sensors</td><td>int</td><td>0</td><td>Enables logging of detailed RLS sensor data.</td></tr>
<tr><td>log_veh_inte_eth</td><td>int</td><td>0</td><td>Log ethernet supervisor message details: 0 = message info, 4 = all bytes.</td></tr>
<tr><td>log_get_traj</td><td>int</td><td>0</td><td>Log trajectory generation details. 3 = max level.</td></tr>
<tr><td>log_can</td><td>int</td><td>0</td><td>Log primary CAN bus details, including all messages bytes. 2 = max level.</td></tr>
<tr><td>log_can2</td><td>int</td><td>0</td><td>Log secondary CAN bus details, including all messages bytes. 2 = max level.</td></tr>
<tr><td>log_can_msgs</td><td>int</td><td>0</td><td>Log parsed and built can message data.</td></tr>
<tr><td>log_bms</td><td>int</td><td>0</td><td>Enables logging of external battery management system related details.</td></tr>
<tr><td>log_motor_controllers</td><td>int</td><td>0</td><td>Log motor controller details.</td></tr>
<tr><td>log_timer_thread</td><td>int</td><td>0</td><td>Enables logging of internal timer details for a specific thread.</td></tr>
<tr><td>log_keyb_ctrl_io</td><td>int</td><td>0</td><td>Enables logging of keyboard control details from Monitor.</td></tr>
<tr><td>log_pos_ini_refl</td><td>int</td><td>0</td><td>Enables logging of reflector-based position initialization details.</td></tr>
<tr><td>log_segparsing</td><td>int</td><td>0</td><td>Enables logging of segment parsing details.</td></tr>
<tr><td>log_pattern_detection</td><td>int</td><td>0</td><td>Enables logging of pattern detection calculation details.</td></tr>
<tr><td>log_pallet_detection</td><td>int</td><td>0</td><td>Enables logging of pallet detection calculation details.</td></tr>
<tr><td>log_speed_limit</td><td>int</td><td>0</td><td>Enables logging of active speed limitations.</td></tr>
<tr><td>log_imu</td><td>int</td><td>0</td><td>Log IMU details. 1 = log details &amp; parsed data, 2 = raw data.</td></tr>
<tr><td>log_racking</td><td>int</td><td>0</td><td>Enables logging of warehouse racking details.</td></tr>
<tr><td>log_driving_with_stop_pts</td><td>int</td><td>0</td><td>Enables logging of driving with stop points details.</td></tr>
<tr><td>log_omni_control</td><td>int</td><td>0</td><td>Log omni control details. 1 = log drive time, 2 = route filtering, 3 = speed limits.</td></tr>
<tr><td>log_can_summary</td><td>int</td><td>0</td><td>Log CAN msg summary. 0 = on ERR condition only, 1 = periodically.</td></tr>
<tr><td>log_ext_target_det</td><td>uint</td><td>0</td><td>Enables logging of external target detection data. 0 - disabled, 1 - enabled</td></tr>
<tr><td>log_dynamic_map</td><td>int</td><td>0</td><td>Log dynamic map - debug version only: 5 = max level.</td></tr>
<tr><td>log_modbus</td><td>int</td><td>0</td><td>Enables logging of parsed and built modbus message data.</td></tr>
<tr><td>log_ext_fleet_control</td><td>int</td><td>0</td><td>Log external fleet control: 0 = disable, 1 = enable, 2 = max amount of details</td></tr>
<tr><td>log_gps</td><td>int</td><td>0</td><td>Log GPS localization details: 0 = disable, 1 = log outputs, 2 = log antenna points, 3 = log messages</td></tr>
<tr><td>log_ext_loc</td><td>int</td><td>0</td><td>Log external localization: 0 = disable, 1 = enable, values 2...3 for more detailed logging with some sensors</td></tr>
<tr><td>log_trailer_transport</td><td>int</td><td>0</td><td>Enables logging of trailer transport details.</td></tr>
<tr><td>log_coupled_drive</td><td>int</td><td>1</td><td>Log coupled drive control details.</td></tr>
<tr><td>log_rtr_generation</td><td>int</td><td>0</td><td>Enables logging of return to route generation.</td></tr>
<tr><td>log_sys_resoures_interval_s</td><td>int</td><td>10</td><td>Time interval [s] to log system resources: 0 = disable</td></tr>
<tr><td>log_ros</td><td>int</td><td>0</td><td>Log ros specific details: 0 = disable, 1 = enable, 2 = log detailed path information</td></tr>
<tr><td>log_obst_detection</td><td>int</td><td>0</td><td>Log obstacle detection: 0 = none, 1 = result line counts, 2 = detailed logging, 3 = log all lines</td></tr>
<tr><td>log_ethercat</td><td>int</td><td>0</td><td>Log EtherCAT communication details: 0 = min level, 3 = max amount of details</td></tr>
<tr><td>log_pointcloud_interface</td><td>int</td><td>0</td><td>Log pointcloud interface: 0 = No, 1 = Basic, 2 = Detailed</td></tr>
<tr><td>log_table_detection</td><td>int</td><td>0</td><td>Log table detection details: 0 = general, 1 = detailed</td></tr>
<tr><td>log_actuators</td><td>int</td><td>0</td><td>Log actuator control details: 0 = general, 1 = detailed</td></tr>
<tr><td>log_profinet</td><td>int</td><td>0</td><td>Log profinet interface details: 0 = general, 1 = detailed, 2 = log binary data</td></tr>
<tr><td>log_docking</td><td>int</td><td>0</td><td>Log docking details: 0 = general, 1 = detailed</td></tr>
<tr><td>log_simove</td><td>int</td><td>0</td><td>Log simove details: 0 = general, 1 = detailed, 2 = all bytes</td></tr>
<tr><td>log_target_detection</td><td>int</td><td>0</td><td>Log target detection details: 0 = general, 1 = detailed</td></tr>
<tr><td>log_blind_driving</td><td>int</td><td>0</td><td>Log blind driving details: 0 = general, 1 = detailed</td></tr>
<tr><td>log_dump_thrmon_txt_log_size</td><td>int</td><td>10</td><td>Size [MB] of text log to dump on thread monitoring error.</td></tr>
<tr><td>log_err_txt_log_dump_size</td><td>int</td><td>50</td><td>Size [MB] of text log to dump on error.</td></tr>
<tr><td>log_loc_log_size</td><td>int</td><td>45</td><td>Size [MB] of localization binary log buffer.</td></tr>
<tr><td>log_pos_cont_log_size</td><td>int</td><td>15</td><td>Size [MB] of position controller binary log buffer.</td></tr>
<tr><td>log_coupled_drive_log_size</td><td>int</td><td>10</td><td>Size [MB] of coupled drive binary log buffer.</td></tr>
<tr><td>log_trajectory_log_size</td><td>int</td><td>10</td><td>Size [MB] of trajectory binary log buffer.</td></tr>
<tr><td>log_cont_log_chunk_size</td><td>int</td><td>30</td><td>Size [MB] of continuous log chunk.</td></tr>
<tr><td>log_cont_log_chunks</td><td>int</td><td>10</td><td>Number of continuous log chunks.</td></tr>
<tr><td>log_long_log_file_size</td><td>int</td><td>10</td><td>Size [MB] of long log file.</td></tr>
<tr><td>log_long_log_files</td><td>int</td><td>0</td><td>Number of long log files.</td></tr>
<tr><td>log_cont_log_when_moving_only</td><td>int</td><td>1</td><td>Defines if continuous log data should be recorded only when moving.</td></tr>
<tr><td>log_cont_log_stopped_timer</td><td>int</td><td>5</td><td>Time [s] to continue logging after stopping.</td></tr>
<tr><td>log_dump_on_error_cooldown_secs</td><td>int</td><td>15</td><td>Minimum cooldown time [s] between dumping automatic error logs.</td></tr>
<tr><td>log_dump_ros_logs</td><td>int</td><td>0</td><td>Defines if ROS logging should be included in Navitrol log file.</td></tr>
<tr><td>log_dump_3d_positioning_logs</td><td>int</td><td>0</td><td>Defines if 3d positioning logging should be included in Navitrol log file.</td></tr>
<tr><td>log_dump_on_estop_max_files</td><td>int</td><td>0</td><td>Maximum number of log files triggered by FSTOP on ESTOP to keep on disk.</td></tr>
<tr><td>log_dump_on_fstop_max_files</td><td>int</td><td>0</td><td>Maximum number of log files triggered by any FSTOP to keep on disk.</td></tr>
<tr><td>log_dump_on_error_max_files</td><td>int</td><td>5</td><td>Maximum number of log files from error dumps to keep on disk.</td></tr>
<tr><td>log_dump_on_specific_errors_only_arr</td><td>int[]</td><td>0</td><td>Trigger automatic error log for defined errors/warnings only: 0 = Not defined</td></tr>
<tr><td>log_dump_on_any_error_max_files</td><td>int</td><td>0</td><td>Maximum number of log files from general error dumps to keep on disk.</td></tr>
<tr><td>log_dump_external_max_files</td><td>int</td><td>10</td><td>Maximum number of log files from external trigger to keep on disk.</td></tr>
<tr><td>log_dump_vdma_max_files</td><td>int</td><td>20</td><td>Maximum number of log files triggered by VDMA to keep on disk.</td></tr>
<tr><td>log_dump_thrmon_max_files</td><td>int</td><td>20</td><td>Maximum number of log files triggered by thread monitoring to keep on disk.</td></tr>
<tr><td>log_dump_remote_mon_max_files</td><td>int</td><td>20</td><td>Maximum number of log files triggered from Monitor/Fleet Control to keep on disk.</td></tr>
<tr><td>log_vehicle_stopped_speed</td><td>float</td><td>0.05</td><td>Stops continuous logging and increases startinfo update interval when AGV's speed is less than the given value [m/s].</td></tr>
<tr><td>logging_rate_warning_limit</td><td>int</td><td>800000</td><td>Amount of characters per second for high logging rate warning to be triggered.</td></tr>
<tr><td>log_to_navigationlog</td><td>int</td><td>0</td><td>Enables logging of position to separate navigation log text file.</td></tr>
<tr><td>log_battery_file_size_mb</td><td>int</td><td>20</td><td>Maximum size [MB] for battery log file.</td></tr>
<tr><td>log_battery_update_interval_ms</td><td>int</td><td>1000</td><td>Interval [ms] for writing a new line to battery log.</td></tr>
<tr><td>log_sensor_fusion</td><td>int</td><td>0</td><td>Log sensor fusion details: 0 = disable, 1 = log location estimates, 2 = log location and velocity, 3 = log all</td></tr>
<tr><td>log_vdma_extra</td><td>int</td><td>0</td><td>Enable extra debug logging by vda5050 related features.</td></tr>
</tbody></table>
<h3 id="system-information-and-configuration"><a class="header" href="#system-information-and-configuration">System information and configuration</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>cpu_core_exclusion_mask</td><td>uint</td><td>0</td><td>CPU core exclusion mask - any bit set means that corresponding CPU core should not be used</td></tr>
<tr><td>overcommit_memory</td><td>int</td><td>2</td><td>overcommit_memory - NOT to be modified without Navitec consultation</td></tr>
<tr><td>overcommit_ratio</td><td>int</td><td>90</td><td>overcommit_ratio - NOT to be modified without Navitec consultation</td></tr>
<tr><td>memory_lock_size_mb</td><td>int</td><td>300</td><td>Minimum amount of RAM memory initially locked; 0 = disable memory locking</td></tr>
<tr><td>syscmd_control</td><td>uint</td><td>0</td><td>Consult SW provider for use cases</td></tr>
<tr><td>syscmd_legacy</td><td>int</td><td>0</td><td>1 = Use old legacy style for system commands - consult SW provider for use cases</td></tr>
<tr><td>beep_mode</td><td>int</td><td>0</td><td>Usage of IPC beeper: 0 = no beeps, 1 = battery low, 2 = battery low &amp; every 10 seconds</td></tr>
<tr><td>min_free_disk_space_mb</td><td>int</td><td>1000</td><td>Minimum available disk space [MB] required when dumping log files or writing teach data.</td></tr>
<tr><td>check_threads_alive_interval</td><td>int</td><td>750</td><td>Interval [ms] for thread alive checking by thread monitoring.</td></tr>
<tr><td>check_threads_alive_interval_ms_high_prio</td><td>int</td><td>1000</td><td>Maximum thread alive update interval [ms] for high priority threads: 0 = disable</td></tr>
<tr><td>check_threads_alive_interval_ms_medium_prio</td><td>int</td><td>2500</td><td>Maximum thread alive update interval [ms] for medium priority threads: 0 = disable</td></tr>
<tr><td>check_threads_alive_interval_ms_low_prio</td><td>int</td><td>5000</td><td>Maximum thread alive update interval [ms] for low priority threads: 0 = disable</td></tr>
<tr><td>threads_alive_shutdown_timeout_ms</td><td>int</td><td>10000</td><td>Maximum time [ms] to wait for non-responsive thread before shutdown: 0 = disable</td></tr>
<tr><td>check_threads_alive_warning_interval</td><td>int</td><td>750</td><td>Maximum time interval [ms] for a thread to report being alive if not blocked. Exceeding this time results in warning on console.</td></tr>
<tr><td>max_thread_check_lag</td><td>int</td><td>750</td><td>Maximum acceptable lag [ms] for thread alive checking by thread monitoring.</td></tr>
<tr><td>socket_max_syn_backlog_size</td><td>int</td><td>5</td><td>Maximum size for SYN backlog size, which is given as argument when starting to listen to a stream.</td></tr>
<tr><td>socket_write_timeout_ms</td><td>int</td><td>200</td><td>Generic maximum acceptable time [ms] for writing data packet to socket.</td></tr>
<tr><td>require_realtime_kernel</td><td>int</td><td>1</td><td>Require realtime kernel to run Navigation SW: 0 = realtime kernel not required, 1 = realtime kernel required.</td></tr>
</tbody></table>
<h3 id="battery-and-charging"><a class="header" href="#battery-and-charging">Battery and charging</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>battery_log_mode</td><td>int</td><td>0</td><td>Log battery details: 0 = disable, 1 = log voltage and driveWheelV, 2 = log percentage and driveWheelV, 3 = SoC + wheelV + current + SoH + status.</td></tr>
<tr><td>battery_level_known</td><td>int</td><td>0</td><td>1 = read battery percentage from external device (motor controller or bms), 0 = calculate it from battery voltage.</td></tr>
<tr><td>battery_alert_from</td><td>int</td><td>0</td><td>Battery Alert Mode: -1 = no alert, 0 = alert from low voltage, 1 = alert from low battery percentage</td></tr>
<tr><td>battery_alert_percentage</td><td>float</td><td>5.0</td><td>Warning is set on low battery level [%] (battery_alert_from = 1).</td></tr>
<tr><td>battery_alert_voltage</td><td>float</td><td>29.5</td><td>Warning is set on low battery voltage (battery_alert_from = 0).</td></tr>
<tr><td>battery_voltage_gain</td><td>float</td><td>0.01</td><td>Gain for filtering battery voltage output.</td></tr>
<tr><td>battery_empty_voltage</td><td>float</td><td>24.0</td><td>Battery level is set to zero when battery voltage is less than empty voltage.</td></tr>
<tr><td>battery_voltage1</td><td>float</td><td>25.4</td><td>Battery level is calculated between 0 and battery_percentage1 when current battery voltage is between battery_empty_voltage and battery_voltage1.</td></tr>
<tr><td>battery_percentage1</td><td>float</td><td>5.0</td><td>Battery level [%] when current battery voltage is at value battery_voltage1.</td></tr>
<tr><td>battery_voltage2</td><td>float</td><td>26.85</td><td>Battery level is calculated between battery_percentage1 and battery_percentage2 when current battery voltage is between battery_voltage1 and battery_voltage2.</td></tr>
<tr><td>battery_percentage2</td><td>float</td><td>60.0</td><td>Battery level [%] when current battery voltage is at value battery_voltage2.</td></tr>
<tr><td>battery_full_voltage</td><td>float</td><td>29.1</td><td>Battery level is calculated between battery_percentage2 and 100% when current battery voltage is between battery_voltage2 and battery_full_voltage</td></tr>
<tr><td>battery_voltage_input_scale</td><td>float</td><td>0.0</td><td>Scale battery voltage input by multiplying with this value. 0 = do not scale.</td></tr>
<tr><td>battery_update_interval_ms</td><td>int</td><td>1000</td><td>Battery value update interval [ms].</td></tr>
<tr><td>battery_high_temperature_warning_limit_C</td><td>int</td><td>0</td><td>If battery temperature [°C] increases over this limit a warning set. 0 = disabled, 127 = max</td></tr>
<tr><td>battery_high_temperature_error_limit_C</td><td>int</td><td>0</td><td>If battery temperature [°C] increases over this limit an error set. 0 = disabled, 127 = max</td></tr>
<tr><td>battery_overtemperature_drive_dist</td><td>float</td><td>0.0</td><td>Defines the overtemperature emergency drive distance [m]. Smaller than 0.2 = disabled.</td></tr>
<tr><td>battery_overtemperature_drive_max_v</td><td>float</td><td>0.4</td><td>The maximum drive speed [m/s] when driving forward from the resource after the unload.</td></tr>
<tr><td>charging_cmd_source</td><td>int</td><td>1</td><td>Source of charging request: 0 = disabled, 1 = fleet control, 2 = opportunity charging, 3 = external source, 4 = project specific</td></tr>
<tr><td>charging_opp_min_at_charger_timer_ms</td><td>int</td><td>3000</td><td>Timer [ms] for opportunity charging which defines how long vehicle has to stay in charging station before charging is requested.</td></tr>
<tr><td>charge_request_interval_ms</td><td>int</td><td>1000</td><td>Charger request interval [ms].</td></tr>
<tr><td>charging_prevents_driving</td><td>int</td><td>1</td><td>When charging is active: 0 = driving allowed, 1 = driving preventented with soft stop.</td></tr>
<tr><td>charging_collector_arm_extend_option</td><td>int</td><td>0</td><td>Onboard charger collector arm extend options. 0 = extend one side only, 1 = extend two sides separately.</td></tr>
<tr><td>extbatt_if_type</td><td>int</td><td>-1</td><td>Battery managment system type: -1 = disabled, 0 = MasterVolt, 1 = SL BMS, 2 = Jungheinrich, 3 = RoboteQ, 4 = Voltabox, 5 = Ethernet Supervisor (min ver 4), 6 = MEB battery, 7 = JLN, 8 = Wiferion</td></tr>
<tr><td>extbatt_if_max_interval_ms</td><td>int</td><td>10000</td><td>Maximum update interval [ms].</td></tr>
</tbody></table>
<h3 id="licensing"><a class="header" href="#licensing">Licensing</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>license_server_addr</td><td>string</td><td></td><td>License server url/address</td></tr>
<tr><td>license_warning_period_days</td><td>int</td><td>14</td><td>Set warning time [days] for license expiry; 0 = No warning, &gt;0 = Set warning corresponding number of days before license expires</td></tr>
</tbody></table>
<h3 id="miscellaneous-1"><a class="header" href="#miscellaneous-1">Miscellaneous</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>worker_core_exclusion_mask</td><td>uint</td><td>0</td><td>CPU core exclusion mask for localize worker threads - any bit set means that corresponding CPU core should not be used</td></tr>
<tr><td>abort_on_thread_freeze</td><td>int</td><td>0</td><td>Instantly abort on thread freeze</td></tr>
<tr><td>worker_thread_priority_override</td><td>int</td><td>-1</td><td>Override worker thread priority</td></tr>
<tr><td>dds_pointcloud2_topic_name</td><td>string[]</td><td></td><td></td></tr>
<tr><td>dds_enabled</td><td>int</td><td>0</td><td>Enables fastdds communication</td></tr>
<tr><td>raw_rpm_treshold_for_speed_zeroing</td><td>int</td><td>30</td><td>Motor revolution values below the treshold are zeroed to prevent position creeping caused by flickering values from sensorless motor drives</td></tr>
<tr><td>kinematics_curv_to_steer_k_arr</td><td>float[]</td><td>0.0</td><td>Kinematic model coefficients for curvature to steer angle ref calculation. Index corresponds to the order of polynomial coefficient.</td></tr>
<tr><td>production_req_type_stby</td><td>int</td><td>0</td><td>Production request action to take when released from hold into standby: 0 = no action, 1 = into production, 2 = out of production, 3 = pause production</td></tr>
<tr><td>production_req_type_auto</td><td>int</td><td>0</td><td>Production request action to take when released from hold into auto mode: 0 = no action, 1 = into production, 2 = out of production, 3 = pause production</td></tr>
<tr><td>blind_driving_enabled</td><td>int</td><td>0</td><td>Enables blind driving feature.</td></tr>
<tr><td>blind_driving_sensor_pos_x_arr</td><td>float[]</td><td>0.0</td><td>Blind driving sensors' lengthwise mounting positions [m] relative to the navigation point. Positive towards the front of the machine.</td></tr>
<tr><td>blind_driving_sensor_pos_y_arr</td><td>float[]</td><td>0.0</td><td>Blind driving sensors' widthwise mounting positions [m] relative to the navigation point. Positive towards the left side of the machine.</td></tr>
<tr><td>blind_driving_sensor_pos_h_deg_arr</td><td>float[]</td><td>0.0</td><td>Blind driving sensors' mounting angles [deg] relative to the navigation point. Positive counter clockwise. Zero at positive x axle.</td></tr>
<tr><td>blind_driving_dist_meas_min_val_arr</td><td>float[]</td><td>0.0</td><td>The minimum distance measurement [m] from blind driving sensor to be considered valid. 0.0 = Not used.</td></tr>
<tr><td>blind_driving_dist_meas_max_val_arr</td><td>float[]</td><td>0.0</td><td>The maximum distance measurement [m] from blind driving sensor to be considered valid. 0.0 = Not used.</td></tr>
<tr><td>route_free_navigation_enabled</td><td>int</td><td>0</td><td>Enable the route-free navigation feature</td></tr>
<tr><td>route_free_navigation_end_straight_dist</td><td>float</td><td>0.3</td><td>Plan this long [m] straight segment to the end of route-free navigation to help it reach the target with correct heading.</td></tr>
<tr><td>route_free_navigation_velocity</td><td>float</td><td>0.3</td><td>Maximum velocity [m/s] during the route-free navigation when not otherwise specified by th command</td></tr>
<tr><td>route_free_navigation_set_rtr_bit</td><td>int</td><td>1</td><td>Enables sending of \</td></tr>
<tr><td>ignore_env_seg_machine_type</td><td>int</td><td>0</td><td>Ignore machine type mismatch for environment and segment files.</td></tr>
<tr><td>circbuf_write_max_wait_ms</td><td>int</td><td>20</td><td>Defines a timeout for trying to write to a circular buffer.</td></tr>
<tr><td>navithor_load_status_reset_on_pickup_dropoff_abort</td><td>int</td><td>0</td><td>0 = navithor load status is not changed on aborted pickup/dropoff, 1 = navithor load status is reset to value it was before pickup/dropoff if pickup/dropoff is aborted</td></tr>
<tr><td>blink_ahead_min_dist</td><td>float</td><td>1.0</td><td>Defines the minimum distance ahead of the curve where the blinker is activated.</td></tr>
<tr><td>blink_curvature</td><td>float</td><td>0.5</td><td>Defines how sharp curves shall activate the blinking, curvature=1/radius.</td></tr>
<tr><td>blink_ahead_gain</td><td>float</td><td>2.0</td><td>Speed factor [s] extending the distance ahead of the curve where the blinker is activated. distance = speed x blink_ahead_gain.</td></tr>
<tr><td>odometry_source</td><td>int</td><td>ODOMETRY_SOURCE_UNDEFINED</td><td>Primary communication interface for machine control and odometry. Needs to be defined if several interfaces are used. 0 = Undefined, 1 = CAN, 2 = Ethernet, 3 = EtherCAT, 4 = Serial, 5 = SIMOVE</td></tr>
<tr><td>physical_binary_inputs_n</td><td>int</td><td>0</td><td>Number of physical (or mapped IO inside Navigation SW) binary inputs.</td></tr>
<tr><td>physical_integer_inputs_n</td><td>int</td><td>0</td><td>Number of physical (or mapped IO inside Navigation SW) integer inputs.</td></tr>
<tr><td>physical_float_inputs_n</td><td>int</td><td>0</td><td>Number of physical (or mapped IO inside Navigation SW) float inputs.</td></tr>
<tr><td>physical_binary_outputs_n</td><td>int</td><td>0</td><td>Number of physical (or mapped IO inside Navigation SW) binary outputs.</td></tr>
<tr><td>physical_integer_outputs_n</td><td>int</td><td>0</td><td>Number of physical (or mapped IO inside Navigation SW) integer outputs</td></tr>
<tr><td>physical_float_outputs_n</td><td>int</td><td>0</td><td>Number of physical (or mapped IO inside Navigation SW) float outputs.</td></tr>
<tr><td>use_virtual_io</td><td>int</td><td>0</td><td>Enables transmitting custom inputs between supervisor and MES interfaces trough Navitrol and Navithor.</td></tr>
<tr><td>virtual_binary_outputs_n</td><td>int</td><td>0</td><td>Number of virtual binary outputs.</td></tr>
<tr><td>virtual_integer_outputs_n</td><td>int</td><td>0</td><td>Number of virtual integer outputs.</td></tr>
<tr><td>virtual_float_outputs_n</td><td>int</td><td>0</td><td>Number of virtual float outputs.</td></tr>
<tr><td>simulate_ideal</td><td>int</td><td>0</td><td>0 = Calculate noise using other simulate parameters to modify input, 1 = ideal simulation (input follows output).</td></tr>
<tr><td>simulate_noise_level_speed</td><td>float</td><td>0.0</td><td>Random noise level in simulated speed measurements.</td></tr>
<tr><td>simulate_noise_level_steer</td><td>float</td><td>0.0</td><td>Random noise level in simulated steering angle measurements.</td></tr>
<tr><td>simulate_low_pass_coeff</td><td>float</td><td>1.0</td><td>Low pass filtering coeff for new measurement: 1.0 = no filtering</td></tr>
<tr><td>simulate_write_ref_out</td><td>int</td><td>0</td><td>Defines how references are writen in simulation: 0 = Do not write references out, 1 = Write references out.</td></tr>
<tr><td>simulate_pc_predict_ms</td><td>int</td><td>40</td><td>In simulation the motor controller delay from output value change to change in feedback.</td></tr>
<tr><td>simulate_scanners</td><td>int</td><td>0</td><td>Enable simulation of scanner measurements even when not running SW in simulation mode.</td></tr>
<tr><td>pointcloud_gen_inte_mode</td><td>int</td><td>0</td><td>Generic pointcloud interface: 0 = not used, 1 = start as server, 2 = start as client.</td></tr>
<tr><td>pointcloud_gen_inte_addr</td><td>string</td><td>127.0.0.1:5555</td><td>Generic pointcloud interface IP address and port (IP:port).</td></tr>
<tr><td>cleaning_machine_left_whisker_speed_RPM</td><td>int</td><td>0</td><td>Cleaning machine left whisker speed in RPM. matches to can_actuator_ctrl_node_id[0] nodeId</td></tr>
<tr><td>cleaning_machine_right_whisker_speed_RPM</td><td>int</td><td>0</td><td>Cleaning machine right whisker speed in RPM. matches to can_actuator_ctrl_node_id[1] nodeId</td></tr>
<tr><td>cleaning_machine_roller_speed_RPM</td><td>int</td><td>0</td><td>Cleaning machine roller speed in RPM. matches to can_actuator_ctrl_node_id[2] nodeId</td></tr>
<tr><td>cleaning_machine_used</td><td>int</td><td>0</td><td>Enables cleaning machine functionality (actuator control).</td></tr>
<tr><td>error_override_id</td><td>int[]</td><td>-1</td><td>The error/warning id which its severity level needs to be raised. -1 = no error id (default value)</td></tr>
<tr><td>error_override_level</td><td>int[]</td><td>0</td><td>The raised severity level of the corresponding error/warning. 0 = default level, 1 = warning level, 2 = error level, 3 = fatal error</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="json-configuration-file"><a class="header" href="#json-configuration-file">JSON Configuration File</a></h1>
<p>Updated 24.06.2024</p>
<h2 id="overview-4"><a class="header" href="#overview-4">Overview</a></h2>
<p>There are two approaches to specify the configurations of an AGV. The primary and widely used method involves specifying the parameters within the <code>params.txt</code> file. However, as Navitrol's complexity grows, the need for a more structured and modular way has arisen. This necessity leads to devising a new approach by using the JSON file format. The JSON file format improves the readability and modularity of the configurations, but it currently supports only a limited set of parameters.</p>
<hr />
<h2 id="setup-2"><a class="header" href="#setup-2">Setup</a></h2>
<p>The path dedicated for the JSON configuration file is <code>configuration/config.json</code>. If this file is provided, its parameters will have a higher priority compared to <code>params.txt</code>, and override those parameters. Otherwise, if the file is not provided, a template JSON file will be generated in <code>configuration/config.json.template</code> with default values. The same as <code>params.txt</code>, JSON configuration file will be taken into account at the start or when the parameters are reloaded.</p>
<hr />
<h2 id="structure"><a class="header" href="#structure">Structure</a></h2>
<p>The structure of the JSON configuration file follows the standard format. It contains one main object, which is called the root object. Each object in the JSON file represents a module or a coherent abstract concept by a set of key-value pairs. The keys are of type string and the values can be Boolean, number, string, array, or another object. The order of the keys is not important, and the parameters correspond to the missing keys won't be reconfigured by the process of reading the JSON file. Also, the keys are case-sensitive, but whitespaces are ignored (except for the string values) which means arbitrary amount spaces, tabs, and newlines can be used to format the file. Moreover, in case of duplicate keys, the last key-value pair will be considered.</p>
<p>All objects share the <code>comment</code> key, which can be used to provide a description of the object or any comment that is relevant to the object. The <code>comment</code> key does not affect the behavior of the system and is ignored. An example of the JSON configuration file is shown below:</p>
<pre><code class="language-json">{
  &quot;comment&quot;: &quot;This is an example of the JSON configuration file&quot;,

  &quot;Error Configuration&quot;: {
    &quot;comment&quot;: &quot;This object contains the error configurations&quot;,
    &quot;DisableDefaultAutomaticLogging&quot;: false,
    &quot;TakeAutomaticNavitrolLog&quot;: [666, 878],
    &quot;DisableAutomaticNavitrolLog&quot;: [123],
    &quot;Request3DPositioningBinaryLog&quot;: [878]
    &quot;IncreaseToError&quot;: [123],
    &quot;IncreaseToFatalError&quot;: [223],
  }
}
</code></pre>
<p>As mentioned earlier, the JSON configuration file provides a hierarchical modular structure to define the configuration. The following sections describe the supported sub-entities of the root object.</p>
<h3 id="error-configuration"><a class="header" href="#error-configuration">Error Configuration</a></h3>
<p>Using <code>Error Configuration</code> object, we can override the default error configurations. The following keys are supported:</p>
<ul>
<li><code>DisableDefaultAutomaticLogging</code>: A Boolean value to disable the default automatic logging of errors. The default value is <code>false</code>.</li>
<li><code>TakeAutomaticNavitrolLog</code>: An array of error IDs to trigger automatic Navitrol logging. If an error corresponding to one of those IDs is raised, the logging process will automatically be triggered. The default value is an empty array.</li>
<li><code>DisableAutomaticNavitrolLog</code>: An array of error IDs to prevent automatic Navitrol logging. The logging process will not be triggered for those error IDs. The default value is an empty array.</li>
<li><code>Request3DPositioningBinaryLog</code>: An array of error IDs to provide 3D positioning binary data in their log. If any of those errors is raised, <strong>in the logging process</strong>, binary log related to 3D positioning will also be collected. The default value is an empty array.</li>
<li><code>IncreaseToError</code>: An array of warning IDs to override their severity level to error. The default value is an empty array.</li>
<li><code>IncreaseToFatalError</code>: An array of error/warning IDs to override their severity level to fatal. The default value is an empty array.</li>
</ul>
<p>By default, logging process will be triggered automatically for some error IDs. You can set <code>DisableDefaultAutomaticLogging</code> to <code>true</code>, in order to disable the default automatic logging. To explicitly specify the error IDs that should trigger logging or prevent it, the <code>TakeAutomaticNavitrolLog</code> or <code>DisableAutomaticNavitrolLog</code> key can be used, respectively. The behavior specified by those two parameters overrides the default behavior. In other words, if some error ID is specified in <code>TakeAutomaticNavitrolLog</code> list, logging process will be triggered for that error, irrespective of the default behavior for that error ID or the value of <code>DisableDefaultAutomaticLogging</code>. The same is true for <code>DisableAutomaticNavitrolLog</code> parameter. The priority of <code>TakeAutomaticNavitrolLog</code> is higher for the error IDs that are presented in both lists. Moreover, To collect 3D positioning binary data in the log for specific error IDs, you can use <code>Request3DPositioningBinaryLog</code> key.</p>
<p>If you want to increase the severity level of some warning/error IDs to error or fatal, the <code>IncreaseToError</code> or <code>IncreaseToFatalError</code> keys can be used, respectively. It is worth mentioning that the severity level of errors won't be decreased.</p>
<h3 id="vda5050-1"><a class="header" href="#vda5050-1">VDA5050</a></h3>
<p>The VDA5050 object can be used to configure the <a href="Introduction/Parameters/../../DriveControl/VDA5050/VDA5050-en.html">VDA5050 interface</a>. Action criticality is the only configurable feature currently. It can be configured like this:</p>
<pre><code class="language-json">{  
  &quot;VDA5050&quot;: {
    &quot;actions&quot;: {
      &quot;pick&quot;: {
        &quot;critical&quot;: false
      }
    }
  }
}

</code></pre>
<p>This example JSON would configure the pick action to not be considered critical.</p>
<h3 id="load-handling-configuration"><a class="header" href="#load-handling-configuration">Load handling configuration</a></h3>
<p>Please contact <a href="https://navitecsystems.com/">Navitec Systems</a> for further information of setuping &amp; configuring the drop or pick sequences with JSON.</p>
<hr />
<h2 id="troubleshooting-3"><a class="header" href="#troubleshooting-3">Troubleshooting</a></h2>
<p>If the desired configuration is not achieved, please make sure that the JSON configuration file is in the correct path (i.e., <code>configuration/config.json</code>), and the file is in the correct format. If the JSON configuration file is not provided, a template JSON file will be generated in <code>configuration/config.json.template</code> with default values. If the JSON configuration file is provided, but the file is not in the correct format, the <code>ERROR_PARAM_PARSE</code> error will be raised. If the JSON configuration file is loaded successfully, it overrides the related parameters in the <code>params.txt</code> file.</p>
<p>Additionally, the other reason that some configurations might not be applied, is the presence of duplicate keys in the JSON configuration file; in this case, the last key-value pair will be considered.</p>
<p>To diagnose an issue, you can check the Navitrol log file. Log lines with <code>JSON Configuration</code> prefix are related to the JSON configuration file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="teaching-instructions"><a class="header" href="#teaching-instructions">Teaching Instructions</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-5"><a class="header" href="#overview-5">Overview</a></h2>
<h3 id="introduction-3"><a class="header" href="#introduction-3">Introduction</a></h3>
<p><em>Teaching</em> is a process of recording information from the AGV's sensors such as laser scanners and PGV cameras and storing the information in a format that can be used to create an environment model in which the AGV can navigate accurately. In Navitrol the result of teaching is a teach file that can be imported to Navithor Tools software for further refinement. One environment model can be created from a single teach file or by combining the information from multiple teach files. This document describes the best practices and practical hints for teaching and editing production area to generate a map for Navitrol positioning. There are separate documents for <a href="Introduction/TeachingInstructions/../../Localization/GpsPositioning/GpsPositioning-en.html">GPS positioning</a> and <a href="Introduction/TeachingInstructions/../../Localization/ExternalLocalization/ExternalLocalization-en.html">external localization</a>.</p>
<p>Teaching starts with driving the AGV manually through the production area in teaching mode. Teaching is stopped after driving, and teach file is stored on the Navigation computer. Teaching can be repeated as many times as necessary to map the whole production area. After the teach files are generated, Navithor tools software is used to build a map of the production area.</p>
<p>Teaching process is described step by step in the next chapter, and further guidelines for teaching and matching large areas are provided in the later chapters.</p>
<p>In a simple area this procedure is simple and straight forward but when the area gets bigger and more complex, some best practices are needed.</p>
<p>Creating a map from the teach files is called <em>matching</em>. Navithor Tools documentation explains matching in more detail. Still, as teaching and matching are tightly related to each other and the map making process, some matching tips are given at the example at the end of this document.</p>
<h3 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h3>
<ul>
<li>Navitrol installed on the AGV</li>
<li>Software to control teaching
<ul>
<li><a href="Introduction/TeachingInstructions/../../CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#navitrol-menu">Navitrol Monitor</a>,</li>
<li><a href="Introduction/TeachingInstructions/../../CustomerUis/WebInterface/WebInterface-en.html">Navitrol web interface</a>, or</li>
<li>Supervisor for starting and stopping the teaching using message 1004 - Start/Stop teaching</li>
</ul>
</li>
<li>The area to teach is cleaned up so that the AGV's scanners can see static objects clearly from the path the AGV will be driving. Static objects are for example the walls and pillars in the facility and everything that is bolted down to the floor. If possible, all non static things should be moved away from the area to be taught.</li>
<li><ins>AGV must be well calibrated</ins>
<ul>
<li>For teaching a calibration / testing area scanner calibration is enough</li>
<li>For teaching a production area the AGV must be fully calibrated</li>
<li>Take a look at the <a href="Introduction/TeachingInstructions/../InitialCalibrationGuide/InitialCalibrationGuide-en.html">calibration instructions</a> if you are unsure if the AGV is good enough for use in teaching.</li>
</ul>
</li>
</ul>
<h2 id="setup-3"><a class="header" href="#setup-3">Setup</a></h2>
<p>Default parameters should work nicely for teaching. Default values are used if parameters are not found in the parameter file. Parameters that affect teaching are:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>teach_file_format</td><td>int</td><td>5</td><td>Saved teach file format version for backward compatibility. Do not add to the parameter file unless instructed to. <br/>1 = Legazy format, <br/>2 = Support for new segment files (Tools 1.0.9.6), <br/>3 = Support for high resolution reflector data (Tools 2.01), <br/>4 = Support for array parameters (Tools 2.20), <br/>5 = support for external localization (Tools 2.5X)</td></tr>
<tr><td>min_free_disk_space_mb</td><td>int</td><td>1000</td><td>Minimum available disk space required when dumping log files or writing teach data. Can be adjusted based on user preferences. WARNING_NOT_ENOUGH_FREE_SPACE will be set if there is less than defined available space remaining.</td></tr>
</tbody></table>
<h2 id="how-to-use-1"><a class="header" href="#how-to-use-1">How to use</a></h2>
<h3 id="teaching-steps"><a class="header" href="#teaching-steps">Teaching steps</a></h3>
<ol>
<li>Clear the teach area from dynamic environment</li>
<li>Drive the AGV to the desired starting location</li>
<li>Enable teaching mode
<ul>
<li>Teaching mode requires that Navitrol is running.</li>
<li>Teaching mode can be turned on using the web interface, Navitrol Monitor or supervisor message 1004.</li>
<li>When teaching mode is on Navitrol will show a warning WARNING_TEACH_MODE_ENABLED</li>
</ul>
</li>
<li>Teach the environment by driving the AGV manually
<ul>
<li>Follow <a href="Introduction/TeachingInstructions/TeachingInstructions-en.html#teaching-calibration-environment">Teaching calibration environment</a> or <a href="Introduction/TeachingInstructions/TeachingInstructions-en.html#teaching-production-environment">Teaching production environment</a> instructions depending which one you are about to teach</li>
<li>Driving can be done using the web interface joystick or the AGV's own joystick. Navitrol Monitor keyboard control should be used only as a last resort if no other means of driving the AGV are available.</li>
</ul>
</li>
<li>Stop teaching</li>
<li>Import the teach files to Tools
<ul>
<li>See, <a href="Introduction/TeachingInstructions/TeachingInstructions-en.html#how-to-find-teach-files">How to find teach files</a></li>
</ul>
</li>
</ol>
<h3 id="how-to-find-teach-files"><a class="header" href="#how-to-find-teach-files">How to find teach files</a></h3>
<p>Navitrol saves the teach file when teach mode is turned off. All teach files are stored on the IPC in folder /home/navitec/teach and they can be taken from there either using Navithor Tools, SCP client or <a href="Introduction/TeachingInstructions/../../Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html#samba-for-transferring-files">Samba</a>.</p>
<p>The recommended way to get the teach files is to download them using Navithor Tools. This also automatically adds the teach files into your Tools project.</p>
<h3 id="teaching-calibration-environment"><a class="header" href="#teaching-calibration-environment">Teaching calibration environment</a></h3>
<p>The calibration environment is an area where the AGV will be calibrated, tested and fine tuned. Typically such an environment is a relatively small rectangular room with clear straight walls. See <a href="Introduction/TeachingInstructions/../InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial Calibration Guide</a> for more information about calibration.</p>
<ol>
<li>Check that the scanners are calibrated</li>
<li>Clear the area so the scanners can see the walls and corners</li>
<li>Drive the AGV to one end of the room</li>
<li>Start teaching</li>
<li>Drive straight forward (for about 10 meters)
<ul>
<li>It is essential to drive straight as possible to minimize odometry error, as odometry has not been calibrated yet</li>
</ul>
</li>
<li>End teaching</li>
</ol>
<h3 id="teaching-production-environment"><a class="header" href="#teaching-production-environment">Teaching production environment</a></h3>
<p>The production environment is an area where the AGVs will navigate while performing production orders.</p>
<ol>
<li><ins>Plan the way the area will be taught.</ins> Remember that the information the AGV gathers during teaching will be used later on in the navigation. If you have not taught an area before, read this document carefully before continuing with the teach process. Here is a short list of things to take into consideration:
<ul>
<li>Drive the same way as the AGV will drive when it is executing tasks.</li>
<li>Laser scanners have a limited view which is important to understand when teaching.
<ul>
<li>The goal is for each scanner to see as much static environment as possible</li>
</ul>
</li>
<li>As a rule of thumb, it is easier to do longer teach drives and have fewer files than have several small teach files.
<ul>
<li>For large production environments, it is recommend to teach one room / corridor at a time as odometry error typically accumulates over long teach drives. This can make matching harder. If you face this issue it is recommended to teach the environment in smaller pieces.</li>
</ul>
</li>
</ul>
</li>
<li><ins>Take the AGV into the starting position for teaching.</ins> Good places to start are usually the main aisles that can be driven around the whole warehouse or production facility.</li>
<li>When the AGV is in place facing to the correct direction <ins>turn on the teaching mode.</ins></li>
<li><ins>Drive the AGV calmly and as straight as possible according to your plan.</ins> 
<ul>
<li>Remember that the goal is that the scanners see all static environment necessary for navigation during the teaching.</li>
</ul>
</li>
<li>After you have finished driving either by arriving to a dead end or by arriving to the place where you started <ins>turn off the teach mode</ins></li>
</ol>
<p>Teaching can be done in one or several drives. The number of drives required depends on the availability and complexity of the production area.</p>
<h3 id="example-of-teaching-warehouse"><a class="header" href="#example-of-teaching-warehouse">Example of teaching warehouse</a></h3>
<p>In this example the warehouse is so large that scanners cannot see from one side of the room to another. Because the scanners cannot see the whole room at once the data must be aligned by matching the same features from multiple teach runs.</p>
<h4 id="teaching-plan-and-execution"><a class="header" href="#teaching-plan-and-execution">Teaching plan and execution</a></h4>
<p>Here is a recommended order to teach the example layout.</p>
<p><img src="Introduction/TeachingInstructions/./media-en/outer-teach-path.png" alt="" /></p>
<blockquote>
<p>Teach outer limits first as a closed loop</p>
</blockquote>
<p>When teaching closed loops, it is recommended to teach the area so that beginning and end of the loop are visible in the same teach file.</p>
<p><img src="Introduction/TeachingInstructions/./media-en/inner-teach-path.png" alt="" /></p>
<blockquote>
<p>Then teach the spaces between the racks</p>
</blockquote>
<h4 id="matching-the-teach-data-in-large-room"><a class="header" href="#matching-the-teach-data-in-large-room">Matching the teach data in large room</a></h4>
<p>Start the matching from the outer limits first and then match the inner path to the outer limits.</p>
<p>Matching is usually done with following steps:</p>
<ul>
<li>Matching the closed loop. Quick explanation <a href="Introduction/TeachingInstructions/TeachingInstructions-en.html#matching-the-closed-loops">below</a>.</li>
<li>Finalizing the outer limit measurements.</li>
<li>Inter matching inner path one aisle at the time.</li>
<li>Matching the aisle from ends to the finalized measurements.</li>
</ul>
<h4 id="matching-the-closed-loops"><a class="header" href="#matching-the-closed-loops">Matching the closed loops</a></h4>
<p>Closed loops are matched in following steps:</p>
<ul>
<li>Intermatch the measurements at the whole area</li>
<li>Match the beginning of the loop to the CAD (if CAD available)</li>
<li>Finalize the measurements at the beginning of the loop</li>
<li>Match the end of the loop to the finalized measurements</li>
</ul>
<h2 id="troubleshooting-4"><a class="header" href="#troubleshooting-4">Troubleshooting</a></h2>
<h3 id="most-common-issues-1"><a class="header" href="#most-common-issues-1">Most common issues</a></h3>
<h4 id="teach-file-is-not-generated"><a class="header" href="#teach-file-is-not-generated">Teach file is not generated</a></h4>
<p>In case you can't find the teach file after teaching make sure that:</p>
<ul>
<li>Teaching was on during the teaching (WARNING_TEACHING_MODE_ENABLED visible in Monitor)</li>
<li>Teaching has been stopped.</li>
<li>There is enough space on the hard drive.</li>
</ul>
<h4 id="automatic-matching-can-not-correct-the-errors-from-the-teach-file"><a class="header" href="#automatic-matching-can-not-correct-the-errors-from-the-teach-file">Automatic matching can not correct the errors from the teach file</a></h4>
<p>This is usually a sign of poor calibration or wheel slipping. To solve this you should teach the area again after verifying the AGVs calibration. During your new teach try to drive slower and minimize turning as turns induce usually the most error in the odometry.</p>
<h3 id="errors-and-warnings-2"><a class="header" href="#errors-and-warnings-2">Errors and warnings</a></h3>
<h4 id="305---warning_teaching_already_on"><a class="header" href="#305---warning_teaching_already_on">305 - WARNING_TEACHING_ALREADY_ON</a></h4>
<p>This warning is briefly set on in case teaching mode is already on when some source tries to set the teaching mode on.</p>
<h4 id="317----warning_teach_mode_enabled"><a class="header" href="#317----warning_teach_mode_enabled">317 -  WARNING_TEACH_MODE_ENABLED</a></h4>
<p>This warning is set on when the teaching mode is on.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-of-navitrol-features-affected-when-receiving-the-drive-orders-from-different-sources"><a class="header" href="#overview-of-navitrol-features-affected-when-receiving-the-drive-orders-from-different-sources">Overview of Navitrol features affected when receiving the drive orders from different sources.</a></h1>
<p>Updated 24.07.2024</p>
<hr />
<h2 id="features-affected-based-on-the-drive-order-source"><a class="header" href="#features-affected-based-on-the-drive-order-source">Features affected based on the drive order source.</a></h2>
<p>Navitrol can receive the drive order with the expected path from different sources: Supervisor interface for standalone applications, Navithor or VDA 5050 interface. The general rule is that localization related features are not affected by the drive order source, but anything related to driving the AGV or controlling the actuators can be. There are also differences within the VDA 5050 version and drive order type, these can be checked in detail from <a href="Introduction/FeatureMatrix/../../DriveControl/VDA5050/VDA5050FeatureMatrix-en.html">VDA feature matrix</a>. Below is a table which shows common Navitrol features and if they are supported by the different drive order source.</p>
<h3 id="localization-features"><a class="header" href="#localization-features">Localization features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Standalone</th><th align="center">Navithor</th><th align="center">VDA 5050</th></tr></thead><tbody>
<tr><td align="center">Precision positioning</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Ramp zones</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Dynamic mapping</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">GPS</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">IMU and sensor fusion</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">External localization</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">3D Positioning</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
</tbody></table>
<h3 id="drive-control-features"><a class="header" href="#drive-control-features">Drive control features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Standalone</th><th align="center">Navithor</th><th align="center">VDA 5050</th></tr></thead><tbody>
<tr><td align="center">Speed on route</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Omni frame heading</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Pivoting</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Custom route properties</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">DMC Docking</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Magnetic line following</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Obstacle avoidance</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">❌</td></tr>
<tr><td align="center">Synchronized driving</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">❌</td></tr>
<tr><td align="center">Return to route</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Barrier stop</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Route Free Navigation</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">❌</td></tr>
</tbody></table>
<h3 id="actuator-control-features"><a class="header" href="#actuator-control-features">Actuator control features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Standalone</th><th align="center">Navithor</th><th align="center">VDA 5050</th></tr></thead><tbody>
<tr><td align="center">Pickup from floor / default height</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Pickup from different heights at different locations</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Pallet detection</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Buffer lanes</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Block stacking</td><td align="center">❌</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Racking</td><td align="center">❌</td><td align="center">✔️</td><td align="center">✔️</td></tr>
</tbody></table>
<h3 id="miscellaneous-features"><a class="header" href="#miscellaneous-features">Miscellaneous features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Standalone</th><th align="center">Navithor</th><th align="center">VDA 5050</th></tr></thead><tbody>
<tr><td align="center">Parameter zones</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Charging</td><td align="center">✔️</td><td align="center">✔️</td><td align="center">❌</td></tr>
</tbody></table>
<p>* Not supported by all VDA versions and drive order types</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supported-devices"><a class="header" href="#supported-devices">Supported devices</a></h1>
<p>Updated 13.09.2024</p>
<hr />
<h2 id="general"><a class="header" href="#general">General</a></h2>
<p>This document lists all devices that are compatible with Navitrol navigation software.</p>
<p>Support for a non-compatible device will require custom development.</p>
<h2 id="can-cards"><a class="header" href="#can-cards">CAN cards</a></h2>
<p>A CAN card must be installed to the navigation IPC to connect Navitrol to a CAN Bus.</p>
<p><strong>Models:</strong></p>
<ul>
<li>Kvaser</li>
<li>Peak</li>
<li>SocketCAN
<ul>
<li>Any hardware supporting SocketCAN</li>
</ul>
</li>
</ul>
<h2 id="motor-controllers"><a class="header" href="#motor-controllers">Motor controllers</a></h2>
<p>Motor controller support depends on the kinematic type of the AGV. For example, if a motor controller works with an omni drive, it won't necessarily work with a differential drive. However, adding support for a new kinematic type is typically much easier than creating support for controller not listed here.</p>
<h3 id="schwarzmueller"><a class="header" href="#schwarzmueller">Schwarzmueller</a></h3>
<p>A Navitec standard motor controller for AGV purposes. The performance has been good and reliable in multiple projects.</p>
<p>Suitable for big and medium sized AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>MIxx</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff drive</li>
<li>Steer drive</li>
<li>Omni drive</li>
<li>Mecanum drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>Reference controlled hydraulic actuator</li>
<li>Reference controlled rotating actuator</li>
</ul>
<h3 id="engel"><a class="header" href="#engel">Engel</a></h3>
<p>An integrated motor controller. Not recommended as it does not have safety logic in case of communication failure.</p>
<p>Suitable for small and medium sized AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>HFI series</li>
<li>Note - Other models might work but they have not been tested</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Drive motor for steer drive in combination of Schwarzmueller for steering</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="nanotec-1"><a class="header" href="#nanotec-1">Nanotec</a></h3>
<p>A reliable motor controller. Can have integrated or separate driver.</p>
<p>Suitable for small and medium sized AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>PD2-C</li>
<li>PD4-C</li>
<li>PD6-C</li>
<li>N5-X-2</li>
<li>Note - Other models might work but they have not been tested</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff drive</li>
<li>Mecanum drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="roboteq-1"><a class="header" href="#roboteq-1">Roboteq</a></h3>
<p>A good motor controller for various range of power and motor types.</p>
<p>Suitable for small, medium and big sized AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CAN</li>
<li>Serial USB/RS232 (open loop)
<ul>
<li>Not recommended for production use due to insufficient signal noise immunity</li>
</ul>
</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>All models with a CAN or serial interface</li>
</ul>
<p><strong>Supported kinematics for open loop:</strong></p>
<ul>
<li>CAN dual channel controller
<ul>
<li>Diff drive</li>
<li>Steer drive</li>
<li>Steer drive with a differential sub unit</li>
<li>Omni drive</li>
<li>Mecanum drive</li>
</ul>
</li>
<li>CAN Single channel controller
<ul>
<li>Diff drive</li>
<li>Steer drive</li>
<li>Mecanum drive</li>
</ul>
</li>
<li>Serial dual channel controller
<ul>
<li>Diff Drive</li>
<li>Steer Drive</li>
<li>Mecanum Drive</li>
</ul>
</li>
</ul>
<p><strong>Supported kinematics for closed loop:</strong></p>
<ul>
<li>Diff drive</li>
<li>Mecanum drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="curtis"><a class="header" href="#curtis">Curtis</a></h3>
<p>A good multi-channel motor controller with wide capabilities.</p>
<p>Suitable for big and medium size AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>F2-T</li>
<li>F2-D</li>
<li>Fx-A (F2-A, F4-A, F6-A, F10-A, F16-A)</li>
<li>Note - If Curtis updates software model for Fx-C-series (F2-C, F4-C), Navitrol can support them.</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff Drive</li>
<li>Steer Drive</li>
<li>Steer drive with a differential sub-unit</li>
<li>Omni Drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>Reference controlled hydraulic actuator</li>
<li>Binary controlled actuator</li>
</ul>
<h3 id="dunkermotoren"><a class="header" href="#dunkermotoren">Dunkermotoren</a></h3>
<p>We have limited experience with it as it has been used only in few projects.</p>
<p>Suitable for at least small and medium sized AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>BGE6030A</li>
<li>Note - Other models might work but they have not been tested</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="syntron-1"><a class="header" href="#syntron-1">Syntron</a></h3>
<p>We have limited experience with it as it has been used only in one prototype AGV project.
Has limited documentation available in English.</p>
<p>Suitable for at least small and medium sized AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>LS series</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Omni drive with differential sub units</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="oriental"><a class="header" href="#oriental">Oriental</a></h3>
<p>Good motor controller with a simple commissioning and wiring procedure.</p>
<p>Suitable for small and medium sized AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>BLV-R series</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff Drive</li>
<li>Steer Drive</li>
<li>Steer drive with a differential sub-unit</li>
<li>Omni Drive</li>
<li>Omni drive with differential sub-units</li>
<li>Mecanum drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="synapticon"><a class="header" href="#synapticon">Synapticon</a></h3>
<p>A good motor controller with built-in safety inputs.</p>
<p>Suitable for small and medium size AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>EtherCAT</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>SOMANET Node Safety</li>
<li>Note - Other models might work but they have not been tested</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff Drive</li>
<li>Omni Drive</li>
<li>Mecanum Drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="micontrol"><a class="header" href="#micontrol">miControl</a></h3>
<p>A motor controller with built-in safety inputs.</p>
<p>Suitable for small, medium and big size AGVs.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>mcDSA-F3XXX (tested: mcDSA-F35-HC)</li>
<li>Note - Other models might work but they have not been tested</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff Drive</li>
<li>Steer Drive</li>
<li>Omni Drive</li>
<li>Mecanum drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h3 id="kinco"><a class="header" href="#kinco">Kinco</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>OD1X4S (tested: OD124S and motor SMC60S-0040-30MAK-3DSU)</li>
<li>FD1X4S (should work with the same interface, but hasn't been tested)</li>
<li>Note - Other models might work but they have not been tested</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff Drive</li>
<li>Mecanum Drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<!-- Note: If you add a new motor controller that does not have support for motor controller form, please, mention this also in MotorControllerCommon document! -->
<h3 id="supervisor-interface"><a class="header" href="#supervisor-interface">Supervisor interface</a></h3>
<p>An interface designed by Navitec over which Navitrol provides control references and the Supervisor (connected device e.g. PLC) provides odometry and status data.
With this option, the Supervisor device is responsible for sending the references to the motor controller.</p>
<p>The interface makes it possible to use any motor controller that the Supervisor (e.g. PLC) can control.</p>
<p>Motor controllers &lt;-&gt; Supervisor &lt;-&gt; Navitrol</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Navitec supervisor protocol (Ethernet TCP/IP)</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>Any device able to implement the protocol
<ul>
<li>Typically a PLC</li>
</ul>
</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Diff Drive</li>
<li>Steer Drive</li>
<li>Diff-Steer Drive</li>
<li>Omni Drive</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>Binary controlled actuator</li>
<li>Reference controlled actuator</li>
</ul>
<h3 id="simove-1"><a class="header" href="#simove-1">SIMOVE</a></h3>
<p>SIMOVE is Siemens modular software platform for mobile robots. Navitrol is the navigation module in the system and communicates to customer's onboard device (e.g., PLC) via the interface specified by SIMOVE. The interface is kinematic free, thus the PLC/device onboard controls the motor controllers of the AGV.</p>
<p><strong>Interfaces:</strong></p>
<ul>
<li>SIMOVE protocol, Ethernet TCP/IP (UDP)</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>Any device able to implement the protocol
<ul>
<li>Typically a PLC</li>
</ul>
</li>
</ul>
<p><strong>Supported kinematics:</strong></p>
<ul>
<li>Kinematic free</li>
</ul>
<p><strong>Supported actuators:</strong></p>
<ul>
<li>None</li>
</ul>
<h2 id="general-ios"><a class="header" href="#general-ios">General IOs</a></h2>
<p>General IOs can be used for various purposes. Typically they are used as communication interfaces between Navitrol and the device (PLC) controlling the AGV. For example, status data is typically shared between the devices.</p>
<h3 id="ethernet-supervisor-1"><a class="header" href="#ethernet-supervisor-1">Ethernet supervisor</a></h3>
<p>An interface designed by Navitec to provide and get data from the AGV.
Can be used for example to provide BMS data, AGV status, giving drive orders and setting speed limits.</p>
<h3 id="can-supervisor"><a class="header" href="#can-supervisor">CAN supervisor</a></h3>
<p>An interface designed by Navitec to provide and get data from the AGV.
Does not support as many functions as the Ethernet supervisor</p>
<h3 id="modbus-ethernet-tcp"><a class="header" href="#modbus-ethernet-tcp">Modbus Ethernet TCP</a></h3>
<p>Modbus Ethernet modules can be used for IO.
Navitrol supports Beckhoff EK9000 Bus Coupler but no generic interfaces exist.</p>
<p>Note: Non generic interface - will require custom development to use</p>
<h3 id="custom-can-interfaces"><a class="header" href="#custom-can-interfaces">Custom CAN interfaces</a></h3>
<p>Navitrol supports custom CAN interfaces but they will need custom development.</p>
<p>Note: Non generic interface - will require custom development to use</p>
<h2 id="scanners-1"><a class="header" href="#scanners-1">Scanners</a></h2>
<p>The main purpose of scanners is localization based on natural features. Other use cases include safety, target detection, obstacle detection and reflector based localization.</p>
<p>For localization and target detection use the recommended angular resolution is 0.2 degrees or better. Consult Navitec if considering other options.</p>
<h3 id="pepperlfuchs"><a class="header" href="#pepperlfuchs">Pepperl+Fuchs</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>R2000 series
<ul>
<li>Recommended version UHD</li>
<li>Versions of recommended angular resolution available</li>
</ul>
</li>
</ul>
<h3 id="leuze"><a class="header" href="#leuze">Leuze</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>RSL4xx
<ul>
<li>Versions of recommended angular resolution available</li>
</ul>
</li>
<li>RSL2xx</li>
</ul>
<h3 id="sick"><a class="header" href="#sick">SICK</a></h3>
<p><strong>interfaces:</strong></p>
<ul>
<li>Serial/TCP-IP
<ul>
<li>S300</li>
</ul>
</li>
<li>Ethernet
<ul>
<li>MicroScan</li>
<li>NanoScan</li>
<li>SICK Ethernet</li>
</ul>
</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>S300
<ul>
<li>Expert model required for localization. Other models for safety only</li>
</ul>
</li>
<li>MicroScan
<ul>
<li>Versions of recommended angular resolution available</li>
</ul>
</li>
<li>NanoScan
<ul>
<li>Versions of recommended angular resolution available</li>
</ul>
</li>
<li>SICK Ethernet
<ul>
<li>LMS1xx</li>
<li>LMS5xx</li>
<li>Timxxx</li>
</ul>
</li>
</ul>
<h3 id="hokuyo"><a class="header" href="#hokuyo">Hokuyo</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>UAM-05</li>
<li>UST-10LX-H02</li>
<li>Any model w. SCIP with possible limitations</li>
</ul>
<h3 id="quanergy"><a class="header" href="#quanergy">Quanergy</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>M1 series</li>
</ul>
<h3 id="omron"><a class="header" href="#omron">Omron</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>OS32C</li>
</ul>
<h3 id="keyence"><a class="header" href="#keyence">Keyence</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>SZ-V32NX</li>
</ul>
<h2 id="3d-cameras"><a class="header" href="#3d-cameras">3D cameras</a></h2>
<h3 id="ifm"><a class="header" href="#ifm">IFM</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>03D, requires Debian Buster</li>
</ul>
<!--
### SICK
**Interfaces:**
* Ethernet

**Models:**
* Visionary-T Mini
While the interface is available, the camera has never worked reliabe in our detection tests! -->
<h2 id="data-matrix-line-cameras"><a class="header" href="#data-matrix-line-cameras">Data matrix line cameras</a></h2>
<p>Data matrix line cameras are used for localization based on QR-tapes. QR-tape based localization is more accurate compared to scanner based one. It is typically used to increase accuracy of high precision docking tasks.</p>
<h3 id="pepperlfuchs-1"><a class="header" href="#pepperlfuchs-1">Pepperl+Fuchs</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>CANopen</li>
<li>TCP/IP</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>PGV100-xx
<ul>
<li>Should be installed at height of 100mm from the QR-tape</li>
</ul>
</li>
<li>PGV150-xx
<ul>
<li>Should be installed at height of 150mm from the QR-tape</li>
<li>Recommended as it has larger field of view</li>
</ul>
</li>
</ul>
<h2 id="qr-code-and-bar-code-reading-devices"><a class="header" href="#qr-code-and-bar-code-reading-devices">QR code and bar code reading devices</a></h2>
<p>QR code and bar code reading devices can be used for example identifying resources.
Taking one into use will require specifying the use case with Navitec and some custom development.</p>
<h3 id="sick-1"><a class="header" href="#sick-1">SICK</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>Lector 6xx
<ul>
<li>Able to detect the exact position of a resource.</li>
</ul>
</li>
</ul>
<h2 id="inertial-measurement-units-imu"><a class="header" href="#inertial-measurement-units-imu">Inertial measurement units (IMU)</a></h2>
<p>IMUs are used in addition to scanner localization to increase localization accuracy by improving the odometry data.</p>
<h3 id="lp-research"><a class="header" href="#lp-research">LP-RESEARCH</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>USB
<ul>
<li>LPMS-CU2</li>
<li>LPMS-CU3</li>
<li>LPMS-URS2</li>
<li>LPMS-URS3</li>
<li>LPMS-IG1</li>
</ul>
</li>
<li>CANopen
<ul>
<li>LPMS-CU2</li>
<li>LPMS-CU3</li>
</ul>
</li>
<li>Serial
<ul>
<li>LPMS-URS2</li>
<li>LPMS-URS3</li>
</ul>
</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>LPMS-CU2
<ul>
<li>Sufficient performance for most localization cases</li>
<li>Not manufactured anymore</li>
</ul>
</li>
<li>LPMS-CU3
<ul>
<li>Replacement for CU2</li>
</ul>
</li>
<li>LPMS-URS2
<ul>
<li>Performance is similar to CU2</li>
</ul>
</li>
<li>LPMS-IG1
<ul>
<li>More accurate and more expensive than the other models</li>
<li>The extra accuracy makes difference only when driving long distances without other localization sources</li>
</ul>
</li>
</ul>
<h2 id="magnetic-tape-sensors"><a class="header" href="#magnetic-tape-sensors">Magnetic tape sensors</a></h2>
<p>Magnetic tape sensors are used for magnetic tape following.</p>
<h3 id="sick-2"><a class="header" href="#sick-2">SICK</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
<li>CANopen</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>MLS Line guidance sensors</li>
</ul>
<h2 id="gps-devices"><a class="header" href="#gps-devices">GPS devices</a></h2>
<p>GPS devices are used for localization in outdoor environments that do not have enough static environment for laser scanner based localization.
Note: When using GPS an IMU is also required for detecting the tilt angle of the GPS sensors.</p>
<h3 id="septentrio"><a class="header" href="#septentrio">Septentrio</a></h3>
<p><strong>Interfaces:</strong></p>
<ul>
<li>Ethernet</li>
</ul>
<p><strong>Models:</strong></p>
<ul>
<li>Base stations
<ul>
<li>AsteRx SB ProConnect</li>
</ul>
</li>
<li>GPS receivers
<ul>
<li>Septentrio AsteRx SB ProDirect
<ul>
<li>Not manufactured anymore</li>
</ul>
</li>
<li>Septentrio AsteRx SB3 Pro
<ul>
<li>Replacement for SB ProDirect</li>
<li>Note: Not tested by Navitec but Manufacturer states that the interface is compatible</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="absolute-encoders"><a class="header" href="#absolute-encoders">Absolute encoders</a></h2>
<p>Encoders are used to measure the angle of rotating axle. These measurements are transformed into odometry data, such as driven distance and wheel angles.</p>
<h3 id="can-encoders"><a class="header" href="#can-encoders">CAN Encoders</a></h3>
<p>Navitrol supports most CANopen encoders that support CiA DS-301 and CiA DS-406 application layer.</p>
<p><strong>Tested and verified models:</strong></p>
<ul>
<li>Baumer
<ul>
<li>EAM580</li>
<li>EAM 360</li>
</ul>
</li>
<li>Kuebler
<ul>
<li>Sendix 5868</li>
<li>Sendix 5888</li>
</ul>
</li>
<li>Leine Linde
<ul>
<li>600 series</li>
</ul>
</li>
<li>Pepperl+Fuchs
<ul>
<li>CSM58</li>
<li>ENA36IL</li>
</ul>
</li>
<li>SICK
<ul>
<li>AHS36</li>
<li>AHM36</li>
</ul>
</li>
<li>Turck
<ul>
<li>RI360</li>
</ul>
</li>
<li>Siko
<ul>
<li>WV36M/CAN</li>
</ul>
</li>
<li>IFM
<ul>
<li>RM8xxx</li>
<li>RM9xxx</li>
</ul>
</li>
<li>Megatron
<ul>
<li>HTB36E</li>
<li>FHB58</li>
</ul>
</li>
</ul>
<h3 id="ethercat-encoders"><a class="header" href="#ethercat-encoders">EtherCAT Encoders</a></h3>
<p>Navitrol supports some of EtherCAT encoders that support CiA DS-301 and CiA DS-406 application layer.</p>
<p><strong>Tested and verified models:</strong></p>
<ul>
<li>SICK
<ul>
<li>AFS/AFM60</li>
</ul>
</li>
</ul>
<h2 id="battery-management-systems-bms"><a class="header" href="#battery-management-systems-bms">Battery management systems (BMS)</a></h2>
<p>Battery management systems are used to control and share data about the batteries of the AGVs. Typically they report at least the state of charge of the batteries.</p>
<p><strong>CAN models:</strong></p>
<ul>
<li>MasterVolt</li>
<li>Exide GNB - SL BMS</li>
<li>Jungheinrich</li>
<li>RoboteQ</li>
<li>Voltabox</li>
<li>MEB battery</li>
<li>JLN</li>
<li>Wiferion</li>
</ul>
<p><strong>Ethernet Supervisor:</strong></p>
<ul>
<li>Suitable for devices with an access to BMS data</li>
<li>Requires that the device supports Navitec Supervisor Protocol</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="generic-interfaces"><a class="header" href="#generic-interfaces">Generic interfaces</a></h1>
<p>Updated 26.01.2024</p>
<ul>
<li><a href="AgvInterfaces/GenericInterfaces/./EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet Supervisor</a></li>
<li><a href="AgvInterfaces/GenericInterfaces/./CanCommunication/CanCommunication-en.html">CAN communication</a>
<ul>
<li><a href="AgvInterfaces/GenericInterfaces/./CanSupervisorInterface/CanSupervisorInterface-en.html">CAN Supervisor</a></li>
</ul>
</li>
<li><a href="AgvInterfaces/GenericInterfaces/./EthercatCommunication/EthercatCommunication-en.html">EtherCAT Communication</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="communication-specification-between-navitrol-and-ethernet-supervisor"><a class="header" href="#communication-specification-between-navitrol-and-ethernet-supervisor">Communication specification between Navitrol and Ethernet supervisor</a></h1>
<p>Updated 13.08.2024</p>
<hr />
<h2 id="glossary-2"><a class="header" href="#glossary-2">Glossary</a></h2>
<table><thead><tr><th><strong>Term</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td>AGV supervisor</td><td>Software supervising/controlling the AGV. Typically running on a PLC (Programmable logic controller) located on an AGV. The term &quot;Supervisor&quot; in this document means same as the <em>AGV supervisor</em></td></tr>
<tr><td>AGV controller</td><td>In old documentation for positioning only systems this term has been used to mean same thing as <em>AGV supervisor</em></td></tr>
<tr><td>Auto mode</td><td>Automatic control mode in which Navitrol can control the AGV.</td></tr>
<tr><td>Auto state</td><td><em>Navitrol state</em> in which the AGV is performing a <em>drive order</em> - Navitrol is on <em>auto mode</em> and is currently fulfilling a given drive order.</td></tr>
<tr><td>Differential&amp;steer drive</td><td>Differential&amp;steer drive kinematic system has the two fixed wheels of differential drive AGV and the controlled steer wheel of a steer drive AGV. The benefit of differential&amp;steer drive compared to differential drive is that there is no need for unpredictable castor wheels.</td></tr>
<tr><td>Drive order</td><td>An order to drive AGV in <em>auto mode</em> from current position to a destination, typically to a symbolic point.  If the drive order is given to a <em>symbolic point</em> the AGV must be on the route, and on the <em>standby state</em>. In addition the given symbolic point must defined and reachable.  Can only be used with a standalone feature or Navithor.</td></tr>
<tr><td>Emergency stop</td><td>When emergency stop is triggered Navitrol will perform <em>fast stop</em> and by default change to <em>fast stop state</em>. The state change can be prevented by setting <strong>pc_fstop_on_estop</strong>-parameter to value 0 and Navitrol remains in the previous state instead.</td></tr>
<tr><td>Environment file</td><td>A file containing environment data used for localization.</td></tr>
<tr><td>Error</td><td>Navitrol error indicates that there is some issue in the system that prevents driving. When an error is triggered, the AGV will stop.</td></tr>
<tr><td>Fast stop</td><td>Navitrol will set the speed references instantly to zero without ramping the speed down. Manual and automatic driving using Navitrol is prevented.</td></tr>
<tr><td>Fast stop state</td><td><em>Navitrol state</em> in which driving the AGV is prevented, and brake activation reference will always be active - Navitrol is on <em>auto mode</em> and <em>fast stop</em> is active.</td></tr>
<tr><td>Floor</td><td>Positioning only systems support multiple floors (i.e. level), each having its own environment model. If only single floor is used, its floor index should be 0.</td></tr>
<tr><td>Load state</td><td><em>Navitrol state</em> in which the AGV is performing a load or unload - Navitrol is on <em>auto mode</em> and is loading or unloading a resource.</td></tr>
<tr><td>Manual mode</td><td>Navitrol control mode in which automatic driving using Navitrol is prevented. Manual mode is prioritized over auto mode. It will be active if any source activates it, even if some other would enable auto mode.</td></tr>
<tr><td>Measurement update message</td><td>Measurement update messages can be used to deliver odometry and control data to Navitrol in such cases where Supervisor controls the AGV based on the control references from the Navitrol. <br />When used, such message must be sent to periodically at constant intervals to Navitrol. The interval must be same as defined using <strong>control_interval_us</strong>-parameter. Recommended intervals are 30 +-10ms.  <br />It is important to make sure that the message is sent at constant interval in all situations even in situations where supervisor system is under high load, because if Navitrol does not receive odometry data it must stop in error. The interval is considered constant, if it does not exceed the defined interval by more than <strong>control_interval_error_ratio</strong>-parameter (by default 20%). <br />If any of the received data is invalid, Navitrol will not use the message and will keep the previous references. <strong>eth_ctrl_max_nbr_invalid_feedback</strong>-parameter defines how many invalid messages are allowed in a row before ERROR_Ethernet_FEEDBACK_INVALID will be set.  <br />Note: If a measurement update message is used, it must be sent always when Navitrol is running, even if the AGV is driven manually.</td></tr>
<tr><td>MES</td><td>MES (Manufactoring Execution System) can be used to control Navithor's behavior by for example, giving resource information and even direct production orders.</td></tr>
<tr><td>Message number</td><td>Identification number of the measurement message for matching the supervisor update messages and related Navitrol replies together. <br />This number can start from any number, and it must be increased by one for each message sent.  <br />When using <em>Measurement update messages</em> Navitrol will check that the received message number is increased by one from the previous message. If it has not, the message will be discarded. This feature can be disabled by setting <strong>eth_ctrl_msgnum_validate</strong>-parameter to value 0. <br />Navitrol will send the number received in an update message back in the reply message.</td></tr>
<tr><td>Navigation point</td><td>Navigation point is the point of the AGV that will follow the defined routes. For example, for an AGV having a single turning drive wheel and two fixed wheels, the navigation point would typically be at the center of the fixed axle.</td></tr>
<tr><td>Navithor</td><td>Navitec's fleet control system that can be used to control and schedule multiple AGVs that are running Navitrol.</td></tr>
<tr><td>Navithor Tools</td><td>Navitec software used to make environment from teach files and define routes and symbolic points.</td></tr>
<tr><td>Navitrol</td><td>Software correcting the position of the AGV (Automated guided vehicle). Typically running on an IPC (Industrial PC) on an AGV.</td></tr>
<tr><td>Navitrol state</td><td>Current state of Navitrol. Can be read from the &quot;default&quot;-section of &quot;Navitrol status&quot;-message (3102). It can also be seen from bottom bar of Navitrol monitor.</td></tr>
<tr><td>Navitrol monitor</td><td>Diagnostic and debugging Windows software for Navitrol. Can be used for example to give drive commands and observing the state of connected Navitrol.</td></tr>
<tr><td>Navitrol Standalone</td><td>Single machine system feature: Navitrol handles navigation, route planning and driving. Requires a license.</td></tr>
<tr><td>Parameter</td><td>Navitrol parameters can be changed to adjust the default behavior of Navitrol. They are located in params.txt file on the IPC running Navitrol. If parameters are added or modified, they must be reloaded to the system either with reload command from Navitrol Monitor or by restarting Navitrol.</td></tr>
<tr><td>Pause state</td><td><em>Navitrol state</em> in which drive order of the AGV is paused - Navitrol is on <em>auto mode</em> and has a paused <em>drive order</em>.</td></tr>
<tr><td>Position confidence</td><td>The position confidence value represents both the accuracy and the uncertainty of the reported position. Depending on the environment seen by the scanners and the map file used for positioning there may be several possibilities for the current position. <br />The accuracy refers to the actual confidence range of the best position, i.e. how large the area is where the machine almost certainly is if the selected position would be correct. <br />The uncertainty refers to the quality of the best positions compared to the seen environment and the other possible positions. <br />The accuracy refers to the actual confidence range of the best position, i.e. how large the area is where the machine almost certainly is if the selected position would be correct. <br />Typically higher position confidence results in higher position accuracy. In normal operation the confidence varies between 50 and 100 %.</td></tr>
<tr><td>Position control system</td><td>A system in which in addition to localization, Navitrol also controls the AGV by calculating the references for the wheels of the AGV. Typically uses either Navitrol Standalone or Navithor fleet control for automatic drive.</td></tr>
<tr><td>Positioning only system</td><td>A system in which Navitrol is only used for localization. Navitrol will provide the position of the AGV but does nothing else.</td></tr>
<tr><td>Reserved data field</td><td>If message data field says &quot;Reserved&quot; it means that the field is not currently used but might be in the future. Those fields must be included in messages and calculated to the message lengths.  <br />When sending reserved fields, the sent value should always be zero. In this way if the fields are later given meanings and taken into use the old behavior will not change. <br />For same reasons, when receiving reserved fields, supervisor should ignore the received value.</td></tr>
<tr><td>Segment file</td><td>A file containing all route and symbolic point data. Used for position control. Not required in positioning only systems.</td></tr>
<tr><td>Soft slow</td><td>Navitrol will limit the maximum speed references to the value of <strong>pc_soft_slow_wheel_speed</strong>-parameter. If the speed was higher than that value, it will be ramped down using on <strong>mot_ctrl_max_wheel_dec</strong>-parameter.</td></tr>
<tr><td>Soft stop</td><td>Navitrol will stop ramping the speed smoothly down using <strong>mot_ctrl_max_wheel_dec</strong>-parameter.  Manual and automatic driving using Navitrol is prevented.</td></tr>
<tr><td>Standby state</td><td><em>Navitrol state</em> in which the AGV is waiting for a drive order - Navitrol is on <em>auto mode</em> but does not have any active <em>drive order</em>s.</td></tr>
<tr><td>Supervisor controlled AGV</td><td>An AGV that uses the <em>measurement update messages</em> send odometry data and receive control references from Navitrol.</td></tr>
<tr><td>Symbolic point</td><td>A production location, such as stop, load, or unload point. These are defined in Navithor Tools and Navitrol reads them from a segment file. <br />Supervisor can request a list of defined symbolic points with message 3003.</td></tr>
<tr><td>Warning</td><td>Navitrol uses warning to inform the user that there is something non ordinary active in the system. Some of them can prevent driving with either <em>soft stop</em> or <em>hard stop</em>.</td></tr>
<tr><td>Web interface</td><td>An interface for joystick based manual control. It can be used by connecting with a phone or a browser to the IP address of the IPC Navitrol is running on.</td></tr>
<tr><td>Production request</td><td>Production request is a request that Navitrol can send to Navithor to ask to modify status of production. For example, to go to destination or clear active <em>production order</em> for the AGV.</td></tr>
<tr><td>Hold state</td><td><em>Navitrol state</em> in which the AGV is on hold waiting to be released for a new drive order - Navitrol is on <em>auto mode</em> but has entered hold-point and is waiting to be released to next destination.</td></tr>
<tr><td>Omnidirectional AGV</td><td>An AGV that can drive to any direction in relation to its frame. For example, AGVs using omni drive or mecanum kinematics are omnidirectional AGVs.</td></tr>
<tr><td>Production order</td><td>Navithor order for a single production task. It can contain information about the <em>drive order</em> and transported resources.</td></tr>
<tr><td>External fleet control</td><td>External fleet control is feature for directly controlling the AGV by giving drive trajectories to Navitrol. When external fleet control is used, an external source takes care of generating all routes and the <em>segment file</em> will not be used.</td></tr>
<tr><td>Map coordinate frame</td><td>The coordinate frame defined in Navithor tools. See coordinate frames chapter.</td></tr>
</tbody></table>
<hr />
<h2 id="overview-6"><a class="header" href="#overview-6">Overview</a></h2>
<p>The Ethernet Supervisor interface is a general interface between the <em>Navitrol</em> navigation software and the <em>AGV supervisor</em>. The interface has been designed by Navitec systems and can be used to transfer data and commands between Navitrol and the supervisor. Navitrol runs on an IPC and supervisor runs typically on an PLC both physically aboard the AGV.</p>
<p>The interface can be used for example, to set speed limits, give drive orders and set the system time of the IPC.</p>
<h3 id="communication-protocol-versions"><a class="header" href="#communication-protocol-versions">Communication Protocol versions</a></h3>
<p><strong>This document describes fourth (4.) generation of the interface.</strong>
Older communication Protocol versions (1 - 3) are still supported by Navitrol but should not be used in new projects.</p>
<h3 id="physical-interface"><a class="header" href="#physical-interface">Physical interface</a></h3>
<p>Navitrol IPC and AGV supervisor hardware are connected using Ethernet interface. It is recommended to use Ethernet cable for connection stability, but using wireless connection is also possible.</p>
<h3 id="transportnetwork-protocol"><a class="header" href="#transportnetwork-protocol">Transport/network protocol</a></h3>
<p>TCP/IP protocol is used for communication.</p>
<p>The Navitrol computer can be configured as a TCP/IP server or a client using <strong>agv_server</strong>-parameter. By default, supervisor acts as the server (value 1) and Navitrol a client. Changing the parameter value to 0 will make supervisor the client and Navitrol the server. If Navitrol acts as a client, the <strong>agv_ip</strong>-parameter must be set to match the IP-address of the supervisor.</p>
<p>The default port used for communication is 5015 but it can be changed with <strong>agv_port</strong>-parameter.</p>
<p><strong>Important note:</strong> The TCP/IP protocol takes care of acknowledging messages and resending if needed. Periodic messages, such as status or position correction messages, should never be resent by the supervisor.</p>
<h3 id="endianness"><a class="header" href="#endianness">Endianness</a></h3>
<p>The interface supports both little-endian (the least significant bit first) and big-endian (the most significant bit first) formats.</p>
<p>By default, little endian is used. The endianness can be changed using <strong>agv_comms_swapbytes</strong>-parameter. Value 0 means little-endian and value 1 big-endian.</p>
<h3 id="supported-character-set-in-strings"><a class="header" href="#supported-character-set-in-strings">Supported character set in strings</a></h3>
<p>Navitrol supports 7-bit ASCII character set. Meaning all characters (filenames, descriptions etc..) that are sent to Ethernet supervisor interface needs to be 7-bit ASCII.</p>
<h3 id="coordinate-frames"><a class="header" href="#coordinate-frames">Coordinate frames</a></h3>
<p>Two cartesian coordinate frames are used in the messages - the map coordinate frame and the local machine coordinate frame as presented in Figure 1.</p>
<p>The map coordinate frame is defined by the project file created with <em>Navithor Tools</em>. The absolute XY-position is expressed using 32-bit single float metric values in all messages. In order to guarantee optimal accuracy, the origin in the map coordinate frame needs to be close enough to the working environment (preferably within the working environment).</p>
<p>The local machine coordinate origin is located at the <em>navigation point</em> of the machine.</p>
<p>All heading values are expressed using 32-bit single float values in radians. Heading values are expected to be in the range of +/-Pi (i.e. +/-180 degrees), Counterclockwise (CCW) being positive direction for heading change.</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/coordinate_system.png" alt="" /></p>
<blockquote>
<p>Figure 1: The local machine coordinate frame (green) and the map coordinate frame (red). The current machine position is Xcur, Ycur, Hcur. CCW is the positive direction for heading, Hcur being roughly +30 deg (i.e. 0.524 rad) in this case.</p>
</blockquote>
<hr />
<h2 id="implementation-guidelines"><a class="header" href="#implementation-guidelines">Implementation guidelines</a></h2>
<h3 id="mandatory-messages"><a class="header" href="#mandatory-messages">Mandatory messages</a></h3>
<p><ins>Not all messages specified in this document need to be implemented.</ins>
The few mandatory messages that must be implemented are listed below.</p>
<p>All other messages should be implemented on the need basis.</p>
<h4 id="position-control-system"><a class="header" href="#position-control-system">Position control system</a></h4>
<p>For a position control system to work following messages must be implemented. See message definitions for more information.</p>
<table><thead><tr><th><strong>Supervisor to Navitrol message</strong></th><th><strong>Navitrol to Supervisor response</strong></th><th><strong>Explanation</strong></th></tr></thead><tbody>
<tr><td>3002 - Supervisor status</td><td>3102 - Navitrol status</td><td>Sent at least once (or whenever needed) by the Supervisor.</td></tr>
</tbody></table>
<p>For a <em>supervisor controlled AGV</em> in addition to messages required for position control system also one of the following messages must be implemented.</p>
<table><thead><tr><th><strong>Supervisor to Navitrol message</strong></th><th><strong>Navitrol to Supervisor response</strong></th><th><strong>Explanation</strong></th></tr></thead><tbody>
<tr><td><em>Measurement update message</em> suitable for the kinematic type</td><td>Related response message</td><td>Required for the supervisor to provide odometry data and Navitrol to send control references</td></tr>
</tbody></table>
<h4 id="positioning-only-system"><a class="header" href="#positioning-only-system">Positioning only system</a></h4>
<p><strong>Get position correction messages</strong>
The Supervisor has two alternative methods of requesting position corrections. It can either send to Navitrol:</p>
<ol>
<li>Cumulative raw (non-corrected) odometry of the AGV in the machine coordinate frame using message &quot;Get position correction - cumulative&quot; (message ID 1014)</li>
<li>Speed of the AGV in the machine coordinate frame using message &quot;Get position correction - velocity&quot; (message ID 1015)</li>
</ol>
<p>Only one of these two methods should used in a system. The selection should be made based on which measurement is more accurate both relative to timestamp and measurement resolution.</p>
<p>For a positioning only system to work following messages must be implemented. See message definitions for more information.</p>
<table><thead><tr><th><strong>Supervisor to Navitrol message</strong></th><th><strong>Navitrol to Supervisor response</strong></th><th><strong>Explanation</strong></th></tr></thead><tbody>
<tr><td>1001 - Initialize position</td><td>1101 - Position initialized</td><td>Sent at least once (and whenever needed) by the Supervisor to set the initial position of the AGV</td></tr>
<tr><td>1014 - Get position correction - cumulative <strong>or</strong><br /> 1015 - Get position correction - velocity</td><td>1114 - Position correction <strong>or</strong> <br />1115 - Position correction with precision positioning status</td><td>Either of these messages must be sent by the supervisor and Navitrol shall send response message defined by the <strong>report_pp_status</strong>-parameter.</td></tr>
</tbody></table>
<p><strong>Message sequence:</strong>
When the system is started, the Supervisor shall (see message specifications below for details)</p>
<ol>
<li>Start sending one of the two &quot;Get position correction&quot; messages periodically</li>
<li>Send the &quot;Initialize position&quot; message</li>
</ol>
<p>Note: If Navitrol fails to receive periodic &quot;Get position correction&quot; messages, it will assume that the communication link is broken and reinitialize the communication.</p>
<h3 id="timing-constraints"><a class="header" href="#timing-constraints">Timing constraints</a></h3>
<h4 id="navitrol-response-time"><a class="header" href="#navitrol-response-time">Navitrol response time</a></h4>
<p>The typical Navitrol response time for a request message received from the supervisor should not be more than a few milliseconds. However, there is a few exceptions, such as &quot;The position initialized&quot; and &quot;Log taken&quot; response messages, that are sent only after the triggered routine has finished which may take up to a few seconds. The message description will mention if the response message can have a delay.</p>
<h4 id="periodic-messages"><a class="header" href="#periodic-messages">Periodic messages</a></h4>
<p>The messages that are defined to be sent periodically by supervisor should be sent as constant intervals as possible. The periodic messages include messages such as 1014, 1015 and 3002.</p>
<p>Absolutely constant intervals are not really achievable, but the variation of all time related events should be kept to a minimum for optimal performance. The recommended variation is 3 ms or less.</p>
<hr />
<h2 id="feature-descriptions"><a class="header" href="#feature-descriptions">Feature descriptions</a></h2>
<h3 id="position-correction"><a class="header" href="#position-correction">Position correction</a></h3>
<p>Position correction feature is the Navitrol's feedback part on correcting the position of <em>positioning only system</em>. Navitrol provides position correction data with &quot;position correction&quot; messages (1114 , 1115) in response to &quot;Get position correction&quot; request from the supervisor (1014, 1015).</p>
<p><strong>Timing constraints</strong><br />
The Supervisor shall send the &quot;Get position correction&quot; message continuously using a fixed interval without exceptions. The sending interval should be a fixed value between 20...100 ms; an interval of 40 ms (25 Hz) is recommended. In the optimal case the sending interval shall however be synchronized to the dead-reckoning, so that the delay from the dead-reckoning calculation to sending the &quot;Get position correction&quot; message to Navitrol is also constant. This can be achieved by having the sending interval the same or a multiple of the dead-reckoning calculation interval. As an example in figure 2 below the interval for calculating the dead-reckoning is faster than that for sending the &quot;Get position correction&quot; messages, the latter being sent at half the rate of the dead-reckoning calculation. If the interval for calculating the dead-reckoning is for example 50 ms, then this is obviously also the optimal interval for sending the &quot;Get position correction&quot; messages to Navitrol.</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/synchronizing_position_correction.png" alt="" />
&gt;Figure 2: Synchronizing positioning correction between supervisor and Navitrol.  In the figure the Dead-reckoning is calculated every 20ms and Navitrol correction requested and calculated every 40ms, i.e. every other time.</p>
<p>It is important to understand that the &quot;Position correction&quot; message sent by Navitrol does not reflect the current position of the AGV at the time the message is received by the Supervisor. It is rather the corrected position of the AGV at the time the corresponding &quot;Get position correction&quot; message was sent (time Ta in figures 3 and 4).</p>
<p>The typical response time for the Navitrol &quot;Position correction&quot; is just a few milliseconds, but can be higher depending on how the communication has been implemented on the Supervisor side. In case of very short dead-reckoning intervals or delayed messages, it is possible that the Supervisor has updated a new dead-reckoning position prior to getting the Navitrol message (see figure 4). Therefore the corrected position sent by Navitrol should not be used as the new AGV position as it is. The difference between the corrected position and the position sent by the Supervisor at time Ta should be calculated and used instead.</p>
<p><strong>Correction sequence</strong><br />
The following sequence shall be followed by the Supervisor for position corrections:</p>
<ul>
<li>Timer expires at Ta
<ul>
<li>Read navigation sensor data</li>
<li>Calculate new dead-reckoning position</li>
<li>Send &quot;Get Position Correction&quot; message to Navitrol and store position and message number at that time for later reference.</li>
</ul>
</li>
<li>The Supervisor continues to calculate dead-reckoning, if the timer expires (like at Tb in figure 4) before receiving the corrected position from Navitrol.</li>
<li>When the corrected position from Navitrol is received
<ul>
<li>Check that the received message number matches with the latest &quot;Get Position Correction&quot; message sent by the Supervisor.</li>
<li>Calculate the difference between the corrected position and the position sent by the Supervisor at time Ta</li>
<li>Add this difference to the latest AGV position. This then results in the corrected AGV position.</li>
</ul>
</li>
</ul>
<p><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/position_correction_sequence_1.png" alt="" /></p>
<blockquote>
<p>Figure 3: Timing related to position correction; zoomed portion of figure 2.</p>
</blockquote>
<p><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/position_correction_sequence_2.png" alt="" /></p>
<blockquote>
<p>Figure 4: Timing related to position correction; zoomed portion of figure 2 in case of very fast dead-reckoning calculation or delayed messages.</p>
</blockquote>
<h3 id="supervisor-fleet-control"><a class="header" href="#supervisor-fleet-control">Supervisor fleet control</a></h3>
<p>Supervisor fleet control is a way of implementing <em>external fleet control</em>.</p>
<p>When using supervisor fleet control the supervisor is responsible of generating and sending all drive trajectories to Navitrol. It can be used as an alternative option to <em>Navithor</em> and <em>Standalone system</em>s.</p>
<p>The drive trajectories can be given with &quot;Start new external drive&quot; (3021) and &quot;Extend external drive&quot; (3022) messages. The 3021-message can be used to start a new drive and the 3022-message to extend an already started one.</p>
<p><strong>Specifications for drive orders and drive extensions:</strong></p>
<ul>
<li><strong>Only the first and the last point in each drive order can be a</strong> <strong>pivot point</strong>.
<ul>
<li>Having the last point as a pivot point, the first point of the next drive extension is assumed to have the pivot point as first point.</li>
<li>If the any point in the middle of trajectory has pivot point attribute Navitrol will reply with code 6: &quot;trajectory calculation failed&quot;.</li>
<li><strong>However, incorrect input in the extend drive message aborts the ongoing drive.</strong></li>
</ul>
</li>
<li><strong>A single trajectory may not contain</strong> <strong>drive direction changes</strong>.
<ul>
<li>If it has the AGV will lose position.</li>
<li>Direction changes should be handled by first sending a drive order to one direction and then a drive extension to another direction.</li>
</ul>
</li>
<li><strong>Distance between consecutive trajectory points - Consecutive trajectory points must be different</strong>.
<ul>
<li>If they are not the drive is aborted due an error and Navitrol will reply with response code 6: &quot;Trajectory calculation failed&quot;.</li>
<li>The distance is calculated from the given trajectory point xy-coordinates.</li>
<li>The recommended distance between consecutive trajectory points is 0.10m. (Min 0.001m and Max 0.20m).</li>
</ul>
</li>
<li><strong>Trajectory point attribute &quot;Omni heading&quot; can be used only with omnidirectional AGVs.</strong>
<ul>
<li>If it is sent to any other machine type the current drive is aborted and Navitrol will reply with response code 7: &quot;Invalid point attribute&quot;.</li>
</ul>
</li>
<li><strong>The amount of trajectory points sent in a single message must be at least 2 and at maximum 400</strong></li>
<li><strong>Total trajectory length requirements:</strong>
<ul>
<li>Minimum length is 0.004 meters - smaller values are allowed but they do not have any effect.</li>
<li>Maximum length is 79.8m - limited by the amount of trajectory points and the distance between them</li>
</ul>
</li>
</ul>
<p>If any of these specifications is violated the new drive will not start and if the violation was in extend external drive message an error will be raised, and current drive aborted. Navitrol will specify the found violation in the reply-messages 3121 and 3122.</p>
<h3 id="drive-order-with-offset"><a class="header" href="#drive-order-with-offset">Drive order with offset</a></h3>
<p>There are several messages (3012, 3013, 3031) that allow generating a drive order with offsets to the defined route. One might want to use these offsets for example, if there is no other way to calibrate individual AGVs to stop to the same point or some resource offset sensor is telling the exact place where the load should be performed.</p>
<p>By default, the AGV will drive the whole route with the given transversal offset and frame heading offset and stop with the longitudinal offset. Usually, it is recommended to first drive to a position near the destination with zero offsets and then with desired offsets to the destination point.</p>
<p>Heading and transversal offsets can be also applied only when closer than <strong>drive_offset_apply_dist</strong> to the drive order end point along the route.</p>
<table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F, drive_offset_apply_dist</strong></td><td>-1.0</td><td>Distance (meters) from drive order end point before drive offsets will start to apply. Negative value enables offsets always</td></tr>
</tbody></table>
<p>Offset options explained:</p>
<ul>
<li><em>Transversal offset</em>
<ul>
<li>Will be applied for the length of the whole drive order - AGV will drive next to the defined route instead on it.</li>
<li>Positive value to the left of the route.</li>
<li>The absolute of a given value must be smaller than <strong>drive_offset_max_trans</strong>-parameter.</li>
<li>The drive offset apply mode can be determined with a parameter <strong>drive_offset_apply_mode</strong> 
<ul>
<li>0 - Negative speed flips transversal offset. 1 - Apply offsets as is given. Speed direction does not affect offsets</li>
</ul>
</li>
</ul>
</li>
<li><em>Longitudinal offset</em>
<ul>
<li>Calculated from the location of the destination point.</li>
<li>Positive value for driving past the end point.</li>
<li>The absolute of given value must be smaller than <strong>drive_offset_max_lon</strong>-parameter.</li>
</ul>
</li>
<li><em>Frame heading offset</em>
<ul>
<li>Will be applied to the route frame heading for the length of the whole drive order - AGV will drive the path its frame tilted by this amount.</li>
<li>Positive value counterclockwise</li>
<li>Applied only for <em>omnidirectional AGV</em>s.</li>
<li>The absolute of given value must be smaller than <strong>drive_offset_max_heading</strong>-parameter.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="common-messages"><a class="header" href="#common-messages">Common messages</a></h2>
<p>These messages can be used in all Navitrol systems.</p>
<h3 id="from-supervisor-to-navitrol"><a class="header" href="#from-supervisor-to-navitrol">From Supervisor to Navitrol</a></h3>
<h4 id="1001---initialize-position"><a class="header" href="#1001---initialize-position">1001 - Initialize position</a></h4>
<p>This message can used to initialize the position of the AGV to given coordinates and heading on the map. Position initialization means that a position (x, y, h) and a level ID are given to Navitrol, and Navitrol fine tunes that position so the taught environment and the received scanner measurements match together as well as possible. Initialized position is required for most Navitrol features to function.</p>
<p>When Navitrol receives this message:</p>
<ol>
<li>Navitrol immediately responds with &quot;Position initialization started&quot;-message (1100)</li>
<li>Navitrol tries to initialize the AGV to the given position on the map</li>
<li>Navitrol sends the position initialization result and information in &quot;Position initialized&quot;-message (1101) after couple of seconds  In addition to this message, there is manual and automatic options for position initialization. To initialize position the AGV must be stationary and not in <em>load state.</em></li>
</ol>
<p>Position initialization will fail until the environment has been taught, created and stored in the Navitrol computer.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.52</td><td>The type of the last field (i.e., <code>Level</code>) is changed from <code>Uint</code> to <code>Int</code>. <br> Additionally, multilevel is supported for all types of AGVs.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1001</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>24</td></tr>
<tr><td>X</td><td>Float</td><td>4</td><td>X - map coordinate of the AGV in meters</td></tr>
<tr><td>Y</td><td>Float</td><td>4</td><td>Y - map coordinate of the AGV in meters</td></tr>
<tr><td>H</td><td>Float</td><td>4</td><td>Heading of the AGV on the map in radians</td></tr>
<tr><td>Level</td><td>Int</td><td>4</td><td>The level ID on which the AGV is located</td></tr>
</tbody></table>
<hr />
<h4 id="1002---initialize-position-at-symbolic-point"><a class="header" href="#1002---initialize-position-at-symbolic-point">1002 - Initialize position at symbolic point</a></h4>
<p>This message can be sent instead of the &quot;Initialize position&quot;-message (1001) when the AGV is standing on a symbolic point. In this case the X,Y,H data of the position initialization ID of the symbolic point is used for the initialization.</p>
<p>When Navitrol receives this message:</p>
<ol>
<li>Navitrol tries to initialize the AGV to the given symbolic point on the map</li>
<li>If the given position initialization ID is valid Navitrol sends the position initialization result and information in &quot;Position initialized&quot;-message (1101). If the ID was not valid no response is given.</li>
</ol>
<p>Before the AGV can be initialized to a symbolic point, the symbolic point must have &quot;PositionInit&quot; enabled from &quot;Symbolic Point Settings&quot; using Navithor Tools. Tools then automatically generates unique position initialization IDs for each defined heading of the symbolic point. These IDs can be seen when &quot;Show position initialization IDs&quot;-option is selected from the &quot;View&quot;-menu.</p>
<p>To initialize position AGV must be stationary and not in <em>load state</em>.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1002</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Position initialization ID of the symbolic point</td><td>Int</td><td>4</td><td>The position initialization ID of the symbolic point to initialize position on. <br />Note: Position initialization ID of the symbolic point is not the same as the normal symbolic point ID.</td></tr>
</tbody></table>
<hr />
<h4 id="1004---startstop-teaching"><a class="header" href="#1004---startstop-teaching">1004 - Start/stop teaching</a></h4>
<p>This message can be used to control Navitrol's environment teaching feature. More information about the teaching feature can be found from the &quot;Navitrol teaching instructions&quot;-document.</p>
<table><thead><tr><th><strong>Response message</strong></th><th><strong>ID</strong></th></tr></thead><tbody>
<tr><td>Teaching started/stopped</td><td>1104</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1004</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Teach command</td><td>Uint</td><td>2</td><td>1 - <strong>Start teaching</strong> <br />Starts the teaching feature. When teaching is active only manual driving is possible. If this command is given when teaching is already active WARNING_TEACHING_ALREADY_ON will be triggered <br />2 - <strong>Stop teaching</strong> <br />Stops the teaching feature. The created teach file will be saved the &quot;teach&quot; folder on Navitrol IPC</td></tr>
</tbody></table>
<hr />
<h4 id="1005---request-error-description"><a class="header" href="#1005---request-error-description">1005 - Request error description</a></h4>
<p>This message can be sent to Navitrol to request an error description of given error code.</p>
<p>Navitrol will respond with the &quot;Error description message&quot;-message (1105) that contains the description for the requested error.</p>
<p>Note: Descriptions of all possible Navitrol errors and how to handle them can be found from &quot;Navitrol error descriptions&quot;-document.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1005</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Error code</td><td>Uint</td><td>4</td><td>Error code / ID. In the response message Navitrol will sent the description based on this.</td></tr>
</tbody></table>
<hr />
<h4 id="1006---request-error-description-list"><a class="header" href="#1006---request-error-description-list">1006 - Request error description list</a></h4>
<p>This message can be sent to Navitrol to request a list of codes and descriptions of all active errors and warnings.</p>
<p>By default, both warnings and errors are sent. However, with <strong>veh_inte_error_message_mode</strong>-parameter the behavior can be changed:</p>
<p>0 - Nothing will be sent</p>
<p>1 - Only errors are sent</p>
<p>2 - Both errors and warnings are sent</p>
<p>Navitrol will respond with the &quot;Error description message&quot; (1106) that will contain the error list.</p>
<p>Note: Descriptions of all possible Navitrol errors and how to handle them can be found from &quot;Navitrol error descriptions&quot;-document.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1006</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1007---save-log"><a class="header" href="#1007---save-log">1007 - Save log</a></h4>
<p>This message can be used to take and save a binary log file. The log file will be saved the &quot;logs&quot; folder on Navitrol IPC.</p>
<p>Navitrol will respond with the &quot;Log saved&quot;-message (1107). Either immediately, if log taking preconditions fail, or in normal case after saving the log has been completed. Note: taking a log can take up to 20 seconds. The response message will tell if log was successfully taken or not.</p>
<p>The minimum interval for log taking is 20 seconds. If this a new request is sent when less time has passed from the previous message, the request will be rejected.</p>
<p>Note: <strong>log_dump_external_max_files</strong>-parameter defines how many logs taken with this message are kept in the memory (by default 10). When this amount would be exceeded the oldest log file will be removed.</p>
<p>For more information about logging, see: &quot;Navitrol logging user guide&quot;-document</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
<tr><td>6.28.06</td><td>The timing of response message (1107) was changed. In earlier versions the response was sent before the log saving progress was completed.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1007</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1008---reload-environment-and-segment-data"><a class="header" href="#1008---reload-environment-and-segment-data">1008 - Reload environment and segment data</a></h4>
<p>This message can be used to reload the environment and segment data into Navitrol. One might want to do this, if the environment file &quot;env_&quot; or segment file &quot;seg_...&quot; file in &quot;/home/navitec/&quot;-folder has been modified or replaced.</p>
<p>Note: Positioning only systems reloads only environment file as there is no segment file.</p>
<p>Note: These files are automatically loaded when Navitrol starts and can be also reloaded using Navitrol Monitor or Navithor Tools. Navithor Server will also automatically update and reload these files if they don't match the files it has.</p>
<p>If <strong>veh_inte_env_read_rply_msg</strong>-parameter is set to value 1, Navitrol will respond with the &quot;Environment and segment data reload result&quot;-message (1108) when the reload is complete. This might take several seconds.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1008</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1009---reload-specific-environment-and-segment-data"><a class="header" href="#1009---reload-specific-environment-and-segment-data">1009 - Reload specific environment and segment data</a></h4>
<p>This message can be used to reload environment and segment data into Navitrol <strong>from specific files</strong>. This can be useful in cases such as</p>
<ul>
<li>Environment and/or segment file does not follow naming pattern of <code>env*.nte</code> or <code>seg_*.xml</code></li>
<li>Environment and/or segment file does not locate in Navitrol installation directory (usually <code>/home/navitec/</code>)</li>
<li>There exists more than one environment or segment file</li>
</ul>
<p>Navitrol will respond</p>
<ul>
<li>First with an acknowledgement message 1109, which informs the sender if the reload request has been accepted. The request might be discarded if e.g. the filename does not have a null-character</li>
<li>If the request was accepted, Navitrol will send (in few seconds) a result message 1110, including the information of successful or failed environment and/or segment file reload</li>
</ul>
<p>Please use only ASCII based file naming, as using other codecs (such as UTF-8) can cause issues. Note, that directory levels are differentiated with <strong>forward slash</strong> <code>/</code> (character 47).</p>
<p>Hints:</p>
<ul>
<li>If only <strong>null-character</strong> <code>\0</code> is given either for the environment or segment filename (or both), Navitrol will search and select automatically this filetype (similarly as during Navitrol start up)
<ul>
<li>Note: Null-character <code>\0</code> has a size of one character, not two characters</li>
</ul>
</li>
<li>Filenames can be given with or without the directory prefix. If directory is not included, Navitrol will search the given filename from the directory Navitrol is installed in (usually <code>/home/navitec/</code>)</li>
<li>For reloading multiple environment files at once, a star <code>*</code> character can be used as a part of the filename (e.g. <code>env*.nte</code>)
<ul>
<li>Note 1: Using <strong>only</strong> a star <code>*</code> as a filename to search all files (e.g. <code>/folder/*</code>) is not allowed</li>
<li>Note 2: Only one segment file can be loaded at once</li>
</ul>
</li>
</ul>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.46.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1009</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12 +<br/>environment filename string length <strong>including null-character</strong> +<br/>segment filename string length <strong>including null-character</strong></td></tr>
<tr><td>Environment filename length (EFL)</td><td>Uint</td><td>2</td><td>Environment filename string length <strong>including null-character</strong> <code>\0</code> (min: 1, max: 256)</td></tr>
<tr><td>Segment filename length (SFL)</td><td>Uint</td><td>2</td><td>Segment filename string length <strong>including null-character</strong> <code>\0</code> (min: 1, max: 256)</td></tr>
<tr><td>Environment filename</td><td>Char[]</td><td>EFL</td><td>Name of the environment filename to load into Navitrol <strong>including null-character</strong> with or without directory prefix</br>Minimum length 1, maximum length 256</td></tr>
<tr><td>Segment filename</td><td>Char[]</td><td>SFL</td><td>Name of the segment filename to load into Navitrol <strong>including null-character</strong> without or without directory prefix</br>Minimum length 1, maximum length 256</td></tr>
</tbody></table>
<p>Example message:
| <strong>Cumulative bytes</strong>          | <strong>Value</strong> |
|---|---|
| 2  | 4    |
| 4  | 1009 |
| 8  | 54   |
| 10 | 13   |
| 12 | 29   |
| 25 | <code>test_map.nte\0</code> |
| 54 | <code>/home/navitec/test_route.xml\0</code> |</p>
<hr />
<h4 id="1011---request-version-info"><a class="header" href="#1011---request-version-info">1011 - Request version info</a></h4>
<p>This message can be used to request version information from Navitrol.</p>
<p>The version information will include software version and supervisor Protocol version.</p>
<p>Navitrol will respond with the &quot;Version info&quot;-message (1111).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1011</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1012---reboot-navitrol"><a class="header" href="#1012---reboot-navitrol">1012 - Reboot Navitrol</a></h4>
<p>This message can be used to reboot Navitrol software.</p>
<p>Navitrol will respond with the &quot;Reboot started&quot;-message (1112) and start the reboot.</p>
<p>Shutting down and restoring all processes might take up to 1 minute.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1012</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1013---set-time"><a class="header" href="#1013---set-time">1013 - Set time</a></h4>
<p>This message can be used to make Navitrol set the time of the IPC.</p>
<p>The given time is set to hardware real time clock and the system clock. The time should be given in local time zone.</p>
<p>Note: The IPC's time zone must be correct before this message will work as intended. To set the time zone, search for Linux guides on &quot;How to set the time zone in Linux&quot;.</p>
<p>Navitrol will respond with the &quot;Time set&quot;-message (1113).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1013</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>22</td></tr>
<tr><td>Year</td><td>Uint</td><td>4</td><td>Valid values [2000...]</td></tr>
<tr><td>Month</td><td>Uint</td><td>2</td><td>Valid values [1...12]</td></tr>
<tr><td>Date</td><td>Uint</td><td>2</td><td>Valid values [1...31]</td></tr>
<tr><td>Hour</td><td>Uint</td><td>2</td><td>Valid values [0...23]</td></tr>
<tr><td>Minute</td><td>Uint</td><td>2</td><td>Valid values [0...59]</td></tr>
<tr><td>Second</td><td>Uint</td><td>2</td><td>Valid values [0...59]</td></tr>
</tbody></table>
<hr />
<h4 id="1020---request-file-info"><a class="header" href="#1020---request-file-info">1020 - Request file info</a></h4>
<p>This message can be used to request the file information from Navitrol.</p>
<p>The file names can be used for example checking that the segment and environment files are up to date.</p>
<p>Navitrol will respond with the &quot;File info&quot;-message (1120).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1020</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1021---restart-can"><a class="header" href="#1021---restart-can">1021 - Restart CAN</a></h4>
<p>This message can be used to restart Navitrol's primary CAN communication.</p>
<p>Upon CAN restart Navitrol will change to preoperational state, clear CAN registers, and redefine SDOs. For example, if some other CAN device is rebooted Navitrol CAN communication might need to be also restarted, by either sending this message or restarting Navitrol.</p>
<p>Note: No restart will be done if the CAN communication was not active and configured when the message was received.</p>
<p>Navitrol will respond with &quot;CAN restart&quot;-message (1121) to confirm that the request was received.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1021</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1024---request-odometry-correction-data"><a class="header" href="#1024---request-odometry-correction-data">1024 - Request odometry correction data</a></h4>
<p>This message can be used to request odometry correction data from Navitrol.</p>
<p>The odometry correction data tells how well scanner data matches the odometry data. This message can be helpful when minimizing the odometry corrections during the calibration of an AGV.</p>
<p>Navitrol will respond with &quot;Odometry correction data response&quot;-message (1124).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.30.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1024</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1025---send-info-packages-to-navithor"><a class="header" href="#1025---send-info-packages-to-navithor">1025 - Send Info packages to Navithor</a></h4>
<p>This message can be used to send Info packages through Navitrol to Fleet Control</p>
<p>Supervisor can send Info packages to Navigation SW that are passed to Fleet Control Client for visualization. Info package description is of varying length and should always end with Null char ‘0’. This message is intended to be sent only when there is change to the active Info packages with minimum interval of 1 second (s).
The info packages are purely for information. AGV will not have any reaction to these.</p>
<p>Different info packages can be mapped to show static descriptions. These mappings are done based on the Info ID field. The static descriptions are written on Navithor to an override file. Please refer to Navithor documentation about <strong>Alarms configuration override</strong> for more detailed information.</p>
<p>Navitrol will respond with &quot;Info packages to Navithor response&quot;-message (1125).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.48.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1025</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10 + varying length (Info packages) <br />  Message length in bytes including all data fields (including Protocol Version and Message ID)</td></tr>
<tr><td>Number of active packages</td><td>Uint</td><td>2</td><td>Max 20 packages</td></tr>
<tr><td>Info Package</td><td>Info package[]</td><td>Varying length</td><td></td></tr>
</tbody></table>
<table><thead><tr><th><strong>Info package struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Info ID</td><td>Uint</td><td>4</td><td>Unique info package ID:s passed to Navithor. Based on the ID, the static descriptions with the dynamic description part are shown. (See Navithor documentation)</td></tr>
<tr><td>Info Type</td><td>Uint</td><td>2</td><td>0 – Info  <br />1 – Warning  <br />2 – Error</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
<tr><td>Number of Chars in dynamic description</td><td>Uint</td><td>2</td><td>Max 256 chars</td></tr>
<tr><td>Dynamic description</td><td>Chars[]</td><td>Number of chars</td><td>Dynamic description part is shown on Navithor alarm view after the static description. In addition, the info packages are shown on the Navithor map view as an event.</td></tr>
</tbody></table>
<hr />
<h4 id="1032---start-recording"><a class="header" href="#1032---start-recording">1032 - Start recording</a></h4>
<p>Starts the recording (Record &amp; Play functionality) of route and environment.
Navitrol responds with 1132 - Recording state.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.48</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1032</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1033---abort-recording"><a class="header" href="#1033---abort-recording">1033 - Abort recording</a></h4>
<p>Aborts the recording (Record &amp; Play functionality) of route and environment. The environment or route are not saved, but the AGV switches to the &quot;play&quot; state. 
Navitrol responds with 1132 - Recording state.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.48</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1033</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1034---save-recording"><a class="header" href="#1034---save-recording">1034 - Save recording</a></h4>
<p>Saves the recorded (Record &amp; Play functionality) route and environment. The AGV switches to the &quot;play&quot; state where it can repeat the recorded route.
Navitrol responds with 1132 - Recording state.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.48</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1034</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>40</td></tr>
<tr><td>Area name</td><td>Char[]</td><td>32</td><td>The desired name for the area that was recorded</td></tr>
</tbody></table>
<hr />
<h4 id="1035---select-parameter-set"><a class="header" href="#1035---select-parameter-set">1035 - Select parameter set</a></h4>
<p>Selects the active parameter set on the AGV using the same index and filenames as <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/../../../Miscellaneous/ParameterZones/ParameterZones-en.html">Parameter Zones</a> feature. 
<strong>Important note:</strong> Before taking this feature into use contact Navitec support to discuss what you are planning to do. This is required because changing some parameters at runtime might cause unwanted side effects and some might not do anything as they are only updated at Navitrol startup.
Navitrol responds with 1135 </p>
<ul>
<li>When this feature is used to select a parameter set that is not the default (-1), it disables the Parameter Zones (taking precedence over it).</li>
<li>When the defaut set is selected, Parameter Zones may change the active parameter set</li>
<li>If a parameter set is selected that doesn't have an associated parameter file, the default parameters will be activated.</li>
</ul>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.50</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1035</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Parameter set</td><td>Int</td><td>4</td><td>The index of the desired parameter set (0 to 3) or -1 to enable the default parameters</td></tr>
<tr><td>Reserved bytes</td><td>Uint</td><td>4</td><td>0, for future extensions</td></tr>
</tbody></table>
<hr />
<h4 id="3009---request-active-errors"><a class="header" href="#3009---request-active-errors">3009 - Request active errors</a></h4>
<p>This message can be used to request a list of error codes of all errors and warnings that are currently active on Navitrol.</p>
<p>Navitrol will respond with &quot;Error&quot;-message (201).</p>
<p>Note: messages 1005 and 1006 can also be used to request information about errors.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3009</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3025---initialize-position-using-reflectors"><a class="header" href="#3025---initialize-position-using-reflectors">3025 - Initialize position using reflectors</a></h4>
<p>This message can be used to request reflector-based position initialization from Navitrol. Reflector-based position initialization is a Navitrol feature that tries to initialize position based on the currently detected reflectors.</p>
<p>To initialize position AGV must be stationary and not performing load. Additionally, the message is ignored if position is already initialized.</p>
<p>Navitrol will respond with &quot;Position initialized&quot;-message (1101) when the position initialization has been completed. This can take several seconds.</p>
<p>Note: Before using this message see &quot;Navitrol Reflector based initialization&quot;-document on requirements and setup instructions.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3025</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3039---control-localization-scanners"><a class="header" href="#3039---control-localization-scanners">3039 - Control localization scanners</a></h4>
<p>This message can be used to enable and disable localization scanners while Navitrol is running or to ask the current state of the scanners. By default, all scanners configured to the system in params.txt are enabled.</p>
<p>Navitrol will respond with &quot;Localisation scanner status&quot;-message (3139).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3039</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>20</td></tr>
<tr><td>Requested action</td><td>Uint</td><td>2</td><td>0 - <strong>Request status</strong> <br />Do not control scanners. Request only current status.<br /> 1 - <strong>Control scanners</strong> <br />Control scanners according to the &quot;Enable / disable scanners&quot;-data field.</td></tr>
<tr><td>Control scanners</td><td>Bitfield</td><td>2</td><td>Disable / enabled scanners. This field is ignored if &quot;Control scanners&quot;-option was not selected in &quot;Requested action&quot;-data field.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Control scanners bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Rear scanner</td><td>0</td><td>0 - disable. 1 - Enable.</td></tr>
<tr><td>Front scanner</td><td>1</td><td>0 - disable. 1 - Enable.</td></tr>
<tr><td>Reserved</td><td>2-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3040---reset-fatal-errors"><a class="header" href="#3040---reset-fatal-errors">3040 - Reset fatal errors</a></h4>
<p>This message can be used to reset all fatal errors that are currently active. Fatal errors are set when Navitrol faces an issue it cannot automatically recover from. Before resetting such error, user should solve the issue that triggered the error.</p>
<p>Optionally fatal errors can be reset using Navitrol Monitor or Navithor client.</p>
<p>Navitrol will respond with &quot;Fatal errors reset&quot;-message (3140).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.30.01</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3040</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3045---request-travel-distance"><a class="header" href="#3045---request-travel-distance">3045 - Request travel distance</a></h4>
<p>This message can be used to request travel distance information form Navitrol. The travel distance information includes total travel distance since last reset (see message 3047) and the travel distance since Navitrol was last started. The travel distance is calculated cumulatively based on the odometry information.</p>
<p>If there is a need for resetting the travelled distance, &quot;Travel distance Reset&quot; (Message ID 3047) should be used.</p>
<p>Navitrol will respond with &quot;Travel distance&quot;-message (3145).</p>
<p>Message can be used, for instance, for visualization of the distance that AGV has covered. Alternatively, can be used for defining maintenance intervals.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3045</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3047---travel-distance-reset"><a class="header" href="#3047---travel-distance-reset">3047 - Travel distance reset</a></h4>
<p>The AGV supervisor can send this message to reset travelled distance.
Navitrol will respond with &quot;Travel distance&quot;-message (3145).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3047</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>18</td></tr>
<tr><td>Binary outputs</td><td>Bitfield</td><td>2</td><td>See bit definitions below</td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Binary output bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Reset from startup</td><td>0</td><td>Reset travelled distance from Navitrol start</td></tr>
<tr><td>Reset total</td><td>1</td><td>Reset total travelled distance</td></tr>
<tr><td>Reserved</td><td>2-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3049---obstacle-detection-set-detection-area"><a class="header" href="#3049---obstacle-detection-set-detection-area">3049 - Obstacle detection set detection area</a></h4>
<p>With this message the AGV supervisor can set the radius and angles for which the obstacle detection will be performed.</p>
<p>Navitrol will respond with message 3149.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.36.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3049</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>20</td></tr>
<tr><td>Radius</td><td>Float</td><td>4</td><td>Radius of obstacle detection circle.</td></tr>
<tr><td>Start angle</td><td>Float</td><td>4</td><td>First angle in AGV coordinate frame that obstacles should be detected. In degrees.</td></tr>
<tr><td>End angle</td><td>Float</td><td>4</td><td>Last angle in AGV coordinate frame that obstacles should be detected. In degrees.</td></tr>
</tbody></table>
<hr />
<h3 id="from-navitrol-to-supervisor"><a class="header" href="#from-navitrol-to-supervisor">From Navitrol to Supervisor</a></h3>
<h4 id="201---error"><a class="header" href="#201---error">201 - Error</a></h4>
<p>This message contains the error codes of all errors currently active in Navitrol.</p>
<p>With default parameters this message is sent as the reply to &quot;Request active errors&quot;-message (3009).</p>
<p>Sending of this message every time when active errors and warnings are changed can be enabled by setting <strong>veh_inte_error_message_send_only_on_request</strong>-parameter to value 0.</p>
<p>Sending this message periodically with a constant interval can be enabled by changing the value of <strong>veh_inte_heartbeat_interval</strong>-parameter from 0 to the desired interval (in milliseconds).</p>
<p>Information on how to handle errors can be found from &quot;Navitrol error descriptions&quot;-document.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>201</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12 + Error count * 4</td></tr>
<tr><td>Error count</td><td>Uint</td><td>4</td><td>The number of active errors.  Defines how many error codes will be sent.</td></tr>
<tr><td>Error codes</td><td>Uint[]</td><td>4 * Error count</td><td>Error codes of active errors</td></tr>
</tbody></table>
<hr />
<h4 id="202--errors-with-level"><a class="header" href="#202--errors-with-level">202 – Errors with level</a></h4>
<p>This message contains the error and warning codes of all errors currently active in Navitrol and the level of those errors. It can be used as an option to the message basic error message 201.</p>
<p><strong>veh_inte_error_message_type</strong>-parameter can be set to value 1 to use this message instead of the message 201.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>202</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>18 + Error count * 10</td></tr>
<tr><td>Level of highest error</td><td>Uint</td><td>2</td><td>The highest level of all active errors and warnings.<br />0 – None  <br />1 – Warning <br />2 – Error  <br />3 – Fatal error</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
<tr><td>Error count</td><td>Uint</td><td>4</td><td>The number of active errors (and warnings). <br />Defines how many “Error”-arrays will be sent.</td></tr>
<tr><td>Error</td><td>Error[]</td><td>10 * Error count</td><td>Error array containing information about all active errors and warnings.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Error struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error code</td><td>Uint</td><td>4</td><td>Error code of the error or warning</td></tr>
<tr><td>Error level</td><td>Uint</td><td>2</td><td>The level of the error or warning.<br />0 – None  <br />1 – Warning  <br />2 – Error  <br />3 – Fatal error</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1100---position-initialization-started"><a class="header" href="#1100---position-initialization-started">1100 - Position initialization started</a></h4>
<p>Navitrol sends this message as an immediate reply to the &quot;Initialize position&quot;-message (1001) to indicate that the request was received.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1100</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1101---position-initialized"><a class="header" href="#1101---position-initialized">1101 - Position initialized</a></h4>
<p>Navitrol sends this message to deliver the results of position initialization request from the supervisor (messages 1001, 1002 and 3025).</p>
<p>The results include information about if the initialization was successful and the initialized position (x, y, h). If position initialization failed the xyh-information should not be trusted.</p>
<p>Note: It will take several seconds from receiving the position initialization request to position initialization being ready and this message being sent.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1101</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>28</td></tr>
<tr><td>X</td><td>Float</td><td>4</td><td>X-map coordinate of the new position in meters</td></tr>
<tr><td>Y</td><td>Float</td><td>4</td><td>Y-map coordinate of the new position in meters</td></tr>
<tr><td>H</td><td>Float</td><td>4</td><td>Heading of the new position on the map in radians</td></tr>
<tr><td>Floor</td><td>Uint</td><td>4</td><td>The floor of the new position</td></tr>
<tr><td>Initialization result</td><td>Uint</td><td>2</td><td>0 - <strong>Failure</strong> <br />The position initialization can fail for example if  <br />- A good position is not found within <strong>pos_ini_max_d</strong>..-parameters from the given pos init point <br />- A good position is not found within value of <strong>pos_init_max_wait_time</strong>-parameter <br />- The AGV is not stationary state, it is performing load or there are scanner related errors active. <br />1 - <strong>Success</strong> <br />A good position was found near the given position initialization point and position was successfully initialized.</td></tr>
<tr><td>Position confidence</td><td>Uint</td><td>2</td><td>Position confidence percentage (1 - 100%) <br />Describes how well the laser measurements in the new position matches the seen environment.</td></tr>
</tbody></table>
<hr />
<h4 id="1104---teaching-startedstopped"><a class="header" href="#1104---teaching-startedstopped">1104 - Teaching started/stopped</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Start/stop teaching&quot;-message (1004).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1104</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Received command</td><td>Uint</td><td>2</td><td>0 - <strong>Invalid command</strong> <br />An unrecognized command was received in the message 1004. Nothing will be done. <br />1 - <strong>Starting teaching</strong> <br />Start teaching command was received. Teaching started will be started if it was not already active. <br />2 - <strong>Stopping teaching</strong> <br />Stop teaching command was received. Teaching will be stopped and teach file saved to the IPC.</td></tr>
</tbody></table>
<hr />
<h4 id="1105---error-description"><a class="header" href="#1105---error-description">1105 - Error description</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Request error description&quot;-message (1005). The message contains the requested error code and its description.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1105</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>212</td></tr>
<tr><td>Error code</td><td>Uint</td><td>4</td><td>The error code received in message 1005</td></tr>
<tr><td>Error description</td><td>Char[]</td><td>200</td><td>The description for the error code as NULL-terminated table of Chars. <br />If the given error code is unrecognized, &quot;not defined&quot; will be given as the description.</td></tr>
</tbody></table>
<hr />
<h4 id="1106---error-description-list"><a class="header" href="#1106---error-description-list">1106 - Error description list</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Request error description list&quot;-message (1006). The message contains error codes and error descriptions of all active errors.</p>
<p>Note: The table of error codes is sent first and the table of error descriptions second. The error code of index x will match the description of the same index.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1106</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12 + Error count * 204</td></tr>
<tr><td>Error count</td><td>Uint</td><td>4</td><td>The number of active errors.  <br />Defines how many error codes and descriptions will be sent.</td></tr>
<tr><td>Error codes</td><td>Uint[]</td><td>4 * Error count</td><td>Error codes of active errors</td></tr>
<tr><td>Error descriptions</td><td>Char[][]</td><td>200 * Error count</td><td>The description for the error code as NULL-terminated table of Chars.</td></tr>
</tbody></table>
<hr />
<h4 id="1107---log-saved"><a class="header" href="#1107---log-saved">1107 - Log saved</a></h4>
<p>Navitrol sends this message after taking a log triggered by the &quot;Save log&quot;-message (1007) has been completed. The message tells if taking the log was successful or not.</p>
<p>Note: It can take up to 20 seconds from receiving the request to sending this result message.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
<tr><td>6.28.06</td><td>The of this message was changed. In earlier versions the response was sent before the log saving progress was completed.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1107</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Log result</td><td>Uint</td><td>4</td><td>0 - <strong>Failure</strong> <br />Log taking will fail, if there has been less than 20 second from the last save log request <br />1... - <strong>Success</strong> <br />The number of saved log file</td></tr>
</tbody></table>
<hr />
<h4 id="1108---environment-and-segment-data-reload-result"><a class="header" href="#1108---environment-and-segment-data-reload-result">1108 - Environment and segment data reload result</a></h4>
<p>By default, Navitrol sends this message every time environment and segment data are (re)loaded. This data will be loaded at Navitrol start and reloaded when requested by sending &quot;Reload environment and segment data&quot;-message (1008) or by using Navitrol Monitor.</p>
<p>The message can be disabled by setting <strong>veh_inte_env_read_rply_msg</strong>-parameter to value 0.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1108</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Reload result</td><td>Uint</td><td>2</td><td>0 - <strong>Failure</strong> <br />Reloading environment and/or segment data failed. Either all required files were not found, or they were corrupted. Navitrol log will contain more information. <br />1 - <strong>Success</strong> <br />Environment and segment data was successfully loaded and taken into use.</td></tr>
</tbody></table>
<hr />
<h4 id="1109---specific-environment-and-segment-data-reload-acknowledgement"><a class="header" href="#1109---specific-environment-and-segment-data-reload-acknowledgement">1109 - Specific environment and segment data reload acknowledgement</a></h4>
<p>Navitrol will send this message as a <strong>first</strong> reply to the &quot;1009 - Reload specific environment and segment file response&quot; message. With this message, Navitrol informs the sender if the request message 1009 is valid. Rejection might happen e.g. due to a missing null-terminaton <code>\0</code> in the filename.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.46.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1109</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Request accepted</td><td>Uint</td><td>2</td><td>0 - <strong>Accepted</strong><br/>1 - <strong>Rejected</strong></td></tr>
</tbody></table>
<hr />
<h4 id="1110---specific-environment-and-segment-data-reload-result"><a class="header" href="#1110---specific-environment-and-segment-data-reload-result">1110 - Specific environment and segment data reload result</a></h4>
<p>Navitrol will send this message as a <strong>second</strong> reply to the &quot;1009 - Reload specific environment and segment file response&quot; message <strong>only if the request was accepted</strong> (see message 1109). With this message, Navitrol informs the sender if reloading the environment and/or segment data from specifc files succeeded or failed. Reloading might fail e.g. due to a non-existing filename in given directory.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.46.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1110</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Environment reload result</td><td>Uint</td><td>2</td><td>0 - <strong>Success</strong><br/>Environment data was successfully loaded and taken into use.</br>1 - <strong>Failure</strong><br/>Reloading specific environment file failed.</td></tr>
<tr><td>Segment reload result</td><td>Uint</td><td>2</td><td>0 - <strong>Success</strong><br/>Segment data was successfully loaded and taken into use.</br>1 - <strong>Failure</strong><br/>Reloading specific segment file failed.</td></tr>
</tbody></table>
<hr />
<h4 id="1111---version-info"><a class="header" href="#1111---version-info">1111 - Version info</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Request version info&quot;-message (1111). The message contains version number of Navitrol software and the supervisor communication Protocol version.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1111</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>16</td></tr>
<tr><td>Navitrol version</td><td>Uint</td><td>4</td><td>The version number of the Navitrol software running on the IPC. <br />This is sent in following format: <br />Major version * 10000 + Release version * 100 + hot fix version. <br />For example, 63202 = 6.32.02</td></tr>
<tr><td>Supervisor Protocol version</td><td>Uint</td><td>4</td><td>The version number of the latest supervisor communication protocol <br />This is sent in following format: <br />Protocol version * 10000  For example, 40000 = 4</td></tr>
</tbody></table>
<hr />
<h4 id="1112---reboot-started"><a class="header" href="#1112---reboot-started">1112 - Reboot started</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Reboot Navitrol&quot;-message (1012). After sending this message Navitrol will shut down and start again.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1112</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1113---time-set"><a class="header" href="#1113---time-set">1113 - Time set</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Set time&quot;-message (1013). The message contains information if the time given as the input was valid.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1113</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Time set result</td><td>Uint</td><td>2</td><td>0 - <strong>Failure</strong> <br />The values given in message 1013 were not in defined limits or setting time failed. Time was not set. <br />1 - <strong>Success</strong> <br />The time was successfully set.</td></tr>
</tbody></table>
<hr />
<h4 id="1120---file-info"><a class="header" href="#1120---file-info">1120 - File info</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Request file info&quot;-message (1020). The message contains information about the segment and environment files.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1120</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>56</td></tr>
<tr><td>Segment file version</td><td>Char[]</td><td>8</td><td>The segment file version number as NULL-terminated table of chars. If segment file is not found &quot;0&quot; will be returned.</td></tr>
<tr><td>Environment file version</td><td>Char[]</td><td>8</td><td>The environment file version number as NULL-terminated table of chars.</td></tr>
<tr><td>Area name</td><td>Char[]</td><td>32</td><td>The name of the area. The name is defined in Navithor Tools and is same as the default name of the Tools project file. <br />The first 32 characters of the name is given as table of chars. <br />Not guaranteed to be NULL-terminated</td></tr>
</tbody></table>
<hr />
<h4 id="1121---can-restart"><a class="header" href="#1121---can-restart">1121 - CAN restart</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Restart CAN&quot;-message (1021). The message confirms that the CAN restart request was received and the restart was initialized.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1121</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="1124---odometry-correction-data"><a class="header" href="#1124---odometry-correction-data">1124 - Odometry correction data</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Request odometry correction data&quot;-message (1024). The message returns latest odometry correction data including odometry autocorrection amounts and odometry correction averages. These values can be used to fine tune odometry calibration. - Closer these values are to the zero the better the calibration is between odometry and scanner data.</p>
<p>Note: These values are also visible in Navitrol Monitor's &quot;Odometry correction&quot;-chart.</p>
<p>The basic principle is that the automatic odometry corrections are applied to the received odometry values so that they would match the scanner data.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Automatic heading correction (<strong>H auto corr</strong>): Is <strong>added</strong> to the scanner angle. A typical reason for <strong>H auto corr</strong> is that the scanner zero angle is not accurately defined.</li>
<li>If automatic distance correction (<strong>ds auto corr</strong>) would have value 0.01 that would mean that the speed received from odometry is lower than the speed calculated from scanner data. The odometry speed matches scanner speed after being <strong>multiplied</strong> by the odometry correction value + 1.0 (1.01 in this case). A typical reason for distance correction would be inaccuracies in wheel rotation to AGV speed values calculations. For example, motor rotations per minute to meters per second might not be accurate. Automatic heading correction</li>
<li>(<strong>dh auto corr</strong>): The automatic heading correction is <strong>added</strong> to the odometry based heading. A typical reason for heading correction would be that the zero angle of the steer encoder has an offset compared to the real zero angle.</li>
</ul>
<p>See &quot;Automatic odometry correction&quot;-document for more information about the meaning of each value.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.30.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1124</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>44</td></tr>
<tr><td>Lat average corr</td><td>Float</td><td>4</td><td>Average latitudinal correction (unitless multiplier) <br />Positive value towards the left of the AGV.</td></tr>
<tr><td>Lon average corr</td><td>Float</td><td>4</td><td>Average longitudinal correction (unitless multiplier) <br />Positive value towards the front of AGV.</td></tr>
<tr><td>H average corr</td><td>Float</td><td>4</td><td>Average heading correction (degrees per meter) <br />Positive value to counterclockwise direction from AGV's heading.</td></tr>
<tr><td>H auto corr</td><td>Float</td><td>4</td><td>Automatic heading correction to reduce lateral position corrections (degrees per meter) <br />Positive value to counterclockwise direction from AGV's heading.</td></tr>
<tr><td>dh auto corr</td><td>Float</td><td>4</td><td>Automatic heading/rotation difference correction to reduce heading position corrections (degrees per meter) <br />Positive value to counterclockwise direction from AGV's heading.</td></tr>
<tr><td>ds auto corr</td><td>Float</td><td>4</td><td>Automatic drive distance correction to reduce longitudinal position corrections (unitless multiplier) <br />Positive value to forwards from the AGV.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>12</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1125---info-packages-to-navithor-response"><a class="header" href="#1125---info-packages-to-navithor-response">1125 - Info packages to Navithor response</a></h4>
<p>Navitrol sends this message to supervisor as a response to supervisor messages request (1025). If the response result is not accepted, validate that the length of the message is within limits (Number of active info packages, Number of chars in description).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.48</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1125</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Info packages result</td><td>Uint</td><td>2</td><td>0 - Accepted  <br /> 1 - Bad input data</td></tr>
<tr><td>Number of active info packages</td><td>Uint</td><td>2</td><td></td></tr>
</tbody></table>
<hr />
<h4 id="1135---parameter-set-selected"><a class="header" href="#1135---parameter-set-selected">1135 - Parameter set selected</a></h4>
<p>Navitrol sends this message to supervisor as a response to parameter set change request (1035).
Parameter change will fail if the index is out of bounds (-1 to 3 are valid) or if the AGV doesn't have a parameter file corresponding to the activated index. </p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.50</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1135</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Parameter change result</td><td>Uint16</td><td>2</td><td>0 - Succeeded  <br /> 1 - Failed</td></tr>
<tr><td>Reserved bytes</td><td>Uint</td><td>4</td><td>0, for future extensions</td></tr>
</tbody></table>
<hr />
<h4 id="3139---localization-scanner-status"><a class="header" href="#3139---localization-scanner-status">3139 - Localization scanner status</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Control localization scanners&quot;-message (3039). The message contains the current selection of localization scanners in use.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3139</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>20</td></tr>
<tr><td>Available scanners</td><td>Bitfield</td><td>2</td><td>The available scanners that have been configured to the system</td></tr>
<tr><td>Enabled scanners</td><td>Bitfield</td><td>2</td><td>The currently enabled scanners that are used in localization</td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Available scanners bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Rear scanner</td><td>0</td><td>0 - Not configured. 1 - Available.</td></tr>
<tr><td>Front scanner</td><td>1</td><td>0 - Not configured. 1 - Available.</td></tr>
<tr><td>Reserved</td><td>2-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Enabled scanners bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Rear scanner</td><td>0</td><td>0 - Disabled. 1 - Enabled.</td></tr>
<tr><td>Front scanner</td><td>1</td><td>0 - Disabled. 1 - Enabled.</td></tr>
<tr><td>Reserved</td><td>2-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3140---fatal-errors-reset"><a class="header" href="#3140---fatal-errors-reset">3140 - Fatal errors reset</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Reset fatal errors&quot;-message (3040). The message confirms that all fatal errors were reset. If they are instantly triggered again after receiving this message, the issue triggering the error has not been resolved.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.30.01</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3140</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3145---travel-distance"><a class="header" href="#3145---travel-distance">3145 - Travel distance</a></h4>
<p>Navitrol will send this message as a reply to the &quot;Request travel distance&quot;-message (3045). The message contains information about total travel distance since last reset (see message 3047) and the travel distance since Navitrol was last started.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3145</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>24</td></tr>
<tr><td>Travel distance</td><td>Float</td><td>4</td><td>Traveled distance in meters since Navitrol was last started.</td></tr>
<tr><td>Total travel distance</td><td>Float</td><td>4</td><td>Total traveled distance in meters since Navitrol was started the first time on the IPC or since last travel distance reset. The value is stored between Navitrol restarts in the &quot;startInfo.bin&quot;-file.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3149---obstacle-detection-result"><a class="header" href="#3149---obstacle-detection-result">3149 - Obstacle detection result</a></h4>
<p>To use this message, set Navitrol parameter <strong>obst_detection_mode = 1</strong>.</p>
<p>With this message, Navitrol reports the obstacles detected by the area specified in the latest “3049 – Obstacle detection set detection area“ message. This message will be sent periodically with each scan.</p>
<p>The obstacles will be reported in the form of lines. Each line will consist of x and y coordinates of the starting point and end point.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.36.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3149</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>16 + (NoL * 16)</td></tr>
<tr><td>Max distance of scan point</td><td>Float</td><td>4</td><td>Maximum distance a scan point can have from a detected line, in meters</td></tr>
<tr><td>Number of lines</td><td>Int</td><td>4</td><td>Number of lines (NoL)</td></tr>
<tr><td>Detected lines</td><td>Line[]</td><td>NoL * 16</td><td></td></tr>
</tbody></table>
<table><thead><tr><th><strong>Line struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Start Point X</td><td>Float</td><td>4</td><td>Meters, in world coordinates</td></tr>
<tr><td>Start Point Y</td><td>Float</td><td>4</td><td>Meters, in world coordinates</td></tr>
<tr><td>End Point X</td><td>Float</td><td>4</td><td>Meters, in world coordinates</td></tr>
<tr><td>End Point Y</td><td>Float</td><td>4</td><td>Meters, in world coordinates</td></tr>
</tbody></table>
<hr />
<h4 id="4100---log-triggered"><a class="header" href="#4100---log-triggered">4100 - Log Triggered</a></h4>
<p>When enabled by setting <strong>log_trigger_pass_to_supervisor</strong> to value 1, instead of taking a log Navitrol will send this message to supervisor automatically every time log taking is triggered by Navitrol Monitor or Navithor Server. After receiving this message Supervisor should trigger the log taking by using message 1007.</p>
<p>This approach has been used to synchronize supervisor and Navitrol log taking:</p>
<ul>
<li>The log taking is triggered from Navithor or Navitrol Monitor</li>
<li>Instead of taking the log Navitrol sends this message to supervisor</li>
<li>Supervisor takes log of its own and triggers Navitrol log (for example using the message 1007)</li>
<li>Navitrol will inform supervisor that taking a log is ready by sending message 1107</li>
<li>Supervisor can now make a package from its own logs and the Navitrol log</li>
</ul>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>4100</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Trigger source</td><td>Uint</td><td>2</td><td>The log taking was triggered by: <br />1 - Navitrol Monitor <br />2 - Navithor server</td></tr>
</tbody></table>
<hr />
<h2 id="position-control-messages"><a class="header" href="#position-control-messages">Position control messages</a></h2>
<p>These messages are related to position control and features requiring position control. They cannot be used in positioning only systems.</p>
<h3 id="from-supervisor-to-navitrol-1"><a class="header" href="#from-supervisor-to-navitrol-1">From Supervisor to Navitrol</a></h3>
<h4 id="1016---measurement-update-differential-drive"><a class="header" href="#1016---measurement-update-differential-drive">1016 - Measurement update differential drive</a></h4>
<p>This message can be used to provide odometry data to Navitrol in differential drive AGV systems in which supervisor handles the motor control and Navitrol gives the references.</p>
<p>See <em>Measurement update message.</em></p>
<p>Navitrol will reply with the &quot;Motor control differential drive&quot;-message (1116) containing calculated control references.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1016</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>26</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number.</em></td></tr>
<tr><td>Odometry left wheel</td><td>Uint</td><td>4</td><td>The cumulative encoder value from the left wheel. <br />The scale from encoder value to meters is defined by <strong>mot_ctrl_left_dist_scale</strong>-parameter <br />The overflow point must be from 0xffffffff to 0</td></tr>
<tr><td>Odometry right wheel</td><td>Uint</td><td>4</td><td>The cumulative encoder value from the right wheel. <br />The scale from encoder value to meters is defined by <strong>mot_ctrl_right_dist_scale</strong>-parameter <br />The overflow point must be from 0xffffffff to 0</td></tr>
<tr><td>Drive control</td><td>Uint</td><td>2</td><td>Drive control signal that defines if Navitrol is allowed to control the AGV: <br />1 - <strong>Activate auto mode</strong> <br />Navitrol is allowed to control the AGV. <br />2 - <strong>Activate supervisor error</strong> <br />Navitrol will perform <em>fast stop</em> and error ERROR_MOTOR_CONTROL_FAULT will be set. <br />3 - <strong>Activate manual mode</strong> <br />Navitrol will activate <em>manual mode</em> <br />4 - <strong>Activate emergency stop</strong> <br />Navitrol will perform <em>emergency stop</em> and following two warnings will be triggered: WARNING_AGV_EM_STOP and WARNING_ESTOP_ACTIVE</td></tr>
<tr><td>Timestamp</td><td>Uint</td><td>4</td><td>Cumulative time in milliseconds. Time base can be chosen freely.</td></tr>
</tbody></table>
<hr />
<h4 id="1017---measurement-update-steer-drive"><a class="header" href="#1017---measurement-update-steer-drive">1017 - Measurement update steer drive</a></h4>
<p>This message can be used to provide odometry data to Navitrol in steer drive AGV systems in which supervisor handles the motor control and Navitrol gives the references.</p>
<p>See <em>Measurement update message.</em></p>
<p>Navitrol will reply with the &quot;Motor control steer drive&quot;-message (1117) containing calculated control references.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1017</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>28</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em>.</td></tr>
<tr><td>Steering angle</td><td>Float</td><td>4</td><td>Measured steering angle (±PI in radians)</td></tr>
<tr><td>Wheel speed</td><td>Float</td><td>4</td><td>Measured speed for drive wheel (m/s)</td></tr>
<tr><td>Set drive mode</td><td>Uint</td><td>2</td><td>1 - <strong>Manual mode</strong> <br />Navitrol will activate <em>manual mode</em>. <br />2 - <strong>Automatic mode</strong> <br />Navitrol will activate <em>auto mode.</em></td></tr>
<tr><td>Timestamp</td><td>Uint</td><td>4</td><td>Cumulative time in milliseconds. Time base can be chosen freely.</td></tr>
<tr><td>Supervisor status</td><td>Bitfield</td><td>2</td><td>Supervisor status and control values  <br />1 - active. 0 - Not active.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Supervisor status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error</td><td>0</td><td>When active ERROR_MOTOR_CONTROL_FAULT will be set. <br />See <em>error.</em></td></tr>
<tr><td>Emergency stop</td><td>1</td><td>When active Navitrol will perform <em>emergency stop</em> and following two warnings will be triggered: WARNING_AGV_EM_STOP and WARNING_ESTOP_ACTIVE</td></tr>
<tr><td>Soft slow</td><td>2</td><td>When active Navitrol will perform <em>soft slow.</em></td></tr>
<tr><td>Soft stop</td><td>3</td><td>When active Navitrol will perform <em>soft stop.</em></td></tr>
<tr><td>Reserved</td><td>4-5</td><td>0 - Not in use</td></tr>
<tr><td>Charging (Obsolete)</td><td>6</td><td>Charging bit is obsolete. 3002 - Supervisor status Battery section Charging Active bit is used to handle charging active/inactive logic</td></tr>
<tr><td>Brake released</td><td>7</td><td>Informs Navitrol of the status of brakes. <br />When <ins>not active</ins> <em>hard stop</em> will be enabled.</td></tr>
<tr><td>Reserved</td><td>8-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1018---measurement-update-differentialsteer-drive"><a class="header" href="#1018---measurement-update-differentialsteer-drive">1018 - Measurement update differential&amp;steer drive</a></h4>
<p>This message can be used to provide odometry data to Navitrol in differential&amp;steer drive AGV systems in which supervisor handles the motor control and Navitrol gives the references.</p>
<p>See <em>differential&amp;steer drive</em> and <em>Measurement update message.</em></p>
<p>Navitrol will reply with the &quot;Motor control differential&amp;steer drive&quot;-message (1118) containing calculated control references.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1018</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>36</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em>.</td></tr>
<tr><td>Steer wheel angle</td><td>Float</td><td>4</td><td>Measured angle of the steer wheel (±PI in radians)</td></tr>
<tr><td>Steer wheel speed</td><td>Float</td><td>4</td><td>Measured speed for the steering wheel (m/s) Used only for statistics as the odometry is calculated from differential wheel speeds.  If the statistics are not needed, hex value 7FA00000 can be sent to indicate that the wheel speed is undefined.</td></tr>
<tr><td>Left diff wheel speed</td><td>Float</td><td>4</td><td>The measured speed of the left differential wheel (m/s)</td></tr>
<tr><td>Right diff wheel speed</td><td>Float</td><td>4</td><td>The measured speed of the right differential wheel (m/s)</td></tr>
<tr><td>Set drive mode</td><td>Uint</td><td>2</td><td>1 - <strong>Manual mode</strong> <br />Navitrol will activate <em>manual mode</em>. <br />2 - <strong>Automatic mode</strong><br /> Navitrol will activate <em>auto mode.</em></td></tr>
<tr><td>Timestamp</td><td></td><td>4</td><td>Cumulative time in milliseconds. Time base can be chosen freely.</td></tr>
<tr><td>Supervisor status</td><td>Bitfield</td><td>2</td><td>Supervisor status and control values  <br />1 - active. 0 - Not active.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Supervisor status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error</td><td>0</td><td>When active ERROR_MOTOR_CONTROL_FAULT will be set. <br />See <em>error.</em></td></tr>
<tr><td>Emergency stop</td><td>1</td><td>When active Navitrol will perform <em>emergency stop</em> and following two warnings will be triggered: WARNING_AGV_EM_STOP and WARNING_ESTOP_ACTIVE</td></tr>
<tr><td>Soft slow</td><td>2</td><td>When active Navitrol will perform <em>soft slow.</em></td></tr>
<tr><td>Soft stop</td><td>3</td><td>When active Navitrol will perform <em>soft stop.</em></td></tr>
<tr><td>Reserved</td><td>4-5</td><td>0 - Not in use</td></tr>
<tr><td>Charging (Obsolete)</td><td>6</td><td>Charging bit is obsolete. 3002 - Supervisor status Battery section Charging Active bit is used to handle charging active/inactive logic</td></tr>
<tr><td>Brake released</td><td>7</td><td>Informs Navitrol of the status of brakes. <br />When <ins>not active</ins> <em>hard stop</em> will be enabled.</td></tr>
<tr><td>Reserved</td><td>8-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1019---measurement-update-omni-drive"><a class="header" href="#1019---measurement-update-omni-drive">1019 - Measurement update omni drive</a></h4>
<p>This message can be used to provide odometry data to Navitrol in omni drive AGV systems in which supervisor handles the motor control and Navitrol gives the references. The newer, more generic message is recommended <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#1026---measurement-update-generic-omni-drive">1026 - Measurement update generic omni drive</a>.</p>
<p>See <em>Measurement update message.</em></p>
<p>Navitrol will reply with the &quot;Motor control omni drive&quot;-message (1119) containing calculated control references.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1019</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>54</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em>.</td></tr>
<tr><td>Obsolete</td><td>NA</td><td>2</td><td>0 - Not in use <br/>Previously &quot;Select measurement format&quot;</td></tr>
<tr><td>Angle of wheel 0</td><td>Float</td><td>4</td><td>Measured steering angle of wheel 0 (±PI in radians).</td></tr>
<tr><td>Speed of wheel 0</td><td>Float</td><td>4</td><td>Measured speed of wheel 0 (m/s).</td></tr>
<tr><td>Angle of wheel 1</td><td>Float</td><td>4</td><td>Measured steering angle of wheel 1 (±PI in radians).</td></tr>
<tr><td>Speed of wheel 1</td><td>Float</td><td>4</td><td>Measured speed of wheel 1 (m/s).</td></tr>
<tr><td>Obsolete</td><td>NA</td><td>16</td><td>0 - Not in use <br/>Previously Kinematic free measurements as 4 floats</td></tr>
<tr><td>Set drive mode</td><td>Uint</td><td>2</td><td>1 - <strong>Manual mode</strong> <br />Navitrol will activate <em>manual mode</em>. <br />2 - <strong>Automatic mode</strong> <br />Navitrol will activate <em>auto mode.</em></td></tr>
<tr><td>Timestamp</td><td>Uint</td><td>4</td><td>Cumulative time in milliseconds. Time base can be chosen freely.</td></tr>
<tr><td>Supervisor status</td><td>Bitfield</td><td>2</td><td>Supervisor status and control values  <br />1 - active. 0 - Not active.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Supervisor status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error</td><td>0</td><td>When active ERROR_MOTOR_CONTROL_FAULT will be set. <br />See <em>error.</em></td></tr>
<tr><td>Emergency stop</td><td>1</td><td>When active Navitrol will perform <em>emergency stop</em> and following two warnings will be triggered: WARNING_AGV_EM_STOP and WARNING_ESTOP_ACTIVE</td></tr>
<tr><td>Soft slow</td><td>2</td><td>When active Navitrol will perform <em>soft slow.</em></td></tr>
<tr><td>Soft stop</td><td>3</td><td>When active Navitrol will perform <em>soft stop.</em></td></tr>
<tr><td>Reserved</td><td>4-5</td><td>0 - Not in use</td></tr>
<tr><td>Charging (Obsolete)</td><td>6</td><td>Charging bit is obsolete. 3002 - Supervisor status Battery section Charging Active bit is used to handle charging active/inactive logic</td></tr>
<tr><td>Brake released</td><td>7</td><td>Informs Navitrol of the status of brakes. <br />When <ins>not active</ins> <em>hard stop</em> will be enabled.</td></tr>
<tr><td>Reserved</td><td>8-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1022---measurement-update-mecanum-drive"><a class="header" href="#1022---measurement-update-mecanum-drive">1022 - Measurement update mecanum drive</a></h4>
<p>This message can be used to provide odometry data to Navitrol in mecanum drive AGV systems in which supervisor handles the motor control and Navitrol gives the references.</p>
<p>See <em>Measurement update message.</em></p>
<p>Navitrol will reply with the &quot;Motor control mecanum drive&quot;-message (1122) containing calculated control references.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1022</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>48</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em>.</td></tr>
<tr><td>Speed of wheel 0</td><td>Float</td><td>4</td><td>Measured speed of wheel 0 (m/s).</td></tr>
<tr><td>Speed of wheel 1</td><td>Float</td><td>4</td><td>Measured speed of wheel 1 (m/s).</td></tr>
<tr><td>Speed of wheel 2</td><td>Float</td><td>4</td><td>Measured speed of wheel 2 (m/s).</td></tr>
<tr><td>Speed of wheel 3</td><td>Float</td><td>4</td><td>Measured speed of wheel 3 (m/s).</td></tr>
<tr><td>Set drive mode</td><td>Uint</td><td>2</td><td>1 - <strong>Manual mode</strong> <br />Navitrol will activate <em>manual mode</em>. <br />2 - <strong>Automatic mode</strong> <br />Navitrol will activate <em>auto mode.</em></td></tr>
<tr><td>Supervisor status</td><td>Bitfield</td><td>2</td><td>Supervisor status and control values  <br />1 - active. 0 - Not active.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Supervisor status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error</td><td>0</td><td>When active ERROR_MOTOR_CONTROL_FAULT will be set. <br />See <em>error.</em></td></tr>
<tr><td>Emergency stop</td><td>1</td><td>When active Navitrol will perform <em>emergency stop</em> and following two warnings will be triggered: WARNING_AGV_EM_STOP and WARNING_ESTOP_ACTIVE</td></tr>
<tr><td>Soft slow</td><td>2</td><td>When active Navitrol will perform <em>soft slow.</em></td></tr>
<tr><td>Soft stop</td><td>3</td><td>When active Navitrol will perform <em>soft stop.</em></td></tr>
<tr><td>Brake released</td><td>4</td><td>Informs Navitrol of the status of brakes. <br />When <ins>not active</ins> <em>hard stop</em> will be enabled.</td></tr>
<tr><td>Reserved</td><td>5-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1023---measurement-update-combined"><a class="header" href="#1023---measurement-update-combined">1023 - Measurement update combined</a></h4>
<p>This message can be used to provide odometry data to Navitrol in several different AGV systems in which supervisor handles the motor control and Navitrol gives the references.</p>
<p>Supported kinematic types:</p>
<ul>
<li>Differential drive (D)</li>
<li>Steer drive (S)</li>
<li>Omni drive (O)</li>
<li>Differential&amp;steer drive (DS)</li>
</ul>
<p>See <em>Measurement update message.</em> In following message definition, the &quot;Used by&quot;-column defines if the data field is used with a given kinematic system. The * -mark means that the value is optional for the connected machine type. If an optional field is not used, hex value 7FA00000 should be sent.</p>
<p>If a data field is not used by a kinematic type, constant 0 should be sent.</p>
<p>Navitrol will reply with the &quot;Motor control combined&quot;-message (1123) containing calculated control references.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th><th><strong>Used by</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td><td>All</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1023</td><td>All</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>44</td><td>All</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em>.</td><td>All</td></tr>
<tr><td>Angle of wheel 0</td><td>Float</td><td>4</td><td>Measured steering angle of wheel 0 (±PI in radians).</td><td>S, DS, O</td></tr>
<tr><td>Speed of wheel 0</td><td>Float</td><td>4</td><td>Measured speed of wheel 0 (m/s).</td><td>S, DS*, O</td></tr>
<tr><td>Angle of wheel 1</td><td>Float</td><td>4</td><td>Measured steering angle of wheel 1 (±PI in radians).</td><td>O</td></tr>
<tr><td>Speed of wheel 1</td><td>Float</td><td>4</td><td>Measured speed of wheel 1 (m/s).</td><td>O</td></tr>
<tr><td>Left diff wheel speed</td><td>Float</td><td>4</td><td>Measured speed of the left differential wheel (m/s)</td><td>D, DS</td></tr>
<tr><td>Right diff wheel speed</td><td>Float</td><td>4</td><td>Measured speed of the right differential wheel (m/s)</td><td>D, DS</td></tr>
<tr><td>Set drive mode</td><td>Uint</td><td>2</td><td>1 - <strong>Manual mode</strong> <br />Navitrol will activate <em>manual mode</em>. <br />2 - <strong>Automatic mode</strong> <br />Navitrol will activate <em>auto mode.</em></td><td>All</td></tr>
<tr><td>Time stamp</td><td>Uint</td><td>4</td><td>Cumulative time in milliseconds. Time base can be chosen freely.</td><td>All</td></tr>
<tr><td>Supervisor status</td><td>Bitfield</td><td>2</td><td>Supervisor status and control values  1 - active. 0 - Not active.</td><td>All</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Supervisor status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error</td><td>0</td><td>When active ERROR_MOTOR_CONTROL_FAULT will be set. <br />See <em>error.</em></td></tr>
<tr><td>Emergency stop</td><td>1</td><td>When active Navitrol will perform <em>emergency stop</em> and following two warnings will be triggered: WARNING_AGV_EM_STOP and WARNING_ESTOP_ACTIVE</td></tr>
<tr><td>Soft slow</td><td>2</td><td>When active Navitrol will perform <em>soft slow.</em></td></tr>
<tr><td>Soft stop</td><td>3</td><td>When active Navitrol will perform <em>soft stop.</em></td></tr>
<tr><td>Reserved</td><td>4-5</td><td>0 - Not in use</td></tr>
<tr><td>Charging (Obsolete)</td><td>6</td><td>Charging bit is obsolete. 3002 - Supervisor status Battery section Charging Active bit is used to handle charging active/inactive logic</td></tr>
<tr><td>Brake released</td><td>7</td><td>Informs Navitrol of the status of brakes. <br />When <ins>not active</ins> <em>hard stop</em> will be enabled.</td></tr>
<tr><td>Reserved</td><td>8-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1026---measurement-update-generic-omni-drive"><a class="header" href="#1026---measurement-update-generic-omni-drive">1026 - Measurement update generic omni drive</a></h4>
<p>This message can be used to provide odometry data to Navitrol in N wheel omni drive AGV systems in which supervisor handles the motor control and Navitrol gives the references.</p>
<p>See <em>Measurement update message.</em></p>
<p>Navitrol will reply with the &quot;Motor control generic omni drive&quot;-message (1126) containing calculated control references.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.52.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1026</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>18 + N wheels * Omni wheels struct <br/> Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em> in <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#glossary">Glossary</a></td></tr>
<tr><td>Set drive mode</td><td>Uint</td><td>2</td><td>1 - <strong>Manual mode</strong> <br />Navitrol will activate <em>manual mode</em>. <br />2 - <strong>Automatic mode</strong> <br />Navitrol will activate <em>auto mode.</em></td></tr>
<tr><td>Supervisor status</td><td>Bitfield</td><td>2</td><td>Supervisor status and control values, see <strong>Supervisor status bits</strong></td></tr>
<tr><td>Number of wheels</td><td>Uint</td><td>2</td><td>Number of omni wheels. Maximum 6, minimum 2.</td></tr>
<tr><td>Omni wheels[]</td><td>Omni wheels[]</td><td>Varying length</td><td>The steer angle and wheel speed of each individual wheel</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Supervisor status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error</td><td>0</td><td>When active ERROR_MOTOR_CONTROL_FAULT will be set. <br />See <em>error.</em> in <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#glossary">Glossary</a></td></tr>
<tr><td>Emergency stop</td><td>1</td><td>When active Navitrol will perform <em>emergency stop</em> and following two warnings will be triggered: WARNING_AGV_EM_STOP and WARNING_ESTOP_ACTIVE</td></tr>
<tr><td>Soft slow</td><td>2</td><td>When active Navitrol will perform <em>soft slow.</em></td></tr>
<tr><td>Soft stop</td><td>3</td><td>When active Navitrol will perform <em>soft stop.</em></td></tr>
<tr><td>Reserved</td><td>4-6</td><td>0 - Not in use</td></tr>
<tr><td>Brake released</td><td>7</td><td>Informs Navitrol of the status of brakes. <br />When <ins>not active</ins> <em>hard stop</em> will be enabled.</td></tr>
<tr><td>Reserved</td><td>8-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Omni wheels struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Steer angle</td><td>Float</td><td>4</td><td>In radians. Range is [-PI, PI]. Positive is counter-clockwise.</td></tr>
<tr><td>Wheel speed</td><td>Float</td><td>4</td><td>In m/s</td></tr>
</tbody></table>
<hr />
<h4 id="1030---measurement-update-actuators"><a class="header" href="#1030---measurement-update-actuators">1030 - Measurement update actuators</a></h4>
<p>This message is obsolete, not used anymore! Check messages 1031 and 1131.</p>
<hr />
<h4 id="1031---measurement-update-multiple-actuators"><a class="header" href="#1031---measurement-update-multiple-actuators">1031 - Measurement update multiple actuators</a></h4>
<p>This message can be used to provide measurement data to Navitrol from actuators in AGV systems in which supervisor handles the actuator control and Navitrol gives the references. This message should be sent periodically at constant interval.</p>
<p>Note: The max interval for sending this message is 2 seconds. If interval between two consecutive messages exceeds this time, error is set. Recommended interval is 100 or 200 ms.</p>
<p>Navitrol will reply with the &quot;Control multiple actuators&quot;-message (1131) containing calculated control references.</p>
<p>The &quot;Status detection available&quot; sensors are used only if there is Lift actuator in use. They can be used to define multiple load sensors. For example, if all &quot;Status detection available&quot; bits are active, it means that the lift has 11 load sensors and all &quot;Status bits&quot; need to be 1 (except the bits 5 and 6 that should be 0) to consider load detected. </p>
<p>Lift and Secondary lift actuators has also &quot;Load sensor used&quot; and &quot;Load detected with sensor&quot; bits on the &quot;Actuator status bits&quot; those can be used to define one sensor per actuator. </p>
<p>&quot;Actuator reference reached&quot; bit can be used to stop control of some actuator. One use case is for example, stopping the reach actuator during the pickup or drop-off sequence if some sensor detects that it has already moved to the target. However, the reference reached bit should be set to 0 as soon as actuator control is not requested anymore by Navitrol (Message ID 1131 Binary output, Bit0 - Activate actuator).</p>
<p>For more information see: <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/../../../LoadHandling/ActuatorControl/ActuatorControl-en.html">Actuator control</a> document.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.44</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1031</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Min 28, max 328. Depending how many actuators and sensors are sent</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em>.</td></tr>
<tr><td>Number of actuators</td><td>Uint</td><td>2</td><td>The number of actuators (NoA), each reported in a separate section. If 0, actuator section should not be sent. Maximum value 20.</td></tr>
<tr><td>Number of range measurements</td><td>Uint</td><td>2</td><td>Number of general range measurements (NoRM) on the machine. If 0, range measurement section should not be sent. Maximum value 10.</td></tr>
<tr><td>Actuator status section</td><td>Actuator[]</td><td>NoA * 12</td><td>Each section consists of: Actuator type, position measurement and status bits.</td></tr>
<tr><td>Status detection available</td><td>Uint</td><td>4</td><td>Defines whether a sensor is available on the machine to set each status bit. The bit order is corresponding to the status bits below. The bit is set if a sensor is available. For now, these can be used only as load sensors, they don't stop any actuator.</td></tr>
<tr><td>Status bits defining reaching of actuator targets</td><td>Uint</td><td>4</td><td>Status bits always the same independent of controlled actuator. Bit set if detection active. <br> Bit0 – Load reached contact left <br> Bit1 – Load reached contact right <br> Bit2 – Load distance reached <br> Bit3 – Fork tips through load  <br> Bit4 – Load detected above fork <br> Bit5 – Clearance above fork left <br> Bit6 – Clearance above fork right <br> Bit7 – Clearance below fork left <br> Bit8 – Clearance below fork right <br> Bit9 – Load contact sensor <br> Bit10 - Load secured <br> Bit11…31 – TBD</td></tr>
<tr><td>Safe control sensor available</td><td>Uint</td><td>2</td><td>Bit0…15 bits set for each available sensor</td></tr>
<tr><td>Safe control status bits</td><td>Uint</td><td>2</td><td>Not used yet. General safe control statuses, always the same independent of controlled actuator. A risk detection or a sensor malfunction sets the bit and the actuator is stopped if affected by that bit.  <br> Bit0 – Load misalignment <br> Bit1 – Fork collision left <br> Bit2 – Fork collision right <br> Bit3 – Fork tunnel left obstructed  <br> Bit4 – Fork tunnel right obstructed  <br> Bit5 – Mast obstacle detected  <br> Bit6 – Machine body obstacle detected <br> Bit7 – Load jammed (not matching actuation e.g., on conveyor) <br> Bit9…15 – TBD</td></tr>
<tr><td>General range measurement section</td><td>Sensor[]</td><td>NoRM * 6</td><td>Range measurements not directly related to any actuator. Each range measurement section contains a sensor type field and a measurement value field.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Actuator section</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Actuator type</td><td>Uint</td><td>2</td><td><strong>Basic type definition</strong> <br> 1 – Lift <br> 2 – Lift secondary <br> 3 – Reach <br> 4 – Tilt fork <br> 5 – Tilt mast (not implemented yet) <br> 6 – Tilt frame (not implemented yet) <br> 7 – Rotate fork <br> 8 – Side shift fork <br> 9 – Adjust fork width (not implemented yet) <br> 10 – Side tilt fork (not implemented yet) <br> 11 – Onboard conveyor (not implemented yet) <br> 12 – Lift scanner/camera <br> 13 – Load identification (not implemented yet) <br> 14 – Load securing on off (not implemented yet) <br> Others TBD <br> 1000 – Addition if not controllable by the navigation</td></tr>
<tr><td>Actuator status bits</td><td>Uint</td><td>2</td><td><strong>Status of the actuator</strong> <br> Bit0 – Actuator active <br> Bit1 – Actuator increasing <br> Bit2 – Actuator decreasing <br> Bit3 – Actuator reference reached <br> Bit4 – Actuator max limit reached <br> Bit5 – Actuator min limit reached <br> Bit6 – Actuator center limit reached <br> Bit7 - Load sensor used <br> Bit8 - Load detected with sensor <br> Bit9…14 TBD <br> Bit15 – Actuator error</td></tr>
<tr><td>Actuator position reading</td><td>Int</td><td>4</td><td><strong>Actuator position in millimeters or 0.1 degrees.</strong> <br> Lift - zero at low limit, positive upwards <br> Reach - zero at base, positive out from vehicle, towards load <br> Tilt fork - zero when horizontal, positive when fork tilted tips up <br> Tilt mast - zero when mast vertical, positive when mast angled towards vehicle (lifting fork tips) <br> Tilt frame - zero when leveled, positive when frame tilted fork side up (lifting fork tips) <br> Rotate fork - zero when straight forwards, positive CCW around vehicle seen from above (+-180 degrees) <br> Turn fork - zero when leveled, positive CCW seen from the fork base (+-180 degrees) <br> Fork side shift - zero when centered, positive to the left seen from the fork base <br> Fork width - distance between fork centerlines <br> Conveyor - zero at standstill, positive moving load in vehicle X or Y direction, increment since last stop <br> Lift scanner/camera - zero at fork load carrying level, positive up <br> Load identification - load ID number <br> Load securing - on-secured, off-not secure</td></tr>
<tr><td>Reserved actuator info</td><td>Int</td><td>4</td><td>Reserved for future use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Range measurement section</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Measurement type</td><td>Uint</td><td>2</td><td>Measurements type definition <br> 1 – Load distance (not implemented yet) <br> 2 – fork tip distance left (not implemented yet) <br> 3 – fork tip distance right (not implemented yet) <br> 4 – load weight (not implemented yet) <br> 5 – Load ID horizontal position (not implemented yet) <br> 6 – Load ID vertical position (not implemented yet) <br> N – TBD</td></tr>
<tr><td>Measurement value</td><td>Int</td><td>4</td><td>Signed measurement value. Distances in millimeters, angles in 0.1 degrees, weights in kilograms.</td></tr>
</tbody></table>
<hr />
<h4 id="3001---release-hold-state"><a class="header" href="#3001---release-hold-state">3001 - Release hold state</a></h4>
<p>This message can be used to release Navitrol from <em>hold state</em> to drive to the next destination symbolic point. Generates a <em>drive order</em>.</p>
<p>Requirements for releasing hold:</p>
<ul>
<li>Navitrol must be in <em>hold state</em></li>
<li>Supervisor drive orders must be enabled</li>
<li>The target must be reachable</li>
<li>Position error to the nearest route cannot be too large</li>
</ul>
<p>Navitrol will respond with the &quot;Hold state release&quot;-message (3101). The reply is sent immediately when the result of the request is known, which might take up to one second.</p>
<p>For more information see <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/../../../DriveControl/Standalone/Standalone-en.html">standalone</a> document where hold-release feature is described.</p>
<p>Note: <ins>Hold-point is not the same as stop-and-hold point.</ins> This message does not function with stop-and-hold points. For that check messages 3011 and 3111.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3001</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Drive destination</td><td>Uint</td><td>4</td><td>The destination where Navitrol will drive after it has been released from hold-symbolic point: <br />0 - Default destination <br />1 - 1st alternative destination <br />2 - 2nd alternative destination <br />3 - 3rd alternative destination</td></tr>
</tbody></table>
<hr />
<h4 id="3002---supervisor-status"><a class="header" href="#3002---supervisor-status">3002 - Supervisor status</a></h4>
<p><ins>This message must be sent periodically</ins> (maximum interval 1 second) to deliver the status of the supervisor to Navitrol.</p>
<p>The status message consists of sections. Only the default section must be always implemented. The other sections are optional and can be added behind the status section in any order.</p>
<p>Navitrol will reply with the &quot;Navitrol status&quot;-message (3102) containing the status of Navitrol and the requested sections.</p>
<h5 id="default-section"><a class="header" href="#default-section">Default section</a></h5>
<p>This section must always be included in the status message. The section can be used to stop the AGV and request Navitrol to include additional status section into the reply message 3102. If no additional sections are requested the reply message will contain only the default section of its own.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3002</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>14 + 2 * number of sections + length of sections</td></tr>
<tr><td>Status</td><td>Uint</td><td>2</td><td>General supervisor status: <br />0 - <strong>Not ok</strong> <br />ERROR_PLC_FAILURE will be activated, and additionally manual driving will be prevented. <br />1 - <strong>Ok</strong> <br />Navitrol is allowed to drive the AGV.</td></tr>
<tr><td>Set ESTOP</td><td>Uint</td><td>2</td><td>Used to set and release <em>emergency stop:</em> <br />0 - Release ESTOP <br />1 - Set ESTOP</td></tr>
<tr><td>Number of sections</td><td>Uint</td><td>2</td><td>The number of status sections requested from Navitrol.</td></tr>
<tr><td>Section ID</td><td>Uint[]</td><td>2 * n of sections</td><td>The IDs of the requested sections. Navitrol will include these sections in the reply message (3102).</td></tr>
</tbody></table>
<hr />
<h5 id="1---actuator-section"><a class="header" href="#1---actuator-section">1 - Actuator section</a></h5>
<p>This section can be sent to inform Navitrol of the actuator status. Note: Using Navitrol for actuator control requires setting and tuning several parameters. See, &quot;Navitrol - Actuator control&quot;-document before using this section. Navitrol will send the related actuator control references in Navitrol status section 5. If one is interested in them, supervisor should request the section in the default section of supervisor status message.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>1</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>14</td></tr>
<tr><td>Actuator value</td><td>Uint</td><td>4</td><td>Measured value of the actuator. Most commonly fork height in millimeters. However, for example position or rotation values could also be used.  <br />Zero value means the minimum actuator position.</td></tr>
<tr><td>Actuator inputs</td><td>Bitfield</td><td>1</td><td>Actuator status and control values  <br />1 - active. 0 - Not active.</td></tr>
<tr><td>Scanner zone inputs</td><td>Bitfield</td><td>1</td><td>Scanner warning zone inputs for wall monitor feature that triggers different stops based on scanner zones. <br />1 - active. 0 - Not active.  <br />Navitrol will use these values only if <strong>wallmon_use_veh_inte_eth_inputs</strong>-parameter has been set to 1. For more information see the &quot;wall monitor&quot; feature documentation.</td></tr>
<tr><td>Other inputs</td><td>Bitfield</td><td>1</td><td>Other actuator control related binary inputs. 1 - active. 0 - Not active.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>1</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Actuator inputs bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Actuator in use</td><td>0</td><td>Informs Navitrol that the actuator is in use. If active when on the route that has &quot;Strict actuator&quot;-route property, driving will be prevented. Route properties are used with Navithor Tools</td></tr>
<tr><td>Actuator low limit</td><td>1</td><td>When active informs Navitrol that the actuator is at the lowest position.</td></tr>
<tr><td>Actuator high limit</td><td>2</td><td>When active informs Navitrol that the actuator is at the highest position.</td></tr>
<tr><td>Load sensor in use</td><td>3</td><td>When active informs Navitrol that the load sensor is available and the &quot;Load detected&quot;-data field can be trusted.</td></tr>
<tr><td>Load detected</td><td>4</td><td>When active informs Navitrol that a load is detected by the load sensor. Only trusted if &quot;Load sensor in use&quot; is active.</td></tr>
<tr><td>Reserved</td><td>5-7</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Scanner zone inputs bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Front warning zone 1</td><td>0</td><td>Active means that front scanner warning zone 1 is triggered.</td></tr>
<tr><td>Front warning zone 2</td><td>1</td><td>Active means that front scanner warning zone 2 is triggered.</td></tr>
<tr><td>Rear warning zone 1</td><td>2</td><td>Active means that rear scanner warning zone 1 is triggered.</td></tr>
<tr><td>Rear waring zone 2</td><td>3</td><td>Active means that rear scanner warning zone 2 is triggered.</td></tr>
<tr><td>Reserved</td><td>4-7</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Other inputs bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Release stop &amp; hold</td><td>0</td><td>Can be used to release the AGV from a StopAndHold symbolic point. Use must be enabled by setting <strong>stop_and_hold_mode</strong>-parameter to value 1. <br /> The information if AGV is held in StopAndHold point can be find in status message 3102 section 5. <br /> For more information see <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/../../../DriveControl/StopAndHold/StopAndHold-en.html">Stop-and-hold</a> documentation.</td></tr>
<tr><td>Reserved</td><td>1-7</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="2---manual-section"><a class="header" href="#2---manual-section">2 - Manual section</a></h5>
<p>This section can be used to activate Navitrol's <em>manual mode</em> and give keyboard-like drive commands.</p>
<p>The available drive commands are forward, backward, left and right. Driving a curve is possible by giving left or right command simultaneously with a forward or backward command. The curvature is value of <strong>veh_inte_manual_ang_vel</strong>-parameter divided by the given drive speed.</p>
<p>Note: The &quot;remote control&quot;-section is prioritized over this one, if both are used.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td></td></tr>
<tr><td>Enable manual control</td><td>Uint</td><td>2</td><td>Used to enable manual control from this section: <br />0 - <strong>Enable control</strong> <br />Navitrol will activate <em>manual mode</em> and sets WARNING_ETH_MANUAL_MODE. This section can be used to drive the AGV. <br />1 - <strong>Disable control</strong> <br />Navitrol will ignore any controls from this section.</td></tr>
<tr><td>Forward</td><td>Uint</td><td>2</td><td>Drive forward command to Navitrol: <br />0 - Inactive 1 - Active</td></tr>
<tr><td>Backward</td><td>Uint</td><td>2</td><td>Drive backward command to Navitrol: <br />0 - Inactive 1 - Active</td></tr>
<tr><td>Left</td><td>Uint</td><td>2</td><td>Turn left command to Navitrol: <br />0 - Inactive 1 - Active</td></tr>
<tr><td>Right</td><td>Uint</td><td>2</td><td>Turn right forward command to Navitrol: <br />0 - Inactive 1 - Active</td></tr>
<tr><td>Drive speed</td><td>Float</td><td>4</td><td>The manual drive speed reference in meters per second.</td></tr>
</tbody></table>
<hr />
<h5 id="3---error-section"><a class="header" href="#3---error-section">3 - Error section</a></h5>
<p>This section can be used to display custom errors and warnings. When a custom error is set Navitrol will activate ERROR_PLC and when a custom warning WARNING_PLC.</p>
<p>For example, if the string length was fixed to 25 bytes and there is two warnings active with error codes &quot;3&quot; and &quot;2424&quot; and descriptions &quot;Error_Actuator_jammed&quot; and &quot;Error_Brake_failure&quot;, the message would look like this (displayed as characters):</p>
<p>3 0 64 1 0 0 2 0 # section ID + sect len (320 bytes) + active errors count <br />
3 0 0 0 25 21 E r r o r _ A c t u a t o r _ j a m m e d 0 0 0 0 # error 1 (total of 31 bytes) <br />
78 9 0 0 25 19 E r r o r _ B r a k e _ f a i l u r e 0 0 0 0 0 0 # error 2 (31 bytes) <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # error 3 (31 bytes) <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # error 4 <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # error 5 <br />
0 0 # active warnings count <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # warning 1 (31 bytes) <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # warning 2 <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # warning 3 <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # warning 4 <br />
0 0 0 0 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 # warning 5</p>
<p>Data for &quot;Total description length&quot; and &quot;Used description length&quot; must be sent, but they can be set to 0.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>3</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Total length of the section 10 + length of the 5 Error and the 5 Warning <br />Min 70. Max 2620.</td></tr>
<tr><td>Error count</td><td>Uint</td><td>2</td><td>Number of active errors.  <br />Note: Maximum of 5 custom descriptions will be shown.</td></tr>
<tr><td>Error data</td><td>Error[]</td><td>Total size of the 5 Errors</td><td>Error contains the error code and its description. Length of a single Error is 6 + total description length. There must always be 5 Errors. Each error can have different length.</td></tr>
<tr><td>Warning count</td><td>Uint</td><td>2</td><td>Number of active warnings.  Note: Maximum of 5 custom descriptions will be shown.</td></tr>
<tr><td>Warning data</td><td>Warning[]</td><td>Total size of the 5 Warnings</td><td>Warning contains the warning code and its description. Length of a single Warning is 6 + total description length. There must always be 5 Warnings. Each error can have different length.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Error data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error code</td><td>Uint</td><td>4</td><td>The error code of the custom error</td></tr>
<tr><td>Total description length</td><td>Uint</td><td>1</td><td>The total length of &quot;Error description&quot;-data field. <br />Maximum value 255.</td></tr>
<tr><td>Used description length</td><td>Uint</td><td>1</td><td>The displayed length of the error description. Navitrol will display only this number of chars from the beginning of given &quot;Error description&quot;. <br />Maximum value 50.</td></tr>
<tr><td>Error description</td><td>Char[]</td><td>Number of chars</td><td>The error description as an ASCII char array.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Warning data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Warning code</td><td>Uint</td><td>4</td><td>The warning code of the custom warning</td></tr>
<tr><td>Total description length</td><td>Uint</td><td>1</td><td>The total length of &quot;Warning description&quot;-data field. <br />Maximum value 255.</td></tr>
<tr><td>Used description length</td><td>Uint</td><td>1</td><td>The displayed length of the warning description. Navitrol will display only this number of chars from the beginning of given &quot;Warning description&quot;. <br />Maximum value 50.</td></tr>
<tr><td>Warning description</td><td>Char[]</td><td>Number of chars</td><td>The warning description as an ASCII char array.</td></tr>
</tbody></table>
<hr />
<h5 id="4---inputs-section"><a class="header" href="#4---inputs-section">4 - Inputs section</a></h5>
<p>This section can be used to deliver custom data from the supervisor software to the MES software using virtual inputs. Dataflow: supervisor - Navitrol - Navithor - MES. Navitrol and Navithor will not use the data. A use case example. The supervisor system knows if the AGV has lights on or of and this information is needed in MES system for example for visualization. This section can be used to define that for example the binary input of index 0 means contains the light status. Then MES system can read the data from &quot;InputValues&quot;-message coming from Navithor.  See also &quot;Navithor Fleer Control - Communication specification between Navithor and MES&quot;-document. To use this section the value of <strong>use_virtual_io</strong>-parameter must be set to 1.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>12 + bin count * 1 + int count * 4 + float count * 4</td></tr>
<tr><td>Binary input count</td><td>Uint</td><td>2</td><td>The number of inputs given in &quot;Binary inputs&quot;-array. <br />Supported values 0 - 32</td></tr>
<tr><td>Binary inputs</td><td>Uint[]</td><td>1 * binary count</td><td>An array of binary values. <br />Supported values 0 and 1.</td></tr>
<tr><td>Integer input count</td><td>Uint</td><td>2</td><td>The number of inputs given in &quot;Integer inputs&quot;-array. <br />Supported values 0 - 32</td></tr>
<tr><td>Integer inputs</td><td>Int[]</td><td>4 * int count</td><td>An array of integer values.</td></tr>
<tr><td>Float input count</td><td>Uint</td><td>2</td><td>The number of inputs given in &quot;Float inputs&quot;-array. <br />Supported values 0 - 32</td></tr>
<tr><td>Float inputs</td><td>Float[]</td><td>4 * float count</td><td>An array of floating-point number values.</td></tr>
</tbody></table>
<hr />
<h5 id="5---safety-scanner-section"><a class="header" href="#5---safety-scanner-section">5 - Safety scanner section</a></h5>
<p>This section can be used to inform Navitrol about triggered safety scanner zones and Navitrol will slow or stop and show warnings based on them.</p>
<p>Use of this section must be enabled by setting <strong>supervisor_safety_scanner_enabled</strong>-parameter to value 1.</p>
<p>Disclaimer - Navitrol is not a safety software. There should always be a safety PLC directly connected to the safety scanners to prevent collisions.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>5</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Warning zone 2</td><td>Uint</td><td>2</td><td>0 - Inactive 1 - Active <br />When active Navitrol will set WARNING_SAFETY_SCANNER_WARNING_ZONE2 and if <strong>wallmon_scanner_zone_mode</strong>-parameter is larger than 0 perform <em>soft slow</em>,</td></tr>
<tr><td>Warning zone 1</td><td>Uint</td><td>2</td><td>0 - Inactive 1 - Active <br />When active Navitrol will set WARNING_SAFETY_SCANNER_WARNING_ZONE1 and if value of <strong>wallmon_scanner_zone_mode</strong>-parameter is 1 perform <em>soft stop</em> and if it is 2 perform <em>hard stop.</em></td></tr>
<tr><td>Protection zone</td><td>Uint</td><td>2</td><td>0 - Inactive 1 - Active <br />When active Navitrol will set WARNING_SAFETY_SCANNER_PROTECTION_ZONE and if <strong>wallmon_scanner_zone_mode</strong>-parameter is larger than 0 perform <em>hard stop</em>,</td></tr>
</tbody></table>
<hr />
<h5 id="6---remote-control-section"><a class="header" href="#6---remote-control-section">6 - Remote control section</a></h5>
<p>This section can be used to manually drive the AGV with joystick-like controls.</p>
<p>The joystick vector should be within the unit circle (radius 1). In other words, the square root of ( (Joystick x)^2 + (joystick y)^2) must be equal or less than 1.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
<tr><td>6.34.00</td><td>Joystick1 control mode: 2 - Vector control was added. <br />Steer type must be set (<em>Mid wheel steer</em> is recommended as default). <br />Speed can be scaled with <strong>supervisor_remote_ctrl_speed_scale_pct</strong>-parameter.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>6</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>28</td></tr>
<tr><td>Joystick1 control mode</td><td>Uint</td><td>2</td><td>Selects the joystick 1 control mode: <br />0 - <strong>No control</strong> <br />Joystick 1 x and y values are ignored. <br />1 - <strong>Old control</strong> <br /><ins>Not recommended</ins> <br />Navitrol activates <em>manual mode.</em> Curvature is calculated directly from joystick 1 x value and the speed from joystick 1 y value. <br />2 - <strong>Vector control</strong> <br /> <ins>Recommended</ins><br />Navitrol activates <em>manual mode.</em> A unit vector is calculated from joystick 1 xy-values. The speed comes from the length of the vector (Positive when y is positive) and the curvature from its angle from the Y-axis. </br> For example AGV drives forward and curves right when x and y are positive. </br> For more information, see &quot;Joystick System&quot; chapter from <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/../../../CustomerUis/WebInterface/WebInterface-en.html">Web Interface</a> document</td></tr>
<tr><td>Joystick1 x</td><td>Float</td><td>4</td><td>Used for drive control. The behavior is defined by Joystick 1 control mode. <br />Valid values [-1...1]</td></tr>
<tr><td>Joystick1 y</td><td>Float</td><td>4</td><td>Used for drive control. The behavior is defined by Joystick 1 control mode. <br />Valid values [-1...1]</td></tr>
<tr><td>Joystick2 control mode</td><td>Uint</td><td>2</td><td>Selects the joystick 2 control mode: <br />0 - <strong>No control</strong> <br />Joystick 1 x and y values are ignored. <br />1 - <strong>Enable lift control</strong> <br />Navitrol activates <em>manual mode.</em></td></tr>
<tr><td>Joystick2 x</td><td>Float</td><td>4</td><td>0 - Not in use</td></tr>
<tr><td>Joystick2 y</td><td>Float</td><td>4</td><td>Lift actuator height reference control. <br />If the given y-value is larger than 0.1 actuator control is enabled. And the y-value is scaled with <strong>actuator_eth_ctrl_scale</strong>-parameter and added to the previous actuator reference. <br />The actuator reference can be controlled only between values of <strong>actuator_min_val</strong> and <strong>actuator_max_val</strong> parameters. <br />Valid values [-1...1]</td></tr>
<tr><td>Steer type selection</td><td>Uint</td><td>2</td><td>1 - <strong>Front wheel steer</strong> <br />Only for omni drives. Moves the navigation point to between the front wheels. With this steer type almost all turning control will be done by the rear wheels. <br />2 - <strong>Mid wheel steer</strong> <br />Normal driving. The normal navigation point is used. <br />3 - <strong>Rear wheel steer</strong> <br />Only for omni drives.  Moves the navigation point to between the rear wheels. With this steer type almost all turning control will be done by the front wheels. <br />5 - <strong>Pivot steer</strong> <br />Pivot curvature is always given, and supervisor can control only the speed up to maximum of <strong>pivot_speed</strong>-parameter. This mode should only be activated, if the AGV can pivot. <br />6 - <strong>Parallel steer forward</strong> <br /><ins>Only for omni drives.</ins> <br />The curvature in this mode is always zero. Instead of curvature supervisor controls the frame heading instead and speed. Wheels will rotate forward with positive speed reference. <br />7 - <strong>Parallel steer backward</strong> <br /><ins>Only for omni drives.</ins> <br />The curvature in this mode is always zero. Instead of curvature supervisor controls the frame heading instead and speed. Wheels will rotate backwards with positive speed reference.</td></tr>
</tbody></table>
<hr />
<h5 id="7---drive-control-section"><a class="header" href="#7---drive-control-section">7 - Drive control section</a></h5>
<p>This section can be used to disable Navitrol control from various sources.<br />
If a disabled source tries to control Navitrol WARNING_DRIVE_ORDER_DISABLED will be set.<br />
By default, Navitrol allows all control sources and just prioritizes them internally.</p>
<p>Note: Disabling a control source only prevents new drive orders. It does not affect the active drive order.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.14.00</td><td>Section added</td></tr>
<tr><td>6.42.00</td><td>When Web interface manual control is disabled, Web interface shows Manual not possible and all controls, other than Acknowledge Fatal Errors, are disabled. Warning WARNING_DRIVE_ORDER_DISABLED is not set in Navitrol in this case.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>7</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>8</td></tr>
<tr><td>Disable drive controls</td><td>Bitfield</td><td>2</td><td>Defines which drive control sources are disabled <br />1 - Disable. 0 - Enable.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Disable drive controls bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Supervisor - manual</td><td>0</td><td>Ethernet supervisor manual drive. <br />For example, controls from &quot;manual section&quot; and &quot;Remote control section&quot;</td></tr>
<tr><td>Supervisor - auto</td><td>1</td><td>Drive orders from ethernet supervisor <br />For example, orders using messages 3005, 3012, 3013...</td></tr>
<tr><td>Monitor - manual</td><td>2</td><td>Keyboard control from Navitrol monitor</td></tr>
<tr><td>Monitor - auto</td><td>3</td><td>All drive orders from Navitrol monitor</td></tr>
<tr><td>Web interface - manual</td><td>4</td><td><em>Web interface</em> control</td></tr>
<tr><td>Fleet control - auto</td><td>5</td><td>Fleet control drive orders</td></tr>
<tr><td>Backward drive</td><td>6</td><td>Triggers soft stop if trying to drive backwards</td></tr>
<tr><td>Forward drive</td><td>7</td><td>Triggers soft stop if trying to drive forwards</td></tr>
<tr><td>VDA 5050 - auto</td><td>8</td><td>VDA drive orders</td></tr>
<tr><td>Profinet supervisor</td><td>9</td><td>Any drive orders trough Profinet supervisor interface</td></tr>
<tr><td>Reserved</td><td>10-15</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="8---battery-section"><a class="header" href="#8---battery-section">8 - Battery section</a></h5>
<p>This section can be used for delivering battery information from supervisor to Navitrol. Other option would be to connect BMS (battery management system) directly to the IPC if the BMS model supported by Navitrol.</p>
<p>To use this section <strong>extbatt_if_type</strong>-parameter must be set to value 5. When in use Navitrol will set WARNING_AGV_NO_BATTERY_LEVEL, if it does not receive this section for more than value of <strong>extbatt_if_max_interval_ms</strong>-parameter.</p>
<p>If some of the data listed in this section is not available, constant &quot;Not available&quot; value must be sent instead.</p>
<p>See Navitrol battery management documentation for more information.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.22.03</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>8</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>30</td></tr>
<tr><td>State of charge</td><td>Uint</td><td>2</td><td>Battery state of charge percentage. <br />Valid values [0...100] <br />65535 - Not available <br />This will be used for determining the battery level if <strong>battery_percentage_from_mot_ctrl</strong>-parameter is set to 1.</td></tr>
<tr><td>Voltage</td><td>Uint</td><td>2</td><td>Battery voltage in 0.1 Volts.  <br />For example, 4.2V would be 42 <br />65535 - Not available <br />This will be used for determining the battery level if <strong>battery_percentage_from_mot_ctrl</strong>-parameter is set to 0.</td></tr>
<tr><td>Charge current / draw</td><td>Int</td><td>2</td><td>Charge current / current draw in 0.1 Amperes. <br />Negative values when battery is discharging and positive values when battery is being charged. <br />32767 - Not available <br />Only for statistics - visible in Navitrol Monitor.</td></tr>
<tr><td>Energy draw</td><td>Int</td><td>2</td><td>Energy draw in 0.1 Ampere hours <br />Negative values when battery is discharging and positive values when battery is being charged. <br />32767 - Not available <br />Only for statistics - visible in Navitrol Monitor.</td></tr>
<tr><td>Time remaining</td><td>Uint</td><td>2</td><td>Estimated time left in minutes until the battery is empty. <br />65535 - Not available <br />Only for statistics - visible in Navitrol Monitor.</td></tr>
<tr><td>State of health</td><td>Uint</td><td>2</td><td>Battery state of health percentage. Describes the overall state of the battery.  <br />Valid values [0...100] <br />65535 - Not available <br />Only for statistics - visible in Navitrol Monitor.</td></tr>
<tr><td>Temperature</td><td>Int</td><td>2</td><td>Battery temperature in Celsius degrees. <br />32767 - Not available <br />Used to trigger WARNING_BATTERY_HIGH_TEMPERATURE if given temperature is larger than <strong>battery_high_temperature_warning_limit_C</strong> and ERROR_BATTERY_HIGH_TEMPERATURE if larger than <strong>battery_high_temperature_error_limit_C</strong></td></tr>
<tr><td>Load cycle count</td><td>Uint</td><td>2</td><td>Total number of load cycles performed for the battery. <br />65535 - Not available <br />Only for statistics - visible in Navitrol Monitor.</td></tr>
<tr><td>Operating hours</td><td>Uint</td><td>2</td><td>Total number of operating hours of the battery. <br />65535 - Not available <br />Only for statistics - visible in Navitrol Monitor.</td></tr>
<tr><td>Charger voltage</td><td>Uint</td><td>2</td><td>Voltage of the charger in 0.1 Volts. <br />65535 - Not available <br />Only for statistics - visible in Navitrol Monitor.</td></tr>
<tr><td>Error status</td><td>Bitfield</td><td>2</td><td>Error status information.  <br />If any of the errors marked with * are active Navitrol Monitor will view its description and Navitrol set WARNING_BATTERY_ERROR_OR_WARNING_ACTIVE <br />0 - Error inactive. 1 - Error active</td></tr>
<tr><td>Binary data</td><td>Bitfield</td><td>1</td><td>Battery related binary data and requests <br />0 - Inactive. 1 - Active</td></tr>
<tr><td>Reserved</td><td>NA</td><td>1</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Error status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Communication error</td><td>0</td><td>BMS has lost the communication to the battery. *</td></tr>
<tr><td>Configuration error</td><td>1</td><td>Battery has not been correctly configured. *</td></tr>
<tr><td>Undervoltage</td><td>2</td><td>Undervoltage detected.  Operating voltage is low. Prepare to charge or replace the battery. *</td></tr>
<tr><td>Overvoltage</td><td>3</td><td>Overvoltage detected.  Overvoltage is a sustained voltage that exceeds the normal steady state limits. *</td></tr>
<tr><td>Overcurrent</td><td>4</td><td>Overcurrent detected.  Might be caused by overloading or short circuiting the battery. *</td></tr>
<tr><td>Temperature error</td><td>5</td><td>The temperature of the battery is at unsafe levels. * In addition, Navitrol will set ERROR_BATTERY_HIGH_TEMPERATURE</td></tr>
<tr><td>Internal defect</td><td>6</td><td>The battery has a defect and might not work properly. *</td></tr>
<tr><td>Bad state of health</td><td>7</td><td>The battery is worn down in use. It might not fully charge anymore. *</td></tr>
<tr><td>Faulty charger</td><td>8</td><td>The charger connected to the battery is not working.  *</td></tr>
<tr><td>Faulty contactor</td><td>9</td><td>The contactor of the battery is not working.  *</td></tr>
<tr><td>Current sensor defect</td><td>10</td><td>The current sensor of the battery is not working.  *</td></tr>
<tr><td>Temperature sensor defect</td><td>11</td><td>The temperature sensor of the battery is not working. *</td></tr>
<tr><td>Battery cell drift</td><td>12</td><td>Two or more battery cells are in imbalance. Can lead to over-charging or over-discharging harming the battery. *</td></tr>
<tr><td>Charging error</td><td>13</td><td>Error while charging the battery *</td></tr>
<tr><td>Generic error</td><td>14</td><td>This can be used to indicate that there is some other battery related error that is not listed above. *</td></tr>
<tr><td>Reserved</td><td>15-17</td><td>0 - Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Binary data bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Request charge</td><td>0</td><td>This charge request info is show in <em>motor control messages</em> and in Navitrol battery status section if <strong>charging_cmd_source</strong>-parameter is set to 3. <br /><ins>No drive orders or other actions are made based on this.</ins></td></tr>
<tr><td>Charging active</td><td>1</td><td>Informs Navitrol that charging is active.  Navitrol will set <em>soft stop.</em></td></tr>
<tr><td>Reserved</td><td>2-7</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="9---sleep-mode-state-section"><a class="header" href="#9---sleep-mode-state-section">9 - Sleep mode state section</a></h5>
<p>This section is used to inform the sleep mode state to the fleet control.
With the sleep mode feature, the fleet control can request AGVs to save battery. The command can be received by requesting <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#20---sleep-mode-command-section">sleep mode command section in 3102 status message</a>.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.56.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>9</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>8</td></tr>
<tr><td>Sleep mode state</td><td>Uint</td><td>2</td><td>0 = Normal operation <br> 1 = AGV in sleep <br> 2 = AGV in deep sleep</td></tr>
</tbody></table>
<hr />
<h5 id="12---trailer-transport-section"><a class="header" href="#12---trailer-transport-section">12 - Trailer transport section</a></h5>
<p>This section contains trailer transport status data required to coordinate the trailer coupling and uncoupling sequences. See the feature documentation for more information.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>12</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>26</td></tr>
<tr><td>Trailer coupling status</td><td>Uint</td><td>2</td><td>During coupling to or uncoupling from a trailer Navitrol sends “Trailer coupling actions” in 3102:17 and expects the Supervisor to perform the requested actions and send matching coupling status to indicate that it is ready for a next step.<br />Values:<br />0 = Unknown<br />1 = Uncoupled (actuator down)<br />2 = Ready for coupling  (actuator at kingpin height – ready drive to kingpin)<br />3 = Ready for uncoupling (actuator at kingpin height, lock released – ready drive from kingpin)<br />4 = Kingpin detected (Only used when driving to kingpin during coupling)<br />5 = Coupled (actuator up / trailer locked)</td></tr>
<tr><td>Scanner telescope status</td><td>Uint</td><td>2</td><td>The status of scanner telescope, that is used for trailer angle detection and docking to trailer.<br />0 = Unknown – Navitrol will stop<br />1 = Adjusting – Navitrol will stop<br />2 = Locked – Navitrol will trust and use scanner measurements from the pallet detection scanner</td></tr>
<tr><td>Scanner Telescope Length</td><td>Uint</td><td>4</td><td>Distance from the kingpin point of the AGV to scanner location (in meters).</td></tr>
<tr><td>Reserved</td><td>NA</td><td>12</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3003---request-symbolic-point-data"><a class="header" href="#3003---request-symbolic-point-data">3003 - Request symbolic Point data</a></h4>
<p>This message can be used to request data of all <em>symbolic point</em>s currently loaded to Navitrol. Symbolic points that have no connected routes will not be sent. |</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3003</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3004---release-hold-to-custom-destination"><a class="header" href="#3004---release-hold-to-custom-destination">3004 - Release hold to custom destination</a></h4>
<p>This message can be used to release Navitrol from hold-point to a custom destination symbolic point with a <em>drive order</em>. Navitrol will not be released if an invalid destination is given or no route to the given destination is found.</p>
<p>Navitrol will respond with &quot;Release hold to custom destination result&quot;-message (3104).</p>
<p>Note: <ins>Hold-point is not the same as stop-and-hold point.</ins> This message does not function with stop-and-hold points. For that check messages 3011 and 3111.</p>
<p><strong>Navithor supports this message from version 1.8.9.5 forwards.</strong></p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3004</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>ID of the desired destination symbolic point.</td></tr>
</tbody></table>
<hr />
<h4 id="3005---go-to-destination"><a class="header" href="#3005---go-to-destination">3005 - Go to destination</a></h4>
<p>This message can be used to create a <em>drive order</em> to the given symbolic point. The drive order to succeed:</p>
<ul>
<li>The given symbolic point must be defined
<ul>
<li>Defined destinations are listed in message &quot;Symbolic point data result&quot; 3103</li>
</ul>
</li>
<li>A suitable path to reach it must exist.</li>
<li>AGV must be on <em>stanby state</em></li>
<li>AGV has no active errors</li>
<li>Active drive control system
<ul>
<li>Either Standalone system with valid licenses</li>
<li>Or Navithor system with active connection</li>
</ul>
</li>
</ul>
<p>When Navitrol receives this message:</p>
<ul>
<li>In a standalone system Navitrol will try to find a path to the given symbolic point and drive there.</li>
<li>In a Navithor system Navitrol will forward the <em>production request</em> to Navithor. Navithor then creates the drive command.</li>
</ul>
<p>Navitrol will respond with &quot;Go to destination result&quot;-message (3105).</p>
<p><strong>Navithor supports this message from version 1.8.9.5 forwards.</strong></p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
<tr><td>6.42.00</td><td>In standalone systems the message can now be sent during a drive to change destination when <strong>route_driver_dest_update_enabled</strong>-parameter is set</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3005</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>ID of the desired destination symbolic point.</td></tr>
</tbody></table>
<hr />
<h4 id="3006---pause-drive"><a class="header" href="#3006---pause-drive">3006 - Pause drive</a></h4>
<p>This message can be used to pause the ongoing <em>drive order</em>. When pause is received Navitrol will keep the given destination, perform a <em>soft stop</em> and enter <em>pause state.</em> The paused drive can be resumed by sending &quot;Resume drive&quot;-message (3007). The information if Navitrol is paused can be seen in the default section of &quot;Navitrol status&quot;-message (3002).</p>
<p>Pause is released also if drive is aborted, in this case the paused drive order is discarded, and the drive will not continue.</p>
<p>In Navithor systems a <em>production request</em> is created.</p>
<p>Navitrol will respond with &quot;Pause drive result&quot;-message (3106).</p>
<p><strong>Navithor supports this message from version 1.8.9.5 forwards.</strong></p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3006</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3007---resume-drive"><a class="header" href="#3007---resume-drive">3007 - Resume drive</a></h4>
<p>This message can be used to resume a paused <em>drive order</em>.</p>
<p>The command will be rejected, if Navitrol is not in <em>pause state</em>.</p>
<p>In Navithor systems a <em>production request</em> is created and the AGV is taken into production.</p>
<p>Navitrol will respond with &quot;Resume drive result&quot;-message (3107).</p>
<p><strong>Navithor supports this message from version 1.8.9.5 forwards.</strong></p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3007</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3008---abort-drive"><a class="header" href="#3008---abort-drive">3008 - Abort drive</a></h4>
<p>This message can be used to abort an active <em>drive order</em> or discard a paused one.</p>
<p>When the command is received Navitrol will enter <em>standby state</em>.</p>
<p>In Navithor systems a <em>production request</em> is created, and the machine will be taken out of production. The production order will not be cleared the if the AGV is taken back to production it Navithor will create a new drive order based on it. Navitrol will respond with &quot;Drive aborted&quot;-message (3108).</p>
<p><strong>Navithor supports this message from version 1.8.9.5 forwards.</strong></p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3008</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3010---clear-production"><a class="header" href="#3010---clear-production">3010 - Clear production</a></h4>
<p>This message can be used to clear production orders for the AGV from Navithor fleet control system.</p>
<p>Navitrol will forward this <em>production request</em> to Navithor which will handle the clearing of production orders - <ins>This message can only be used with Navithor systems.</ins></p>
<p><ins>Navitrol will not respond to this message.</ins></p>
<p><strong>Navithor supports this message from version 1.8.9.5 forwards.</strong></p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3010</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3011---release-stop-and-hold"><a class="header" href="#3011---release-stop-and-hold">3011 - Release stop-and-hold</a></h4>
<p>This message can be used to release the AGV from a stop-and-hold position it had stopped for example to wait for a door to open. See <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/../../../DriveControl/StopAndHold/StopAndHold-en.html">Stop-and-hold</a> document for more details.</p>
<p>To use this message <strong>stop_and_hold_mode</strong>-parameter must be set to value 3.</p>
<p>Navitrol will respond with &quot;Stop hold released&quot;-message (3111).</p>
<p>Note: <ins>Stop-and-hold point is not the same as hold-point.</ins> This message does not cannot be used to release the AGV from a <em>hold state.</em> For that check messages 3001 and 3101.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3011</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3012---go-to-destination-with-route-offset"><a class="header" href="#3012---go-to-destination-with-route-offset">3012 - Go to destination with route offset</a></h4>
<p>This message can be used to create a drive order to a symbolic point with offset to the route and to the stopping point.</p>
<p><ins>See &quot;Drive order with offsets&quot; under &quot;Feature descriptions&quot;-chapter before using this message.</ins></p>
<p>Note: This message equals &quot;Go to destination&quot;-message (3005) with zero offsets. See drive preconditions from there.</p>
<p>In Navithor systems a <em>production request</em> is created.</p>
<p>Navitrol will respond with &quot;Go to destination with route offset result&quot;-message (3112).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.15.00</td><td>Message added</td></tr>
<tr><td>6.30.00</td><td><strong>drive_offset_enable_speed_ramp</strong>-parameter was added to enable improved speed ramps when stopping with an offset. When using this message, it is recommended to put value of this parameter to 1.</td></tr>
<tr><td>6.42.00</td><td>In standalone systems <strong>route_driver_dest_update_enabled</strong>-parameter was added to enable changing the destination without stopping.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3012</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>24</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>The ID of destination <em>symbolic point</em></td></tr>
<tr><td>Transversal drive offset</td><td>Float</td><td>4</td><td>Transversal offset to the route (in meters) for the drive. <br />Positive value to the left of the route <br />0 - No offset.</td></tr>
<tr><td>Longitudinal stopping offset</td><td>Float</td><td>4</td><td>Longitudinal offset (in meters) that is calculated from the location of the destination symbolic point.  <br />Positive value for driving past the end point. 0 - No offset.</td></tr>
<tr><td>Frame heading drive offset</td><td>Float</td><td>4</td><td>Frame heading offset for the whole drive. <br /><ins>Applied only for <em>omnidirectional AGV</em>s.</ins> <br />Positive value counterclockwise from the route vehicle heading. <br />0 - No offset.</td></tr>
</tbody></table>
<hr />
<h4 id="3013---go-to-destination-with-order-id"><a class="header" href="#3013---go-to-destination-with-order-id">3013 - Go to destination with order ID</a></h4>
<p>This message is the same as &quot;Go to destination with route offset&quot;-message (3012) but with an added &quot;drive order ID&quot; information. Standalone systems can use this message but there is no added benefit compared to message 3012 as the drive order ID is not used.</p>
<p><ins>See &quot;Drive order with offsets&quot; under &quot;Feature descriptions&quot;-chapter before using this message.</ins></p>
<p>See drive order preconditions from &quot;Go to destination&quot;-message (3005).</p>
<p>Drive order ID information can be used to for supervisor to track the given <em>drive orders</em>.</p>
<p>When the supervisor gives a drive order with order ID added, Navitrol creates a <em>production order</em> with the ID to Navithor. Navithor attaches this ID to the generated production order and reports it to Navitrol. Navitrol then forwards the information back to supervisor. In this way the supervisor can follow the status of an active drive order.</p>
<p>Navitrol will respond with &quot;Go to destination with order ID result&quot;-message (3113).  Additionally, Navitrol will enable automatic sending of &quot;Production order status update&quot;-message (3115). That message is sent every time Navithor changes the production status of the AGV and can be used to monitor which one of the given drive order IDs is currently active. The automatic sending can be controlled with &quot;Control production order status updates&quot;-message (3014).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.26.00</td><td>Message added</td></tr>
<tr><td>6.30.00</td><td><strong>drive_offset_enable_speed_ramp</strong>-parameter was added to enable improved speed ramps when stopping with an offset. When using this message, it is recommended to put value of this parameter to 1.</td></tr>
<tr><td>6.42.00</td><td>In standalone systems <strong>route_driver_dest_update_enabled</strong>-parameter was added to enable changing the destination without stopping.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3013</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>28</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>The ID of destination <em>symbolic point</em></td></tr>
<tr><td>Transversal drive offset</td><td>Float</td><td>4</td><td>Transversal offset to the route (in meters) for the drive. <br />Positive value to the left of the route <br />0 - No offset.</td></tr>
<tr><td>Longitudinal stopping offset</td><td>Float</td><td>4</td><td>Longitudinal offset (in meters) that is calculated from the location of the destination symbolic point.  <br />Positive value for driving past the end point. <br />0 - No offset.</td></tr>
<tr><td>Frame heading drive offset</td><td>Float</td><td>4</td><td>Frame heading offset for the whole drive. <br /><ins>Applied only for <em>omnidirectional AGV</em>s.</ins> <br />Positive value counterclockwise from the route vehicle heading. <br />0 - No offset.</td></tr>
<tr><td>Drive order ID</td><td>Uint</td><td>4</td><td>Identification number of the drive order. ID Can be freely chosen. <br />If same ID is sent consecutively more than once within a second, the duplicate request will be rejected.</td></tr>
</tbody></table>
<hr />
<h4 id="3014---control-production-order-status-updates"><a class="header" href="#3014---control-production-order-status-updates">3014 - Control production order status updates</a></h4>
<p>This message can be used to activate or deactivate the automatic sending of &quot;Production order status update&quot;-message (3115) that provides information of active Navithor production orders.</p>
<p>Note: Requesting status once option does not affect the active sending on update mode.</p>
<p><ins>This message can only be used with Navithor systems.</ins></p>
<p>Navitrol will respond with the &quot;Control production order status updates response&quot;-message (3114).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.26.00</td><td>Message added</td></tr>
<tr><td>6.42.00</td><td>Added request current status once option</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3014</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Control command</td><td>Uint</td><td>2</td><td>0 – Deactivate sending on update<br />1 – Activate sending on update<br />2 – Request current status once<br />Note: This will not affect sending on update</td></tr>
</tbody></table>
<hr />
<h4 id="3015---resume-drive-from-base-station"><a class="header" href="#3015---resume-drive-from-base-station">3015 - Resume drive from base station</a></h4>
<p>This message can be used to request a return to where the mission was aborted with 3033 (Abort drive with data) to return to base station.</p>
<p>In Navithor systems a <em>production request</em> is created, if Navithor is not connected this request does nothing.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.52.0</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3008</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3021---start-new-external-drive"><a class="header" href="#3021---start-new-external-drive">3021 - Start new external drive</a></h4>
<p><ins>This message will work only with <em>external fleet control</em> systems</ins> - the external fleet control must be enabled by setting <strong>fleet_control_type</strong>-parameter to value 2.</p>
<p><ins>See the &quot;Supervisor fleet control&quot; under the &quot;Feature descriptions&quot;-chapter.</ins></p>
<p>This message can be used to start new drive by providing a drive trajectory. To start a new drive Navitrol must be on <em>standby state,</em> if you would like to extend the current drive see message 3022.</p>
<p>Navitrol will respond with the &quot;Start external drive result&quot;-message (3121).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3021</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>16 + 20 * NTP</td></tr>
<tr><td>Trajectory type</td><td>Uint</td><td>2</td><td>Trajectory type defines the data in trajectory point array. Currently only one option: <br />1 - Trajectory point data</td></tr>
<tr><td>Number of trajectory points</td><td>Uint</td><td>4</td><td>The number of trajectory points (NTP) in the drive order. The length of the trajectory array given. <br />Valid values [2...400]</td></tr>
<tr><td>Trajectory point data</td><td>Trajectory point[]</td><td>20 * NTP</td><td>An array of trajectory points</td></tr>
<tr><td>Speed scale</td><td>Uint</td><td>2</td><td>A percentage for scaling down all the speed values given in the trajectory point array. <br />Valid values [0...100]</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Trajectory point data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>X-coordinate</td><td>Float</td><td>4</td><td>The X-map coordinate of the trajectory point in meters.</td></tr>
<tr><td>Y-coordinate</td><td>Float</td><td>4</td><td>The Y-map coordinate of the trajectory point in meters.</td></tr>
<tr><td>Frame heading</td><td>Float</td><td>4</td><td>The target frame heading of the AGV (in <em>map coordinate frame</em>) on the trajectory point in radians. <br />By default, the frame heading equals to the route heading. <br /><ins>Applied only for <em>omnidirectional AGVs</em></ins> when &quot;omni heading&quot;-point attribute has been enabled. <br />Valid values [-Pi...Pi]</td></tr>
<tr><td>Speed</td><td>Float</td><td>4</td><td>The target speed of the AGV on the trajectory point in meters per second. <br />Note: The speed of the AGV is limited by the given trajectory point speed (after the given &quot;speed scale&quot; has been applied) and <strong>mot_ctrl_max_wheel_v_fw</strong> and <strong>mot_ctrl_max_wheel_v_bw</strong> parameters, whichever is the most limiting.</td></tr>
<tr><td>Point attributes</td><td>Bitfield</td><td>4</td><td>The attributes of the trajectory point <br />0 - Disabled. 1 - Enabled.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Point attributes bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Pivot point</td><td>1</td><td>When Navitrol enters trajectory point with a pivot point attribute enabled pivot will be started. <br />Only the first and the last point of the trajectory can have this attribute enabled.</td></tr>
<tr><td>Omni heading</td><td>2</td><td>When enabled the given trajectory point &quot;frame heading&quot; data field is used.</td></tr>
<tr><td>Reserved</td><td>2-31</td><td>0 - Not in use.</td></tr>
</tbody></table>
<hr />
<h4 id="3022---extend-external-drive"><a class="header" href="#3022---extend-external-drive">3022 - Extend external drive</a></h4>
<p><ins>This message will work only with <em>external fleet control</em> systems</ins> - the external fleet control must be enabled by setting <strong>fleet_control_type</strong>-parameter to value 2.</p>
<p><ins>See the &quot;Supervisor fleet control&quot; under the &quot;Feature descriptions&quot;-chapter.</ins></p>
<p>This message can be used to extend current drive. Drive extensions are expected to overlap with previous drive/extension, so that the first point of the new extension has the same coordinates as the last point of the previous order/extension.</p>
<p>To extend a drive Navitrol must be on <em>auto state,</em> if you would like to start a new drive see message 3021.</p>
<p>Navitrol will respond with the &quot;Extend external drive result&quot;-message (3122).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3022</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>16 + 20 * NTP</td></tr>
<tr><td>Trajectory type</td><td>Uint</td><td>2</td><td>Trajectory type defines the data in trajectory point array. Currently only one option: <br />1 -Trajectory point data</td></tr>
<tr><td>Number of trajectory points</td><td>Uint</td><td>4</td><td>The number of trajectory points (NTP) in the drive order. The length of the trajectory array given. <br />Valid values [2...400]</td></tr>
<tr><td>Trajectory point data</td><td>Trajectory point[]</td><td>20 * NTP</td><td>An array of trajectory points <br /><ins>See message 3021 for the trajectory point array definition.</ins></td></tr>
<tr><td>Speed scale</td><td>Uint</td><td>2</td><td>A percentage for scaling down all the speed values given in the trajectory point array. <br />Valid values [0...100]</td></tr>
</tbody></table>
<hr />
<h4 id="3023---set-speed-limit"><a class="header" href="#3023---set-speed-limit">3023 - Set speed limit</a></h4>
<p>This message can be used to set the maximum speed limit or releasing previously given one. Navitrol will limit the reference speed to the given value or to the values of <strong>mot_ctrl_max_wheel_v_fw</strong> and <strong>mot_ctrl_max_wheel_v_bw</strong> parameters, whichever is the most limiting.</p>
<p>It has been used, for example, lowering the speed based on scanner warning zones.</p>
<p>This limit can be requested in any Navitrol state but will be active only in <em>auto</em> and <em>manual state</em>s. By default, when Navitrol goes to <em>standby state</em> the given speed limit will be cleared. This behavior can be disable by setting the value of <strong>supervisor_speedlimit_clear_on_standby</strong>-parameter to 0.</p>
<p>Navitrol will respond with the &quot;Set speed limit result&quot;-message (3123).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added (only for <em>external fleet control</em> systems)</td></tr>
<tr><td>6.28.00</td><td>Message can be used with any Navitrol control system</td></tr>
<tr><td>6.30.00</td><td>Added option to not clear the given speed limit when entering <em>standby state</em> with <strong>supervisor_speedlimit_clear_on_standby</strong>-parameter.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3023</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>14</td></tr>
<tr><td>Release / Set limit</td><td>Uint</td><td>2</td><td>Defines if a new speed limit should be set or an existing released: <br />0 - <strong>Release</strong> <br />Navitrol will use normal speed limits - usually the ones defined with <strong>mot_ctrl_max_wheel_v_fw</strong> and <strong>mot_ctrl_max_wheel_v_bw</strong> parameters. <br />1 - <strong>Set</strong>  <br />Navitrol will set the limit given in &quot;Speed limit&quot;-data field.</td></tr>
<tr><td>Speed limit</td><td>Float</td><td>4</td><td>The maximum speed for the AGV in meters per second. An absolute value that will be applied to all driving directions. Valid values [0...1000m/s] (Values over <strong>mot_ctrl_max_wheel_v</strong>...-parameters will have no effect.) <br />Ignored when releasing.</td></tr>
</tbody></table>
<hr />
<h4 id="3024---return-to-route"><a class="header" href="#3024---return-to-route">3024 - Return to route</a></h4>
<p>This message can be used to activate the &quot;return to route&quot;-feature of Navitrol. Return to route can be used when AGV is not on a defined route. The feature attempts to find the most optimal return path to any nearby route and automatically drive the AGV there.</p>
<p>To activate the &quot;return to route&quot;-feature Navitrol must be in <em>standby state.</em></p>
<p><ins>Before using this message, it is recommended to read the feature documentation and adjust related parameters.</ins></p>
<p>Tip: To determine if the AGV is on the route, the &quot;On route&quot;-data field of &quot;General section&quot; of &quot;Navitrol status&quot;-message (3102) can be used.</p>
<p>Navitrol will respond with the &quot;Return to route result&quot;-message (3124).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.15.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3024</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3028---set-custom-speed-array"><a class="header" href="#3028---set-custom-speed-array">3028 - Set custom speed array</a></h4>
<p>This message can be used to select a predefined custom array of speed and acceleration related parameters.</p>
<p>Up to 10 different speed settings can be defined with following array parameters:</p>
<ul>
<li><strong>mot_ctrl_max_wheel_v_fw_arr</strong>[] - Maximum speed limit forwards (m/s)</li>
<li><strong>mot_ctrl_max_wheel_v_bw_arr</strong>[] - Maximum speed limit backwards (m/s)</li>
<li><strong>mot_ctrl_max_wheel_acc_arr</strong>[] - Maximum acceleration rate (m/s^2)</li>
<li><strong>mot_ctrl_max_wheel_dec_arr</strong>[] - Maximum deceleration rate (m/s^2)</li>
<li><strong>max_turn_rate_deg_p_s_arr</strong>[] - Maximum turning rate of the AGV (deg/s)</li>
<li><strong>mot_ctrl_max_steer_rate_deg_p_s_arr</strong>[] - Maximum steer rate of a single wheel (deg/s)</li>
</ul>
<p>By default, and when released, the default versions of these parameters are used. The default parameters have the same names without the &quot;*_arr**[]&quot;-post fix.</p>
<p>Note: There is no need to define all these parameters in the params.txt file. For example, if one wants to only change the acceleration and deceleration, they can add only the related two array parameters and for the other ones, the values of the default parameters are used.</p>
<p>Note: The index of currently active speed array parameters can be requested with message 3052.</p>
<p>Navitrol will respond with the &quot;Select custom speed array result&quot;-message (3128).</p>
<p>Tip: If you want to only limit the speed, see message 3023.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3028</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Release / Set array</td><td>Uint</td><td>2</td><td>Defines if a new custom speed array should be selected or a previously selected one released: <br />0 - <strong>Release</strong><br /> Navitrol will use the default versions of the custom speed parameters.  <br />1 - <strong>Set</strong> <br />Navitrol will activate a set of custom speed array parameters defined by the index given in &quot;Parameter array index&quot;-data field.</td></tr>
<tr><td>Parameter array index</td><td>Uint</td><td>2</td><td>Defines the parameter array index to be selected/activated.  <br />If a parameter array of given index is not found from params.txt, the previous array will be released. <br />Valid values [0...9] <br />Ignored when releasing.</td></tr>
</tbody></table>
<hr />
<h4 id="3031---give-segment-drive-order"><a class="header" href="#3031---give-segment-drive-order">3031 - Give segment drive order</a></h4>
<p>This message can be used to drive to a xy-coordinates rather than a symbolic point using the exact path determined by the supervisor. Using this message requires a license for the standalone system and cannot be used with Navithor systems.</p>
<p><ins>See &quot;Drive order with offsets&quot; under &quot;Feature descriptions&quot;-chapter before using this message.</ins></p>
<p>To use this message supervisor must use the same <em>segment file</em> that Navitrol is using and use the route segments read from it to generate drive orders for Navitrol.</p>
<p>Requirements for segment drive order:</p>
<ul>
<li>The consecutive segments must be connected to each other.</li>
<li>The x and y end coordinates must be located on the last given segment.</li>
<li>When starting a drive, the AGV must be located on the first given segment.</li>
<li>When extending a drive, the first given segment must be the same as the last of the previous one and the AGV must not have passed the segment.</li>
</ul>
<p>Navitrol will respond with the &quot;Give segment drive order&quot;-message (3131).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added</td></tr>
<tr><td>6.30.00</td><td><strong>drive_offset_enable_speed_ramp</strong>-parameter was added to enable improved speed ramps when stopping with an offset. When using this message, it is recommended to put value of this parameter to 1.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3031</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>34 + NS * 2</td></tr>
<tr><td>Number of segments</td><td>Uint</td><td>2</td><td>Number of given segments (NS). <br />Valid values [1...50]</td></tr>
<tr><td>Segment IDs</td><td>Uint[]</td><td>2 * NS</td><td>Segment ID array in order from first to last. <br />The consecutive segments must be linked to each other.</td></tr>
<tr><td>End point X</td><td>Float</td><td>4</td><td>The x map coordinate of the end point of the drive, in meters.</td></tr>
<tr><td>End point Y</td><td>Float</td><td>4</td><td>The x map coordinate of the end point of the drive, in meters.</td></tr>
<tr><td>Transversal offset</td><td>Float</td><td>4</td><td>Transversal offset to the route (in meters) for the drive. <br />Positive value to the left of the route <br />0 - No offset.</td></tr>
<tr><td>Longitudinal offset</td><td>Float</td><td>4</td><td>Longitudinal offset (in meters) that is calculated from the location of the destination point.  <br />Positive value for driving past the end point. <br />0 - No offset.</td></tr>
<tr><td>Frame heading offset</td><td>Float</td><td>4</td><td>Frame heading offset for the whole drive. <br /><ins>Applied only for <em>omnidirectional AGV</em>s.</ins> <br />Positive value counterclockwise from the route vehicle heading. <br />0 - No offset.</td></tr>
<tr><td>Drive order type</td><td>Uint</td><td>2</td><td>The type of drive order: <br />0 - <strong>Start new drive</strong><br /> Navitrol must be on <em>standby state</em> <br />1 - <strong>Extend drive</strong> <br />Navitrol must be on <em>auto state.</em></td></tr>
<tr><td>Reserved</td><td>NA</td><td>2</td><td>0 - Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3032---set-target-detection-mode"><a class="header" href="#3032---set-target-detection-mode">3032 - Set target detection mode</a></h4>
<p>Pallet finding, reflector docking and pattern detection can be separately activated using this message. Note that only one target detection mode can be active at any given time - setting a new detection mode will be ignored if the previous detection mode has already found a target but has not reached it yet.</p>
<p>Navitrol will sent message 3132 as a response to this message telling if setting the new target detection mode was successful.</p>
<p>Parameter target_detection_type_selection must be set to value 5</p>
<p>Following parameters will be overridden when using this message:</p>
<ul>
<li>target_detection_type_selection</li>
<li>refl_det_version</li>
<li>refl_det_refl_width</li>
<li>refl_det_refl_dist_pattern[0-6]</li>
<li>refl_det_num_of_reflectors</li>
</ul>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3032</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 48</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Target detection mode to set</td><td>Uint</td><td>2</td><td>0 = Disable target detection <br />1 = Activate reflector docking <br />2 = Activate pallet detection (v2) <br />3 = Activate pattern detection <br />Note: Pallet detection can be used for both pallets and tables</td></tr>
<tr><td>Pallet(s) to detect</td><td>Bitfield 32</td><td>4</td><td><strong>Pallet detection:</strong>  <br />All targets are always searched but if the found target does not match the ones specified here Navitrol will stop and set an error. B<br />its [0...4] set to index to 1 to accept target or 0 to set an error if found.  The indexes match targets defined in params.txt [0 - 4] <br /><em>See pallet detection document for parameter definition instructions</em> <br />Bits [5...31]: reserved for future <br />Tip: Uint value 0xFFFFFFFF (or 4294967295 in decimal) will enable all targets. <br /><strong>Reflector docking and Pattern detection:</strong> <br />Value read but not used</td></tr>
<tr><td>Number of reflectors</td><td>Uint</td><td>2</td><td><strong>Reflector docking:</strong> <br />Defines the number of reflectors used in reflector docking Supported amounts: <br />2 = Two reflectors <br />4 = Four reflectors <br />Overrides parameter: refl_det_num_of_reflectors <br /><strong>Pallet detection and Pattern detection:</strong> Value read but not used</td></tr>
<tr><td>Reflector width</td><td>Uint</td><td>2</td><td><strong>Reflector docking and pattern detection:</strong> <br />Defines the width of the used reflectors in millimeters Overrides parameter: refl_det_refl_width  <br /><strong>Pallet detection:</strong> <br />Value read but not used</td></tr>
<tr><td>PatternDetReflDist[0]</td><td>Uint</td><td>2</td><td><strong>Pattern detection:</strong> <br />Distances (millimeter) between reflectors in pattern measured from center to center of the reflectors. The array should contain distances from leftmost [0] to rightmost [6]<br /> Note: All 7 does not need to be defined (value &gt; 0), but the ones that are, must be defined in order.  <br />Overrides parameter: refl_det_refl_dist_pattern[0]  <br /><strong>Pallet detection and reflector docking:</strong> <br />Value read but not used</td></tr>
<tr><td>PatternDetReflDist[1]</td><td>Uint</td><td>2</td><td>See PatternDetReflDist[0] for description. <br />Overrides parameter: refl_det_refl_dist_pattern[1]</td></tr>
<tr><td>PatternDetReflDist[2]</td><td>Uint</td><td>2</td><td>See PatternDetReflDist[0] for description. <br />Overrides parameter:  refl_det_refl_dist_pattern[2]</td></tr>
<tr><td>PatternDetReflDist[3]</td><td>Uint</td><td>2</td><td>See PatternDetReflDist[0] for description. <br />Overrides parameter:  refl_det_refl_dist_pattern[3]</td></tr>
<tr><td>PatternDetReflDist[4]</td><td>Uint</td><td>2</td><td>See PatternDetReflDist[0] for description. <br />Overrides parameter:  refl_det_refl_dist_pattern[4]</td></tr>
<tr><td>PatternDetReflDist[5]</td><td>Uint</td><td>2</td><td>See PatternDetReflDist[0] for description. <br />Overrides parameter:  refl_det_refl_dist_pattern[5]</td></tr>
<tr><td>PatternDetReflDist[6]</td><td>Uint</td><td>2</td><td>See PatternDetReflDist[0] for description. Overrides parameter:  refl_det_refl_dist_pattern[6]</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3033---abort-drive-with-data"><a class="header" href="#3033---abort-drive-with-data">3033 - Abort Drive with Data</a></h4>
<p>This message can be used if the drive abort has some data to be sent along with it. In case a drive needs to be aborted while setting the current production order as completed, this message has to be sent with status/control bitfield's bit 0 as 1.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3033</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 14</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Status/control</td><td>Bitfield</td><td>2</td><td></td></tr>
<tr><td>Reserved</td><td>Uint</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status/control bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Drive order completed</td><td>0</td><td>1 = End current drive order while setting it as 'completed' in Navithor <br />0 = End current drive order without setting the current drive order to be completed</td></tr>
<tr><td>Return to base</td><td>1</td><td>1 =  Request to return to base station, doesn't actually abort the drive in Navitrol, but Navithor should soon do it <br />0 = Do not request drive to base station</td></tr>
<tr><td>Reserved</td><td>2-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3034---pgv-data-request"><a class="header" href="#3034---pgv-data-request">3034 - PGV Data Request</a></h4>
<p>Supervisor sends this message to Navitrol to initiate sending of PGV Data Response message (3134). This message needs to be only sent once for starting or for stopping data flow.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3034</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 10</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Request data</td><td>Uint</td><td>2</td><td>0 = Stop request 1 = Start request</td></tr>
</tbody></table>
<hr />
<h4 id="3035---external-target-detection"><a class="header" href="#3035---external-target-detection">3035 - External target detection</a></h4>
<p>Navitrol gets x, y, height and angle difference of a target from a Supervisor target detection sensor. In addition, target locked / target detected information is sent to Navitrol. Supervisor will send Navitrol error code as well.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.30.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3035</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 38</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Target X difference from sensor</td><td>Float</td><td>4</td><td>X is the centre line of the detection sensor view</td></tr>
<tr><td>Target Y difference from sensor</td><td>Float</td><td>4</td><td>Y to the left from sensor X-axis</td></tr>
<tr><td>Target Z difference from camera/scanner</td><td>Float</td><td>4</td><td>Z is in vertical direction. Positive direction upwards. <br />Value forced to 0</td></tr>
<tr><td>Target angle difference between sensor heading and target heading</td><td>Float</td><td>4</td><td>0 along sensor X-axis, positive in CCW direction</td></tr>
<tr><td>Target found</td><td>Uint</td><td>2</td><td>0 = target not found <br />1 = target found</td></tr>
<tr><td>Error code</td><td>Uint</td><td>4</td><td>Device error code number <br />Value 0 = no errors</td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3036---coupled-drive-coupling-command"><a class="header" href="#3036---coupled-drive-coupling-command">3036 - Coupled drive: coupling command</a></h4>
<p>This message can be used to initialize coupled drive. Changing Navitrol state from STANDBY to COUPLED to prepare the coupling.</p>
<p>The leader sends the coupling reply message (3136) with the <strong>Coupling result</strong> &gt; 0 if coupling is not possible due to wrong state, bad ID, or other immediate reasons. Else the <strong>Coupling result</strong> is 0 (Coupling started) and the leader switches to coupled state. The Communication ok will be set to false in the coupled drive status message until the communication is established.</p>
<p>If communication OK is not set within a timeout the supervisor must send a decoupling command. This can only be done at loading stations, as the new coupling command will reset the initial formation data. If the communication is lost during a drive, the coupling shall remain while the communication is corrected.</p>
<p><strong>Rules of using this message</strong>:</p>
<ol>
<li>
<p>It must be sent to all AGVs that will be coupled</p>
</li>
<li>
<p>It must be sent to followers first and last to the leader</p>
</li>
<li>
<p>The receiving Navitrol must be in STANDBY state - Otherwise the message is rejected.</p>
</li>
<li>
<p>The coupling data of each AGV is an array of size 64 and must be defined in the following order:</p>
<ol>
<li>Leader</li>
<li>Follower 1</li>
<li>Follower 2</li>
<li>Follower 3</li>
</ol>
</li>
<li>
<p>The message is of variable length. Connection data is only sent to the AGVs in the coupling.</p>
<ul>
<li>Follower: Message length = 10
<ul>
<li>Includes only header and &quot;coupling mode&quot; data fields</li>
</ul>
</li>
<li>Leader: Message length = 44 + N * 64
<ul>
<li>Includes all data fields</li>
<li>N = &quot;Number of AGVs&quot;</li>
</ul>
</li>
</ul>
</li>
</ol>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3036</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length for:  <br />Leader =  44 + N * 64 = 172 or 236 <br />Follower = 10</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)  <br />N = &quot;Number of AGVs&quot;</td></tr>
<tr><td>Coupling mode</td><td>Uint</td><td>2</td><td>Chooses Coupling mode <br />1 = leader <br />2 = follower</td></tr>
<tr><td>-</td><td>-</td><td>-</td><td>Follower data ends here</td></tr>
<tr><td>Number of AGVs  = N</td><td>Uint</td><td>2</td><td>Number of AGVs in coupling <br />Minimum of 2 (1 leader, 1 follower) <br />Maximum of 3 (1 leader, 2 followers)</td></tr>
<tr><td>AGV coupling data[N]</td><td>Array of AGV coupling data</td><td>Variable: N * structure size (64)</td><td>Coupling data structs according to Number of AGVs in coupling</td></tr>
<tr><td>Load dimension front</td><td>Float</td><td>4</td><td><em>Load dimensions are used to define the size and navigation point of the coupled formation</em> <br />The front dimension of the load.  <br />Measured from the navigation point in meters. (Positive x-direction) <br />Valid range: [0.01, 1000]</td></tr>
<tr><td>Load dimension rear</td><td>Float</td><td>4</td><td>The rear dimension of the load. <br />Measured from the navigation point in meters. (Negative x-direction) <br />Valid range: [-1000, 0.01]</td></tr>
<tr><td>Load dimension left</td><td>Float</td><td>4</td><td>The left dimension of the load.<br /> Measured from the navigation point in meters. (Positive y-direction) <br />Valid range: [0.01, 1000]</td></tr>
<tr><td>Load dimension right</td><td>Float</td><td>4</td><td>The right dimension of the load. Measured from the navigation point in meters. (Negative x-direction) <br />Valid range: [-1000, 0.01]</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>AGV coupling data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>IP address</td><td>char[46]</td><td>46</td><td>The IP address is defined as null terminated string ( = char array ending with value 0) <br />Supports IPv4 and IPv6</td></tr>
<tr><td>Machine ID</td><td>Uint</td><td>2</td><td>Machine ID of the AGV Should match the machine ID defined in the params.txt of given AGV <br />Minimum = 1</td></tr>
<tr><td>X-position</td><td>Float</td><td>4</td><td>X-position of AGV relative to center point of the load  <br />Valid range: [-1000, 1000]</td></tr>
<tr><td>Y-position</td><td>Float</td><td>4</td><td>Y-position of AGV relative to center point of the load <br />Valid range: [-1000, 1000]</td></tr>
<tr><td>Heading</td><td>Float</td><td>4</td><td>Heading of the AGV relative to load heading (degrees) <br />Valid range: [-360, 360]</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3037---coupled-drive-decoupling-command"><a class="header" href="#3037---coupled-drive-decoupling-command">3037 - Coupled drive: decoupling command</a></h4>
<p>This message is used to decouple Navitrol from the coupled drive formation.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3037</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 8</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
</tbody></table>
<hr />
<h4 id="3038---request-drive-ready"><a class="header" href="#3038---request-drive-ready">3038 - Request drive ready</a></h4>
<p>The AGV supervisor can request Navitrol to set drive ready. It is possible to send the request either as generic case, or specifically for docking and buffer lanes. If sent as the generic drive ready request, Navitrol will stop anywhere and signal that drive is ready. If sent for specific cases, drive is set to ready if docking is active and it is requested to stop or AGV is on the buffer area and buffer lane ready is requested. Drive ready (ID 3129) is sent if the drive is stopped successfully.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3038</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Requested Drive Ready</td><td>Uint</td><td>2</td><td>What drive is requested to be ready. <br />0 = none, <br />1 = docking, <br />2 = buffer lane, <br />3 = generic.</td></tr>
</tbody></table>
<hr />
<h4 id="3042--trailer-transport-set-trailer-dimensions"><a class="header" href="#3042--trailer-transport-set-trailer-dimensions">3042 – Trailer Transport: Set Trailer Dimensions</a></h4>
<p>Navitrol expects this message before it can drive with a trailer. Navitrol will request this message using Trailer transport status section’s “Trailer dimensions request” data field.
The “Trailer dimensions request” will take a moment to update after trailer dimensions have been successfully set, so recommended minimum sent interval for “Set trailer dimensions” message is 1 second. If multiple dimensions are sent the first valid one will be accepted and taken into use any further messages are rejected with 3142.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3042</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>48</td></tr>
<tr><td>Wheel track</td><td>Float</td><td>4</td><td>Transversal distance between wheels center to center  <br />On the innermost axle</td></tr>
<tr><td>Wheel Diameter</td><td>Float</td><td>4</td><td>Wheel diameter (longitudinal dimension at scanner height can be calculated)  <br />On the innermost axle</td></tr>
<tr><td>Wheel Width</td><td>Float</td><td>4</td><td>Width of one wheel if double wheels  <br />On the innermost axle</td></tr>
<tr><td>Distance to Trailer Navigation point</td><td>Float</td><td>4</td><td>Navigation point is the midpoint between two axles, center axle if three axles  <br />Measured from kingpin</td></tr>
<tr><td>Distance to frontmost wheel axle</td><td>Float</td><td>4</td><td>Measured from kingpin</td></tr>
<tr><td>Distance to rearmost wheel axle</td><td>Float</td><td>4</td><td>Measured from kingpin</td></tr>
<tr><td>Distance to trailer back end</td><td>Float</td><td>4</td><td>Measured from kingpin</td></tr>
<tr><td>Reserved</td><td>NA</td><td>12</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3043---coupled-drive-request-coupling-configuration"><a class="header" href="#3043---coupled-drive-request-coupling-configuration">3043 - Coupled drive: request coupling configuration</a></h4>
<p>The AGV supervisor can send this message to request version information from Navitrol. Navitrol replies with the coupling configuration message (Message ID 3143).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3043</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 8</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
</tbody></table>
<hr />
<h4 id="3044---send-schwarzmueller-tpdo-request"><a class="header" href="#3044---send-schwarzmueller-tpdo-request">3044 - Send Schwarzmueller TPDO Request</a></h4>
<p>The AGV supervisor can send this message to request Schwarzmueller data from Navitrol. Navitrol replies with the Schwarzmueller TPDO Response message (Message ID 3144).</p>
<p>This message valid only for AGVs that are using Schwarzmueller motor controller. Navitrol is sending back raw TPDO received from the CAN bus.</p>
<p>This message can be used, for instance, for troubleshooting or visualization on the PLC's side. </p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3044</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 8</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
</tbody></table>
<hr />
<h4 id="3046---omni-steering-angle-request"><a class="header" href="#3046---omni-steering-angle-request">3046 - Omni steering angle request</a></h4>
<p>The AGV supervisor can send this message to request information about measured and target steering angle for Omni AGV.</p>
<p>The message can be used, for instance, for visualization purposes.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3046</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 8</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
</tbody></table>
<hr />
<h4 id="3050---request-symbolic-points-on-agv-path"><a class="header" href="#3050---request-symbolic-points-on-agv-path">3050 - Request symbolic points on AGV path</a></h4>
<p>With this message the AGV supervisor can request symbolic point IDs on AGV path. Navitrol replies with Symbolic points on AGV path response (Message ID 3150).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.38.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3050</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3051--pivot-to-target-heading"><a class="header" href="#3051--pivot-to-target-heading">3051 – Pivot to target heading</a></h4>
<p>The AGV supervisor can send this message to Navitrol to pivot the AGV to a defined target heading. Navitrol immediately responds with &quot;Pivot to target heading started&quot;-message (3153) and additionally will reply if the pivoting was successful with Message ID 3151. The AGV must be in Standby state when this message is sent. If the pivoting cannot be started or it is interrupted before the target is reached, reply with reject reason will be sent.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.42.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3051</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>18</td></tr>
<tr><td>Target heading to pivot</td><td>Float</td><td>4</td><td>Heading in world coordinates in degrees. <br />Range ±180°</td></tr>
<tr><td>Pivoting direction</td><td>Uint</td><td>2</td><td>0 = Shortest angle to pivot<br />1 = CW (clockwise)<br />2 = CCW (counterclockwise)</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3052--request-active-custom-speed-array-index"><a class="header" href="#3052--request-active-custom-speed-array-index">3052 – Request active custom speed array index</a></h4>
<p>The AGV supervisor can request the index of the currently active custom speed array parameters set by message 3028. This information can be used for example to check if the desired custom speed array is active.</p>
<p>Navitrol will respond with message 3152.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.42.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3052</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Reserved</td><td>NA</td><td>2</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3054--object-model-information"><a class="header" href="#3054--object-model-information">3054 – Object model information</a></h4>
<p>This AGV supervisor message can set the object model dimension for target detection, the expected centre and the detection type. The dimension of the pallet/cart/table is given as polygon positions. Symmetric and asymmetric pallets are supported. Examples for how the leg and leg points are defined for symmetric and asymmetric pallets is visualized below:</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/palletlegpolygons.png" alt="" /></p>
<p>The leg polygon point order for more complex leg shapes are visualized below:</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/legpolygonpointorder.PNG" alt="" /></p>
<p>The leg polygon points can be defined around the leg's axis of rotation if the legs are e.g. castor wheels. An offset is computed based on the deviation between geometric centre and the axis of rotation. In the below Figure the geometric centre is given visualized as a black circle and the axis of rotation as the blue circle. In the example the offset X is positive.</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/legoffset.PNG" alt="" /></p>
<p>An immediate response will be sent if the obtained pallet is invalid. A pallet is valid if:<br />
General:</p>
<ul>
<li>The number of polygon points in a leg corresponds to <em>Additional leg information</em></li>
</ul>
<p>Symmetric pallets:</p>
<ul>
<li>2 or 3 columns and rows of legs</li>
<li>Minimum of 4 legs and maximum of 9 legs</li>
<li>Number of legs corresponds to the number of columns * number of rows</li>
</ul>
<p>Asymmetric pallets:</p>
<ul>
<li>4 legs</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Min</th><th>Default</th><th>Max</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I, target_detection_maximum_iterations</strong></td><td>1</td><td>10</td><td>50</td><td>The maximum number of target detection iterations to be performed before response. The returned pose is the average of the successful detections</td></tr>
<tr><td><strong>I, pallet_model_definition_mode</strong></td><td>0</td><td>1</td><td>2</td><td>Defines where the pallet model information is to be obtained. 0 - None, 1 - Parameters, 2 - Supervisor</td></tr>
<tr><td><strong>F, pallet_det_target_pose_error</strong></td><td>0.05</td><td>0.2</td><td>3.0</td><td>Maximum target distance deviation between estimated centre point and target</td></tr>
</tbody></table>
<p>Set parameter <strong>pallet_model_definition_mode</strong> to 2.</p>
<p>Navitrol will respond with message 3154.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.44.00</td><td>Message added</td></tr>
<tr><td>6.56.00</td><td>Vehicle coordinate support</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3054</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>44 + N legs * (12 + N leg points * 8)</td></tr>
<tr><td>Detection type</td><td>Uint</td><td>2</td><td>Type of detection | Estimated target pose is informed in global (x) or vehicle (1x) coordinate frame<br/>- Cart detection | 1 or 11<br/>- Pallet detection | 2 or 12<br/>- Table detection | 3 or 13<br/>- Box | 4 or 14<br/></td></tr>
<tr><td>Object model id</td><td>Uint</td><td>2</td><td>Number identifying the object type - for verification that the right model is reported back</td></tr>
<tr><td>Object center position X</td><td>Float</td><td>4</td><td>Estimated target pose X [m] - A value of Hex 7FA00000 (NaN) will omit the received centre pose and instead use the trajectory</td></tr>
<tr><td>Object center position Y</td><td>Float</td><td>4</td><td>Estimated target pose Y [m] - A value of Hex 7FA00000 (NaN) will omit the received centre pose and instead use the trajectory</td></tr>
<tr><td>Object heading H</td><td>Float</td><td>4</td><td>Estimated object heading [deg] - A value of Hex 7FA00000 (NaN) will omit the received centre pose and instead use the trajectory</td></tr>
<tr><td>Object length</td><td>Float</td><td>4</td><td>Total length of object, meters</td></tr>
<tr><td>Object width</td><td>Float</td><td>4</td><td>Total width of object, meters</td></tr>
<tr><td>Leg position symmetry</td><td>Uint</td><td>2</td><td>Defines whether the legs are positioned in symmetrical rows and columns i.e., no row or column with only one leg.<br /> 0 - symmetric<br /> <img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/symmetricpalletexample.PNG" alt="" /><br /> 1 - asymmetric<br /> <img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/asymmetricpalletexample.PNG" alt="" /></td></tr>
<tr><td>Number of leg rows on long side of pallet</td><td>Uint</td><td>2</td><td>The number of leg rows perpendicular to the x-axis of a pallet, min 2, max 3. Not applicable for asymmetric pallets</td></tr>
<tr><td>Number of leg rows on short side of pallet</td><td>Uint</td><td>2</td><td>The number of leg rows perpendicular to the y-axis of a pallet, min 2, max 3. Not applicable for asymmetric pallets</td></tr>
<tr><td>Number of object legs</td><td>Uint</td><td>2</td><td>Maximum of 9 legs for symmetric pallets, and 4 for asymmetric</td></tr>
<tr><td>Object leg count</td><td>Array of legs</td><td>Variable: Number of legs * (12 + leg polygon count * 8)</td><td>Leg positions are given relative to the geometric center point of the object. The leg order is from object center point along x-axis and then in CCW order from the x-axis.</td></tr>
<tr><td>Leg position X</td><td>Float</td><td>4</td><td>The X - position of the leg relative to the geometric center point of the object</td></tr>
<tr><td>Leg position Y</td><td>Float</td><td>4</td><td>The Y - position of the leg relative to the geometric center point of the object</td></tr>
<tr><td>Leg polygon count</td><td>Uint</td><td>2</td><td>Number of leg polygon points (max 6 points). Points are given relative to the leg center point along x-axis and then in CCW order from the x-axis for solid legs. If two points on are on the positive X-axis they shall be the first and last to get a continuous array of points. For hollow legs from endpoint to endpoint starting from X-max end going through corners to X-min end (similarly for Y if no X-difference between endpoints)</td></tr>
<tr><td>Leg polygon point X</td><td>Float</td><td>4</td><td>Polygon point X relative to the leg center point</td></tr>
<tr><td>Leg polygon point Y</td><td>Float</td><td>4</td><td>Polygon point Y relative to the leg center point</td></tr>
<tr><td>Additional leg information</td><td>Uint</td><td>2</td><td>0 - solid leg (4 or 6 points). Currently, only 4 points is supported<br/><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/solidlegexample.PNG" alt="" /><br />1 - hollow leg (3 points)<br /><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/hollowlegexample.PNG" alt="" /><br />2 - plate leg (2 points)<br /><img src="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/./media-en/platelegexample.PNG" alt="" /></td></tr>
<tr><td>Supervisor scan selection enabled</td><td>Uint</td><td>2</td><td>0 - disabled, 1 - enabled</td></tr>
<tr><td>Target detection scan selection</td><td>Uint</td><td>2</td><td>Defines which scanners are used for target detection, 0 - enable target_detection_multi_scan_selection, 1 - rear scanner only, 2 - front scanner only, 3 - both scanners (supported only in reflector based detection!), 4 - use scanner in driving direction, 5 - alternate between scanners</td></tr>
</tbody></table>
<hr />
<h4 id="3055---cleaning-actuator-command"><a class="header" href="#3055---cleaning-actuator-command">3055 - Cleaning actuator command</a></h4>
<p>With this message the AGV supervisor can set the command for cleaning actuators. AGV supervisor can either command with the actuator mode with predefined actuator control logic or with manual command for each actuator.</p>
<p>This message can be used if parameter <strong>cleaning_machine_used</strong> is set to 1.</p>
<p>Navitrol will respond with message 3155.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.44.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3055</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>28</td></tr>
<tr><td>Actuators mode</td><td>Uint</td><td>4</td><td>0 - Actuators off, 1 - Vacuum, 2 - Mop, 3 - Vacuum and Mop, 4 - Manual  mode, 5 - Replay mode</td></tr>
<tr><td>Manual actuator command</td><td>Bitfield</td><td>4</td><td>Allows controlling each actuator independently <br /> This field is ignored if Actuators mode is not Manual.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>12</td><td>Reserved for future ideas</td></tr>
</tbody></table>
<p>In the table bellow, actuator modes are described.</p>
<table><thead><tr><th><strong>Actuator mode</strong></th><th><strong>Single actuator command</strong></th><th><strong>Value</strong></th><th><strong>Explanation</strong></th></tr></thead><tbody>
<tr><td><strong>Actuators OFF</strong> - mode 0</td><td>Cleaning sweep lift</td><td>0</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Cleaning brush level</td><td>0</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Sucking motor</td><td>0</td><td>0 - off, 1 - on (vacuum)</td></tr>
<tr><td></td><td>Cleaning brush</td><td>0</td><td>0 - off, 1 - on (cleaning)</td></tr>
<tr><td></td><td>Water valve command</td><td>0</td><td>0 - off, 1 - on (mopping)</td></tr>
<tr><td><strong>Vacuum - mode 1</strong></td><td>Cleaning sweep lift</td><td>1</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Cleaning brush level</td><td>1</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Sucking motor</td><td>1</td><td>0 - off, 1 - on (vacuum)</td></tr>
<tr><td></td><td>Cleaning brush</td><td>1</td><td>0 - off, 1 - on (cleaning)</td></tr>
<tr><td></td><td>Water valve command</td><td>0</td><td>0 - off, 1 - on (mopping)</td></tr>
<tr><td><strong>Mop</strong> - mode 2</td><td>Cleaning sweep lift</td><td>1</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Cleaning brush level</td><td>1</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Sucking motor</td><td>0</td><td>0 - off, 1 - on (vacuum)</td></tr>
<tr><td></td><td>Cleaning brush</td><td>1</td><td>0 - off, 1 - on (cleaning)</td></tr>
<tr><td></td><td>Water valve command</td><td>1</td><td>0 - off, 1 - on (mopping)</td></tr>
<tr><td><strong>Vacuum and mop - mode 3</strong></td><td>Cleaning sweep lift</td><td>1</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Cleaning brush level</td><td>1</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td></td><td>Sucking motor</td><td>1</td><td>0 - off, 1 - on (vacuum)</td></tr>
<tr><td></td><td>Cleaning brush</td><td>1</td><td>0 - off, 1 - on (cleaning)</td></tr>
<tr><td></td><td>Water valve command</td><td>1</td><td>0 - off, 1 - on (mopping)</td></tr>
</tbody></table>
<p>In the manual mode, AGV supervisor sets the status of each actuator individually</p>
<table><thead><tr><th><strong>Manual actuator command - mode 4</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Cleaning sweep lift</td><td>0</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td>Cleaning brush level</td><td>1</td><td>0 - up, 1 - down (cleaning position)</td></tr>
<tr><td>Sucking motor</td><td>2</td><td>0 - off, 1 - on (vacuum)</td></tr>
<tr><td>Cleaning brush</td><td>3</td><td>0 - off, 1 - on (cleaning)</td></tr>
<tr><td>Water valve command</td><td>4</td><td>0 - off, 1 - on (mopping)</td></tr>
<tr><td>Reserved</td><td>5-31</td><td>Reserved for future development</td></tr>
</tbody></table>
<p>In the replay mode, the actuator command is taken from the segments that the AGV drives. It is saved as a custom route property named &quot;binary_actuators&quot;. If the AGV is not in automatic driving mode, the actuators will be turned off in this mode.</p>
<hr />
<h4 id="3056---error-situation"><a class="header" href="#3056---error-situation">3056 - Error situation</a></h4>
<p>This supervisor message is used for error recovery handling. Related to message 3156.</p>
<p>When an error situation starts, Navitrol will start sending the supervisor reply message (3156) at a 3 second interval. 
Then customer can define an action for this error situation by sending this 3056 message.
The <strong>error situation id</strong> is a number that tells what situation is active and Navitrol will send that information on the 3156 message. Customer should define what error situation id the action is related to. See example situation below.</p>
<p><strong>Error situation ids</strong>:</p>
<ul>
<li>0 = None</li>
<li>1 = <strong>Dropoff not empty</strong> (related to error: 522 ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED).</li>
</ul>
<p>Actions for the <strong>Dropoff not empty</strong> situation:</p>
<ul>
<li>0 - None -&gt; Do nothing</li>
<li>1 - Acknowledge -&gt; Reset ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED </li>
<li>2 - Retry -&gt; Reset ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED and do the empty space detection again</li>
<li>3 - Ignore -&gt; Reset ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED and continue driving to rack without empty space detection feature. This will ignore the feature only for this one time. Next time it will be active again. </li>
</ul>
<p>Example scenario:</p>
<ul>
<li>AGV drives to rack and does empty space detection.</li>
<li>Some wrapping or plastic is triggering the ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED and AGV will stop.</li>
<li>Navitrol starts sending 3156 message with <strong>Error situation id</strong>: 1 (<strong>Dropoff not empty</strong>).</li>
<li>Operator is checking the shelf and verifies that AGV would be able to drive to the shelf without issues. There is just some wrapping hanging from next shelf that would not cause any damage.</li>
<li>Customer PLC sends 3056 message with 
<ul>
<li><strong>Error situation id</strong>: 1 (<strong>Dropoff not empty</strong>) </li>
<li><strong>Action</strong>: 3 (Ignore)</li>
</ul>
</li>
<li>Navitrol resets the ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED error and continue driving to the shelf without doing the empty space detection this time.</li>
</ul>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.46.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3056</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>13</td></tr>
<tr><td>Error situation id</td><td>Int</td><td>4</td><td>Id of the active error situation (same as what Navitrol sent with the 3156 message)</td></tr>
<tr><td>Action</td><td>Uint</td><td>1</td><td>Error action: <br /> 0 - None: Do nothing. <br /> 1 - Acknowledge: Reset error. <br /> 2 - Retry: Reset error and try again the feature that caused error. <br /> 3 - Ignore: Reset error and ignore the feature that caused the error for this time.</td></tr>
</tbody></table>
<hr />
<h4 id="3057---route-free-navigation-request"><a class="header" href="#3057---route-free-navigation-request">3057 - Route-free Navigation Request</a></h4>
<p>Starts the route free navigation to the target. Navitrol will plan a route to the given target avoiding the walls based on the environment model. Navitrol will respond with 3157 message.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.51.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3057</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>40</td></tr>
<tr><td>Reserved</td><td>Uint</td><td>4</td><td>Reserved bits for the future. Should be 0 for now, may be used for eg. point count later</td></tr>
<tr><td>x</td><td>double</td><td>8</td><td>X-coordinate for the target</td></tr>
<tr><td>y</td><td>double</td><td>8</td><td>Y-coordinate for the target</td></tr>
<tr><td>heading (radians)</td><td>double</td><td>8</td><td>heading for the target</td></tr>
<tr><td>velocity (m/s)</td><td>float</td><td>4</td><td>desired velocity. 0.0 if not specified, negative numbers are not supported for now</td></tr>
</tbody></table>
<hr />
<h3 id="from-navitrol-to-supervisor-1"><a class="header" href="#from-navitrol-to-supervisor-1">From Navitrol to Supervisor</a></h3>
<h4 id="1116---motor-control-differential"><a class="header" href="#1116---motor-control-differential">1116 - Motor control differential</a></h4>
<p>The Motor control message is sent as a reply to the message Odometer update differential vehicle (Message ID 1016).</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1116</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages. <em>NOTE:</em> This value must match with the latest Odometer update message number sent by the Supervisor.</td></tr>
<tr><td>Speed_Left</td><td>Float</td><td>4</td><td>Reference speed for left wheel (m/s)</td></tr>
<tr><td>Speed_Right</td><td>Float</td><td>4</td><td>Reference speed for right wheel (m/s)</td></tr>
<tr><td>Navitrol Errors Stopping driving</td><td>Uint</td><td>2</td><td>0 no errors, 1 error stopping driving</td></tr>
</tbody></table>
<hr />
<h4 id="1117---motor-control-steer-drive"><a class="header" href="#1117---motor-control-steer-drive">1117 - Motor control steer drive</a></h4>
<p>The Motor control message is sent as a reply to the message Measurement update steer drive vehicle (Message ID 1017).</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1117</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages. <br /><em>NOTE:</em> This value must match with the latest Odometer update message number sent by the Supervisor.</td></tr>
<tr><td>Steering Angle</td><td>Float</td><td>4</td><td>Reference steering angle (+/-PI in radians) <br />Positive turning direction is CCW</td></tr>
<tr><td>Wheel Speed</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td></tr>
<tr><td>Status/control</td><td>Bitfield</td><td>2</td><td></td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status/control  bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Navitrol error</td><td>0</td><td></td></tr>
<tr><td>Reserved</td><td>1-4</td><td>Not in use</td></tr>
<tr><td>Obsolete</td><td>5</td><td>Not in use. Previously &quot;Ack/Reset&quot;</td></tr>
<tr><td>Charge request (deprecated)</td><td>6</td><td>Charge request bit is deprecated and should not be used. 3102 - Supervisor status Battery section Charging required bit is used to request charging</td></tr>
<tr><td>Brake release</td><td>7</td><td></td></tr>
<tr><td>Reserved</td><td>8-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1118---motor-control-differentialsteer-drive"><a class="header" href="#1118---motor-control-differentialsteer-drive">1118 - Motor control differential&amp;steer drive</a></h4>
<p>The Motor control message is sent as a reply to the message <em>Measurement update steer drive vehicle</em> (Message ID 1018).</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1118</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages. <br /><em>NOTE:</em> This value must match with the latest Odometer update message number sent by the Supervisor.</td></tr>
<tr><td>Steer wheel: Steering Angle</td><td>Float</td><td>4</td><td>Reference steering angle (+/-PI in radians) <br />Positive turning direction is CCW</td></tr>
<tr><td>Steer wheel: Wheel Speed</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td></tr>
<tr><td>Diff Left wheel: Wheel Speed</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td></tr>
<tr><td>Diff Right wheel: Wheel Speed</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td></tr>
<tr><td>Status/control</td><td>Uint</td><td>2</td><td></td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status/control  bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Navitrol error</td><td>0</td><td></td></tr>
<tr><td>Reserved</td><td>1-4</td><td>Not in use</td></tr>
<tr><td>Obsolete</td><td>5</td><td>Not in use. Previously &quot;Ack/Reset&quot;</td></tr>
<tr><td>Charge request (deprecated)</td><td>6</td><td>Charge request bit is deprecated and should not be used. 3102 - Supervisor status Battery section Charging required bit is used to request charging</td></tr>
<tr><td>Brake release</td><td>7</td><td></td></tr>
<tr><td>Reserved</td><td>8-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1119---motor-control-omni-drive"><a class="header" href="#1119---motor-control-omni-drive">1119 - Motor control omni drive</a></h4>
<p>The Motor control message is sent as a reply to the message Measurement update omnidirectional drive vehicle (Message ID 1019).</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1119</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 26</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages. <br /><em>NOTE:</em> This value must match with the latest Odometer update message number sent by the Supervisor.</td></tr>
<tr><td>Driving Vector Angle</td><td>Float</td><td>4</td><td>Reference driving vector angle relative to the vehicle frame. (+/-PI in radians) <br />0-forwards along vehicle center line. Positive direction is CCW from vehicle center line. <br />Hex 7FA00000 no control</td></tr>
<tr><td>Steering Radius</td><td>Float</td><td>4</td><td>Radius to center of rotation from navigation point (m).  <br />0-pivoting around vehicle navigation point. Positive PI/2 CCW from driving vector turning the vehicle to the left.  <br />Hex 7FA00000 no control</td></tr>
<tr><td>Driving Speed</td><td>Float</td><td>4</td><td>Reference speed of the vehicle navigation point along driving vector (m/s) <br />Positive along driving vector, negative against driving vector (i.e. driving vector ± PI) <br />Hex 7FA00000 no control</td></tr>
<tr><td>Status/control</td><td>Bitfield</td><td>2</td><td></td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status/control  bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Navitrol error</td><td>0</td><td></td></tr>
<tr><td>Obsolete</td><td>1</td><td>Not in use. Previously &quot;Control enable&quot;</td></tr>
<tr><td>Reserved</td><td>2-4</td><td>Not in use</td></tr>
<tr><td>Obsolete</td><td>5</td><td>Not in use. Previously &quot;Ack/Reset&quot;</td></tr>
<tr><td>Charge request (deprecated)</td><td>6</td><td>Charge request bit is deprecated and should not be used. 3102 - Supervisor status Battery section Charging required bit is used to request charging</td></tr>
<tr><td>Brake release</td><td>7</td><td></td></tr>
<tr><td>Reserved</td><td>8-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1122---motor-control-mecanum-drive"><a class="header" href="#1122---motor-control-mecanum-drive">1122 - Motor control mecanum drive</a></h4>
<p>The Motor control message is sent as a reply to the message Measurement update mecanum drive vehicle (Message ID 1022).</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1122</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>46</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages mirrored from message 1022 <br /><em>NOTE:</em> Supervisor should check that the values match to confirm that no messages have been lost.</td></tr>
<tr><td>Reference speed for wheel 0</td><td>Float</td><td>4</td><td>Reference speed for wheel 0</td></tr>
<tr><td>Reference speed for wheel 1</td><td>Float</td><td>4</td><td>Reference speed for wheel 1</td></tr>
<tr><td>Reference speed for wheel 2</td><td>Float</td><td>4</td><td>Reference speed for wheel 2</td></tr>
<tr><td>Reference speed for wheel 3</td><td>Float</td><td>4</td><td>Reference speed for wheel 3</td></tr>
<tr><td>Status/control</td><td>Bitfield</td><td>2</td><td>See <strong>Status/control bits</strong></td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status/control bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Navitrol error</td><td>0</td><td>Navitrol has any error active and is unable to drive.</td></tr>
<tr><td>Brake release</td><td>1</td><td>Navitrol requests Supevisor to release brakes to start driving</td></tr>
<tr><td>Reserved</td><td>2-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1123---motor-control-combined"><a class="header" href="#1123---motor-control-combined">1123 - Motor control combined</a></h4>
<p>The Motor control message is sent as a reply to the message <em>Measurement update combined</em> (Message ID 1023).</p>
<p>For all supported kinematics (O-omni, S-steer, D-diff, DS-diff steer) both wheel references (1) and vector references (2) are sent.  The receiver should choose which one they would like to use. The <strong>Used by</strong> column shows which combination each control value is intended for e.g., D1 for diff drive wheel reference.</p>
<p>Note: If the data field is not used by the vehicle type, a constant 0 will be sent.</p>
<p>A special feature for driving vector speed available. This feature allows sending a speed reference to the supervisor despite driving restrictions in order to activate a direction validation. This information, for instance, can be forwarded to the safety system in order to to inform it about driving direction prior to movement.</p>
<p>In order to enable the feature, the following conditions should be met:</p>
<ul>
<li>AGV stop signal should be sent by supervisor (soft stop PLC, bit 3 from supervisor status in Message ID 1023)</li>
<li>AutoMoveDelay should be enabled for the state change (<strong>auto_moving_delay_msec</strong> parameter should be set to non-zero value)</li>
<li>Parameter <strong>eth_set_speed_ref_prior_to_drive</strong> should be set to 1.</li>
</ul>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th><th><strong>Used by</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td><td>All</td></tr>
<tr><td>Message ID = 1123</td><td>Uint</td><td>2</td><td></td><td>All</td></tr>
<tr><td>Message length = 54</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields</td><td>All</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages. <br /><em>NOTE:</em> This value must match with the latest Odometer update message number sent by the Supervisor.</td><td>All</td></tr>
<tr><td>Reference angle for wheel 0</td><td>Float</td><td>4</td><td>Reference steering angle (+/-PI in radians) <br />Positive turning direction is CCW</td><td>S1, DS1, O1</td></tr>
<tr><td>Reference speed for wheel 0</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td><td>S1, DS1, O1</td></tr>
<tr><td>Reference angle for wheel 1</td><td>Float</td><td>4</td><td>Reference steering angle (+/-PI in radians) <br />Positive turning direction is CCW</td><td>O1</td></tr>
<tr><td>Reference speed for wheel 1</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td><td>O1</td></tr>
<tr><td>Driving Vector Angle</td><td>Float</td><td>4</td><td>Reference driving vector angle relative to the vehicle frame. (+/-PI in radians)  <br />0-forwards along vehicle center line. Positive direction is CCW from vehicle center line.</td><td>S2, DS2, D2, O2</td></tr>
<tr><td>Steering Radius</td><td>Float</td><td>4</td><td>Radius to center of rotation from navigation point (m).   <br />0-pivoting around vehicle navigation point.  <br />Positive PI/2 CCW from driving vector turning the vehicle to the left.</td><td>S2, DS2, D2, O2</td></tr>
<tr><td>Driving Speed</td><td>Float</td><td>4</td><td>Reference speed of the vehicle along driving vector (m/s). <br /> For O2 and DS2 - speed of <strong>navigation point</strong>. <br /> For S2 and D2 - <strong>speed of fastest wheel</strong> <br />Positive along driving vector, negative against driving vector (i.e. driving vector ± PI)</td><td>S2, DS2, D2, O2</td></tr>
<tr><td>Diff Left wheel: Wheel Speed</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td><td>D1, DS1</td></tr>
<tr><td>Diff Right wheel: Wheel Speed</td><td>Float</td><td>4</td><td>Reference speed for drive wheel (m/s)</td><td>D1, DS1</td></tr>
<tr><td>Timestamp</td><td>Uint</td><td>4</td><td>Cumulative time in ms; Mirrored from 1023</td><td>All</td></tr>
<tr><td>Status/control</td><td>Bitfield</td><td>2</td><td></td><td>All</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status/control  bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Navitrol error</td><td>0</td><td></td></tr>
<tr><td>Obsolete</td><td>1</td><td>Not in use. Previously &quot;Control enable&quot;</td></tr>
<tr><td>Reserved</td><td>2-4</td><td>Not in use</td></tr>
<tr><td>Obsolete</td><td>5</td><td>Not in use. Previously &quot;Ack/Reset&quot;</td></tr>
<tr><td>Charge request (deprecated)</td><td>6</td><td>Charge request bit is deprecated and should not be used. 3102 - Supervisor status Battery section Charging required bit is used to request charging</td></tr>
<tr><td>Brake release</td><td>7</td><td></td></tr>
<tr><td>Reserved</td><td>8-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="1126---motor-control-omni-response"><a class="header" href="#1126---motor-control-omni-response">1126 - Motor control omni response</a></h4>
<p>The following motor control message is sent as a reply to the message Measurement update generic omni drive (Message ID 1026).</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.52.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1126</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>28 + N wheels * Omni wheels ref struct <br/> Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>See <em>message number</em> in <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#glossary">Glossary</a></td></tr>
<tr><td>Supervisor status out</td><td>Bitfield</td><td>2</td><td>See <strong>Status/control bits</strong> for more information.</td></tr>
<tr><td>Driving vector Angle</td><td>Float</td><td>4</td><td>Reference driving vector angle relative to the vehicle frame. (+/-PI in radians) <br />0-forwards along vehicle center line. Positive direction is CCW from vehicle center line.</td></tr>
<tr><td>Steering Radius</td><td>Float</td><td>4</td><td>Radius to center of rotation from navigation point (m).  <br />0-pivoting around vehicle navigation point. Positive value sets the center of rotation to a direction of 90 deg CCW from the driving vector angle. For example with 0 deg driving vector angle vehicle turns to left with positive radius and to right with negative radius.</td></tr>
<tr><td>Navigation point speed</td><td>Float</td><td>4</td><td>Reference speed of the vehicle navigation point along driving vector (m/s) <br />Positive along driving vector, negative against driving vector (i.e. driving vector ± PI).</td></tr>
<tr><td>Number of Wheels</td><td>Uint</td><td>2</td><td>Number of omni wheels, maximum 6, minimum 2. Determined by parameter omni_steer_nbr</td></tr>
<tr><td>Omni wheels ref struct[]</td><td>Omni wheels ref struct[]</td><td>Varying length</td><td>The references for each individual omni wheel</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status/control bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Navitrol error</td><td>0</td><td>Navitrol has any error active and is unable to drive.</td></tr>
<tr><td>Reserved</td><td>1-6</td><td>Not in use</td></tr>
<tr><td>Brake release</td><td>7</td><td>Navitrol requests Supevisor to release brakes to start driving</td></tr>
<tr><td>Reserved</td><td>8-15</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Omni wheels ref struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Steer angle reference</td><td>Float</td><td>4</td><td>In radians. Range is [-PI, PI]. Positive is counter-clockwise.</td></tr>
<tr><td>Wheel speed reference</td><td>Float</td><td>4</td><td>In m/s</td></tr>
</tbody></table>
<hr />
<h4 id="1130---control-actuators"><a class="header" href="#1130---control-actuators">1130 - Control actuators</a></h4>
<p>This message is obsolete, not used anymore! Check messages 1031 and 1131.</p>
<hr />
<h4 id="1131---control-multiple-actuators"><a class="header" href="#1131---control-multiple-actuators">1131 - Control multiple actuators</a></h4>
<p>When Navitrol is controlling the actuators, it can control those actuators which are available in the <em>Measurement update multiple actuators</em> message and also activated in the parameters. One or several actuators are activated at a time according to a predefined work sequence. Navitrol sets position references for the actuators, requests the AGV controller to do the control and monitors feedback data for malfunctions and fulfillment of the control task. If relevant feedback data is not provided over the message, the navigation only waits for the reference reached information to end the control. When actuator control is successfully finished, the next controller is activated, while also monitoring that previously achieved controller targets are maintained.</p>
<p>Navitrol sends this message as a reply to the <em>Measurement update multiple actuators</em> message (1031).</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1131</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = Min 16, max 176</td><td>Uint</td><td>4</td><td>Message length depends on how many actuators are in use. Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>This value shall be incremented by one for each message sent and it should match with received reply message number.</td></tr>
<tr><td>Message status</td><td>Uint</td><td>2</td><td>0 – ok <br> 1 – configuration error (an actuator section is sent with status bit 15 set)</td></tr>
<tr><td>Number of actuator control sections</td><td>Uint</td><td>2</td><td>Number of simultaneously controlled actuators (NoA). As many actuator sections can be sent as there are actuators defined to be controllable in the measurement update message.</td></tr>
<tr><td>Actuator control section</td><td>Actuator[]</td><td>NoA * 8</td><td>Each packet consists of: Actuator to control, position reference and binary outputs</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Actuator control section</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Controlled actuator</td><td>Uint</td><td>2</td><td>1 – Lift <br> 2 – Lift secondary (relative to the main lift) <br> 3 – Reach <br> 4 – Tilt fork  <br> 5 – Tilt mast <br> 6 – Tilt vehicle frame <br> 7 – Turn fork direction relative to vehicle frame <br> 8 – Side shift fork <br> 9 – Adjust fork width <br> 10 – Side tilt fork <br> 11 – Run onboard conveyor  <br> 12 – Lift scanner/camera <br> 13 – Load identification on/off <br> 14 – Load securing on/off <br> 15 – Drive fork in/out (vehicle driving on odometry so no feedback, provided only as status information) <br> 16 – Drive fork right/left, side loader and narrow aisle (vehicle driving on odometry so no feedback, provided only as status information) <br> Others can be added on request.</td></tr>
<tr><td>Actuator position reference</td><td>Int</td><td>4</td><td>Reference position in millimeters or 0.1 degrees</td></tr>
<tr><td>Binary output</td><td>Uint</td><td>2</td><td>Binary output, described below</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Binary output</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Activate actuator</td><td>0</td><td>1 control active, else 0</td></tr>
<tr><td>Increase actuator</td><td>1</td><td>1 if actuator value should be increased, extended or rotated CCW. For conveyors load moving in positive X or Y direction on vehicle coordinate frame. Bit 0 has to be 1, Bit 2 has to be 0</td></tr>
<tr><td>Decrease actuator</td><td>2</td><td>1 if actuator value should be decreased, retracted or rotated CW. For conveyors load moving in negative X or Y direction on vehicle coordinate frame. Bit 0 has to be 1, Bit 1 has to be 0</td></tr>
<tr><td>Not defined</td><td>3-14</td><td>Reserved bits (= 0)</td></tr>
<tr><td>Undefined actuator</td><td>15</td><td>Actuator configured for control not defined in navigation parameters.</td></tr>
</tbody></table>
<hr />
<h4 id="1132---recording-status"><a class="header" href="#1132---recording-status">1132 - Recording status</a></h4>
<p>Tells the status of the record and play functionality</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.48</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>1132</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>16</td></tr>
<tr><td>Operation result</td><td>Uint</td><td>4</td><td>0 fail, 1 success</td></tr>
<tr><td>Record &amp; Play state</td><td>Uint</td><td>4</td><td>0 play, 1 record, 2 failure</td></tr>
</tbody></table>
<p>Record &amp; play states other than the specified are reserved and should be considered failures.
Operation results other than the specified are reserved and should be considered failures.</p>
<hr />
<h4 id="3101---hold-released"><a class="header" href="#3101---hold-released">3101 - Hold released</a></h4>
<p>Navitrol sends this message as a reply to the Release Hold message 3001 (not 3011).</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3101</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 16</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>Symbolic Point ID of the destination.</td></tr>
<tr><td>Release result</td><td>Uint</td><td>4</td><td>0 accepted, <br />1 bad input data, <br />2 wrong state, <br />3 unreachable ID, <br />4 drive control disabled</td></tr>
</tbody></table>
<hr />
<h4 id="3102---navitrol-status"><a class="header" href="#3102---navitrol-status">3102 - Navitrol status</a></h4>
<p>Navitrol sends this message as a response to message <em>Supervisor status 3002.</em> Content of the message is determined by the request from the AGV supervisor. Message always starts with the default section. Rest of the message is determined by the section IDs received from the Supervisor.</p>
<h5 id="default-section-1"><a class="header" href="#default-section-1">Default section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3102</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = * Depends on what sections are included</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Default section length</td><td>Uint</td><td>4</td><td>Length of the default section</td></tr>
<tr><td>State</td><td>Uint</td><td>4</td><td>Navitrol state <br />START_STATE = 1, <br />STANDBY_STATE = 2, <br />AUTO_STATE = 3, <br />FSTOP_STATE = 9, <br />LOAD_STATE = 14, <br />HOLD_STATE = 15, <br />MANUAL_STATE = 16, <br />PAUSE_STATE = 17</td></tr>
<tr><td>X-coordinate</td><td>Float</td><td>4</td><td>In meters</td></tr>
<tr><td>Y-coordinate</td><td>Float</td><td>4</td><td>In meters</td></tr>
<tr><td>Heading</td><td>Float</td><td>4</td><td>Radians</td></tr>
<tr><td>Level</td><td>Int</td><td>4</td><td>Level ID</td></tr>
<tr><td>Speed</td><td>Float</td><td>4</td><td>m/s</td></tr>
<tr><td>Position initialize status</td><td>Uint</td><td>2</td><td>0 = Failed 1 = Succeeded</td></tr>
<tr><td>Position confidence</td><td>Uint</td><td>2</td><td>Position confidence in percentage (1 - 100%)</td></tr>
<tr><td>Error status</td><td>Uint</td><td>2</td><td>1 error on, 0 no error</td></tr>
</tbody></table>
<hr />
<h5 id="1---general-section"><a class="header" href="#1---general-section">1 - General section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 1</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Battery voltage</td><td>Float</td><td>4</td><td>V</td></tr>
<tr><td>On route</td><td>Uint</td><td>2</td><td>1 on route, 0 not on route</td></tr>
</tbody></table>
<hr />
<h5 id="2---hold-section"><a class="header" href="#2---hold-section">2 - Hold section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 2</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>InHold</td><td>Uint</td><td>2</td><td>1 if machine in Hold, 0 otherwise</td></tr>
<tr><td>Default destination in use</td><td>Uint</td><td>2</td><td>1 if the machine is at a hold location for which a Default destination is defined, 0 otherwise</td></tr>
<tr><td>Default destination name</td><td>Char[32]</td><td>32</td><td>Default destination name as a null-terminated string.</td></tr>
<tr><td>1st alternative destination in use</td><td>Uint</td><td>2</td><td>1 if the machine is at a hold location for which the 1st alternative destination is in use, 0 otherwise</td></tr>
<tr><td>1st alternative destination name</td><td>Char[32]</td><td>32</td><td>1st alternative destination name as a null-terminated string.</td></tr>
<tr><td>2nd alternative destination in use</td><td>Uint</td><td>2</td><td>1 if the machine is at a hold location for which the 2nd alternative destination is in use, 0 otherwise</td></tr>
<tr><td>2nd alternative destination name</td><td>Char[32]</td><td>32</td><td>2nd alternative destination name as a null-terminated string.</td></tr>
<tr><td>3rd alternative destination in use</td><td>Uint</td><td>2</td><td>1 if the machine is at a hold location for which the 3rd alternative destination is in use, 0 otherwise</td></tr>
<tr><td>3rd alternative destination name</td><td>Char[32]</td><td>32</td><td>3rd alternative destination name as a null-terminated string.</td></tr>
</tbody></table>
<hr />
<h5 id="3---virtual-tag-section"><a class="header" href="#3---virtual-tag-section">3 - Virtual Tag section</a></h5>
<p>Virtual tags can be defined to symbolic points in Navithor Tools. Virtual tag means only the tags of 'generic' type, so the tags from doors or Navitrol features are not sent on this section. Virtual tag section applies only to symbolic point tags, it doesn't send any values from the route properties.</p>
<p>It is possible to define two virtual tags of 'generic'-type using Navithor Tools. If one is defined it will be always sent in &quot;Value of virtual tag 1&quot; -data field. If two 'generic' tags are defined the second is sent &quot;Value of virtual tag 2&quot; -data field. The order of two 'generic' tags will be the same as they were defined in Navithor Tools.</p>
<p><strong>Note: Message was changed in 6.28.00 to support two virtual tags instead of one. This concerns customers that have used previously this message with big endian communication.</strong></p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 3</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Virtual Tag in use</td><td>Uint</td><td>2</td><td>1 the machine is close to a virtual tag location, 0 otherwise <br />Applies only to Generic tags on symbolic points (doors, Navitrol features or any route properties/tags do not trigger this or the Virtual Tag value).</td></tr>
<tr><td>Value of virtual tag 1</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Value of virtual tag 2</td><td>Uint</td><td>2</td><td>If two 'generic' virtual tags are defined the second is sent in this field.</td></tr>
</tbody></table>
<hr />
<h5 id="4---coming-from-going-to-section"><a class="header" href="#4---coming-from-going-to-section">4 - Coming from Going to section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 4</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Going to ID</td><td>Uint</td><td>4</td><td>ID of ongoing or last drive target, updated at start of a drive</td></tr>
<tr><td>Target reached</td><td>Uint</td><td>2</td><td>1 if the Going to ID destination has been reached, else 0</td></tr>
<tr><td>Going to name</td><td>Char[32]</td><td>32</td><td>Name of goal symbolic point of the drive, null-terminated string</td></tr>
<tr><td>Coming from name</td><td>Char[32]</td><td>32</td><td>Name of symbolic point where the drive started, null-terminated string</td></tr>
</tbody></table>
<hr />
<h5 id="5---actuator-section"><a class="header" href="#5---actuator-section">5 - Actuator section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 5</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Actuator reference</td><td>Uint</td><td>4</td><td>Actuator reference value (position, rotation, height (mm)), updated when Activate actuator is 1</td></tr>
<tr><td>Binary outputs 1</td><td>Bitfield</td><td>1</td><td></td></tr>
<tr><td>Reserved</td><td>NA</td><td>1</td><td>Not in use</td></tr>
<tr><td>Binary outputs 3</td><td>Bitfield</td><td>1</td><td></td></tr>
<tr><td>Reserved</td><td>NA</td><td>1</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Binary outputs 1 bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Activate actuator</td><td>0</td><td>1 control active, else 0</td></tr>
<tr><td>Increase actuator value</td><td>1</td><td>1 if actuator value should be increased (Bit 0 has to be 1, Bit 2 has to be 0)</td></tr>
<tr><td>Decrease actuator value</td><td>2</td><td>1 if actuator value should be decreased (Bit 0 has to be 1, Bit 1 has to be 0)</td></tr>
<tr><td>Reserved</td><td>3-7</td><td>5 bits</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Binary outputs 3 bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>StopAndHoldActive</td><td>0</td><td>1 if AGV is held over StopAndHold symbolic point, otherwise 0</td></tr>
<tr><td>Reserved</td><td>1-7</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="6---custom-attribute-section"><a class="header" href="#6---custom-attribute-section">6 - Custom attribute section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 6</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Attribute 1 value</td><td>Float</td><td>4</td><td>Value of attribute 1</td></tr>
<tr><td>Attribute 1 name</td><td>Char[32]</td><td>32</td><td>name of the attribute 1</td></tr>
<tr><td>Attribute 2 value</td><td>Float</td><td>4</td><td>Value of attribute 2</td></tr>
<tr><td>Attribute 2 name</td><td>Char[32]</td><td>32</td><td>name of the attribute 2</td></tr>
<tr><td>Attribute 3 value</td><td>Float</td><td>4</td><td>Value of attribute 3</td></tr>
<tr><td>Attribute 3 name</td><td>Char[32]</td><td>32</td><td>name of the attribute 3</td></tr>
<tr><td>Attribute 4 value</td><td>Float</td><td>4</td><td>Value of attribute 4</td></tr>
<tr><td>Attribute 4 name</td><td>Char[32]</td><td>32</td><td>name of the attribute 4</td></tr>
<tr><td>Attribute 5 value</td><td>Float</td><td>4</td><td>Value of attribute 5</td></tr>
<tr><td>Attribute 5 name</td><td>Char[32]</td><td>32</td><td>name of the attribute 5</td></tr>
</tbody></table>
<hr />
<h5 id="7---warning-zone-section"><a class="header" href="#7---warning-zone-section">7 - Warning zone section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 7</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Warning zone front value</td><td>Uint</td><td>2</td><td>Front warning zone selection, this warning zone is reported when Navitrol driving in AUTO mode otherwise idle zone is reported</td></tr>
<tr><td>Warning zone rear value</td><td>Uint</td><td>2</td><td>Rear warning zone selection, this warning zone is reported when Navitrol driving in AUTO mode otherwise idle zone is reported</td></tr>
</tbody></table>
<hr />
<h5 id="8---outputs-section"><a class="header" href="#8---outputs-section">8 - Outputs section</a></h5>
<p>The virtual outputs need to be activated and mapped in Navitrol parameters to be used instead of physical IO</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 8</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Num of binary outputs</td><td>Uint</td><td>2</td><td>0-32 supported</td></tr>
<tr><td>Binary outputs</td><td>An array of bytes</td><td>num of outputs * 1</td><td></td></tr>
<tr><td>Num of integer outputs</td><td>Uint</td><td>2</td><td>0-32 supported</td></tr>
<tr><td>Integer outputs</td><td>An array of integers</td><td>num of outputs * 4</td><td></td></tr>
<tr><td>Num of float outputs</td><td>Uint</td><td>2</td><td>0-32 supported</td></tr>
<tr><td>Float outputs</td><td>An array of floats</td><td>num of outputs * 4</td><td></td></tr>
</tbody></table>
<hr />
<h5 id="9---steering-angle-section"><a class="header" href="#9---steering-angle-section">9 - Steering Angle section</a></h5>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 9</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Target steering wheel angle</td><td>Float</td><td>4</td><td>In radians</td></tr>
<tr><td>Measured steering wheel angle</td><td>Float</td><td>4</td><td>In radians</td></tr>
</tbody></table>
<hr />
<h5 id="10---battery-section"><a class="header" href="#10---battery-section">10 - Battery section</a></h5>
<p>Battery values produced by Navitrol.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 10</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Battery state of charge</td><td>Uint</td><td>2</td><td>In percentages, range 0...100 %, 65535 not used</td></tr>
<tr><td>Battery voltage</td><td>Uint</td><td>2</td><td>Value * 0.1 Volt, 65535 not used</td></tr>
<tr><td>Charge current/current draw</td><td>Int</td><td>2</td><td>Value * 0.1 Ampere, 32767 not used. Negative values if discharging and positive values, if battery is being charged.</td></tr>
<tr><td>Energy draw</td><td>Int</td><td>2</td><td>Value * 0.1 Ah, 32767 not used</td></tr>
<tr><td>Time to go</td><td>Uint</td><td>2</td><td>Estimated time left in minutes until the battery is empty, 65535 not used</td></tr>
<tr><td>Battery state of health</td><td>Uint</td><td>2</td><td>In percentages, range 0...100 %, 65535 not used</td></tr>
<tr><td>Battery temperature</td><td>Int</td><td>2</td><td>In Celsius degrees, 32767 not used</td></tr>
<tr><td>Battery load cycles</td><td>Uint</td><td>2</td><td>Number of load cycles performed for battery, 65535 not used</td></tr>
<tr><td>Battery operating hours</td><td>Uint</td><td>2</td><td>Total number of operating hours, 65535 not used</td></tr>
<tr><td>Charger voltage</td><td>Uint</td><td>2</td><td>Value * 0.1 Volt, 65535 not used</td></tr>
<tr><td>Errors</td><td>Bitfield</td><td>2</td><td>Active error flags described below. All bits are 0 when not active battery errors.</td></tr>
<tr><td>Binary data 1</td><td>Bitfield</td><td>1</td><td>Binary data 1 described below:</td></tr>
<tr><td>Reserved</td><td>NA</td><td>1</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Errors  bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Battery management communication error</td><td>0</td><td>0: not active 1: active</td></tr>
<tr><td>Battery configuration error</td><td>1</td><td>0: not active 1: active</td></tr>
<tr><td>Undervoltage error</td><td>2</td><td>0: not active 1: active</td></tr>
<tr><td>Overvoltage error</td><td>3</td><td>0: not active 1: active</td></tr>
<tr><td>Overcurrent error</td><td>4</td><td>0: not active 1: active</td></tr>
<tr><td>Temperature error</td><td>5</td><td>0: not active 1: active</td></tr>
<tr><td>Internal defect</td><td>6</td><td>0: not active 1: active</td></tr>
<tr><td>Bad state of health</td><td>7</td><td>0: not active 1: active</td></tr>
<tr><td>Faulty charger</td><td>8</td><td>0: not active 1: active</td></tr>
<tr><td>Faulty contactor</td><td>9</td><td>0: not active 1: active</td></tr>
<tr><td>Current sensor defect</td><td>10</td><td>0: not active 1: active</td></tr>
<tr><td>Temperature sensor defect</td><td>11</td><td>0: not active 1: active</td></tr>
<tr><td>Battery cell drift error</td><td>12</td><td>0: not active 1: active</td></tr>
<tr><td>Charging error</td><td>13</td><td>0: not active 1: active</td></tr>
<tr><td>Generic error</td><td>14</td><td>Unspecified error <br />0: not active 1: active</td></tr>
<tr><td>Generic error</td><td>15</td><td>Unspecified error <br />0: not active 1: active</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Binary data 1 bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Charging required</td><td>0</td><td>1 charging required, <br />Used to notify that AGV is ready for charge.</td></tr>
<tr><td>Charging</td><td>1</td><td>1 charging, 0 not charging</td></tr>
<tr><td>Reserved</td><td>2-7</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="11---disable-safety-section"><a class="header" href="#11---disable-safety-section">11 - Disable safety section</a></h5>
<p>This message is sent only when parameter disable_safety is set to 1.</p>
<p>Used in situation, where customer has safety scanner below the fork, so the safety needs to be disabled when the AGV is close to the load or unload point or when the fork is decreased to the scanner level. Parameter disable_safety_distance_to_load_or_unload defines the distance to the load and unload points and actuator_disable_safety_max_value_mm is the maximum value where the safety is not disabled. If the actuator is lower than this parameter, then disable safety is sent. If needed, the speed can be limited also while the disable is active. It can be set with parameter disable_safety_limit_speed.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 11</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Disable safety</td><td>Byte</td><td>1</td><td>1 = Navitrol request safety to be disabled, <br />0 = Not disabled</td></tr>
</tbody></table>
<hr />
<h5 id="12---drive-order-info-section"><a class="header" href="#12---drive-order-info-section">12 - Drive order info section</a></h5>
<p>Information from current drive order.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 12</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length = 100</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Going to ID</td><td>Uint</td><td>4</td><td>ID of ongoing or last drive target, updated at start of a drive</td></tr>
<tr><td>Target reached</td><td>Uint</td><td>2</td><td>1 if the Going to ID destination has been reached and the AGV is stopped, else 0 <br />Note: AGV is considered to be stopped, if measured speed is less than value of mot_ctrl_wheel_v_min -parameter</td></tr>
<tr><td>Going to name</td><td>Char[32]</td><td>32</td><td>Name of goal symbolic point of the drive, null-terminated string</td></tr>
<tr><td>Coming from name</td><td>Char[32]</td><td>32</td><td>Name of symbolic point where the drive started, null-terminated string</td></tr>
<tr><td>Current segment</td><td>Uint</td><td>4</td><td>The ID of the segment on which the AGV currently is located</td></tr>
<tr><td>Distance to segment</td><td>Float</td><td>4</td><td>The transversal distance to the segment in meters</td></tr>
<tr><td>On route</td><td>Uint</td><td>2</td><td>AGV on route information,  <br />1 - on route 0 - not on route</td></tr>
<tr><td>Tag ID</td><td>Uint</td><td>2</td><td>ID of the route tag. A tag value can be defined on any part or group of segments to distinguish one part of the route network from another. <br />Valid values 0 - 65280.</td></tr>
<tr><td>Door Tag ID</td><td>Uint</td><td>2</td><td>Door type symbolic point writes tag IDs to route automatically.</td></tr>
<tr><td>Reserved Tag IDs</td><td>Uint</td><td>4</td><td></td></tr>
<tr><td>Driving vector angle</td><td>Float</td><td>4</td><td>Driving vector angle relative to the vehicle frame (+/- PI in radians)  <br />0-forwards along vehicle center line. Positive direction is CCW from the vehicle center line.</td></tr>
<tr><td>Turning information</td><td>Uint</td><td>2</td><td>Vehicle turning/pivoting. <br />0 = No turning <br />1 = Left <br />2 = Right <br />3 = Blink both (Not currently implemented) <br />4 = Adjusting wheels for pivoting <br />5 = Pivot left <br />6 = Pivot right <br />7 = Approaching pivot point</td></tr>
</tbody></table>
<hr />
<h5 id="13---distance-to-target-section"><a class="header" href="#13---distance-to-target-section">13 - Distance to target section</a></h5>
<p>Distance information of current drive order</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.26.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 13</td><td>Uint</td><td>2</td><td>Distance to Target section</td></tr>
<tr><td>Section length = 52</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Distance to Target</td><td>Float</td><td>4</td><td>Length of the straight line between current position and the target location</td></tr>
<tr><td>Trajectory length to Target</td><td>Float</td><td>4</td><td>Length of the trajectory from current position to the target location, information only valid when in AUTO_STATE</td></tr>
<tr><td>Target X</td><td>Float</td><td>4</td><td>Drive target X coordinate, updated in AUTO_STATE</td></tr>
<tr><td>Target Y</td><td>Float</td><td>4</td><td>Drive target Y coordinate, updated in AUTO_STATE</td></tr>
<tr><td>Target H</td><td>Float</td><td>4</td><td>Drive target Heading in radians, updated in AUTO_STATE</td></tr>
<tr><td>Target is Symbolic point</td><td>Uint</td><td>2</td><td>End point of trajectory is symbolic point 0=False, 1=True, updated in AUTO_STATE</td></tr>
<tr><td>Target Symbolic point ID</td><td>Uint</td><td>4</td><td>Trajectory target ID, valid only if &quot;Target is Symbolic point&quot; is set true, updated in AUTO_STATE</td></tr>
<tr><td>Target Symbolic point type</td><td>Bitfield</td><td>4</td><td>Symbolic point type bitfield of target symbolic point.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Target Symbolic point type bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Load</td><td>0</td><td></td></tr>
<tr><td>Unload</td><td>1</td><td></td></tr>
<tr><td>Wait unload</td><td>2</td><td></td></tr>
<tr><td>Wait unload</td><td>3</td><td></td></tr>
<tr><td>Charge</td><td>4</td><td></td></tr>
<tr><td>Stop</td><td>5</td><td></td></tr>
<tr><td>Reserved</td><td>6-7</td><td>Not in use</td></tr>
<tr><td>Hold</td><td>8</td><td></td></tr>
<tr><td>Tag</td><td>9</td><td></td></tr>
<tr><td>Decision point</td><td>10</td><td></td></tr>
<tr><td>Door</td><td>11</td><td></td></tr>
<tr><td>Stop-and-hold</td><td>12</td><td></td></tr>
<tr><td>Level change</td><td>13</td><td></td></tr>
<tr><td>Buffer lane</td><td>14</td><td></td></tr>
<tr><td>Rack</td><td>15</td><td></td></tr>
</tbody></table>
<hr />
<h5 id="14---all-custom-properties"><a class="header" href="#14---all-custom-properties">14 - All Custom properties</a></h5>
<p>This message will send all custom properties that are parsed from the segment file. The maximum number is 20. The first byte informs how many properties are coming. Each property has a value and name.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 14</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length = 10 + N * 36</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Number of properties = N</td><td>Int</td><td>4</td><td>Number of properties that will be sent <br />Max value 20</td></tr>
<tr><td>Property data</td><td>Property type</td><td>36 * N</td><td>Each property has a value and name</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Property data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Property value</td><td>Float</td><td>4</td><td>Value of property</td></tr>
<tr><td>Property name</td><td>Char[32]</td><td>32</td><td>Name of property</td></tr>
</tbody></table>
<hr />
<h5 id="15---coupled-drive-status-section"><a class="header" href="#15---coupled-drive-status-section">15 - Coupled drive status section</a></h5>
<p>This section contains data about coupled formation and state. The complete contents can only be provided by the leader AGV.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length  (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 15</td><td>Uint</td><td>2</td><td>Coupled drive status section</td></tr>
<tr><td>Section length = 60</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Coupling mode</td><td>Uint</td><td>2</td><td>0 = Decoupled <br />1 = Coupled as leader <br />2 = Coupled as follower</td></tr>
<tr><td>Coupled state</td><td>Uint</td><td>2</td><td>The coupled state of the machine  <br />0 = NO_STATE  <br />1 = START  <br />2 = STANDBY  <br />3 = AUTO  <br />9 = FSTOP  <br />14 = LOAD  <br />15 = HOLD  <br />16 = MANUAL  <br />17 = PAUSE</td></tr>
<tr><td>Communication ok</td><td>Uint</td><td>2</td><td>0 = Not ok 1 = Ok</td></tr>
<tr><td>Formation data</td><td>Formation data type</td><td>32</td><td>Formation data is only valid for leader when communication is ok</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Formation data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>X-position</td><td>Float</td><td>4</td><td>X-coordinate of formation's navigation point in map coordinates(meters)</td></tr>
<tr><td>Y-position</td><td>Float</td><td>4</td><td>Y-coordinate of formation's navigation point in map coordinates (meters)</td></tr>
<tr><td>Heading</td><td>Float</td><td>4</td><td>Heading of the formation (degrees) in map coordinates</td></tr>
<tr><td>Omni heading</td><td>Float</td><td>4</td><td>Omni heading / &quot;frame heading&quot; of the formation (degrees)</td></tr>
<tr><td>Velocity</td><td>Float</td><td>4</td><td>Speed of the formation (m/s)</td></tr>
<tr><td>Turn rate</td><td>Float</td><td>4</td><td>Turn rate of the formation (degrees/s)</td></tr>
<tr><td>Current segment</td><td>Uint</td><td>4</td><td>Current segment of the formation</td></tr>
<tr><td>Distance to route</td><td>Float</td><td>4</td><td>Formation's distance from the defined route - along trajectory normal (meters)</td></tr>
</tbody></table>
<hr />
<h5 id="16---drive-order-with-enroute-stopping-point-data"><a class="header" href="#16---drive-order-with-enroute-stopping-point-data">16 - Drive order with enroute stopping point data</a></h5>
<p>This section will send the data for the drive order with enroute stopping points.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 16</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length = 12</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Is AGV within the distance specified by stop_enroute_speed_activation_dist_m</td><td>Unsigned char</td><td>1</td><td>1 = AGV within specified distance <br />0 = AGV not within specified distance</td></tr>
<tr><td>Reserved</td><td>NA</td><td>5</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="17---trailer-transport-section"><a class="header" href="#17---trailer-transport-section">17 - Trailer transport section</a></h5>
<p>This section contains trailer transport data required for coupling and uncoupling sequences. Navitrol uses this section to request coupling actions and will wait until supervisor confirms the action to be ready using Supervisor trailer transport section.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>17</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>22</td></tr>
<tr><td>Trailer coupling action</td><td>Uint</td><td>2</td><td>During coupling to a trailer or uncoupling from one Navitrol will send these “coupling actions” based on the state of the coupling. Navitrol expects that Supervisor will change the “Coupling status” (in message 3002:12) to match the given action before it continues to next (un)coupling state.<br />Values:<br />0 = No action<br />1 = Uncouple (move actuator down)<br />2 = Prepare for coupling (move actuator to kingpin height)<br />3 = Prepare for uncoupling (move actuator to kingpin height, release lock)<br />4 = Couple (move actuator to transport height / lock trailer)</td></tr>
<tr><td>Trailer dimensions request</td><td>Uint</td><td>2</td><td>Indicates if Navitrol is waiting for trailer dimensions from the supervisor. (Sent using message 3042)<br />0 = All good<br />1 = Waiting for Trailer dimensions</td></tr>
<tr><td>Reserved</td><td>NA</td><td>12</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="18---vehicle-speed-section"><a class="header" href="#18---vehicle-speed-section">18 - Vehicle speed section</a></h5>
<p>Information about trajectory speed reference, measured and calculated speeds on the vehicle</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 18</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length = 36 + wheel count * 4</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Trajectory reference speed</td><td>Float</td><td>4</td><td>Speed reference given in trajectory point in m/s. Nonzero when driving. <br />Zero at startup, can be zeroed in standby or left as the last used reference.</td></tr>
<tr><td>Vehicle speed</td><td>Float</td><td>4</td><td>Navigation point speed in m/s. Can be both positive and negative. If negative, the vehicle is moving in the opposite direction of the speed direction.</td></tr>
<tr><td>Vehicle speed direction</td><td>Float</td><td>4</td><td>Navigation point speed direction relative to vehicle body in degrees. Range +-180 degrees, 0 forwards along vehicle center axis</td></tr>
<tr><td>Wheel count</td><td>Uint</td><td>2</td><td>Number of wheels with speed measurement on vehicle.</td></tr>
<tr><td>Wheel speed</td><td>Float</td><td>4 * wheel count</td><td>Speed of each wheel in m/s Sending order:  <br />Steer drive - index 0 <br />Diff drive - left 0, right 1 <br />Mecanum: Front left 0, front right 1, rear left 2, rear right 3 <br />Omni drive - order from 0 to count in parameters wheel_x[i], wheel_y[i]</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="19---scanner-status-section"><a class="header" href="#19---scanner-status-section">19 - Scanner status section</a></h5>
<p>This section contains the status information from all safety and measurement scanners connected to Navitrol.</p>
<p>Scanner types:</p>
<ul>
<li>Measurement scanners
<ul>
<li>Navigation scanner
<ul>
<li>Used for localization</li>
<li>Related parameters: <strong>scanner_model_front</strong> and <strong>scanner_model_rear</strong></li>
</ul>
</li>
<li>Measurement only scanner
<ul>
<li>Used for example target detection or obstacle avoidance
- Related parameters: <strong>scanner_meas_model</strong></li>
</ul>
</li>
</ul>
</li>
<li>Safety only scanner
<ul>
<li>Used for warning and protection zone information</li>
<li>Must be a safety scanner model</li>
<li>Related parameters: <strong>safety_scanner_model</strong></li>
</ul>
</li>
</ul>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID</td><td>Uint</td><td>2</td><td>19</td></tr>
<tr><td>Section length</td><td>Uint</td><td>4</td><td>10 + 2 * (NMS + NSS)</td></tr>
<tr><td>Number of measurement scanners</td><td>Uint</td><td>2</td><td>Number of measurement scanner statuses sent. (NMS)<br />Equals to number of supported measurement scanners – currently Navitrol supports 4 measurement scanners.<br />The status is sent from all measurement scanners even if some of them would not be in use.</td></tr>
<tr><td>Measurement scanner status</td><td>Scanner status bitfield[]</td><td>2 * NMS</td><td>Measurement scanner status as 2-byte bitfield array. <br />Default array indexes: <br />[0] – Rear navigation scanner  <br />[1] – Front navigation scanner  <br />[2] – Measurement only scanner 1  <br />[3] – Measurement only scanner 2 <br />0 – Inactive, 1 – Active</td></tr>
<tr><td>Number of safety only scanners</td><td>Uint</td><td>2</td><td>Number of safety only scanner statuses sent. (NSS)<br />Equals to number of safety scanners (NSS) in use – currently Navitrol supports up to 4 safety scanners.<br />Status will be sent only from the safety scanners defined with <strong>safety_scanner_model</strong>-array parameter.</td></tr>
<tr><td>Safety scanner status</td><td>Scanner status bitfield[]</td><td>2 * NSS</td><td>Safety scanner status as 2-byte bitfield array.<br />Array indexes: <br />The same order as the scanners are defined with <strong>safety_scanner_model</strong>-array parameter.</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Scanner status bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Pollution warning</td><td>0</td><td>Scanner pollution warning – Scanner is dirty.</td></tr>
<tr><td>Pollution error</td><td>1</td><td>Scanner pollution error – Scanner is very dirty</td></tr>
<tr><td>Fatal error</td><td>2</td><td>Scanner reports fatal error – Scanner is unoperational</td></tr>
<tr><td>Protection zone</td><td>3</td><td>Scanner protection zone triggered</td></tr>
<tr><td>Warning zone 1</td><td>4</td><td>Scanner warning zone 1 triggered.</td></tr>
<tr><td>Warning zone 2</td><td>5</td><td>Scanner warning zone 2 triggered.</td></tr>
<tr><td>Reserved</td><td>6-15</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h5 id="20---sleep-mode-command-section"><a class="header" href="#20---sleep-mode-command-section">20 - Sleep mode command section</a></h5>
<p>This section contains the command for sleep mode. With the sleep mode feature, the fleet control can request AGVs to save battery. The supervisor can inform the fleet control about AGV's current sleep mode state by sending the <a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#9---sleep-mode-state-section">sleep mode state section in 3002 status message</a>.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.56.00</td><td>Section added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Section ID = 20</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Section length = 8</td><td>Uint</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Sleep mode command</td><td>Uint</td><td>2</td><td>0 = Normal operation <br/> 1 = Activate sleep <br/> 2 = Activate deep sleep</td></tr>
</tbody></table>
<hr />
<h4 id="3103---symbolic-point-data-result"><a class="header" href="#3103---symbolic-point-data-result">3103 - Symbolic point data result</a></h4>
<p>Navitrol sends this message as a reply to the &quot;Symbolic Point Data Request&quot;-message and always after Navitrol has loaded the symbolic points into memory. This message contains the information of all symbolic points parsed by Navitrol e.g. for a UI display.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3103</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Number of Symbolic Points = N</td><td>Uint</td><td>4</td><td>The number of Symbolic Point data structures in this message</td></tr>
<tr><td>Symbolic point data</td><td>SP data type</td><td>N * 84</td><td></td></tr>
</tbody></table>
<table><thead><tr><th><strong>Symbolic point data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Symbolic Point ID</td><td>Uint</td><td>4</td><td>ID of the symbolic point</td></tr>
<tr><td>Symbolic Point Name</td><td>Char[32]</td><td>32</td><td>name of the symbolic point</td></tr>
<tr><td>X-coordinate</td><td>Float</td><td>4</td><td>x-coordinate of the symbolic point</td></tr>
<tr><td>Y-coordinate</td><td>Float</td><td>4</td><td>y-coordinate of the symbolic point</td></tr>
<tr><td>Level</td><td>Int</td><td>4</td><td>Level of the symbolic point</td></tr>
<tr><td>Position Init1- ID</td><td>Int</td><td>4</td><td>ID for the position init pose 1. -1 if not defined for this symbolic point</td></tr>
<tr><td>Position Init1 - Heading</td><td>Float</td><td>4</td><td>Heading for the AGV when setting position to PositionInit1</td></tr>
<tr><td>Position Init2 - ID</td><td>Int</td><td>4</td><td>ID for the position init pose 2 -1 if not defined for this symbolic point</td></tr>
<tr><td>Position Init2 - Heading</td><td>Float</td><td>4</td><td>Heading for the AGV when setting position to PositionInit2 (opposite heading to PositionInit1).</td></tr>
<tr><td>Virtual Tag enabled</td><td>Uint</td><td>2</td><td>1 if a virtual tag is enabled for this symbolic point (applies to 'generic' tag, so doors, Navitrol features or any route properties do not trigger this or the Virtual Tag value)</td></tr>
<tr><td>Virtual Tag value</td><td>Uint</td><td>4</td><td>This value (i.e. action code) is written into the &quot;Navitrol Status&quot;-message when the AGV is entering this symbolic point (field <em>Virtual Tag value</em> in message 3012)</td></tr>
<tr><td>IsLoad</td><td>Uint</td><td>2</td><td>1 if symbolic point is a loading location</td></tr>
<tr><td>isUnload</td><td>Uint</td><td>2</td><td>1 if symbolic point is an unloading location</td></tr>
<tr><td>isWaitLoad</td><td>Uint</td><td>2</td><td>1 if symbolic point is a wait loading location</td></tr>
<tr><td>isWaitUnload</td><td>Uint</td><td>2</td><td>1 if symbolic point is a wait unloading location</td></tr>
<tr><td>isChargingLocation</td><td>Uint</td><td>2</td><td>1 if symbolic point is a charging location</td></tr>
<tr><td>isStopLocation</td><td>Uint</td><td>2</td><td>1 if symbolic point is a stop location</td></tr>
<tr><td>isHold</td><td>Uint</td><td>2</td><td>1 if symbolic point is a hold location</td></tr>
</tbody></table>
<hr />
<h4 id="3104---release-hold-to-custom-destination-result"><a class="header" href="#3104---release-hold-to-custom-destination-result">3104 - Release hold to custom destination result</a></h4>
<p>Navitrol sends this message as a reply to the <em>Release hold to custom destination</em> message.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3104</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 16</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>Symbolic Point ID of the destination.</td></tr>
<tr><td>Release result</td><td>Uint</td><td>4</td><td>0 accepted, 1 bad input data, 2 wrong state, 3 unreachable ID, 4 drive control disabled</td></tr>
</tbody></table>
<hr />
<h4 id="3105---go-to-destination-result"><a class="header" href="#3105---go-to-destination-result">3105 - Go to destination result</a></h4>
<p>Navitrol sends this message as a reply to the <em>Go to destination</em> message.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3105</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 16</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>Symbolic Point ID of the destination.</td></tr>
<tr><td>Go to result</td><td>Uint</td><td>4</td><td>0 accepted, <br />1 bad input data, <br />2 wrong state, <br />3 unreachable ID, <br />4 drive control disabled, <br />5 too big transversal offset, <br />6 too big longitudinal offset, <br />7 too big heading offset <br /> 8 drive rejected (no active drive controllers),  <br />9 error(s) active <br />10 AGV distance error to route too high <br />11 trajectory generation failure  <br />12 previous drive order in progress <br /> 13 AGV already at the destination ID</td></tr>
</tbody></table>
<hr />
<h4 id="3106---pause-drive-result"><a class="header" href="#3106---pause-drive-result">3106 - Pause drive result</a></h4>
<p>Navitrol sends this message as a reply to the <em>Pause drive</em> message.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3106</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Pause result</td><td>Uint</td><td>4</td><td>0 accepted, <br />1 bad input data, <br />2 wrong state</td></tr>
</tbody></table>
<hr />
<h4 id="3107---resume-drive-result"><a class="header" href="#3107---resume-drive-result">3107 - Resume drive result</a></h4>
<p>Navitrol sends this message as a reply to the <em>Resume drive</em> message.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3107</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 16</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>Symbolic Point ID of the resumed drive destination.</td></tr>
<tr><td>Resume result</td><td>Uint</td><td>4</td><td>0 accepted, <br />1 bad input data, <br />2 wrong state</td></tr>
</tbody></table>
<hr />
<h4 id="3108---abort-drive-result"><a class="header" href="#3108---abort-drive-result">3108 - Abort drive result</a></h4>
<p>Navitrol sends this message as a reply to the <em>Abort drive</em> message. Aborting is accepted if the machine is driving or if a drive is paused.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3108</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Abort result</td><td>Uint</td><td>4</td><td>0 accepted, <br />1 bad input data, <br />2 wrong state</td></tr>
</tbody></table>
<hr />
<h4 id="3111---stop-hold-released"><a class="header" href="#3111---stop-hold-released">3111 - Stop hold released</a></h4>
<p>Navitrol sends this message as a reply to the <em>Release stop hold</em> message (Message ID 3011).</p>
<p>Note: This is a specific message for only Stop-and-Hold point and the logic is different than in normal release-hold production, which is run with other types of symbolic points.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3111</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 10</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Release Stop Hold Result</td><td>Uint</td><td>2</td><td>0 = accepted, <br />1 = rejected - not stop hold <br />2 = rejected - wrong mode</td></tr>
</tbody></table>
<hr />
<h4 id="3112---go-to-destination-with-route-offset-result"><a class="header" href="#3112---go-to-destination-with-route-offset-result">3112 - Go to destination with route offset result</a></h4>
<p>Navitrol sends this message as a reply to the <em>Go to destination with route offset</em> message.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3112</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 16</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>Symbolic Point ID of the destination.</td></tr>
<tr><td>Go to result</td><td>Uint</td><td>4</td><td><a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#3105---go-to-destination-result">Same as: 3105 - Go to destination result</a></td></tr>
</tbody></table>
<hr />
<h4 id="3113-go-to-destination-with-order-id-result"><a class="header" href="#3113-go-to-destination-with-order-id-result">3113 Go To Destination With Order ID result</a></h4>
<p>Navitrol replies to the Go To Destination With Order ID message just to inform whether it has been accepted for forwarding to fleet control. The fleet control can still refuse the drive order based on the route and fleet statuses. If the fleet control accepts and starts the drive order, the production status is reported in message 3115 Production Status Data.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.26.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3113</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 20</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Destination ID</td><td>Uint</td><td>4</td><td>Symbolic Point ID of the destination.</td></tr>
<tr><td>Go To order result</td><td>Uint</td><td>4</td><td><a href="AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#3105---go-to-destination-result">Same as: 3105 - Go to destination result</a></td></tr>
<tr><td>Order ID</td><td>Uint</td><td>4</td><td>Verification of the order ID generated by the supervisor <br />0xFFFF FFFF - no ID</td></tr>
</tbody></table>
<hr />
<h4 id="3114-production-status-data-sending-request-result"><a class="header" href="#3114-production-status-data-sending-request-result">3114 Production Status Data Sending Request Result</a></h4>
<p>Navitrol replies to the Production Status Data Sending Request message to inform the current sending status.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.26.00</td><td>Message added</td></tr>
<tr><td>6.42.00</td><td>Added requested once and invalid request received responses</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3114</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>10</td></tr>
<tr><td>Sending status</td><td>Uint</td><td>2</td><td>0 – Sending deactivated<br />1 – Sending on update activated<br />2 – Requested once<br />100 – Invalid request received</td></tr>
</tbody></table>
<hr />
<h4 id="3115-production-status-data"><a class="header" href="#3115-production-status-data">3115 Production Status Data</a></h4>
<p>Navitrol sends this message if the production status sending has been activated. Activation is done either by sending message 3013 - Go to destination message with ID or by separately activating the sending with message 3014 - Production status sending request. The message is sent every time a production order status message is received from the fleet control.</p>
<p>Note: Sending production status data is disabled by default on Navithor side. It can be enabled with “Machine_ProductionStatusIntervalMs” Navithor parameter.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.26.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3115</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 36</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Order ID external</td><td>Uint</td><td>4</td><td>The last order ID received from the Supervisor</td></tr>
<tr><td>Order ID sent</td><td>Uint</td><td>4</td><td>The last order ID sent to fleet control</td></tr>
<tr><td>Order ID active</td><td>Uint</td><td>4</td><td>Current active drive order ID in fleet control</td></tr>
<tr><td>Item type</td><td>Uint</td><td>4</td><td>Item being handled by the AGV in the active drive order. <br />0xFFFF FFFF - no item</td></tr>
<tr><td>Pick up ID</td><td>Uint</td><td>4</td><td>Symbolic point ID to pick up from</td></tr>
<tr><td>Target ID</td><td>Uint</td><td>4</td><td>Symbolic point ID to bring the resource to</td></tr>
<tr><td>Order status</td><td>Short Integer</td><td>2</td><td>0 - new_order <br />1 - order loaded <br />2 - order waiting <br />3 - executing  <br />4 - interrupted <br />5 - completed <br />6 - cancelled</td></tr>
<tr><td>Machine in production</td><td>Uint</td><td>2</td><td>0 - machine not in production <br />1 - machine in production</td></tr>
</tbody></table>
<hr />
<h4 id="3121---start-new-drive-result"><a class="header" href="#3121---start-new-drive-result">3121 - Start New Drive Result</a></h4>
<p>Navitrol sends this message as a reply to the Start New Drive message.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3121</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Start New Drive Result</td><td>Uint</td><td>4</td><td>0 accepted <br />1 bad input data <br />2 wrong state <br />3 invalid traj type <br />4 message size mismatch <br />5 rejected due to active error <br />6 trajectory calculation failed <br />7 invalid point attribute (like omni heading for steer/diff drive AGV) <br />8 too few trajectory points sent <br />9 too many trajectory points sent <br />10 distance between trajectory points too small <br />11 distance between trajectory points too large <br />12 - undefined <br />13 route too far from current location <br />14 agv heading differs too much from route heading <br /><strong>NOTE:</strong> Some example cases what might have caused a specific result can be found under the message specification 3021</td></tr>
</tbody></table>
<hr />
<h4 id="3122---extend-drive-result"><a class="header" href="#3122---extend-drive-result">3122 - Extend Drive Result</a></h4>
<p>Navitrol sends this message as a reply to the Extend drive message.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3122</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Extend Drive Result</td><td>Uint</td><td>4</td><td>0 accepted <br />1 bad input data <br />2 wrong state <br />3 invalid traj type <br />4 message size mismatch <br />5 rejected due to active error <br />6 trajectory calculation failed <br />7 invalid point attribute (like omni heading for steer/diff drive AGV) <br />8 too few trajectory points sent <br />9 too many trajectory points sent <br />10 distance between trajectory points too small <br />11 distance between trajectory points too large <br />12 invalid drive extension message type  <br /><strong>NOTE:</strong> Some example cases what might have caused a specific result can be found under the message specification 3021</td></tr>
</tbody></table>
<hr />
<h4 id="3123---speed-limit-set"><a class="header" href="#3123---speed-limit-set">3123 - Speed Limit Set</a></h4>
<p>Navitrol sends this message as a reply to the Set Speed Limit message.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3123</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 14</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Released/Set</td><td>Uint</td><td>2</td><td>0 - released, 1 - set</td></tr>
<tr><td>Speed limit</td><td>Float</td><td>4</td><td>Max speed set in m/s <br />Note: FLT_MAX if released</td></tr>
</tbody></table>
<hr />
<h4 id="3124---return-to-route-response"><a class="header" href="#3124---return-to-route-response">3124 - Return To Route Response</a></h4>
<p>Navitrol sends this message to supervisor as a response to return-to-route request message. Navitrol will reply with 0 or 1 for return-to-route success or return-to-route failure respectively.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3124</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Return-to-route result</td><td>Uint</td><td>4</td><td>0 = return-to-route found a segment point that satisfies the constraints set by parameters. <br /> 1 = no such segment point found that satisfies the return-to-route constraints as specified by the parameters <br /> 2 = Wrong state. Return to route is already active or AGV is not in Standby or Coupled state. <br /> 3 = Not used for this feature. <br /> 4 = Auto driving is disabled.</td></tr>
</tbody></table>
<hr />
<h4 id="3128---custom-speed-array-result"><a class="header" href="#3128---custom-speed-array-result">3128 - Custom Speed Array Result</a></h4>
<p>Navitrol sends this message as a reply to <em>Select Custom Speed Array Parameters</em> message 3028.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3127</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 8</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Custom speed array result</td><td>Uint</td><td>2</td><td>0 = Custom speed array released <br />1 = Custom speed array set</td></tr>
</tbody></table>
<hr />
<h4 id="3129---drive-ready"><a class="header" href="#3129---drive-ready">3129 - Drive ready</a></h4>
<p>Navitrol sends this message, when a drive order is ready. It is sent if fleet_control_enabled = 2 or veh_inte_send_drive_ready_msg = 1.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3129</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Drive order result</td><td>Uint</td><td>4</td><td>0 - Drive order Ok <br />1 - Drive order failed</td></tr>
</tbody></table>
<hr />
<h4 id="3131--drive-order-from-segments-result"><a class="header" href="#3131--drive-order-from-segments-result">3131- Drive Order from Segments Result</a></h4>
<p>Navitrol sends this message as a reply to <em>Drive Order from Segments</em> 3031.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3131</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 12</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Drive order from segments result</td><td>Uint</td><td>4</td><td>0 accepted, <br />1 bad input data, <br />2 wrong state, <br />4 drive control disabled, <br />5 too large transversal offset, <br />6 too large longitudinal offset, <br />7 too large heading offset <br />8 drive order rejected, <br />9 error(s) active, <br />10 too large distance from route</td></tr>
</tbody></table>
<hr />
<h4 id="3132---set-target-detection-mode-result"><a class="header" href="#3132---set-target-detection-mode-result">3132 - Set target detection mode result</a></h4>
<p>Navitrol sends this as a response to the message 3032. Returns &quot;Result&quot; = 0 if the target detection mode was changed successfully. If the message was rejected the reason is indicated by the value of the &quot;Result&quot;.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.30.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3132</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 10</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Result</td><td>Uint</td><td>2</td><td>0 = Accepted <br />1 = Rejected - Unsupported &quot;Target detection mode to set&quot; <br />2 = Rejected - Unsupported amount of reflector docking reflectors <br />3 = Rejected - value of target_detection_type_selection != 5 in params.txt <br />4 = Rejected - Docking to the previous target already started <br />5 = Rejected - Reflector width is negative or zero <br />6 = Rejected - Pattern distance value is outside of the defined range [0.0, 1.0] <br />7 = Rejected - Given pallets given for search in pallets to detect bitfield</td></tr>
</tbody></table>
<hr />
<h4 id="3134---pgv-data-response"><a class="header" href="#3134---pgv-data-response">3134 - PGV Data Response</a></h4>
<p>Navitrol starts to send this message after it is requested with message 3034. Message is sent every n:th time Navitrol receives PGV data from the sensor(s). By default, Navitrol sends this message every time data is received (n = 1) but it can be adjusted via parameter pgv_to_supervisor_nth_sync.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3134</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Number of PGVs</td><td>Uint</td><td>2</td><td>Number of connected PGVs. Max 4.</td></tr>
<tr><td>PGV data</td><td>Array of PGV data</td><td>Variable: Number of PGVs * structure size</td><td></td></tr>
</tbody></table>
<table><thead><tr><th><strong>PGV data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Data available</td><td>Uint</td><td>2</td><td>0 = No data available. Check configuration. 1 = Data available</td></tr>
<tr><td>Y-position</td><td>Int</td><td>4</td><td>Scaling 0.1 mm</td></tr>
<tr><td>X-position</td><td>Uint</td><td>4</td><td>Scaling 0.1 mm</td></tr>
<tr><td>Heading</td><td>Uint</td><td>2</td><td>Scaling 0.1 degrees, 0-3600 positive rotation in CW</td></tr>
<tr><td>Status</td><td>Bitfield</td><td>2</td><td></td></tr>
<tr><td>Warning</td><td>Uint</td><td>2</td><td>Warning code</td></tr>
<tr><td>Data Matrix Tag</td><td>Uint</td><td>4</td><td>Tag number</td></tr>
<tr><td>Control Code Status</td><td>Uint</td><td>2</td><td>Refer to PGV manual</td></tr>
<tr><td>Control Code</td><td>Uint</td><td>2</td><td>Number of the detected control code</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Status  bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Error message</td><td>0</td><td></td></tr>
<tr><td>No absolute X position</td><td>1</td><td></td></tr>
<tr><td>Warning message</td><td>2</td><td></td></tr>
<tr><td>Control code detected</td><td>3</td><td></td></tr>
<tr><td>Reserved</td><td>4</td><td></td></tr>
<tr><td>Right lane selected</td><td>5</td><td></td></tr>
<tr><td>Left lane selected</td><td>6</td><td></td></tr>
<tr><td>No colored line detected</td><td>7</td><td></td></tr>
<tr><td>Repair tape detected</td><td>8</td><td></td></tr>
<tr><td>LC0</td><td>9</td><td></td></tr>
<tr><td>LC1</td><td>10</td><td></td></tr>
<tr><td>Tag detected</td><td>11</td><td></td></tr>
<tr><td>Tag detected</td><td>12-15</td><td></td></tr>
</tbody></table>
<hr />
<h4 id="3135---external-target-detection-response"><a class="header" href="#3135---external-target-detection-response">3135 - External target detection response</a></h4>
<p>Navitrol sends this message as a reply to Supervisor external target detection message 3035</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.30.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3135</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 28</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Start detection</td><td>Uint</td><td>2</td><td>1 -start detecting the target <br />0 - Stop detecting</td></tr>
<tr><td>Assumed target position X difference</td><td>Float</td><td>4</td><td>Distance from sensor position along the centre line of the detection sensor view.</td></tr>
<tr><td>Assumed target position Y difference</td><td>Float</td><td>4</td><td>Distance from sensor position perpendicular to the centre line of the detection sensor view. Positive to the left.</td></tr>
<tr><td>Assumed target position Z difference</td><td></td><td>4</td><td>Distance from sensor position in vertical direction. Positive direction upwards. <br />Value forced to 0</td></tr>
<tr><td>Assumed target angle difference</td><td>Float</td><td>4</td><td>Angle of the target with respect to the X-axis. Positive in CCW direction.</td></tr>
<tr><td>Detection too far from route</td><td>Uint</td><td>2</td><td>1 = target detected too far away <br />Otherwise value is 0</td></tr>
</tbody></table>
<hr />
<h4 id="3136---coupled-drive-coupling-response"><a class="header" href="#3136---coupled-drive-coupling-response">3136 - Coupled drive: coupling response</a></h4>
<p>Navitrol will send this message as a response to 3036.</p>
<p>Leader:</p>
<ul>
<li>The <strong>Coupling result</strong> will be <strong>coupling started</strong> if there is no immediate reason for Navitrol to refuse the command. <strong>Coupling will fail</strong> otherwise</li>
</ul>
<p>Follower:</p>
<ul>
<li><strong>Coupling will be ok</strong> if the follower was in the right state (STANDBY) and starts waiting for connection from the leader.</li>
<li><strong>Coupling will fail</strong> otherwise</li>
</ul>
<p>If given bad input, the coupling result point out one error even if there are many. The more exact error descriptions can be read from Navitrol logs.</p>
<p><strong>Note:</strong> If the leader fails to connect, all AGV's must get a decoupling message (3037). Else the leader will try connecting and the followers will remain waiting for a connection.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3136</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 16</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Coupling mode</td><td>Uint</td><td>2</td><td>Coupling mode after coupling command <br />0 = Uncoupled <br />1 = Leader 2 = Follower</td></tr>
<tr><td>Coupling result</td><td>Uint</td><td>2</td><td>0 = Coupling started <br />1 = Unsupported coupling mode <br />2 = Unsupported number of AGVs <br />3 = Invalid load dimension <br />4 = Invalid IP <br />5 = Invalid machine ID <br />6 = Invalid position <br />7 = Wrong state</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3137---coupled-drive-decoupling-response"><a class="header" href="#3137---coupled-drive-decoupling-response">3137 - Coupled drive: decoupling response</a></h4>
<p>Navitrol will send this message as a response to 3037.</p>
<p>Leader:</p>
<ul>
<li><strong>Decoupling will be ok</strong> if the coupling control state allows decoupling and the leader has disconnected from all followers.</li>
<li><strong>Decoupling will fail</strong> otherwise</li>
</ul>
<p>Follower:</p>
<ul>
<li><strong>Decoupling will be ok</strong> if the follower was in the right state (STANDBY, FSTOP, START) and the coupling communication is disconnected, or if the follower was still waiting for the coupling communication.</li>
<li><strong>Decoupling will fail</strong> otherwise</li>
</ul>
<p><strong>Note:</strong> If leader fails to connect to the followers. Each follower must get this decoupling message to end waiting for a connection.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3137</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 16</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Coupling mode</td><td>Uint</td><td>2</td><td>Coupling mode before decoupling command <br />0 = Uncoupled <br />1 = Leader <br />2 = Follower</td></tr>
<tr><td>Decoupling result</td><td>Uint</td><td>2</td><td>0 = Decoupling ok <br />1 = Decoupling failed wrong state</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3142--trailer-transport-set-trailer-dimensions-response"><a class="header" href="#3142--trailer-transport-set-trailer-dimensions-response">3142 – Trailer Transport: Set Trailer Dimensions response</a></h4>
<p>Navitrol’s response message to the Supervisor’s Activate Trailer transport message (3042).</p>
<p>Note: If multiple valid 3042 messages are sent within a short interval, first one is accepted and other are rejected with result value 3.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3142</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>14</td></tr>
<tr><td>Set dimensions result</td><td>Uint</td><td>2</td><td><strong>0</strong> = <strong>Dimensions set successfully</strong> <br /><strong>1</strong> = <strong>Error invalid input</strong> - Received dimensions are either too small or too large <br /><strong>2</strong> = <strong>Error trailer transport feature not enabled</strong> - with parameter trailer_transport_enabled.  <br /><strong>3</strong> = <strong>Error wrong state</strong> Navitrol is not expecting trailer dimensions, either coupling is not active, or the dimensions have already been set.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3143---coupled-drive-coupling-configuration"><a class="header" href="#3143---coupled-drive-coupling-configuration">3143 - Coupled drive: coupling configuration</a></h4>
<p>Navitrol will send this message as a response to request for coupling configuratoin 3043.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3143</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length for:  <br />Leader = 30 + N * Coupling Data Size = 158 or 222  <br />Follower /Uncoupled = 10</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)  <br />N = &quot;Number of AGVs&quot;</td></tr>
<tr><td>Coupling mode</td><td>Uint</td><td>2</td><td>0 = Uncoupled 1 = Leader 2 = Follower</td></tr>
<tr><td>-</td><td>-</td><td>-</td><td>Only Leader response will have following data</td></tr>
<tr><td>Number of AGVs = N</td><td>Uint</td><td>2</td><td>Number of AGVs in coupling</td></tr>
<tr><td>AGV Coupling Data Size</td><td>Uint</td><td>2</td><td>Size of coupling data per AGV = 64</td></tr>
<tr><td>AGV coupling data[N]</td><td>Array of AGV coupling data</td><td>N * structure size (64)</td><td></td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>AGV coupling data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>IP address</td><td>Char[46]</td><td>46</td><td>The IP address is defined as null terminated string ( = char array ending with value 0) <br />Supports IPv4 and IPv6</td></tr>
<tr><td>Machine ID</td><td>Uint</td><td>2</td><td>Machine ID of the AGV</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3144---send-schwarzmueller-tpdo-response"><a class="header" href="#3144---send-schwarzmueller-tpdo-response">3144 - Send Schwarzmueller TPDO response</a></h4>
<p>Navitrol will send this message as a response to request for Schwarzmueller TPDO 3044.</p>
<p>More detailed data field descriptions can be obtained from the Schwarzmueller document &quot;Standard-CANopen&quot;.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3144</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length =  28 + N * 23</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)  N = &quot;Number of Schwarzmueller motor controllers&quot;</td></tr>
<tr><td>Number of Schwarzmueller Motor controllers</td><td>Int</td><td>4</td><td>Number of Schwarzmueller Motor controllers connected to Navitrol</td></tr>
<tr><td>Schwarzmueller data</td><td>Schwarzmueller Data type[N]</td><td>N * 36</td><td>Schwarzmueller data structs according to <strong>Number of Motor controllers</strong> in the AGV</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Schwarzmueller data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Node ID</td><td>Uint</td><td>2</td><td>Node ID of the motor controller</td></tr>
<tr><td>TPDO1</td><td>TPDO1 type</td><td>10</td><td></td></tr>
<tr><td>TPDO2</td><td>TPDO2 type</td><td>10</td><td></td></tr>
<tr><td>TPDO3</td><td>TPDO3 type</td><td>6</td><td></td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>TPDO1 struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Status Byte</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Motor Load</td><td>Int</td><td>2</td><td>Scale: 1%</td></tr>
<tr><td>Actual speed</td><td>Int</td><td>2</td><td>Scale: 1 rpm</td></tr>
<tr><td>Actual torque</td><td>Int</td><td>2</td><td>Scale: 0.01 Nm</td></tr>
<tr><td>Encoder value</td><td>Int</td><td>2</td><td>Scale: 1 pulse</td></tr>
</tbody></table>
<table><thead><tr><th><strong>TPDO2 struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Fault/warning code</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>BDI Level</td><td>Uint</td><td>2</td><td>Scale: 1-10</td></tr>
<tr><td>Inverter Temperature</td><td>Int</td><td>2</td><td>Scale: 1o C</td></tr>
<tr><td>Motor temperature</td><td>Int</td><td>2</td><td>Scale: 1o C</td></tr>
<tr><td>Battery voltage</td><td>Uint</td><td>2</td><td>Scale: 0.01 V</td></tr>
</tbody></table>
<table><thead><tr><th><strong>TPDO3 struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Motor phase current</td><td>Uint</td><td>2</td><td>Scale: 0.1 A</td></tr>
<tr><td>Motor line voltage</td><td>Uint</td><td>2</td><td>Scale: 0.01 V</td></tr>
<tr><td>Battery current</td><td>Int</td><td>2</td><td>Scale: 0.1 A</td></tr>
</tbody></table>
<hr />
<h4 id="3146---omni-steering-angle-response"><a class="header" href="#3146---omni-steering-angle-response">3146 - Omni steering angle response</a></h4>
<p>Navitrol will send this message as a response to Message ID 3046.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.34.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 3146</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length =  28 + N * 8</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)  <br />N = &quot;Number of omni steering wheel&quot;</td></tr>
<tr><td>Number of Omni steering wheels</td><td>Int32</td><td>4</td><td>Number of omni wheels set in parameters</td></tr>
<tr><td>Measured steering wheel array</td><td>Float[]</td><td>N * 4</td><td>Measured steering angle of an omni wheel. </br> Array indexing matches omni steering wheel parameter indexing </br> Units - radians</td></tr>
<tr><td>Reference steering  angle array</td><td>Float[]</td><td>N * 4</td><td>Reference steering angle of an omni wheel. </br> Array indexing matches omni steering wheel parameter indexing </br> Units - radians</td></tr>
<tr><td>Reserved</td><td>NA</td><td>16</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3150--symbolic-points-on-agv-path"><a class="header" href="#3150--symbolic-points-on-agv-path">3150 – Symbolic points on AGV path</a></h4>
<p>Navitrol will send this message as a response to Message ID 3050 – Request for symbolic points on AGV path. This message can be used to get list of symbolic points coming ahead that the AGV will be passing through before reaching its destination. Symbolic points on path are only available for drive orders using predefined segments i.e. driving with custom routes etc. will not have symbolic points on trajectory.</p>
<p>The symbolic point list is of points coming ahead on the path in the order they appear. Maximum number of symbolic points reported in this list is limited to 10. Symbolic points that have been visited during drive get removed from the list.</p>
<p>Note that the symbolic point list is from path that has already been commanded to the AGV. For very long drive orders, this path may not lead all the way to destination and therefore, the list will keep updating as new path is commanded to AGV with drive extensions.</p>
<p>If this message is requested after the drive has ended, last available information will be sent by Navitrol.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.38.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3150</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>22 + (N * 12) <br />N = “Number of symbolic points on path”</td></tr>
<tr><td>Last visited symbolic point ID</td><td>Uint</td><td>4</td><td>ID of symbolic point on trajectory that was most recently visited by the AGV. 0 = None<br />Parameters symbol_point_enter_dist is used for last visited symbolic point distance limit.</td></tr>
<tr><td>Destination symbolic point ID</td><td>Uint</td><td>4</td><td>ID of destination symbolic point of the AGV. 0 = None<br />Destination symbolic point is the final symbolic point AGV is driving to.</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
<tr><td>Number of symbolic points on path - N</td><td>Uint</td><td>2</td><td>Number of symbolic points coming ahead on AGV path</td></tr>
<tr><td>Symbolic Point Data</td><td>Symbolic point data[]</td><td>N * 12</td><td>List of symbolic points<br />Symbolic points that AGV has already passed are not reported</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Symbolic point data struct</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Symbolic point ID</td><td>Uint</td><td>4</td><td>ID of symbolic point</td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3151--pivot-to-target-heading-response"><a class="header" href="#3151--pivot-to-target-heading-response">3151 – Pivot to target heading response</a></h4>
<p>Navigation SW sends this message to the AGV supervisor as a response to the Pivot to target heading message (Message ID 3051). A reply from success will come when the AGV has reached the target heading. If the pivoting cannot be started or it is interrupted before the target is reached, reply with reject reason will be sent.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.42.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3151</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>16</td></tr>
<tr><td>Pivot to target heading result</td><td>Uint</td><td>4</td><td>0 = Successfully pivoted to the target heading<br />1 = Bad input<br />2 = Wrong state<br />4 = Control disabled<br />8 = Drive rejected<br />9 = Error(s) active</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3152--active-custom-speed-array-parameter-index"><a class="header" href="#3152--active-custom-speed-array-parameter-index">3152 – Active custom speed array parameter index</a></h4>
<p>Navitrol will send this message as a response to Message ID 3052.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>NA</td><td>6.42.00</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3152</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>14</td></tr>
<tr><td>Speed array index</td><td>Int</td><td>2</td><td>The index of currently active custom speed array index. Values [0…10]<br />-1 = Default non array speed parameters are in use. (None of the custom speed arrays are active)</td></tr>
<tr><td>Reserved</td><td>NA</td><td>4</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h4 id="3153--pivot-to-target-heading-started-response"><a class="header" href="#3153--pivot-to-target-heading-started-response">3153 – Pivot to target heading started response</a></h4>
<p>Navitrol sends this message as an immediate reply to the &quot;Pivot To Target Heading&quot;-message (3051) to indicate that the request was received.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.42.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3153</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>8</td></tr>
</tbody></table>
<hr />
<h4 id="3154--object-model-information-response"><a class="header" href="#3154--object-model-information-response">3154 – Object model information response</a></h4>
<p>Navitrol replies to the &quot;Object model information&quot;-message (3054) after <strong>target_detection_maximum_iterations</strong> target detection iterations. The returned pose is the average pose of the N successful detections, which is a subset of the maximum iterations. </p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.44.00</td><td>Message added</td></tr>
<tr><td>6.56.00</td><td>Vehicle coordinate support</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3154</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>32 + Nl * 2</td></tr>
<tr><td>Object model id</td><td>Uint</td><td>2</td><td>The searched model id</td></tr>
<tr><td>Object detected</td><td>Uint</td><td>2</td><td>0 - not detected, 1 - detected</td></tr>
<tr><td>Object centre position X</td><td>Float</td><td>4</td><td>The X – position of the object in coordinates of the request message 3054</td></tr>
<tr><td>Object centre position Y</td><td>Float</td><td>4</td><td>The Y – position of the object in coordinates of the request message 3054</td></tr>
<tr><td>Object heading H</td><td>Float</td><td>4</td><td>The heading (degrees) of the object in coordinates of the request message 3054</td></tr>
<tr><td>Reserved</td><td>Uint</td><td>4</td><td>Reserved for future use</td></tr>
<tr><td>Error reason</td><td>Uint</td><td>2</td><td>0 - No error<br /> 1 - Object not in view<br /> 2 - Leg positions not matching model<br /> 3 - Object not within position tolerance<br /> 4 - Object model invalid</td></tr>
<tr><td>Number of wheels</td><td>Uint</td><td>2</td><td>The number of wheel box position in variable data</td></tr>
<tr><td>Wheel direction</td><td>Array of wheels</td><td>Number of wheels * 2</td><td></td></tr>
<tr><td>Wheel direction</td><td>Uint</td><td>2</td><td>0 - wheel not aligned with cart<br /> 1 - wheel aligned with cart</td></tr>
</tbody></table>
<hr />
<h4 id="3155---cleaning-actuator-response"><a class="header" href="#3155---cleaning-actuator-response">3155 - Cleaning actuator response</a></h4>
<p>Navitrol will send this message as a reply to the &quot;3055 - Cleaning actuator command&quot; message.  With this message, Navitrol confirms that command for cleaning actuators has successfully recieved.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.44.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3155</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>20</td></tr>
<tr><td>Command result</td><td>Uint</td><td>4</td><td>0 - Accepted <br /> 1 - Bad input <br /> 4 - Control disabled</td></tr>
<tr><td>Reserved</td><td>NA</td><td>8</td><td>Reserved for future development</td></tr>
</tbody></table>
<hr />
<h4 id="3156---error-situation-response"><a class="header" href="#3156---error-situation-response">3156 - Error situation response</a></h4>
<p>Navitrol will send this message periodically, with a three second interval, when there is an error situation. 3056 message is used to define an action how this error situation should be solved. If there is no error situation, 3156 message is not sent. This supervisor message is used for error recovery handling. More detailed information and examples can be found from the description of the 3056 message.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.46.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3156</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Error situation id</td><td>Int</td><td>4</td><td>Id of the active error situation. See message 3056 for more information.</td></tr>
</tbody></table>
<hr />
<h4 id="3157---route-free-navigation-response"><a class="header" href="#3157---route-free-navigation-response">3157 - Route-free navigation response</a></h4>
<p>&quot;Success&quot; is reported when a path is ready to drive (has been planed). Otherwise failure is reported when the planning fails. 
Operation result &quot;planner busy&quot; means that route-free navigation feature is active planning a path and can not process new request at this time.
Other specific error codes may be added later.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.51.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>3157</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>12</td></tr>
<tr><td>Operation result</td><td>Uint</td><td>4</td><td>0 - Success, otherwise failure: 1 - generic falure,  2 - planner busy</td></tr>
</tbody></table>
<hr />
<h4 id="4101---target-detection-update-v1"><a class="header" href="#4101---target-detection-update-v1">4101 - Target detection update v1</a></h4>
<p>Navitrol sends this message periodically every time the target detection calculation is finished. Requires that parameter agv_supervisor_enabled = 1 and pallet detection parameters are correctly configured.</p>
<p>I,target_detection_supervisor_update_message_interval_ms -parameter. (Default 200ms) can be used to determine the minimum interval of the update message. With value 0 the message is sent every time the target detection calculation finishes a cycle.</p>
<p>Parameter requirements:</p>
<p>I,target_detection_supervisor_update_message_enabled = 1 (this is the default value so if the parameter is not defined in the file this is automatically used)</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.24.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 4101</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in map coordinates</td></tr>
<tr><td>Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in map coordinates</td></tr>
<tr><td>Target Angle</td><td>Float</td><td>4</td><td>Target Angle in radians in map coordinates</td></tr>
<tr><td>Target found</td><td>Uint</td><td>1</td><td>Target found 1, not found 0</td></tr>
<tr><td>Scan coms</td><td>Uint</td><td>1</td><td>Scanner communication status: <br />1 OK <br />0 Not OK</td></tr>
</tbody></table>
<hr />
<h4 id="4104---pattern-detection-v2-status-update"><a class="header" href="#4104---pattern-detection-v2-status-update">4104 - Pattern detection v2 status update</a></h4>
<p>A target detection status update message specifically for Pattern detection v2 status target detection type. If enabled, Navitrol sends this update periodically.</p>
<p><strong>Parameter requirements:</strong>
I,refl_det_version, 2
I,target_detection_type_selection, 1
I,target_detection_always_enabled, 1</p>
<p><strong>Note:</strong> refl_det_version and target_detection_type_selection settings can alternatively be set using message &quot;3032 - Set target detection mode&quot;.</p>
<p>The status update will be sent at the interval defined by I,target_detection_supervisor_update_message_interval_ms -parameter. (Default 200ms)</p>
<p><strong>Feature overview:</strong></p>
<p>Positioning result from one or two scanners. Reflectors must be in a pattern where all reflector distances differ from each other. All reflectors are of equal size and mounted into a line.</p>
<p>The combined data is empty if only one scanner is used. When two scanners are used, the common data contains a combination of both scanners' results always, when the separate results match with a certain accuracy.</p>
<p>There is an automatic offset calibration between the scanners, which is removing small scanner position parameter errors. It is active when both scanners see the whole reflector pattern. When the offset has tuned in, so that both scanners give the same result the common data is filled. When either scanner is not detecting the entire reflector pattern the offsets are frozen and only used for result correction.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 4104</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length = 52</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields</td></tr>
<tr><td>Scanner1 Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in map coordinates</td></tr>
<tr><td>Scanner1 Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in map coordinates</td></tr>
<tr><td>Scanner1 Target Angle</td><td>Float</td><td>4</td><td>Target Angle in radians in map coordinates</td></tr>
<tr><td>Scanner1 Target found</td><td>Byte</td><td>1</td><td>0 - Target not found, <br />N[3...8] reflectors detected</td></tr>
<tr><td>Scanner1 Fitness</td><td>Uint</td><td>1</td><td>0...100 %  <br />0 - target not found <br />100 - all reflectors detected, ideal match</td></tr>
<tr><td>Scanner1 coms</td><td>Uint</td><td>1</td><td>Scanner communication status: <br />1 OK <br />0 Not OK</td></tr>
<tr><td>Scanner2 Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in map coordinates</td></tr>
<tr><td>Scanner2 Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in map coordinates</td></tr>
<tr><td>Scanner2 Target Angle</td><td>Float</td><td>4</td><td>Target Angle in radians in map coordinates</td></tr>
<tr><td>Scanner2 Target found</td><td>Byte</td><td>1</td><td>0 - Target not found, N[3...8] reflectors detected</td></tr>
<tr><td>Scanner2 Fitness</td><td>Uint</td><td>1</td><td>0...100 %  0 - target not found 100 - all reflectors detected, ideal match</td></tr>
<tr><td>Scanner2 coms</td><td>Uint</td><td>1</td><td><br />Scanner communication status: <br />1 OK <br />0 Not OK</td></tr>
<tr><td>Combined Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in map coordinates</td></tr>
<tr><td>Combined Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in map coordinates</td></tr>
<tr><td>Combined Target Angle</td><td>Float</td><td>4</td><td>Target Angle in radians in map coordinates</td></tr>
<tr><td>Combined Fitness</td><td>Uint</td><td>1</td><td>0...100 %  <br />0 - combination not found <br />100 - all reflectors detected, ideal match</td></tr>
<tr><td>Combined possible</td><td>Uint</td><td>1</td><td>Communication with both scanners, combination matching <br />0 Not OK N <br />[3...8] reflectors detected</td></tr>
</tbody></table>
<hr />
<h4 id="4105---target-detection-status-update-v2"><a class="header" href="#4105---target-detection-status-update-v2">4105 - Target detection status update v2</a></h4>
<p>Navitrol sends this update periodically if target detection parameters are enabled. The status update will be sent at the interval defined by I,target_detection_supervisor_update_message_interval_ms -parameter. (Default 200ms)</p>
<p>Parameter requirements:
I,target_detection_supervisor_update_message_enabled = 2
I,target_detection_type_selection &gt; 0
I,target_detection_type_selection != 2 # (pallet detection v1 not supported)</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.28.00</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 4105</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including all data fields (including Protocol version and Message ID)</td></tr>
<tr><td>Detection mode</td><td>Uint</td><td>1</td><td>Active target detection mode <br />0 = Target detection disabled <br />1 = Reflector docking active <br />2 = Pallet detection active <br />3 = Pattern detection active 100 = Target detection mode unidentified. (Can come up if pallet detection version 1 is enabled)</td></tr>
<tr><td>Target found</td><td>Uint</td><td>1</td><td><strong>0 = Searching for target</strong> <br /><strong>1 = Target found</strong> <br />Target has been continuously detected amount of times defined by parameter target_min_n_times_detected  <br />Target won't be lost even if it is no longer detected amount of times defined by parameter target_max_n_times_missing.</td></tr>
<tr><td>Target reached</td><td>Uint</td><td>1</td><td><strong>0 = Target not reached</strong> <br />Target is either not found or not reached <br /><strong>1 = Target reached</strong> <br />Distance to the target is less than defined by parameter pc_max_end_dist  <br /><br />Note: Distance to the target is AGV's remaining drive distance following the active drive trajectory <br />Value will be updated only when docking has started</td></tr>
<tr><td>Target within safety distance</td><td>Uint</td><td>1</td><td>Distance to target is less than defined by parameter docking_notify_approach_dist <br />Note: Distance to the target is AGV's remaining drive distance following the active drive trajectory <br />Value will be updated only when docking has started</td></tr>
<tr><td>Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in map coordinates <br />Target position defined by X and Y coordinates is the middle point of the detected target's front side.</td></tr>
<tr><td>Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in map coordinates <br />Target position defined by X and Y coordinates is the middle point of the detected target's front side.</td></tr>
<tr><td>Target Angle</td><td>Float</td><td>4</td><td>The angle of detected target in radians in map coordinates. (radians)</td></tr>
<tr><td>Pallet ID(s) being detected</td><td>Bitfield</td><td>4</td><td><strong>Relevant only with pallet detection</strong> <br />Returns the model IDs of the expected targets. (Copied from message 3032 field &quot;Search target ID&quot;)</td></tr>
<tr><td>Number of reflectors being detected</td><td>Uint</td><td>2</td><td><strong>Relevant only with reflector docking</strong> <br />Possible values: <br />0 = Not set <br />2 = Two reflectors <br />4 = Four reflectors</td></tr>
<tr><td>Found pallet's ID</td><td>Uint</td><td>2</td><td><strong>Relevant only with pallet detection</strong> <br />Returns the model ID/index of a target found at target symbolic point. <br />404 = No targets found</td></tr>
<tr><td>Reserved</td><td>NA</td><td>20</td><td>Not in use</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Pallet ID(s) being detected bits</strong></th><th><strong>Bit</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Defined targets</td><td>0-4</td><td>Will match the targets defined in the params.txt <br />0 = Disabled, 1 = Enabled</td></tr>
<tr><td>Reserved</td><td>5-31</td><td>Not in use</td></tr>
</tbody></table>
<hr />
<h2 id="positioning-only-messages"><a class="header" href="#positioning-only-messages">Positioning only messages</a></h2>
<p>These messages are specific for positioning only systems. In such systems Navitrol provides only position without controlling giving control references to an AGV.</p>
<h3 id="from-supervisor-to-navitrol-2"><a class="header" href="#from-supervisor-to-navitrol-2">From Supervisor to Navitrol</a></h3>
<h4 id="1014---get-position-correction---cumulative"><a class="header" href="#1014---get-position-correction---cumulative">1014 - Get position correction - cumulative</a></h4>
<p>This message is one of the two alternatives that the Supervisor shall send periodically in order to receive position correction from Navitrol. The Get position correction message shall be sent periodically by the AGV at all times, even while doing position initialization. Navitrol replies with the Position correction message (Message ID 1114).</p>
<p>See: &quot;Position correction&quot; and &quot;Positioning only system&quot; chapters</p>
<p><strong>NOTE:</strong> Starting from Navitrol versions 6.32.02, response message is ID 1114 if parameter <strong>report_pp_status</strong> == 0. If <strong>report_pp_status</strong> == 1, then response message is ID 1115 instead.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1014</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including ID and length fields</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for position correction messages. This value shall be incremented by one for each message sent and it should match with received reply message number.</td></tr>
<tr><td>X</td><td>Float</td><td>4</td><td>Current absolute X-coordinate in meters</td></tr>
<tr><td>Y</td><td>Float</td><td>4</td><td>Current absolute Y-coordinate in meters</td></tr>
<tr><td>H</td><td>Float</td><td>4</td><td>Current absolute heading in radians</td></tr>
<tr><td>Floor</td><td>Uint</td><td>4</td><td>Current floor</td></tr>
<tr><td>Cum_s_long</td><td>Uint</td><td>4</td><td>Cumulative raw odometer distance travelled in machine coordinate frame in direction of the AGV heading (in 0.1 millimeters)</td></tr>
<tr><td>Cum_s_trans</td><td>Uint</td><td>4</td><td>Cumulative raw odometer distance travelled in machine coordinate frame in direction transversal of the AGV heading (in 0.1 millimeters)</td></tr>
<tr><td>Raw_h</td><td>Float</td><td>4</td><td>Raw dead-reckoning heading of the AGV in radians</td></tr>
<tr><td>Timestamp</td><td>Uint</td><td>4</td><td>Cumulative time in ms; time base can be chosen freely</td></tr>
</tbody></table>
<hr />
<h4 id="1015---get-position-correction---velocity"><a class="header" href="#1015---get-position-correction---velocity">1015 - Get position correction - velocity</a></h4>
<p>This message is one of the two alternatives that the Supervisor shall send periodically in order to receive position correction from Navitrol. The Get position correction message shall be sent periodically by the AGV at all times, even while doing position initialization. Navitrol replies with the Position correction message (Message ID 1114).</p>
<p>See: &quot;Position correction&quot; and &quot;Positioning only system&quot; chapters</p>
<p><strong>NOTE:</strong> Starting from Navitrol versions 6.32.02, response message is ID 1114 if parameter report_pp_status == 0. If report_pp_status == 1, then response message is ID 1115 instead.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1015</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including ID and length fields</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for position correction messages. This value shall be incremented by one for each message sent and it should match with received reply message number.</td></tr>
<tr><td>X</td><td>Float</td><td>4</td><td>Current absolute X-coordinate in meters</td></tr>
<tr><td>Y</td><td>Float</td><td>4</td><td>Current absolute Y-coordinate in meters</td></tr>
<tr><td>H</td><td>Float</td><td>4</td><td>Current absolute heading in radians</td></tr>
<tr><td>Floor</td><td>Uint</td><td>4</td><td>Current floor</td></tr>
<tr><td>Vel_long</td><td>Float</td><td>4</td><td>Raw dead reckoning velocity in machine coordinate frame in direction of the AGV heading (in meters/second)</td></tr>
<tr><td>Vel_trans</td><td>Float</td><td>4</td><td>Raw dead reckoning velocity in machine coordinate frame in direction transversal of the AGV heading (in meters/second)</td></tr>
<tr><td>Vel_angular</td><td>Float</td><td>4</td><td>Raw dead reckoning angular velocity in machine coordinate frame (in radians/second), positive velocity in counterclockwise direction</td></tr>
<tr><td>Timestamp</td><td>Uint</td><td>4</td><td>Cumulative time in ms; time base can be chosen freely</td></tr>
</tbody></table>
<hr />
<h3 id="from-navitrol-to-supervisor-2"><a class="header" href="#from-navitrol-to-supervisor-2">From Navitrol to Supervisor</a></h3>
<h4 id="1114---position-correction"><a class="header" href="#1114---position-correction">1114 - Position correction</a></h4>
<p>The Position correction message is sent as a reply to the message Get position correction - cumulative / velocity (Message ID 1014 and 1015). The Position correction status tells if Navitrol is able to locate itself in the new coordinates. The Position correction is not calculated while teaching (status=teach active).</p>
<p>Note that the corrected position is the position of the AGV at the time when the corresponding &quot;Get position correction&quot; message with identical message number was sent.</p>
<p><strong>NOTE:</strong> Starting from Navitrol versions 6.32.02, response message is ID 1114 if parameter report_pp_status == 0. If report_pp_status == 1, then response message is ID 1115 instead.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1114</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including ID and length fields</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages. <br />Note: This value must match with the latest Get position correction message number sent by the Supervisor.</td></tr>
<tr><td>X</td><td>Float</td><td>4</td><td>Corrected X-position in map coordinate frame in meters</td></tr>
<tr><td>Y</td><td>Float</td><td>4</td><td>Corrected Y-position in map coordinate frame in meters</td></tr>
<tr><td>H</td><td>Float</td><td>4</td><td>Corrected absolute heading in radians.</td></tr>
<tr><td>Floor</td><td>Uint</td><td>4</td><td>Floor for corrected position</td></tr>
<tr><td>Position correction status</td><td>Uint</td><td>2</td><td>0 = Failed <br />1 = Succeeded <br />2 = teach active (no correction)</td></tr>
<tr><td>Position confidence</td><td>Uint</td><td>2</td><td>Position confidence in percentage (0 -100%)</td></tr>
</tbody></table>
<hr />
<h4 id="1115---position-correction-with-precision-positioning-status"><a class="header" href="#1115---position-correction-with-precision-positioning-status">1115 - Position correction with precision positioning status</a></h4>
<p>This Position correction message is sent as a reply to the message Get position correction - cumulative / velocity (Message ID 1014 and 1015) if parameter report_pp_status == 1. The Position correction status tells if Navitrol is able to locate itself in the new coordinates. The Position correction is not calculated while teaching (status=teach active).</p>
<p>Note that the corrected position is the position of the AGV at the time when the corresponding &quot;Get position correction&quot; message with identical message number was sent.</p>
<table><thead><tr><th><strong>Navitrol version</strong></th><th><strong>Changes</strong></th></tr></thead><tbody>
<tr><td>6.32.02</td><td>Message added</td></tr>
</tbody></table>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID = 1115</td><td>Uint</td><td>2</td><td></td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>Message length in bytes including ID and length fields</td></tr>
<tr><td>Message number</td><td>Uint</td><td>4</td><td>Identification number for individual messages. <br />Note: This value must match with the latest Get position correction message number sent by the Supervisor.</td></tr>
<tr><td>X</td><td>Float</td><td>4</td><td>Corrected X-position in map coordinate frame in meters</td></tr>
<tr><td>Y</td><td>Float</td><td>4</td><td>Corrected Y-position in map coordinate frame in meters</td></tr>
<tr><td>H</td><td>Float</td><td>4</td><td>Corrected absolute heading in radians.</td></tr>
<tr><td>Floor</td><td>Uint</td><td>4</td><td>Floor for corrected position</td></tr>
<tr><td>Position correction status</td><td>Uint</td><td>2</td><td>0 = Failed <br />1 = Succeeded <br />2= teach active (no correction)</td></tr>
<tr><td>Position confidence</td><td>Uint</td><td>2</td><td>Position confidence in percentage (0 -100%)</td></tr>
<tr><td>Precision positioning status</td><td>Uint</td><td>2</td><td>0 = precision positioning not active <br />1 = precision positioning active</td></tr>
</tbody></table>
<hr />
<h2 id="appendix-a-status-message-examples"><a class="header" href="#appendix-a-status-message-examples">Appendix A. Status message examples</a></h2>
<p>This appendix shows three examples of status message pairs. All values are in little-endian (LSB first). This is the default behaviour by Navitrol, but can be changed using Navitrol parameter agv_comms_swapbytes.
I,agv_comms_swapbytes, 0 // 0 - little endian, 1 big-endian</p>
<p>Data below is copied straight from our log files and therefore contains some extra data in each line. The last two values however on each line are</p>
<ul>
<li>index of the byte in message (starting from 0)</li>
<li>byte value in HEX</li>
</ul>
<p>These examples show the data byte by byte written to (read from) TCP/IP socket. Status messages shown in these examples always contain basic/default data section + optionally extra section(s). Supervisor can send extra sections on need basis, while Navitrol responds with those extra sections that are requested by Supervisor, as explained in communication specification document.</p>
<ul>
<li>Example 1 - Supervisor status - no extra sections sent - no extra sections requested from Navitrol</li>
<li>Example 2 - Supervisor status - no extra sections sent - 1 extra sections (section_id 1) requested from Navitrol</li>
<li>Example 3 - Supervisor status - 1 extra sections sent - 4 extra sections (section_id's 1, 2, 5, 7) requested from Navitrol</li>
</ul>
<p>Red/black colours are used to differentiate each item/variable in the message.</p>
<p><strong>EXAMPLE1</strong></p>
<p><strong>Supervisor/AGV to Navitrol</strong></p>
<p>8.9124 [09:6] Supervisor status 14 bytes<br />
8.9124 [09:6] 00 : 03<br />
8.9124 [09:6] 01 : 00 Protocol version 3<br />
8.9124 [09:6] 02 : BA<br />
8.9124 [09:6] 03 : 0B Msg ID = 3002 (x0BBA)<br />
8.9124 [09:6] 04 : 0E<br />
8.9124 [09:6] 05 : 00<br />
8.9124 [09:6] 06 : 00<br />
8.9124 [09:6] 07 : 00 Length 14 (x0000000E)<br />
8.9124 [09:6] 08 : 01<br />
8.9124 [09:6] 09 : 00 Status 1 (x0001)<br />
8.9124 [09:6] 10 : 00<br />
8.9124 [09:6] 11 : 00 ESTOP<br />
8.9124 [09:6] 12 : 00<br />
8.9125 [09:6] 13 : 00 Number of sections requested</p>
<p><strong>Navitrol response to Supervisor/AGV</strong></p>
<p>4.1209 [09:6] navitrol status out 42 bytes: some artificial data values - no sections<br />
4.1209 [09:6] 00 : 03<br />
4.1209 [09:6] 01 : 00 Protocol version 3<br />
4.1209 [09:6] 02 : 1E<br />
4.1209 [09:6] 03 : 0C Msg ID = 3102 (x0C1E)<br />
4.1209 [09:6] 04 : 2A<br />
4.1209 [09:6] 05 : 00<br />
4.1209 [09:6] 06 : 00<br />
4.1209 [09:6] 07 : 00 Length all 42 (x0000002A)<br />
4.1209 [09:6] 08 : 2A<br />
4.1209 [09:6] 09 : 00<br />
4.1209 [09:6] 10 : 00<br />
4.1209 [09:6] 11 : 00 Length default section 42 (x0000002A)<br />
4.1209 [09:6] 12 : 02<br />
4.1209 [09:6] 13 : 00<br />
4.1209 [09:6] 14 : 00<br />
4.1209 [09:6] 15 : 00 State 2 (x00000002)<br />
4.1209 [09:6] 16 : 00<br />
4.1209 [09:6] 17 : 00<br />
4.1209 [09:6] 18 : 00<br />
4.1209 [09:6] 19 : 40 X 2.0f (x40000000)<br />
4.1209 [09:6] 20 : 00<br />
4.1209 [09:6] 21 : 00<br />
4.1209 [09:6] 22 : 00<br />
4.1209 [09:6] 23 : 00 Y<br />
4.1209 [09:6] 24 : 00<br />
4.1209 [09:6] 25 : 00<br />
4.1209 [09:6] 26 : 00<br />
4.1209 [09:6] 27 : 3F Head 0.5f (x3F000000)<br />
4.1209 [09:6] 28 : 03<br />
4.1209 [09:6] 29 : 00<br />
4.1210 [09:6] 30 : 00<br />
4.1210 [09:6] 31 : 00 Level 3 (0x00000003)<br />
4.1210 [09:6] 32 : 00<br />
4.1210 [09:6] 33 : 00<br />
4.1210 [09:6] 34 : 00<br />
4.1210 [09:6] 35 : 00 Speed<br />
4.1210 [09:6] 36 : 00<br />
4.1210 [09:6] 37 : 00 PosIniStatus<br />
4.1210 [09:6] 38 : 4D<br />
4.1210 [09:6] 39 : 00 PosConf 77 (0x004D)<br />
4.1210 [09:6] 40 : 01<br />
4.1210 [09:6] 41 : 00 Error 1 (x0001)</p>
<p><strong>EXAMPLE2</strong></p>
<p><strong>Supervisor/AGV to Navitrol</strong></p>
<p>Supervisor status - no sections sent - 1 sections (section_id 1) requested</p>
<p>5.3510 [09:6] Supervisor status 16 bytes<br />
5.3510 [09:6] 00 : 03<br />
5.3510 [09:6] 01 : 00 Protocol version 3<br />
5.3510 [09:6] 02 : BA<br />
5.3510 [09:6] 03 : 0B Msg ID = 3002 (x0BBA)<br />
5.3510 [09:6] 04 : 10<br />
5.3510 [09:6] 05 : 00<br />
5.3510 [09:6] 06 : 00<br />
5.3510 [09:6] 07 : 00 Length 16 (x00000010)<br />
5.3510 [09:6] 08 : 01<br />
5.3510 [09:6] 09 : 00 Status 1 (x0001)<br />
5.3510 [09:6] 10 : 00<br />
5.3510 [09:6] 11 : 00 ESTOP<br />
5.3510 [09:6] 12 : 01<br />
5.3510 [09:6] 13 : 00 Number of sections requested<br />
5.3510 [09:6] 14 : 01<br />
5.3510 [09:6] 15 : 00 List of section ID's requested (single section ID == 1)</p>
<p><strong>Navitrol response to Supervisor/AGV</strong></p>
<p>5.3511 [09:6] navitrol status out 54 bytes: some artificial data values - 1 sections (section ID 1)<br />
5.3511 [09:6] 00 : 03<br />
5.3511 [09:6] 01 : 00 Protocol version 3<br />
5.3511 [09:6] 02 : 1E<br />
5.3511 [09:6] 03 : 0C Msg ID = 3102 (x0C1E)<br />
5.3511 [09:6] 04 : 36<br />
5.3511 [09:6] 05 : 00<br />
5.3511 [09:6] 06 : 00<br />
5.3511 [09:6] 07 : 00 Lenght all 54 (x00000036)<br />
5.3511 [09:6] 08 : 2A<br />
5.3511 [09:6] 09 : 00<br />
5.3511 [09:6] 10 : 00<br />
5.3511 [09:6] 11 : 00 Length default section 42 (x0000002A)<br />
5.3511 [09:6] 12 : 02<br />
5.3511 [09:6] 13 : 00<br />
5.3511 [09:6] 14 : 00<br />
5.3511 [09:6] 15 : 00 State 2 (x00000002)<br />
5.3511 [09:6] 16 : 00<br />
5.3511 [09:6] 17 : 00<br />
5.3511 [09:6] 18 : 00<br />
5.3511 [09:6] 19 : 40 X 2.0f (x40000000)<br />
5.3512 [09:6] 20 : 00<br />
5.3512 [09:6] 21 : 00<br />
5.3512 [09:6] 22 : 00<br />
5.3512 [09:6] 23 : 00 Y<br />
5.3512 [09:6] 24 : 00<br />
5.3512 [09:6] 25 : 00<br />
5.3512 [09:6] 26 : 00<br />
5.3512 [09:6] 27 : 3F Head 0.5f (x3F000000)<br />
5.3512 [09:6] 28 : 03<br />
5.3512 [09:6] 29 : 00<br />
5.3512 [09:6] 30 : 00<br />
5.3512 [09:6] 31 : 00 Level 3 (0x00000003)<br />
5.3512 [09:6] 32 : 00<br />
5.3512 [09:6] 33 : 00<br />
5.3512 [09:6] 34 : 00<br />
5.3512 [09:6] 35 : 00 Speed<br />
5.3512 [09:6] 36 : 00<br />
5.3512 [09:6] 37 : 00 PosIniStatus<br />
5.3512 [09:6] 38 : 4D<br />
5.3512 [09:6] 39 : 00 PosConf 77 (0x004D)<br />
5.3512 [09:6] 40 : 01<br />
5.3512 [09:6] 41 : 00 Error 1 (x0001)<br />
5.3512 [09:6] 42 : 01<br />
5.3512 [09:6] 43 : 00 Section ID 1 (0x0001)<br />
5.3512 [09:6] 44 : 0C<br />
5.3512 [09:6] 45 : 00<br />
5.3512 [09:6] 46 : 00<br />
5.3512 [09:6] 47 : 00 Section len 12 (0x00000C)<br />
5.3512 [09:6] 48 : 00<br />
5.3512 [09:6] 49 : 00<br />
5.3512 [09:6] 50 : 00<br />
5.3512 [09:6] 51 : 00 Battery voltage<br />
5.3512 [09:6] 52 : 00<br />
5.3512 [09:6] 53 : 00 OnRoute</p>
<p><strong>Example3</strong></p>
<p><strong>Supervisor/AGV to Navitrol</strong></p>
<p>Supervisor status - 1 extra sections sent - 4 sections (section_ID's 1, 2, 5, 7) requested</p>
<p>5.3510 [09:6] Supervisor status 36 bytes<br />
3.3532 [09:6] 00 : 03<br />
3.3532 [09:6] 01 : 00 Protocol version 3<br />
3.3532 [09:6] 02 : BA<br />
3.3532 [09:6] 03 : 0B Msg ID = 3002 (x0BBA)<br />
3.3532 [09:6] 04 : 24<br />
3.3532 [09:6] 05 : 00<br />
3.3532 [09:6] 06 : 00<br />
3.3532 [09:6] 07 : 00 Length 36 (x00000024)<br />
3.3532 [09:6] 08 : 01<br />
3.3532 [09:6] 09 : 00 Status 1 (x0001)<br />
3.3532 [09:6] 10 : 00<br />
3.3532 [09:6] 11 : 00 ESTOP<br />
3.3532 [09:6] 12 : 04<br />
3.3532 [09:6] 13 : 00 Number of sections requested 4<br />
3.3532 [09:6] 14 : 01<br />
3.3532 [09:6] 15 : 00 section ID's requested (section ID == 1)<br />
3.3532 [09:6] 16 : 02<br />
3.3532 [09:6] 17 : 00 section ID's requested (section ID == 2)<br />
3.3532 [09:6] 18 : 05<br />
3.3532 [09:6] 19 : 00 section ID's requested (section ID == 5)<br />
3.3532 [09:6] 20 : 07<br />
3.3532 [09:6] 21 : 00 section ID's requested (section ID == 7)<br />
3.3532 [09:6] 22 : 01<br />
3.3532 [09:6] 23 : 00 section ID sent (Actuator section ID == 1)<br />
3.3532 [09:6] 24 : 0E<br />
3.3532 [09:6] 25 : 00<br />
3.3532 [09:6] 26 : 00<br />
3.3532 [09:6] 27 : 00 section length 14 (x0000000E)<br />
3.3532 [09:6] 28 : 00<br />
3.3532 [09:6] 29 : 00<br />
3.3532 [09:6] 30 : 00<br />
3.3532 [09:6] 31 : 00 Actuator value 0<br />
3.3532 [09:6] 32 : 02 Binary inputs 1<br />
3.3532 [09:6] 33 : 00 Binary inputs 2<br />
3.3532 [09:6] 34 : 00 Binary inputs 3<br />
3.3532 [09:6] 35 : 00 Binary inputs 4</p>
<p><strong>Navitrol response to Supervisor/AGV</strong></p>
<p>3.3532 [09:6] 00 : 03<br />
3.3532 [09:6] 01 : 00 Protocol version 3<br />
3.3532 [09:6] 02 : 1E<br />
3.3532 [09:6] 03 : 0C Msg ID = 3102 (x0C1E)<br />
3.3532 [09:6] 04 : DE<br />
3.3532 [09:6] 05 : 00<br />
3.3532 [09:6] 06 : 00<br />
3.3532 [09:6] 07 : 00 Lenght all 222 (x000000DE)<br />
3.3532 [09:6] 08 : 2A<br />
3.3532 [09:6] 09 : 00<br />
3.3532 [09:6] 10 : 00<br />
3.3532 [09:6] 11 : 00 Length default section 42 (x0000002A)<br />
3.3532 [09:6] 12 : 02<br />
3.3532 [09:6] 13 : 00<br />
3.3532 [09:6] 14 : 00<br />
3.3532 [09:6] 15 : 00 State 2 (x00000002)<br />
3.3532 [09:6] 16 : 00<br />
3.3532 [09:6] 17 : 00<br />
3.3532 [09:6] 18 : 00<br />
3.3532 [09:6] 19 : 00 X 0.0f (x00000000)<br />
3.3532 [09:6] 20 : 00<br />
3.3532 [09:6] 21 : 00<br />
3.3532 [09:6] 22 : 00<br />
3.3532 [09:6] 23 : 00 Y 0.0f (x00000000)<br />
3.3532 [09:6] 24 : 00<br />
3.3532 [09:6] 25 : 00<br />
3.3532 [09:6] 26 : 00<br />
3.3532 [09:6] 27 : 00 Head 0.0f (x00000000)<br />
3.3532 [09:6] 28 : 00<br />
3.3532 [09:6] 29 : 00<br />
3.3532 [09:6] 30 : 00<br />
3.3532 [09:6] 31 : 00 Level 0 (0x00000000)<br />
3.3532 [09:6] 32 : 00<br />
3.3532 [09:6] 33 : 00<br />
3.3532 [09:6] 34 : 00<br />
3.3532 [09:6] 35 : 00 Speed<br />
3.3532 [09:6] 36 : 00<br />
3.3532 [09:6] 37 : 00 PosIniStatus<br />
3.3532 [09:6] 38 : 00<br />
3.3532 [09:6] 39 : 00 PosConf<br />
3.3532 [09:6] 40 : 01<br />
3.3532 [09:6] 41 : 00 Error 1 (x0001)<br />
3.3532 [09:6] 42 : 01<br />
3.3532 [09:6] 43 : 00 Section ID 1 (0x0001) - General section<br />
3.3532 [09:6] 44 : 0C<br />
3.3532 [09:6] 45 : 00<br />
3.3532 [09:6] 46 : 00<br />
3.3532 [09:6] 47 : 00 Section ID 1 length 12 (0x0000000C)<br />
3.3532 [09:6] 48 : 00<br />
3.3532 [09:6] 49 : 00<br />
3.3532 [09:6] 50 : 00<br />
3.3532 [09:6] 51 : 00 Battery voltage<br />
3.3532 [09:6] 52 : 00<br />
3.3532 [09:6] 53 : 00 OnRoute<br />
3.3532 [09:6] 54 : 02<br />
3.3532 [09:6] 55 : 00 Section ID 2 (0x0002) - Hold section<br />
3.3532 [09:6] 56 : 90<br />
3.3532 [09:6] 57 : 00<br />
3.3532 [09:6] 58 : 00<br />
3.3532 [09:6] 59 : 00 Section ID 2 length 144 (0x00000090)<br />
3.3532 [09:6] 60 : 00<br />
3.3532 [09:6] 61 : 00 In hold<br />
3.3532 [09:6] 62 : 00<br />
3.3532 [09:6] 63 : 00 Default destination in use<br />
3.3532 [09:6] 64 : 00<br />
3.3532 [09:6] 65 : 00<br />
3.3532 [09:6] 66 : 00<br />
3.3532 [09:6] 67 : 00<br />
3.3532 [09:6] 68 : 00<br />
3.3532 [09:6] 69 : 00<br />
3.3532 [09:6] 70 : 00<br />
3.3532 [09:6] 71 : 00<br />
3.3532 [09:6] 72 : 00<br />
3.3533 [09:6] 73 : 00<br />
3.3533 [09:6] 74 : 00<br />
3.3533 [09:6] 75 : 00<br />
3.3533 [09:6] 76 : 00<br />
3.3533 [09:6] 77 : 00<br />
3.3533 [09:6] 78 : 00<br />
3.3533 [09:6] 79 : 00<br />
3.3533 [09:6] 80 : 00<br />
3.3533 [09:6] 81 : 00<br />
3.3533 [09:6] 82 : 00<br />
3.3533 [09:6] 83 : 00<br />
3.3533 [09:6] 84 : 00<br />
3.3533 [09:6] 85 : 00<br />
3.3533 [09:6] 86 : 00<br />
3.3533 [09:6] 87 : 00<br />
3.3533 [09:6] 88 : 00<br />
3.3533 [09:6] 89 : 00<br />
3.3533 [09:6] 90 : 00<br />
3.3533 [09:6] 91 : 00<br />
3.3533 [09:6] 92 : 00<br />
3.3533 [09:6] 93 : 00<br />
3.3533 [09:6] 94 : 00<br />
3.3533 [09:6] 95 : 00 Default destination name 32 chars<br />
3.3533 [09:6] 96 : 00<br />
3.3533 [09:6] 97 : 00 First alt destination in use<br />
3.3533 [09:6] 98 : 00<br />
3.3533 [09:6] 99 : 00<br />
3.3533 [09:6] 100 : 00<br />
3.3533 [09:6] 101 : 00<br />
3.3533 [09:6] 102 : 00<br />
3.3533 [09:6] 103 : 00<br />
3.3533 [09:6] 104 : 00<br />
3.3533 [09:6] 105 : 00<br />
3.3533 [09:6] 106 : 00<br />
3.3533 [09:6] 107 : 00<br />
3.3533 [09:6] 108 : 00<br />
3.3533 [09:6] 109 : 00<br />
3.3533 [09:6] 110 : 00<br />
3.3533 [09:6] 111 : 00<br />
3.3533 [09:6] 112 : 00<br />
3.3533 [09:6] 113 : 00<br />
3.3533 [09:6] 114 : 00<br />
3.3533 [09:6] 115 : 00<br />
3.3533 [09:6] 116 : 00<br />
3.3533 [09:6] 117 : 00<br />
3.3533 [09:6] 118 : 00<br />
3.3533 [09:6] 119 : 00<br />
3.3533 [09:6] 120 : 00<br />
3.3533 [09:6] 121 : 00<br />
3.3533 [09:6] 122 : 00<br />
3.3533 [09:6] 123 : 00<br />
3.3533 [09:6] 124 : 00<br />
3.3533 [09:6] 125 : 00<br />
3.3533 [09:6] 126 : 00<br />
3.3533 [09:6] 127 : 00<br />
3.3533 [09:6] 128 : 00<br />
3.3533 [09:6] 129 : 00 First alt destination name 32 chars<br />
3.3533 [09:6] 130 : 00<br />
3.3533 [09:6] 131 : 00 Second alt destination in use<br />
3.3533 [09:6] 132 : 00<br />
3.3533 [09:6] 133 : 00<br />
3.3533 [09:6] 134 : 00<br />
3.3533 [09:6] 135 : 00<br />
3.3533 [09:6] 136 : 00<br />
3.3533 [09:6] 137 : 00<br />
3.3533 [09:6] 138 : 00<br />
3.3533 [09:6] 139 : 00<br />
3.3533 [09:6] 140 : 00<br />
3.3533 [09:6] 141 : 00<br />
3.3533 [09:6] 142 : 00<br />
3.3533 [09:6] 143 : 00<br />
3.3533 [09:6] 144 : 00<br />
3.3533 [09:6] 145 : 00<br />
3.3533 [09:6] 146 : 00<br />
3.3533 [09:6] 147 : 00<br />
3.3533 [09:6] 148 : 00<br />
3.3533 [09:6] 149 : 00<br />
3.3533 [09:6] 150 : 00<br />
3.3533 [09:6] 151 : 00<br />
3.3533 [09:6] 152 : 00<br />
3.3533 [09:6] 153 : 00<br />
3.3533 [09:6] 154 : 00<br />
3.3533 [09:6] 155 : 00<br />
3.3533 [09:6] 156 : 00<br />
3.3533 [09:6] 157 : 00<br />
3.3533 [09:6] 158 : 00<br />
3.3533 [09:6] 159 : 00<br />
3.3533 [09:6] 160 : 00<br />
3.3533 [09:6] 161 : 00<br />
3.3533 [09:6] 162 : 00<br />
3.3533 [09:6] 163 : 00 Second alt destination name 32 chars<br />
3.3533 [09:6] 164 : 00<br />
3.3533 [09:6] 165 : 00 Third alt destination in use<br />
3.3533 [09:6] 166 : 00<br />
3.3533 [09:6] 167 : 00<br />
3.3533 [09:6] 168 : 00<br />
3.3533 [09:6] 169 : 00<br />
3.3533 [09:6] 170 : 00<br />
3.3533 [09:6] 171 : 00<br />
3.3533 [09:6] 172 : 00<br />
3.3533 [09:6] 173 : 00<br />
3.3533 [09:6] 174 : 00<br />
3.3533 [09:6] 175 : 00<br />
3.3533 [09:6] 176 : 00<br />
3.3533 [09:6] 177 : 00<br />
3.3533 [09:6] 178 : 00<br />
3.3533 [09:6] 179 : 00<br />
3.3533 [09:6] 180 : 00<br />
3.3533 [09:6] 181 : 00<br />
3.3533 [09:6] 182 : 00<br />
3.3533 [09:6] 183 : 00<br />
3.3533 [09:6] 184 : 00<br />
3.3533 [09:6] 185 : 00<br />
3.3533 [09:6] 186 : 00<br />
3.3533 [09:6] 187 : 00<br />
3.3533 [09:6] 188 : 00<br />
3.3533 [09:6] 189 : 00<br />
3.3533 [09:6] 190 : 00<br />
3.3533 [09:6] 191 : 00<br />
3.3533 [09:6] 192 : 00<br />
3.3533 [09:6] 193 : 00<br />
3.3533 [09:6] 194 : 00<br />
3.3533 [09:6] 195 : 00<br />
3.3533 [09:6] 196 : 00<br />
3.3533 [09:6] 197 : 00 Third alt destination name 32 chars<br />
3.3533 [09:6] 198 : 05<br />
3.3533 [09:6] 199 : 00 Section ID 5 (0x0005) - Actuator section<br />
3.3533 [09:6] 200 : 0E<br />
3.3533 [09:6] 201 : 00<br />
3.3533 [09:6] 202 : 00<br />
3.3533 [09:6] 203 : 00 Section ID 5 length 14 (0x0000000E)<br />
3.3533 [09:6] 204 : 00<br />
3.3533 [09:6] 205 : 00<br />
3.3533 [09:6] 206 : 00<br />
3.3533 [09:6] 207 : 00<br />
3.3533 [09:6] 208 : 00<br />
3.3533 [09:6] 209 : 00<br />
3.3533 [09:6] 210 : 00<br />
3.3533 [09:6] 211 : 00<br />
3.3533 [09:6] 212 : 07<br />
3.3533 [09:6] 213 : 00 Section ID 7 (0x0007) - Warning zone section<br />
3.3533 [09:6] 214 : 0A<br />
3.3533 [09:6] 215 : 00<br />
3.3533 [09:6] 216 : 00<br />
3.3533 [09:6] 217 : 00 Section ID 7 length 10 (0x0000000A)<br />
3.3533 [09:6] 218 : 00<br />
3.3533 [09:6] 219 : 00 Warning zone front value<br />
3.3533 [09:6] 220 : 00<br />
3.3533 [09:6] 221 : 00 Warning zone rear value</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="can-communication"><a class="header" href="#can-communication">CAN Communication</a></h1>
<p>Updated 29.07.2024</p>
<hr />
<h2 id="overview-7"><a class="header" href="#overview-7">Overview</a></h2>
<h3 id="introduction-4"><a class="header" href="#introduction-4">Introduction</a></h3>
<h4 id="can"><a class="header" href="#can">CAN</a></h4>
<p>Controller Area Network (CAN) is a robust bus standard designed to enable microcontrollers and devices to communicate with each other without a host computer. It is widely used in automotive and industrial applications due to its ability to provide reliable communication over a simple two-wire bus. CAN ensures data integrity with error detection and retransmission mechanisms, making it ideal for real-time control systems.</p>
<h4 id="canopen"><a class="header" href="#canopen">CANopen</a></h4>
<p>CANopen is a high-level communication protocol and device profile specification that is based on the CAN protocol. The CANopen umbrella covers a network programming framework, device descriptions, interface definitions and application profiles. CANopen provides a protocol which standardizes communication between devices and applications from different manufacturers. It has been used in a wide range of industries, with highlights in automation and motion applications.</p>
<h4 id="can-bus-topology"><a class="header" href="#can-bus-topology">CAN bus topology</a></h4>
<p>CAN communication takes place over two differential lines CAN_L and CAN_H. Topology of the CAN bus is a bus having two ends. Star-shaped or ring-shaped wiring topologies do not work. Two termination resistors (nominally 120 ohm) need to be connected to the bus ends. Measured impedance between CAN_L and CAN_H should then be around 60 ohm. This measurement should be done with the devices powered off.</p>
<p>Some CAN devices have optional CAN bus termination built in. Such a termination can be enabled via a physical switch and sometimes even electronically - follow the manufacturer's instructions for enabling/disabling these terminations. When using such terminations, select devices connected closest to the end of the bus. Navitrol IPC (when using Peak/Kvaser CAN card) does not have any bus termination.</p>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image1.png" alt="" /></p>
<p>CAN nodes are connected to bus using T-connector and a short stub or a pass-through connection. Maximum stub length depends on the speed of the communication. Stub lengths being too long result in problems in physical signaling. In addition to active nodes, it is recommended to add one extra connection point to CAN bus -- to be used for CAN analyzer.</p>
<h4 id="can-bus-connection---details"><a class="header" href="#can-bus-connection---details">CAN bus connection - details</a></h4>
<p>Navitrol IPC equipped with a CAN card uses &quot;standard&quot; kind of 9 pin D connector for connecting to CAN bus. Physically CAN is a two-wire differential signal, those two wires being</p>
<ul>
<li>
<p>CAN_L -- Pin #2 in D9 connector</p>
</li>
<li>
<p>CAN_H -- Pin #7 in D9 connector</p>
</li>
<li>
<p><em>GND -- Pin #3 in D9 connector</em></p>
</li>
<li>
<p><em>Note: Other pins -- there is NO true &quot;de-facto&quot; standard -- always check what is the case!</em></p>
</li>
</ul>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image2.png" alt="" /></p>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1: Peak D9 pin configuration on the left, Kvaser on the right.</p>
</blockquote>
<p>In many cases connecting two wires (CAN_L/CAN_H) is enough as long as proper type of cable is used. CAN cable should always be a shielded twisted pair cable. In order to improve noise immunity, the shield (in single shielded cable) should be connected to CAN GND in each CAN node and then finally to common ground at one single location.</p>
<p>In Navitrol IPC CAN connection (Peak/Kvaser) CAN_GND is PIN #3 in D9 connector. This is typically regarded as a standard pin for CAN_GND, but it should be noted that it may not be connected at all or may be connected for other purposes in some CAN devices. So, if in doubt, then do not connect.</p>
<p>In extremely noisy conditions -- even double shielded cable can be used.
In such a case inner shield should be connected to CAN_GND as explained before and outer shield again connected to ground at one location.</p>
<p>In many CAN interfaces PIN #5 is used for connecting the outer Shield.
In real life this is even less common than CAN_GND being connected to pin #3. For example in case of Peak pin #5 is not connected. So, be sure before connecting to any CAN node.</p>
<p>In addition to data, ground and shield, CAN connectors may have
connection for power supply out (master) or power supply in (slave).
Navitrol IPC CAN connector does not have supply power capability.</p>
<h3 id="requirements-2"><a class="header" href="#requirements-2">Requirements</a></h3>
<ul>
<li>CAN-card with <a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Miscellaneous/LinuxImageInstallation/CanDrivers/CanDrivers-en.html#socketcan">SocketCAN support</a>. Most common ones used are Kvaser and Peak CAN-cards.</li>
<li>Bitrate for each CAN device on the bus must be the same</li>
<li>CANopen node ID values must be between 1 and 127. In addition, all node IDs must be unique</li>
</ul>
<h3 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h3>
<ul>
<li><a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Miscellaneous/HardwareRequirements/HardwareRequirements-en.html">Hardware Requirements</a></li>
<li><a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Miscellaneous/LinuxImageInstallation/CanDrivers/CanDrivers-en.html">Linux Image Can Drivers</a></li>
</ul>
<h2 id="setup-4"><a class="header" href="#setup-4">Setup</a></h2>
<h3 id="quick-start-1"><a class="header" href="#quick-start-1">Quick Start</a></h3>
<ul>
<li>Connect CAN bus to the IPC and to other CAN-devices on the same bus. Verify that your <a href="AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html#can-bus-topology">CAN-bus topology</a> is setup correctly</li>
<li>Configure unique node ID for each CANopen device (between 1 and 127)</li>
<li>Set the same bitrate for each CAN-device connected to same bus</li>
<li>Choose the NMT-master and sync-producer of the system. Most often Navitrol</li>
<li>Configure other CAN-devices on the bus</li>
<li>Configure Navitrol CAN interface <a href="AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html#parameters">parameters</a></li>
<li>Start Navitrol. If there are errors in the system, see <a href="AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html#troubleshooting">Troubleshooting</a> section</li>
</ul>
<h3 id="parameters-1"><a class="header" href="#parameters-1">Parameters</a></h3>
<!-- The description in the parameter table should work as the starting point for anyone trying to find information about it. If it has been explained in some figures or somewhere else the reader should be pointed there by the description. -->
<table><thead><tr><th>Name</th><th>Type</th><th>Default Value</th><th>Description</th></tr></thead><tbody>
<tr><td>can_enabled</td><td>Int</td><td>1</td><td>Enables CAN communication. <strong>NOTE:</strong> If odometry source is CAN, then CAN is always enabled and this parameter is ignored. For more information on odometry source, see <a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Introduction/OdometrySource/OdometrySource-en.html">Odometry Source</a></td></tr>
<tr><td>navigation_software_node_id</td><td>Int</td><td>0</td><td>Navitrol IPC CANopen node ID. Mandatory for several machine types as well as for certain functions (like heartbeat) <br> 0 = not defined, 1-127 = valid node ID</td></tr>
<tr><td>can_ch</td><td>Int</td><td>0</td><td>Primary CAN channel number. Assumes device names like can0, can1,... <br> 0 and 1 are the most common channel numbers</td></tr>
<tr><td>can_bitrate_k</td><td>Int</td><td>250</td><td>Primary CAN bus bitrate [Kbit/s]: 125, 250, 500 or 1000</td></tr>
<tr><td>can_nmt_master</td><td>Int</td><td>1</td><td>Enables Navitrol to work as CANopen NMT master on primary CAN. 0 = No 1 = Yes <br> NMT master functionality is required whenever Navitrol configures any slave nodes using CANopen SDO messages</td></tr>
<tr><td>can_sync</td><td>Int</td><td>1</td><td>Navitrol's (Primary CAN) role for CANopen SYNC messages: 0 = None, 1 = SYNC producer, 2 = SYNC consumer <br> Most often Navitrol is the Sync producer</td></tr>
<tr><td>---</td><td>---</td><td>---</td><td>---</td></tr>
<tr><td>can_heartbeat_producer_enable</td><td>Int</td><td>0</td><td>Enables Navitrol to be Heartbeat producer for primary CAN <br> navigation_software_node_id must be defined (&gt;0) for hearbeat messages to be sent</td></tr>
<tr><td>can_sync_rx_mode</td><td>Int</td><td>1</td><td>Select sync receive PDOs: 0 = Legacy (all predefined), 1 = True CANopen SYNC PDOs only. <br> Ignored if can_sync=0 or no CANopen SYNC PDOs exist</td></tr>
<tr><td>can_primary_any_id</td><td>Int</td><td>0</td><td>Primary CAN valid PDO IDs that can be registered: 0 = Only valid PDO IDs can be registered, 1 = Any ID can be registered <br> Any message ID can be registered as RPDO when setting this parameter to 1. There is however a risk that non CANopen compliant ID conflicts with CANopen specification in such a way that the communication won't work properly. <strong>This parameter should never be set to 1 unless Navitec instructs to do so</strong>.</td></tr>
<tr><td>can_send_nmt_start_always</td><td>Int</td><td>0</td><td>Defines when Navitrol (Primary CAN) sends CIA301_NMT_CMD_START: 0 = Only on state change, 1 = Periodically every 1 second <br></td></tr>
<tr><td>can_sdo_interval_ms</td><td>Int</td><td>100</td><td>Primary CAN SDO message interval [ms] used by Navitrol</td></tr>
<tr><td>can_sdo_timeout_ms</td><td>Int</td><td>500</td><td>Primary CAN SDO message response timeout [ms] used by Navitrol</td></tr>
<tr><td>can_sdo_write_from_file</td><td>Int</td><td>0</td><td>Enables SDO writes from file sdo_write.txt for primary CAN. CANopen specific. <br> If set to 1, Navitrol reads the file and sends SDO commands defined in that file (See Appendix <a href="AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html#sdo-write-configuration">SDO Write configuration</a>). This feature enables any CANopen device configuration changes without changes to Navitrol SW.</td></tr>
<tr><td>log_can</td><td>Int</td><td>0</td><td>Log primary CAN bus details, including all messages bytes. 2 = max level</td></tr>
<tr><td>log_can2</td><td>Int</td><td>0</td><td>Log secondary CAN bus details, including all messages bytes. 2 = max level.</td></tr>
<tr><td>log_can_msgs</td><td>Int</td><td>0</td><td>Log parsed and built can message data.</td></tr>
<tr><td>log_can_summary</td><td>Int</td><td>0</td><td>Log CAN msg summary. 0 = on ERR condition only, 1 = periodically.</td></tr>
</tbody></table>
<p><strong>Secondary interface</strong></p>
<p>Sometimes the AGV has a secondary CAN bus as well. These parameters are named with a prefix <code>can2_</code>. Otherwise the parameters are mostly the same as with the primary CAN bus. See <a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Introduction/Parameters/Parameters.html">Navitrol parameters</a> for Secondary CAN interface parameters.</p>
<h2 id="how-to-use-2"><a class="header" href="#how-to-use-2">How to use</a></h2>
<h3 id="can-wiring--configuration-rules"><a class="header" href="#can-wiring--configuration-rules">CAN wiring &amp; configuration rules</a></h3>
<p>The following rules shall be followed when wiring and configurating CAN-network</p>
<ul>
<li>
<p>CAN bus topology must be &quot;two end&quot; bus terminated at both ends using nominally 120 ohm resistor (between CAN_L and CAN_H).</p>
</li>
<li>
<p>CAN cable shall be shielded twisted-pair cable.</p>
</li>
<li>
<p>CAN_GND shall be connected to earth at single point.</p>
</li>
<li>
<p>If connecting outer shield in double shielded cable, it shall be connected to earth at single point.</p>
</li>
<li>
<p>When using T-connectors (or alike), stub lengths shall be kept as short as possible.</p>
</li>
<li>
<p>Pay attention not to place CAN wiring next to major disturbance sources, like inverters and motors.</p>
</li>
<li>
<p>Do not connect CAN devices with different bitrate to same bus.</p>
</li>
<li>
<p>Always assure that all CAN devices are configured to send unique message IDs (unique node IDs in CANopen).</p>
</li>
<li>
<p>Do not connect mixed type CAN devices (like CANopen and non-CANopen) to same bus unless you <em><strong>know</strong></em> that it is ok.</p>
</li>
</ul>
<p><strong>The electrical characteristics of the CAN bus cable restrict the cable length according to the selected bit rate. The High-Speed ISO 11898 Standard specifications are given for a maximum signaling rate of 1 Mbps with a bus length of 40 m and a maximum of 30 nodes. It also recommends a maximum un-terminated stub length of 0.3 m. You can use cabling up to 250 meters with the bitrate of 250 kbit/s. The maximum bus length with a bit rate of 10 kbit/s is 1 km, and the shortest with 1 Mbit/s is 40 meters. In the AGV world this is not a limiting thing.</strong></p>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image4.png" alt="" /></p>
<p><strong>Maximum stub length on the other hand is not that simple thing. This depends on many details like transceiver characteristics. Even if the Standard recommends a maximum un-terminated stub length of 0.3 m with a 1 Mbps signaling rate, it is possible to use longer stub lengths in real world -- up to 5 m. It is difficult however to define the limit without knowing lot of details from HW, so the shorter, the better.</strong></p>
<h3 id="can-bus-voltage-levels"><a class="header" href="#can-bus-voltage-levels">CAN bus voltage levels</a></h3>
<p>Nominal voltage levels on CAN bus are shown in picture below. When no data is being sent both CAN_H and CAN_L should be very close to each other around 2.5V. When data is being sent, then voltage for CAN_H should be higher and CAN_L lower for '0' bit on the bus.</p>
<p>CAN is differential signal and therefore the Vdiff is the meaningful value, when detecting data. When the Vdiff value on the bus is less than 0.5V, the bus is considered to be in a recessive state. Vdiff values greater than 0.9V indicate that the bus is in a dominant state. Lastly, for Vdiff values between 0.5V and 0.9V, the bus state is undefined.</p>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image5.png" alt="" /></p>
<h3 id="can-nodes--messages"><a class="header" href="#can-nodes--messages">CAN nodes &amp; messages</a></h3>
<p>When setting up CAN bus and configuring CAN devices, one must be careful to have same bitrate set to each connected device and set unique message IDs (in CANopen unique node IDs -- valid node ID range 1...127) for each device.</p>
<p>When having CAN devices of different type (like CANopen, basic CAN,..) on same bus it is even more important to verify already at design/configuration phase that all CAN message IDs are unique.
Duplicated IDs cause both confusion and potentially low level bus errors.</p>
<h3 id="can-drivers"><a class="header" href="#can-drivers">CAN drivers</a></h3>
<p>Navitrol uses SocketCAN as the CAN interface and SocketCAN is currently only supported CAN interface. Linux Debian 9 Stretch and later has SocketCAN supported out of the box. You can see the CAN interface as a &quot;network interface&quot; (command <code>ip a</code> shows can0 for example as an available network interface) on Linux.</p>
<ul>
<li>
<p>Any HW supported by SocketCAN or having SocketCAN drivers installed can be used with <a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Miscellaneous/LinuxImageInstallation/CanDrivers/CanDrivers-en.html#socketcan">SocketCAN interface</a>.</p>
</li>
<li>
<p>NOTE: SocketCAN and manufacturer specific non SocketCAN compliant drivers are typically mutually exclusive. Installing such SocketCAN conflicting driver may disable (blacklist) SocketCAN drivers completely. See <a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Miscellaneous/LinuxImageInstallation/CanDrivers/CanDrivers-en.html#uninstalling-kvaser-or-peak-dedicated-character-device-driver">Uninstalling Kvaser or PeakCAN native CAN drivers</a> for more info.</p>
</li>
</ul>
<h3 id="navitrol-supports-two-can-buses"><a class="header" href="#navitrol-supports-two-can-buses">Navitrol supports two CAN buses</a></h3>
<p>Navitrol supports two simultaneous CAN interfaces, although typically only one is used.</p>
<p>Navitrol Primary CAN bus is meant for CANopen type of nodes. In many cases it is assumed that Navitrol is the CANopen bus master as well and Navitrol primary CAN interface expects CANopen compliant messaging from all nodes.</p>
<p>Some non CANopen devices can be connected to CANopen bus without issues.
Some non-CANopen devices however use such non-configurable settings (like message IDs) that they can't or shouldn't be connected to Navitrol Primary CAN bus. If there are non-CANopen devices sending messages with IDs conflicting with CANopen specification, then those devices need to be connected in a separate CAN bus. For that purpose Navitrol supports two simultaneous CAN buses, primary and secondary. Use of two buses makes it also possible to connect to CAN devices with different bitrates.</p>
<p><strong>NOTE:</strong> There are also COTS products (CAN bridges) that make it
possible to connect non-CANopen compliant devices or even devices with
different bitrates to Navitrol Primary CAN bus. CAN-bridges support
message ID translation/filtering that makes this possible.</p>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image6.png" alt="" /></p>
<h2 id="troubleshooting-5"><a class="header" href="#troubleshooting-5">Troubleshooting</a></h2>
<h3 id="can-bus-message-logging"><a class="header" href="#can-bus-message-logging">CAN bus message logging</a></h3>
<p>Navitrol logs always some amount of events related to CAN communication and CAN related issues. If one wishes to see all data sent to CAN bus and received from CAN bus, byte by byte, this can be accomplished by enabling can logging parameters.</p>
<p>Summary of received/not received objects is logged periodically whenever some of the expected CAN objects are missing. By setting parameter log_can_summary to 1, this summary is logged periodically even if there are no errors.</p>
<p>Examples of logged data are below. All these are subject to change when it comes to details. Key phrases, marked with double quotes in title (like &quot;RX_RAW&quot;), in the log will not change whenever it is possible to do so.</p>
<p><strong>Obligatory receive objects never received i.e. &quot;NotRxed&quot;</strong></p>
<p>0.4447 [08:1] CAN: PRI Node 30 Obj 19Eh NotRxed</p>
<p>0.4447 [08:1] CAN: PRI Node 30 Obj 29Eh NotRxed</p>
<p>0.4447 [08:1] CAN: PRI Node 31 Obj 19Fh NotRxed</p>
<p>0.4447 [08:1] CAN: PRI Node 31 Obj 29Fh NotRxed</p>
<p><strong>NOTE:</strong> Available as shown here starting from Navitrol version 6.30.00</p>
<p>Navitrol versions 6.28 and older log only first missing object without node ID.</p>
<p><strong>Received CAN messages, byte by byte: &quot;RX_RAW&quot; (params.log_can &gt; 0)</strong></p>
<p>234.3283 [08:6] CAN_INTE: RX_RAW PRI 2BCh dlc 8 00 00 00 00 00 00 04 00</p>
<p>234.3324 [23:6] CAN_INTE: RX_RAW SEC 1B2h dlc 8 00 00 00 00 00 00 03 DF</p>
<ul>
<li>
<p>SEC -- PRIMARY/SECONDARY bus</p>
</li>
<li>
<p>1B2h -- Message id in hex</p>
</li>
<li>
<p>dlc 8 -- Message length in bytes</p>
</li>
<li>
<p>00 00 00 00 00 00 03 DF -- Message byte by byte</p>
</li>
</ul>
<p><strong>Transmitted CAN messages, byte by byte: &quot;TX_RAW&quot; (params.log_can &gt; 0)</strong></p>
<p>307.9164 [08:6] CAN_INTE: TX_RAW PRI 1B2h dlc 8 00 00 00 00 00 00 03 63</p>
<p>307.9165 [23:6] CAN_INTE: TX_RAW SEC 2BCh dlc 8 00 00 00 00 00 00 04 00</p>
<p>Log line interpretation is exactly same as before in case of RX message.</p>
<p><strong>NOTE:</strong> you can pick both RX_RAW and TX_RAW, by using &quot;X_RAW&quot; as a key phrase.</p>
<p><strong>&quot;RX_SUM&quot; (ERROR OR params.log_can_summary &gt; 0)</strong></p>
<p>53.4326 [08:6] CAN: RX_SUM</p>
<p>53.4326 [08:6] CAN: RX_SUM PRI node 50 Obj 232h XXX_IN1 rxed/req 0/1, age --- ms</p>
<p>53.4326 [08:6] CAN: RX_SUM PRI node 50 Obj 332h XXX _IN2 rxed/req 0/1, age --- ms</p>
<p>53.4326 [08:6] CAN: RX_SUM PRI node 50 Obj 432h XXX _IN3 rxed/req 1/1, age 732 ms</p>
<p>53.4326 [08:6] CAN: RX_SUM SEC node 60 Obj 23Ch BUS2_1 rxed/req 0/1, age --- ms</p>
<p>53.4326 [08:6] CAN: RX_SUM SEC node 60 Obj 33Ch BUS2_2 rxed/req 0/1, age --- ms</p>
<ul>
<li>
<p>SEC -- PRIMARY/SECONDARY bus</p>
</li>
<li>
<p>60 - node ID of the CAN device</p>
</li>
<li>
<p>33Ch -- Message id in hex</p>
</li>
<li>
<p>rxed/req 0/1 -- Received at least once/required; if required message has not been received at all, then ERROR_CAN_ALL_NODES_NOT_OPER is generated (see troubleshooting section for more information)</p>
</li>
<li>
<p>--- -- Age of the message in ms (--- means that message has never been received)</p>
</li>
</ul>
<p><strong>CAN: &quot;Summary of registered objects&quot; (at startup)</strong></p>
<p>At startup Navitrol logs also a summary of all registered objects, i.e. objects transmitted or parsed by Navitrol. If Navitrol has been running for a long time, this info is not yet available in standard log file, but can still be found in startlog.txt.</p>
<p>0.3924 [08:6] CAN: Summary of registered objects</p>
<p>0.3924 [08:6] CAN: Rx00: PRI node 50 COBid 0232h SYNC 1 TimeoutTime 50</p>
<p>0.3924 [08:6] CAN: Rx01: PRI node 50 COBid 0332h SYNC 1 TimeoutTime 50</p>
<p>0.3924 [08:6] CAN: Rx02: PRI node 50 COBid 0432h SYNC 1 TimeoutTime 50</p>
<p>0.3924 [08:6] CAN: Rx03: PRI node 50 COBid 0532h SYNC 1 TimeoutTime 50</p>
<p>0.3924 [08:6] CAN: Rx04: SEC node 60 COBid 023Ch SYNC 1 TimeoutTime 50</p>
<p>0.3924 [08:6] CAN: Rx05: SEC node 60 COBid 033Ch SYNC 1 TimeoutTime 50</p>
<p>0.3924 [08:6] CAN: Tx00: PRI node 50 COBid 01B2h SYNC 1 TxInterval 30 TxInterval min 10</p>
<p>0.3924 [08:6] CAN: Tx01: PRI node 50 COBid 02B2h SYNC 1 TxInterval 30 TxInterval min 10</p>
<p>0.3924 [08:6] CAN: Tx02: PRI node 50 COBid 03B2h SYNC 1 TxInterval 30 TxInterval min 10</p>
<p>0.3924 [08:6] CAN: Tx03: SEC node 60 COBid 01BCh SYNC 1 TxInterval 30 TxInterval min 10</p>
<p>0.3924 [08:6] CAN: Tx04: SEC node 60 COBid 02BCh SYNC 1 TxInterval 30 TxInterval min 10</p>
<ul>
<li>
<p><strong>Tx04 -- message type (Rx, Tx, Od)</strong></p>
</li>
<li>
<p>SEC -- PRIMARY/SECONDARY bus</p>
</li>
<li>
<p>60 -- node ID of the CAN device whose objects are registered -- typically used as a basis for message parsing and building.</p>
</li>
<li>
<p>1B2h -- Message id in hex</p>
</li>
<li>
<p>SYNC 1 -- Tells whether message is a SYNC object or not. SYNC objects are used for synchronizing all operation in Navitrol.</p>
</li>
<li>
<p>TimeoutTime 50 -- Receive message timeout time. If receive interval exceeds this limit, error ERROR_CAN_RX_TIMEOUT is generated (see troubleshooting section for more information).</p>
</li>
<li>
<p>TxInterval 30 TxInterval min 10 -- Maximum and minimum transit intervals for each transmit object.</p>
</li>
</ul>
<h3 id="troubleshooting-can-communication"><a class="header" href="#troubleshooting-can-communication">Troubleshooting CAN communication</a></h3>
<p>Navitrol itself can detect some CAN related configuration issues, missing CAN nodes/objects and some major issues on the bus. It should be noted that Navitrol does have only limited capability to detect low level CAN bus related issues. Therefore truly comprehensive troubleshooting and analysis requires also other means, like use of a CAN analyzer.</p>
<h4 id="can-communication-issue-checklist"><a class="header" href="#can-communication-issue-checklist">CAN communication issue checklist</a></h4>
<p>Typical problems are</p>
<ul>
<li>
<p>Cabling related issues</p>
<ul>
<li>
<p>Bus topology</p>
</li>
<li>
<p>Termination missing or incorrect</p>
</li>
<li>
<p>CAN_H/CAN_L &quot;cross-connected&quot;</p>
</li>
<li>
<p>Ground/shield connections</p>
</li>
</ul>
</li>
<li>
<p>Sometimes it is assumed that powering through CAN interface is a standard feature (Navitrol IPC CAN connector does not have supply power)</p>
</li>
<li>
<p>CAN node missing or connected in a wrong way</p>
</li>
<li>
<p>One or more CAN nodes configured in wrong way (bitrate or node IDs in CANopen)</p>
</li>
<li>
<p>Mixing basic CAN and CANopen -- resulting in duplicate message IDs, maybe message IDs that conflict with CANopen basic mechanisms.</p>
</li>
<li>
<p>Damaged CAN interface</p>
</li>
</ul>
<p>Additional things to verify:</p>
<ul>
<li>
<p>Check that all devices are powered</p>
</li>
<li>
<p>Verify that <a href="AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html#can-wiring--configuration-rules">CAN wiring &amp; configuration rules</a> have been followed.</p>
</li>
<li>
<p>Verify that configuration for CAN devices is ok</p>
<ul>
<li>
<p>Same bitrate for all devices</p>
</li>
<li>
<p>Unique node ID (1...127) for all CANopen devices</p>
</li>
<li>
<p>Basic CAN message IDs do not conflict with CANopen ones</p>
</li>
</ul>
</li>
<li>
<p>Each CANopen device <strong>should</strong> send bootup message at startup (0x700 + node ID)</p>
</li>
<li>
<p>CAN bus voltages</p>
</li>
<li>
<p>In Navitrol</p>
<ul>
<li>
<p>Verify that Navitrol's CAN related parameters are set up correctly</p>
</li>
<li>
<p>Check for any CAN related ERROR active. See <a href="AgvInterfaces/GenericInterfaces/CanCommunication/../../../Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html#709-error_can_failure">Error Descriptions</a> for different CAN-errors</p>
</li>
<li>
<p>Verify that Navitrol is receiving CAN messages as expected: &quot;RX_RAW&quot; logging</p>
</li>
<li>
<p>Verify that Navitrol is receiving CAN messages from all configured nodes: &quot;RX_SUM&quot; logging</p>
</li>
</ul>
</li>
</ul>
<p>If any of the CAN devices on the bus is configured for wrong bitrate, then it typically messes all communication. In such a case it is often necessary to connect (or disconnect) CAN devices to the bus one by one and first find out which one of the devices causes the issues.</p>
<h4 id="can-analyzer"><a class="header" href="#can-analyzer">CAN Analyzer</a></h4>
<p>Even if the communication seems to work kind of ok, it is possible that there are issues that result in collisions, delays and time jitter in communication. In case of unclear problems, it is often good policy to connect a CAN analyzer to the bus to check if there are detectable issues. For example errors in basic CAN device configuration (different
bitrates, duplicated node IDs,..) often result in &quot;Error frames&quot; or other errors that can be detected using CAN analyzer SW. It is not that clear that all these errors are detected by Navitrol at all. See picture below.</p>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image7.png" alt="" /></p>
<p>Most useful windows for troubleshooting are &quot;Bus Statistics&quot; and &quot;Output Window&quot;. Left hand pictures show contents in &quot;normal&quot; case without any issues. Bus Statistics details that should be checked are marked in picture. Right hand side on the other hand shows same windows in a case where physical bus has issues.</p>
<p>In some AGV's it is not that straightforward to physically connect to the bus. In those cases CAN hub (like Kvaser T-Cannector, see pic below) helps a lot.</p>
<p><img src="AgvInterfaces/GenericInterfaces/CanCommunication/./media-en/image8.jpeg" alt="" /></p>
<h4 id="sdo-errors"><a class="header" href="#sdo-errors">SDO errors</a></h4>
<p>SDO errors might occur if something was done incorrectly during the commissioning. If SDO Response message starts with 80 instead of 60 the SDO message has failed. The error reason is written to the last four data bytes and in that case the error can be googled.</p>
<table><thead><tr><th>SEND/RESPONSE</th><th>COB ID (in hex 0x)</th><th>dlc</th><th>Data bytes (in hex 0x)</th><th>Description</th></tr></thead><tbody>
<tr><td>SEND</td><td>601</td><td>8</td><td>2F 81 2F 00 <strong>00</strong> 00 00 00</td><td>SDO Upload request:<br>Trying to set baud rate to <strong>0 kbs</strong></td></tr>
<tr><td>RESPONSE</td><td>581</td><td>8</td><td>80 81 2F 00 <strong>32 00 09 06</strong></td><td>Response not ok. Error code <strong>0609 0032h</strong>: Value of parameter written too low.</td></tr>
</tbody></table>
<blockquote>
<p>Failed SDO message example</p>
</blockquote>
<h2 id="appendix-a"><a class="header" href="#appendix-a">Appendix A</a></h2>
<h3 id="sdo-write-configuration"><a class="header" href="#sdo-write-configuration">SDO write configuration</a></h3>
<p>Navitrol supports writing OD parameters at startup time to any CANopen slave. Some of these write commands are &quot;hard-coded&quot; in Navitrol, but it is also possible to define any other SDO writes using ASCII-file <code>sdo_write.txt</code>, format explained below.</p>
<pre><code>#--------------------------------------------------------------------------

# Sample file -- sdo_write.txt

#--------------------------------------------------------------------------

#

# Any data on a line after character '#' is ignored (regarded as comment)

#

# Mode, node ID, type, Idx.SubIdx, value

# - mode shall be

# * WRITE -- absolute write; value is written to OD as specified in file

# - Supported types are: I8 I16 I32 U8 U16 U32 F

# - Idx.SubIdx are both decimal or both hex (not mixed)

# - Integer values can be expressed in decimal or hex, prefix for hex values shall be 'x' or '0x'

# - spaces are ignored - can't have spaces separating items in single value though

#
# NODE 63
#

WRITE, 63,U8,0x4310.1,100 # VEL_Kp - PID-Position Controller - proportional gain

WRITE,63,I16,1500.09,x100

WRITE,63, I32, 0x49A0.20, x6400

WRITE, 40 , U16 , 1500.09 , x300

#
# NODE 22
#

WRITE, 22, I16, 1500.09, x100

#
# NODE 0x20 i.e. 32
#

WRITE,0x20, I16, 1500.09, x100
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="can-supervisor-interface"><a class="header" href="#can-supervisor-interface">CAN Supervisor Interface</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="introduction-5"><a class="header" href="#introduction-5">Introduction</a></h2>
<p>This document describes the interface between the Navitrol software and the AGV supervisor over CAN bus. Both programs are run on their dedicated computer units.</p>
<p>General CAN Network Definitions</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>Physical layer</td><td>CAN ISO/DIS 11898</td></tr>
<tr><td>ID-format</td><td>11-bit</td></tr>
<tr><td>Data length</td><td>8 bytes</td></tr>
<tr><td>Byte order</td><td>Little endian (Lowest byte first)</td></tr>
</tbody></table>
<p>Message formats and definitions for PDOs between Navitrol and Supervisor are defined in following subsections.</p>
<hr />
<h2 id="messages-from-the-agv-supervisor-to-navitrol"><a class="header" href="#messages-from-the-agv-supervisor-to-navitrol">Messages from the AGV supervisor to Navitrol</a></h2>
<p>Following messages can be sent from AGV supervisor to Navitrol over CAN.</p>
<hr />
<h3 id="101---supervisor-status"><a class="header" href="#101---supervisor-status">101 - Supervisor Status</a></h3>
<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Type ID</td><td>101</td><td></td></tr>
<tr><td>Transmitter</td><td>AGV Supervisor</td><td></td></tr>
<tr><td>Receiver</td><td>Navitrol</td><td></td></tr>
<tr><td>Length</td><td>8</td><td></td></tr>
<tr><td>Data</td><td>Byte 0</td><td><strong>Bit 0</strong>: Status, 1 if OK, 0 otherwise.<br> If status is set to 1 Navitrol can drive the AGV <br> <strong>Bit 1</strong>: Estop. 1 when ESTOP active, 0 otherwise <br> <strong>Bit 2</strong>: DriveDisabled, automatic driving will not start if this bit is 1.  <br> <strong>Bit 3-7</strong>: Reserved</td></tr>
<tr><td></td><td>Byte 1</td><td><strong>Bit 0</strong>: Safety Scanner Protection Zone <br> <strong>Bit 1</strong>: Safety Scanner Warning Zone 1 <br> <strong>Bit 2</strong>: Safety Scanner Warning Zone 2 <br> <strong>Bit 3-7</strong>: Reserved</td></tr>
<tr><td></td><td>Byte 2</td><td>Binary input signals<br>Each bit indicates one binary input:<br><strong>0</strong> – OFF/INACTIVE<br><strong>1</strong> – ON/ACTIVE<br>Mapping and functionality of binary inputs are project specific.</td></tr>
<tr><td></td><td>Byte 3-7</td><td>Reserved</td></tr>
</tbody></table>
<hr />
<h3 id="102---command-message"><a class="header" href="#102---command-message">102 - Command Message</a></h3>
<p>See subsection <strong>Command And Result Protocol</strong> for more details about data members in this message.</p>
<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Type ID</td><td>102</td><td></td></tr>
<tr><td>Transmitter</td><td>AGV Supervisor</td><td></td></tr>
<tr><td>Receiver</td><td>Navitrol</td><td></td></tr>
<tr><td>Length</td><td>8</td><td></td></tr>
<tr><td>Data</td><td>Byte 0</td><td>Command ID</td></tr>
<tr><td></td><td>Byte 1-7</td><td>Command Data</td></tr>
</tbody></table>
<hr />
<h2 id="messages-from-navitrol-to-the-agv-supervisor"><a class="header" href="#messages-from-navitrol-to-the-agv-supervisor">Messages from Navitrol to the AGV supervisor</a></h2>
<p>Navitrol can be configured to periodically send following messages over CAN.</p>
<h3 id="201---navitrol-status"><a class="header" href="#201---navitrol-status">201 - Navitrol Status</a></h3>
<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Type ID</td><td>201</td><td></td></tr>
<tr><td>Transmitter</td><td>Navitrol</td><td></td></tr>
<tr><td>Receiver</td><td>AGV supervisor</td><td></td></tr>
<tr><td>Length</td><td>8</td><td></td></tr>
<tr><td>Data</td><td>Byte 0</td><td><strong>BIT 0</strong>: Error status <br> 0 = no err <br> 1 = error on <br> <strong>Bit 1</strong>: Position Initialization Status <br> 0 = Failed <br> 1 = Succeeded <br> <strong>Bit 2-7</strong>: Reserved</td></tr>
<tr><td></td><td>Byte 1</td><td>Navitrol State <br> <br> START_STATE = 1,<br> STANDBY_STATE = 2,<br> AUTO_STATE = 3,<br> FSTOP_STATE = 9,<br> LOAD_STATE = 14,<br> HOLD_STATE = 15,<br> MANUAL_STATE = 16,<br> PAUSE_STATE = 17<br></td></tr>
<tr><td></td><td>Byte 2</td><td>Position confidence in percentage (0 - 100%) <br> Format: 8 bit unsigned char</td></tr>
<tr><td></td><td>Byte 3-4</td><td>Speed – mm/s <br> Format: 16 bit short</td></tr>
<tr><td></td><td>Byte 5</td><td>Binary output signals <br> Each bit indicates one binary output:<br> 0 – OFF/INACTIVE <br>1 – ON/ACTIVE <br> Mapping and functionality of binary outputs are project specific.</td></tr>
<tr><td></td><td>Byte 6-7</td><td>Reserved</td></tr>
</tbody></table>
<hr />
<h3 id="202---command-result"><a class="header" href="#202---command-result">202 - Command Result</a></h3>
<p>See subsection &quot;Command And Result Protocol&quot; for more details about data members in this message.</p>
<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Type ID</td><td>202</td><td></td></tr>
<tr><td>Transmitter</td><td>Navitrol</td><td></td></tr>
<tr><td>Receiver</td><td>AGV supervisor</td><td></td></tr>
<tr><td>Length</td><td>8</td><td></td></tr>
<tr><td>Data</td><td>Byte 0</td><td>Last Received Command ID</td></tr>
<tr><td></td><td>Byte 1</td><td>Response Status <br> Format: Unsigned Char <br> 0 = Completed <br> 1 = In progress</td></tr>
<tr><td></td><td>Byte 2-7</td><td>Response Data</td></tr>
</tbody></table>
<hr />
<h3 id="203---extended-status-1---virtual-tags"><a class="header" href="#203---extended-status-1---virtual-tags">203 - Extended Status 1 - Virtual Tags</a></h3>
<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Type ID</td><td>203</td><td></td></tr>
<tr><td>Transmitter</td><td>Navitrol</td><td></td></tr>
<tr><td>Receiver</td><td>AGV supervisor</td><td></td></tr>
<tr><td>Length</td><td>8</td><td></td></tr>
<tr><td>Data</td><td>Byte 0</td><td><strong>Bit 0</strong>: Virtual Tag in use <br> <strong>Bit 1-7</strong>: Reserved</td></tr>
<tr><td></td><td>Byte 1-2</td><td>Virtual Tag 1</td></tr>
<tr><td></td><td>Byte 3-4</td><td>Virtual Tag 2</td></tr>
<tr><td></td><td>Byte 5-7</td><td>Reserved</td></tr>
</tbody></table>
<hr />
<h3 id="204---extended-status-2---warning-zones"><a class="header" href="#204---extended-status-2---warning-zones">204 - Extended Status 2 - Warning Zones</a></h3>
<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>Type ID</td><td>204</td><td></td></tr>
<tr><td>Transmitter</td><td>Navitrol</td><td></td></tr>
<tr><td>Receiver</td><td>AGV supervisor</td><td></td></tr>
<tr><td>Length</td><td>8</td><td></td></tr>
<tr><td>Data</td><td>Byte 0 -1</td><td>Warning zone front value</td></tr>
<tr><td></td><td>Byte 2-3</td><td>Warning zone rear value</td></tr>
<tr><td></td><td>Byte 4-7</td><td>Reserved</td></tr>
</tbody></table>
<hr />
<h2 id="command-and-result-protocol"><a class="header" href="#command-and-result-protocol">Command And Result Protocol</a></h2>
<p>Supervisor can send commands to Navitrol using Command PDO and Navitrol will communicate their result to Supervisor through Command Result PDO.
Command PDO from Supervisor includes Command ID and relevant data. Command IDs for possible operations are defined in Table 1.
On receiving new Command ID, Navitrol changes the Last Received Command ID in Command Result PDO. This PDO from Navitrol will include the result of last received command. If a command requires more than one update cycles before its result is available, response PDO will indicate an “In Progress” status for the command. In such cases, Supervisor should keep sending same command until the Result Status changes to Completed.
When Response Status indicates completion of command execution, Response Data bytes will have results of the command as per definitions in Table 2.
Navitrol reacts only to changes in Command ID from Supervisor. Therefore, it is essential that same action is not commanded consecutively. A special Clear command can be sent in between in such cases.</p>
<p>Supervisor can send commands defined in following table in Command PDO (ID - 102).</p>
<table><thead><tr><th>Command Name</th><th>Command ID (1 byte)</th><th>Command Data (7 bytes)</th></tr></thead><tbody>
<tr><td>Clear</td><td>0</td><td><strong>Byte 0-6</strong>: 0</td></tr>
<tr><td>Pause Drive</td><td>1</td><td><strong>Byte 0-6</strong>: Reserved</td></tr>
<tr><td>Resume Drive</td><td>2</td><td><strong>Byte 0-6</strong>: Reserved</td></tr>
<tr><td>Release Hold</td><td>3</td><td><strong>Byte 0</strong>: Next destination the AGV should drive to. <br> 0 = Default, <br> 1 = 1st Alternative Destination, <br> 2 = 2nd Alternative Destination, <br> 3 = 3rd Alternative destination <br> <strong>Byte 1-6</strong>: Reserved</td></tr>
</tbody></table>
<blockquote>
<p>Table 1. Command ID and command data description.</p>
</blockquote>
<p>Following responses are sent by Navitrol in Command Result PDO (ID - 202).</p>
<table><thead><tr><th>Command Name</th><th>Command ID (1 byte)</th><th>Response Data (6 bytes)</th></tr></thead><tbody>
<tr><td>Clear</td><td>0</td><td><strong>Byte 0-5</strong>: 0</td></tr>
<tr><td>Pause Drive</td><td>1</td><td><strong>Byte 0</strong>: Pause Result <br> 0 = accepted, <br> 1 = bad input data, <br> 2 = wrong state <br> <strong>Byte 1-5</strong>: Reserved</td></tr>
<tr><td>Resume Drive</td><td>2</td><td><strong>Byte 0</strong>: Resume Result <br> 0 = accepted, <br> 1 = bad input data, <br> 2 = wrong state <br> <strong>Byte 1-4</strong>: Destination ID: Symbolic Point ID of the resumed drive destination. <br> <strong>Byte 5</strong>: Reserved</td></tr>
<tr><td>Release Hold</td><td>3</td><td><strong>Byte 0</strong>: Release Result <br> 0 = accepted <br> 1 = bad input data <br> 2 = wrong state <br> 3 = unreachable ID <br> 4 = drive control disabled <br> <strong>Byte 1-4</strong>: Destination ID: Symbolic Point ID of the destination.  <br> <strong>Byte 5</strong>: Reserved</td></tr>
</tbody></table>
<blockquote>
<p>Table 2. Responces to the commands.</p>
</blockquote>
<hr />
<h2 id="navitrol-parameters-1"><a class="header" href="#navitrol-parameters-1">Navitrol Parameters</a></h2>
<p>Lister below are the parameter available for configuring supervisor CAN interface.</p>
<table><thead><tr><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>I</td><td>supervisor_can_enabled</td><td>Setting to 1 enable Supervisor CAN interface</td></tr>
<tr><td>I</td><td>supervisor_can_rx_timeout_ms</td><td>Timeout of PDOs received by Navigation SW</td></tr>
<tr><td>I</td><td>supervisor_can_tx_interval_ms</td><td>Transmission interval of PDOs transmitted by Navigation SW</td></tr>
<tr><td>I</td><td>supervisor_can_nodeid_arr</td><td>CAN nodeid of supervisor PLC, 0 = disabled</td></tr>
<tr><td>I</td><td>supervisor_can_nodeid_mode_arr</td><td>Mode for node id at corresponding index; 0 = slave - Navigation SW transmits RPDOs, 1 = master - Navigation SW transmits TPDOs</td></tr>
<tr><td>I</td><td>supervisor_can_tx1_typeid_arr</td><td>Type id of message transmitted by Navigation SW to CAN bus on PDO 1</td></tr>
<tr><td>I</td><td>supervisor_can_tx2_typeid_arr</td><td>Type id of message transmitted by Navigation SW to CAN bus on PDO 2</td></tr>
<tr><td>I</td><td>supervisor_can_tx3_typeid_arr</td><td>Type id of message transmitted by Navigation SW to CAN bus on PDO 3</td></tr>
<tr><td>I</td><td>supervisor_can_tx4_typeid_arr</td><td>Type id of message transmitted by Navigation SW to CAN bus on PDO 4</td></tr>
<tr><td>I</td><td>supervisor_can_rx1_typeid_arr</td><td>Type id of message received by Navigation SW from CAN bus on PDO 1</td></tr>
<tr><td>I</td><td>supervisor_can_rx2_typeid_arr</td><td>Type id of message received by Navigation SW from CAN bus on PDO 2</td></tr>
<tr><td>I</td><td>supervisor_can_rx3_typeid_arr</td><td>Type id of message received by Navigation SW from CAN bus on PDO 3</td></tr>
<tr><td>I</td><td>supervisor_can_rx4_typeid_arr</td><td>Type id of message received by Navigation SW from CAN bus on PDO 4</td></tr>
</tbody></table>
<hr />
<h2 id="example-configurations"><a class="header" href="#example-configurations">Example configurations</a></h2>
<p>In the following subsections some example configurations are presented along with comments about how the parameter value is interpreted.</p>
<h3 id="example-configuration-1"><a class="header" href="#example-configuration-1">Example Configuration 1</a></h3>
<p>I, supervisor_can_enabled,                 1        # CAN Supervisor interface is enabled</p>
<p>I, supervisor_can_nodeid_arr[0],           12       # Node ID 12 will be used for configurations at index 0</p>
<p>I, supervisor_can_nodeid_mode_arr[0],      0        # For node id (12), Navitrol will transmit RPDOs (node id + [0x200, 0x300, 0x400, 0x500])</p>
<p>I, supervisor_can_tx1_typeid_arr[0],       201      # Navitrol transmits message with Type ID 201 on PDO id (12 + 0x200)</p>
<p>I, supervisor_can_tx2_typeid_arr[0],       202      # Navitrol transmits message with Type ID 202 on PDO id (12 + 0x300)</p>
<p>I, supervisor_can_tx3_typeid_arr[0],       203      # Navitrol transmits message with Type ID 203 on PDO id (12 + 0x400)</p>
<p>I, supervisor_can_tx4_typeid_arr[0],       204      # Navitrol transmits message with Type ID 204 on PDO id (12 + 0x500)</p>
<p>I, supervisor_can_rx1_typeid_arr[0],       101      # Navitrol expects message with Type ID 101 on PDO id (12 + 0x180)</p>
<p>I, supervisor_can_rx2_typeid_arr[0],       102      # Navitrol expects message with Type ID 102 on PDO id (12 + 0x280)</p>
<h3 id="example-configuration-2"><a class="header" href="#example-configuration-2">Example Configuration 2</a></h3>
<p>I, supervisor_can_enabled,                 1        # CAN Supervisor interface is enabled</p>
<p>I, supervisor_can_nodeid_arr[0],           20       # Node ID 20 will be used for configurations at index 0</p>
<p>I, supervisor_can_nodeid_mode_arr[0],      1        # For node id (20), Navitrol will transmit TPDOs (node id + [0x180, 0x280, 0x380, 0x480])</p>
<p>I, supervisor_can_tx1_typeid_arr[0],       201      # Navitrol transmits message with Type ID 201 on PDO id (20 + 0x180)</p>
<p>I, supervisor_can_tx2_typeid_arr[0],       202      # Navitrol transmits message with Type ID 202 on PDO id (20 + 0x280)</p>
<p>I, supervisor_can_rx1_typeid_arr[0],       101      # Navitrol expects message with Type ID 101 on PDO id (20 + 0x200)</p>
<p>I, supervisor_can_rx2_typeid_arr[0],       102      # Navitrol expects message with Type ID 102 on PDO id (20 + 0x300)</p>
<h3 id="example-configuration-3"><a class="header" href="#example-configuration-3">Example Configuration 3</a></h3>
<p>I, supervisor_can_enabled,                 1        # CAN Supervisor interface is enabled</p>
<p>I, supervisor_can_nodeid_arr[0],           20       # Node ID 20 will be used for configurations at index 0</p>
<p>I, supervisor_can_nodeid_mode_arr[0],      1        # For node id (20), Navitrol will transmit TPDOs (node id + [0x180, 0x280, 0x380, 0x480])</p>
<p>I, supervisor_can_tx1_typeid_arr[0],       201      # Navitrol transmits message with Type ID 201 on PDO id (20 + 0x180)</p>
<p>I, supervisor_can_tx2_typeid_arr[0],       202      # Navitrol transmits message with Type ID 202 on PDO id (20 + 0x280)</p>
<p>I, supervisor_can_rx1_typeid_arr[0],       101      # Navitrol expects message with Type ID 101 on PDO id (20 + 0x200)</p>
<p>I, supervisor_can_rx2_typeid_arr[0],       102      # Navitrol expects message with Type ID 102 on PDO id (20 + 0x300)</p>
<p>I, supervisor_can_nodeid_arr[1],           21       # Node ID 21 will be used for configurations at index 1</p>
<p>I, supervisor_can_nodeid_mode_arr[1],      1        # For node id (21), Navitrol will transmit TPDOs (node id + [0x180, 0x280, 0x380, 0x480])</p>
<p>I, supervisor_can_tx1_typeid_arr[1],       203      # Navitrol transmits message with Type ID 203 on PDO id (21 + 0x180)</p>
<p>I, supervisor_can_tx2_typeid_arr[1],       204      # Navitrol transmits message with Type ID 204 on PDO id (21 + 0x280)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ethercat-communication"><a class="header" href="#ethercat-communication">EtherCAT Communication</a></h1>
<p>Updated 15.03.2024</p>
<hr />
<h2 id="overview-8"><a class="header" href="#overview-8">Overview</a></h2>
<h3 id="introduction-6"><a class="header" href="#introduction-6">Introduction</a></h3>
<p>EtherCAT is one of the control interfaces supported by Navitrol. It can be used for controlling different devices e.g. motor controllers, encoders, etc.</p>
<p>EtherCAT is a high-performance, low-cost, easy to use Industrial Ethernet communication technology with flexible topology.
It is used for real-time master-slave communication between controllers and field devices.</p>
<p>For the AGV system an IPC with Navitrol is the master of the bus and all the field devices (motor controllers, encoders e.g.) are slaves.</p>
<h3 id="requirements-3"><a class="header" href="#requirements-3">Requirements</a></h3>
<ul>
<li>Not all the EtherCAT devices are supported by Navitrol. <a href="AgvInterfaces/GenericInterfaces/EthercatCommunication/../../SupportedDevices/SupportedDevices-en.html">Supported devices</a> list should be consulted to check if some specific device is supported.</li>
<li>At least one of the Ethernet port of the IPC should be reserved for EtherCAT communication</li>
<li>EtherCAT interface is supported by the Navitrol starting from version 6.40.00</li>
</ul>
<h3 id="limitations"><a class="header" href="#limitations">Limitations</a></h3>
<ul>
<li>At the moment, it is not possible to use CAN and EtherCAT together.</li>
<li>The feature is available only for position control systems.</li>
</ul>
<h2 id="operational-principles"><a class="header" href="#operational-principles">Operational principles</a></h2>
<h3 id="ethercat-bus-topology"><a class="header" href="#ethercat-bus-topology">EtherCAT bus topology</a></h3>
<p>A Typical EtherCAT device has two or more communication ports.
This allows to combine devices on a bus into different topologies.</p>
<p>EtherCAT provides great flexibility in terms of topologies. At least, these are supported:</p>
<ul>
<li>Line</li>
<li>Tree</li>
<li>Star</li>
<li>Drop line</li>
<li>Ring</li>
</ul>
<p>Also, a combination of different topologies (e.g. line + drop line) is supported, as it shown on the figure bellow.</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthercatCommunication/./media-en/Topologies.png" alt="" /></p>
<blockquote>
<p>Available topologies in EtherCAT.</p>
</blockquote>
<p>From the reliability point of view it is recommended to use a ring topology since it allows cable redundancy.
For instance, if some cable between two slaves is broken or cut, communication with all the devices would be still possible.
Note that in such a case, two Ethernet ports of the master device will be used.</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthercatCommunication/./media-en/Redundancy.png" alt="" /></p>
<blockquote>
<p>Cable redundancy in EtherCAT.</p>
</blockquote>
<h3 id="cable-selection"><a class="header" href="#cable-selection">Cable selection</a></h3>
<p>EtherCAT supports standard cables used for Ethernet connections.
The following cable types are supported:</p>
<ul>
<li>100 BASE-TX (copper cable up to 100 m between 2 nodes). In practice, it is typically a standard patch-cord.</li>
<li>100 BASE-FX (fiber optics).</li>
</ul>
<p>Typically, EtherCAT devices are having RJ45 8p8c connector. However, some of the devices can have some alternative connectors (e.g. M12 or some proprietary connector. This should be noted when ordering cables for the EtherCAT bus.</p>
<h3 id="connection-to-the-ipc"><a class="header" href="#connection-to-the-ipc">Connection to the IPC</a></h3>
<p>Standard IPC for Navitrol has two Ethernet ports (RJ45, 8p8c). Both of them can be used for EtherCAT communication.</p>
<p>Note that it is not recommended to connect  EtherCAT bus through the switch (to bridge master and bus segment). It can cause issues and extra delays not only with EtherCAT communication, but also with Ethernet communication through this port.
Therefore, it is recommended to connect EtherCAT devices directly to the IPC Ethernet port.</p>
<h3 id="addressing"><a class="header" href="#addressing">Addressing</a></h3>
<p>In EtherCAT network, master automatically assign addresses. Therefore, there is no need for manual address configuration.</p>
<p>Navitrol (inside IPC) assign addresses the following rules:</p>
<ul>
<li>Slave address starts from 1.</li>
<li>Slave address of a field device is done by <em>physical position</em> in the network</li>
<li>Slave address is auto-incremented.</li>
</ul>
<p><strong>Note: all slaves on the bus should have unique slave addresses.</strong></p>
<p>In practice, it means that all EtherCAT slaves are addressed starting from master using the auto-increment procedure in ongoing direction. So the closest device on the bus to master will have address 1, the next device will have address 2 and so on.</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthercatCommunication/./media-en/Simple_addressing_example.png" alt="" /></p>
<blockquote>
<p>Simple addressing example.</p>
</blockquote>
<h4 id="advanced-addressing"><a class="header" href="#advanced-addressing">Advanced addressing</a></h4>
<p>Addressing should be straight-forward in case if devices have only two Ethernet ports.
In some cases, it might be hard to define ongoing direction where address will be auto-incremented. For instance, if several different topologies are mixed together.</p>
<p>In such a case, it can be done in two ways:</p>
<ol>
<li>
<p>Theoretical way.</p>
<p>Every EtherCAT devices have up to 4 communication ports. Data in every device is processed in the following way: it is received from the previous device to the input port (port 0). After that, data for the device itself is inserted and the address is incremented. Then, if exists, data goes to the port 3 and all the devices connected to port 3 will be addresses. The same happens after that with the port 1 if exists. Finally, data goes to the output port and devices connected to it will be addressed.</p>
<p><img src="AgvInterfaces/GenericInterfaces/EthercatCommunication/./media-en/Advanced_addressing_example.png" alt="" /></p>
<blockquote>
<p>Advanced addressing example.</p>
</blockquote>
</li>
<li>
<p>Practical way</p>
<p>This option will show position and the device type in the bus. The only limitation is that it will not distinguish two devices of the same type between each other.</p>
<p>2.1 Power the devices and set up basic EtherCAT communication parameters.</p>
<p>2.2 Connect EtherCAT bus to Navitrol and start Navitrol</p>
<p>2.3 Wait for 20 seconds and take log</p>
<p>2.4 Open the log and search &quot;slave(s) found on the bus&quot;.</p>
<p>It will list all the device types on the bus and print addresses.</p>
</li>
</ol>
<h2 id="set-up"><a class="header" href="#set-up">Set up</a></h2>
<p>The following steps should be done in process of commissioning:</p>
<ol>
<li>
<p>Physical connection</p>
</li>
<li>
<p>Setting up the device</p>
</li>
<li>
<p>Changing parameters</p>
</li>
</ol>
<h3 id="physical-connection"><a class="header" href="#physical-connection">Physical connection</a></h3>
<p>Wiring is the first step in establishing the EtherCAT bus. All devices are connected together with a standard Ethernet cables.
Wiring is recommended to start from the IPC. Slave devices should be connected directly to those ports.</p>
<p>Additionally, make sure that devices on the bus are powered prior to the operation and wired according to the manufacturer's instructions.</p>
<h3 id="setting-up-the-device"><a class="header" href="#setting-up-the-device">Setting up the device</a></h3>
<p>Some devices might require additional settings before start operating with Navitrol. For instance, motor controllers typically require some additional setting, such as PID controller tuning. For setting up such devices, refer to the device-specific document.</p>
<p>However, some of the devices are configured automatically by Navitrol when connected.</p>
<h3 id="basic-setup-of-navitrol"><a class="header" href="#basic-setup-of-navitrol">Basic setup of Navitrol</a></h3>
<p>Parameter set depends on the project. Therefore, in this document, only generic parameters for establishing the communication will be described.</p>
<p>Depending on the topology, <strong>ethercat_mode</strong> parameter should be set.
In case of ring topology when both ports of the IPC are utilized, master redundant mode should be selected. Additionally, <strong>ethercat_inte_redundant</strong> interface should be set in addition to <strong>ethercat_inte_primary</strong>.
In other topologies (when only one port of the IPC is used), master single mode should be selected. Additionally, <strong>ethercat_inte_primary</strong> should be set.</p>
<p>The other parameters (e.g. slave addresses) can be found in the device-specific documents. For instance, kinematic type related parameters (specifying slave addresses of motor controllers) can be found in motor controller specific document (e.g. for <a href="AgvInterfaces/GenericInterfaces/EthercatCommunication/../../MotorControllers/Synapticon/SynapticonMotorController-en.html">Synapticon motor controller</a>).</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default</th><th>Information</th></tr></thead><tbody>
<tr><td>ethercat_enabled</td><td>Int</td><td>0</td><td>Enables EtherCAT communication</td></tr>
<tr><td>ethercat_mode</td><td>Int</td><td>0</td><td>EtherCAT mode, 0 - Master single, 1 - Master redundant</td></tr>
<tr><td>ethercat_inte_primary</td><td>String</td><td></td><td>Name of primary Ethernet interface used for EtherCAT communication</td></tr>
<tr><td>ethercat_inte_redundant</td><td>String</td><td></td><td>Name of redundant Ethernet interface used for EtherCAT communication</td></tr>
</tbody></table>
<pre><code># Example parameters for ring topology

I,ethercat_enabled,                1 #
I,ethercat_mode,                   1 #
S,ethercat_inte_primary,        eth0 #
S,ethercat_inte_redundant,      eth1 #

</code></pre>
<pre><code># Example parameters for other topologies

I,ethercat_enabled,                1 #
I,ethercat_mode,                   0 #
S,ethercat_inte_primary,        eth0 #
</code></pre>
<h2 id="troubleshooting-6"><a class="header" href="#troubleshooting-6">Troubleshooting</a></h2>
<p>Navitrol itself can detect most of the issues, such as:</p>
<ul>
<li>some EtherCAT related configuration issues (e.g. parameter issue)</li>
<li>some device missing from the bus</li>
<li>a device is located on the wrong place on the bus.</li>
</ul>
<p>It is advised in all the cases to check not only active errors, but also terminal. Typically, some important additional information is printed to the terminal in case of error.</p>
<h3 id="most-common-mistakes"><a class="header" href="#most-common-mistakes">Most common mistakes</a></h3>
<h4 id="ethercat-start-up-fails"><a class="header" href="#ethercat-start-up-fails">EtherCAT start up fails</a></h4>
<p>Typically, it can be explained by one of the following reasons:</p>
<ul>
<li>Device is defined in parameter file but not connected to the bus</li>
<li>Device address defined in parameters is not correct. If some wrong device type is located in a position specified in the parameter file, it will also prevent EtherCAT from starting up</li>
<li>Device address is duplicated in the parameters.</li>
</ul>
<p>In all the above-mentioned cases, it is recommended to open Linux terminal and check Navitrol prints from there. Bellow, there are the instructions on how to detect the problem and recover from it.</p>
<h5 id="device-not-connected-to-the-bus"><a class="header" href="#device-not-connected-to-the-bus">Device not connected to the bus</a></h5>
<p><em>Active errors</em>: ERROR_ETHERCAT_NO_COMMS, ERROR_ETHERCAT_HIGH_DT and ERROR_ETHERCAT_DEVICE_NOT_FOUND</p>
<p><em>Terminal error logging example</em>:</p>
<pre><code>EC: 1 Ethercat slave(s) not found. Registered slaves 2, devices on the bus 1. Not enough devices on the bus
EC: Slave 2 name SOMANET registered but not found on the bus
</code></pre>
<p><em>How to recover</em>: Check if missing device is powered and connected to the bus</p>
<h5 id="incorrect-device-address"><a class="header" href="#incorrect-device-address">Incorrect device address</a></h5>
<p><em>Active errors</em>: ERROR_ETHERCAT_NO_COMMS, ERROR_ETHERCAT_HIGH_DT and ERROR_ETHERCAT_DEVICE_NOT_FOUND</p>
<p><em>Terminal error logging example</em>:</p>
<pre><code>EC: 1 Ethercat slave(s) not found. Registered slaves 2, devices on the bus 2.
EC: Slave 3 name SOMANET registered but not found on the bus
</code></pre>
<p><em>How to recover</em>: Check parameters related to the EtherCAT address for mentioned device. Calculate its position on the bus (see &quot;Addressing&quot; chapter) and correct the parameter or position.</p>
<h4 id="wrong-device-at-some-address"><a class="header" href="#wrong-device-at-some-address">Wrong device at some address</a></h4>
<p><em>Active errors</em>: ERROR_ETHERCAT_NO_COMMS, ERROR_ETHERCAT_HIGH_DT and ERROR_ETHERCAT_DEVICE_NOT_FOUND</p>
<p><em>Terminal error logging example</em>:</p>
<pre><code>EC: CheckSlaves - slave 1 name mismatch, on the bus EK1100, registered SOMANET
EC: 1 Ethercat slave(s) not found. Registered slaves 2, devices on the bus 10.
EC: Slave 1 name SOMANET registered but not found on the bus
</code></pre>
<p><em>How to recover</em>:  Check parameters related to the EtherCAT address for mentioned devices. Calculate it's position on the bus  (see &quot;Addressing&quot; chapter) and correct the parameter or position.</p>
<h4 id="slave-address-duplication"><a class="header" href="#slave-address-duplication">Slave address duplication</a></h4>
<p><em>Active errors</em>: ERROR_ETHERCAT_NO_COMMS, ERROR_ETHERCAT_HIGH_DT and ERROR_ETHERCAT_CONFIG</p>
<p><em>Terminal error logging example</em>:</p>
<pre><code>EC: Ethercat_RegisterSlaveInfo - attempt to double register slave address 1. Check parameters
</code></pre>
<p><em>How to recover</em>: Check parameters related to the EtherCAT address. Several devices have the same address on the bus. Correct parameters.</p>
<h3 id="errors-and-warnings-3"><a class="header" href="#errors-and-warnings-3">Errors and warnings</a></h3>
<p>Navitrol communication related errors are listed below, with additional troubleshooting information.</p>
<p>Note that ERROR_ETHERCAT_HIGH_DT and ERROR_ETHERCAT_NO_COMMS might be a cause of ERROR_ETHERCAT_CONFIG or ERROR_ETHERCAT_DEVICE_NOT_FOUND.</p>
<h4 id="840-error_ethercat_no_comms"><a class="header" href="#840-error_ethercat_no_comms">840 ERROR_ETHERCAT_NO_COMMS</a></h4>
<p>Description: Navitrol has no connection to at least one EtherCAT slave (or no valid data has been received) for 100 ms.</p>
<p>Error level: Error</p>
<p>Error reason: Navitrol has not been able to initialize/configure EtherCAT properly, or slaves at run time are not working as expected.</p>
<p>How to recover:</p>
<ul>
<li>
<p>Check that EtherCAT parameters (ethercat_mode, ethercat_inte_primary, ethercat_inte_redundant) are defined correctly in params.txt</p>
</li>
<li>
<p>Check that EtherCAT bus is physically connected to defined interface(s)</p>
</li>
<li>
<p>Check that all EtherCAT hardware and slaves are properly connected and powered</p>
</li>
</ul>
<h4 id="843-error_ethercat_config"><a class="header" href="#843-error_ethercat_config">843 ERROR_ETHERCAT_CONFIG</a></h4>
<p>Description: Error during Ethercat slave configuration.</p>
<p>Error level: Error</p>
<p>Error reason: Ethercat slave configuration failed. Ethercat HW and slaves might not be properly connected or powered.</p>
<p>How to recover: Check the log for more details. Contact Navitec support.</p>
<h4 id="844-error_ethercat_high_dt"><a class="header" href="#844-error_ethercat_high_dt">844 ERROR_ETHERCAT_HIGH_DT</a></h4>
<p>Description: Update interval from vehicle interface to EtherCAT is too high (over <strong>control_interval_us</strong> * <strong>control_interval_error_ratio</strong>)</p>
<p>Error level: Error</p>
<p>Error reason: Vehicle interface is not responding to EtherCAT. In most cases, this error is caused by some other Ethercat error or issue with initialization of AGV. Might be caused by CPU overload of the IPC.</p>
<p>How to recover: Check the log or terminal for more details. Contact Navitec support.</p>
<h4 id="847-error_ethercat_device_not_found"><a class="header" href="#847-error_ethercat_device_not_found">847 ERROR_ETHERCAT_DEVICE_NOT_FOUND</a></h4>
<p>Description: At least one EtherCAT slave device is not found on the bus</p>
<p>Error level: Error</p>
<p>Error reason: Some of the devices expected by Navitrol are missing from the bus.</p>
<p>How to recover: Check the log or terminal for more details. Check that all devices are powered and connected to the bus. Check Navitrol parameters. Contact Navitec support.</p>
<h3 id="advanced-troubleshooting-1"><a class="header" href="#advanced-troubleshooting-1">Advanced troubleshooting</a></h3>
<p>Navitrol always logs some amount of events related to EtherCAT communication and EtherCAT related issues. Additional information logging might be enabled by the parameters mentioned below. These settings increase the amount of logged data and should not be used without a reason. Increased logging level might be needed only in cases when some issues with communication are present.</p>
<p><strong>EtherCAT advanced parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default</th><th>Information</th></tr></thead><tbody>
<tr><td>log_ethercat</td><td>Int</td><td>0</td><td>Log EtherCAT communication details, 0 - min level ... 3 - max amount of details</td></tr>
</tbody></table>
<p>All the EtherCAT related logging can be found by searching &quot;EC:&quot; in the Navitrol text log.</p>
<p><strong>The sequence for establishing communication with the EtherCAT devices is described below:</strong></p>
<ol>
<li>Registration of the devices
Navitrol reads parameter file and checks machine type to determine EtherCAT devices expected to be on the bus (device name, address, configurations etc.).</li>
</ol>
<p><em>Logging example</em>:</p>
<pre><code>EC: Ethercat_RegisterSlave - slave 2 successfully registered, nbrODO 33, parseFuncExist 1, buildFuncExist 1
EC: Ethercat_RegisterSlave - slave 1 successfully registered, nbrODO 33, parseFuncExist 1, buildFuncExist 1
EC: Object registration finished
</code></pre>
<ol start="2">
<li>Initialization of the interface (opening socket)</li>
</ol>
<p>Navitrol reads basic EtherCAT parameters and initializes the communication on specified interfaces.</p>
<p><em>Logging example</em>:</p>
<pre><code>EC: ec_init on eth0 eth1 succeeded
</code></pre>
<ol start="3">
<li>Slave checks:</li>
</ol>
<p>Navitrol reads information from the bus and checks if bus configuration matches to the list of registered devices.</p>
<p>At least, the following checks are performed:</p>
<ul>
<li>What number of devices is on the bus?</li>
<li>Is the number of registered devices corresponds to the number of devices on the bus?</li>
<li>Is registered device types are on correct positions?</li>
</ul>
<p><em>Note that Navitrol is able to perform checks only for device types. It cannot distinguish two devices of the same type switched together on the bus. For instance, from the bus configuration, it cannot indicate that left and right motor controllers in diff drives are swapped together. It is only possible to detect that devices of the same type swapped together during the further steps in commissioning of the AGV (e.g. by test-driving)</em></p>
<p><em>Logging example</em>:</p>
<pre><code>EC: 2 slave(s) found on the bus
EC: On the bus - slave 1, name SOMANET, Vendor:product 22d2h:201h
EC: On the bus - slave 2, name SOMANET, Vendor:product 22d2h:201h
EC: Registered - slave 1, name SOMANET
EC: Registered - slave 2, name SOMANET
EC: CheckSlaves - slave 1 found, name SOMANET
EC: CheckSlaves - slave 2 found, name SOMANET
EC: All registered Ethercat slaves found successfully
</code></pre>
<ol start="4">
<li>Configuring slave devices</li>
</ol>
<p>Navitrol configures found devices (if needed) by sending SDOs to them.</p>
<p><em>Logging example</em>:</p>
<pre><code>EC: PRE_OP state reached for all slaves.
EC: SDO wr OK. Slave 2 idx 0x1016, subIdx 0x1, size 4, data 8C 00 00 00, dataOk 1, wkc 1
.....
EC: Slave configuration success
</code></pre>
<ol start="5">
<li>Putting devices to operational state</li>
</ol>
<p>Navitrol switches all the devices to the operational state prior to communication</p>
<p><em>Logging example</em>:</p>
<pre><code>EC: Request operational state for all slaves
OPERATIONAL state reached for all slaves
</code></pre>
<ol start="6">
<li>Start communication</li>
</ol>
<p>After successful start-up, Navitrol starts communication. Short after that, ERROR_ETHERCAT_NO_COMMS and ERROR_ETHERCAT_HIGH_DT should be reset.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="simove-communication-interface"><a class="header" href="#simove-communication-interface">SIMOVE communication interface</a></h1>
<p>Updated 13.06.2024</p>
<hr />
<h2 id="overview-9"><a class="header" href="#overview-9">Overview</a></h2>
<h3 id="introduction-7"><a class="header" href="#introduction-7">Introduction</a></h3>
<p>SIMOVE is Siemens modular software platform for mobile robots. Navitrol is the navigation module in the system and communicates to onboard PLC/device via the interface specified by SIMOVE. The interface is kinematic free, thus the PLC/device onboard controls the motor controllers of the AGV. This document describes how to setup Navitrol. Contact Siemens about the details of the interface.</p>
<h3 id="limitations-1"><a class="header" href="#limitations-1">Limitations</a></h3>
<p>The communication interface specifies only drive control between Navitrol and the PLC/device onboard the AGV. Actuator control and status of the AGV shall be communicated using some other interface, for example <a href="AgvInterfaces/GenericInterfaces/Simove/../EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet supervisor communication interface</a>.</p>
<hr />
<h2 id="setup-5"><a class="header" href="#setup-5">Setup</a></h2>
<p>Please note that even though the interface is kinematic free, the kinematics of the AGV affect how the AGV can be controlled. For example differential and steer drive AGVs are limited to be using only longitudinal component of the velocity vector. The communication parameters should be set according to the SIMOVE system setup.</p>
<p><strong>Kinematic parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>kinematic_free_limited_driving</td><td>Int</td><td>0</td><td>AGV with kinematic free interface has driving limitations: 0 = None, 1 = Speed vector restricted to longitudinal only (nonholonomic). Software restart needed after change.</td></tr>
</tbody></table>
<p><strong>Communication parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>simove_navigation_port_in</td><td>Int</td><td>4001</td><td>Navigation SW inbound data TCP/IP (UDP) port for SIMOVE navigation interface</td></tr>
<tr><td>simove_navigation_port_out</td><td>Int</td><td>12345</td><td>Navigation SW outbound data TCP/IP (UDP) port for SIMOVE navigation interface</td></tr>
<tr><td>simove_navigation_ip</td><td>String</td><td>0.0.0.0</td><td>IP address for SIMOVE navigation interface of the PLC / device onboard the AGV</td></tr>
<tr><td>simove_navigation_endianess</td><td>Int</td><td>1</td><td>Endianess for SIMOVE navigation interface: 0 = little endian, 1 = big endian</td></tr>
<tr><td>simove_velocity_xy_norm</td><td>Float</td><td>160.0</td><td>Normalizing factor for velocity vector's Vx and Vy in SIMOVE interface</td></tr>
<tr><td>simove_velocity_angular_norm</td><td>Float</td><td>0.017453</td><td>Normalizing factor for angular velocity in SIMOVE interface (default PI/180)</td></tr>
</tbody></table>
<hr />
<h2 id="troubleshooting-7"><a class="header" href="#troubleshooting-7">Troubleshooting</a></h2>
<h3 id="errors-and-warnings-4"><a class="header" href="#errors-and-warnings-4">Errors and warnings</a></h3>
<h4 id="858---error_simove_nav_no_comms"><a class="header" href="#858---error_simove_nav_no_comms">858 - ERROR_SIMOVE_NAV_NO_COMMS</a></h4>
<p>There is no communication to the navigation interface or it is too long since a valid received message.
Verify that the communication parameters are correct and that the data sent to Navitrol is valid (header information, message length)</p>
<h3 id="advanced-troubleshooting-2"><a class="header" href="#advanced-troubleshooting-2">Advanced troubleshooting</a></h3>
<p>Logging in Navitrol's text log (log.txt) has a prefix &quot;SIMOVE:&quot;.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="motor-control-interfaces-and-setup"><a class="header" href="#motor-control-interfaces-and-setup">Motor control interfaces and setup</a></h1>
<p>Updated 16.05.2024</p>
<ul>
<li><a href="AgvInterfaces/MotorControllers/./MotorControllersCommon/MotorControllersCommon-en.html">Motor controller common</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Schwarzmueller/SchwarzmuellerSetupInstructions/SchwarzmuellerSetupInstructions-en.html">Schwarzmueller setup</a>
<ul>
<li><a href="AgvInterfaces/MotorControllers/./Schwarzmueller/SchwarzmuellerParameterSetupInstructions/SchwarzmuellerParameterSetupInstructions-en.html">Schwarzmueller parameters</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Schwarzmueller/SchwarzmuellerTroubleshooting/SchwarzmuellerTroubleshooting-en.html">Schwarzmueller troubleshooting</a></li>
</ul>
</li>
<li><a href="AgvInterfaces/MotorControllers/./Curtis/CurtisMotorController-en.html">Curtis</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Engel/EngelMotorController-en.html">Engel</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Nanotec/NanotecMotorController-en.html">Nanotec</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Oriental/OrientalMotorController-en.html">Oriental</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Synapticon/SynapticonMotorController-en.html">Synapticon</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Roboteq/RoboteqOpenLoopControllerConfiguration-en.html">Roboteq Open loop</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Roboteq/RoboteqClosedLoopControllerConfiguration-en.html">Roboteq Closed loop</a></li>
<li><a href="AgvInterfaces/MotorControllers/./MiControl/MiControlMotorController-en.html">MiControl</a></li>
<li><a href="AgvInterfaces/MotorControllers/./Kinco/KincoMotorController-en.html">Kinco</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="motor-controllers-common"><a class="header" href="#motor-controllers-common">Motor controllers common</a></h1>
<p>Updated 11.07.2024</p>
<hr />
<h2 id="overview-10"><a class="header" href="#overview-10">Overview</a></h2>
<p>This document describes usage and set up of motor controllers in Navitrol.
The document should be used for setting up the motor controller in Navitrol.</p>
<p>In this document, only common parameter and troubleshooting steps are explained.<br />
The first setup steps are explained in Motor controller specific documentation that is available for every supported motor controller (for instance, instruction for <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../Synapticon/SynapticonMotorController-en.html">Synapticon motor controller</a>).</p>
<h3 id="introduction-8"><a class="header" href="#introduction-8">Introduction</a></h3>
<p>A motor controller is a device that can coordinate in a predetermined manner the performance of an electric motor. In Navitrol, a motor controller can be used to control:</p>
<ul>
<li>driving motor</li>
<li>steering motor</li>
<li>actuator motor</li>
</ul>
<p>The required number and type of motors depends on the kinematic type of the AGV and installed actuators.<br />
In case of diff kinematics, Navitrol expects to have two driving motors. Typically, those motors should be identical and installed symmetrically.<br />
In case of steer kinematics, Navitrol expects to have one driving motor and one steering motor.<br />
In case of mecanum kinematics, Navitrol expects to have four driving motors. Typically, those motors should be identical and installed symmetrically.<br />
In case of omni kinematics, Navitrol expects to have typically at least two driving motors and at least two steering motors. The number of steering wheels is set in Navitrol parameters. It is supported to have some wheels that would perform only steering without driving.<br />
Please note that steering motor typically should have also an absolute encoder that connects to the same bus as the motor controller.</p>
<p>The required number of motor controllers depends on amount of motors and the number of channels in the selected motor controllers.<br />
Typically, motor controllers are single-channel. That means that only one motor can be connected to each motor controller. Most of the supported motor controllers are single-channel, for instance, Schwarzmueller, Engel, MiControl, Oriental, Synapticon. Check <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../../SupportedDevices/SupportedDevices-en.html">List of supported devices</a> to see all the supported motor controllers.
Some motor controllers have two channels, which makes it possible to control two motors with one motor controller. For instance, Curtis and Roboteq have two channeled models.<br />
Few motor controllers, such as some Curtins models, have three channels. Those motor controllers can be used, for instance, as all-in-one solution for automating steer or diff AGV with actuator using just one motor controller.</p>
<h3 id="requirements-4"><a class="header" href="#requirements-4">Requirements</a></h3>
<p>For setting up the motor controller in Navitrol, it is required that:</p>
<ul>
<li>Motor controller - motor connection established
<ul>
<li>All electrical connections are done</li>
<li>Motor parameters have been set to the motor controllers</li>
<li>See Motor controller specific documentation for connection setup instructions (for instance, instruction for <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../Synapticon/SynapticonMotorController-en.html">Synapticon motor controller</a>)</li>
</ul>
</li>
<li>Interface bus (CAN or EtherCAT) has been wired and connected to the motor controller</li>
<li>Basic interface parameters (for CAN or EtherCAT) are set correctly. Instructions for wiring and basic parameters are described in <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> or <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../../GenericInterfaces/EthercatCommunication/EthercatCommunication-en.html">Ethercat communication</a> document.</li>
</ul>
<h3 id="limitations-2"><a class="header" href="#limitations-2">Limitations</a></h3>
<p>Functionality is limited to motor controllers that are controlled by Navitrol. Only specific motor controller and AGV kinematic combinations are supported. See, <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../../SupportedDevices/SupportedDevices-en.html">List of supported devices</a>.</p>
<p>Navitrol motor control is not supported for positioning only systems</p>
<hr />
<h2 id="setup-6"><a class="header" href="#setup-6">Setup</a></h2>
<p>The first setup steps are explained in Motor controller specific documentation.
In this document, only common parameters are explained.</p>
<h3 id="quick-start-2"><a class="header" href="#quick-start-2">Quick start</a></h3>
<p>For setting up the motor controller to work with Navitrol, communication parameters (motor controller addresses) should be used.
Those parameters differ for EtherCAT and CAN motor controllers.</p>
<p><strong>CAN Node Id parameters for motor controllers</strong></p>
<table><thead><tr><th><strong>Name</strong></th><th><strong>Type</strong></th><th><strong>Default value</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td><strong>Differential AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_diff_drive_left_nodeid</td><td>Int</td><td>30</td><td>Node id for diff drive left motor controller</td></tr>
<tr><td>can_diff_drive_right_nodeid</td><td>Int</td><td>31</td><td>Node id for diff drive right motor controller</td></tr>
<tr><td><strong>Steer AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_steer_drive_steering_nodeid</td><td>Int</td><td>30</td><td>Node id for steer drive steering controller</td></tr>
<tr><td>can_steer_drive_driving_nodeid</td><td>Int</td><td>31</td><td>Node id for diff drive driving controller</td></tr>
<tr><td><strong>Omni AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_omni_steer_ctrl_nodeid[]</td><td>Int</td><td>0</td><td>Node id for omni steering controller (array index - wheel index). 0 - disabled</td></tr>
<tr><td>can_omni_drive_ctrl_nodeid[]</td><td>Int</td><td>0</td><td>Node id for omni driving controller (array index - wheel number). 0 - disabled</td></tr>
<tr><td><strong>Mecanum AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>mot_ctrl_mecanum_nodeid[]</td><td>Int</td><td>0</td><td>CANopen NodeId. 0 - not defined, Indexes are 0 = FF (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right)</td></tr>
<tr><td><strong>Differential sub-unit</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_diffunit_left_nodeid[]</td><td>Int</td><td>0</td><td>CANOpen Node ID for diffunit left motor controllers. Array index: omni = wheel index, steer = 0.</td></tr>
<tr><td>can_diffunit_right_nodeid[]</td><td>Int</td><td>0</td><td>CANOpen Node ID for diffunit right motor controllers. Array index: omni = wheel index, steer = 0.</td></tr>
</tbody></table>
<p><em>Note: this table is not applicable for Roboteq motor controller. Check <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">Roboteq Motor Controller Configuration</a> document.</em></p>
<p><strong>EtherCAT address parameters for motor controllers</strong></p>
<table><thead><tr><th><strong>Name</strong></th><th><strong>Type</strong></th><th><strong>Default value</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td><strong>Differential AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>ethercat_diff_drive_left_ctrl_addr</td><td>Int</td><td>1</td><td>Physical EtherCAT address of diff drive left motor controller</td></tr>
<tr><td>ethercat_diff_drive_right_ctrl_addr</td><td>Int</td><td>2</td><td>Physical EtherCAT address of diff drive right motor controller</td></tr>
<tr><td><strong>Omni AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>ethercat_omni_steer_ctrl_addr[]</td><td>Int</td><td>0</td><td>Physical EtherCAT address for omni steering controller (array index - wheel index). 0 = disabled</td></tr>
<tr><td>ethercat_omni_drive_ctrl_addr[]</td><td>Int</td><td>0</td><td>Physical EtherCAT address for omni driving controller (array index - wheel index). 0 = disabled</td></tr>
<tr><td><strong>Mecanum AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>ethercat_mot_ctrl_mecanum_ctrl_addr[]</td><td>Int</td><td>0</td><td>Physical EtherCAT address for mecanum motor controllers. 0 - not defined. Indexes are 0 = FL (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right)</td></tr>
</tbody></table>
<p><strong>Motor controller automatic disabling</strong></p>
<p>In order to reduce energy consumption, Navitrol can disable drives when AGV is not moving. This involves currently all motor controllers directly controlled by Navitrol. By default, this happens 1 second after AGV has stopped moving and brakes have been activated. This feature can be configured by parameter <strong>mot_ctrl_disable_delay_ms</strong>, see table below for details.</p>
<table><thead><tr><th><strong>Name</strong></th><th><strong>Type</strong></th><th><strong>Default value</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td>mot_ctrl_disable_delay_ms</td><td>Int</td><td>1000</td><td>Motor controller disabling delay [ms] after activating brakes: -1 = never disable, 0 = no delay</td></tr>
</tbody></table>
<p><strong>NOTE</strong>: This feature is supported currently with the following motor controllers: Schwarzmueller, Curtis, Oriental, Kinco, MiControl, Synapticon and Roboteq (closed loop).</p>
<hr />
<h2 id="how-to-use-3"><a class="header" href="#how-to-use-3">How to use</a></h2>
<p>After successful setup, it is possible to drive and steer the AGV using the motor controllers (for instance, in manual mode using keyboard control).</p>
<p>After successful, AGV should be calibrated according to <a href="AgvInterfaces/MotorControllers/MotorControllersCommon/../../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial Calibration Guide</a>.</p>
<h3 id="motor-controller-test-form"><a class="header" href="#motor-controller-test-form">Motor controller test form</a></h3>
<p>For most of the motor controllers, it is possible to manually set the outputs to the motor controllers.<br />
This feature is useful during calibration, for instance, to tune the steering PID controller or PID for driving controllers. The benefit is that step response can be sent from this form.</p>
<p>This form is available for all the motor controllers <strong>except</strong> the following:</p>
<ul>
<li>Roboteq</li>
<li>Nanotec</li>
<li>Syntron</li>
</ul>
<p>The form can be opened from the &quot;Navitrol&quot; menu located in the top bar of Navitrol Monitor. The form is shown in figure below.</p>
<p><img src="AgvInterfaces/MotorControllers/MotorControllersCommon/./media-en/Motor_controller_form.png" alt="" /></p>
<blockquote>
<p>Motor controller test form</p>
</blockquote>
<p>A command to be sent to a motor controller is prepared by following steps:</p>
<ul>
<li>Select motor controller type - steer/drive/actuator</li>
<li>Type the motor controller's Node ID.
Note: There is a special feature that is available for most motor controllers. When 255 is entered in Node ID field, all motor controllers of the selected type will receive the command.<br />
Note: Command is sent to the motor controller only when the correct combination of motor controller type and Node ID is selected.</li>
<li>Select output commands. Note that for every motor controller, different output commands are available and thus the form might look different.</li>
<li>Angle - available only for steering motor. </li>
<li>RPM - available for every motor. Note that when RPM is applied, the motor will start moving.</li>
<li>For some motor controllers, it is also possible to send proportional output and torque.</li>
</ul>
<p>The prepared command is sent when &quot;Send values&quot; button is pressed. It can be stopped either with pressing &quot;Stop sending&quot; or closing the form.</p>
<h4 id="motor-controller-test-form---differential-unit"><a class="header" href="#motor-controller-test-form---differential-unit">Motor controller test form - Differential unit</a></h4>
<p>When calibrating kinematics with differential units (Steer or Omni drive with differential unit), the user needs to verify that each differential unit is configured correctly.</p>
<p>The Differential unit's can be each separately tested that the unit turns to correct direction and that the speed inversions of the unit's are correct. The selected unit is visualized with a blue circle and the node ID:s of the selected unit are shown as well. After the user has selected a differential unit from the drop down menu, the desired angle or speed reference can be given the same way as for a single motor controller.</p>
<p><img src="AgvInterfaces/MotorControllers/MotorControllersCommon/./media-en/Motor_controller_form_diffunit.png" alt="" /></p>
<blockquote>
<p>Controlling individual differential units through Motor controller test form</p>
</blockquote>
<hr />
<h2 id="troubleshooting-8"><a class="header" href="#troubleshooting-8">Troubleshooting</a></h2>
<h3 id="errors-and-warnings-5"><a class="header" href="#errors-and-warnings-5">Errors and warnings</a></h3>
<h3 id="402-error_motor_control_fault"><a class="header" href="#402-error_motor_control_fault">402 ERROR_MOTOR_CONTROL_FAULT</a></h3>
<p>Description: Motor controller indicates fault</p>
<p>Error reason: Error comes from the motor controller.</p>
<p>How to recover: Check the error from the motor controller (for instance, using Linux terminal or from Navitrol log). Error code and error description should be printed there.</p>
<h3 id="809-error_agv_controller"><a class="header" href="#809-error_agv_controller">809 ERROR_AGV_CONTROLLER</a></h3>
<p>Description: AGV controller alarm</p>
<p>Error reason: AGV controller reports error to Navitrol</p>
<p>How to recover: Check the error from the motor controller (for instance, using Linux terminal or from Navitrol log). Error code and error description should be printed there. Navitrol tries to reset error automatically when the error is gone.</p>
<h3 id="advanced-troubleshooting-3"><a class="header" href="#advanced-troubleshooting-3">Advanced troubleshooting</a></h3>
<p><em>Following troubleshooting instructions are suitable for Engel, Oriental, MiControl, Curtis, Synapticon motor controllers</em>.</p>
<p><strong>Advanced troubleshooting parameter:</strong></p>
<table><thead><tr><th><strong>Name</strong></th><th><strong>Type</strong></th><th><strong>Default value</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td>log_motor_controllers</td><td>Int</td><td>0</td><td>Log motor controller details. 2 - Log all details</td></tr>
</tbody></table>
<p>In case if there are no CAN/EtherCAT errors present, but machine is not driving, try following:
Check if motor controller error is set (ERROR_MOTOR_CONTROL_FAULT and ERROR_AGV_CONTROLLER).
In case if error is set, check from the Linux terminal or log file which error is set and on which controller.
The keyword for search is: &quot;FindAndLogErrors&quot;.</p>
<p><strong>Other helpful log lines</strong></p>
<table><thead><tr><th><strong>Point of interest</strong></th><th><strong>Keyword</strong></th><th><strong>Additional information</strong></th></tr></thead><tbody>
<tr><td><strong>Navitrol inputs</strong></td><td></td><td></td></tr>
<tr><td>State of the motor controller</td><td>LogStatusWord</td><td>Visible when CAN communication is working</td></tr>
<tr><td>Speed + encoder data from each wheel</td><td>LogDataInForKinematics</td><td>Available only when <strong>log_motor_controller</strong> &gt; 1</td></tr>
<tr><td>Fault status on each motor controller</td><td>HandleFaults</td><td></td></tr>
<tr><td>Raw inputs</td><td>ParseRx</td><td></td></tr>
<tr><td><strong>Navitrol Outputs:</strong></td><td></td><td></td></tr>
<tr><td>Target speed for each controller</td><td>LogDataOutForKinematics</td><td>Available only when <strong>log_motor_controller</strong> &gt; 1</td></tr>
<tr><td>Processed state and outputs</td><td>LogControlData</td><td>Note that state of the AGV can be changed by Navitrol, so input state and output state are different. </br> It can mean that controller has fault or safe outputs or estop is active</td></tr>
<tr><td>Raw outputs</td><td>BuildTx</td><td></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="schwarzmueller-setup-instructions"><a class="header" href="#schwarzmueller-setup-instructions">Schwarzmueller Setup Instructions</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="basic-setup-instructions"><a class="header" href="#basic-setup-instructions">Basic Setup Instructions</a></h2>
<ul>
<li>
<p>Download service tool from <a href="https://www.danfoss.com/en/products/dps/software/software-and-tools/plus1-software/plus1-service-tool/#tab-overview">powersolutions.danfoss.com</a> and install the tool and drivers.</p>
</li>
<li>
<p>Connect the CG150 CAN-adapter to your computer and to the motor controller. <strong>Keep only one motor controller connected to the CAN at the same time during configuration</strong>.</p>
</li>
<li>
<p>Start the PLUS+1 service tool.</p>
</li>
<li>
<p>From the popup window choose the correct CAN-adapter and right channel.</p>
</li>
<li>
<p>See document Start up User Manual PLUS+1 Inverter Family V2.0 chapter 12 for more information.</p>
</li>
<li>
<p>Download the software <em>File-&gt;File Download...</em> e.g. 20014_STANDARD_CANOPEN_V100.lhx (see chapter 12.8.2 in manual).</p>
<ul>
<li>&quot;The selected file uses a different OS&quot; warning can be ignored</li>
</ul>
</li>
<li>
<p>Load the Service application <em>File-&gt;Scan for Service Application File...</em> e.g. 20014_Standard_CANopen_V100_01.p1d</p>
<ul>
<li>&quot;This Service Application file is not designed for the connected system&quot; warning can be ignored</li>
</ul>
</li>
<li>
<p>Service application let's user to modify the parameters of the device (see chapter 12.8.3 in manual).</p>
</li>
<li>
<p>Acquire parameter file (xml) for the motor from Navitec</p>
<ul>
<li>
<p>Node 31 is for drive or right motor</p>
</li>
<li>
<p>Node 30 is for steer or left motor</p>
</li>
</ul>
</li>
<li>
<p>The following are instructions for Navitec to generate parameter files for motors:</p>
<ul>
<li>
<p>Acquire csv file for motor specific parameters (provided by Schwarzmueller)</p>
</li>
<li>
<p>Open SchwarzmuellerParamGen</p>
</li>
<li>
<p>Drag &amp; drop the csv file into the program</p>
</li>
<li>
<p>Select controller from top left drop down menu</p>
</li>
<li>
<p>Enter ECU id of the controller as shown in System Navigator on the left, e.g. 255 as in:</p>
</li>
</ul>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerSetupInstructions/./media-en/image3.png" alt="" /></p>
<ul>
<li>
<p>Enter PI controller parameters (Kp, Ki, PartLoadReduc) as instructed by Schwarzmueller</p>
</li>
<li>
<p>Enter Acel &amp; Dcel limits, values are rpm/s, usually thousands and may need to be adjusted afterwards</p>
</li>
<li>
<p>Enter maximum rpm as calculated from maximum wheel velocity &amp; gear ratio</p>
</li>
<li>
<p>Enter encoder current range parameters (EE_MD_EncCurMax &amp; Min)</p>
<ul>
<li>
<p>If the encoders do not draw their power directly from the Schwarzmueller (5V), set the minimum current to 0,</p>
</li>
<li>
<p>Otherwise set the range according to encoder specifications</p>
</li>
</ul>
</li>
<li>
<p>Save</p>
</li>
<li>
<p>In PLUS+1, select &quot;All Parameters&quot; (bottom of the left tree view)</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerSetupInstructions/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 1: Select &quot;All Parameters&quot;</p>
</blockquote>
<ul>
<li>Import parameters (xml) for motor controller (Figure 1).</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerSetupInstructions/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 2: Parameter import.</p>
</blockquote>
<ul>
<li>
<p>If loading parameters fails because of wrong ECU id, rename all &quot;0,31&quot; values (&quot;0,30&quot; for steer/left motor) in the parameter xml to the ECU id shown in PLUS+1 in the ECU column in the Parameter List and import the parameters file again</p>
</li>
<li>
<p>Select <em>Parameter -&gt; Check all parameters for download</em></p>
</li>
<li>
<p>Download parameters to Device <em>Parameter-&gt;Download</em> (from laptop to Motor Controller).</p>
</li>
<li>
<p>Restart device (full power cycle) to enable parameter changes (do not change view in PLUS+1).</p>
</li>
<li>
<p>Repeat for the other motor controller by disconnecting the newly configured controller and connecting the other controller.</p>
<ul>
<li>
<p>It is also possible to have both controllers connected at the same time and switch the active controller but by having only one connected at the time is safer</p>
<ul>
<li>
<p>Each page in the &quot;System Navigator&quot; view can have different controller selected so use extra caution when switching between controllers</p>
</li>
<li>
<p>Controller of each page is changed by right clicking page header -&gt; Exchange existing ECU -&gt; click yes to switch</p>
</li>
<li>
<p>Hovering over log variables will show the ECU id that the variable is read from, again 0,31 for drive/right motor and 0,30 for steer/left motor</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="wiring-instructions"><a class="header" href="#wiring-instructions">Wiring Instructions</a></h2>
<ul>
<li>
<p>Connect pin 31(C1p31) to power + to enable CAN communication (Figure 3).</p>
</li>
<li>
<p>Connect pin 30 (C1p30) to power + to disable SafeStop (when SafeStop is ON connect to ground).</p>
</li>
<li>
<p>See chapter 12.6.1.1 for information about main contractor safety.</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerSetupInstructions/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 3: Diagnostics window.</p>
</blockquote>
<ul>
<li>Temperature sensor has to be connected to pins 34/35.</li>
</ul>
<h2 id="basic-diagnostics-with-plus1"><a class="header" href="#basic-diagnostics-with-plus1">Basic diagnostics with PLUS+1</a></h2>
<ul>
<li>To view feedback from Schwarzmueller in real time, select any log page in &quot;System Navigator&quot; and press the green play button on the toolbar to start real time display</li>
</ul>
<h3 id="safety-circuit"><a class="header" href="#safety-circuit">Safety Circuit</a></h3>
<ul>
<li>
<p>Click &quot;Automated Guided Vehicle&quot; in &quot;System Navigator&quot; to see an overview of the state of the Schwarzmueller</p>
</li>
<li>
<p>When Safety Circuit is broken, SafeStop should be open (pin 30 connected to ground) and show in red in the overview</p>
</li>
<li>
<p>When Safety Circuit is ok, SafeStop should be closed (pin 30 connected to +power) and show in green in the overview</p>
</li>
<li>
<p>CAN enable should also show in green (pin 31 connected to +power)</p>
</li>
</ul>
<h2 id="communication-with-navitrol"><a class="header" href="#communication-with-navitrol">Communication with Navitrol</a></h2>
<ul>
<li>
<p>To be able to clear Schwarzmueller errors, Navitrol needs to be communicating with the motor controller.</p>
</li>
<li>
<p>To check in realtime what's happening in Navitrol CAN interface, connect to Navitrol PC with PuTTY (username: root, pw: navitrol) and type &quot;./Navitrol dumps 0 can_inte&quot;. To stop echoing the log, press Ctrl+C</p>
</li>
<li>
<p>If Navitrol reports CAN write errors:</p>
<ul>
<li>
<p>Check wires are connected, polarity is correct and both ends have 120 ohm resistors</p>
</li>
<li>
<p>Connect directly to Navitrol PC with CanKing with nothing else connected to the bus and check that data is flowing</p>
</li>
<li>
<p>Check baud rate is correct (250000) and node IDs are correct via PLUS+1 tool, if not, the motor controller parameters are incorrect update parameters and be sure to follow the instructions in Chapter 1 precisely</p>
</li>
</ul>
</li>
<li>
<p>If Navitrol reports &quot;CAN_ Obj xxx NotRxed&quot; errors, motor controller parameters are incorrect update parameters and be sure to follow the instructions in Chapter 1 precisely</p>
<ul>
<li>
<p>21E, 19E and 29E are from node 30, it is the steer / left motor</p>
</li>
<li>
<p>21F, 19F and 29F are from node 31, it is the drive / left motor</p>
</li>
</ul>
</li>
<li>
<p>If Navitrol reports &quot;safeStopActive&quot; error / ESTOP, it means that the safety circuit connected to Schwarzmueller is broken (release estop / check wiring if already released).</p>
</li>
<li>
<p>If Navitrol reports &quot;Schwarzmueller fault&quot;, check with PLUS+1 the fault code and refer to Error_20014_Standard_CANopen_V100.pdf document to see what the fault code means</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="schwarzmueller-parameter-setup-instructions"><a class="header" href="#schwarzmueller-parameter-setup-instructions">Schwarzmueller Parameter Setup Instructions</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="parameter-setup-instructions"><a class="header" href="#parameter-setup-instructions">Parameter Setup Instructions</a></h2>
<h3 id="initialization"><a class="header" href="#initialization">Initialization</a></h3>
<ul>
<li>
<p>Download service tool from <a href="https://www.danfoss.com/en/products/dps/software/software-and-tools/plus1-software/plus1-service-tool/#tab-overview">powersolutions.danfoss.com</a> and install the tool and drivers.</p>
</li>
<li>
<p>Connect the CAN-adapter (e.g. CG150 or Kvaser Leaf Light) to your computer and to the motor controller. <strong>Keep only one motor controller connected to the CAN at the same time during configuration</strong>.</p>
</li>
<li>
<p>Start the PLUS+1 service tool.</p>
</li>
<li>
<p>From the popup window choose the correct CAN-adapter and double-click on the right channel.</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image3.png" alt="" /></p>
<ul>
<li>See document Start up User Manual PLUS+1 Inverter Family V2.0 chapter 12 for more information.</li>
</ul>
<h3 id="setup-7"><a class="header" href="#setup-7">Setup</a></h3>
<ul>
<li>
<p>Download the software</p>
<ul>
<li>
<p><em>File-&gt;File Download...</em></p>
</li>
<li>
<p>Open the *.lhx file e.g. 20014_STANDARD_CANOPEN_V100.lhx.</p>
</li>
<li>
<p>&quot;The selected file uses a different OS&quot; warning can be ignored</p>
</li>
</ul>
</li>
<li>
<p>The next window that opens lists all connected devices. At a CAN bus there could be several ones, this is the reason for this window. Choose the right device, with the right Node-ID. Only one device can be selected from the list. If there is only one device connected, it is automatically selected.</p>
</li>
<li>
<p>Click &quot;Next &gt;&quot;</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image4.png" alt="" /></p>
<ul>
<li>
<p>After clicking on &quot;Next &gt;&quot; you need to confirm the change of the parameter structure. This is required when a new software with a different parameter structure is selected for the download and that will overwrite the existing structure in the inverter.</p>
</li>
<li>
<p>Click on &quot;Confirm...&quot;</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image5.png" alt="" /></p>
<ul>
<li>
<p>A window opens now for the confirmation of the parameter setting</p>
</li>
<li>
<p>Click &quot;OK&quot;</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image6.png" alt="" /></p>
<ul>
<li>
<p>The former window will appear again</p>
</li>
<li>
<p>Now click &quot;Start download&quot; and the download of the Software will be executed.</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image7.png" alt="" /></p>
<ul>
<li>When then download has finished, the successful execution will be shown, continue with &quot;Close&quot;</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image8.png" alt="" /></p>
<ul>
<li>
<p>Load the Service application <em>File-&gt;Scan for Service Application File...</em> e.g. 20014_Standard_CANopen_V100_01.p1d</p>
<ul>
<li>&quot;This Service Application file is not designed for the connected system&quot; warning can be ignored</li>
</ul>
</li>
<li>
<p>Service application let's user to modify the parameters of the device (see chapter 12.8.3 in manual).</p>
</li>
<li>
<p>Acquire parameter file (xml) for the motor from Navitec (or use a file from a controller already in use)</p>
<ul>
<li>
<p>Node 31 is for drive or right motor</p>
</li>
<li>
<p>Node 30 is for steer or left motor</p>
</li>
</ul>
</li>
<li>
<p>Before importing the parameters, check that the CAN Node-ID in PLUS+1 matches the correct motor controller Node-ID (e.g. 30 for steer)</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image9.png" alt="" /></p>
<ul>
<li><strong>If not</strong>, click &quot;Edit Parameters&quot;. Otherwise jump to section 1.2.2.</li>
</ul>
<h4 id="change-can-id"><a class="header" href="#change-can-id">Change CAN-ID</a></h4>
<ul>
<li>Write the correct Node-ID and click <em>Parameter -&gt; Download</em></li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image10.png" alt="" /></p>
<ul>
<li>
<p>Restart device (full power cycle) to enable parameter changes (do not change view in PLUS+1).</p>
</li>
<li>
<p>The changed Node-ID should now appear in the System Navigator</p>
</li>
<li>
<p>Click the line with the right Node-ID</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image11.png" alt="" /></p>
<ul>
<li>
<p>Load again the Service application <em>File-&gt;Scan for Service Application File...</em> e.g. 20014_Standard_CANopen_V100_01.p1d</p>
</li>
<li>
<p>If the pop-up window below appears, browse and open the file.</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image12.png" alt="" /></p>
<ul>
<li>Press &quot;OK&quot; if the program asks for a replacement ECU.</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image13.png" alt="" /></p>
<h3 id="load-parameters"><a class="header" href="#load-parameters">Load parameters</a></h3>
<ul>
<li>In PLUS+1, select &quot;All Parameters&quot; (bottom of the left tree view)</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image14.png" alt="" /></p>
<ul>
<li>Import parameters (xml) for motor controller</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/./media-en/image15.png" alt="" /></p>
<ul>
<li>
<p>If loading parameters fails because of wrong ECU id, rename all &quot;0,31&quot; values (&quot;0,30&quot; for steer/left motor) in the parameter xml to the ECU id shown in PLUS+1 in the ECU column in the Parameter List and import the parameters file again</p>
</li>
<li>
<p>Select <em>Parameter -&gt; Check all parameters for download</em></p>
</li>
<li>
<p>Download parameters to Device <em>Parameter-&gt;Download</em> (from laptop to Motor Controller).</p>
</li>
<li>
<p>Restart device (full power cycle) to enable parameter changes (do not change view in PLUS+1).</p>
</li>
<li>
<p>Repeat for the other motor controller by disconnecting the newly configured controller and connecting the other controller.</p>
<ul>
<li>
<p>It is also possible to have both controllers connected at the same time and switch the active controller but by having only one connected at the time is safer</p>
<ul>
<li>
<p>Each page in the &quot;System Navigator&quot; view can have different controller selected so use extra caution when switching between controllers</p>
</li>
<li>
<p>Controller of each page is changed by right clicking page header -&gt; Exchange existing ECU -&gt; click yes to switch</p>
</li>
<li>
<p>Hovering over log variables will show the ECU id that the  variable is read from, again 0,31 for drive/right motor and 0,30 for steer/left motor</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting-schwarzmueller"><a class="header" href="#troubleshooting-schwarzmueller">Troubleshooting Schwarzmueller</a></h1>
<p>Updated 26.06.2024</p>
<hr />
<h2 id="troubleshooting-topics"><a class="header" href="#troubleshooting-topics">Troubleshooting Topics</a></h2>
<ul>
<li>
<p>The motor rotates in the wrong direction</p>
<ul>
<li>
<p>Check that Motor U/V/W are connected correctly to U/V/W of the inverter</p>
</li>
<li>
<p>Check the speed inversing parameters for motor controllers.
Parameter name with different kinematics is slightly different, e.g. for omni drive it's <em>mot_ctrl_omni_speed_inv_output</em></p>
</li>
</ul>
</li>
<li>
<p>The motor runs at low speed but temperature starts to rise quickly</p>
<ul>
<li>Endoder channel A/B are probably wired crossed</li>
</ul>
</li>
<li>
<p>Navitrol has error ERROR_CAN_ALL_NODES_NOT_OPER</p>
<ul>
<li>
<p>Navitrol hasn't received messages from all the nodes it expects.</p>
</li>
<li>
<p>In Putty type ./Navitrol dumpf and open the log.txt from <code>/navitec/logs</code> folder. Search &quot;CAN: RX_SUM&quot; and check what is/are the missing messages</p>
</li>
<li>
<p>In case no messages have been read, check CAN wiring and that there's end resistors. Check that you have the right CAN <a href="AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerTroubleshooting/../../../../Introduction/Parameters/Parameters.html">parameters</a>:</p>
<ul>
<li><em>can_nmt_master</em> # Enables Navigation SW to work as NMT master on primary CAN. 0 = disable, 1 = enable</li>
<li><em>can_sync</em> # Navitrol role for CANOpen SYNC messages: 0 = None, 1 = SYNC producer, 2 = SYNC consumer</li>
<li><em>can_bitrate_k</em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Check that the nodeID of the device matches the parameter in Navitrol.</p>
</li>
<li>
<p>Navitrol has error ERROR_CAN_RX_TIMEOUT</p>
<ul>
<li>
<p>Check that Schwarzmueller parameter EE_CANopen_TPDO2_TransType is set to 1 in all inverters (only needed in earlier Navitrols than 6.24.00).</p>
</li>
<li>
<p>In Putty type ./Navitrol dumpf and open the log.txt from /navitec/logs folder. Search &quot;CAN: RX_SUM&quot; and check what message is/are not coming in time.</p>
</li>
</ul>
</li>
<li>
<p>Navitrol has warning WARNING_ESTOP_ACTIVE</p>
<ul>
<li>Safety circuit is broken. Release estop / check Schwarzmueller
wiring if already released</li>
</ul>
</li>
<li>
<p>Navitrol has error ERROR_DRIVE_MOTOR_CONTROL_FAULT</p>
<ul>
<li>
<p>Check from PLUS+1 Service Tool error code from Error Status page
and refer to Error_20014_Standard_CANopen_V101.pdf document
which error is active.</p>
</li>
<li>
<p>Typical errors are:</p>
<ul>
<li>
<p>5401 Error_V_DC_Link; Undervoltage (level 1)</p>
</li>
<li>
<p>5002 Error CAN timeout, RPDO1</p>
</li>
<li>
<p>4101 Error motor; Config error</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>This is usually caused by having the wrong temperature sensor type selected in the Schwarzmueller parameters.
If the error is active and the temperature is incorrect, check the EE_MD_TempSnsrType:
1 = Switch (NC)
2 = Switch (NO)
3 = Analog Sensor (SnsrTab)</p>
</li>
<li>
<p>5201 Error motor; Overtemperature</p>
</li>
<li>
<p>Navitrol has error ERROR_DRIVE_MOTOR_CONTROL_FAULT, fault 5401 Undervoltage on Schwarzmueller's side, after a few seconds every time the main contactor is connected</p>
<ul>
<li>
<p>Main contactor steady value is too low and when the settling time (defined by parameter EE_MCSettlingTime_ms) is reached, the current is drawn from the circuit instead.</p>
</li>
<li>
<p>Raise the steady value defined with the Schwarzmueller parameter EE_MCSteadyValue_pct2 (* 0.01%)</p>
</li>
</ul>
</li>
<li>
<p>The brake does not release or it is switching on unwanted</p>
<ul>
<li>
<p>Check that the Brake pin 13 is connected correctly.</p>
</li>
<li>
<p>If wired correctly and break output is shown on ServiceTool, the settling value of the brake output, defined with the Schwarzmueller parameter EE_BrkSettlingValue_pct2 (*0.01%), is too low.</p>
</li>
<li>
<p>If brake is switching on unintentionally when driving, the steady output, defined with the Schwarzmueller parameter EE_BrkSteadyValue_pct2 of the brake is too low.</p>
</li>
</ul>
</li>
<li>
<p>Speed of the motor (RPM) doesn't reach our requested speed.</p>
<ul>
<li>Check that Schwarmueller speed parameters are not limiting the speed
EE_SpdMax_rpm1 -- Speed limit (e.g. 30000 -&gt; 3000 rpm)
EE_MD_SpeedMax_rpm1 -- Maximum motor speed</li>
</ul>
</li>
<li>
<p>Other common problem sources</p>
<ul>
<li>Make sure from PLUS+1 Service Tool that Analog CW / CAN Enable (pin31) shows green in the Automated Guided Vehicle page i.e. CAN is enabled</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="curtis-can-motor-controller"><a class="header" href="#curtis-can-motor-controller">Curtis CAN motor controller</a></h1>
<p>Updated 11.07.2024</p>
<hr />
<h2 id="glossary-3"><a class="header" href="#glossary-3">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>SDO</td><td>Service Data Object</td></tr>
<tr><td>PDO</td><td>Process Data Object</td></tr>
<tr><td>CIT</td><td>Curtis Integrated Toolkit</td></tr>
<tr><td>PCAN-USB</td><td>Peak PCAN-USB adapter. Used to connect between CIT and motor controller</td></tr>
</tbody></table>
<hr />
<h2 id="introduction-9"><a class="header" href="#introduction-9">Introduction</a></h2>
<p>Curtis motor controller is one of the motor controllers supported by Navitrol. Curtis offers wide range of single and multi-channel motor controllers that can be used for different purposes (steering, driving, actuator) in the AGV.</p>
<p>This documentation provides instructions for configuring the motor controllers to be used with Navitrol. Operation of the device is possible via CANopen fieldbus.</p>
<p>Following motor controllers are supported by Navitec Systems:</p>
<ul>
<li>
<p><strong>F2-T</strong>. This motor controller has 3 channels</p>
<ul>
<li>2 AC motor channels (can be used for driving/steering) and 1 DC pump (used for hydraulic actuator)</li>
</ul>
</li>
<li>
<p><strong>F2-D</strong>. This motor controller has 2 channels</p>
<ul>
<li>2 AC motor connections (can be used for driving/steering)</li>
</ul>
</li>
<li>
<p><strong>Fx-A series</strong>. This motor controller has 1 channel. Supported models are F2-A, F4-A, F6-A, F10-A</p>
<ul>
<li>1 AC motor connection (can be used for driving/steering)</li>
</ul>
</li>
</ul>
<p>The following motor types are supported.</p>
<ul>
<li>
<p><strong>AC Induction Motor (ACIM)</strong> This motor type by default uses the quadrature Encoder and supports auto-characterization. Contact Curtis if an ACIM application will use a Sin/Cos sensor (encoder)</p>
</li>
<li>
<p><strong>Permanent magnet AC Motor (PMAC)</strong> PMAC motors by default use the Sin/Cos sensor type Encoder. Contact Curtis if a PMAC motor is chosen for the AGV</p>
</li>
</ul>
<p>There might be some errors during commissioning procedure that are motor controller specific, so Navitrol support might be not able to solve them without Curtis support help. Contact information of Curtis support can be provided by Navitec Systems.</p>
<p>Currently, Curtis motor controllers can be supported for several kinematics:</p>
<ul>
<li>
<p>Diff drive</p>
</li>
<li>
<p>Steer drive</p>
</li>
<li>
<p>Steer drive with a differential sub unit</p>
</li>
<li>
<p>Omni</p>
</li>
</ul>
<h2 id="requirements-5"><a class="header" href="#requirements-5">Requirements</a></h2>
<ul>
<li>The parameterization and configuration of the motor controllers takes place with the <a href="https://www.curtisinstruments.com/products/programming">Curtis Integrated Toolkit</a> (CIT) software. The software needs a license and it can be purchased from Curtis.</li>
<li>Adapter to connect the motor controller to the <a href="https://www.curtisinstruments.com/products/programming">CIT software</a>. Curtis recommends PEAK System PCAN adapter</li>
<li>A Project file (.cprj) for the motor controller, provided by Navitec Systems
<ul>
<li>Different motor controllers have different project files. For example F2-D and F2-A models will use different project file</li>
</ul>
</li>
<li>Servo mode tuning template file (.ctrc) is needed and is proviced by Navitec Systems</li>
</ul>
<h2 id="limitations-3"><a class="header" href="#limitations-3">Limitations</a></h2>
<ul>
<li>Autocharacterization can be done only for AC induction motors (ACIM)</li>
<li>PMAC motors characterization is done by Curtis on their dynomometer lab and motor might need to be shipped to Curtis. Please contact Curtis if planning to use PMAC motor</li>
<li><strong>Motor controller might not support all functions and kinematics</strong>. <a href="AgvInterfaces/MotorControllers/Curtis/../../SupportedDevices/SupportedDevices-en.html">List of supported devices</a> document should be checked to determine whether the combination of the function and kinematics is supported or not.</li>
<li>Currently, Navitrol is not able to control Curtis motor controllers with other motor controllers in the same AGV</li>
</ul>
<h2 id="dependencies-1"><a class="header" href="#dependencies-1">Dependencies</a></h2>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Curtis/../../MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html">Motor controllers common</a></li>
<li><a href="AgvInterfaces/MotorControllers/Curtis/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN Communication</a></li>
<li><a href="AgvInterfaces/MotorControllers/Curtis/../../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial Calibration Guide</a></li>
<li><a href="https://www.curtisinstruments.com/products/motor-controllers">Curtis Motor controller listing</a></li>
</ul>
<h2 id="electrical-connections"><a class="header" href="#electrical-connections">Electrical connections</a></h2>
<p>Electrical connections can be divided into several groups:</p>
<ol>
<li>
<p><strong>High-current connections</strong> -- screw connections.</p>
<p>a.  <strong>Battery connectors -- B+ and B-</strong>
<strong>Important note: The battery should be connected using the main contactor.</strong>
This is because the motor controller has a quite large capacitor installed between connectors. If the battery is directly connected, it may have a large current spike.</p>
<p>b.  <strong>Motor terminals (U, V, W).</strong>
Should be connected directly to the motor terminals</p>
<p>c.  <strong>Pump connection</strong>
Some of the motor controllers might have DC pump for actuator control.
Then pump should be connected between &quot;Pump&quot; and &quot;B+&quot;.</p>
</li>
<li>
<p><strong>Low-current connections</strong>. All of the low power connections are through a single AMPSEAL connector. The following should be connected:</p>
<p>a.  <strong>Key Switch</strong> This is the logical power input. Additionally, used to reboot the motor controller.</p>
<p>b.  <strong>Coil Outputs</strong> (proportional valves).
Those outputs are used for controlling the main contactor, brake release, and proportional valves.
Wiring and pin number depends on the motor controller type.</p>
<p>c.  <strong>CAN connection</strong></p>
<p>d.  <strong>SafeStop switch</strong>
Pin that is used for E-STOP connection depends on the motor controller type.
This pin should be powered during normal operation (Normally-closed contact).</p>
<p>e.  <strong>Motor sensors</strong> (available only for AC-channel): encoder and temperature sensor.</p>
<p>f.  <strong>Generic Switches</strong>
Switches can be used as digital and analog inputs in some specific cases.</p>
</li>
</ol>
<p>See <a href="https://www.curtisinstruments.com/products/motor-controllers">Curtis Motor controller listing</a> for more details.</p>
<h2 id="quick-setup"><a class="header" href="#quick-setup">Quick Setup</a></h2>
<h3 id="agv-off-the-ground"><a class="header" href="#agv-off-the-ground">AGV off the ground</a></h3>
<p>The following steps must be done so that AGV is lifted off the ground and motors can spin freely:</p>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#connect-motor-controllers-to-the-can-bus">Connect the motor controller to the CAN-bus</a></li>
</ul>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#flash-the-project-file-to-the-motor-controller-with-cit-software">Flash the project file to the motor controller with CIT software</a></li>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#controller-parameter-setup">Controller Parameter Setup</a></li>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#auto-characterization-for-acim-motor-controllers">Auto Characterization for ACIM motor controllers</a></li>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#internal-pi-controller-tuning">Internal PI controller tuning</a></li>
</ul>
<h3 id="agv-on-the-ground"><a class="header" href="#agv-on-the-ground">AGV on the ground</a></h3>
<p>After commissioning has proceed to a point that all motor controllers PI tuning has been completed, the AGV must be put back to ground and continue with following steps:</p>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#navitrol-parameterization">Navitrol parameterization</a></li>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#tune-slip-gain">Tune Slip gain</a></li>
<li><a href="AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html#base-speed-configuration">Base speed configuration</a></li>
</ul>
<!--
---

- Set CAN nodeId parameters according to [Motor controllers common](../../MotorControllers/MotorControllersCommon/MotorControllersCommon-en.md)
- Set CAN communication parameters according to [CAN communication](../../GenericInterfaces/CanCommunication/CanCommunication-en.md) document.
- Set motor controller specific parameters as listed below

**Required parameters**



| Name             | Type | Default value | Description |
| --- | --- | --- | --- |
| mot_ctrl_max_output_current_percent | Int | 100 | Maximum output current (percent) sent to the motor controller |
| mot_ctrl_disable_delay_ms | Int | 0 | Motor controller disabling delay after activating brakes in ms, 0 = no delay, 300 = recommended for Schwarzmueller and Curtis |
| mot_ctrl_startup_delay_main_contactor_ms | Int | 0| Time given for main contactor to stabilize before enabling drive. 0 = no delay, 500 = recommended for Schwarzmueller and Curtis |
| mot_ctrl_startup_delay_brake_release_ms | Int | 0 | Time given for brakes to fully open before giving rpm out. 0 = no delay, 200 = recommended for Schwarzmueller, 100..300 = recommended for Curtis |


---

### Fine-tuning

If BMS is used, Navitrol can read BMS data from the motor controller. Set up BMS in CIT according to the controller manual.

**Optional parameters**

| Name             | Type | Default value | Description |
| --- | --- | --- | ---  |
| battery_percentage_from_mot_ctrl   | Int  | 0  | Activates Nanotec E-STOP check. </br> Emergency stop activation comes from digital input 1 and 2 on the motor controller |
| battery_alert_from   | Int  | 0  |-1 no alert, 0 to alert from low voltage, 1 to alert from low battery percentage |
| battery\_alert\_percentage   | Float  | 5.0f  |\% |
-->
<hr />
<h2 id="how-to-use-4"><a class="header" href="#how-to-use-4">How to use</a></h2>
<p>To start the commissioning of Curtis motor controller, the following items are needed:</p>
<ol>
<li>
<p>Can USB adapter.
PEAK System PCAN USB-adapter was tested by Navitec and recommended by Curtis</p>
</li>
<li>
<p><a href="https://www.curtisinstruments.com/products/programming">CIT</a> -- Curtis Integrated toolkit</p>
</li>
<li>
<p>Project file for Curtis Motor Controller model provided by Navitec Systems</p>
</li>
</ol>
<h3 id="connect-motor-controllers-to-the-can-bus"><a class="header" href="#connect-motor-controllers-to-the-can-bus">Connect motor controllers to the CAN bus</a></h3>
<p>Connect the motor controller and CAN adapter to the CAN bus. The motor controller should be connected to the CAN bus for commissioning one by one.</p>
<p>If the motor controller is wired correctly, there should be a heartbeat on the CAN bus.</p>
<p>If a PCAN-USB adapter is used, open PCAN-View software and check that heartbeat is present on the bus.</p>
<p>Default node Ids are 0x26 (hex) = 38 (dec) and 0x27 (hex) = 39 (dec).</p>
<p><strong>Note: two and three-channel motor controllers (F2-D, F2-T) have two communication interface. Therefore, if the above-mentioned controllers are used, there should be a heartbeat from two node Ids.</strong></p>
<h3 id="flash-the-project-file-to-the-motor-controller-with-cit-software"><a class="header" href="#flash-the-project-file-to-the-motor-controller-with-cit-software">Flash the project file to the motor controller with CIT software</a></h3>
<p>The first step that should be done in commissioning the motor controller is to Flash the controller.</p>
<p>To communicate with Navitrol, the motor controller should have appropriate software with Navitec-specific modifications. To install the software on the motor controller, the user should flash the project file to the motor controller. The project file is provided by Navitec Systems.</p>
<p>The project file is device-specific and supported devices are mentioned in the project file.</p>
<p>To flash the project file to the controller:</p>
<ol>
<li>Open the project.</li>
<li>Select the correct CAN adapter at the bottom of the window.</li>
<li>Next, press the green circle button to establish communication with the motor controllers.</li>
<li>Once communication is established, press &quot;Package and Flash&quot; to go to the flashing menu of the motor controller. If motor controller is two or three channel, flash the file on both of them. <strong>Note: Navitrol needs to be turned of when flashing the project file to the controller</strong></li>
</ol>
<br>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/Flashing.png" alt="" /></p>
<blockquote>
<p>Flashing the project file on the Curtis controller</p>
</blockquote>
<h3 id="controller-parameter-setup"><a class="header" href="#controller-parameter-setup">Controller Parameter Setup</a></h3>
<p>General controller parameters should be set once flashing is completed. Parameter change must be performed for all motor controllers (and for both M1 and M2 controllers in case two-channel motor controllers are used).</p>
<p>To change parameters:</p>
<ol>
<li>Open Curtis Integrated Toolkit</li>
<li>Connect to motor controllers using the green circle button</li>
<li>Select motor controller (For example M1 or M2) and press &quot;Programmer&quot; in the right corner menu.</li>
</ol>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/programmer_view.png" alt="" /></p>
<blockquote>
<p>Programmer View</p>
</blockquote>
<p>The following parameters should be checked from the Programmer:</p>
<table><thead><tr><th>Parameter Name</th><th>Path</th><th>Recommended Value</th><th>Notes</th></tr></thead><tbody>
<tr><td>Control Mode Select</td><td>System Monitor » Control Mode Select</td><td>7</td><td>Always Servo mode for Navitrol to be able to utilize the motor controller</td></tr>
<tr><td>Nominal Battery Voltage</td><td>Applications Setup » Battery Setup » Nominal voltage</td><td>24</td><td>Typically 24 or 48 depending on the battery back</td></tr>
<tr><td>Main Contactor Pull in Voltage</td><td>Applications Setup » Main Contactor » Pull in Voltage</td><td>100</td><td>Check from main contactor document the correct Pull in voltage. Typically 100</td></tr>
<tr><td>Main Contactor Holding Voltage</td><td>Applications Setup » Main Contactor » Holding Voltage</td><td>80</td><td>Check from main contactor document the correct Holding voltage. Typically 80</td></tr>
<tr><td>EM Brake Pull in Voltage</td><td>Application Setup » EM Brake Control » Pull in Voltage</td><td>100</td><td>Check from Brake manufacturer document for correct Pull in Voltage. Typically 100</td></tr>
<tr><td>EM Brake Holding Voltage</td><td>Application Setup » EM Brake Control » Holding Voltage</td><td>70</td><td>Check from Brake manufacturer document for correct Holding Voltage. Typically 70</td></tr>
<tr><td>EM Brake Type</td><td>Application Setup » EM Brake Control » EM Brake Type</td><td>0</td><td>Always 0, defined automatically by Curtis</td></tr>
<tr><td>CAN Baud Rate</td><td>Application Setup » CAN interface 1/2 » Baud Rate</td><td>0-2</td><td>Baud Rate for the controller. Needs to be same as Navitrol Baud Rate. <br> <strong>Note: Change applied only after reboot</strong></td></tr>
<tr><td>CAN Node ID</td><td>Application Setup » CAN interface 1/2 » CAN Node ID</td><td>NodeId in hex (example 26h)</td><td>Node ID for the motor controller in hexadecimal. <br> <strong>Note: Change applied only after reboot</strong></td></tr>
<tr><td>EM Brake Driver</td><td>Controller setup » IO Assignments » Coil drivers » Em brake driver</td><td>0</td><td>Always 0, defined automatically by Curtis</td></tr>
<tr><td>Main Contactor Driver</td><td>Controller setup » IO Assignments » Coil drivers » Main contactor Driver</td><td>5</td><td>Check from <a href="https://www.curtisinstruments.com/products/motor-controllers">Curtis Motor controller datasheet</a> which driver is Main Contactor connected to. For example F4-A and F2-D Main Coil is connected to Driver 5</td></tr>
<tr><td>Position Sensor type</td><td>Motor Setup » Position sensor type</td><td>1</td><td>Usually Quadrature encoder for ACIM motors. Check with customer which sensor they are using</td></tr>
<tr><td>Quadture Encoder 5V Voltage</td><td>Motor Setup » Quadrature Encoder » 5V output</td><td>True</td><td></td></tr>
<tr><td>Quadture Encoder 12V Voltage</td><td>Motor Setup » Quadrature Encoder » 12V output</td><td>True</td><td></td></tr>
<tr><td>Temperature Sensor Type</td><td>Motor Setup » Temperature Sensor » Sensor Type</td><td>1-4</td><td>Choose sensor type. 4 different sensors supported</td></tr>
<tr><td>Temperature Sensor Enabled</td><td>Motor Setup » Temperature Sensor » Sensor Enable</td><td>True</td><td>Check that temperature displayed in the menu corresponds to the actual temperature.</td></tr>
<tr><td>Temperature Sensor Max Temp</td><td>Motor Setup » Temperature Sensor » Temperature Max</td><td>160</td><td>Motor manufacturer provides this information</td></tr>
<tr><td>Temperature Sensor Hot Temp</td><td>Motor Setup » Temperature Sensor » Temperature Hot</td><td>145</td><td>Motor manufacturer provides this information</td></tr>
<tr><td>Interlock Input Source</td><td>Controller Setup » IO Assignments » Switch Assignment » Interlock Input Source</td><td>0</td><td>Always 0, defined automatically by Curtis</td></tr>
</tbody></table>
<p>For the PMAC motor set Sin/Cos Encoder parameters (Programmer » Motor Setup » Sin/Cos Encoder).
Those parameters should be set according to the datasheet of encoder being used.</p>
<p>Once those parameters are set, it is possible to check Main Contactor and Brake operation. Go to:</p>
<ul>
<li>Programmer » Navitec » Interlock force enable and select &quot;Yes&quot;.</li>
<li>Check under System Monitor » Outputs 
<ul>
<li>Values increased from 0 to 70 or 80 the corresponding Drivers for example 5 and 2</li>
</ul>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/Navitec_menu.png" alt="" /></p>
<blockquote>
<p>Navitec menu in CIT</p>
</blockquote>
<p>Once selected:</p>
<ul>
<li>Main contactor should be engaged</li>
<li>Brakes should be released</li>
</ul>
<p>Additionally, check if any errors appeared in Programmer. If there are some errors, react to them according to Curtis manual.</p>
<h3 id="auto-characterization-for-acim-motor-controllers"><a class="header" href="#auto-characterization-for-acim-motor-controllers">Auto Characterization for ACIM motor controllers</a></h3>
<p>Once main parameters have been set and interlock can be released, characterizing the motor controller can be performed.
Characterization means that the Motor controller will measure and tune motor parameters to establish optimal controllability of the motor.</p>
<p>The exact motor characterization model can be provided by Curtis. However, if Curtis does not have the characterization model available, the auto-characterization is needed. <strong>Autocharacterization and Slip Gain configuration are not needed when using the exact motor characterization model</strong></p>
<p>The motor characterization should be performed for both M1 and M2 controllers in case two-channel motor controllers are used. Everything should be performed when wheels are off the ground.</p>
<p>Motor characterization is described in steps in Chapter 6 &quot;Commissioning&quot; of Curtis Manual. The procedure can be done in the following steps in Programmer:</p>
<ol>
<li>Set Motor Technology and Motor Type</li>
</ol>
<table><thead><tr><th>Parameter Name</th><th>Path</th><th>Recommended Value</th><th>Notes</th></tr></thead><tbody>
<tr><td>Motor Technology</td><td>Motor Setup » Motor Technology</td><td>ACIM</td><td>ACIM or PMAC</td></tr>
<tr><td>Motor Type</td><td>Motor Setup » Induction Motor (ACIM) » Motor Type</td><td>-1</td><td>-1 = Autocharacterization procedure used <br> 1-588 = Exact motor characterization model provided by Curtis</td></tr>
</tbody></table>
<ol start="2">
<li>
<p>Clear Faults and do a power cycle of the controller. Only User 1 error (PDO timeout) can be present.</p>
</li>
<li>
<p>Enter the desired Max Test Current and Max Test Speed for the characterization test (in Motor Setup » Induction Motor (ACIM) » Characterization Tests). Typical settings are 70% current and 1/3 of max speed of the motor.</p>
</li>
<li>
<p>Enable interlock (Programmer » Navitec » Interlock force enable)</p>
</li>
<li>
<p>Set Test Enable = On (Motor Setup » Induction Motor (ACIM) » Characterization Tests)</p>
</li>
<li>
<p>Set Test Throttle = 1 (positive). After approximately 30 or more seconds, the motor will begin to pulsate and then rotate. It is critical to verify the motor is turning in the FORWARD vehicle direction.
If it is not, set Test Throttle = 0, wait for the motor to come to a stop, then set Test Throttle = -1 (negative).</p>
</li>
<li>
<p>When auto characterization is completed, a Parameter Change message will appear. Do a power cycle to the controller.</p>
</li>
</ol>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/Motor_characterization.png" alt="" /></p>
<blockquote>
<p>Motor characterization</p>
</blockquote>
<h3 id="internal-pi-controller-tuning"><a class="header" href="#internal-pi-controller-tuning">Internal PI controller tuning</a></h3>
<p>PI controller must be tuned in order to control the motor accurately and fast.</p>
<ol>
<li>Change Tuning Mode to value 1 to enable speed controller tuning.</li>
</ol>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/Tuning_mode_select.png" alt="" /></p>
<blockquote>
<p>Tuning mode select</p>
</blockquote>
<ol start="2">
<li>
<p>Set two speeds that will be used for speed tuning. The motor controller will switch between those speeds during the tuning procedure</p>
</li>
<li>
<p>Set initial PI gains. First, leave Ki to 0.0 and set Kp to some initial value (0.2 is a good starting value)</p>
</li>
</ol>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/Speed_and_PID_coefficient.png" alt="" /></p>
<blockquote>
<p>Setting speed settings and PI coefficients</p>
</blockquote>
<ol start="4">
<li>
<p>Now go to the main page of the CIT software. Open TACT.</p>
</li>
<li>
<p>Open the Tuning template file from the File menu. The Tuning template file will be provided by Navitec.</p>
</li>
<li>
<p>Set Tuning Enable to value 1 in the Programmer</p>
</li>
<li>
<p>Press the green triangle button in TACT to start</p>
</li>
<li>
<p>The motor should start changing from Speed 1 to Speed 2 every Tuning Time interval.
Increase Kp until slight overshoot is seen in the step response, then reduce the value of Speed Kp to approximately 2/3 of the present value.
Typical values of well-tuned Speed Kp are 0.2-0.4 for small motors, much higher for larger motors.</p>
</li>
<li>
<p>After Speed Kp value is determined, start slowly raising Ki. The motor should now exactly converge to the requested speeds.
Take larger steps for Ki, e.g. +2.0. Increase Ki until overshoot is seen in the step response, then reduce the value of Speed Ki to approximately 2/3 of the present value.
Typical values of a well-tuned Speed Ki are between 0.1 and 0.9.</p>
</li>
</ol>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/Oscilloscope.png" alt="" /></p>
<blockquote>
<p>Tuning process in Oscilloscope</p>
</blockquote>
<ol>
<li>Once tuning is completed, change the Tuning Enable parameter back to 0.</li>
</ol>
<h3 id="navitrol-parameterization"><a class="header" href="#navitrol-parameterization">Navitrol parameterization</a></h3>
<ul>
<li>Set CAN nodeId parameters according to <a href="AgvInterfaces/MotorControllers/Curtis/../../MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html">Motor controllers common</a></li>
<li>Set CAN communication parameters according to <a href="AgvInterfaces/MotorControllers/Curtis/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</li>
<li>The controller supports current limiting and control delays.  Control delays are needed to ensure that the main contactor and brakes will be fully open when the motor controller will start driving. </li>
</ul>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>mot_ctrl_max_output_current_percent</td><td>Int</td><td>100</td><td>Maximum output current (percent) sent to the motor controller</td></tr>
<tr><td>mot_ctrl_disable_delay_ms</td><td>Int</td><td>1000</td><td>Motor controller disabling delay [ms] after activating brakes: -1 = never disable, 0 = no delay</td></tr>
<tr><td>mot_ctrl_startup_delay_main_contactor_ms</td><td>Int</td><td>0</td><td>Time given for main contactor to stabilize before enabling drive. 0 = no delay, 500 = recommended for Schwarzmueller and Curtis</td></tr>
<tr><td>mot_ctrl_startup_delay_brake_release_ms</td><td>Int</td><td>0</td><td>Time given for brakes to fully open before giving rpm out. 0 = no delay, 200 = recommended for Schwarzmueller, 100..300 = recommended for Curtis</td></tr>
</tbody></table>
<h4 id="fine-tuning"><a class="header" href="#fine-tuning">Fine-tuning</a></h4>
<p>If BMS is used, Navitrol can read BMS data from the motor controller. Set up BMS in CIT according to the controller manual. To activate BMS, use the parameters listed below</p>
<ul>
<li>Note: Not all types of batteries are supported by built-in BMS. This information should be checked with Curtis support.</li>
</ul>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>battery_percentage_from_mot_ctrl</td><td>Int</td><td>0</td><td>1 to read battery percentage from motor controller, 0 to calculate it from battery voltage</td></tr>
<tr><td>battery_alert_from</td><td>Int</td><td>0</td><td>Battery Alert Mode: -1 = no alert, 0 = alert from low voltage, 1 = alert from low battery percentage</td></tr>
<tr><td>battery_alert_percentage</td><td>Float</td><td>5.0f</td><td>Warning is set on low battery level [%] (battery_alert_from = 1)</td></tr>
<tr><td>can_sync</td><td>Int</td><td>1</td><td>Navigation SW (Primary CAN) role for CANOpen SYNC messages: 0 = None, 1 = SYNC producer, 2 = SYNC consumer</td></tr>
</tbody></table>
<h3 id="tune-slip-gain"><a class="header" href="#tune-slip-gain">Tune Slip gain</a></h3>
<p>Slip gain need to be tuned after AGV is ready to be driven (Manually or with Navitrol). The steps to configure slip gain are:</p>
<ul>
<li>Connect a load cell between the vehicle and something that does not move</li>
<li>A torque sensor needs to be connected to the motor to get the torque measurements</li>
<li>Running the motor that it stalls. Change torgues that it does not slip</li>
<li>Try to find highest torque produced by the motor and use that slip gain.</li>
<li>Open Programmer and change SlipGain (Motor Setup » Induction Motor (ACIM) » Characterization Tests)
<ul>
<li>First set to 3, then 1.5 and then 6. Check which produces the highest torque and fine-tune to find the highest torque produced</li>
</ul>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/slip_gain.png" alt="" /></p>
<blockquote>
<p>SlipGain on CIT Programmer</p>
</blockquote>
<p>Curtis documentation tells more detailed how to configure the Slip Gain.</p>
<h3 id="base-speed-configuration"><a class="header" href="#base-speed-configuration">Base speed configuration</a></h3>
<p>Base speed needs to be set up in order to utilize the motor controllers for driving. The following steps need to be executed.</p>
<ul>
<li>
<p>Open Programmer in CIT software:</p>
<ul>
<li>Motor Setup » Induction Motor » Field Weakening
<ul>
<li>Set FW Base Speed to 6000</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Run the vehicle with very high acceleration. Controller will calculate the base speed itself and will inform the Base Speed Captured</p>
</li>
<li>
<p>Do the same test 5 times. Take the average Base Speed Captured</p>
</li>
<li>
<p>Set the FW Base Speed to the average calculated value</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Curtis/./media-en/base_speed.png" alt="" /></p>
<blockquote>
<p>Base Speed setup on CIT Programmer</p>
</blockquote>
<p>Curtis documentation tells more detailed how to configure the Base Speed.</p>
<h3 id="node-ids-of-the-motor-controller"><a class="header" href="#node-ids-of-the-motor-controller">Node Ids of the motor controller</a></h3>
<p>Node Id:s should be configured in following way:</p>
<ul>
<li>Two-channel motor controllers should have consecutive node ids, where channel 1 has the lower Id and channel 2 the larger.
For instance, if node Id of M1 (channel 1) is 0x27, then node Id of M2 (channel 2) is 0x28.</li>
</ul>
<h2 id="troubleshooting-9"><a class="header" href="#troubleshooting-9">Troubleshooting</a></h2>
<h3 id="can-bus-errors"><a class="header" href="#can-bus-errors">CAN-bus errors</a></h3>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Curtis/../../GenericInterfaces/CanCommunication/CanCommunication-en.html#troubleshooting-can-communication">Troubleshooting CAN communication</a></li>
</ul>
<h3 id="motor-controller-issues"><a class="header" href="#motor-controller-issues">Motor controller issues</a></h3>
<p>If the motor controller indicates some errors, try the following:</p>
<ul>
<li>
<p>If the motor controller is not rotated, check Navitrol terminal output or Navitrol Monitor errors or warnings. There should be some information about motor controller status and error if something is wrong.</p>
</li>
<li>
<p>If an error is active and does not reset after controller reboot, connect to the Motor controller with Curtis Integrated Toolkit to troubleshoot further.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="engel-can-motor-controller"><a class="header" href="#engel-can-motor-controller">Engel CAN motor controller</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-4"><a class="header" href="#glossary-4">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>SDO</td><td>Service Data Object</td></tr>
<tr><td>PDO</td><td>Process Data Object</td></tr>
<tr><td>Homing</td><td>Process of finding home position<br>(position of zero steering angle)</td></tr>
</tbody></table>
<hr />
<h2 id="introduction-10"><a class="header" href="#introduction-10">Introduction</a></h2>
<p>Engel motor controller is one of the motor controllers supported by Navitrol. Engel offers different range of single channel motor controllers that can be used for different purposes in the AGV.</p>
<p>In this documentation, instructions are provided for configuring the motor controllers to be interfaced with Navitrol.</p>
<p>Following motor controllers has been tested by Navitec Systems:</p>
<ul>
<li>HFI series, HFI2660-N200-CO</li>
</ul>
<p>However, according to documentation, other motor controllers also should be supported since CAN interface is common for all Engel motor controllers.</p>
<p>Operation of the device is possible either via fieldbus or via digital and analogue inputs and outputs. Communication via CANopen is supported by Navitrol.</p>
<p>The initial parameterisation/configuration of the device takes place with the parameterisation software DSerV.</p>
<p>For now, Engel motor controllers can be used:</p>
<ul>
<li>For controlling steering in Schwarzmueller omni AGV</li>
</ul>
<h2 id="electrical-connections-1"><a class="header" href="#electrical-connections-1">Electrical connections</a></h2>
<p>Electrical connections can be divided into four groups:</p>
<ol>
<li>
<p>CAN bus. Terminal X2 with M12 connector is used to connect to the CAN bus. In order to connect to the can bus, pin 5 should be connected to CAN_L and pin 4 -- to CAN_H.</p>
</li>
<li>
<p>Power supply. Terminal X1 (three internal wires) are used to connect to the power. Both main supply(A, BN) and logic supply (C, BK) should be powered.</p>
</li>
<li>
<p>Series connection. Pins 10 (VT), 11 (GY-PK) and 8 (BK) should be connected to series adapter as it shown on the figure.</p>
</li>
<li>
<p>Digital inputs and outputs.</p>
</li>
</ol>
<p>The following digital inputs are used by Navitrol:</p>
<ol>
<li>
<p>DI1 (WH) is used in Engel state machine. It has to be powered, otherwise device cannot be put to &quot;Operation Enabled&quot; mode.</p>
</li>
<li>
<p>DI3 (GN) is used as a negative limit switch for homing for steering.</p>
</li>
<li>
<p>DI8 (BU-RD) can be used as an E-STOP (depending on Navitrol parameter <strong>I,mot_ctrl_engel_estop_enabled</strong>). If this pin is powered, safestop is disable. Once it loses power, safestop triggered (NC contact).
<img src="AgvInterfaces/MotorControllers/Engel/./media-en/image4.png" alt="" /></p>
</li>
</ol>
<h2 id="commissioning-steps"><a class="header" href="#commissioning-steps">Commissioning steps</a></h2>
<p>The following steps should be done in process of commissioning:</p>
<ol>
<li>
<p>Establishing serial connection to the motor controller</p>
</li>
<li>
<p>Connection to DSerV software to enable CAN communication</p>
</li>
<li>
<p>Changing Navitrol parameters</p>
</li>
<li>
<p>Tuning internal PID controller</p>
</li>
</ol>
<p>Note: By default, CAN communication is disabled in motor controller.
It is mandatory to connect with DSerV software in order to enable it.</p>
<h3 id="establishing-serial-connection-to-the-motor-controller"><a class="header" href="#establishing-serial-connection-to-the-motor-controller">Establishing serial connection to the motor controller</a></h3>
<p>Connection to the DSerV software is done using the serial port.
Therefore, RS232-USB adapter should be used.</p>
<p>Connect wires as it shown in the Figure 1.
Note that pins (2,3,5) shown on the figure are pinout of the DB9 adapter.
In case of using Moxa adapter, pay attention that terminal block pin numbering is different to DB9 pinout.
Additionally, it is important to connect ground (wire 8, BK) to pin 5 of the DB9.</p>
<p>Once wiring is done, make sure that drivers
are installed correctly. RS232-USB adapter should create a COM port. The
following settings should be set in Device Manager for the COM-port:
<img src="AgvInterfaces/MotorControllers/Engel/./media-en/image5.png" alt="" /></p>
<p>Additionally, in case of Moxa adapters, RS-232 interface should be selected in Device Manager -- Multi-port serial adapter:
<img src="AgvInterfaces/MotorControllers/Engel/./media-en/image6.png" alt="" /></p>
<h3 id="connection-to-dserv-software-to-enable-can-communication"><a class="header" href="#connection-to-dserv-software-to-enable-can-communication">Connection to DSerV software to enable CAN communication</a></h3>
<p>In order to connect to motor controller, open DSerV software and select the COM-port to which motor controller is connected:
<img src="AgvInterfaces/MotorControllers/Engel/./media-en/image7.png" alt="" /></p>
<p>If wiring is correct and motor controller is powered, connection should be successfully established.</p>
<p>Once connection has been established, open tab Optimization -- Fieldbus operation.
Select CANopen fieldbus. Enter bitrate (250 kbit/s is default for Navitrol) and Node-ID.</p>
<p>Note that all of the CANopen device on the bus should have different Node-IDs and the same bitrate.
<img src="AgvInterfaces/MotorControllers/Engel/./media-en/image8.png" alt="" /></p>
<p>Press &quot;Send&quot; and do a power cycle (remove power from the drive and apply it again).</p>
<p>Once it is done, motor controller is ready to communicate with Navitrol.</p>
<h3 id="changing-navitrol-parameters"><a class="header" href="#changing-navitrol-parameters">Changing Navitrol parameters</a></h3>
<ul>
<li>
<p>First, set Node ID to the corresponding parameter. For instance, if motor controller controlling steering in omni machine, set <strong>can_omni_steer_ctrl_nodeid</strong> to the same value that was set in previous step.</p>
</li>
<li>
<p>Set the communication parameters (<strong>can_ch</strong> and <strong>can_bitrate_k</strong>) according to <a href="AgvInterfaces/MotorControllers/Engel/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</p>
</li>
<li>
<p>Set some initial parameters for built-in PD controller <strong>mot_ctrl_engel_p_gain</strong> and <strong>mot_ctrl_engel_i_time_ms</strong>.</p>
</li>
<li>
<p>If motor controller is used for steering without external absolute encoder, homing offset can be changed using the parater <strong>mot_ctrl_engel_home_offset</strong> (4096 = 1 revolution).
Corresponds to the object <strong>607C</strong> in motor controller manual.</p>
</li>
<li>
<p>If estop should be enabled, set parameter <strong>mot_ctrl_engel_estop_enabled</strong>.</p>
</li>
<li>
<p>Other motor controller settings are done using SDOs by Navitrol.</p>
</li>
</ul>
<p>Table 1. List of Navitrol parameters</p>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Information</th></tr></thead><tbody>
<tr><td>Float</td><td>mot_ctrl_engel_p_gain</td><td>0.0</td><td>0.2</td><td>1.0</td><td>Engel motor controller internal P-gain</td></tr>
<tr><td>Float</td><td>mot_ctrl_engel_i_time_ms</td><td>0.0</td><td>4.0</td><td>3276</td><td>Engel motor controller internal Integration time in milliseconds</td></tr>
<tr><td>Int</td><td>mot_ctrl_engel_home_offset</td><td>-2.1*10<sup>9</sup></td><td>0</td><td>2.1*10<sup>9</sup></td><td>Engel motor controller homing offset</td></tr>
<tr><td>Int</td><td>mot_ctrl_engel_estop_enabled</td><td>0</td><td>1</td><td>1</td><td>Engel emergency stop activation. Emergency stop activation comes from digital input 8 (BU-RD wire). DI8 should be powered in normal mode</td></tr>
</tbody></table>
<h3 id="tuning-pid-coefficients"><a class="header" href="#tuning-pid-coefficients">Tuning PID coefficients</a></h3>
<p>In order to tune PID controller, DSerV software in combination of Navitrol should be used.
Note: tuning PID controller is typically done by customers.</p>
<p>In order to tune PID controller, step response should be given to the motor controller.
Motor controller form can be used for giving out reference:</p>
<p><img src="AgvInterfaces/MotorControllers/Engel/./media-en/image9.png" alt="" />
In motor controller form, the following
features can be used:</p>
<ul>
<li>
<p>Giving target angle</p>
</li>
<li>
<p>Giving target RPM</p>
</li>
<li>
<p>Brake release (should checked to drive the motor)</p>
</li>
<li>
<p>Safe stop (should be unchecked to drive the motor)</p>
</li>
<li>
<p>Reset fault</p>
</li>
</ul>
<p>DSerV has Ocsilloscope feature that can be used for PID tuning (Diagnostic - Oscilloscope).
For instance, the following configuration of channels would trigger capturing the step response:</p>
<p><img src="AgvInterfaces/MotorControllers/Engel/./media-en/image10.png" alt="" />
If motor controller is used for homing operation, form can be opened and used after homing process has finished.</p>
<p>Note: it has been noticed that values captured by the DSerV software are not very accurate. It recommended to make every step response several times for the best results.</p>
<p>The following sequence of calibrating is recommended:</p>
<ul>
<li>
<p>In Navitrol, open Motor controller form and put some RPMs.</p>
</li>
<li>
<p>Make channel setup similar to the one on the Figure</p>
</li>
<li>
<p>Check &quot;Brake release&quot; in Navitrol. Oscillogram should be captured.</p>
</li>
<li>
<p>In order to change the PID values, go to the DSerV software and select the Optimisation-Speed controller. Values sent from there are immediately changed in motor controller</p>
</li>
<li>
<p>Once optimal values are found, copy them to the Navitrol parameters (<strong>mot_ctrl_engel_p_gain</strong> and <strong>mot_ctrl_engel_i_time_ms</strong>)</p>
</li>
</ul>
<p>Motor controller manufacturer recommends the following sequence of tuning PID controller:
<img src="AgvInterfaces/MotorControllers/Engel/./media-en/image11.png" alt="" /></p>
<h2 id="dserv-software-capabilities"><a class="header" href="#dserv-software-capabilities">DSerV software capabilities</a></h2>
<p>The following functions are available in DSerV software:</p>
<ol>
<li>
<p><strong>Optimisation</strong>. This tab allows to change, save and view parameters inside the motor controller. Typically, all of the needed parameters are written by Navitrol, so there is no need to change anything.</p>
</li>
<li>
<p><strong>Monitor</strong>. This tab allows to see current values of engineering parameters, such as current, speed, temperature, power, voltage and so on. Used for monitoring purposes.</p>
</li>
<li>
<p><strong>Diagnostic</strong>. This tab allows to open two windows: CAN monitor and Ocsilloscope. Oscilloscope can be used for monitoring purposes and for setting up PID controller. CAN Monitor shows all of the CAN-objects and can be used for monitoring.</p>
</li>
<li>
<p><strong>Device information.</strong> Is shows state of the motor controller, state of the CAN bus, errors and information about fieldbus parameters.
<img src="AgvInterfaces/MotorControllers/Engel/./media-en/image12.png" alt="" /></p>
</li>
</ol>
<h2 id="troubleshooting-10"><a class="header" href="#troubleshooting-10">Troubleshooting</a></h2>
<h3 id="can-bus-errors-1"><a class="header" href="#can-bus-errors-1">CAN-bus errors</a></h3>
<p>If CAN-bus is not working correctly, make sure that following things are checked:</p>
<ul>
<li>
<p>CAN-bus has 120ohm resistors activated on the both end of the bus.
The total CAN-bus impedance has to be approximately 60 ohms.</p>
</li>
<li>
<p>Check that all motor controllers and other CAN-devices in the bus have same baudrate</p>
</li>
<li>
<p>Make sure that all CAN-devices on the bus have individual NodeID</p>
</li>
<li>
<p>Double-check Navitrol parameters in this document</p>
</li>
<li>
<p>Make sure that you have done also CAN-bus grounding</p>
<ul>
<li>
<p>If CAN-bus GND is not grounded, there might occur error frames in the CAN-bus</p>
</li>
<li>
<p>Higher baudrates require CAN-bus grounding because they require more accurate voltage levels</p>
</li>
</ul>
</li>
<li>
<p>More information about CAN-bus related errors can be found from <em>Navitrol - CAN TroubleShoot</em></p>
</li>
</ul>
<h3 id="motor-controller-issues-1"><a class="header" href="#motor-controller-issues-1">Motor controller issues</a></h3>
<p>If motor controller indicates some errors, try the following:</p>
<ul>
<li>
<p>If motor controller is not rotated, check the console or find for &quot;LogEngelErrors&quot; in the log.</p>
</li>
<li>
<p>More information about error can be received from EMCY message, Engel should send in error state. To read EMCY, find in the console of log: &quot;CAN: EMCY from node&quot;</p>
</li>
<li>
<p>Try to establish serial connection to check errors directly from the motor controller</p>
</li>
</ul>
<p>If it is written it the console &quot;okToDrive 0&quot;, this means that homing process has not successfully finished yet. For the first 20 seconds, it is normally. If process lasts more than 20 seconds, it means that there are some issues with homing process (probably, limit switch cannot be found).</p>
<p>If it is written in the console &quot;DI1 is not set. It is not possible to set motor controller to operation mode&quot; then DI1 should be powered to solve the problem.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kinco-can-motor-controller"><a class="header" href="#kinco-can-motor-controller">Kinco CAN motor controller</a></h1>
<p>Updated 26.06.2024</p>
<hr />
<h2 id="glossary-5"><a class="header" href="#glossary-5">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>OD</td><td>Object Dictionary</td></tr>
<tr><td>SDO</td><td>Service Data Object</td></tr>
<tr><td>PDO</td><td>Process Data Object</td></tr>
<tr><td>NMT</td><td>Network Management</td></tr>
<tr><td>RS232</td><td>Recommended Standard 232. Communication protocol for serial communication.</td></tr>
</tbody></table>
<hr />
<h2 id="overview-11"><a class="header" href="#overview-11">Overview</a></h2>
<h3 id="introduction-11"><a class="header" href="#introduction-11">Introduction</a></h3>
<p>Kinco offers single channel motor controllers that can be used for driving in the AGV.</p>
<p>This document provides instructions for configuring the motor controllers to be compatible with Navitrol.</p>
<h3 id="requirements-6"><a class="header" href="#requirements-6">Requirements</a></h3>
<p><strong>Hardware:</strong></p>
<ul>
<li>Supported Kinco Motor controller models can be found from the <a href="AgvInterfaces/MotorControllers/Kinco/../../../AgvInterfaces/SupportedDevices/SupportedDevices-en.html">List of supported devices</a>. </li>
<li>Connectors for wiring (or alternatively Kinco cables with connectors). Without the connectors, it is not possible to wire the motor controller. Types and number of connectors can be found from the Technical Manual for the motor controller.</li>
<li>Adapter for connecting the motor controller to PC. RS232 cable is required by the KincoServo+ software.</li>
</ul>
<p><strong>Software</strong></p>
<ul>
<li>Motor controller related software can be downloaded from: <a href="https://en.kinco.cn/download/download.html">Kinco Download site</a>.</li>
<li>The following item should be downloaded for the commissioning:
<ul>
<li><strong>KincoServo+</strong> for parameters adjustment and diagnostics</li>
</ul>
</li>
</ul>
<p><strong>Documentation</strong> </p>
<p>Technical manual is needed for the motor controller. It contains dimensions, wiring instructions and CANOpen messages. Additionally, it contains the commissioning instructions and the SDO object dictionary. Technical manual depends on the motor controller model and can be found on the <a href="https://en.kinco.cn/download/download.html">Kinco Download site</a>. </p>
<ul>
<li>The manual for OD1X4S and FD1X4S models:
<ul>
<li><strong>Kinco Low-Voltage User Manual</strong></li>
</ul>
</li>
<li>The Catalog contains some technical information of the driver and motor.
<ul>
<li><strong>Kinco Catalog Low voltage servo</strong></li>
</ul>
</li>
</ul>
<h3 id="limitations-4"><a class="header" href="#limitations-4">Limitations</a></h3>
<ul>
<li><strong>Motor controller might not support all functions (steering, driving, actuating)</strong>. See <a href="AgvInterfaces/MotorControllers/Kinco/../../../AgvInterfaces/SupportedDevices/SupportedDevices-en.html">List of supported devices</a> for information about the supported functionalities.</li>
<li>It is not possible to use Kinco motor controller with other motor controllers in the same AGV</li>
</ul>
<h3 id="dependencies-2"><a class="header" href="#dependencies-2">Dependencies</a></h3>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Kinco/../../../AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a>. </li>
</ul>
<hr />
<h2 id="electrical-connections-2"><a class="header" href="#electrical-connections-2">Electrical connections</a></h2>
<p>The connections might vary depending on the motor controller model. See <a href="https://en.kinco.cn/download/download.html">Kinco Download site</a> for further info.</p>
<hr />
<h2 id="quick-setup-1"><a class="header" href="#quick-setup-1">Quick setup</a></h2>
<p>The following steps should be done during commissioning:</p>
<h4 id="step-1-option-1-kincoservo"><a class="header" href="#step-1-option-1-kincoservo">Step 1 (Option 1): KincoServo+</a></h4>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Kinco/KincoMotorController-en.html#change-node-id-and-baud-rate">Change Node-ID and baud rate with KincoServo+</a></li>
</ul>
<h4 id="step-1-option-2-general-can-analyzer-commissioning"><a class="header" href="#step-1-option-2-general-can-analyzer-commissioning">Step 1 (Option 2): General CAN-analyzer Commissioning</a></h4>
<p>If you do not have KincoServo+ compatible adapter, the commissioning needs to be done by using a CAN analyzer.</p>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Kinco/KincoMotorController-en.html#change-node-id-and-baud-rate-with-can-analyzer">Changing Node-ID and baud rate with CAN-analyzer</a></li>
</ul>
<h4 id="step-2"><a class="header" href="#step-2">Step 2</a></h4>
<p>After the Node and baud-rate are set on all motor controllers, proceed to:</p>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Kinco/KincoMotorController-en.html#navitrol-parameterization-and-controller-tuning">Navitrol parameterization and controller tuning</a></li>
</ul>
<hr />
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>The indices of the following array parameters are: <br> <strong>Differential drive</strong>: <br> 0 = Left wheel <br> 1 = Right wheel <br> <strong>Mecanum</strong>: <br> 0 = Forward Left <br> 1 = Forward Right <br> 2 = Rear Left <br> 3 = Rear Right</td><td></td><td></td><td></td></tr>
<tr><td><strong>Drive Motor controllers</strong></td><td></td><td></td><td></td></tr>
<tr><td>mot_ctrl_drive_controller_type_arr[]</td><td>Int</td><td>4</td><td>4 = Kinco</td></tr>
<tr><td>mot_ctrl_drive_p_arr[]</td><td>Float</td><td>30.0</td><td>P value of the drive motor controller. 0.0 = this parameter not used. When tested with motor without any load, this was quite low value. For example, 30.0.</td></tr>
<tr><td>mot_ctrl_drive_i_arr[]</td><td>Float</td><td>0.0</td><td>I value of the drive motor controller. 0.0 = this parameter not used. When tested with motor without any load, this was set to 0.</td></tr>
<tr><td>mot_ctrl_drive_can_nodeid_arr[]</td><td>Int</td><td>1</td><td>Motor controller CAN node id for drive motor. 0 = this parameter not used. Default node id for kinco is 1.</td></tr>
<tr><td>mot_ctrl_drive_encoder_pulses_per_rev</td><td>Uint</td><td>4096</td><td>Encoder resolution (pulses per revolution) used to calculate RPM if drive motor does not provide that. 0 = this parameter not used.</td></tr>
<tr><td><strong>Other required parameters</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_primary_any_id</td><td>Int</td><td>1</td><td>Primary CAN valid PDO id's that can be registered: 0 = Only valid PDO id's can be registered, 1 = Any id can be registered. For Kinco, this is required to be 1 for Error reset SDO message register to CAN PDO.</td></tr>
<tr><td>can_nodeguard_guard_time_ms</td><td>Int</td><td>1000</td><td>Nodeguarding guard time [ms]: 0 = Nodeguard disabled</td></tr>
<tr><td>can_sync</td><td>Int</td><td>1</td><td>Navigation SW (Primary CAN) role for CANOpen SYNC messages: 0 = None, 1 = SYNC producer, 2 = SYNC consumer</td></tr>
</tbody></table>
<hr />
<h3 id="fine-tuning-1"><a class="header" href="#fine-tuning-1">Fine-tuning</a></h3>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>mot_ctrl_reset_errors_timer</td><td>Int</td><td>500</td><td>After the defined time (ms) Navitrol tries automatically reset motor control faults. Value 0 = fault reset disabled. When error is active on controller. Navitrol will start sending Error reset SDO within this interval until the errors are reset.</td></tr>
<tr><td>mot_ctrl_drive_encoder_pulses_per_rev_arr[]</td><td>Int</td><td>0</td><td>Encoder resolution (pulses per revolution) used to calculate RPM if drive motor does not provide that. 0 = this parameter not used. If AGV has motors with different resolution, this parameter can be used to override <strong>mot_ctrl_drive_encoder_pulses_per_rev</strong></td></tr>
</tbody></table>
<hr />
<h2 id="kincoservo-easy-commissioning"><a class="header" href="#kincoservo-easy-commissioning">KincoServo+ Easy Commissioning</a></h2>
<p>Kinco offers KincoServo+ for easy commissioning. It can be downloaded from <a href="https://en.kinco.cn/download/download.html">Kinco Download site</a>.</p>
<h3 id="change-node-id-and-baud-rate"><a class="header" href="#change-node-id-and-baud-rate">Change Node-ID and baud rate</a></h3>
<ul>
<li>
<p>Download KincoServo+ software and connect your PC to the motor controller (communication interface RS232).</p>
</li>
<li>
<p>The default baud rate for RS232 is 38400 and COM ID 1. If user does not know the COM ID, broadcast address 127 can be used instead.</p>
</li>
<li>
<p>The default CAN Node-ID is 1. It can be changed from <em>Driver -&gt; Driver Configuration -&gt; Node_ID</em>. </p>
<p><img src="AgvInterfaces/MotorControllers/Kinco/./media-en/Kinco_CAN_nodeid.png" alt="" /></p>
<blockquote>
<p>Change the Node-ID</p>
</blockquote>
</li>
<li>
<p>Change the CAN baud rate. Default baud rate for Kinco motor controller is 500 kbd. Please note that the Kinco motor controller and Navitrol baud rate needs to match.</p>
<p><img src="AgvInterfaces/MotorControllers/Kinco/./media-en/Kinco_CAN_Baudrate.png" alt="" /></p>
<blockquote>
<p>Change the baud rate.</p>
</blockquote>
</li>
<li>
<p>Go to the <em>Driver -&gt; Init Save Reboot</em> and click <em>Save Motor Parameters</em>, after that click <em>Reboot</em>.</p>
<p><img src="AgvInterfaces/MotorControllers/Kinco/./media-en/Kinco_SaveParams.png" alt="" /></p>
<blockquote>
<p>Save Motor parameters</p>
</blockquote>
</li>
<li>
<p>Repeat the same procedure for all motor controllers.</p>
</li>
</ul>
<h2 id="general-can-analyzer-commissioning-option-2"><a class="header" href="#general-can-analyzer-commissioning-option-2">General CAN-analyzer commissioning (Option 2)</a></h2>
<p>If you do not have the possibility to use KincoServo+ software, the commissioning needs to be done by using CAN analyzer. With this method each motor controller needs to be connected and configured separately on the bus.</p>
<h3 id="controller-switch-configuration"><a class="header" href="#controller-switch-configuration">Controller switch configuration</a></h3>
<ul>
<li>
<p>Connect the motor controller to your PC with a CAN-USB adapter.</p>
</li>
<li>
<p><strong>NOTE:</strong> The controller might have DIP switch that activates 120-ohm resistor. A CAN-bus needs 120-ohm resistors on both ends of the bus</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Kinco/./media-en/OD124S_DIP_Switch.png" alt="" /></p>
<blockquote>
<p>DIP switch from the OD124S controller.</p>
</blockquote>
<h3 id="change-node-id-and-baud-rate-with-can-analyzer"><a class="header" href="#change-node-id-and-baud-rate-with-can-analyzer">Change Node-ID and baud rate with CAN-analyzer</a></h3>
<p>The default Node-ID is 1 and the CAN baud rate is 500 kBd.</p>
<p>To change the baud rate and Node-ID, you need to change object 2F81:0h (baud rate) and 100B:0h (Node-ID). The changes in objects 2F81h and 100Bh must be stored by writing value 65766173h in object 1010h:1h. This can be done by following the sequence presented below in the table.</p>
<table><thead><tr><th>SEND/RESPONSE</th><th>COB ID (in hex 0x)</th><th>dlc</th><th>Data bytes (in hex 0x)</th><th>Description</th></tr></thead><tbody>
<tr><td>SEND</td><td>601</td><td>8</td><td>2F 0B 10 00 NODEID 00 00 00</td><td>Define Node-ID (put desired Node-ID to NODEID)</td></tr>
<tr><td>RESPONSE</td><td>581</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>SDO Response OK</td></tr>
<tr><td>SEND</td><td>601</td><td>8</td><td>2F 81 2F 00 <strong>19</strong> 00 00 00</td><td>SDO Upload request:<br>Change baud rate to 250 kbs<br> 0x01 = 10 kbd, 0x05 = 50 kbd, 0x0C = 125 kbd,<br> 0x19 = 250 kbd, 0x32 = 500 kbd, 0x64 = 1000 kbd</td></tr>
<tr><td>RESPONSE</td><td>581</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td></tr>
<tr><td>SEND</td><td>601</td><td>8</td><td>23 10 10 01 73 61 76 65</td><td>SDO Upload request:<br>Save all communication  parameters</td></tr>
</tbody></table>
<blockquote>
<p>Change Node-ID and baud rate with CAN-analyzer</p>
</blockquote>
<p><strong>After you have done these changes, turn off the motor controller and then turn the motor controller back on, the Node-ID and baud rate should be set to the values you just sent to the motor controller.</strong></p>
<h2 id="navitrol-parameterization-and-controller-tuning"><a class="header" href="#navitrol-parameterization-and-controller-tuning">Navitrol parameterization and controller tuning</a></h2>
<h3 id="node-id-and-can-bus-bitrate"><a class="header" href="#node-id-and-can-bus-bitrate">Node-ID and CAN bus bitrate</a></h3>
<p>Node-ID defines the address of the CANopen device and it must be in range from 1 to 127. In addition, the Node-ID has to be unique for each device on the CAN bus.</p>
<p>CAN bus bitrate (baud rate) is the communication speed. By following these instructions, this speed is set to 250 Kbit/s for the motor controllers. The speed needs to be the same for Navitrol and motor controllers, otherwise the CAN bus communication will not work.</p>
<p>Every motor controller has a Node-ID. params.txt file has a parameter for each motor controller Node-ID and a parameter for Navitrol CAN bus bitrate. </p>
<p>First, set Node-ID to the corresponding parameters:</p>
<ul>
<li><strong>mot_ctrl_drive_can_nodeid_arr</strong></li>
</ul>
<p>Set the communication parameters (<strong>can_ch</strong> and <strong>can_bitrate_k</strong>) according to <a href="AgvInterfaces/MotorControllers/Kinco/../../../AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</p>
<h3 id="pi-controller-values-tuning"><a class="header" href="#pi-controller-values-tuning">PI-controller values tuning</a></h3>
<p>All Kinco motor controllers have an internal PI-controller that must be tuned. These controllers must be tuned. Rule of thumb instructions to find the optimal parameters are presented below (reference from Kinco CANopen document).</p>
<p>*1. According to oscillation and noise sensed with the finger and the ears: This method is based on experience,but it’s efficient. The user can listen to or touch the machine, at the same time increasing and reducing the <strong>kvp</strong>. When an acceptable maximum <strong>kvp</strong> value is found, the current setting can be specified as the maximum velocity loop bandwidth. <br></p>
<ol start="2">
<li>According to the scope image from KincoServo+: The user can create a jump command for velocity control and sample actual velocity and current while changing <strong>kvp</strong>. The right velocity curve should quickly fulfil the command without oscillation and unusual noise.*</li>
</ol>
<p>Motor controller can be tuned </p>
<ul>
<li>Modifying the <em>Kvp</em> and Kvi/32 parameters with KincoServo+ software. After the optimal parameters are found, save those to the Navitrol parameters (params.txt) </li>
<li>Modifying Navitrol P- and I-gain parameters with Navitrol and Navitrol Monitor. When Navitrol starts, it will always override the motor controller P- and I-gain values based on Navitrol parameters.</li>
</ul>
<p>The P-gain can be set with <strong>mot_ctrl_drive_p_arr</strong>. These values are set to <em>Kvp[0]</em> (SDO Object Index 0x60F9 SubIndex 0x01) parameter from Kinco documentation.
The I-gain can be set with <strong>mot_ctrl_drive_i_arr</strong>. These values are set to <em>Kvi/32</em> (SDO Object Index 0x60F9 SubIndex 0x07) parameter from Kinco documentation. The <em>Kvi[0]</em> (SDO Object Index 0x60F9 SubIndex 0x02) is not used with Navitrol, it is kept as 0. </p>
<h3 id="sdo-parameters-for-can-open"><a class="header" href="#sdo-parameters-for-can-open">SDO-parameters for CAN-open</a></h3>
<p>Navitrol configures a subset of Kinco motor controller's SDO-parameters when Navitrol starts.
These configurations are sent as SDO-messages to the motor controllers. The SDO-messages that Navitrol configures can be seen on the table below.
The parameters for automatic SDO-configurations (for example, SDO message interval and SDO message response timeout) are presented on the <a href="AgvInterfaces/MotorControllers/Kinco/../../../AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</p>
<p><strong>SDO Object table</strong></p>
<table><thead><tr><th>Name</th><th>Address</th><th>Data type</th><th>Value in hex</th><th>Description</th></tr></thead><tbody>
<tr><td>Invert direction</td><td>607E0008</td><td>Unsigned8</td><td>0</td><td>Invert motion <br> 0：CCW is positive direction <br> 1：CW is positive direction</td></tr>
<tr><td>Kvp</td><td>60F90110</td><td>Unsigned16</td><td>0</td><td>Bigger Kvp, bigger gain, but it may cause motor noise. Navitrol set the value based on <strong>mot_ctrl_drive_p_arr</strong> parameter. The parameter value is converted to integer. For example, if this parameter is set to 200.4, the written value is: 200 (0xC8 in hex).</td></tr>
<tr><td>Kvi</td><td>60F90210</td><td>Unsigned16</td><td>0</td><td>Bigger Kvi, bigger gain, but it may cause motor noise</td></tr>
<tr><td>Kvi/32</td><td>60F90710</td><td>Unsigned16</td><td>0</td><td>It is 1/31 of the normal kvi. Navitrol set the value based on <strong>mot_ctrl_drive_i_arr</strong> parameter. The parameter value is multiplied with 32 and rounded to the nearest larger integer. For example, if this parameter is set to 1.3, the written value is: 1.3 * 32.0 = 41.6 -&gt; 42 (0x2A in hex).</td></tr>
<tr><td>Operation mode</td><td>60600008</td><td>Integer8</td><td>3</td><td>Operation mode: <br> 1: Position control <br> 3: Speed control <br> 4: Torque control <br> -3：Speed control (Quick fast mode) <br> -4：Pulse train control <br> 6：Home mode <br> 7：Differential complementarity based on CANopen</td></tr>
<tr><td>Din1_Function</td><td>20100310</td><td>Unsigned16</td><td>2</td><td>0002: Reset Errors function set to Din1</td></tr>
<tr><td>Din_Simulate</td><td>20100210</td><td>Unsigned16</td><td>0</td><td>bit0: Din1. Used to reset errors when bit0 is changed from 0 to 1.</td></tr>
<tr><td>Abort connection mode</td><td>60070010</td><td>Unsigned16</td><td>1</td><td>CAN communication abort time determine action logic when driver still do not receive node protection message over <strong>node guarding time</strong> * <strong>node guarding factor</strong> <br> 0: no process <br> 1: error</td></tr>
<tr><td>Nodeguarding guard time</td><td>100C0010</td><td>Unsigned16</td><td>0xC8</td><td>Nodes protect masters, it can monitor current state of every node. Masters (node protection time as period) send remote frame to check slave node state. Nodes need to response in a time. Otherwise, master nodes regard slave nodes off-line. Driver will have alarms. Navitrol set the value based on <strong>can_nodeguard_guard_time_ms</strong> parameter.</td></tr>
<tr><td>Life Time Factor</td><td>100D0008</td><td>Unsigned8</td><td>3</td><td>Node guarding time factor</td></tr>
</tbody></table>
<blockquote>
<p>SDO Object table that Navitrol configures during startup. <br>The address contains Object Index, SubIndex and data type as following: <br> For example address 607E0208: <br> Object index = 0x607E <br> SubIndex = 0x02 <br> Data type = 0x08 (0x08 = 1 byte, 0x10 = 2 bytes, 0x20 = 4 bytes)</p>
</blockquote>
<h2 id="troubleshooting-11"><a class="header" href="#troubleshooting-11">Troubleshooting</a></h2>
<h3 id="motor-is-not-spinning-when-sending-rpm-value-to-it-and-there-is-no-error-code"><a class="header" href="#motor-is-not-spinning-when-sending-rpm-value-to-it-and-there-is-no-error-code">Motor is not spinning when sending RPM value to it and there is no error code</a></h3>
<p>The encoder resolution might be incorrect. Kinco communication protocol is not using RPM value for speed, but instead Kinco internal decimal value that Navitrol will calculate from RPM based on encoder resolution parameter. By default, these parameters are 0 and with that value the measured RPM and target RPM are so low that the motor is not spinning. </p>
<p>Citation from Kinco document: <br>
<em>For example, engineering unit of speed is rpm and internal unit is dec. The relationship is:
1RPM = 2730dec (Encoder resolution 10000)! It is assumed that if the speed is 10rpm, user need to write
27300dec (6AA4 in HEX) when use communication to control. The decimal value is calculated from this formula: DEC = [(RPM * 512 * encoder resolution) / 1875]</em></p>
<p>Check that these parameters have correct values. </p>
<ul>
<li><strong>mot_ctrl_drive_encoder_pulses_per_rev</strong> and <strong>mot_ctrl_drive_encoder_pulses_per_rev_arr</strong></li>
</ul>
<h3 id="can-bus-errors-2"><a class="header" href="#can-bus-errors-2">CAN-bus errors</a></h3>
<p>If CAN-bus is not working correctly, make sure that following things are checked:</p>
<ul>
<li>CAN-bus has 120 ohm resistors activated on the both end of the bus. The total CAN-bus impedance has to be approximately 60 ohms.</li>
<li>If the motor controller has PID switch for the resistor, check that it is set to correct position.</li>
<li>Check that all motor controllers and other CAN-devices in the bus have same baud rate</li>
<li>Make sure that all CAN-devices on the bus have individual Node-ID</li>
<li>Double-check Navitrol parameters in this document</li>
<li>Make sure that you have also done CAN-bus grounding
<ul>
<li>If CAN-bus GND is not grounded, there might occur error frames in the CAN-bus</li>
<li>Higher baud rates require CAN-bus grounding because they require more accurate voltage levels</li>
</ul>
</li>
<li>More information about CAN-bus related errors can be found from <a href="AgvInterfaces/MotorControllers/Kinco/../../../AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html#troubleshooting-can-communication">Navitrol CANOpen Communication Troubleshooting</a>.</li>
</ul>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<p><a href="https://en.kinco.cn/download/download.html">Kinco Download site</a></p>
<ul>
<li>KincoServo+</li>
<li>Kinco Low-Voltage User Manual</li>
<li>Models OD1X4S and FD1X4S</li>
</ul>
<p><a href="https://www.peak-system.com/PCAN-USB.199.0.html?L=1">PEAK PCAN-USB Adapter</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nanotec-can-motor-controller"><a class="header" href="#nanotec-can-motor-controller">Nanotec CAN motor controller</a></h1>
<p>Updated 26.06.2024</p>
<hr />
<h2 id="glossary-6"><a class="header" href="#glossary-6">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>OD</td><td>Object Dictionary</td></tr>
<tr><td>SDO</td><td>Service Data Object</td></tr>
<tr><td>PDO</td><td>Process Data Object</td></tr>
<tr><td>NMT</td><td>Network Management</td></tr>
</tbody></table>
<hr />
<h2 id="overview-12"><a class="header" href="#overview-12">Overview</a></h2>
<h3 id="introduction-12"><a class="header" href="#introduction-12">Introduction</a></h3>
<p>Nanotec motor controller is one of the motor controllers supported by Navitrol. Nanotec offers single channel motor controllers that can be used for different purposes (steering, driving, actuator) in the AGV.</p>
<p>This document provides instructions for configuring the motor controllers to be compatible with Navitrol.</p>
<h3 id="requirements-7"><a class="header" href="#requirements-7">Requirements</a></h3>
<p><strong>Hardware:</strong></p>
<ul>
<li>Supported motor controller (<a href="AgvInterfaces/MotorControllers/Nanotec/../../SupportedDevices/SupportedDevices-en.html">List of supported devices</a> document should be checked)</li>
<li>Connectors for wiring (or alternatively Nanotec cables with connectors). Without the connectors, it is not possible to wire the motor controller. Types and number of connectors can be found from the Technical Manual for the motor controller.</li>
<li>Adapter for connecting the motor controller to PC. IXXAT or PEAK is required by the Nanotec Plug &amp; Drive Studio software. It is recommended to check compatible CAN adapter versions from <a href="https://en.nanotec.com/fileadmin/files/Software/Plug_Drive_Studio/Quick_start_guide_2.1.7.pdf">Plug &amp; Drive Studio Quick Start Guide</a>.</li>
</ul>
<p><strong>Software</strong></p>
<ul>
<li>In order to change motor controller parameters conveniently, <a href="https://en.nanotec.com/products/2533-plug-drive-studio-2">Plug &amp; Drive Studio 2</a> is recommended for use. Check <a href="https://en.nanotec.com/fileadmin/files/Software/Plug_Drive_Studio/Quick_start_guide_2.1.7.pdf">Plug &amp; Drive Studio Quick Start Guide</a> to get familiar with the software.</li>
<li>Drivers and monitoring software for CAN analyzers according to <a href="https://en.nanotec.com/fileadmin/files/Software/Plug_Drive_Studio/Quick_start_guide_2.1.7.pdf">Plug &amp; Drive Studio Quick Start Guide</a>.</li>
</ul>
<p><strong>Documentation</strong> </p>
<ul>
<li>Technical manual for the motor controller. It contains dimensions, wiring instructions and pinout. Additionally, it contains the commissioning instructions and the SDO object dictionary. 
Technical manual depends on the motor controller type and can be found on the Nanotec official site. There are known differences between the firmware versions, therefore it is recommended to <strong>check that the technical manual is compatible with the motor controller's firmware version</strong></li>
</ul>
<h3 id="limitations-5"><a class="header" href="#limitations-5">Limitations</a></h3>
<ul>
<li><strong>Motor controller might not support all functions (steering, driving, actuating) and kinematics</strong>. <a href="AgvInterfaces/MotorControllers/Nanotec/../../SupportedDevices/SupportedDevices-en.html">List of supported devices</a> document should be checked to determine whether the combination of the function and kinematics is supported or not.</li>
<li>Currently, it is not possible to use Nanotec motor controller with other motor controllers in the same AGV</li>
</ul>
<h3 id="dependencies-3"><a class="header" href="#dependencies-3">Dependencies</a></h3>
<p>This feature is dependent on CAN interface. Therefore, it is recommended to check <a href="AgvInterfaces/MotorControllers/Nanotec/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</p>
<hr />
<h2 id="electrical-connections-3"><a class="header" href="#electrical-connections-3">Electrical connections</a></h2>
<p>Electrical connections must be done according to the Nanotec technical manual. The connections might vary depending on the motor controller model and user should refer to <a href="https://en.nanotec.com/downloads/manualsdatasheets">Nanotec motor controller technical manual</a>.</p>
<p><strong>Safety system connection</strong></p>
<p>Since Nanotec motor controller does not have STO (Safe Torque Off) feature, safety system has to cut power from the motor/motor controller. 
However, there is a functionality that allows to stop the motor controller using digital inputs.
This approach is not safety rated and therefore not recommended for use. This can be used only for prototyping at user's own risk.<br />
In order to enable this stopping functionality, connect digital input 1 and 2 to the AGV:s stop button. Note that both inputs are NC - meaning that they should be powered in normal situation and power should be removed to stop the AGV.</p>
<hr />
<h2 id="quick-setup-2"><a class="header" href="#quick-setup-2">Quick setup</a></h2>
<p>The following steps should be done during commissioning:</p>
<h4 id="step-1-option-1-nanotec-plug--drive-studio-easy-commissioning"><a class="header" href="#step-1-option-1-nanotec-plug--drive-studio-easy-commissioning">Step 1 (Option 1): Nanotec Plug &amp; Drive Studio Easy Commissioning</a></h4>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#controller-switch-and-can-bus-configuration">Controller switch and CAN-bus configuration</a></li>
<li><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#change-node-id-and-baud-rate">Change Node-ID and baud rate with Plug &amp; Drive</a></li>
<li><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#change-od-objects-and-execute-auto-setup">Change OD-objects and execute Auto-Setup</a></li>
</ul>
<h4 id="step-1-option-2-general-can-analyzer-commissioning-1"><a class="header" href="#step-1-option-2-general-can-analyzer-commissioning-1">Step 1 (Option 2): General CAN-analyzer Commissioning</a></h4>
<p>If you do not have Plug &amp; Drive studio compatible adapter, the commissioning needs to be done by using CAN analyzer.</p>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#controller-switch-configuration">Controller switch Configuration</a> </li>
<li><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#change-node-id-and-baud-rate-with-can-analyzer">Changing Node-ID and baud rate with CAN-analyzer</a></li>
<li><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#auto-setup-for-controller-tuning-with-can-analyzer">Auto-Setup for controller tuning with CAN-analyzer</a></li>
</ul>
<h4 id="step-2-1"><a class="header" href="#step-2-1">Step 2</a></h4>
<p>After the Auto-Setup has been done succesfully for all of the motor controllers, proceed to:</p>
<ul>
<li><a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#navitrol-parameterization-and-controller-tuning">Navitrol parameterization and controller tuning</a></li>
</ul>
<hr />
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>mot_ctrl_nanotec_p_gain</td><td>Int</td><td>60000</td><td>Nanotec motor controllers internal P-gain; min 1, max 270000</td></tr>
<tr><td>can_sync</td><td>Int</td><td>1</td><td>Navigation SW (Primary CAN) role for CANOpen SYNC messages: 0 = None, 1 = SYNC producer, 2 = SYNC consumer</td></tr>
<tr><td>mot_ctrl_nanotec_p_gain</td><td>Int</td><td>500</td><td>Nanotec motor controllers internal I-gain; min 1, max 10000</td></tr>
<tr><td><strong>Differential AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_diff_drive_left_nodeid</td><td>Int</td><td>30</td><td>Node-ID for diff drive left motor controller</td></tr>
<tr><td>can_diff_drive_right_nodeid</td><td>Int</td><td>31</td><td>Node-ID for diff drive right motor controller</td></tr>
<tr><td><strong>Mecanum AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>mot_ctrl_mecanum_nodeid[]</td><td>Int</td><td>0</td><td>CANopen Node-ID. 0 - not defined, Indexes are 0 = FF (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right)</td></tr>
</tbody></table>
<hr />
<h3 id="fine-tuning-2"><a class="header" href="#fine-tuning-2">Fine-tuning</a></h3>
<ul>
<li>If needed, the warning for E-STOP can be enabled from the motor controller using the <strong>nanotec_emergency_stop_IO_enabled</strong> parameter</li>
<li>Automatic error reset can be disabled using <strong>mot_ctrl_reset_errors_timer</strong>.</li>
</ul>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>nanotec_emergency_stop_IO_enabled</td><td>Int</td><td>0</td><td>Activates Nanotec E-STOP check. </br> Emergency stop activation comes from digital input 1 and 2 on the motor controller</td></tr>
<tr><td>mot_ctrl_reset_errors_timer</td><td>Int</td><td>500</td><td>After the defined time (ms) Navitrol tries automatically reset motor control faults. Value 0 = fault reset disabled</td></tr>
</tbody></table>
<hr />
<h2 id="nanotec-plug--drive-studio-easy-commissioning"><a class="header" href="#nanotec-plug--drive-studio-easy-commissioning">Nanotec Plug &amp; Drive Studio Easy Commissioning</a></h2>
<p>Nanotec offers Plug &amp; Drive studio 2 (https://en.nanotec.com/products/2533-plug-drive-studio-2) for easy commissioning. However, only Ixxat and PEAK CAN-adapters are supported by Plug &amp; Drive Studio.</p>
<h3 id="controller-switch-and-can-bus-configuration"><a class="header" href="#controller-switch-and-can-bus-configuration">Controller switch and CAN-bus configuration</a></h3>
<p>Turn the rotary switches on the controllers so that they point to values 1, 2, 3 and 4. If you have only 2 controllers, use values 1 and 2. The Node-ID of the motor controller will be the same is the value on the rotary switch. The baud rate of the switch is fixed to 1000 MBd.</p>
<p>After the switches for all motor controller are turned accordingly, connect all motor controllers to the CAN-bus. Note that all controllers on the bus need to have different rotary switch value as the value of the rotary switch will be the initial Node-ID of the controller. Only rotary switch values 1-4 are allowed.</p>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Set rotary switches to value 1, 2, 3 and 4</p>
</blockquote>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Connector assignment - right one shows bottom switches, including rotary switch / Hex coding switch.</p>
</blockquote>
<p>When all controllers are connected to the CAN-bus, plug the CAN-adapter to the bus and open Plug &amp; Drive Studio.</p>
<h3 id="change-node-id-and-baud-rate-1"><a class="header" href="#change-node-id-and-baud-rate-1">Change Node-ID and baud rate</a></h3>
<ul>
<li>
<p>Download <a href="https://en.nanotec.com/products/2533-plug-drive-studio-2">Plug &amp; Drive Studio 2.1.7</a> and connect to the CAN-bus</p>
</li>
<li>
<p>Update the firmware ( For example PD4-Cx-E-08-FIR-v2213-B1031134) to all motor controllers.
<img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/firmwareUpdate.png" alt="" /></p>
<blockquote>
<p>Update the firmware</p>
</blockquote>
</li>
<li>
<p>Change the Node-ID <br>
<img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/NodeIDChange.png" alt="" /></p>
<blockquote>
<p>Change the Node-ID</p>
</blockquote>
</li>
<li>
<p>Change the baud rate. Recommended baud rate is 125 kbd. <br>
<img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/baudRateChange.png" alt="" /></p>
<blockquote>
<p>Change the baud rate. 0x84 = 125 kbd, 0x85 = 250kbd, 0x86 = 500 kbd</p>
</blockquote>
</li>
<li>
<p>Go to the Setup Tab and click Save from Settings. Choose CanOpen configurations and click Save.</p>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/SaveToMotorControllers.png" alt="" /></p>
<blockquote>
<p>Save baud rate and Node-ID</p>
</blockquote>
</li>
<li>
<p>Repeat the same procedure for all motor controllers. For example configure the motor controllers to Node-ID:s 5, 6, 7 and 8.</p>
</li>
<li>
<p>After these settings are done, turn of the motor controllers and change rotary switches to value 8 for all motor controllers. Turn on the motor controllers back again.</p>
</li>
</ul>
<h3 id="change-od-objects-and-execute-auto-setup"><a class="header" href="#change-od-objects-and-execute-auto-setup">Change OD-objects and execute Auto-Setup</a></h3>
<ul>
<li>Connect controller with Plug &amp; Drive Studio. Choose CanOpen and baud rate is 125kBd. Click Scan.</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/scanNodeIDs.png" alt="" />
&gt; Scan Node-ID:s</p>
<ul>
<li>
<p>After a successful scan, choose motor controller from a list. <br></p>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/scannedNodeIDList.png" alt="" /></p>
<blockquote>
<p>Node-ID List</p>
</blockquote>
</li>
<li>
<p>Change first OD 604C Subindex 2 to value 1 (VL Dimension Factor Denominator). This needs to be changed with newer firmware version.</p>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/dimensionfactordenominator.png" alt="" /></p>
<blockquote>
<p>Change VL Dimension Factor Denominator</p>
</blockquote>
</li>
<li>
<p>Click Setup from the navigation Tab and choose Auto-Setup.</p>
<p><strong>NOTE:</strong> <strong>the following prerequisites for performing the Auto-Setup</strong>:</p>
<ul>
<li>The motor must be load-free.</li>
<li>The motor must not be touched.</li>
<li>The motor must be able to turn freely in any direction.</li>
</ul>
</li>
</ul>
<br>
<ul>
<li>
<p>Start Auto-Setup. The motor will start to spin and make some noise. After Auto-Setup is completed, a pop-up window will show up to save Auto-Setup result. Click Save and restart.</p>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/startAutoSetup.png" alt="" /></p>
<blockquote>
<p>Start Auto-Setup</p>
</blockquote>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/acceptAutoSetup.png" alt="" /></p>
<blockquote>
<p>Accept and Save Auto-Setup result</p>
</blockquote>
</li>
</ul>
<p>Repeat the same procedure for all motor controllers. After Auto-Setup has been successfully completed for all motor controllers, proceed to <a href="AgvInterfaces/MotorControllers/Nanotec/NanotecMotorController-en.html#navitrol-parameterization-and-controller-tuning">Navitrol Parameterization and Controller tuning</a>.</p>
<h2 id="general-can-analyser-commissioning-option-2"><a class="header" href="#general-can-analyser-commissioning-option-2">General CAN-analyser commissioning (Option 2)</a></h2>
<p>If you do not have the possibility to use PEAK PCAN-USB adapter or Ixxat adapter, the commissioning needs to be done by using CAN analyzer. With this method each motor controller needs to be connected and configured separately on the bus.</p>
<h3 id="controller-switch-configuration-1"><a class="header" href="#controller-switch-configuration-1">Controller switch configuration</a></h3>
<ul>
<li>
<p>Connect the motor controller to your PC with a CAN-USB adapter.</p>
</li>
<li>
<p>Set the rotary switch to value &quot;1&quot; from the bottom of the motor controller</p>
</li>
<li>
<p><strong>NOTE:</strong> Next to the rotary switch is a DIP switch that activates 120-ohm resistor. A CAN-bus needs 120-ohm resistors on both ends of the bus</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Set rotary switch to value 1</p>
</blockquote>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Connector assignment - right one shows bottom switches, including the rotary switch.</p>
</blockquote>
<h3 id="change-node-id-and-baud-rate-with-can-analyzer-1"><a class="header" href="#change-node-id-and-baud-rate-with-can-analyzer-1">Change Node-ID and baud rate with CAN-analyzer</a></h3>
<p>Turn the rotary switch so that it points to value &quot;1&quot;. Then the Node-ID is fixed to value &quot;1&quot; and the baud rate is permanently set to 1000 kBd.</p>
<p>To change the baud rate and Node-ID, you need to change object 2005:0h (baud rate) and 2009:0h (Node-ID). The changes in objects 2005h and 2009h must be stored by writing value 65766173h in object 1010h:2h. This can be done by following the sequence presented below in the table.</p>
<table><thead><tr><th>SEND/RESPONSE</th><th>COB ID (in hex 0x)</th><th>dlc</th><th>Data bytes (in hex 0x)</th><th>Description</th><th>Note</th></tr></thead><tbody>
<tr><td>SEND</td><td>601</td><td>8</td><td>22 09 20 00 NODEID 00 00 00</td><td>Define Node-ID (put desired Node-ID to NODEID)</td><td></td></tr>
<tr><td>RESPONSE</td><td>581</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>SDO Response OK</td><td></td></tr>
<tr><td>SEND</td><td>601</td><td>8</td><td>22 05 20 00 <strong>84</strong> 00 00 00</td><td>SDO Upload request:<br>change baud rate to 125kbs<br>0x84 = 125 kbd, 0x85 = 250kbd, 0x86 = 500 kbd</td><td></td></tr>
<tr><td>RESPONSE</td><td>581</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td><td></td></tr>
<tr><td>SEND</td><td>601</td><td>8</td><td>22 10 10 02 73 61 76 65</td><td>SDO Upload request:<br>Save all communication  parameters</td><td></td></tr>
</tbody></table>
<blockquote>
<p>Change Node-ID and baud rate with CAN-analyzer</p>
</blockquote>
<p><strong>After you have done these changes, turn off the motor controller and set the rotary switch to value &quot;8&quot;. When you turn the motor controller back on, the Node-ID and baud rate should be set to the values you just sent to the motor controller.</strong></p>
<h3 id="auto-setup-for-controller-tuning-with-can-analyzer"><a class="header" href="#auto-setup-for-controller-tuning-with-can-analyzer">Auto-Setup for controller tuning with CAN-analyzer</a></h3>
<p>To determine number of parameters related to the motor and the connected sensors (encoders/Hall sensors), an Auto-Setup is performed. <strong>Closed Loop</strong> operation requires a successfully completed Auto-Setup.</p>
<p><strong>NOTE:</strong> <strong>the following prerequisites for performing the Auto-Setup</strong>:</p>
<ul>
<li>The motor must be load-free.</li>
<li>The motor must not be touched.</li>
<li>The motor must be able to turn freely in any direction.</li>
</ul>
<p>To start the Auto-Setup do the following steps:</p>
<ol>
<li>Connect the motor controller to your PC with CAN-USB adapter and open CAN-analyzer.</li>
<li>Test that the interface works by sending SDO <em>40 41 60 00 00 00 00 00</em> to the controller.<br />
a. The controller should response with: <em>4B 41 60 00 XX XX 00 00</em>.</li>
<li>Then the Auto-Setup sequence has to be done next. Messages are in CANopen SDO-format. Follow the table below to complete the Auto-Setup.</li>
</ol>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Ladder diagram of Auto-Setup sequence</p>
</blockquote>
<table><thead><tr><th>SEND/RESPONSE</th><th>COB ID (in hex 0x)</th><th>dlc</th><th>Data bytes (in hex 0x)</th><th>Description</th><th>Note</th></tr></thead><tbody>
<tr><td>SEND</td><td>0</td><td>2</td><td>80 00</td><td>NMT : Switch all nodes to pre-operational mode</td><td></td></tr>
<tr><td>RESPONSE</td><td>700 + Node-ID</td><td>2</td><td>7F</td><td>NMT response: Response OK</td><td></td></tr>
<tr><td>SEND</td><td>600 + Node-ID</td><td>8</td><td>22 40 60 00 06 00 00 00</td><td>SDO Upload request : enable voltage and disable quick stop</td><td></td></tr>
<tr><td>RESPONSE</td><td>580 + Node-ID</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td><td> </td></tr>
<tr><td>SEND</td><td>600 + Node-ID</td><td>8</td><td>22 60 60 00 FE 00 00 00</td><td>SDO Upload request : Put operation mode to &quot;Auto Setup&quot;</td><td></td></tr>
<tr><td>RESPONSE</td><td>580 + Node-ID</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td><td></td></tr>
<tr><td>SEND</td><td>600 + Node-ID</td><td>8</td><td>22 40 60 00 07 00 00 00</td><td>SDO Upload request : Switch on the controller</td><td></td></tr>
<tr><td>RESPONSE</td><td>580 + Node-ID</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td><td></td></tr>
<tr><td>SEND</td><td>600 + Node-ID</td><td>8</td><td>22 40 60 00 0F 00 00 00</td><td>SDO Upload request: Enable Operation</td><td></td></tr>
<tr><td>RESPONSE</td><td>580 + Node-ID</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td><td></td></tr>
<tr><td>SEND</td><td>600 + Node-ID</td><td>8</td><td>22 40 60 00 1F 00 00 00</td><td>SDO Upload request: Start &quot;Auto Setup executing&quot;</td><td>wait for 30-60 seconds!!!</td></tr>
<tr><td>RESPONSE</td><td>580 + Node-ID</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td><td>wait for 30-60 seconds!!!</td></tr>
<tr><td>SEND</td><td>600 + Node-ID</td><td>8</td><td>22 40 60 00 00 00 00 00</td><td>SDO Upload request: Stop and finish</td><td></td></tr>
<tr><td>RESPONSE</td><td>580 + Node-ID</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>Response OK</td><td></td></tr>
</tbody></table>
<blockquote>
<p>Auto-Setup sequence with CAN-analyzer</p>
</blockquote>
<p>After the Auto-Setup is done, restart the controller. The controller should
now be ready to be used.</p>
<h2 id="navitrol-parameterization-and-controller-tuning-1"><a class="header" href="#navitrol-parameterization-and-controller-tuning-1">Navitrol parameterization and controller tuning</a></h2>
<h3 id="node-id-and-can-bus-bitrate-1"><a class="header" href="#node-id-and-can-bus-bitrate-1">Node-ID and CAN bus bitrate</a></h3>
<p>Node-ID defines the address of the CANopen device and it must be in range from 1 to 127. In addition, the Node-ID has to be unique for each device on the CAN bus.</p>
<p>CAN bus bitrate (baud rate) is the communication speed. By following these instructions, this speed is set to 125Kbit/s for the motor controllers. The speed needs to be the same for Navitrol and motor controllers, otherwise the CAN bus communication will not work.</p>
<p>Every motor controller has a Node-ID. params.txt file has a parameter for each motor controller Node-ID and a parameter for Navitrol CAN bus bitrate. </p>
<p>First, set Node-ID to the corresponding parameter according to Table &quot;CAN Node-ID parameters for motor controllers&quot; in <a href="AgvInterfaces/MotorControllers/Nanotec/../../MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html">Motor controllers common</a> document.</p>
<p>Set the communication parameters (<strong>can_ch</strong> and <strong>can_bitrate_k</strong>) according to <a href="AgvInterfaces/MotorControllers/Nanotec/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>can_bitrate_k</td><td>Int</td><td>125</td><td>Primary CAN bus bitrate in Kbit/s</td></tr>
<tr><td>can_ch</td><td>Int</td><td>0</td><td>Primary CAN channel number</td></tr>
<tr><td><strong>Differential AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_diff_drive_left_nodeid</td><td>Int</td><td>30</td><td>Node-ID for diff drive left motor controller</td></tr>
<tr><td>can_diff_drive_right_nodeid</td><td>Int</td><td>31</td><td>Node-ID for diff drive right motor controller</td></tr>
<tr><td><strong>Mecanum AGV</strong></td><td></td><td></td><td></td></tr>
<tr><td>mot_ctrl_mecanum_nodeid[]</td><td>Int</td><td>0</td><td>CANopen Node-ID. 0 - not defined, Indexes are 0 = FF (Forward Left), 1 = FR (Forward Right), 2 = RL (Rear Left), 3 = RR (Rear Right)</td></tr>
</tbody></table>
<h3 id="pi-controller-values-tuning-1"><a class="header" href="#pi-controller-values-tuning-1">PI-controller values tuning</a></h3>
<p>All Nanotec motor controllers have internal PI-controller. These controllers must be tuned. Rule of thumb instructions to find the optimum parameters are below (reference from Nanotec CANopen document).</p>
<p>1. You can increase the &quot;P&quot; value until the motor is starting to produce noise. Then reduce by half the value to get a good control loop setting.</p>
<p>2. If the motor is following the desired input parameter too slowly, increase the &quot;P&quot; value.</p>
<p>3. After finding a good &quot;P&quot; value, increase the &quot;I&quot; value to reduce the control error.</p>
<p>4. If the motor is producing overshoots after reaching the desired value, decrease the &quot;I&quot; value.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>mot_ctrl_nanotec_p_gain</td><td>Int</td><td>60000</td><td>Nanotec motor controllers internal P-gain; min 1, max 270000</td></tr>
<tr><td>mot_ctrl_nanotec_i_gain</td><td>Int</td><td>500</td><td>Nanotec motor controller internal I-gain; min 1, max 10000</td></tr>
</tbody></table>
<h3 id="sdo-parameters-for-can-open-1"><a class="header" href="#sdo-parameters-for-can-open-1">SDO-parameters for CAN-open</a></h3>
<p>Navitrol configures a subset of Nanotec motor controller's SDO-parameters when Navitrol starts.
These configurations are sent as SDO-messages to the motor controllers.
The parameters for automatic SDO-configurations are presented below.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>can_sdo_interval_ms</td><td>Int</td><td>30</td><td>SDO message interval [ms] used by Navitrol</td></tr>
<tr><td>can_sdo_timeout_ms</td><td>Int</td><td>20</td><td>SDO message response timeout [ms] used by Navitrol</td></tr>
</tbody></table>
<h2 id="extra-sdo-configurations"><a class="header" href="#extra-sdo-configurations">Extra SDO-configurations</a></h2>
<p>Nanotec motor controllers differ a bit depending on their firmware versions and motor controller models. Therefore, some extra SDO-configurations may be needed to make the motor controller work as expected. You can use either CAN Analyzer, Navitrol internal SDO-write configuration tools or Plug &amp; Drive Studio to change the configurations. Configurations are listed below.</p>
<table><thead><tr><th>Object Description</th><th>SubIndex</th><th>Value to Set in Hex</th><th>Motor Controller Type</th><th>Description</th><th>Note</th></tr></thead><tbody>
<tr><td>604C</td><td>2</td><td>1</td><td>PD2-C, PD4-C, PD6-C, N5</td><td>Dimension Factor Denominator</td><td>If motor controller uses firmware version FIR-v2139 or newer</td></tr>
<tr><td>3202</td><td>0</td><td>4 or 45</td><td>N5</td><td>Automatic brake control</td><td>- Value 45 with BLDC motors <br> - Value 4 otherwise</td></tr>
</tbody></table>
<h3 id="can-analyzer-1"><a class="header" href="#can-analyzer-1">CAN analyzer</a></h3>
<p>An example to change RPM scale using CAN-analyzer. The following messages needs to be sent to the motor controller (example Node-ID:s 5, 6, 7 and 8)</p>
<table><thead><tr><th>SEND/RESPONSE</th><th>COB ID (in hex 0x)</th><th>dlc</th><th>Data bytes (in hex 0x)</th><th>Description</th><th>Note</th></tr></thead><tbody>
<tr><td>SEND</td><td>605</td><td>8</td><td>22 4C 60 02 1 00 00 00</td><td>RPM scale 604Ch Subindex 2h: stock firmware value 3Ch</td><td></td></tr>
<tr><td>RESPONSE</td><td>585</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>SDO Response OK</td><td></td></tr>
<tr><td>SEND</td><td>606</td><td>8</td><td>22 4C 60 02 1 00 00 00</td><td>RPM scale 604Ch Subindex 2h: stock firmware value 3Ch</td><td></td></tr>
<tr><td>RESPONSE</td><td>586</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>SDO Response OK</td><td></td></tr>
<tr><td>SEND</td><td>607</td><td>8</td><td>22 4C 60 02 1 00 00 00</td><td>RPM scale 604Ch Subindex 2h: stock firmware value 3Ch</td><td></td></tr>
<tr><td>RESPONSE</td><td>587</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>SDO Response OK</td><td></td></tr>
<tr><td>SEND</td><td>608</td><td>8</td><td>22 4C 60 02 1 00 00 00</td><td>RPM scale 604Ch Subindex 2h: stock firmware value 3Ch</td><td></td></tr>
<tr><td>RESPONSE</td><td>588</td><td>8</td><td>60 xx xx xx xx xx xx xx</td><td>SDO Response OK</td><td></td></tr>
</tbody></table>
<p>Table 1: Change RPM scale with CAN-analyzer</p>
<h3 id="navitrol-sdo-write"><a class="header" href="#navitrol-sdo-write">Navitrol SDO write</a></h3>
<p>Another option to change the SDO-configurations is to write the SDO-configurations with sdo_write.txt file. Add first a parameter:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>can_sdo_write_from_file</td><td>Int</td><td>1</td><td>0 - no SDO writes from file, 1 - write content from sdo_write.txt</td></tr>
</tbody></table>
<p>Then add <em>sdo_write.txt</em> file to <em>/home/navitec</em> folder with the SDO configuration content. Example below:</p>
<pre><code># This sdo_write.txt configuration file overrides RPM dimension scale
# Node 5 - 8
# WRITE,Node-ID,dataType,index.subIndex,value

WRITE,5,I32,0x604C.2,0x0001 # RPM scale 604Ch Subindex 2h: stock firmware value 3Ch, latest firmware value 01h

WRITE,6,I32,0x604C.2,0x0001 # RPM scale 604Ch Subindex 2h: stock firmware value 3Ch, latest firmware value 01h

WRITE,7,I32,0x604C.2,0x0001 # RPM scale 604Ch Subindex 2h: stock firmware value 3Ch, latest firmware value 01h

WRITE,8,I32,0x604C.2,0x0001 # RPM scale 604Ch Subindex 2h: stock firmware value 3Ch, latest firmware value 01h
</code></pre>
<h2 id="troubleshooting-12"><a class="header" href="#troubleshooting-12">Troubleshooting</a></h2>
<h3 id="nanotec-sdo-errors"><a class="header" href="#nanotec-sdo-errors">Nanotec SDO errors</a></h3>
<p>Nanotec SDO errors might occur if something was done incorrectly during the commissioning. The list of SDO errors can be found from <a href="https://en.nanotec.com/fileadmin/files/Handbuecher/Handbuecher_Archiv/Plug_Drive/PD4C_CANopen_Technical-Manual_V2.0.1.pdf">Nanotec PD4-C Technical manual</a>, page 102.</p>
<p><img src="AgvInterfaces/MotorControllers/Nanotec/./media-en/image7.png" alt="" /></p>
<blockquote>
<p><a href="https://en.nanotec.com/fileadmin/files/Handbuecher/Handbuecher_Archiv/Plug_Drive/PD4C_CANopen_Technical-Manual_V2.0.1.pdf">Nanotec SDO errors</a></p>
</blockquote>
<h3 id="can-bus-errors-3"><a class="header" href="#can-bus-errors-3">CAN-bus errors</a></h3>
<p>If CAN-bus is not working correctly, make sure that following things are checked:</p>
<ul>
<li>
<p>CAN-bus has 120ohm resistors activated on the both end of the bus. The total CAN-bus impedance has to be approximately 60 ohms.</p>
</li>
<li>
<p>Check that all motor controllers and other CAN-devices in the bus have same baud rate</p>
</li>
<li>
<p>Make sure that all CAN-devices on the bus have individual Node-ID</p>
</li>
<li>
<p>Double-check Navitrol parameters in this document</p>
</li>
<li>
<p>Make sure that you have also done CAN-bus grounding</p>
<ul>
<li>
<p>If CAN-bus GND is not grounded, there might occur error frames in the CAN-bus</p>
</li>
<li>
<p>Higher baud rates require CAN-bus grounding because they require more accurate voltage levels</p>
</li>
</ul>
</li>
<li>
<p>More information about CAN-bus related errors can be found from <a href="AgvInterfaces/MotorControllers/Nanotec/../../GenericInterfaces/CanCommunication/CanCommunication-en.html#troubleshooting-can-communication">Navitrol CANOpen Communication Troubleshooting</a></p>
</li>
</ul>
<h2 id="references-1"><a class="header" href="#references-1">References</a></h2>
<p><a href="https://en.nanotec.com/products/1622-pd4-cb59m024035-e-08/">Nanotec PD4-CB59 Controller</a></p>
<p><a href="https://www.peak-system.com/PCAN-USB.199.0.html?L=1">PEAK PCAN-USB Adapter</a></p>
<p><a href="https://en.nanotec.com/products/2533-plug-drive-studio-2">Nanotec Plug &amp; Drive Studio 2</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oriental-can-motor-controller"><a class="header" href="#oriental-can-motor-controller">Oriental CAN Motor Controller</a></h1>
<p>Updated 26.06.2024</p>
<hr />
<h2 id="glossary-7"><a class="header" href="#glossary-7">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>SDO</td><td>Service Data Object</td></tr>
<tr><td>PDO</td><td>Process Data Object</td></tr>
<tr><td>BLTS-01</td><td>Software for BLV-R Series motor controllers</td></tr>
<tr><td>MXE-02</td><td>Upgraded software for BLV-R Series motor controllers</td></tr>
</tbody></table>
<hr />
<h2 id="introduction-13"><a class="header" href="#introduction-13">Introduction</a></h2>
<p>Oriental motor controller is one of the motor controllers supported by Navitrol. Oriental offers single channel motor controllers that can be used for different purposes (steering, driving, actuator) in the AGV.</p>
<p>In this documentation, instructions are provided for configuring the motor controllers so that motor controllers would work with Navitrol.
Operation of the device is possible via CANopen fieldbus.</p>
<p>Following motor controllers has been tested by Navitec Systems:</p>
<ul>
<li><strong>BLV-R Series</strong>. It contains of two parts: driver (controls the operation of the motor) and BLDC motor with encoder.</li>
<li>Driver has 1 DC motor connection (can be used for driving/steering).</li>
<li>Only Oriental motors are compatible with the driver.</li>
</ul>
<p>The initial parameterization/configuration of the device takes place with the support software. Initially, configuration was done by BLTS-01 software. However, currently it is recommended to use updated software - MXE-02.</p>
<p>Currently, Oriental motor controllers can be supported for several kinematics:</p>
<ul>
<li>
<p>Diff drive</p>
</li>
<li>
<p>Steer drive</p>
</li>
<li>
<p>Steer drive with a differential sub unit</p>
</li>
<li>
<p>Omni drive</p>
</li>
<li>
<p>Omni drive with a differential sub unit</p>
</li>
<li>
<p>Mecanum drive </p>
</li>
</ul>
<h2 id="electrical-connections-4"><a class="header" href="#electrical-connections-4">Electrical connections</a></h2>
<p>Electrical connections can be divided into four groups:</p>
<ol>
<li>
<p><strong>Connecting main power supply</strong>
Main power supply should be wired to the connector CN1. Special cable connector should be used.</p>
</li>
<li>
<p><strong>Connecting motor</strong>
Motor should be wired to the connector CN2.</p>
</li>
<li>
<p><strong>Connecting encoder/brakes</strong>
Brakes and encoder should be connected to the connector CN3.</p>
</li>
<li>
<p><strong>Connecting the I/O signals (CN4)</strong>
Wires should be connected to the push terminals. The following pins are needed:</p>
<p>a. CAN connection -- Pin 5 (CAN_L),  Pin 6 (CAN_H) and Pin 7(CAN_GND)</p>
<p>b. Power supply for communication interface -- PIN 20 (NET-VIN) and Pin 21 (NET-GND)</p>
</li>
</ol>
<p><img src="AgvInterfaces/MotorControllers/Oriental/./media-en/Electrical_diagram.png" alt="" /></p>
<blockquote>
<p>Figure 1. Electrical diagram</p>
</blockquote>
<h2 id="commissioning-steps-1"><a class="header" href="#commissioning-steps-1">Commissioning steps</a></h2>
<p>The following steps should be done in process of commissioning:</p>
<ol>
<li>Connection to support software to set up CAN communication</li>
<li>Changing Navitrol parameters</li>
</ol>
<p>Note: Motor controller tuning (PID tuning) is not needed with the motor controller. If needed, motor controller speed and sensitivity can be selected from some of pre-defined values in the software.</p>
<h3 id="connection-to-the-software-to-set-up-can-communication"><a class="header" href="#connection-to-the-software-to-set-up-can-communication">Connection to the software to set up CAN communication</a></h3>
<p>Connection to the support software is done using the micro USB cable.
Connect micro USB cable as it shown in the Figure 1.</p>
<p>It is recommended to use updated support software - MXE-02. However, for some cases, old support software BLTS-01 can be used.</p>
<h4 id="setting-up-can-communication-using-mxe-02"><a class="header" href="#setting-up-can-communication-using-mxe-02">Setting up CAN communication using MXE-02</a></h4>
<p>Start the software. Note that it is recommended to use the software starting from version 4 in order to avoid incompatibility with older software versions of the driver.</p>
<p><img src="AgvInterfaces/MotorControllers/Oriental/./media-en/MXE-02_main.png" alt="" /></p>
<blockquote>
<p>Figure 2. Main interface of the MXE-02 software</p>
</blockquote>
<p>Once window opened, click on &quot;Select a product&quot;. The following panel should be opened in the left side of the screen.</p>
<p>Press &quot;Detect communication port&quot; (marked as step 1 on the figure) to refresh the list of devices. Once list is refreshed, select one of the options marked as step 2 on the figure.</p>
<p><img src="AgvInterfaces/MotorControllers/Oriental/./media-en/MXE-02_connect.png" alt="" /></p>
<blockquote>
<p>Figure 3. Connection to the driver in MXE-02</p>
</blockquote>
<p>Once connected, press &quot;Start the simple settings&quot;. Software should establish connection to the motor controller.</p>
<p>After that, select desired NodeId and Baud Rate of the motor controller.
NodeId and Baud Rate should match Navitrol parameters and NodeId of each device should be unique on the bus. Save those values to the motor controller by pressing &quot;Reflecting on the driver&quot;.</p>
<p><img src="AgvInterfaces/MotorControllers/Oriental/./media-en/MXE-02_configurations.png" alt="" /></p>
<blockquote>
<p>Figure 4. Configuration in MXE-02</p>
</blockquote>
<p>Now, motor controller is ready for communication with Navitrol.</p>
<h4 id="setting-up-can-communication-using-blts-01"><a class="header" href="#setting-up-can-communication-using-blts-01">Setting up CAN communication using BLTS-01</a></h4>
<p>Start the software.</p>
<p><img src="AgvInterfaces/MotorControllers/Oriental/./media-en/BLTS-01_main.png" alt="" /></p>
<blockquote>
<p>Figure 5. Main interface of the BLTS-01 software</p>
</blockquote>
<p>Once window opened, click on &quot;Setting of communication&quot;. Select ORIENTAL MOTOR COM port.</p>
<p><img src="AgvInterfaces/MotorControllers/Oriental/./media-en/BLTS-01_connect.png" alt="" /></p>
<blockquote>
<p>Figure 6. Connection to the driver in BLTS-01 software</p>
</blockquote>
<p>Press &quot;Ok&quot; and window should be closed.</p>
<p>Next, press &quot;Data Reading (Product -&gt; PC)&quot;. The following window should be opened:</p>
<p><img src="AgvInterfaces/MotorControllers/Oriental/./media-en/BLTS-01_configurations.png" alt="" /></p>
<blockquote>
<p>Figure 7. Configuration in BLTS-01 software.</p>
</blockquote>
<p>Press &quot;Start the simple settings&quot;. Software should establish connection to the motor controller.</p>
<p>After that, select desired NodeId and Baud Rate of the motor controller.
NodeId and Baud Rate should match Navitrol parameters and NodeId of each device should be unique on the bus. Save those values to the motor controller by pressing &quot;Reflecting on the driver&quot;.</p>
<p>Now, motor controller is ready for communication with Navitrol.</p>
<h3 id="changing-navitrol-parameters-1"><a class="header" href="#changing-navitrol-parameters-1">Changing Navitrol parameters</a></h3>
<ul>
<li>
<p>First, set Node ID to the corresponding parameter according to Table &quot;CAN Node Id parameters for motor controllers&quot; in <a href="AgvInterfaces/MotorControllers/Oriental/../../MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html">Motor controllers common</a> document.</p>
</li>
<li>
<p>Set the communication parameters (<strong>can_ch</strong> and <strong>can_bitrate_k</strong>) according to <a href="AgvInterfaces/MotorControllers/Oriental/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document. In addition, set <strong>can_sync</strong> parameter to value 1.</p>
</li>
<li>
<p>In order to enable heartbeat, set parameter <strong>can_heartbeat_producer_enable to 1</strong> and <strong>navigation_software_node_id to any nodeId</strong> between [1..127] which is not used by other devices in the bus.</p>
</li>
<li>
<p><strong>It is highly recommended to enable heartbeat for safety reasons.</strong></p>
</li>
<li>
<p>Other motor controller settings are done using SDOs by Navitrol.</p>
</li>
</ul>
<h2 id="troubleshooting-13"><a class="header" href="#troubleshooting-13">Troubleshooting</a></h2>
<h3 id="can-bus-errors-4"><a class="header" href="#can-bus-errors-4">CAN-bus errors</a></h3>
<ul>
<li>Information about CAN-bus related errors and troubleshooting can be found from <a href="AgvInterfaces/MotorControllers/Oriental/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">Can Communication document</a></li>
</ul>
<h3 id="motor-controller-issues-2"><a class="header" href="#motor-controller-issues-2">Motor controller issues</a></h3>
<p>If motor controller indicates some errors and this error is not reset by Navitrol:</p>
<ul>
<li>
<p>Try to establish serial connection to check errors directly from the motor controller. To check errors, connect with BLTS-01 or MXE-02 software. Connect it the same way as when configuring (according to the instruction above). Press &quot;Start the simple settings&quot;. In the left bottom menu choose &quot;Alarm monitor&quot;.</p>
</li>
<li>
<p>Check Navitrol parameter <strong>I,mot_ctrl_reset_errors_timer.</strong> It should be positive in order for Navitrol to reset the error.</p>
</li>
<li>
<p>Some errors cannot be reset from the CAN bus by Navitrol (for instance, overvoltage or encoder disconnection). In such a case, a power cycle is required for the motor controller.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="synapticon-ethercat-motor-controller"><a class="header" href="#synapticon-ethercat-motor-controller">Synapticon EtherCAT Motor Controller</a></h1>
<p>Updated 22.05.2024</p>
<hr />
<h2 id="glossary-8"><a class="header" href="#glossary-8">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>SDO</td><td>Service Data Object</td></tr>
<tr><td>PDO</td><td>Process Data Object</td></tr>
<tr><td>OBLAC Drives</td><td>Software for commissioning Synapticon motor controllers</td></tr>
<tr><td>STO</td><td>Safe Torque Off</td></tr>
<tr><td>SBO</td><td>Safe Brake Output</td></tr>
</tbody></table>
<hr />
<h2 id="introduction-14"><a class="header" href="#introduction-14">Introduction</a></h2>
<p>Synapticon motor controller is one of the motor controllers supported by Navitrol. Synapticon offers single channel motor controllers that can be used for different purposes (steering, driving, actuator) in the AGV.</p>
<p>In this documentation, instructions are provided for configuring the motor controllers so that motor controllers are compatible with Navitrol.
Operation of the device is possible via EtherCAT fieldbus.</p>
<p>Following motor controllers has been tested by Navitec Systems:</p>
<ul>
<li><strong>SOMANET Node</strong>. This motor controller is single-channel and allows connecting BLDC motor with encoder and brakes.</li>
</ul>
<p>The initial parameterisation/configuration of the device takes place with the software OBLAC Drives.</p>
<p>Currently, Synapticon motor controllers can be supported for several kinematics:</p>
<ul>
<li>
<p>Diff drive (both left and right wheel)</p>
</li>
<li>
<p>Mecanum drive</p>
</li>
</ul>
<p>Ethercat absolute encoder support is required for other kinematic models.</p>
<h2 id="electrical-connections-5"><a class="header" href="#electrical-connections-5">Electrical connections</a></h2>
<p>Electrical connections should be done according to the <a href="https://www.synapticon.com/documentation/node/hw/wiring/node_wiring.html">Somanet Node wiring instructions</a>. Connections can be divided into several groups:</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/ConnectorsOverview.png" alt="" /></p>
<blockquote>
<p>Figure 1. Connectors overview</p>
</blockquote>
<ol>
<li>
<p><strong>Connecting main power supply</strong>
Main power supply should be wired to the power terminal to pin 5 and pin 6.</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/PowerTerminal.png" alt="" /></p>
<blockquote>
<p>Figure 2. Power terminals</p>
</blockquote>
<table><thead><tr><th>Terminal</th><th>Description</th></tr></thead><tbody>
<tr><td>1</td><td>Phase A</td></tr>
<tr><td>2</td><td>Phase B</td></tr>
<tr><td>3</td><td>Phase C</td></tr>
<tr><td>4</td><td>Phase D - brake 0-48 PWM</td></tr>
<tr><td>5</td><td>Ground</td></tr>
<tr><td>6</td><td>Main Power Supply 12-48 VDC</td></tr>
<tr><td>7</td><td>Optional Logic Ground</td></tr>
<tr><td>8</td><td>Optional Logic Supply 12-24 V</td></tr>
</tbody></table>
</li>
<li>
<p><strong>Connecting motor</strong>
BLDC motor should be connected to the power connector to pins 1,2,3.</p>
</li>
<li>
<p><strong>Connecting encoder</strong>
Encoder should be connected to one of the Encoder ports (either port 1 or port 2) depending on the encoder type.
Pinout for different encoder ports can be found using the <a href="https://www.synapticon.com/documentation/node/hw/wiring/node_encoders_and_io.html?Highlight=node%20encoder">Encoder and IO wiring instructions</a></p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/EncoderPort2.png" alt="" /></p>
<blockquote>
<p>Figure 3. Encoder Port 2 connection</p>
</blockquote>
<table><thead><tr><th>Pin</th><th>HALL</th><th>ABI (differential)</th><th>ABI (single-ended)</th><th>BISS</th><th>SSI</th></tr></thead><tbody>
<tr><td>1</td><td>*</td><td>*</td><td>*</td><td>MA-</td><td>Clock-</td></tr>
<tr><td>2</td><td>5V</td><td>5V</td><td>5V</td><td>5V</td><td>5V</td></tr>
<tr><td>3</td><td>GND</td><td>GND</td><td>GND</td><td>GND</td><td>GND</td></tr>
<tr><td>4</td><td>*</td><td>*</td><td>*</td><td>MA+</td><td>Clock+</td></tr>
<tr><td>5</td><td>C/H3</td><td>A-</td><td>A</td><td>SLO-</td><td>Data-</td></tr>
<tr><td>6</td><td>*</td><td>A+</td><td>*</td><td>SLO+</td><td>Data+</td></tr>
<tr><td>7</td><td>B/H2</td><td>B-</td><td>B</td><td>*</td><td>*</td></tr>
<tr><td>8</td><td>*</td><td>B+</td><td>*</td><td>*</td><td>*</td></tr>
<tr><td>9</td><td>A/H1</td><td>I-</td><td>I</td><td>*</td><td>*</td></tr>
<tr><td>10</td><td>*</td><td>I+</td><td>*</td><td>*</td><td>*</td></tr>
</tbody></table>
</li>
<li>
<p><strong>Connecting brakes</strong>
If Node controller is used, brakes should be connected between Phase D and Ground in Power Terminal.
If Node Safety controller is used, brakes should be connected to SBC out.</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/BrakeConnection.png" alt="" /></p>
<blockquote>
<p>Figure 4. Brake connection (safety)</p>
</blockquote>
<table><thead><tr><th>Terminal</th><th>Description</th></tr></thead><tbody>
<tr><td>1</td><td>Brake +</td></tr>
<tr><td>2</td><td>Brake -</td></tr>
</tbody></table>
</li>
<li>
<p><strong>Connecting safety</strong>
In case if Node Safety is used, setup of the safety features (STO, SBC) of the motor controller must be carried out by customer in order to use the motor controller according to the <a href="https://www.synapticon.com/documentation/node/hw/node_safety/node_safety_overview.html">Setup of the safety functions instruction</a>.</p>
<p>At least, bypass pins should be connected together in order to run the motor controller from Navitrol.</p>
<p><strong>NOTE: Navitec is not liable for AGV safety</strong></p>
</li>
<li>
<p><strong>Connecting EtherCAT bus</strong>
EtherCAT in and EtherCAT out pins should be connected to the EtherCAT bus.</p>
</li>
</ol>
<h2 id="commissioning-steps-2"><a class="header" href="#commissioning-steps-2">Commissioning steps</a></h2>
<p>The following steps should be done in process of commissioning:</p>
<ol>
<li>Installation of OBLAC Drives</li>
<li>Setting up the controller in the OBLAC Drives</li>
<li>Installation of firmware</li>
<li>PID tuning of the motor controller</li>
<li>Changing Navitrol parameters</li>
</ol>
<p>During the commissioning in OBLAC Drives, it is recommended to use the <a href="https://www.synapticon.com/documentation/oblac/oblac/od_setup/od_setup.html">manufacturer's instruction</a></p>
<p><strong>Commissioning should be done when AGV is off the ground.</strong></p>
<h3 id="installation-oblac-drives"><a class="header" href="#installation-oblac-drives">Installation OBLAC Drives</a></h3>
<p>There are two ways to run SOMANET OBLAC Drives:</p>
<ul>
<li>
<p>OBLAC Drives - physical machine that comes preinstalled with Linux OS and runs OBLAC Drives</p>
</li>
<li>
<p>OBLAC Drives Virtual Machine that comes preinstalled with OBLAC Drives. It can be run on Windows, Linux and macOS.</p>
</li>
</ul>
<p>Downloading and setting up OBLAC Drives Virtual Machine can be done using the <a href="https://www.synapticon.com/documentation/oblac/oblac/od_setup/virtual_machine.html">link</a></p>
<h3 id="installation-of-firmware"><a class="header" href="#installation-of-firmware">Installation of firmware</a></h3>
<ul>
<li>
<p>Open Virtual Machine and wait until it is launched.</p>
</li>
<li>
<p>Type in browser the IP address shown in the virtual machine.</p>
</li>
<li>
<p>OBLAC Drives will scan the connected devices and find drives. If the drive does not have a firmware (it will be shown after connection) or firmware version is less than 5.0, new firmware needs to be installed. If new firmware is installed, this step can be skipped.</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/NoFirmware.png" alt="" /></p>
<blockquote>
<p>Figure 5. Connecting the drive without firmware</p>
</blockquote>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/HasFirmware.png" alt="" /></p>
<blockquote>
<p>Figure 6. Connecting the drive without firmware</p>
</blockquote>
<ul>
<li>In Order to update the firmware, press on the &quot;Configuration&quot; icon. It will bring you to Configuration page. Select from menu &quot;Install Firmware&quot; option.</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/ConfigurationInstall.png" alt="" /></p>
<blockquote>
<p>Figure 7. Configuration - install firmware</p>
</blockquote>
<ul>
<li>Select from menu firmware to install (higher than 5.0) and press &quot;Start Installation&quot;</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/InstallFirmware.png" alt="" /></p>
<blockquote>
<p>Figure 8. Firmware installation</p>
</blockquote>
</li>
</ul>
<h3 id="setting-up-the-controller"><a class="header" href="#setting-up-the-controller">Setting up the controller</a></h3>
<p>Process of setting up the motor controller is explained in details in the <a href="https://www.synapticon.com/documentation/oblac/oblac/od_setup/oblac_box.html">instruction</a></p>
<ul>
<li>
<p>Open configuration page for the controller. Select &quot;Launch setup wizard&quot;</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/ConfigurationLaunchSetup.png" alt="" /></p>
<blockquote>
<p>Figure 9. Configuration - launch setup wizard</p>
</blockquote>
</li>
<li>
<p>It will first ask you to give a name to your drive.</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/ProductName.png" alt="" /></p>
<blockquote>
<p>Figure 10. Product name</p>
</blockquote>
</li>
<li>
<p>Configure brakes. Enter pull voltage, hold voltage, pull time and disable delay. Note that if brakes are used, clutch-style brake control should be used since Navitrol is not commanding the output voltage. Test brakes so that they can be released.</p>
<p>If there are issues with releasing brakes, check if &quot;Safe State&quot; active on the top of the page. If &quot;Safe state&quot; is active, check if safety system is powered or bypass is connected. Brakes cannot be released until safety system is powered (or safety bypass is connected).</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/SetUpBrake.png" alt="" /></p>
<blockquote>
<p>Figure 9. Brake set up</p>
</blockquote>
</li>
<li>
<p>Enter the details of the motor. Pay attention to the engineering units since motor data can be scaled differently.</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/SetUpMotor.png" alt="" /></p>
<blockquote>
<p>Figure 11. Motor set up</p>
</blockquote>
</li>
<li>
<p>Set up the encoder. First, choose the port where it is attached. After that, enter the parameters of the encoder. Rotate the shaft and check that it corresponds to the position of the shaft.</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/SetUpEncoderPort.png" alt="" /></p>
<blockquote>
<p>Figure 12. Encoder port</p>
</blockquote>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/SetUpEncoder.png" alt="" /></p>
<blockquote>
<p>Figure 13. Encoder set up</p>
</blockquote>
</li>
<li>
<p>Launch offset detection. It should start and finish automatically.</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/SetUpOffset.png" alt="" /></p>
<blockquote>
<p>Figure 14. Offset detection</p>
</blockquote>
</li>
</ul>
<h3 id="pid-tuning"><a class="header" href="#pid-tuning">PID tuning</a></h3>
<p>Process of tuning the motor controller is explained in details in the configuration software. <!-- Broken link, does not exist anymore. Couldn't find similar web page from new documentation web page. [instruction](https://doc.synapticon.com/oblac_drives/oblac_tuning/index.html) --></p>
<ul>
<li>
<p>Go to &quot;Tuning&quot; page and run system identification:</p>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/SystemIdentification.png" alt="" /></p>
<blockquote>
<p>Figure 15. System identification</p>
</blockquote>
</li>
<li>
<p>Then go to velocity tuning.</p>
<p>According to the manufacturer, it is recommended to:</p>
<ul>
<li>
<p>Set all constants k<sub>p</sub>, k<sub>i</sub> and k<sub>d</sub> are set to 0.</p>
</li>
<li>
<p>Set the reference velocity to 50% of rated motor velocity [rpm].</p>
</li>
<li>
<p>Increase kP until the measured speed is around 70% of the reference speed. As a suggestion start with k<sub>p</sub> equal to 0.1, and in each step increase k<sub>p</sub> with a factor of 2</p>
</li>
<li>
<p>Increase k<sub>i</sub> incrementally to increase the speed of velocity controller (as a suggestion start with k<sub>i</sub> equal to 0.01 and in each step increase it by a factor of 2).</p>
</li>
<li>
<p>Fine tune the controller</p>
</li>
<li>
<p>The parameter k<sub>d</sub> of the velocity controller can be kept at its default value (0).</p>
</li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Synapticon/./media-en/PIDtuning.png" alt="" /></p>
<blockquote>
<p>Figure 16. System identification</p>
</blockquote>
</li>
</ul>
<h3 id="changing-navitrol-parameters-2"><a class="header" href="#changing-navitrol-parameters-2">Changing Navitrol parameters</a></h3>
<ul>
<li>
<p>First, set slave address to the corresponding parameter according to Table &quot;EtherCAT address parameters for motor controllers&quot; in <a href="AgvInterfaces/MotorControllers/Synapticon/../../MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html">Motor controllers common</a> document.
Slave addresses are given by master in direction of physical position of the devices in the bus. E.g. first device connected to master would have slave address 1 and the one connected after it would have address 2 and so on. Note that slave addresses of devices on the bus must be unique.</p>
</li>
<li>
<p>Set the communication parameters (<strong>ethercat_enabled</strong>, bus type <strong>ethercat_mode</strong> and interface <strong>ethercat_inte_primary</strong>, <strong>ethercat_inte_secondary</strong>) according to <a href="AgvInterfaces/MotorControllers/Synapticon/../../GenericInterfaces/EthercatCommunication/EthercatCommunication-en.html">EtherCAT communication</a> document</p>
</li>
</ul>
<p>NOTE: Navitrol configures automatically communication related parameters in motor controller. Other motor controller settings are not set nor changed by Navitrol.</p>
<h2 id="troubleshooting-14"><a class="header" href="#troubleshooting-14">Troubleshooting</a></h2>
<h3 id="ethercat-bus-errors"><a class="header" href="#ethercat-bus-errors">EtherCAT bus errors</a></h3>
<ul>
<li>Information about EtherCAT related errors and troubleshooting can be found from <a href="AgvInterfaces/MotorControllers/Synapticon/../../GenericInterfaces/EthercatCommunication/EthercatCommunication-en.html#troubleshooting">Troubleshooting section of Ethercat communication document</a></li>
</ul>
<h3 id="motor-controller-issues-3"><a class="header" href="#motor-controller-issues-3">Motor controller issues</a></h3>
<p>If motor controller indicates some errors and this error is not reset by Navitrol:</p>
<ul>
<li>
<p>Try to establish connection with OBLAC Drives to check errors directly from the motor controller. Check if &quot;Safe State&quot; active on the controller. If &quot;Safe state&quot; is active, check the safety system.</p>
</li>
<li>
<p>Check Navitrol parameter <strong>I,mot_ctrl_reset_errors_timer.</strong> It should be positive in order for Navitrol to reset the error.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roboteq-open-loop-motor-controller-configuration"><a class="header" href="#roboteq-open-loop-motor-controller-configuration">Roboteq Open Loop Motor Controller Configuration</a></h1>
<p>Updated 22.05.2024</p>
<hr />
<h2 id="introduction-15"><a class="header" href="#introduction-15">Introduction</a></h2>
<p>Roboteq motor controllers are one of many motor controllers that Navitrol supports in AGVs. Roboteq offers different range of motor controllers that can be used for different uses via different interfaces. In this documentation, instructions are provided for configuring the motor controllers to be interfaced with Navitrol.</p>
<p>If a Roboteq motor controller is dual channel, then it can be used to control 2 motors. So, it means 1 Roboteq controller is needed for 1 steering + 1 driving motor or for 2 driving motors. For example, if there is an Omni AGV with 6 wheels, it would need 6 Roboteq controllers that can handle steering + driving of each of the 6 wheels.</p>
<p>It should be noted, that this document covers only open loop control mode with Roboteq controllers.</p>
<h2 id="setup-8"><a class="header" href="#setup-8">Setup</a></h2>
<p>The Roboteq offers extensive support and documentation for getting started. All the Roboteq products have specific PC utility software that provides an interface to the user for configuring the Roboteq products.</p>
<p>All product specific datasheets, documentation and software can be downloaded from the Roboteq website. <a href="http://www.roboteq.com">www.roboteq.com</a></p>
<p>In this document no specific version of motor controller is mentioned since the process for interfacing with Navitrol is same for all the motor controllers.</p>
<ul>
<li>
<p>To configure the Roboteq motor controllers, Roborun, a Roboteq motor control utility software needs to be installed on Windows PC.</p>
</li>
<li>
<p>It is assumed that the user has completed all the necessary physical wiring of motor controllers to the driving or steering encoders of the AGV.</p>
</li>
<li>
<p>Use the USB cable to connect the computer with the Roboteq motor controller and start the Roborun utility software.</p>
</li>
<li>
<p>Start the 'Roborun+' app and it should appear as below:</p>
</li>
</ul>
<h3 id="uploadsave-profile"><a class="header" href="#uploadsave-profile">Upload/Save Profile</a></h3>
<p>A profile is basically a file that contains the values to different options and parameters in the configuration window. Make sure that the controller is connected, this can be verified by seeing the 'Connected' in the bottom right corner of the window and a green indicator.</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/image4.png" alt="" /></p>
<p>There are different tabs in Roboteq motor control utility.</p>
<ol>
<li>
<p>The <strong>Configuration</strong> tab defines the settings for Inputs and outputs.</p>
</li>
<li>
<p>The <strong>Run</strong> tab allows different options for debugging and testing the motor controllers.</p>
</li>
<li>
<p>The <strong>Console</strong> tab allows outputs to be displayed while testing the motor controllers or running the scripts.</p>
</li>
<li>
<p>The <strong>Scripting</strong> tab allows scripts to be uploaded to motor controller, write, or edit them, as well as simulate the script.</p>
</li>
<li>
<p>The <strong>Load from Controller</strong> loads the profile if it already existing on the controller and then shows the values in Inputs/Outputs window.</p>
</li>
<li>
<p>If no such profile exists by default on the controller, then user can upload their own profile by using <strong>Load Profile from Disk</strong>. The profile files can either have an extension of <strong>*.cpr</strong> or <strong>*.xml</strong>.</p>
</li>
<li>
<p>The option 7 allows the script to be <strong>Run, Paused</strong> or <strong>Restarted.</strong> When a script is running then a user can test the motor controllers.</p>
</li>
</ol>
<h3 id="inputoutputs-configuration"><a class="header" href="#inputoutputs-configuration">Input/Outputs Configuration</a></h3>
<p>In Inputs/Outputs not all the parameters need to be configured. The user should decide based on their choice of motor controllers what parameters they need to configure. Navitrol needs only few of the parameters to be configured and they are explained below:</p>
<ol>
<li>
<p><strong>Startup</strong>- If needed user can define a script that should work whenever the motor controller is started.</p>
</li>
<li>
<p><strong>Commands</strong>- In Commands section user need to set up the 'Watchdog' parameter. The watchdog is used for safety and will set the warning or errors after a certain time limit until they are resolved. The first command priority can be set to <strong>Serial</strong> and a second command priority can be set to <strong>Pulses</strong>; in case the first priority stops working.</p>
</li>
<li>
<p><strong>Spektrum RC</strong>: Navitrol does not use RC so this does not need to be configured.</p>
</li>
<li>
<p><strong>CAN</strong>- This needs to be configured if the Roboteq motor controllers are connected using CAN bus and the values for the motor controller parameters should match the Navitrol parameters. For example, Bit rate should be same in both motor controller and Navitrol to allow communication to be carried out via CAN bus. Listen Node ID in the options refers to the Navitrol. CAN mode and communication interval must be defined, and this can be selected from the options such as CAN mode and MiniCAN Send Rate (ms). Roboteq motor controller uses MiniCAN.</p>
</li>
</ol>
<p>a) <strong>CAN Mode</strong>: MiniCAN should be selected as the option</p>
<p>b) <strong>Bit</strong> <strong>rate</strong>: CAN bitrate and should match with <strong>can_bitrate_k</strong> parameter.</p>
<p>c) <strong>Node</strong> <strong>ID</strong>: the Node ID of the Roboteq controller and should match with can_roboteq_nodeid </p>
<p>d) <strong>Listen</strong> <strong>Node</strong> <strong>ID</strong>: should be same as the define in parameter, can_roboteq_listen_nodeid</p>
<p>e) <strong>Heartbeat</strong> (<strong>ms</strong>): doesn't matter.</p>
<p>f) <strong>MiniCAN</strong> <strong>Send</strong> <strong>Rate</strong> (<strong>ms</strong>): 10 Send rate is the interval between each TPDO. So if there are 4 PDO's having and control interval of 40 ms then it should be set to 10ms (40/4).</p>
<p>g) <strong>TPDO</strong> <strong>1</strong> <strong>Send</strong> <strong>Rate</strong> (<strong>ms</strong>): 10 CAN Open</p>
<p>h) <strong>TPDO</strong> <strong>2</strong> <strong>Send</strong> <strong>Rate</strong> (<strong>ms</strong>): 20</p>
<p>i) <strong>TPDO</strong> <strong>3</strong> <strong>Send</strong> <strong>Rate</strong> (<strong>ms</strong>): 30</p>
<p>j) <strong>TPDO</strong> 4 <strong>Send</strong> <strong>Rate</strong> (<strong>ms</strong>): 40</p>
<p>k) <strong>TPDO</strong> <strong>1</strong> <strong>Transmission</strong> <strong>Type</strong>: 255 Transmission Type is CANOpen stuff</p>
<p>l) <strong>TPDO</strong> <strong>2</strong> <strong>Transmission</strong> <strong>Type</strong>: 255</p>
<p>m) <strong>TPDO</strong> <strong>3</strong> <strong>Transmission</strong> <strong>Type</strong>: 255</p>
<p>n) <strong>TPDO</strong> <strong>4</strong> <strong>Transmission</strong> <strong>Type</strong>: 255</p>
<p>o) <strong>CANOpen</strong> <strong>Autostart</strong>: Disabled Not relevant to MiniCAN</p>
<ol start="5">
<li>
<p><strong>Encoder</strong>- This option also needs to be configured for the encoders of the motor controllers. User can select between <strong>Command</strong> or <strong>Feedback</strong> option.</p>
</li>
<li>
<p>Digital Inputs: Navitrol does not use any digital inputs but this can be set based on the use case the customer is using or if a customer has a requested a certain feature that requires this to be configured.</p>
</li>
<li>
<p><strong>Analog Inputs</strong>- Navitrol does not use any analog inputs.</p>
</li>
<li>
<p><strong>Pulse Inputs</strong>- Navitrol does not use any pulse inputs.</p>
</li>
<li>
<p><strong>Digital Outputs</strong>- The digital output should be set as high when <strong>Motor is on.</strong></p>
</li>
<li>
<p><strong>User-Defined Values</strong>- Navitrol does not require any values to be defined but user can set them if needed.</p>
</li>
</ol>
<h3 id="power-output-configuration"><a class="header" href="#power-output-configuration">Power Output Configuration</a></h3>
<p>The power output is to be configured by the user based on the choice of motor controllers. Since the value will vary depending on different models of the motors and motor controllers, the responsibility lies on the user to get all the instructions from Roboteq for configuring the Power output parameters.</p>
<p>Once the Input/Outputs and Power Output parameters are configured they should be saved to the Controller.</p>
<h2 id="scripting"><a class="header" href="#scripting">Scripting</a></h2>
<p>The scripts are only required when the Roboteq motor controllers are connected via the CAN bus. These scripts are provided by Navitec to the customers and there are different scripts available for different kinematics such as:</p>
<ul>
<li>
<p>Differential drive kinematic has its own script that reads information related to driving of the wheels.</p>
</li>
<li>
<p>Omni and Steer driven have their own script that reads the driving and steering of the wheels.</p>
</li>
</ul>
<p>The user does not need any scripts if the motor controllers are connected via <strong>Serial</strong> connection.</p>
<h3 id="uploading-script"><a class="header" href="#uploading-script">Uploading Script</a></h3>
<p>To upload the script to the motor controller, click on the 'Scripting' tab on the Motor control utility. Then click on the 'Open' option and select a file from the location where it is saved. The script files are micro basic format and have an extension of '<strong>xx.mbs'.</strong> Once uploaded script may look like shown in the picture below:</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/image5.png" alt="" /></p>
<h3 id="saving--upload-script-files"><a class="header" href="#saving--upload-script-files">Saving &amp; Upload Script Files</a></h3>
<p>To save a script file click on the icon that says 'Save As' and select a location where you want to save it. The file will be saved as a 'xx.mbs' file.</p>
<p>Once the file is opened in the motor control utility then it should be uploaded to the motor controller. This can be done via pressing the 'To Device' option.</p>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>Once the parameters are configured correctly or profile is loaded, they should be saved to the Controller. Afterwards if needed then script should be uploaded to the Controller as well. Then click the <strong>Run</strong> tab for testing the motor and motor controllers as seen in the picture below:</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/image6.png" alt="" /></p>
<p>Based on the picture it can be seen that the motor controller is connected via Serial connection (Not CAN) as red indicator is visible on the top left corner before the 'Serial' and under 'Status'.</p>
<p>The 'RunScript' option also has a red light on that means that the script is running.</p>
<p>Also, under 'Digital Input' the digital input 1 is lit red that translate to motor controller having a single input. The Digital outputs shows a green light that translates to motor controller giving outputs.</p>
<p>Press the Pause button for the script and a Red light should turn off next to 'RunScript' option as shown below:</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/image7.png" alt="" /></p>
<p>Use the scroll bars highlighted in the picture above to move the wheel by sending target rpm. Make sure <strong>ONLY</strong> one scroll bar is moved at a single time.</p>
<p>When sending the rpm the wheel should start rotating. This verifies that the connections and parameters are set correctly for the motors and Roboteq motor controllers.</p>
<p>Under 'Channel' on bottom right corner different values can be selected from a drop-down list and they will become visible and change as wheels rotate.</p>
<p>Also test that the encoder value and rpm are being read from the motor controller. This can be checked by selecting the Counter 1 or 2 option and Speed 1 and 2 RPM from the drop-down list. This again depends on the parameters set in the <strong>Configuration</strong> tab.</p>
<h2 id="navitrol-parameters-2"><a class="header" href="#navitrol-parameters-2">Navitrol Parameters</a></h2>
<p>There are different parameters related to Roboteq and they should be configured depending on what kinematic AGV is being used. The general parameters can be configured if needed.</p>
<p><strong>General Parameters</strong></p>
<ul>
<li><strong>I, mot_ctrl_max_out,</strong> 1000 # maximum output</li>
</ul>
<p><strong>Parameters for serial connected Roboteq</strong></p>
<ul>
<li>
<p><strong>I, roboteq_check_echo</strong>, 1 # &quot;0 do not check command echo, 1 check but don't give error if echo doesn't match, 2 give error if echo doesn't match&quot;¨</p>
</li>
<li>
<p><strong>S, roboteq_lift_serial_port</strong>, /dev/ttyS0 # Serial port for Roboteq lift controller</p>
</li>
<li>
<p><strong>I, roboteq_brake_output1</strong>, -1 #digital out number for first brake, -1 if disabled</p>
</li>
<li>
<p><strong>I, roboteq_brake_output2</strong>, -1, #digital out number for second brake, -1 if disabled</p>
</li>
<li>
<p><strong>I, roboteq_motor_controller_type</strong>, 0, #Roboteq motor controller type: 0 for brushless, 1 for brushed</p>
</li>
<li>
<p><strong>S, mot_ctrl_serial_port</strong>, /dev/ttyS2 # Serial port for first Roboteq controller (steer/diff)</p>
</li>
<li>
<p><strong>S, mot_ctrl_serial_port2,</strong> /dev/ttyS2 # Serial port for second Roboteq controller (mecanum)</p>
</li>
<li>
<p><strong>I, roboteq_channel1_right</strong>*,* 1 #Set this parameter to 1 if channel 1 of Roboteq motor controller is connected to right wheel, otherwise set it to 0.</p>
</li>
<li>
<p><strong>I, roboteq_channel1_steer</strong>*,* 1 # Set this parameter to 1 if channel 1 of Roboteq motor controller is connected to steering of the wheel, otherwise set it to 0.</p>
</li>
<li>
<p><strong>I, mot_ctrl_mecanum_roboteq1_channel1_wheel</strong>, 0 #0 = FL, 1 = FR, 2 = RL, 3 = RR</p>
</li>
<li>
<p><strong>I, mot_ctrl_mecanum_roboteq1_channel2_wheel</strong>, 0 #0 = FL, 1 = FR, 2 = RL, 3 = RR</p>
</li>
<li>
<p><strong>I, mot_ctrl_mecanum_roboteq2_channel1_wheel</strong>, 0 #0 = FL, 1 = FR, 2 = RL, 3 = RR</p>
</li>
<li>
<p><strong>I, mot_ctrl_mecanum_roboteq2_channel2_wheel</strong>, 0 #0 = FL, 1 = FR, 2 = RL, 3 = RR</p>
</li>
</ul>
<p><strong>CAN Parameters</strong></p>
<ul>
<li>
<p><strong>I, can_roboteq_listen_nodeid</strong>, -1 # Roboteq controller CAN listen node id</p>
</li>
<li>
<p><strong>I, can_roboteq_comms_mode</strong>, 0 # 0 - miniCAN, 1 - CANOpen; common setting for all Roboteq controllers. For now, it has to be miniCAN and same should be selected on Roboteq side configuration.</p>
</li>
<li>
<p><strong>I, can_roboteq_nodeid</strong>, -1 # Roboteq controller CAN transmit node id</p>
</li>
<li>
<p><strong>I, roboteq_channel1_right</strong>*,* 1 #Set this parameter to 1 if channel 1 of Roboteq motor controller is connected to right wheel, otherwise set it to 0.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roboteq-closed-loop-motor-controller-configuration"><a class="header" href="#roboteq-closed-loop-motor-controller-configuration">Roboteq Closed Loop Motor Controller Configuration</a></h1>
<p>Updated 30.07.2024</p>
<hr />
<h2 id="introduction-16"><a class="header" href="#introduction-16">Introduction</a></h2>
<p>Roboteq motor controllers are one of many motor controllers that Navitrol supports in AGVs. Roboteq offers different range of motor controllers that can be used for different uses via different interfaces. In this documentation, instructions are provided for configuring CANOpen closed loop motor controllers to be interfaced with Navitrol.</p>
<p>If a Roboteq motor controller is dual channel, then it can be used to control 2 motors. So, it means 1 Roboteq controller is needed for 1 steering + 1 driving motor or for 2 driving motors. For example, if there is an Omni AGV with 6 wheels, it would need 6 Roboteq controllers that can handle steering + driving of each of the 6 wheels.</p>
<p>It should be noted, that this document covers only closed loop control mode with Roboteq controllers.</p>
<h2 id="setup-9"><a class="header" href="#setup-9">Setup</a></h2>
<p>The Roboteq offers extensive support and documentation for getting started. All the Roboteq products have specific PC utility software that provides an interface to the user for configuring the Roboteq products.</p>
<p>All product specific datasheets, documentation and software can be downloaded from the Roboteq website. <a href="http://www.roboteq.com">www.roboteq.com</a></p>
<p>In this document no specific version of motor controller is mentioned since the process for interfacing with Navitrol is same for all the motor controllers.</p>
<ul>
<li>
<p>To configure the Roboteq motor controllers, Roborun, a Roboteq motor control utility software needs to be installed on Windows PC.</p>
</li>
<li>
<p>It is assumed that the user has completed all the necessary physical wiring of motor controllers to the driving or steering encoders of the AGV.</p>
</li>
<li>
<p>Use the USB cable to connect the computer with the Roboteq motor controller and start the Roborun utility software.</p>
</li>
<li>
<p>Start the 'Roborun+' app and it should appear as shown below.</p>
</li>
</ul>
<h3 id="uploadsave-profile-1"><a class="header" href="#uploadsave-profile-1">Upload/Save Profile</a></h3>
<p>A profile is basically a file that contains the values to different options and parameters in the configuration window. Make sure that the controller is connected, this can be verified by seeing the 'Connected' in the bottom right corner of the window and a green indicator.</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/Roborun_overview.png" alt="" /></p>
<blockquote>
<p>RoboRun overview.</p>
</blockquote>
<p>There are different tabs in Roboteq motor control utility.</p>
<ol>
<li>
<p>The <strong>Configuration</strong> tab defines the settings for Inputs and outputs.</p>
</li>
<li>
<p>The <strong>Run</strong> tab allows different options for debugging and testing the motor controllers.</p>
</li>
<li>
<p>The <strong>Load from Controller</strong> loads the profile if it already existing on the controller and then shows the values in Inputs/Outputs window.</p>
</li>
<li>
<p>If no such profile exists by default on the controller, then user can upload their own profile by using <strong>Load Profile from Disk</strong>. The profile files can either have an extension of <strong>*.cpr</strong> or <strong>*.xml</strong>.</p>
</li>
</ol>
<h3 id="inputoutputs-configuration-1"><a class="header" href="#inputoutputs-configuration-1">Input/Outputs Configuration</a></h3>
<p>In Inputs/Outputs not all the parameters need to be configured. The user should decide based on their choice of motor controllers what parameters they need to configure. Navitrol needs only few of the parameters to be configured and they are explained below:</p>
<ol>
<li>
<p><strong>Startup</strong>- Script Auto-Start should be set to Disabled as script is not used.</p>
</li>
<li>
<p><strong>Commands</strong>- In Commands section user need to set up the 'Watchdog' parameter. The watchdog is used for safety and will set the warning or errors after a certain time limit until they are resolved. The first command priority can be set to <strong>Serial</strong> and a second command priority can be set to <strong>Pulses</strong>; in case the first priority stops working.</p>
</li>
<li>
<p><strong>Spektrum RC</strong>: Navitrol does not use RC so this does not need to be configured.</p>
</li>
<li>
<p><strong>CAN</strong>- This needs to be configured as Roboteq motor controllers are connected using CAN bus and the values for the motor controller parameters should match the Navitrol parameters. For example, Bit rate should be same in both motor controller and Navitrol to allow communication to be carried out via CAN bus. </p>
<p>a) <strong>CAN Mode</strong>: CANOpen should be selected as the option</p>
<p>b) <strong>Bit Rate</strong>: CAN bitrate and should match with <strong>can_bitrate_k</strong> parameter.</p>
<p>c) <strong>Node ID</strong>: the Node ID of the Roboteq controller and should match with <strong>mot_ctrl_drive_can_nodeid_arr</strong></p>
<p>d) <strong>Listen Node ID</strong>: should be same as above.</p>
<p>e) <strong>Heartbeat (ms)</strong>: doesn't matter.</p>
<p>f) <strong>CHB Lost Action</strong>: Should be either Safety Stop or Emergency Stop.</p>
<p>g) <strong>MiniCAN Send Rate (ms)</strong>: Not used with CANOpen.</p>
<p>h) <strong>CANOpen TPDO Send Rate</strong>: Not needed. Navitrol will set these automatically.</p>
<p>i) <strong>CANOpen Transmission Type</strong>: Not needed. Navitrol will set these automatically.</p>
<p>j) <strong>CANOpen Autostart</strong>: Should be set to enabled.</p>
<p>k) <strong>DS402 FSA</strong>: Should be set to enabled. </p>
</li>
<li>
<p><strong>Encoder</strong>- This option also needs to be configured for the encoders of the motor controllers. Should be set to  <strong>Feedback</strong>. If the controller has two channels, the channels should be selected accordingly.</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/DualChannelEncoders.png" alt="" /></p>
<blockquote>
<p>Dual channel encoder setup.</p>
</blockquote>
</li>
<li>
<p><strong>Digital Inputs</strong>: Navitrol does not use any digital inputs but this can be set based on the use case the customer is using or if a customer has a requested a certain feature that requires this to be configured.</p>
</li>
<li>
<p><strong>Analog Inputs</strong>: Navitrol does not use any analog inputs.</p>
</li>
<li>
<p><strong>Pulse Inputs</strong>: Navitrol does not use any pulse inputs.</p>
</li>
<li>
<p><strong>Digital Outputs</strong>: The digital output should be set as high when <strong>Motor is on.</strong></p>
</li>
<li>
<p><strong>User-Defined Values</strong>: Navitrol does not require any values to be defined but user can set them if needed.</p>
</li>
</ol>
<h3 id="power-output-configuration-1"><a class="header" href="#power-output-configuration-1">Power Output Configuration</a></h3>
<p>The power output is to be configured by the user based on the choice of motor controllers. Since the value will vary depending on different models of the motors and motor controllers, the responsibility lies on the user to get all the instructions from Roboteq for configuring the Power output parameters.</p>
<p>At least the PID gains should be tuned and saved to the controller as Navitrol doesn't do it.</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/RoborunPid.png" alt="" /></p>
<blockquote>
<p>PID settings for Closed loop Speed.</p>
</blockquote>
<p>Once the Input/Outputs and Power Output parameters are configured they should be saved to the Controller.</p>
<h2 id="testing-1"><a class="header" href="#testing-1">Testing</a></h2>
<p>Note: For testing, set the DS402 FSA to <strong>Disabled</strong>, otherwise the controller assumes specific states to be set before it can run. Remember to set <strong>Enabled</strong> after testing.</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/402Enabled.png" alt="" /></p>
<blockquote>
<p>DS402 FSA setting.</p>
</blockquote>
<p>It is recommended to first test to spin the motor in open loop mode and then move to closed loop mode after it has been verified that the motor works with open loop. </p>
<p>Once the parameters are configured correctly or profile is loaded, they should be saved to the Controller. Then click the <strong>Run</strong> tab for testing the motor and motor controllers as seen in the picture below:</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/RoboRun_runTab.png" alt="" /></p>
<blockquote>
<p>Run tab main view.</p>
</blockquote>
<p>Based on the picture it can be seen that the motor controller is connected via Serial connection (Not CAN) as red indicator is visible on the top left corner before the 'Serial' and under 'Status'.</p>
<p>The 'RunScript' option should not have red light as the script should not be used.</p>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/RoboRun_command.png" alt="" /></p>
<blockquote>
<p>RoboRun sending RPM to the controller.</p>
</blockquote>
<p>Use the scroll bar highlighted in the picture above to move the motor by sending target rpm to the controller. Make sure <strong>ONLY</strong> one scroll bar is moved at a single time. The second scroll bar can be used to send commands to the second channel if that is in use.</p>
<p>When sending the rpm the motor should start rotating. This verifies that the connections and parameters are set correctly for the motors and Roboteq motor controllers.</p>
<p>The arrow icon on top of the CHART window is used to start recording the live data. The same button can be also used to stop the recording for analyzing the data.</p>
<p>Under 'Channel' on bottom right corner different values can be selected from a drop-down list and they will become visible and change as motor rotate.</p>
<p>Also test that the encoder value and rpm are being read from the motor controller. This can be checked by selecting the Counter 1 or Counter 2 option and Speed 1 RPM and Speed 2 RPM or Feedback 1 and Feedback 2 from the drop-down list. This again depends on the parameters set in the <strong>Configuration</strong> tab.</p>
<h2 id="object-dictionary-od-parameters"><a class="header" href="#object-dictionary-od-parameters">Object Dictionary (OD) parameters</a></h2>
<p>Navitrol configures a subset of motor controller's OD-parameters when Navitrol starts.
These configurations are sent as SDO-messages to the motor controllers. The OD-parameters that Navitrol configures can be seen on the table below.
The parameters for automatic SDO-configurations (for example, SDO message interval and SDO message response timeout) are presented on the <a href="AgvInterfaces/MotorControllers/Roboteq/../../../AgvInterfaces/GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</p>
<p><strong>OD parameter table</strong></p>
<table><thead><tr><th>Name</th><th>Object index</th><th>Subindex</th><th>Data type</th><th>Value in hex</th><th>Description</th></tr></thead><tbody>
<tr><td>Estop and fault clearance</td><td>200Dh</td><td>0</td><td>Unsigned8</td><td>0</td><td>Clears estop and faults.</td></tr>
<tr><td>Consumer heartbeat time</td><td>1016h</td><td>1</td><td>Unsigned32</td><td>Based on parameters</td><td>Heartbeat time is configured if enabled by parameter <strong>can_heartbeat_producer_enable</strong>. <br>First two bytes are heartbeat time based on 3.5 * <strong>control_interval_us</strong> parameter and byte 3 is Navitrol's node id from <strong>navigation_software_node_id</strong> parameter.</td></tr>
</tbody></table>
<p>Note: Navitrol does not configure the PID values of the controller. It should be done using Roborun.</p>
<h2 id="navitrol-parameters-3"><a class="header" href="#navitrol-parameters-3">Navitrol Parameters</a></h2>
<p>There are different parameters related to Roboteq and they should be configured depending on what kinematic AGV is being used.</p>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>The indices of the following array parameters are: <br> <strong>Differential drive</strong>: <br> 0 = Left wheel <br> 1 = Right wheel <br> <strong>Mecanum</strong>: <br> 0 = Forward Left <br> 1 = Forward Right <br> 2 = Rear Left <br> 3 = Rear Right</td><td></td><td></td><td></td></tr>
<tr><td><strong>Drive Motor controllers</strong></td><td></td><td></td><td></td></tr>
<tr><td>mot_ctrl_drive_controller_type_arr[]</td><td>Int</td><td>0</td><td>5 = Roboteq single channel <br> 6 = Roboteq dual channel 1 <br> 7 = Roboteq dual channel 2</td></tr>
<tr><td>mot_ctrl_drive_can_nodeid_arr[]</td><td>Int</td><td>0</td><td>Motor controller CAN node id for drive motor. 0 = this parameter not used.</td></tr>
<tr><td>mot_ctrl_drive_inv_input_arr[]</td><td>Int</td><td>0</td><td>Invert drive motor controller input. 0 = no inversion, 1 = invert input</td></tr>
<tr><td>mot_ctrl_drive_inv_output_arr[]</td><td>Int</td><td>0</td><td>Invert drive motor controller output. 0 = no inversion, 1 = invert output</td></tr>
<tr><td><strong>Other required parameters</strong></td><td></td><td></td><td></td></tr>
<tr><td>can_heartbeat_producer_enable</td><td>Int</td><td>0</td><td>Enables Navigation software to be Heartbeat producer for primary CAN.</td></tr>
<tr><td>navigation_software_node_id</td><td>Int</td><td>0</td><td>Navigation Software CAN Node ID: 0 = not defined, 1-127 = valid node ID.</td></tr>
</tbody></table>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>mot_ctrl_reset_errors_timer</td><td>Int</td><td>500</td><td>After the defined time (ms) Navitrol tries to automatically reset motor control faults. Value 0 = fault reset disabled. When error is active on controller, Navitrol will start sending fault reset on the control word with this interval until the errors are reset.</td></tr>
</tbody></table>
<h2 id="troubleshooting-15"><a class="header" href="#troubleshooting-15">Troubleshooting</a></h2>
<h3 id="motor-does-not-spin-when-trying-to-give-rpm-using-roborun"><a class="header" href="#motor-does-not-spin-when-trying-to-give-rpm-using-roborun">Motor does not spin when trying to give RPM using RoboRun</a></h3>
<ul>
<li>Check that the DS402 FSA is set to <strong>Disabled</strong>. </li>
</ul>
<p><img src="AgvInterfaces/MotorControllers/Roboteq/./media-en/402Enabled.png" alt="" /></p>
<blockquote>
<p>DS402 FSA setting.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="micontrol-can-motor-controller"><a class="header" href="#micontrol-can-motor-controller">MiControl CAN motor controller</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-13"><a class="header" href="#overview-13">Overview</a></h2>
<h3 id="introduction-17"><a class="header" href="#introduction-17">Introduction</a></h3>
<p>MiControl motor controller is one of the motor controllers supported by Navitrol. MiControl offers single channel motor controllers that can be used for different purposes (steering, driving, actuator) in the AGV.</p>
<p>In this documentation, instructions are provided for configuring the motor controllers so that motor controllers are compatible with Navitrol.</p>
<p>Operation of the device is possible via CANopen fieldbus. </p>
<p>The initial parameterization/configuration of the device takes place with the software mcTools.</p>
<h3 id="requirements-8"><a class="header" href="#requirements-8">Requirements</a></h3>
<p><strong>Hardware:</strong></p>
<ul>
<li>Supported motor controller (<a href="AgvInterfaces/MotorControllers/MiControl/../../SupportedDevices/SupportedDevices-en.html">List of supported devices</a> document should be checked)</li>
<li>Connectors for wiring. Without the connectors, it is impossible to wire the motor controller. Types and number of connectors can be found from the mcmanual <!-- markdown-link-check-disable-line --> <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/download/documentations/mcmanual">https://www.micontrol.de/en/download/documentations/mcmanual</a>. </li>
<li>Adapter for connecting the motor controller to PC - miCAN-Stick2 <!-- markdown-link-check-disable-line --> https://www.micontrol.de/en/products/devices/mican-stick2](#https://www.micontrol.de/en/products/devices/mican-stick2) . </li>
</ul>
<p><strong>Software</strong></p>
<ul>
<li>The feature is supported by Navitrol starting from version 6.44.00.</li>
<li>Parameterization/configuration software - mcTools. Can be downloaded from the manufacturer's website: <!-- markdown-link-check-disable-line --> <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/download/software">https://www.micontrol.de/en/download/software</a>. Note that it is needed to register on a website in order to download software or device manuals.</li>
</ul>
<p><strong>Documentation</strong> </p>
<ul>
<li>The documentation can be downloaded from the manufacturer's website: <!-- markdown-link-check-disable-line --> <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/download/documentations/mcmanual">https://www.micontrol.de/en/download/documentations/mcmanual</a>. </li>
</ul>
<h3 id="limitations-6"><a class="header" href="#limitations-6">Limitations</a></h3>
<ul>
<li><strong>Motor controller might be not supporting all functions (steering, driving, actuating) and kinematics</strong>. <a href="AgvInterfaces/MotorControllers/MiControl/../../SupportedDevices/SupportedDevices-en.html">List of supported devices</a> document should be checked to determine whether the combination of the function and kinematics is supported or not.</li>
<li>Currently, it is impossible to use MiControl motor controller with other motor controllers in the same AGV</li>
<li>MiControl motor controller support is available to position control systems only</li>
</ul>
<h3 id="dependencies-4"><a class="header" href="#dependencies-4">Dependencies</a></h3>
<p>This feature is dependent on CAN interface. Therefore, it is recommended to check <a href="AgvInterfaces/MotorControllers/MiControl/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</p>
<hr />
<h2 id="electrical-connections-6"><a class="header" href="#electrical-connections-6">Electrical connections</a></h2>
<p>Electrical connections should be done according to the Drive Controller section in <!-- markdown-link-check-disable-line --> <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/download/documentations/mcmanual">mcmanual</a>. Connections can be divided into several groups:</p>
<ol>
<li><strong>Power connection</strong>. Connect power to both main power supply and electronic power supply.</li>
<li><strong>Motor connection</strong>. Connect the motor to the motor terminals of the motor controller.</li>
<li><strong>Encoder connection</strong>. Connect the encoder to the encoder port.</li>
<li><strong>Safety connection</strong>. If the device has STO function, wire the STO-A and STO-B pins to the safety controller. Those pins should be powered whenever it is safe to drive the motor. Check Safety Manual section in the documentation for a specific controller for checking safety procedures and commissioning of the safety feature.</li>
<li><strong>CAN bus connection</strong>. Connect CAN wires to the CAN terminal of the motor controller. Additionally, connect the miCAN-stick2 to the CAN bus for commissioning. Wiring of the CAN bus should be done according to <a href="AgvInterfaces/MotorControllers/MiControl/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</li>
</ol>
<hr />
<h2 id="setup-10"><a class="header" href="#setup-10">Setup</a></h2>
<p>The following steps should be done in process of commissioning:</p>
<ul>
<li>Changing the motor controller parameters </li>
<li>Changing Navitrol parameters</li>
</ul>
<h3 id="changing-the-motor-controller-parameters"><a class="header" href="#changing-the-motor-controller-parameters">Changing the motor controller parameters</a></h3>
<p>In order to change the motor controller parameters, connect the <!-- markdown-link-check-disable -->  <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/products/devices/mican-stick2">miCAN-Stick2</a> to the PC with <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/download/software">mcTools</a>software installed. Additionally, it is recommended to read mcTools section from the <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/download/documentations/mcmanual">mcmanual</a>. <!-- markdown-link-check-enable --></p>
<p>In order to change parameters, open mcTools.  Select &quot;Scan baudrate&quot; and press &quot;Scan device&quot;. The connected devices should appear to the list as shown on the Figure bellow.</p>
<p>   <img src="AgvInterfaces/MotorControllers/MiControl/./media-en/scan_devices.png" alt="" /></p>
<p>   &gt; Device scanning</p>
<h4 id="changing-communication-parameters"><a class="header" href="#changing-communication-parameters">Changing communication parameters</a></h4>
<p>Once the device is connected, it is recommended to change the node id of the device. In the Tools panel, select &quot;CAN config&quot;. In the opened window, type  the Node id and baud rate. Node Id and Baud Rate should match Navitrol parameters in the subsequent commissioning steps. Node Id of each device should be unique on the bus. Baud rate should be the same for all of the devices on the bus, recommended value is 250 kBit. Save entered values to the motor controller by pressing &quot;Set&quot;.</p>
<p>   <img src="AgvInterfaces/MotorControllers/MiControl/./media-en/change_node_id.png" alt="" /></p>
<p>   &gt; Changing node id</p>
<h4 id="changing-motor-parameters-tuning-pid-controller"><a class="header" href="#changing-motor-parameters-tuning-pid-controller">Changing motor parameters, Tuning PID controller</a></h4>
<p>Those steps should be performed in accordance to the <!-- markdown-link-check-disable-line --> <a href="AgvInterfaces/MotorControllers/MiControl/MiControlMotorController-en.html#https://www.micontrol.de/en/download/documentations/mcmanual">Documentation</a>. Navitec Systems do not have successful experience in tuning motor controller. In case of issues, MiControl/supplier support should be contacted.</p>
<p><strong>Note</strong>: It is possible to save the configuration of the device by opening DSA config and selecting from File menu in the left top corner the option &quot;Save as&quot;. After saving, those parameters can be loaded from the same File menu to another motor controller.</p>
<h3 id="changing-navitrol-parameters-3"><a class="header" href="#changing-navitrol-parameters-3">Changing Navitrol parameters</a></h3>
<ul>
<li>Prior to communication, set the parameters (<strong>can_ch</strong> and <strong>can_bitrate_k</strong>) according to <a href="AgvInterfaces/MotorControllers/MiControl/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document.</li>
<li>Since the device is supporting heartbeat, it is highly recommended to set parameter <strong>can_heartbeat_producer_enable</strong> to 1 and <strong>navigation_software_node_id</strong> to any node Id from 1 to 127 which is not used by other devices in the bus</li>
<li>Set Node ID to the corresponding parameter according to Table &quot;CAN Node Id parameters for motor controllers&quot; in <a href="AgvInterfaces/MotorControllers/MiControl/../../MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html">Motor controllers common</a> document.</li>
</ul>
<h3 id="fine-tuning-3"><a class="header" href="#fine-tuning-3">Fine-tuning</a></h3>
<ul>
<li>If needed, the warning for E-STOP can be disabled from the motor controller using the <strong>mot_ctrl_micontrol_estop_check_enabled</strong> parameter</li>
<li>Automatic error reset can be disabled using <strong>mot_ctrl_reset_errors_timer</strong>.</li>
</ul>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>mot_ctrl_micontrol_estop_check_enabled</td><td>Int</td><td>1</td><td>Activates MiControl E-STOP check. </br> Emergency stop activation comes from digital input 6 and 7 (STO-A and STO-B)</td></tr>
<tr><td>mot_ctrl_reset_errors_timer</td><td>Int</td><td>500</td><td>After the defined time (ms) Navigation SW tries automatically reset motor control faults. Value 0 = fault reset disabled</td></tr>
</tbody></table>
<hr />
<h2 id="how-to-use-5"><a class="header" href="#how-to-use-5">How to use</a></h2>
<p>After successful setup, the motor should be rotating after giving the commands from Navitrol.</p>
<hr />
<h2 id="troubleshooting-16"><a class="header" href="#troubleshooting-16">Troubleshooting</a></h2>
<h3 id="most-common-issues-2"><a class="header" href="#most-common-issues-2">Most common issues</a></h3>
<h3 id="errors-and-warnings-6"><a class="header" href="#errors-and-warnings-6">Errors and warnings</a></h3>
<h4 id="can-errors"><a class="header" href="#can-errors">CAN errors</a></h4>
<p>The information about CAN-bus related errors and troubleshooting can be found from <a href="AgvInterfaces/MotorControllers/MiControl/../../GenericInterfaces/CanCommunication/CanCommunication-en.html">CAN communication</a> document</p>
<h4 id="motor-controller-errors-error_agv_controller"><a class="header" href="#motor-controller-errors-error_agv_controller">Motor controller errors (ERROR_AGV_CONTROLLER)</a></h4>
<p>If motor controller indicates some error, Navitrol will automatically try to reset this error (unless <strong>mot_ctrl_reset_errors_timer</strong> set to zero).</p>
<p>If error is not reset by Navitrol:</p>
<ul>
<li>Check the motor controller error code and description from Linux terminal. Try to resolve it. Power cycle the controller.</li>
<li>Try to connect using mcTools software to the motor controller. Connect it the same way as when configuring (according to the &quot;Changing the motor controller parameters&quot; section). Open &quot;DSA Status&quot; and check the motor controller parameters.</li>
<li>Contact Navitec or Motor controller support.</li>
</ul>
<h3 id="advanced-troubleshooting-4"><a class="header" href="#advanced-troubleshooting-4">Advanced troubleshooting</a></h3>
<p>For checking the logs, the keywords &quot;MiControl&quot; and &quot;MotorController&quot; can be used to find the information related to the motor controller operation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="laser-scanners"><a class="header" href="#laser-scanners">Laser scanners</a></h1>
<p>Updated 26.01.2024</p>
<ul>
<li><a href="AgvInterfaces/ScannerConfigurations/./ScannerConfigurations-en.html">Scanner configurations</a></li>
<li><a href="AgvInterfaces/ScannerConfigurations/./../ScannerCommunicationTroubleshoot/ScannerCommunicationTroubleshoot-en.html">Scanner communication troubleshooting</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scanner-configurations"><a class="header" href="#scanner-configurations">Scanner Configurations</a></h1>
<p>Updated 24.04.2024</p>
<hr />
<h2 id="glossary-9"><a class="header" href="#glossary-9">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>UDP</td><td>User Datagram Protocol</td></tr>
<tr><td>TCP</td><td>Transmission Control Protocol</td></tr>
</tbody></table>
<hr />
<h2 id="universal-scanner-parameters"><a class="header" href="#universal-scanner-parameters">Universal scanner parameters</a></h2>
<h3 id="scanner-mounting-location-and-angle"><a class="header" href="#scanner-mounting-location-and-angle">Scanner mounting location and angle</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>scan_rear_x</td><td>Float</td><td>0.99</td><td>The rear scanner's X coordinate w.r.t. navigation point of vehicle</td></tr>
<tr><td>scan_rear_y</td><td>Float</td><td>0.0</td><td>The rear scanner's Y coordinate w.r.t. navigation point of vehicle</td></tr>
<tr><td>scan_front_x</td><td>Float</td><td>-0.09</td><td>The front scanner's X coordinate w.r.t. navigation point of vehicle</td></tr>
<tr><td>scan_front_y</td><td>Float</td><td>0.0</td><td>The front scanner's Y coordinate w.r.t. navigation point of vehicle</td></tr>
<tr><td>scan_rear_sen_ang</td><td>Float</td><td>90.0</td><td>The rear scanner's angle difference between the vehicles and the scanners coordinate systems (degrees)</td></tr>
<tr><td>scan_front_sen_ang</td><td>Float</td><td>90.0</td><td>The front scanner's angle difference between the vehicles and the scanners coordinate systems (degrees)</td></tr>
<tr><td>scan_rear_beam_min_ang_deg</td><td>Float</td><td>0.0</td><td>Min angle to define the range for valid scanner measurements for the rear scanner with 0 being the first measurement beam (degrees)</td></tr>
<tr><td>scan_rear_beam_max_ang_deg</td><td>Float</td><td>360.0</td><td>Max angle to define the range for valid scanner measurements for the rear scanner with 0 being the first measurement beam (degrees)</td></tr>
<tr><td>scan_front_beam_min_ang_deg</td><td>Float</td><td>0.0</td><td>Min angle to define the range for valid scanner measurements for the front scanner with 0 being the first measurement beam (degrees)</td></tr>
<tr><td>scan_front_beam_max_ang_deg</td><td>Float</td><td>360.0</td><td>Max angle to define the range for valid scanner measurements for the front scanner with 0 being the first measurement beam (degrees)</td></tr>
<tr><td>scan_rear_upside_down</td><td>Int</td><td>0</td><td>Set 1 if rear scanner is installed upside down</td></tr>
<tr><td>scan_front_upside_down</td><td>Int</td><td>0</td><td>Set 1 if front scanner is installed upside down</td></tr>
<tr><td>scan_rear_use_nth_meas</td><td>Int</td><td>1</td><td>Use only every nth meas from each rear scanner scan for localization</td></tr>
<tr><td>scan_front_use_nth_meas</td><td>Int</td><td>1</td><td>Use only every nth meas from each front scanner scan for localization</td></tr>
<tr><td>scan_rear_offset_mm</td><td>Int</td><td>0</td><td>Rear scanner measurement offset correction (mm)</td></tr>
<tr><td>scan_front_offset_mm</td><td>Int</td><td>0</td><td>Front scanner measurement offset correction (mm)</td></tr>
<tr><td>scanner_dAng_factor</td><td>Float</td><td>-1.0</td><td>Common scanner dAng scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995 ... 1.005) NOTE:Never use without consulting Navitec first</td></tr>
<tr><td>scanner_dAng_factor_rear</td><td>Float</td><td>-1.0</td><td>Rear scanner dAng scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995 ... 1.005) NOTE:Never use without consulting Navitec first</td></tr>
<tr><td>scanner_dAng_factor_front</td><td>Float</td><td>-1.0</td><td>Front scanner dAng scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995 ... 1.005) NOTE:Never use without consulting Navitec first</td></tr>
</tbody></table>
<h3 id="other-generic"><a class="header" href="#other-generic">Other generic</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>scanner_protection_zone_sensitivity</td><td>Int</td><td>1</td><td>Number of consecutive scanner protection zone violations required</td></tr>
<tr><td>scan_max_dt_err_ms</td><td>Int</td><td>5</td><td>The maximum allowed time difference in scanning interval, triggers WARNING/ERROR_SCANNER_FRONT/REAR_HIGH_DT</td></tr>
<tr><td>scan_delay</td><td>Float</td><td>0.0</td><td>Delay of scanner measurements in ms relative to odometry measurements (negative if scanner is slower than odometry)</td></tr>
</tbody></table>
<h4 id="frontrear-and-localization-scanner-selection"><a class="header" href="#frontrear-and-localization-scanner-selection">Front/rear and localization scanner selection</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>scan_rear_front_selection</td><td>Int</td><td>3</td><td>Defines which scanners are connected: 1 = rear scanner only, 2 = front scanner only, 3 = both scanners</td></tr>
<tr><td>scan_rear_front_localization_selection</td><td>Int</td><td>3</td><td>Defines which scanners are used for localization: 1 = rear scanner only, 2 = front scanner only, 3 = both scanners</td></tr>
<tr><td>scanner_model_front</td><td>Int</td><td>0</td><td>Front scanner model:<br>0 = Sick Ethernet<br>1 = Sick S300<br>2 = Omron OS32C<br>3 = P+F R2000 UHD<br>4 = obsolete<br>5 = Leuze RSL400<br>6 = Hokuyo UAM-05LP<br>7 = Keyence SZ-V 32N<br>8 = Sick uScan<br>9 = Sick S300 TCP/IP<br>10 = Reserved<br>11 = Quanergy M1<br>12 = Hokuyo SCIP<br>13 - reserved for internal use<br>14 = Ouster<br>15 = DDS<br>16 = Leuze RSL200</td></tr>
<tr><td>scanner_model_rear</td><td>Int</td><td>0</td><td>Rear scanner model - Look for model number from the <strong>scanner_model_front</strong> -- parameter description</td></tr>
</tbody></table>
<h4 id="frontrear-scanner-communication-settings"><a class="header" href="#frontrear-scanner-communication-settings">Front/rear scanner communication settings</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>front_scanner_serial_port</td><td>String</td><td>&quot;/dev/ttyS0&quot;</td><td>Serial port used for front scanner communication</td></tr>
<tr><td>rear_scanner_serial_port</td><td>String</td><td>&quot;/dev/ttyS1&quot;</td><td>Serial port used for rear scanner communication</td></tr>
<tr><td>front_scanner_ip</td><td>String</td><td>&quot;&quot;</td><td>Front scanner IP address</td></tr>
<tr><td>rear_scanner_ip</td><td>String</td><td>&quot;&quot;</td><td>Rear scanner IP address</td></tr>
<tr><td>front_scanner_port</td><td>Int</td><td>44818</td><td>Front scanner port</td></tr>
<tr><td>rear_scanner_port</td><td>Int</td><td>44818</td><td>Rear scanner port</td></tr>
</tbody></table>
<h4 id="safety-zone-configurations"><a class="header" href="#safety-zone-configurations">Safety zone configurations</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>wallmon_scanner_zone_mode</td><td>Int</td><td>1</td><td>0 = ignore safety zones; over 0 to slow down with warning zone 2 and to stop with warning zone 1 and protection zone, 1 = stopping is done with slow down ramp, 2 = stopping is done immediately</td></tr>
<tr><td>wallmon_scanner_zone_trigger_both</td><td>Int</td><td>0</td><td>0 = trigger only slow/stop to front/rear scanner direction, 1 = trigger both fw&amp;bw slow from a single scanner, 2 = trigger also stop to both directions from a single scanner</td></tr>
</tbody></table>
<h3 id="distance-limits"><a class="header" href="#distance-limits">Distance limits</a></h3>
<p>Maximum distance (in meters) to use can be defined per scanner model using the following parameters (with defaults)</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>scan_min_dist</td><td>Float</td><td>0.2</td><td>General minimum measurement distance</td></tr>
<tr><td>scan_s300_max_dist</td><td>Float</td><td>29.9</td><td>Maximum distance measurement to use for Sick s300</td></tr>
<tr><td>scan_sick_eth_max_dist</td><td>Float</td><td>65.0</td><td>Maximum distance measurement to use for Sick eth</td></tr>
<tr><td>scan_pef_max_dist</td><td>Float</td><td>131.0</td><td>Maximum distance measurement to use for Pef</td></tr>
<tr><td>scan_omron_max_dist</td><td>Float</td><td>65.5</td><td>Maximum distance measurement to use for Omron</td></tr>
<tr><td>scan_hokuyo_max_dist</td><td>Float</td><td>39.9</td><td>Maximum distance measurement to use for Hokuyo</td></tr>
<tr><td>scan_leuze_rsl200_max_dist</td><td>Float</td><td>25.0</td><td>Maximum distance measurement to use for Leuze RSL200</td></tr>
<tr><td>scan_leuze_rsl400_max_dist</td><td>Float</td><td>65.5</td><td>Maximum distance measurement to use for Leuze RSL400</td></tr>
<tr><td>scan_velodyne_max_dist</td><td>Float</td><td>100.0</td><td>Maximum distance measurement to use for Velodyne</td></tr>
<tr><td>scan_keyence_max_dist</td><td>Float</td><td>60.0</td><td>Maximum distance measurement to use for Keyence</td></tr>
<tr><td>scan_uscan_max_dist</td><td>Float</td><td>65.5</td><td>Maximum distance measurement to use for micro scan</td></tr>
<tr><td>scan_ros_max_dist</td><td>Float</td><td>100.0</td><td>Maximum distance measurement to use for ros virtual scanner</td></tr>
<tr><td>scan_quanergy_m1_max_dist</td><td>Float</td><td>65.5</td><td>Maximum distance measurement to use for Quanergy</td></tr>
<tr><td>scan_ouster_max_dist</td><td>Float</td><td>65.5</td><td>Maximum distance measurement to use for Ouster</td></tr>
<tr><td>scan_dds_max_dist</td><td>Float</td><td>100.0</td><td>Maximum distance measurement to use for DDS</td></tr>
</tbody></table>
<h3 id="scanners-for-safety-only"><a class="header" href="#scanners-for-safety-only">Scanners for safety only</a></h3>
<p>Navitrol supports up to four scanners that are used for safety only.
Only the model of the scanner and IP address/port or serial port path are required for the set up.</p>
<p>Parameters:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>safety_scanner_model[]</td><td>Int</td><td>-1 = not defined</td><td>Look for model number from the <strong>scanner_model_front</strong> -- parameter description</td></tr>
<tr><td>safety_scanner_addr[]</td><td>String</td><td>&quot;&quot;</td><td>Serial port path or ip:port</td></tr>
</tbody></table>
<table><thead><tr><th>Parameter Example</th><th></th></tr></thead><tbody>
<tr><td><strong>I,safety_scanner_model[0], 2</strong></td><td>2 = Omron OS32C</td></tr>
<tr><td><strong>S,safety_scanner_addr[0], 192.168.1.1:44818</strong></td><td></td></tr>
<tr><td><strong>I,safety_scanner_model[1], 6</strong></td><td>6 = Hokuyo UAM-05LP</td></tr>
<tr><td><strong>S,safety_scanner_addr[1], 192.168.1.2:10940</strong></td><td></td></tr>
</tbody></table>
<p><strong>Note:</strong> Not all the scanner models supported by Navitrol can send safety status.
Supported scanners for safety only (<strong>Navitrol 6.17.00)</strong></p>
<ul>
<li>
<p>Omron OS32C</p>
</li>
<li>
<p>Hokuyo UAM-05LP</p>
</li>
<li>
<p>Keyence SZ-V 32N</p>
</li>
<li>
<p>Sick uScan/nanoScan</p>
</li>
<li>
<p>Sick S300 -- full support starting from <strong>Navitrol 6.32.00</strong></p>
</li>
<li>
<p>Leuze RSL400</p>
</li>
<li>
<p>Leuze RSL200</p>
</li>
</ul>
<h3 id="additional-measurement-scanners"><a class="header" href="#additional-measurement-scanners">Additional measurement scanners</a></h3>
<p>In addition to localization scanners (front/rear), Navitrol supports two additional measuring scanners. Measurement scanners can trigger slow down and stop based on warning zones if parameter <strong>wallmon_scanner_zone_mode</strong> is non-zero. Any scanner model supported by Navitrol can be defined to be used as measurement only scanner as well. These scanners can be used for</p>
<ul>
<li>
<p>Obstacle avoidance</p>
</li>
<li>
<p>Target detection</p>
</li>
</ul>
<p>Array parameters are used to define these additional measurement
scanners. Up to two additional scanners (indexes 0 and 1) are supported.
Most parameters are familiar from front/rear scanner parameter set. The
following lists all parameters with some sample values:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Example value</th><th>Description</th></tr></thead><tbody>
<tr><td>scanner_meas_model[]</td><td>Int</td><td>3</td><td>-1 disabled is the default</td></tr>
<tr><td>scanner_meas_addr[]</td><td>String</td><td>192.168.2.182:80</td><td>IP:port or serial port</td></tr>
<tr><td>scanner_meas_x[]</td><td>Float</td><td>0.0</td><td>The measurement scanner's X coordinate w.r.t. navigation point of vehicle</td></tr>
<tr><td>scanner_meas_y[]</td><td>Float</td><td>0.0</td><td>The measurement scanner's Y coordinate w.r.t. navigation point of vehicle</td></tr>
<tr><td>scanner_meas_sen_ang_deg[]</td><td>Float</td><td>0.0</td><td>The measurement scanner angle</td></tr>
<tr><td>scanner_meas_beam_min_ang_deg[]</td><td>Float</td><td>0.0</td><td>Measurement scanner  beam min angle define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam</td></tr>
<tr><td>scanner_meas_beam_max_ang_deg[]</td><td>Float</td><td>360.0</td><td>Measurement scanner  beam max angle define the range of valid scanner measurement beams for each scanner with 0 deg being the first measurement beam</td></tr>
<tr><td>scanner_meas_upside_down[]</td><td>Int</td><td>0</td><td>Set 1 if measurement scanner is installed upside down</td></tr>
<tr><td>scanner_meas_use_nth_meas[]</td><td>Int</td><td>1</td><td>Use only every nth meas from each measurement scanner scan for localization</td></tr>
<tr><td>scanner_meas_offset_mm[]</td><td>Int</td><td>0</td><td>Measurement scanner offset correction (mm)</td></tr>
<tr><td>scanner_meas_dAng_factor[]</td><td>Float</td><td>-1.0</td><td>Common scanner dAng scaling, -1 to disable, &gt;0 scaling factor for dAng (reasonable values 0.995 ... 1.005) NOTE:Never use without consulting Navitec first</td></tr>
<tr><td>scanner_meas_scan_delay[]</td><td>Float</td><td>0.0</td><td>Delay of scanner measurements in ms relative to odometry measurements (negative if scanner is slower than odometry)</td></tr>
<tr><td>scanner_meas_scan_rot_cor_invert_dir[]</td><td>Int</td><td>0</td><td>Invert direction in rotation correction</td></tr>
<tr><td>scanner_sends_every_nth_meas[]</td><td>Int</td><td>1</td><td>Scanner sends only every nth meas - not Navigation SW controllable, valid for specific scanners only</td></tr>
</tbody></table>
<h2 id="leuze-1"><a class="header" href="#leuze-1">Leuze</a></h2>
<h3 id="rsl200"><a class="header" href="#rsl200">RSL200</a></h3>
<h4 id="scanner-configuration"><a class="header" href="#scanner-configuration">Scanner configuration</a></h4>
<p>Download Leuze configuration and diagnostic software Sensor Studio.
Additionally, download and install Safety Device Collection software to have device library and be able to configure the scanner. If Sensor Studio has been installed already the old will need to be uninstalled first before installing a new interface.</p>
<p>Connect the scanner via USB to your PC. Start the configuration software and select device search online. Press [<strong>Next</strong>].</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/leuze_rsl_200_select_device.png" alt="" />
&gt;Select device RSL200</p>
<p>Press [<strong>Next</strong>].</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/leuze_rsl_200_search_device.png" alt="" /></p>
<blockquote>
<p>Search for the device. Select USB as Adapter </p>
</blockquote>
<p>Start search</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/leuze_rsl_200_search_complete.png" alt="" /></p>
<blockquote>
<p>Search complete</p>
</blockquote>
<p>Press [<strong>Next</strong>].</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/leuze_rsl_200_set_data_telegrams.png" alt="" /></p>
<blockquote>
<p>Access from: Settings → Data telegrams</p>
</blockquote>
<p>Set the IP address to the connected port of the IPC, set Telegram interval and Index interval as shown in the above Figure. Set the port to a unique port setting.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/leuze_rsl_200_set_LAN.png" alt="" /></p>
<blockquote>
<p>Access from: Settings → Communication → LAN</p>
</blockquote>
<p>Set the IP address to the same subnet as the port.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/leuze_rsl_200_download.png" alt="" /></p>
<blockquote>
<p>Download the parameters. </p>
</blockquote>
<p>Press the download button highlighted by a black square. A popup will appear, the default password is provided below.</p>
<p>The software will require authentication.</p>
<p>User: Engineer</p>
<p>Password: safety</p>
<p>Press OK on the next popup to update the parameters.</p>
<h3 id="rsl400"><a class="header" href="#rsl400">RSL400</a></h3>
<h4 id="scanner-configuration-1"><a class="header" href="#scanner-configuration-1">Scanner configuration</a></h4>
<p>Download Leuze configuration and diagnostic software Sensor Studio.
Additionally, download and install Safety Device Collection software to have device library and be able to configure the scanner.</p>
<p>Connect to the scanner via ethernet to your PC. Start the configuration software and select device search online. Press [<strong>Next</strong>].</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image4.png" alt="" /></p>
<p>Select the device to which you are trying to connect with the software and press [<strong>Next</strong>]. If you cannot see any devices in the list, make sure that Safety Device Collection is installed.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image5.png" alt="" /></p>
<p>Select <strong>LAN</strong> as interface and <strong>Ethernet</strong> as adapter.</p>
<p>Press [<strong>Start</strong>] to begin the search.</p>
<p>Select the correct device from the list and press [<strong>Next</strong>].</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image6.png" alt="" /></p>
<p>In order to get the scanner communicating with Navitrol, the UDP telegram needs to be configured to send packets to the IP of the navigation PC to the specified port.</p>
<p>Go to <strong>SETTINGS → Data telegrams</strong>.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image7.png" alt="" /></p>
<p>Set the following settings:</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image8.png" alt="" /></p>
<p>When the configurations are finished, download the setting to the device by pressing the download button.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image9.png" alt="" /></p>
<p>The software will require authentication.</p>
<p>User: Engineer</p>
<p>Password: safety</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image10.png" alt="" /></p>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 5</strong></p>
<p><strong>I,front/rear_scanner_port, 9999/9998 (The port that was set for the UDP telegram)</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.80</strong></p>
<p>Leuze can be configured to use 2 or 4 safety zones and Navitrol supports only 3. To choose which option is configured with Leuze, add the following parameter:</p>
<p><strong>I,scan_leuze_use_two_prot_funcs, 0 = 2 protective fields (default), 1 = 4 fields</strong></p>
<p>To select which warning zones to trigger from the Leuze status message, add the following parameter:</p>
<p><strong>I,scan_leuze_warning_zone_mode, 0 (default)</strong></p>
<p>If Leuze is configured to use 2 safety zones:</p>
<p><strong>Mode Selection</strong></p>
<p><strong>0 = protection + warning zone 1<br />
2 = protection + warning zone 2<br />
5 = warning zones 1 + 2</strong></p>
<p>If Leuze is configured to use 4 safety zones:</p>
<p>(usually P = estop, W1 = soft stop, W2 = slowdown)</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image11.png" alt="" /></p>
<h4 id="scanner-reset"><a class="header" href="#scanner-reset">Scanner reset</a></h4>
<p>When scanner has been configured in the Sensor Studio and the configuration is not known, then it may become impossible to connect to it. In such a case it may become necessary to reset it using the following procedure.</p>
<ol>
<li>
<p>Switch off the scanner</p>
</li>
<li>
<p>Remove scanner from the CU - mounting base (2 in the Figure)</p>
</li>
<li>
<p>Remove Jumper PNP/NPN (1 in the Figure) like it is shown on the figure</p>
</li>
</ol>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image12.png" alt="" /></p>
<ol start="4">
<li>
<p>Attach scanner on the base</p>
</li>
<li>
<p>Switch on the scanner</p>
</li>
<li>
<p>Message &quot;HIDE COVER  TO RESET CONFIGURATION&quot; should be displayed on the scanner</p>
</li>
<li>
<p>Within 2 minutes: Cover the screen (360°) with a cloth, so that all measurement values are small than 150mm.</p>
</li>
<li>
<p>If successful , the scanner deletes the configuration; „CONFIGURATION WAS RESET -- WAITING FOR CONFIGURATION&quot;</p>
</li>
<li>
<p>Switch off scanner</p>
</li>
<li>
<p>Remove scanner from CU</p>
</li>
<li>
<p>Insert Jumper PNP/NPN</p>
</li>
<li>
<p>Attach scanner to CU</p>
</li>
</ol>
<h2 id="sick-3"><a class="header" href="#sick-3">Sick</a></h2>
<h3 id="s300"><a class="header" href="#s300">S300</a></h3>
<p>There are several variants of S300 available. S300 Expert feature list includes &quot;Extended measured data output via RS-422 with landmark recognition&quot;, which means that</p>
<ul>
<li>S300 Expert can transfer all measured data in real-time (i.e. 40 ms interval), if the interface is set to 500 kBaud and no filter is set.</li>
<li>S300 Expert has built-in reflector detection (landmark detection).</li>
</ul>
<p>Other S300 variants do not support reflector detection and can transfer only every second measurement (i.e. 80 ms interval), if the interface is set to 500 kBaud.</p>
<p>So, if reflector detection is needed, then Expert model S300 scanners must be used. Because of capability to transfer all measurement data in real-time, S300 Expert is strongly recommended for localization use in all cases.</p>
<p>Configuration of the S300 is done with SICKs CDS-software.</p>
<h4 id="configuration-as-localization-scanner"><a class="header" href="#configuration-as-localization-scanner">Configuration as Localization Scanner</a></h4>
<p>The S300 scanners should be configured as described in this section to be used as localization scanners. It should be noted that, for communication protocol version 1.03 and later, it is not possible to get warning zone information from the scanners when used for localization, only protection zone information is available.</p>
<p>The baud rate has to be set to <strong>500 kBaud</strong>, the send mode needs to be <strong>Continuous data output</strong> and the Measured data output has to be <strong>Distance</strong> with no ranges selected. Also, the Message structure must be <strong>1 message</strong> and all I/O data outputs need to be unchecked. These configurations can be done from the <strong>Measured data output</strong>-tab.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image13.png" alt="" /></p>
<p>Also the field mode has to be set to <strong>4 x 0.5</strong> from the <strong>Resolution/scanning range-tab</strong>.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image14.png" alt="" /></p>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 1</strong></p>
<p><strong>S,front/rear_scanner_serial_port, &quot;The name of the serial port that the scanner is connected to</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.75</strong></p>
<h4 id="configuration-as-safety-scanner"><a class="header" href="#configuration-as-safety-scanner">Configuration as Safety Scanner</a></h4>
<p>The S300 scanners can be configured as safety scanners with both warning zone and protection zone information available for communication protocol version 1.03 and later. The only difference in the configuration software from the localization case is that OSSDs from I/O output needs to be enabled as seen below. All the other settings should be the same as in localization scanner configuration.</p>
<p>In params.txt file, the following parameters should be set:</p>
<p><strong>I,safety_scanner_model[0], 1</strong></p>
<p><strong>S,safety_scanner_addr[0], &quot;The name of the serial port that the scanner is connected to&quot;</strong></p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image15.PNG" alt="" /></p>
<h3 id="microscannanoscan"><a class="header" href="#microscannanoscan">microScan/nanoScan</a></h3>
<p>Download and launch Sick Safety Designer configuration software.</p>
<p>Connect to the device with a micro USB cable.</p>
<p>Select <strong>Search for devices</strong>.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image16.png" alt="" /></p>
<p>Double-click the found device to add it to the project.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image17.png" alt="" /></p>
<p>Open <strong>Configuration Data output.</strong></p>
<ol>
<li>
<p>Select <strong>On request and additionally countinuously to target computer</strong> as Send mode.</p>
</li>
<li>
<p>Set the IP address of the port in which the scanner is connected as the IP address (IPC LAN1 port default IP is 10.10.6.100).</p>
</li>
<li>
<p>Set the UDP port to be the same as in params.txt (default 2111 for front scanner and 2110 for rear scanner).</p>
</li>
<li>
<p>Set the scanner to send every measuring.</p>
</li>
<li>
<p>Set the scanner to send all of the data available.</p>
</li>
</ol>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image18.png" alt="" /></p>
<p>Download the configurations to the device with the <strong>Transfer</strong> button.</p>
<p>Confirm by pressing <strong>Yes</strong>.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image19.png" alt="" /></p>
<p>The software will require authentication.</p>
<p>User group: Authorized client</p>
<p>Password: SICKSAFE or sicksafe</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image20.png" alt="" /></p>
<p>To activate the new configurations, the device must be started in test mode and the configurations must be verified.</p>
<p>Press <strong>Yes</strong> on the Start device in test mode -window that appears after the transfer.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image21.png" alt="" /></p>
<p>To confirm that the settings are valid, press <strong>Verify</strong>.</p>
<p>Approve the verification report by pressing <strong>Yes</strong>.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image22.png" alt="" /></p>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 8</strong></p>
<p><strong>I,front/rear_scanner_port, 2111/2110 (The port that was set for the UDP telegram)</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.75</strong></p>
<h4 id="safety-zone-configurations-1"><a class="header" href="#safety-zone-configurations-1">Safety zone configurations</a></h4>
<p>By default, only two zone triggers (one protection zone and warning zone) are used. To have two warning zone violations reported to Navitrol, extra configuration is needed, both in Sick Safety Designer as well as Navitrol parameters. Scanner has to be configured to use cutoff paths to communicate violated zone to Navitrol.</p>
<p>Following instructions for scanner configuration was provided by Sick</p>
<h5 id="configuring-with-safety-designer"><a class="header" href="#configuring-with-safety-designer">Configuring with Safety Designer.</a></h5>
<p>After creating a project in Safety Designer with chosen nanoScan3 device and optionally accessing the device with USB, you should be able to see the measurements from nanoScan3 in the &quot;Fields&quot; configuration window.
The configuration file can also be made without the device.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image23.png" alt="" /></p>
<p>The field coordinates window can be zoomed using CTRL+Scroll</p>
<p>The first protective field can be drawn with the rectangle-tool circled with yellow marker. In this example protective field is 500 mm wide, 800 mm high ranging from 200 mm to 1000 mm. Software automatically adds a triangular shape in front of the protective field, so blinding the scanner would not prevent safety output from activating.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image24.png" alt="" /></p>
<p>Warning fields can be added using the top right marked button &quot;Add field to field set&quot; and it can be set as a &quot;Warning field&quot; by choosing &quot;Field type&quot; in the bottom right corner. After that you can similarly define the field with &quot;Draw rectangle&quot; or with other shape tools.</p>
<p>Below we can see 3 fields. One protective field defined from 200 -- 1000 mm, two warning fields with 1000 - 1500 mm and 1500 -- 2000 mm ranges respectively.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image25.png" alt="" /></p>
<p>After defining the fields, move to &quot;Inputs and outputs, local&quot; to define the digital outputs. In this example we assign two &quot;Monitoring results&quot; into inputs 2 and 3.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image26.png" alt="" /></p>
<p>After defining the outputs, move to &quot;Monitoring cases&quot;-tab to assign the fields defined before to the outputs, by dragging the field set. After that tick the &quot;Universal outputs&quot;, so the safety scanner knows which outputs to activate, when field is intercepted.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image27.png" alt="" /></p>
<p>Now you have configured the scanner to use two warning fields and one protective field. Next step is to send the configuration to the scanner if you have one available by clicking &quot;Transfer&quot;, or to save the configuration for later use.</p>
<p>Safe Cut-off path needs to be configured for protective field, and Non-safe Cut-off paths for warning fields. In the example case above the cut-off paths were set to following values:</p>
<ul>
<li>
<p>Protective field has safe cut-off path 1</p>
</li>
<li>
<p>Warning field 1 has non-safe cut-off path 2</p>
</li>
<li>
<p>Warning field 2 has non-safe cut-off path 3</p>
</li>
</ul>
<p>These values we need to configure to the Navitrol parameters.</p>
<h5 id="navitrol-parameters-4"><a class="header" href="#navitrol-parameters-4">Navitrol parameters</a></h5>
<p>Navitrol parameters are configured to same path numbers (1-20) as defined in Safety Designer to map fields into zones in Navitrol. After fields are defined and configurations done in both Safety Designer and Navitrol, configuration should be verified by connecting Navitrol Monitor and triggering the scanner fields to see if matching warning is raised in Monitor.</p>
<p>Parameters:</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>scan_sick_protection_zone_safety_cutoff_path</td><td>Int</td><td>0</td><td>Used to check protection zone violation, 0 for disabled; min 0, max 20</td></tr>
<tr><td>scan_sick_warning_zone1_safety_cutoff_path</td><td>Int</td><td>0</td><td>Used to check warning zone 1 violation, 0 for disabled; min 0, max 20</td></tr>
<tr><td>scan_sick_warning_zone2_safety_cutoff_path</td><td>Int</td><td>0</td><td>Used to check warning zone 2 violation, 0 for disabled; min 0, max 20</td></tr>
</tbody></table>
<h3 id="tim-lms1-lms511"><a class="header" href="#tim-lms1-lms511">TIM***, LMS1**, LMS511</a></h3>
<p>Download and launch Sopas Engineering Tool.</p>
<ol>
<li>
<p>Search for devices by pressing the <strong>Search devices: Defaul</strong>t button.</p>
</li>
<li>
<p>Press the <strong>Edit IP address</strong> button.</p>
</li>
</ol>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image28.png" alt="" /></p>
<ol>
<li>
<p>Select <strong>Use the following IP settings</strong>.</p>
</li>
<li>
<p>Select an IP address for the scanner. It is recommended to set the front and rear scanners to different domains. The ethernet port in which the scanner is connected to must also be in the same domain.</p>
</li>
<li>
<p>Set the Subnetmask to 255.255.255.0.</p>
</li>
</ol>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image29.png" alt="" /></p>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 0</strong></p>
<p><strong>S,front/rear_scanner_ip, &quot;The IP address that was set for the scanner&quot;</strong></p>
<p><strong>I,front/rear_scanner_port, &quot;The port that was set for the scanner&quot;</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.75</strong></p>
<h2 id="omron-1"><a class="header" href="#omron-1">Omron</a></h2>
<h3 id="os32c"><a class="header" href="#os32c">OS32C</a></h3>
<p>Download the OS32C Configuration Tool software.</p>
<p>Connect to the device via Ethernet.</p>
<p>Configure your local area connection of your PC to obtain an IP address
automatically.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image30.png" alt="" /></p>
<p>Start the configuration software. A Discover Sensors window will pop up.</p>
<p>Press [<strong>Continue</strong>] to search for devices that are connected to your PC.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image31.png" alt="" /></p>
<p>When a sensor is found the software will require authentication.</p>
<pre><code>User: Supervisor
Password: supeusr
</code></pre>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image32.png" alt="" /></p>
<p>Go to <strong>Utilities Sensor Ethernet Configuration.</strong> The Ethernet Configuration screen pops up.</p>
<ol>
<li>
<p>Select <strong>Use the following address</strong>.</p>
</li>
<li>
<p>Select an <strong>IP address</strong> for the scanner. It is recommended to set the front and rear scanners to different domains. The Ethernet port of the IPC in which the scanner is connected must also be in the same domain.</p>
</li>
<li>
<p>Set the <strong>Subnet mask</strong> to 255.255.255.0.</p>
</li>
<li>
<p>Press [<strong>Write to Sensor</strong>]</p>
</li>
</ol>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image34.png" alt="" /></p>
<p>Confirm the changes in Ethernet configuration.</p>
<p>An information window is displayed. Read the message and decide if you want to continue to use the current IP address or start using the new address by restarting the sensor. To confirm and change the IP, press [<strong>Connect</strong>].</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/figure35.png" alt="" /></p>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 2</strong></p>
<p><strong>S,front/rear_scanner_ip, &quot;The IP address that was set for the scanner&quot;</strong></p>
<p><strong>I,front/rear_scanner_port, 44818</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.85</strong></p>
<p><strong>scan_omron_set_warning_zones 1 to change the warning zone set and 0 if they are valid</strong></p>
<h2 id="hokuyo-1"><a class="header" href="#hokuyo-1">Hokuyo</a></h2>
<h3 id="uam-05lp"><a class="header" href="#uam-05lp">UAM-05LP</a></h3>
<h4 id="changing-ip-address"><a class="header" href="#changing-ip-address">Changing IP-address</a></h4>
<p>Download the UAM project Designer SW.</p>
<p>Connect to the device using USB cable. Configuration is password protected and default password is 12345678. For details, see &quot;Safety Laser Scanner UAM-05LP User's Manual&quot;</p>
<p>Factory default values are</p>
<ul>
<li>
<p>IP address : 192.168.0.10</p>
</li>
<li>
<p>Default gateway : 192.168.0.1</p>
</li>
<li>
<p>Subnet mask : 255.255.255.0</p>
</li>
<li>
<p>Port number : 10940</p>
</li>
</ul>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image36.png" alt="" /></p>
<p>When all the configurations are complete, click &quot;Confirm&quot; button to verify the configuration and send to device or save to SD card.</p>
<h4 id="navitrol-parameters-5"><a class="header" href="#navitrol-parameters-5">Navitrol parameters</a></h4>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 6</strong></p>
<p><strong>S,front/rear_scanner_ip, *The IP address that was set for the scanner*</strong></p>
<p><strong>I,front/rear_scanner_port, 10940</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.5</strong></p>
<h4 id="smart-urg-series"><a class="header" href="#smart-urg-series">Smart-URG series</a></h4>
<p><strong>NOTE: Only model UST-10LX-H02 tested by Navitec</strong></p>
<p>Download the data viewing tool UrgBenriPlus.</p>
<p>Connect to the device using Ethernet.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image37.png" alt="" /></p>
<p>Default IP-address of the scanner is 192.168.0.10. You can change it by connecting to the device and then pressing the Change IP Address button. This opens the window shown below.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image38.png" alt="" /></p>
<h4 id="navitrol-parameters-6"><a class="header" href="#navitrol-parameters-6">Navitrol parameters</a></h4>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 12</strong></p>
<p><strong>S,front/rear_scanner_ip, &quot;The IP address that was set for the scanner&quot;</strong></p>
<p><strong>I,front/rear_scanner_port, 10940</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.75</strong></p>
<h2 id="keyence-1"><a class="header" href="#keyence-1">Keyence</a></h2>
<h3 id="sz-v32nsz-v32nc"><a class="header" href="#sz-v32nsz-v32nc">SZ-V32N/SZ-V32NC</a></h3>
<p>SZ-V series is a modular design safety scanner, consisting of two main components; scanner head and display unit. Different component combinations then result in different device variants. From Navitrol point of view the relevant thing is to have display unit having network interface and device having 'N' in model name:</p>
<ul>
<li>
<p>No N: No network connection capability</p>
</li>
<li>
<p>N: With PROFIsafe (PROFINET, UDP, EtherNet/IP™)</p>
</li>
<li>
<p>NC: With CIP Safety™ (EtherNet/IP™, UDP)</p>
</li>
</ul>
<h4 id="connecting"><a class="header" href="#connecting">Connecting</a></h4>
<p>The picture below shows different options for connecting SZ-V series devices to network. Complete units (having both head and display unit) can be connected directly to IPC or via switch. They can be connected &quot;daisy-chained&quot; using dual connectors in display unit.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image39.png" alt="" /></p>
<p>SZ-V series devices also support master-slave connection, where head units without display units are connected to full unit via special expansion cable; see red rectangle in picture above In such a case communication to slave units (heads) can be realized through the master device.</p>
<p><strong>NOTE:</strong> Navitrol does not support this master-slave communication method.</p>
<h4 id="operating-modes"><a class="header" href="#operating-modes">Operating modes</a></h4>
<p>SZ-V series has two operating modes; Standard Mode and High Speed Mode.</p>
<p><strong>High Speed Mode</strong> is required by Navitrol. It does with some shortcomings though.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image40.png" alt="" /></p>
<p>The measurement distance data can be received in increments of 0.2° in standard mode and in increments of 0.4° if the Operating mode is High Speed mode.</p>
<p>Keyence also has an option for &quot;measured value stabilization filter&quot;; which is not recommended as it adds extra delay to measurements.</p>
<h4 id="configuration"><a class="header" href="#configuration">Configuration</a></h4>
<p>Configuration can be done using Keyence SZ-V configuration software SZ-V Configurator; included in the Safety Device Configurator. It is possible to communicate with the SZ-V configuration software (SZ-V Configurator) via Ethernet or USB.</p>
<p>Detailed step by step instructions for different connection options are described in &quot;Keyence Safety Laser Scanner SZ-V32N / SZ-V32NC Communications Manual&quot;. The following pictures show the relevant communication settings when used with Navitrol. Communication protocol shall be UDP and scanner should have a static IP address.</p>
<p>Select communication protocol</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image41.png" alt="" /></p>
<p>Set IP address</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image42.png" alt="" /></p>
<h4 id="navitrol-parameters-7"><a class="header" href="#navitrol-parameters-7">Navitrol parameters</a></h4>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 7</strong></p>
<p><strong>S,front/rear_scanner_ip, &quot;The IP address that was set for the scanner&quot;</strong></p>
<p><strong>I,front/rear_scanner_port, 8800</strong></p>
<h2 id="pepperlfuchs-2"><a class="header" href="#pepperlfuchs-2">Pepperl+Fuchs</a></h2>
<h3 id="r2000"><a class="header" href="#r2000">R2000</a></h3>
<p>The only manual setting required is the IP address setting of the Ethernet connection of the scanner. The Navitrol application handles the other scanner settings at startup. There are two methods to edit the IP setting; local user interface and PACTware software.</p>
<h4 id="using-pactware-software"><a class="header" href="#using-pactware-software">Using PACTware software</a></h4>
<ul>
<li>
<p>Download the PACTware software and Device Type Manager (DTM) from the software section on the page: <a href="http://www.pepperl-fuchs.com/global/en/classid_53.htm?view=productdetails&amp;prodid=64617">pepperl-fuchs.com</a></p>
</li>
<li>
<p>Connect the scanner to the computer via Ethernet cable.</p>
</li>
<li>
<p>Set your computer IP address to 192.168.0.xxx (the scanner default IP address is 192.168.0.1).</p>
</li>
<li>
<p>If the scanner is restored to factory default settings just set your computer to DHCP mode (the scanner is in Auto IP mode).</p>
</li>
<li>
<p>Start the PACTware software.</p>
</li>
<li>
<p>In the Device catalog, select communication by double clicking the R2000 IP Comm (see Fig 10). The selected IP communication should appear in the Structure window.</p>
</li>
</ul>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image43.png" alt="" /></p>
<blockquote>
<p>Figure 10: Select communication.</p>
</blockquote>
<ul>
<li>Select the device in the Device catalog by double clicking the proper device model, like OMDxxx-R2000 UHD (see Fig 11). The selected device should appear in the Structure window (see Fig 12).</li>
</ul>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image44.png" alt="" /></p>
<blockquote>
<p>Figure 11: Select device.</p>
</blockquote>
<ul>
<li>
<p>Select R2000 IP Comm in the Structure window and click connect in the top bar. Do the same for OMDxxx-R2000. If a connection is established the connection picture in the Structure window should turn green (Fig 12).</p>
</li>
<li>
<p>When connected, double click the OMDxxx-R2000 (Fig 12) to open a scanner configuration window (Fig 13).</p>
</li>
</ul>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image45.png" alt="" /></p>
<blockquote>
<p>Figure 12: Connect.</p>
</blockquote>
<p>In the scanner configuration window (Fig 13):</p>
<ul>
<li>
<p>Select the Ethernet Setup.</p>
</li>
<li>
<p>Tick Enable update of IP configuration.</p>
</li>
<li>
<p>Change the IP address in the New Settings.</p>
</li>
<li>
<p>Store the settings in the device.</p>
</li>
<li>
<p>Reboot the scanner or turn it off.</p>
</li>
</ul>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image46.png" alt="" /></p>
<blockquote>
<p>Figure 13: Ethernet Setup.</p>
</blockquote>
<h4 id="using-local-user-interface"><a class="header" href="#using-local-user-interface">Using local user interface</a></h4>
<p>Local user interface can be used to change the IP address settings.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image47.png" alt="" /></p>
<p>Buttons 3 and 4 can be used to navigate into local menu system for acquiring and modifying some settings, like IP settings. Visual feedback is presented in area marked with 7. Local menu is pretty intuitive to use -- menu structure and more detailed instructions can be found from P&amp;F OMDxx-R2000 user manuals.</p>
<p><strong>NOTE:</strong> Changes to the IP configuration take effect only after a restart.</p>
<h4 id="navitrol-parameters-8"><a class="header" href="#navitrol-parameters-8">Navitrol parameters</a></h4>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 3</strong></p>
<p><strong>S,front/rear_scanner_ip, &quot;The IP address that was set for the scanner&quot;</strong></p>
<p><strong>I,front/rear_scanner_port, 80</strong></p>
<p><strong>F,reflector_rssi_min_ratio, 0.75</strong></p>
<p><strong>There are also several P&amp;F R2000 specific parameters in params.txt. Available and recommended settings for these values depend on R2000 device family. See chapter R2000 variants for details.</strong></p>
<h3 id="r2000-variants"><a class="header" href="#r2000-variants">R2000 variants</a></h3>
<p>There are three variants of R2000 -- UHD, HD and SD. UHD model is most capable and the recommended model. One clear difference is the maximum sampling rate. Navitrol documentation has in the past recommended settings that are valid for UHD model only.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image48.jpeg" alt="" /></p>
<p><strong>NOTE: Some values (2800/3150) in the table above are not REALLY usable. Another thing to consider is that increasing the number and frequency of measurements increases the load on the CPU.</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>scan_pef_samples_per_scan</td><td>Int</td><td>2400</td><td>Valid values: 72, 90, 120, 144, 180, 240, 360, 400, 450, 480, 600, 720, 800, 900, 1200, 1440, 1800, 2400, 3600, 4200, 5040, 5600, 6300, 7200, 8400, 10080, 12600, 16800, 25200</td></tr>
<tr><td>scan_pef_freq</td><td>Int</td><td>25</td><td>Valid max values for freq/samples: 10/25200, 15/16800, 20/12600, 25/10080, 30/8400, 35/7200, 40/6300, 45/5600, 50/5040 (NOTE: UHD  limitations)</td></tr>
<tr><td>scan_pef_use_nth_scan</td><td>Int</td><td>1</td><td>Use only every n~th~ scan <br>NOTE: This is Navigation SW internal parameter - not sent to scanner.</td></tr>
<tr><td>scan_pef_use_nth_meas</td><td>Int</td><td>1</td><td>Use only every n~th~ measurement from each scan for natural features navigation<br>NOTE: This is Navigation SW internal parameter - not sent to scanner.</td></tr>
<tr><td>scan_pef_display_on</td><td>Int</td><td>0</td><td>0 = scanner display off, 1 = display on</td></tr>
<tr><td>scan_pef_lcm_mode</td><td>Int</td><td>0</td><td>Lens Contamination Monitor (LCM) sensitivity: 0 - disabled, 1 - low, 2 - medium, 3 - high</td></tr>
</tbody></table>
<p>Navitrol reads the device model/family information from the device connected and validates parameters (scan_pef_samples_per_scan/scan_pef_freq) based on the actual capabilities of the device connected.</p>
<h4 id="r2000-uhd"><a class="header" href="#r2000-uhd">R2000 UHD</a></h4>
<p>Recommended parameters to begin with depend also on the Navitrol version and IPC capabilities.</p>
<p><strong>Navitrol versions prior to 6.34.00</strong></p>
<table><thead><tr><th>Parameter</th><th>With natural features only</th><th>With reflectors</th></tr></thead><tbody>
<tr><td><strong>I,scan_pef_samples_per_scan</strong></td><td>2400</td><td>5040</td></tr>
<tr><td><strong>I,scan_pef_freq</strong></td><td>50</td><td>50</td></tr>
<tr><td><strong>I,scan_pef_use_nth_scan</strong></td><td>2</td><td>2</td></tr>
<tr><td><strong>I,scan_pef_use_nth_meas</strong></td><td>1</td><td>2</td></tr>
<tr><td><strong>I,scan_pef_display_on</strong></td><td>0</td><td>0</td></tr>
</tbody></table>
<p><strong>Navitrol versions 6.34.00 and later</strong></p>
<p>With one P&amp;F used for localization <strong>OR</strong> high spec IPC/CPU when using two scanners for localization (consult Navitec).</p>
<table><thead><tr><th>Parameter</th><th>With natural features only</th><th>With reflectors</th></tr></thead><tbody>
<tr><td><strong>I,scan_pef_samples_per_scan</strong></td><td>3600</td><td>7200</td></tr>
<tr><td><strong>I,scan_pef_freq</strong></td><td>50</td><td>25</td></tr>
<tr><td><strong>I,scan_pef_use_nth_scan</strong></td><td>2</td><td>1</td></tr>
<tr><td><strong>I,scan_pef_use_nth_meas</strong></td><td>1</td><td>2</td></tr>
<tr><td><strong>I,scan_pef_display_on</strong></td><td>0</td><td>0</td></tr>
</tbody></table>
<p>If these settings cause too much load on the CPU, then settings recommended for Navitrol versions prior to 6.34.00 should be used instead.</p>
<h4 id="r2000-hd"><a class="header" href="#r2000-hd">R2000 HD</a></h4>
<p>Setup of HD variant is the same as UHD -- only difference is that there are some limitations in sampling rate.</p>
<p>Recommended parameters to begin with:</p>
<p><strong>Navitrol versions prior to 6.34.00</strong></p>
<table><thead><tr><th>Parameter</th><th>With natural features only</th><th>With reflectors</th></tr></thead><tbody>
<tr><td><strong>I,scan_pef_samples_per_scan</strong></td><td>2520</td><td>2520</td></tr>
<tr><td><strong>I,scan_pef_freq</strong></td><td>25</td><td>25</td></tr>
<tr><td><strong>I,scan_pef_use_nth_scan</strong></td><td>1</td><td>1</td></tr>
<tr><td><strong>I,scan_pef_use_nth_meas</strong></td><td>1</td><td>1</td></tr>
<tr><td><strong>I,scan_pef_display_on</strong></td><td>0</td><td>0</td></tr>
</tbody></table>
<p><strong>Navitrol versions 6.34.00 and later</strong></p>
<p>With one P&amp;F used for localization <strong>OR</strong> high spec IPC/CPU when using two scanners for localization (consult Navitec).</p>
<table><thead><tr><th>Parameter</th><th>With natural features only</th><th>With reflectors</th></tr></thead><tbody>
<tr><td><strong>I,scan_pef_samples_per_scan</strong></td><td>3600</td><td>3600</td></tr>
<tr><td><strong>I,scan_pef_freq</strong></td><td>23</td><td>23</td></tr>
<tr><td><strong>I,scan_pef_use_nth_scan</strong></td><td>1</td><td>1</td></tr>
<tr><td><strong>I,scan_pef_use_nth_meas</strong></td><td>1</td><td>1</td></tr>
<tr><td><strong>I,scan_pef_display_on</strong></td><td>0</td><td>0</td></tr>
</tbody></table>
<p>If these settings cause too much load on the CPU, then settings recommended for Navitrol versions prior to 6.34.00 should be used instead.</p>
<h2 id="quanergy-1"><a class="header" href="#quanergy-1">Quanergy</a></h2>
<h3 id="quanergy-m1"><a class="header" href="#quanergy-m1">Quanergy M1</a></h3>
<p>Quanergy M1 comes in different variants; M1-CORE, M1-PLUS and M1-ULTRA (consult Navitec for variant selection). They differ in some features like maximum scan distance. Configuration for each model is however the same.</p>
<p>The Quanergy M1 Sensor Settings Management application (web server) runs in a web browser over the HTTP communication protocol to support a direct connection between the web server (scanner) and client. For details see <em>&quot;Quanergy M1 Sensor User Guide&quot;</em>. The following lists some basic settings that shall be set for navigation use.</p>
<p><strong>NOTE:</strong> Reflectors can't be used for localization with Quanergy M1 scanner.</p>
<h4 id="connecting-1"><a class="header" href="#connecting-1">Connecting</a></h4>
<p>Connect the scanner to any PC with browser.</p>
<ul>
<li>
<p>Open a web browser.</p>
</li>
<li>
<p>In the browser URL field, type the URL, which is simply the sensor IP address appended by :7780. For example 192.168.1.180:7780</p>
</li>
<li>
<p>Press the Enter key. The M1 Sensor tab appears</p>
</li>
</ul>
<p>By default, the login credentials are:</p>
<pre><code>Username: editor
Password: &lt;sensor_serial_number&gt;
</code></pre>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/figure49.png" alt="" /></p>
<h4 id="settings"><a class="header" href="#settings">Settings</a></h4>
<p>Relevant settings can be found from &quot;Settings-Edit Settings&quot; and &quot;Settings-Edit Network Settings&quot;.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image50.png" alt="" /></p>
<p><strong>Network settings</strong></p>
<p>Set static IP address of your choice and &quot;Submit&quot; and &quot;Reboot&quot;.</p>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image51.png" alt="" /></p>
<p><strong>Sensor settings</strong></p>
<p>Select maximum frame rate of 20 Hz. This results in roughly 0.134 degree angular resolution.</p>
<p>It is recommended to use Return data: Return 0. If any other data selection is used, then</p>
<ul>
<li>
<p>single return -- Navitrol obviously uses the data set selected</p>
</li>
<li>
<p>multi return (ALL) -- Navitrol picks return 0 value (causes unnecessary extra network load)</p>
</li>
</ul>
<p><img src="AgvInterfaces/ScannerConfigurations/./media-en/image52.png" alt="" /></p>
<h4 id="navitrol-parameters-9"><a class="header" href="#navitrol-parameters-9">Navitrol parameters</a></h4>
<p>Set the following parameters to params.txt:</p>
<p><strong>I,scanner_model_front/rear, 11</strong></p>
<p><strong>S,front/rear_scanner_ip, &quot;The IP address that was set for the scanner&quot;</strong></p>
<p><strong>I,front/rear_scanner_port, 4141</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scanner-communication-troubleshoot"><a class="header" href="#scanner-communication-troubleshoot">Scanner Communication Troubleshoot</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-10"><a class="header" href="#glossary-10">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Navigation software for an individual vehicle.</td></tr>
<tr><td>NavitrolMonitor</td><td>Monitoring software for the Navitrol positioning software running on an individual vehicle.</td></tr>
<tr><td>NavithorTools</td><td>Software for creating and editing environment and routes for the Navitrol navigation software.</td></tr>
<tr><td>Supervisor</td><td>On-board PLC or PC controlling some components of the AGV. Communicates with Navitrol.</td></tr>
<tr><td>Navigation computer/IPC</td><td>The computer system running Navitrol.</td></tr>
<tr><td>RSSI</td><td>Received Signal Strength Indicator.</td></tr>
<tr><td>UDP</td><td>User Datagram Protocol.</td></tr>
<tr><td>TCP</td><td>Transmission Control Protocol.</td></tr>
</tbody></table>
<h2 id="setup-11"><a class="header" href="#setup-11">Setup</a></h2>
<h3 id="ethernet-scanners"><a class="header" href="#ethernet-scanners">Ethernet scanners</a></h3>
<p>Depending on the scanner model, the communication between the scanner and Navitrol can be either UDP or TCP/IP. In both cases the recommendations for the network layout and the setup apply.</p>
<p>It is recommended to setup the scanner(s) to communicate to Navitrol in an excluded network to avoid any possible routing mistakes. If possible, the best way to do this is to connect the scanner(s) to their own designated LAN port on the IPC on which Navitrol is running on.
This way the only possible source of delay for the communication is the cable in between.</p>
<p>In a standard case with an IPC with 2 LAN ports, if possible, the scanners should be separated to different ports that are configured into different domain addresses.</p>
<p>Example IPs for LAN ports and scanners:</p>
<ul>
<li>LAN1: 10.10.6.100
<ul>
<li>Scanner 1: 10.10.6.1</li>
</ul>
</li>
<li>LAN2: 10.10.7.100
<ul>
<li>Scanner 2: 10.10.7.1</li>
</ul>
</li>
</ul>
<p><img src="AgvInterfaces/ScannerCommunicationTroubleshoot/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>IPC interfaces</p>
</blockquote>
<p>If there are other devices that need to communicate to the IPC via ethernet, it is recommended to separate the scanners into their own LAN port and domain address and handle all other communication via the second LAN port. In this case it is important, that in case of two (or more) scanners, each scanner is configured to communicate using
different IP address/port combination. In any case each scanner shall have a unique IP address.</p>
<p>Example IPs for scanners on one LAN port and other ethernet devices on another:</p>
<ul>
<li>LAN1: 10.10.6.100
<ul>
<li>Scanner 1: 10.10.6.1:2111</li>
<li>Scanner 2: 10.10.6.2:2111</li>
</ul>
</li>
<li>LAN2: 10.10.7.100
<ul>
<li>Supervisor: 10.10.7.1</li>
</ul>
</li>
</ul>
<p>In case of UDP scanners, scanners shall be configured to send their messages to different ports while target IP-address is the same for all -- that being IP address of the IPC. That port is then configured in Navitrol parameter file accordingly for each scanner (see parameters at the end of this chapter).</p>
<p>Example IPs for UDP scanners:</p>
<ul>
<li>IPC: 192.168.3.20
<ul>
<li>Scanner 1: 192.168.3.20:2111</li>
<li>Scanner 2: 192.168.3.20:2112</li>
</ul>
</li>
</ul>
<p>In case of TCP/IP scanners, it is enough that each scanner has a unique IP address. Port can be the same in each scanner (can be unique also).
Each IP-address/port combination is then configured in Navitrol parameter file (see parameters at the end of this chapter).</p>
<p>Example IPs for TCP/IP scanners on the same domain:</p>
<ul>
<li>LAN1: 10.10.6.100
<ul>
<li>Scanner 1: 10.10.6.1:2111</li>
<li>Scanner 2: 10.10.6.2:2111</li>
</ul>
</li>
</ul>
<p>In all cases, where you have several components communicating through the same LAN port, you have the devices connected through a router or ethernet switch. It is important to make sure that this router or switch is good enough to be able to keep up with the amount of traffic.</p>
<p>Example IPs for several devices on the same LAN port:</p>
<ul>
<li>LAN2: 10.10.7.100
<ul>
<li>Supervisor: 10.10.7.1</li>
<li>Router: 10.10.7.2</li>
<li>Other ethernet sensor: 10.10.7.3</li>
</ul>
</li>
</ul>
<p>After setting up the physical layout and the scanner configurations, Navitrol has to be configured to have to the correct IPs (in case of TCP/IP scanners) and the correct ports with the following parameters:</p>
<ul>
<li>
<p><strong>S,front_scanner_ip,</strong> = IP address of the front scanner</p>
</li>
<li>
<p><strong>S,rear_scanner_ip,</strong> = IP address of the rear scanner</p>
</li>
<li>
<p><strong>I,front_scanner_port,</strong> = Port for the front scanner (default:
Sick 2111, PEF 80, Omron 44818, Velodyne 2368, Hokuyo 10940, Leuze
9999, Keyence 8800)</p>
</li>
<li>
<p><strong>I,rear_scanner_port,</strong> = Port for the rear scanner</p>
</li>
</ul>
<p>For safety and extra measurement scanners IP-address and port are combined as follows:</p>
<ul>
<li>
<p><strong>S,safety_scanner_addr[0]</strong>,&quot;1.1.1.1:500&quot;</p>
</li>
<li>
<p><strong>S,scanner_meas_addr[0]</strong>,&quot;10.10.6.22:5000&quot;</p>
</li>
</ul>
<h3 id="serial-scanners-sick-s300"><a class="header" href="#serial-scanners-sick-s300">Serial scanners (Sick S300)</a></h3>
<p>In order to communicate with serial Sick S300 scanners, Navitrol requires an IPC with a RS422 port. This is due to the higher (and non-standard) baud rate that is required for the scanner communication.</p>
<p>For this communication a standard serial port is replaced with a dual RS422 card. The card is from Diamond Systems, therefore the mark DS below the port, see the figure below. The SICK S300 scanners shall be connected to the D9 connector according to the figure.</p>
<p><img src="AgvInterfaces/ScannerCommunicationTroubleshoot/./media-en/image5.png" alt="" /></p>
<p><img src="AgvInterfaces/ScannerCommunicationTroubleshoot/./media-en/image6.png" alt="" /></p>
<p>After the card is physically installed, it must be made sure that the RS-422 ports are available for Navitrol. The mother board serial ports IRQs can clash with the DS IRQs which will result into non-functional RS-422 port. Because of this, it is sometimes necessary to disable at least 2 of the mother board serial ports from the BIOS settings of the IPC in order to get the DS ports visible on the Debian side.</p>
<p>Active serial ports can be checked with the following command: <code>dmesg | grep tty</code></p>
<p>Output should be similar to the example below. In this case the DS serial ports are ttyS2 and ttyS3.</p>
<p><img src="AgvInterfaces/ScannerCommunicationTroubleshoot/./media-en/image7.png" alt="" /></p>
<p>See what the names are for the DS serial ports. In Debian Jessie and newer distros, the ports are named ttyS* but in Debian Wheezy they appear as ttyXR*.</p>
<p>In order for the S300 communication to work, the baud rate of the RS-422 ports need to be set to 500 kBaud.
Add the following line to the beginning of the startNavitrol.sh files that can be found inside the /home/navitec directory in the IPC (* being the number of the serial port):</p>
<p>For Debian Jessie and later distros</p>
<p><em><strong>stty -F/dev/ttyS* 500000</strong></em></p>
<p><em><strong>stty -F/dev/ttyS* 500000</strong></em></p>
<p>For Debian Wheezy</p>
<p><em><strong>stty -F/dev/ttyXR* 500000</strong></em></p>
<p><em><strong>stty -F/dev/ttyXR* 500000</strong></em></p>
<p>The correct serial port names for the DS have to be defined also in the
Navitrol parameters:</p>
<ul>
<li>
<p><strong>S,front_scanner_serial_port,</strong> /dev/ttyS2 (example) = Serial
port of the front scanner</p>
</li>
<li>
<p><strong>S,rear_scanner_serial_port,</strong> /dev/ttyS3 (example) = Serial
port of the rear scanner</p>
</li>
</ul>
<h2 id="troubleshooting-17"><a class="header" href="#troubleshooting-17">Troubleshooting</a></h2>
<p>If there are issues in the scanner communication, Navitrol will display an error or warning notifying of this. Here are the errors and warnings that you might encounter and the ways to resolve the issues generally.</p>
<p>There are also some scanner model specific features that can be adjusted to prevent issues.</p>
<h3 id="general-1"><a class="header" href="#general-1">General</a></h3>
<p>In order to see how well the scanners are communicating, it can be checked either from Navitrol Monitor or from the Navitrol text logs.</p>
<p>From Navitrol Monitor you can see the cycle times for the incoming scanner measurements from <strong>Charts à Positioning à Cycle Times.</strong></p>
<p>Here you can monitor the &quot;FrSc&quot; graph (blue) for the intervals between the measurements from the front scanner and &quot;ReSc&quot; graph (yellow) for the rear scanner:</p>
<p><img src="AgvInterfaces/ScannerCommunicationTroubleshoot/./media-en/image8.png" alt="" /></p>
<p>The graph should ideally be as steady as possible around the nominal/configured scan frequency. If there are spikes in the communication, the cause for this should be looked at, since too much deviation from the expected interval will result into timeouts on Navitrol's side.</p>
<p><img src="AgvInterfaces/ScannerCommunicationTroubleshoot/./media-en/image9.png" alt="" /></p>
<h3 id="no-communication"><a class="header" href="#no-communication">No communication</a></h3>
<p>If Navitrol has been configured to expect communication from a scanner and there is no communication, Navitrol will display the following error depending on if it is a front/rear scanner:</p>
<p>ERROR_NO_SCAN_FROM_FRONT_SCANNER</p>
<p>ERROR_NO_SCAN_FROM_REAR_SCANNER</p>
<p>If the scanner is configured as a safety scanner only, Navitrol will display the following error:</p>
<p>ERROR_NO_SCAN_FROM_SAFETY_SCANNER</p>
<p>If the scanner is configured as an additional measurement scanner, Navitrol will display the following warning:</p>
<p>WARNING_NO_SCAN_FROM_MEAS_SCANNER</p>
<p>In the case of a complete communication loss, here are some things to check:</p>
<ul>
<li><strong>Ethernet Scanners</strong>
<ol>
<li>Try to ping the scanner from the IPC
<ul>
<li>If the ping does not go through
<ul>
<li>Check the wiring</li>
<li>Check the configurations on the scanner side -- IP, port</li>
<li>Check the IP configurations on the LAN port of the IPC where the scanner is connected</li>
</ul>
</li>
<li>If the ping goes through
<ul>
<li>Check the Navitrol parameters -- IP, port, scanner model, etc...</li>
<li>Check the output on the scanner side -- measurement output active</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li><strong>Serial Scanners</strong>
<ol>
<li>Check the wiring</li>
<li>Check the serial port configuration in Navitrol parameters and <code>startNavitrol.sh</code>
<ul>
<li>Correct serial port name</li>
<li>Correct baud rate</li>
</ul>
</li>
<li>Check the serial port configurations on the IPC
<ul>
<li>RS422 port available</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="communication-high-dt"><a class="header" href="#communication-high-dt">Communication high dt</a></h3>
<p>If the communication interval is deviating from the optimal interval, this can be either caused by incorrectly set targets or thresholds for the communication in the Navitrol parameters or something outside of Navitrol, like a wiring or routing issue.</p>
<p>Each scanner model has their own interval for the measurements which Navitrol sets automatically.</p>
<p>If the average deviance exceeds the value set with the following parameter:
<strong>I, scan_max_dt_err_ms, 5 (Default value)</strong></p>
<p>Navitrol will trigger the error for too high deviance depending on which scanner is in question:</p>
<p>ERROR_SCANNER_FRONT_HIGH_DT</p>
<p>ERROR_SCANNER_REAR_HIGH_DT</p>
<p>If the scanner in question is not used for navigation, Navitrol will prompt a warning instead:</p>
<p>WARNING_SCANNER_FRONT_HIGH_DT</p>
<p>WARNING_SCANNER_REAR_HIGH_DT</p>
<p>In the case of high deviancy in the interval, here are some things to check:</p>
<ul>
<li>Ethernet Scanners
<ol>
<li>Check the scanner intervals from the Cycle Times chart to see how much the interval is deviating from the target
<ul>
<li>In case the deviance is rare and just above the default error limit, the scan_max_dt_err_ms parameter can be raised (<strong>NOTE! this can have a negative effect on the localization since Navitrol allows a larger delay between the measurements which will then also increase the localization cycle of Navitrol</strong>)</li>
</ul>
</li>
<li>Set a continuous ping from the IPC to the scanner with communication issues to see if the issue is related to the network connection in general
<ul>
<li>If there are delays in the ping
<ul>
<li>Check if the issue is related to the network layout (chapter 1.1) -- It is possible that the measurements are routed incorrectly causing for some delay</li>
<li>Check if the issue is in the router by connecting the scanner directly to the IPC and testing the communication again</li>
<li>Check if the issue is in the cable by testing with another one</li>
<li>Check if the issue is in the LAN port of the IPC by testing the other port as well -- If there are issues only in one LAN port</li>
</ul>
</li>
<li>If the ping is going through without issues but there are still delays in getting the measurements
<ul>
<li>Analyse the network traffic from between the scanner and the IPC to see if the delay can be seen there as well with for example Wireshark</li>
<li>If the delay is visible, the issue is most likely something on the scanner side so the suppliers support should be contacted</li>
<li>If the delay is not visible when monitoring the traffic but visible on the Navitrol side, take a log file and contact Navitec Support</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li><strong>Serial Scanners</strong>
<ol>
<li>Check the scanner intervals from the Cycle Times chart to see how much the interval is deviating from the target
a. In case the deviance is rare and just above the default error limit, the scan_max_dt_err_ms parameter can be raised (<strong>NOTE! this can have a negative effect on the localization since Navitrol allows a larger delay between the measurements which will then also increase the localization cycle of Navitrol</strong>)</li>
<li>Check the wiring
a. In order for the pin layout in the DP9 connector to be correct, the wiring from the DS card to the port has to be correct as well
b. Serial communication is prone to disturbances so make sure that the wires are not led near motors or cables with higher voltages since these can result into inductive current</li>
</ol>
</li>
</ul>
<h3 id="reflectors-not-detected"><a class="header" href="#reflectors-not-detected">Reflectors not detected</a></h3>
<p>In order to detect reflectors, Navitrol requires an RSSI (signal strength) value to be sent by the scanner for each scanner measurement.</p>
<p>If Navitrol is not able to detect reflectors, make sure that your scanner is configured to send the RSSI value in the output. Since different scanner models detect different levels of RSSI values from the same reflector, the ratio needs to be setup scanner specifically according to the Navitrol -- Scanner Configurations document.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optical-code-reader"><a class="header" href="#optical-code-reader">Optical Code Reader</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-11"><a class="header" href="#glossary-11">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>TCP</td><td>Transmission Control Protocol - connection oriented network communication protocol</td></tr>
<tr><td>SOPAS</td><td>SICK SOPAS engineering tool is a device configuration SW provided by SICK AG</td></tr>
<tr><td>Read Gate</td><td>Read Gate control is the term used for SICK Lector reading activation</td></tr>
</tbody></table>
<hr />
<h2 id="supported-models"><a class="header" href="#supported-models">Supported models</a></h2>
<p>For now Navitrol supports SICK Lector 6xxx using Ethernet interface (TCP). SICK Lector is an image-based code reader capable to read many different type of QR-code and bar-codes. It also has limited capability to tell how far from centerline the reader is.</p>
<h2 id="device-configuration"><a class="header" href="#device-configuration">Device configuration</a></h2>
<h3 id="sick-lector-6xxx"><a class="header" href="#sick-lector-6xxx">SICK Lector 6xxx</a></h3>
<p>Prior to configuration:</p>
<ul>
<li>SICK SOPAS software should be downloaded and installed.</li>
<li>IP address of the connected PC should be changed to match the domain with that of SICK Lector device.</li>
<li>SICK Lector shall be connected to PC using Ethernet and powered up.</li>
</ul>
<p>SICK Lector shall be configured both for intended application and for communication with Navitrol. There are two optional methods to do this configuration.</p>
<ul>
<li>Configure each SICK Lector with SOPAS, one by one</li>
<li>Configure SICK Lector by Navitrol using file exported from SOPAS</li>
</ul>
<p>In both options at least one SICK Lector needs to be configured using SOPAS. When configuration has been done, it can be stored to a file in different formats; to be used by SOPAS for later use or in another format to be used by Navitrol.</p>
<p>The following shows how to connect to the device using SOPAS and settings needed for the device to communicate with Navitrol in expected manner.</p>
<h3 id="connect-to-sick-lector-6xxx-with-sopas"><a class="header" href="#connect-to-sick-lector-6xxx-with-sopas">Connect to SICK Lector 6xxx with SOPAS</a></h3>
<p>Connection starts by searching the devices. First click A. &quot;Search devices&quot;. Connected device(s) should then appear in the list B. Each Lector has two optional connections (ports 2111/2112).</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image1_search_device.png" alt="" /></p>
<p>Double click the second connection in the list and you should see the device on the left side pane.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image2_connect_device.png" alt="" /></p>
<p>Double click the &quot;icon&quot; of the device on the left side pane and select Advanced user interface.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image3_select_ui.png" alt="" /></p>
<p>Finally you should be connected to the device and tree like settings selections are visible on the left side pane.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image4_parameter_tree.png" alt="" /></p>
<h3 id="reset-read-write-sick-lector-6xxx-configuration-with-sopas"><a class="header" href="#reset-read-write-sick-lector-6xxx-configuration-with-sopas">Reset, read, write SICK Lector 6xxx configuration with Sopas</a></h3>
<p>First decision point is whether one would like to do configuration by</p>
<ul>
<li>Starting with factory defaults      OR</li>
<li>Further modifying existing settings</li>
</ul>
<p>New device is in factory defaults when delivered. If one wishes to force device to factory defaults at any time, then select from menu: &quot;DeviceName&quot; - Parameter - Load factory defaults in device.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image5_factory_defaults.png" alt="" /></p>
<p>As noted by SOPAS, also communication parameters will go to factory defaults. IP address shall then be set to right value as shown below.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image6_ip_setting5.png" alt="" /></p>
<p>If one would like to modify existing configuration instead, then existing configuration can be read from device by clicking the icon with green up arrow.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image7_read_from_device.png" alt="" /></p>
<p>Then finally when configuration is done, it can be written to device by clicking the icon with red down arrow. And finally saved permanently by clicking memory chip icon.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image8_store_to_device.png" alt="" /></p>
<p>One can also save the project in SOPAS for later use (see SOPAS documentation) or export the settings as explained in later chapter.</p>
<h3 id="configure-sick-lector-6xxx-with-sopas"><a class="header" href="#configure-sick-lector-6xxx-with-sopas">Configure SICK Lector 6xxx with SOPAS</a></h3>
<p>Configuration for the device to communicate in expected manner with Navitrol is presented in figures below. Only those settings that are different from device default settings are shown. Primary objectives with these settings are immediate response when code (QR-code, bar code,..) is detected and continuous communication with reasonable interval for device monitoring purposes.</p>
<h4 id="object-trigger-control"><a class="header" href="#object-trigger-control">Object Trigger Control</a></h4>
<p>Read Gate shall be controlled by Navitrol using SOPAS commands. We also want immediate &quot;Good Read&quot; message sent out as in some features repetitive reading is necessary.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image9_cfg_trigger_control.png" alt="" /></p>
<h4 id="evaluation-conditions"><a class="header" href="#evaluation-conditions">Evaluation Conditions</a></h4>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image10_cfg_eval_cond.png" alt="" /></p>
<h4 id="output-control"><a class="header" href="#output-control">Output Control</a></h4>
<p>In most applications we want immediate response without any delays.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image11_cfg_output_control.png" alt="" /></p>
<h4 id="output-format"><a class="header" href="#output-format">Output Format</a></h4>
<p>It is vitally important to have right output format for &quot;Good Read&quot;. Failing to comply with this format will result in Navitrol trashing the message sent by the device.</p>
<p><strong>NOTE:</strong> Even though the format must be exactly as shown here, Navitrol SICK Lector interface does not require all data fields to be present. Message has to start with &quot;GoodRead;&quot; as shown here, but then minimum one out of the four data fields (ID, X, Y, Z) is required. Navitrol SICK Lector interface reports which fields have been read and it finally depends on the Navitrol feature used what data is truly needed. Even if the Navitrol feature in question would not need all data fields, there is no benefit really for defining different output message than that shown in figure.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image12_cfg_output_format.png" alt="" /></p>
<h4 id="ethernet"><a class="header" href="#ethernet">Ethernet</a></h4>
<p>Heartbeat message with interval of 1 sec is required by Navitrol for device monitoring purposes.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image13_cfg_ethernet.png" alt="" /></p>
<h3 id="configure-sick-lector-6xxx-by-navitrol"><a class="header" href="#configure-sick-lector-6xxx-by-navitrol">Configure SICK Lector 6xxx by Navitrol</a></h3>
<p>When one device has been fully configured with SOPAS, one can export the settings and corresponding configuration commands to a file as shown below.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image14_export_settings.png" alt="" /></p>
<p>This results in ASCII-file with all commands that are needed for device configuration by Navitrol.</p>
<p><img src="AgvInterfaces/OpticalCodeReader/./media-en/image15_exported_settings_file.png" alt="" /></p>
<p>In order for Navitrol to use this configuration file, it shall be stored to same folder as Navitrol executable and params.txt for example. Then the file name is defined in Navitrol parameters. After that Navitrol will use the file at startup and after any communication break to send all those commands to the device. This feature makes it also simple to replace SICK Lector with new one if needed, as Navitrol takes care of writing the same configuration to a new device. See chapter Navitrol configuration for further details for parameters involved.</p>
<p><strong>NOTE:</strong> First command in configuration file is for setting Access Mode required for configuration. Last HEX value is the HASH password for the device. If devices have different passwords, then this should be modified for each device separately.</p>
<h2 id="navitrol-configuration"><a class="header" href="#navitrol-configuration">Navitrol configuration</a></h2>
<p>The SICK Lector camera is regarded as an external localization sensor and therefore the following parameters shall be correctly set. Most of the parameters are array parameters; valid indexes being 0...3 and indexing should start with 0.</p>
<h3 id="parameters-for-basic-communication-and-configuration"><a class="header" href="#parameters-for-basic-communication-and-configuration">Parameters for basic communication and configuration</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,ext_loc_eth_model[],</strong></td><td>Model of ethernet external localization sensor: 0 = PGV camera, 1 = reserved, 2 = SICK Lector</td></tr>
<tr><td><strong>S,ext_loc_eth_ip[],</strong></td><td>IP address of the device</td></tr>
<tr><td><strong>I,ext_loc_eth_port[],</strong></td><td>Communication port of the device (with SICK Lector 2112 with defined configuration)</td></tr>
<tr><td><strong>S,ext_loc_config_file[],</strong></td><td>SICK Lector sensor configuration file name, if such exits (*)</td></tr>
<tr><td><strong>I,ext_loc_config_msg_interval_ms[],</strong></td><td>SICK Lector sensor configuration command transmit interval [ms]. Defaults to 100 ms.</td></tr>
</tbody></table>
<p>(* <strong>NOTE:</strong> Defining configuration file name means that configuration made by Navitrol is required. If defined file does not exist, Navitrol will report configuration failure and SICK Lector interface will not work.</p>
<h3 id="parameters-for-log-control"><a class="header" href="#parameters-for-log-control">Parameters for log control</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,log_ext_log,</strong></td><td>Log communication details, 0 - min level ... 3 - max amount of details.</td></tr>
</tbody></table>
<h3 id="parameters-for-mounting---feature--application-specific"><a class="header" href="#parameters-for-mounting---feature--application-specific">Parameters for mounting - feature &amp; application specific</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,ext_loc_x_offset[],</strong></td><td>SICK Lector longitudinal position offset from navigation point</td></tr>
<tr><td><strong>I,ext_loc_y_offset[],</strong></td><td>Camera transversal position offset from navigation point</td></tr>
<tr><td><strong>I,ext_loc_y_offset_deg[],</strong></td><td>Heading offset in degrees between machine coordinate system and camera coordinate system, heading angle of focal axis when vertical</td></tr>
<tr><td><strong>I,ext_loc_focal_orientation_deg[],</strong></td><td>Orientation of camera coordinates around focal axis when  the axis is horizontal. The rotation angle should be such that reported detection X is to the left and Y up when seen behind the camera to the markers</td></tr>
</tbody></table>
<p><em><strong>NOTE: For these parameters see further details in in feature specific documentation</strong></em></p>
<h2 id="warnings"><a class="header" href="#warnings">WARNINGS</a></h2>
<p>Navitrol SICK Lector interface does not raise any ERROR, but it can raise WARNINGS.</p>
<table><thead><tr><th>Warning</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>WARNING_CODE_READER_NO_COMMS</strong></td><td>No communication to the device. This WARNING should not be set after startup.</td></tr>
<tr><td><strong>WARNING_CODE_READER_STATUS_NOT_OK</strong></td><td>Error reported by device itself or device configuration error. Configuration error can happen for example if defined configuration file does not exist or device password is not right in configuration file.</td></tr>
</tbody></table>
<p><strong>NOTE:</strong> SICK Lector startup time is quite long - around 1 minute. So it is normal to have some WARNING after startup for longer period than with most other sensors.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="encoders"><a class="header" href="#encoders">Encoders</a></h1>
<p>Updated 26.01.2024</p>
<ul>
<li><a href="AgvInterfaces/Encoders/./EthercatEncoders/EthercatEncoders-en.html">EtherCAT encoders</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ethercat-encoders-1"><a class="header" href="#ethercat-encoders-1">Ethercat Encoders</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-14"><a class="header" href="#overview-14">Overview</a></h2>
<h3 id="introduction-18"><a class="header" href="#introduction-18">Introduction</a></h3>
<p>Absolute encoders are devices that provide position information of the moving shafts (e.g. steering axle or driving axle). </p>
<p>In Navitrol, EtherCAT encoders can be used:</p>
<ul>
<li>As feedback for the steering angle in steer AGV</li>
<li>As feedback for the steering angle in omni AGV</li>
</ul>
<h3 id="requirements-9"><a class="header" href="#requirements-9">Requirements</a></h3>
<p>Prior to the integration, all devices should be connected to the bus and powered. For additional information, consult <a href="AgvInterfaces/Encoders/EthercatEncoders/../../GenericInterfaces/EthercatCommunication/EthercatCommunication-en.html">Ethercat communication document</a>. It is expected that user has basic EtherCAT knowledge.</p>
<p>Before setting the parameters, the user must find a datasheet for the particular encoder. This datasheet should contain information about:</p>
<ul>
<li>Pulses per revolution (also can be named as counts per revolution, ppr) - number of pulses/counts in one revolution.</li>
<li>Pulses overflow (also can be named as resolution) - maximum value of pulses/counts that encoder can have before overflow.</li>
</ul>
<h3 id="limitations-7"><a class="header" href="#limitations-7">Limitations</a></h3>
<ul>
<li><strong>At the moment, EtherCAT encoders as a steering encoder must be used for any steer or omni AGV that have Ethercat as control interface.</strong></li>
<li>At the moment, EtherCAT encoders can be used only with machines that use EtherCAT as control interface (for the motor controllers).</li>
<li>Currently, EtherCAT encoders cannot be used as actuator encoder.</li>
<li>Currently, EtherCAT encoders cannot be used as drive/distance encoder.</li>
<li>Navitrol supports a limited number of encoder models. The list of tested and approved encoders can be found in <a href="AgvInterfaces/Encoders/EthercatEncoders/../../SupportedDevices/SupportedDevices-en.html">Supported device list</a></li>
</ul>
<h3 id="dependencies-5"><a class="header" href="#dependencies-5">Dependencies</a></h3>
<p>Basic EtherCAT parameters should be defined prior to the integration.</p>
<hr />
<h2 id="setup-12"><a class="header" href="#setup-12">Setup</a></h2>
<h3 id="quick-start-3"><a class="header" href="#quick-start-3">Quick start</a></h3>
<p>For the correct operation, initial parameters should be set. </p>
<ol>
<li>Set the basic EtherCAT parameters as described in <a href="AgvInterfaces/Encoders/EthercatEncoders/../../GenericInterfaces/EthercatCommunication/EthercatCommunication-en.html">Ethercat communication document</a>.</li>
<li>Set the communication parameter(s) that define position in the EtherCAT bus depending on the encoder function (steering/driving/actuating) and kinematics according to the table below.</li>
</ol>
<p><strong>Communication parameters for steering encoder in steer AGV</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ethercat_enc_steer_addr</td><td>Int</td><td>0</td><td>Physical EtherCAT address for steering absolute encoder in steer drive. 0 - disabled</td></tr>
</tbody></table>
<p><strong>Communication parameters for steering encoder in omni AGV</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ethercat_enc_omni_addr_arr[]</td><td>Int</td><td>0</td><td>Physical EtherCAT address for steering absolute encoder in omni drive. 0 - disabled </br> Array index - omni wheel number</td></tr>
</tbody></table>
<ol start="3">
<li>Set device specific parameters depending on the encoder function (steering/driving/actuating) and kinematics according to the table below. Most of the values can be found in the encoder's datasheet. </li>
</ol>
<p><strong>Device specific parameters for steering encoder in steer AGV</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ethercat_enc_steer_model</td><td>Int</td><td>1</td><td>Ethercat encoder model in steer drive, 1 = Generic (Sick AFS/AFM60)</td></tr>
<tr><td>steer_enc_pulses_overflow</td><td>Uint</td><td>268435455</td><td>Maximum value of pulses/counts that encoder can have before overflow</td></tr>
<tr><td>steer_enc_pulses_per_rev</td><td>Int</td><td>10000</td><td>Number of pulses/counts in one revolution</td></tr>
<tr><td>steer_enc_zero</td><td>Int</td><td>0</td><td>Number of pulses/counts corresponding to the zero steering angle </br> Has to be found very precisely for good driving </br> Can be left zero during the first launch</td></tr>
</tbody></table>
<p><strong>Device specific parameters for steering encoder in omni AGV</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ethercat_enc_omni_model_arr[]</td><td>Int</td><td>1</td><td>Ethercat encoder model in steer drive </br> 1 = Generic (Sick AFS/AFM60) </br> Array index - omni wheel number</td></tr>
<tr><td>omni_steer_enc_pulses_overflow_arr[]</td><td>Uint</td><td>268435455</td><td>Maximum value of pulses/counts that encoder can have before overflow </br> Array index - omni wheel number</td></tr>
<tr><td>omni_steer_enc_pulses_per_rev_arr[]</td><td>Uint</td><td>10000</td><td>Number of pulses/counts in one revolution </br> Array index - omni wheel number</td></tr>
<tr><td>omni_steer_enc_zero_arr[]</td><td>Uint</td><td>0</td><td>Number of pulses/counts corresponding to the zero steering angle </br> Has to be found very precisely for good driving </br> Can be left zero during the first launch </br> Array index - omni wheel number</td></tr>
</tbody></table>
<ol start="4">
<li>
<p>Calibrate the encoder zero manually. The procedure is included in the <a href="AgvInterfaces/Encoders/EthercatEncoders/../../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Calibration guide</a>. This step is needed for the steering encoder only.</p>
<p>The only parameter that must be tuned manually is encoder zero since it is the only parameter dependent on the mounting. The calibration process consists of the following consecutive steps:</p>
<ul>
<li>Kill Navitrol from Linux terminal or using SSH connection (e.g. Putty)</li>
<li>Physically set the steer wheel as straight as possible. </li>
<li>Start Navitrol</li>
<li>Read raw encoder pulses with command from Linux terminal or Putty: <em>./Navitrol dumpl 0 &quot;EthercatAbsEnc_TryParseRxMsg&quot;</em>.</li>
<li>Put the value to a corresponding encoder zero parameter.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="how-to-use-6"><a class="header" href="#how-to-use-6">How to use</a></h2>
<p>For steering encoders, after successful setup it is possible to see changes of the steering angle in Navitrol Monitor as shown on the figure below:</p>
<p><img src="AgvInterfaces/Encoders/EthercatEncoders/./media-en/omni_steering.png" alt="" /></p>
<blockquote>
<p>Omni AGV. Inside the frame, the position of the wheels is shown and steering angles are displayed. Wheel 0 has steering angle of -16.98 deg, wheel 1 is turned  16.98 deg and wheel 2 is positioned straight.</p>
</blockquote>
<hr />
<h2 id="troubleshooting-18"><a class="header" href="#troubleshooting-18">Troubleshooting</a></h2>
<h3 id="most-common-issues-3"><a class="header" href="#most-common-issues-3">Most common issues</a></h3>
<h4 id="encoder-initialization-failed---error_encoder_config-visible"><a class="header" href="#encoder-initialization-failed---error_encoder_config-visible">Encoder initialization failed - ERROR_ENCODER_CONFIG visible</a></h4>
<p>At the beginning of the operation, Navitrol reads in the encoder configuration. If there are any issues with the encoder initialization, Navitrol shows the above-mentioned error.</p>
<p>The most common reasons behind the error are invalid communication parameters - such as <strong>ethercat_enc_steer_addr</strong> or <strong>ethercat_enc_omni_addr</strong> set incorrectly, e.g. to 0.</p>
<p>It is recommended to double-check parameters for the encoder. Additionally, check the log or Linux terminal for more details.</p>
<h3 id="errors-and-warnings-7"><a class="header" href="#errors-and-warnings-7">Errors and warnings</a></h3>
<h4 id="848-error_encoder_config"><a class="header" href="#848-error_encoder_config">848 ERROR_ENCODER_CONFIG</a></h4>
<p>Description: Invalid encoder configuration. Check encoder parameters</p>
<p>Error level: Error</p>
<p>Error reason: Some of the encoder parameter is not valid.</p>
<p>How to recover: Check the log or terminal for more details. Check Navitrol parameters. Contact Navitec support.</p>
<h3 id="advanced-troubleshooting-5"><a class="header" href="#advanced-troubleshooting-5">Advanced troubleshooting</a></h3>
<p>Keywords for analyzing logs:</p>
<ul>
<li>AbsEnc - keyword to find all information related to the absolute encoders,</li>
<li>EthercatAbsEnc_TryParseRx - keyword for checking raw data coming from the ethercat encoder. Present in the logs only after encoder communication is successfully established</li>
<li>AbsEnc_CopyDataIn - keyword to find additional information on matching encoder raw data to machine data (e.g. additional information on assigning steering angle of omni wheel 0)</li>
<li>EthercatAbsEnc_HandleFaults - keyword on checking if any encoder internal error or warning is set</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="navitrol-monitor---user-instructions"><a class="header" href="#navitrol-monitor---user-instructions">Navitrol Monitor - User Instructions</a></h1>
<p>Updated 13.09.2024</p>
<hr />
<h2 id="introduction-19"><a class="header" href="#introduction-19">Introduction</a></h2>
<p>Navitrol Monitor is a Windows application that aims to work as a service and/or control tool for the AGV onboard software Navitrol. It provides useful real-time information about localization, positioning and system status etc. while also giving the user the possibility to directly control the AGV provided that Navitrol is not running in position-only-mode. In addition to this, Navitrol Monitor does also act as the primary log analysing tool and features a playback mode to read in the binary logs generated by Navitrol.</p>
<h2 id="system-requirements"><a class="header" href="#system-requirements">System Requirements</a></h2>
<p>Navitrol Monitors ability to visualize the information sent by Navitrol in real time sets requirements on both software and hardware:</p>
<p><strong>Minimum hardware requirements</strong></p>
<ul>
<li>
<p>Screen resolution: 1920x1080</p>
</li>
<li>
<p>CPU: 4 logical cores, 2.4 GHz</p>
</li>
<li>
<p>RAM: 8 GB</p>
</li>
<li>
<p>GPU: OpenGL 2.0 support</p>
</li>
<li>
<p>Storage: 120 GB</p>
</li>
</ul>
<p><strong>Recommended hardware requirements</strong></p>
<ul>
<li>
<p>Screen resolution: 1920x1080</p>
</li>
<li>
<p>CPU: 4 logical cores, 3.0 GHz</p>
</li>
<li>
<p>RAM: 16 GB</p>
</li>
<li>
<p>GPU: OpenGL 2.0 support</p>
</li>
<li>
<p>Storage: 120 GB</p>
</li>
</ul>
<p><strong>Software requirements</strong></p>
<ul>
<li>
<p>Operating system: Windows 7, Windows 10 or Windows 11</p>
</li>
<li>
<p>Net Library 4.7.1 installed</p>
<ul>
<li><a href="https://www.microsoft.com/net/download/framework">https://www.microsoft.com/net/download/framework</a></li>
</ul>
</li>
<li>
<p>C++ Redistributable package 2017 X86 version</p>
<ul>
<li>
<p><a href="https://visualstudio.microsoft.com/downloads/">https://visualstudio.microsoft.com/downloads/</a></p>
</li>
<li>
<p><a href="https://aka.ms/vs/15/release/VC_redist.x86.exe">https://aka.ms/vs/15/release/VC_redist.x86.exe</a></p>
</li>
</ul>
</li>
</ul>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<h3 id="folder-structure-and-password-configuration"><a class="header" href="#folder-structure-and-password-configuration">Folder Structure and Password Configuration</a></h3>
<p>The Navitrol Monitor executable <em>NavitrolMonitor.exe</em> is found under its root directory together with its configuration file <em>NavitrolMonitor.exe.config</em> and various dll files. On startup Navitrol Monitor will prompt for a password and by default this is set to <em>ntnavitec</em>.
Changing the password is done via the UI by pressing *Change...*and entering the new information. In order to disable the password check completely the user has the possibility to change to an empty password. Resetting the password requires the user to delete the <em>ConfigFiles</em> directory that is generated once the application has been started once.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image3.png" alt="" /></p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image4.png" alt="" /></p>
<h3 id="connecting-to-navitrol"><a class="header" href="#connecting-to-navitrol">Connecting to Navitrol</a></h3>
<p>Connecting to Navitrol requires that Navitrol and Navitrol Monitor are in the same network and that the firewall has been configured correctly.
The user is then able to add machines via the UI by clicking the <em>Edit</em> button from the main toolbar and setting the name and IP/port of the machine of interest.
These fields can later be modified.</p>
<p>To establish a connection, first select one of the configured machines from the drop-down list and click <em>Connect</em>. The connection status can then be seen at the bottom of the main window.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image5.png" alt="" /></p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image6.png" alt="" /></p>
<h2 id="user-interface"><a class="header" href="#user-interface">User Interface</a></h2>
<p>This section aims to give an instructional overview of the different options and functionality that Navitrol Monitor offers.</p>
<h3 id="navitrol-monitor-main-menu"><a class="header" href="#navitrol-monitor-main-menu">Navitrol Monitor Main Menu</a></h3>
<p>Under the main menu of Navitrol Monitor the user is able to find different file handling alternatives, visualization options, data illustrations etc. The different menus will be covered in detail in the following subsections.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image7.png" alt="" /></p>
<h3 id="file-menu"><a class="header" href="#file-menu">File menu</a></h3>
<p>Under the file menu the user has the possibility to perform general file related actions:</p>
<ul>
<li>
<p><em>Open Log</em> -- Used to open and load a binary log file for visual playback.</p>
</li>
<li>
<p><em>Save Log --</em> Used to save a binary log that does not contain any text log. Not recommended when sending logs to Navitec Systems for analysis as the text log is often needed.</p>
</li>
<li>
<p><em>Convert to Teach File --</em> Converts the binary log to a teach file that Navithor Tools can process.</p>
</li>
<li>
<p><em>Exit</em> -- Shuts down the application.</p>
</li>
</ul>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image8.png" alt="" /></p>
<h3 id="view-menu"><a class="header" href="#view-menu">View menu</a></h3>
<p>The view menu lets the user manipulate how things are visualized in the main frame of Navitrol Monitor but does also give access to more advanced features such as the <em>State Form</em>:</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/viewDropDown.png" alt="" /></p>
<h4 id="options"><a class="header" href="#options">Options:</a></h4>
<ul>
<li>
<p><em>Follow Vehicle</em> -- Allows the user to follow the vehicle while it is moving through the map.</p>
</li>
<li>
<p><em>Freeze Monitor Data</em> -- Stores a shade of the current vehicle position and scanner measurements in a lighter color than the real-time data. Useful when calibrating the odometry of the machine.</p>
</li>
<li>
<p><em>Show Graphs --</em> Show/hide the right-side graphs in the main window.</p>
</li>
<li>
<p><em>Show State Form --</em> Gives the user access to the Navitrol State Form where machine errors and the Navitrol console outputs are shown. Useful during debugging.</p>
</li>
</ul>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image10.png" alt="" /></p>
<ul>
<li><em>Visualization Options --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#visualization-options">Visualization Options</a> popup window</li>
<li><em>Draw Trajectory speeds --</em>  Enables a color gradient (from red to green, RGB color heatmap) visualization of the calculated trajectory speed. </li>
<li><em>Show Segment IDs --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#route-segment-ids">Visualizes segment IDs</a> and their directions when zoomed close to the route network</li>
</ul>
<h4 id="visualization-options"><a class="header" href="#visualization-options">Visualization Options</a></h4>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/visualizationOptions.png" alt="" /></p>
<ul>
<li>
<p><em>Zone Visualization --</em> Lets the user enable/disable different zone visualizations. Options are enabled if zones are added to the production in NavithorTools project</p>
</li>
<li>
<p><em>Front scanner --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#localization-scanners">Front scanner visualization</a></p>
</li>
<li>
<p><em>Rear scanner --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#localization-scanners">Rear scanner visualization</a></p>
</li>
<li>
<p><em>Measurement 0 scanner --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#measurement-scanners">Measurement 0 scanner visualization</a></p>
</li>
<li>
<p><em>Measurement 1 scanner --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#measurement-scanners">Measurement 1 scanner visualization</a></p>
</li>
<li>
<p><em>Large Points --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#large-scanner-points">Large scanner points visualization</a></p>
</li>
<li>
<p><em>RSSI Values --</em> <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#rssi-values">Received Signal Strength Indication visualization</a>. Helpful when identifying reflectors in the surroundings</p>
</li>
<li>
<p><em>Distance to environment --</em> Visualizes how close individual scanner points are to the environment points. See <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#scanner-point-distance-to-environment">Scanner point distance to environment visualization</a></p>
</li>
<li>
<p><em>Dynamic Map --</em> Lets the user toggle the <a href="CustomerUis/NavitrolMonitor/../../Localization/DynamicMapping/DynamicMappingServer/DynamicMappingServer-en.html">Dynamic mapping</a> scanner points in the main view.</p>
</li>
<li>
<p><em>External localization --</em> Lets the user toggle <a href="CustomerUis/NavitrolMonitor/../../Localization/ExternalLocalization/ExternalLocalization-en.html">External localization</a> and <a href="CustomerUis/NavitrolMonitor/../../PositionControl/DataMatrixDocking/DataMatrixDockingDMC-en.html">DMC Docking V2</a> visualization</p>
</li>
<li>
<p><em>Custom properties --</em> Lets the user toggle Custom properties visualization. See Navithor Tools documentation for further info on Custom properties</p>
</li>
<li>
<p><em>PLC warnings --</em> Lets the user toggle PLC warnings visualization</p>
</li>
<li>
<p><em>Position control triggers --</em> Lets the user toggle the position control triggers being displayed in the top left corner of the main window. Gives the user information about what causes for example soft stops/hard stops on the position control level. Only available when Navitrol controls the driving.</p>
</li>
</ul>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image12.png" alt="" /></p>
<h3 id="charts-menu"><a class="header" href="#charts-menu">Charts menu</a></h3>
<p>The charts menu gives access to informative charts that visualize the raw data collected by Navitrol in a more user-friendly way. From here the user has the possibility to retrieve information about odometry measurements, speed and angle reference values, scanner corrections etc.
Most of these charts are machine type specific as it is based on the underlying kinematic. Therefore, not all charts will display any information for the connected machine.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/monitorCharts.PNG" alt="" /></p>
<p>Charts:</p>
<ul>
<li>
<p><em>Steer Drive Motors --</em> Contains information about the steering PID control and the driving PD control as well as measured steering angle/drive speed and the corresponding reference values set by Navitrol.</p>
</li>
<li>
<p><em>Differential Drive Motors</em> -- Contains information about the drive motor PD control for each differential wheel as well as measured speed vs. reference speed.</p>
</li>
<li>
<p><em>Mecanum Drive Motors PD Control</em> -- Contains information about the drive motor PD control for each mecanum wheel.</p>
</li>
<li>
<p><em>Mecanum Drive Motors Speed Control --</em> Contains information about the measured speed vs. reference speed for each mecanum wheel.</p>
</li>
<li>
<p><em>Position Control --</em> Shows the predicted and measured curvature.</p>
</li>
<li>
<p><em>Speed Control --</em> Shows the speed reference from different sources as well as the final speed reference vs. measured value.</p>
</li>
<li>
<p><em>Navigation Point Velocity Vector --</em> Shows navigation point lateral, longitudinal and angular speed references and measurements.</p>
</li>
<li>
<p><em>Omni Steer Wheels Control --</em> Contains information about each steer wheels reference angle vs. measured angle.</p>
</li>
<li>
<p><em>Omni Steer Motors PID Control --</em> Contains information about each steer motors PID control.</p>
</li>
<li>
<p><em>Omni Drive Wheels Control --</em> Contains information about each wheels reference speed vs. measured speed.</p>
</li>
<li>
<p><em>Omni Drive Motors PD Control --</em> Contains information about each drive motors PD control.</p>
</li>
<li>
<p><em>Odometry Correction --</em> Contains information about the individual scanner corrections that are applied to the odometry as well correction averages over time and odometry auto correction. Also contains information about the scanner delay relative to the odometry.</p>
</li>
<li>
<p><em>Positioning --</em> Contains information about position confidence as well as the cycle times for each localization scanner, odometry etc.</p>
</li>
</ul>
<h3 id="navitrol-menu"><a class="header" href="#navitrol-menu">Navitrol menu</a></h3>
<p>The Navitrol menu gives access to certain control commands that can be sent to Navitrol but also feature specific forms that provide more detailed information and control options for certain applications.</p>
<!-- TO DO: Update the picture with SLAM options once the feature is officially published -->
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image16.png" alt="" /></p>
<p>Options:</p>
<ul>
<li>
<p><em>Reload Parameter file --</em> Commands Navitrol to reload its parameter
file <em>params.txt</em>.</p>
</li>
<li>
<p><em>Reload Environment and Route Data --</em> Commands Navitrol reload the environment and route data.</p>
</li>
<li>
<p><em>Keyboard Control --</em> Enables/disables the keyboard manual control. If enabled the user can control the vehicle using the arrow keys.</p>
</li>
<li>
<p><em>Start Teach --</em> Commands Navitrol to start the teaching process.</p>
</li>
<li>
<p><em>Stop Teach</em> -- Commands Navitrol to stop the teaching process.</p>
</li>
<li>
<p><em>Store Position to Teach File --</em> Saves the current vehicle position to the teach file which can later be used to define data matrix lines (QR-code).</p>
</li>
<li>
<p><em>Start SLAM</em> -- Commands ROS to start building a map from the environment as a background process.</p>
</li>
<li>
<p><em>Stop SLAM</em> -- Commands ROS to stop building a map from the environment as a background process.</p>
</li>
<li>
<p><em>Level Up --</em> Commands Navitrol to change to the level above. Related to productions where several floors/levels are used.</p>
</li>
<li>
<p><em>Level Down --</em> Commands Navitrol to change to the level below. Related to production where several floors/levels are used.</p>
</li>
<li>
<p><em>Data Matrix Docking V2 --</em> Gives access to the Data Matrix Docking v2 Form where information related <a href="CustomerUis/NavitrolMonitor/../../PositionControl/DataMatrixDocking/DataMatrixDockingDMC-en.html#logic-and-error-detection">DMC Docking V2</a> is displayed</p>
</li>
<li>
<p><em>Motor Controller Form --</em> Gives access to the <a href="CustomerUis/NavitrolMonitor/../../AgvInterfaces/MotorControllers/MotorControllersCommon/MotorControllersCommon-en.html#motor-controller-test-form">Motor Controller Form</a> where each motor controller's output can be tested</p>
</li>
<li>
<p><em>Pallet Detection Form --</em> Gives access to the Pallet Detection Form where information related to pallet detection and docking is displayed. From here it is also possible to make modifications to related parameters.</p>
</li>
</ul>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image17.png" alt="" /></p>
<ul>
<li>
<p><em>Generate Partial Views from CAD Form - 3D sensor --</em> Form to generate partial views for <a href="CustomerUis/NavitrolMonitor/../../TargetAndObstacleDetection/3dTargetDetection/3dTargetDetection-en.html">3D Object detection</a></p>
</li>
<li>
<p><em>Battery Manager Overview --</em> Gives access to the Batter Manager Overview where battery related information such as percentage, voltage and error status is displayed.</p>
</li>
</ul>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image18.png" alt="" /></p>
<h4 id="language-menu"><a class="header" href="#language-menu">Language menu</a></h4>
<p>Navitrol Monitor can be configured to use another language than English which is the default. Currently there is support for English and German, but this will be extended in the future.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image19.png" alt="" /></p>
<h4 id="more-menu"><a class="header" href="#more-menu">More menu</a></h4>
<p>Under <em>More</em> there are miscellaneous options that do not fall under the other categories. Currently the user has the possibility to dump scan data from the selected time span to a .txt-file</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image20.png" alt="" /></p>
<h3 id="navitrol-monitor-action-bar"><a class="header" href="#navitrol-monitor-action-bar">Navitrol Monitor Action Bar</a></h3>
<p>The Navitrol Monitor action bar is found over the main map view. It contains some of the most commonly used actions such as position initialization and saving logs as well as useful tools such as the measurement tape. In addition to this it is also possible to give manual drive orders via the <em>Drive Orders</em> form or the <em>Custom Route</em> form.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/ActionBar.PNG" alt="" /></p>
<h4 id="save-logs"><a class="header" href="#save-logs">Save Logs</a></h4>
<p>If there at some point would be a Navitrol related issue that requires further analysis it is important to make sure that there is as much information as possible available. Navitrol implements its own logging logic which contains both .txt-logs and binary playback logs which are stored on the IPC where Navitrol is running (see <a href="CustomerUis/NavitrolMonitor/../../Miscellaneous/Logging/Logging-en.html">Logging</a> for more information).</p>
<p>Navitrol Monitor lets the user both take and manage these logs via the <em>Save and download logs</em> form. A log is saved by pressing <em>Save log</em> button.<br />
Press <em>Advanced</em> to view the advanced logging options which are explained in the <a href="CustomerUis/NavitrolMonitor/../../Miscellaneous/Logging/Logging-en.html">Logging</a> document.</p>
<p>After a log has been saved it is possible to download it to the PC running Navitrol Monitor by selecting
the file from the <em>Download Log Files</em> view and clicking <em>Download</em> button.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/SaveAndDownloadLogs.PNG" alt="" /></p>
<h4 id="set-pos"><a class="header" href="#set-pos">Set Pos</a></h4>
<p>Navitrol does not have access to its position in a global reference system in most cases. Therefore, it is always necessary to initialize the position of the AGV when it has been moved without Navitrol's knowledge or when the position is lost due to any other reason. This can be done via Navitrol Monitor by first pressing <em>Set Pos</em> and right-click and hold on the approximate location of the AGV and then orient the mouse to select the heading before releasing the right-click button.</p>
<p>Heading adjustment is only active when mouse is placed to point outside of the heading dead-zone (green circle around the AGV).
When mouse click-button is released, the position initialization message is sent to Navitrol.</p>
<p>Additionally, in multilevel production areas, we can use <a href="CustomerUis/NavitrolMonitor/NavitrolMonitor-en.html#level-selector">level selector</a> to specify the current level of the AGV.</p>
<p>Navitrol will the use its localization algorithm to find the exact position more reliably.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/SetPos_multilevel.png" alt="" /></p>
<h4 id="drive-orders"><a class="header" href="#drive-orders">Drive Orders</a></h4>
<p>It is possible to give manual drive orders along the route network via Navitrol monitor and this feature is accessed via the <em>Drive Orders</em> form. If Navitrol is operating in standalone mode this form gives the possibility to operate the AGV in a hold-release manner (note that this requires additional route and Navitrol configurations). Additionally, also for non-standalone Navitrol, it is possible to use the so-called <em>Production Simulator</em> from this form which allows the user to give manual drive orders along the route with several targets and the possibility to loop over the target list.</p>
<p>The simplest drive orders can be given directly by hovering the mouse over the route network and right-clicking at the wished target location.
The selected route will be highlighted in green. For more complex drive orders the user has the possibility to <em>Add new drive</em> and then <em>Add target</em>s along the route. If the <em>Loop</em> checkbox is ticked the list of targets will be repeated cyclically. When the drive is defined it can be started from the <em>Drive</em> button and stopped from the <em>Stop</em> button.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image24.png" alt="" /></p>
<h4 id="custom-route"><a class="header" href="#custom-route">Custom Route</a></h4>
<p>Sometimes there is a need to give manual drive commands that are not bound to the route network. This is possible to achieve using a so-called <em>Custom Route</em> where the user can select several nodes in the map by right-clicking that then Navitrol use to create a smooth trajectory. The target speed of this trajectory can be set from the same form.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image25.png" alt="" /></p>
<h4 id="measurement-tape"><a class="header" href="#measurement-tape">Measurement tape</a></h4>
<p>The measurement tape functionality lets the user measure distances in the map by left-clicking on the two points of interest.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image26.png" alt="" /></p>
<h4 id="protractor"><a class="header" href="#protractor">Protractor</a></h4>
<p>The protractor measures the angle between three points. The range is from 0 to 180 degrees. The first point determines the vertex.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/protractorTool.png" alt="" /></p>
<h3 id="return-to-route-1"><a class="header" href="#return-to-route-1">Return to route</a></h3>
<p>When the AGV is about to be driven autonomously after being manually driven it is often the case that Navitrol does not accept the current position since it is too far away from the route network or has the wrong heading. The <em>Return to route</em> tool in Navitrol Monitor sends a request to Navitrol and if the limitations are fulfilled Navitrol will plan a trajectory to a suitable point on the route. See <em>Return to route</em> specific documentation for more details.</p>
<h4 id="abort"><a class="header" href="#abort">Abort</a></h4>
<p>Aborts the current drive.</p>
<h2 id="visualizations"><a class="header" href="#visualizations">Visualizations</a></h2>
<h3 id="vehicle"><a class="header" href="#vehicle">Vehicle</a></h3>
<p>The wheels of the vehicle are visualized with arrows. The color of the arrow indicates the rotation direction. The wheels are rendered in blue if the measured speed of wheel indicates that the wheel is not rotating. Green color indicates that wheels are rotating forwards and red indicates that wheels are rotating backwards.</p>
<p>The numbers next to the wheels (A0, A1 and A2, see pictures below) presents the wheel angle relative to the AGV frame.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/omnistandstill.png" alt="" /></p>
<blockquote>
<p>Vehicle wheels are not moving</p>
</blockquote>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/omniforward.png" alt="" /></p>
<blockquote>
<p>Vehicle wheels rotating forward</p>
</blockquote>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/omnibackwards.png" alt="" /></p>
<blockquote>
<p>Vehicle wheels rotating backward</p>
</blockquote>
<h4 id="omnidirectional-omni-drive-agv-turning-radius"><a class="header" href="#omnidirectional-omni-drive-agv-turning-radius">Omnidirectional (Omni Drive) AGV turning radius</a></h4>
<p>The turning radius of omnidirectional AGV:s are visualized with a purple cross.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/turningRadius.png" alt="" /></p>
<blockquote>
<p>Omni AGV turning radius</p>
</blockquote>
<h3 id="scanners-2"><a class="header" href="#scanners-2">Scanners</a></h3>
<p>Scanners and measurement data are visualized in Monitor with different colors.</p>
<p>Scanner positions are visualized with circles and their measurement data are rendered with matching colors. In total NavitrolMonitor can show 4 different scanner's data: two localization scanners and two measurement scanners.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image27.jpeg" alt="" />
<img src="CustomerUis/NavitrolMonitor/./media-en/image28.png" alt="" /></p>
<h4 id="localization-scanners-1"><a class="header" href="#localization-scanners-1">Localization Scanners</a></h4>
<p>Front scanner data is shown in green and rear scanner data is displayed in red. Example pictures below represent two different AGV: one that is using only front scanner for localization and one that uses only rear scanner for localization.</p>
<p>Scanner points that are not used in localization, are marked with grey colour.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image29.png" alt="" /></p>
<h4 id="measurement-scanners"><a class="header" href="#measurement-scanners">Measurement Scanners</a></h4>
<p>Measurement scanners are additional scanners that can be used with localization scanners. These scanners are used additionally to purposes like obstacle avoidance and target detection. The visualization of these scanners is done accordingly: Measurement scanner with index 0 is visualized with orange and the scanner with index 1 with pink.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image30.jpeg" alt="" />
<img src="CustomerUis/NavitrolMonitor/./media-en/image31.jpeg" alt="" /></p>
<h4 id="rssi-values"><a class="header" href="#rssi-values">RSSI Values</a></h4>
<p>If the scanner provides RSSI (Received Signal Strength Indication) data to Navitrol this option enables a color gradient visualization of the scanner points based on their individual RSSI values. Based on this, the user can identify reflectors in the surroundings.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image11.PNG" alt="" /></p>
<h4 id="scanner-point-distance-to-environment"><a class="header" href="#scanner-point-distance-to-environment">Scanner point distance to environment</a></h4>
<p>Visualizes how close individual scanner points are to the environment points (color gradient from red to green, RGB color heatmap). Scanner point distance visualization is only applied to scanner points that are used for localization and are close enough to the environment points</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/distanceToEnvVisualization.png" alt="" /></p>
<h4 id="large-scanner-points"><a class="header" href="#large-scanner-points">Large scanner points</a></h4>
<p>Scanner points can be enlarged in the monitor rendering view.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image13.png" alt="" /></p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image14.png" alt="" /></p>
<h3 id="route-segment-ids"><a class="header" href="#route-segment-ids">Route Segment ID:s</a></h3>
<p>Segment ID visualization is an advanced tool to observe where segments start and end. In addition, it informs the driving directions of the segment lanes. Visualization is only active when user zooms close enough to the route network and &quot;Show Segment IDs&quot; is toggled on. Example of the visualization below:</p>
<table><thead><tr><th>Text Visualization</th><th>Description</th></tr></thead><tbody>
<tr><td>RightFw: 70</td><td>Segment ID 70 is the right side forward going lane</td></tr>
<tr><td>LeftBw: 69</td><td>Segment ID 69 is the left side backwards going lane</td></tr>
</tbody></table>
<p>Segment ID visualization helps to validate Navithor Tools segment splitting. In addition, the feature can be used to troubleshoot issues that are occurring with some specific segment ID:s.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/routeSegmentIDs.png" alt="" /></p>
<h2 id="binary-log-playback"><a class="header" href="#binary-log-playback">Binary Log Playback</a></h2>
<p>In addition to visualizing live data streamed by Navitrol, Navitrol Monitor is also able to replay historic data either after being disconnected or from a binary log file saved by Navitrol. Replaying a binary log file is done by dragging and dropping it on Navitrol Monitor's main window.</p>
<p>The available time range can be further restricted by the upper slider in the picture below while the lower slider lets the user select the time of interest.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/image32.png" alt="" /></p>
<h2 id="level-selector"><a class="header" href="#level-selector">Level selector</a></h2>
<p>In production areas with multiple levels, a level selector will appear at the bottom-right corner of the screen.
This selector allows us to switch between different levels of the production area.
The current level of the AGV is indicated by a green shade in the level selector.
If the current viewing level in Monitor is different from the AGV's level, then it is shown in cyan.
The level IDs corresponding to each level are written on the right side of the level selector.</p>
<p><img src="CustomerUis/NavitrolMonitor/./media-en/level_selector.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="navitrol-monitor---3rd-party-licenses"><a class="header" href="#navitrol-monitor---3rd-party-licenses">Navitrol Monitor - 3rd Party Licenses</a></h1>
<p>Updated 26.01.2024</p>
<h2 id="introduction-20"><a class="header" href="#introduction-20">Introduction</a></h2>
<p>This document contains the License information for packages used in NavitrolMonitor</p>
<h2 id="licenses"><a class="header" href="#licenses">Licenses</a></h2>
<h3 id="apache-v2"><a class="header" href="#apache-v2">Apache v2</a></h3>
<h4 id="log4net"><a class="header" href="#log4net">log4net</a></h4>
<p>Library version 1.2.13<br />
Package is used for logging.</p>
<p>Copyright 2020 The Apache Software Foundation</p>
<p>Apache License<br />
Version 2.0, January 2004<br />
http://www.apache.org/licenses/</p>
<p>TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION</p>
<ol>
<li>
<p>Definitions.</p>
<p>&quot;License&quot; shall mean the terms and conditions for use, reproduction,
and distribution as defined by Sections 1 through 9 of this document.</p>
<p>&quot;Licensor&quot; shall mean the copyright owner or entity authorized by
the copyright owner that is granting the License.</p>
<p>&quot;Legal Entity&quot; shall mean the union of the acting entity and all
other entities that control, are controlled by, or are under common
control with that entity. For the purposes of this definition,
&quot;control&quot; means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such entity.</p>
<p>&quot;You&quot; (or &quot;Your&quot;) shall mean an individual or Legal Entity
exercising permissions granted by this License.</p>
<p>&quot;Source&quot; form shall mean the preferred form for making modifications,
including but not limited to software source code, documentation
source, and configuration files.</p>
<p>&quot;Object&quot; form shall mean any form resulting from mechanical
transformation or translation of a Source form, including but
not limited to compiled object code, generated documentation,
and conversions to other media types.</p>
<p>&quot;Work&quot; shall mean the work of authorship, whether in Source or
Object form, made available under the License, as indicated by a
copyright notice that is included in or attached to the work
(an example is provided in the Appendix below).</p>
<p>&quot;Derivative Works&quot; shall mean any work, whether in Source or Object
form, that is based on (or derived from) the Work and for which the
editorial revisions, annotations, elaborations, or other modifications
represent, as a whole, an original work of authorship. For the purposes
of this License, Derivative Works shall not include works that remain
separable from, or merely link (or bind by name) to the interfaces of,
the Work and Derivative Works thereof.</p>
<p>&quot;Contribution&quot; shall mean any work of authorship, including
the original version of the Work and any modifications or additions
to that Work or Derivative Works thereof, that is intentionally
submitted to Licensor for inclusion in the Work by the copyright owner
or by an individual or Legal Entity authorized to submit on behalf of
the copyright owner. For the purposes of this definition, &quot;submitted&quot;
means any form of electronic, verbal, or written communication sent
to the Licensor or its representatives, including but not limited to
communication on electronic mailing lists, source code control systems,
and issue tracking systems that are managed by, or on behalf of, the
Licensor for the purpose of discussing and improving the Work, but
excluding communication that is conspicuously marked or otherwise
designated in writing by the copyright owner as &quot;Not a Contribution.&quot;</p>
<p>&quot;Contributor&quot; shall mean Licensor and any individual or Legal Entity
on behalf of whom a Contribution has been received by Licensor and
subsequently incorporated within the Work.</p>
</li>
<li>
<p>Grant of Copyright License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
copyright license to reproduce, prepare Derivative Works of,
publicly display, publicly perform, sublicense, and distribute the
Work and such Derivative Works in Source or Object form.</p>
</li>
<li>
<p>Grant of Patent License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
(except as stated in this section) patent license to make, have made,
use, offer to sell, sell, import, and otherwise transfer the Work,
where such license applies only to those patent claims licensable
by such Contributor that are necessarily infringed by their
Contribution(s) alone or by combination of their Contribution(s)
with the Work to which such Contribution(s) was submitted. If You
institute patent litigation against any entity (including a
cross-claim or counterclaim in a lawsuit) alleging that the Work
or a Contribution incorporated within the Work constitutes direct
or contributory patent infringement, then any patent licenses
granted to You under this License for that Work shall terminate
as of the date such litigation is filed.</p>
</li>
<li>
<p>Redistribution. You may reproduce and distribute copies of the
Work or Derivative Works thereof in any medium, with or without
modifications, and in Source or Object form, provided that You
meet the following conditions:</p>
<p>(a) You must give any other recipients of the Work or Derivative Works a copy of this License; and</p>
<p>(b) You must cause any modified files to carry prominent notices stating that You changed the files; and</p>
<p>(c) You must retain, in the Source form of any Derivative Works that You distribute, all copyright, patent, trademark, and attribution notices from the Source form of the Work, excluding those notices that do not pertain to any part of the Derivative Works; and</p>
<p>(d) If the Work includes a &quot;NOTICE&quot; text file as part of its distribution, then any Derivative Works that You distribute must include a readable copy of the attribution notices contained within such NOTICE file, excluding those notices that do not pertain to any part of the Derivative Works, in at least one of the following places: within a NOTICE text file distributed as part of the Derivative Works; within the Source form or documentation, if provided along with the Derivative Works; or, within a display generated by the Derivative Works, if and wherever such third-party notices normally appear. The contents of the NOTICE file are for informational purposes only and do not modify the License. You may add Your own attribution notices within Derivative Works that You distribute, alongside or as an addendum to the NOTICE text from the Work, provided that such additional attribution notices cannot be construed as modifying the License.</p>
<p>You may add Your own copyright statement to Your modifications and
may provide additional or different license terms and conditions
for use, reproduction, or distribution of Your modifications, or
for any such Derivative Works as a whole, provided Your use,
reproduction, and distribution of the Work otherwise complies with
the conditions stated in this License.</p>
</li>
<li>
<p>Submission of Contributions. Unless You explicitly state otherwise,
any Contribution intentionally submitted for inclusion in the Work
by You to the Licensor shall be under the terms and conditions of
this License, without any additional terms or conditions.
Notwithstanding the above, nothing herein shall supersede or modify
the terms of any separate license agreement you may have executed
with Licensor regarding such Contributions.</p>
</li>
<li>
<p>Trademarks. This License does not grant permission to use the trade
names, trademarks, service marks, or product names of the Licensor,
except as required for reasonable and customary use in describing the
origin of the Work and reproducing the content of the NOTICE file.</p>
</li>
<li>
<p>Disclaimer of Warranty. Unless required by applicable law or
agreed to in writing, Licensor provides the Work (and each
Contributor provides its Contributions) on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied, including, without limitation, any warranties or conditions
of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
PARTICULAR PURPOSE. You are solely responsible for determining the
appropriateness of using or redistributing the Work and assume any
risks associated with Your exercise of permissions under this License.</p>
</li>
<li>
<p>Limitation of Liability. In no event and under no legal theory,
whether in tort (including negligence), contract, or otherwise,
unless required by applicable law (such as deliberate and grossly
negligent acts) or agreed to in writing, shall any Contributor be
liable to You for damages, including any direct, indirect, special,
incidental, or consequential damages of any character arising as a
result of this License or out of the use or inability to use the
Work (including but not limited to damages for loss of goodwill,
work stoppage, computer failure or malfunction, or any and all
other commercial damages or losses), even if such Contributor
has been advised of the possibility of such damages.</p>
</li>
<li>
<p>Accepting Warranty or Additional Liability. While redistributing
the Work or Derivative Works thereof, You may choose to offer,
and charge a fee for, acceptance of support, warranty, indemnity,
or other liability obligations and/or rights consistent with this
License. However, in accepting such obligations, You may act only
on Your own behalf and on Your sole responsibility, not on behalf
of any other Contributor, and only if You agree to indemnify,
defend, and hold each Contributor harmless for any liability
incurred by, or claims asserted against, such Contributor by reason
of your accepting any such warranty or additional liability.</p>
</li>
</ol>
<p>END OF TERMS AND CONDITIONS</p>
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you
may not use this file except in compliance with the License. You may
obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<h3 id="mit"><a class="header" href="#mit">MIT</a></h3>
<h4 id="opentk"><a class="header" href="#opentk">OpenTK</a></h4>
<p>Library version 1.1.0.0<br />
Package is used in graphics.</p>
<p>The Open Toolkit library license</p>
<p>Copyright (c) 2006 - 2013 Stefanos Apostolopoulos stapostol@gmail.com
for the Open Toolkit library.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE</p>
<p>Third parties</p>
<p>OpenTK.Platform.Windows and OpenTK.Platform.X11 include portions of the
Mono class library. These portions are covered by the following license:</p>
<p>Copyright (c) 2004 Novell, Inc</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<p>OpenTK.Compatibility includes portions of the Tao Framework library
(Tao.OpenGl, Tao.OpenAl and Tao.Platform.Windows.SimpleOpenGlControl).
These portions are covered by the following license:</p>
<p>Copyright ©2003-2007 Tao Framework Team <a href="http://www.taoframework.com">http://www.taoframework.com</a></p>
<p>All rights reserved.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<p>OpenTK.Half offers Half-to-Single and Single-to-Half conversions based
on OpenEXR source code, which is covered by the following license:</p>
<p>Copyright (c) 2002, Industrial Light &amp; Magic, a division of Lucas
Digital Ltd. LLC. All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:</p>
<ul>
<li>
<p>Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright
notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of Industrial Light &amp; Magic nor the names of its
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.</p>
</li>
</ul>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS
IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER
OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<p>SDL2-CS library in OpenTK.Platform.SDL2 is covered by the following
license:</p>
<p>/* SDL2# - C# Wrapper for SDL2 *</p>
<p>* Copyright (c) 2013 Ethan Lee. * * This software is provided
'as-is', without any express or implied warranty. * In no event will
the authors be held liable for any damages arising from * the use of
this software. * * Permission is granted to anyone to use this
software for any purpose, * including commercial applications, and to
alter it and redistribute it * freely, subject to the following
restrictions: * * 1. The origin of this software must not be
misrepresented; you must not * claim that you wrote the original
software. If you use this software in a * product, an acknowledgment in
the product documentation would be * appreciated but is not required.
* * 2. Altered source versions must be plainly marked as such, and
must not be * misrepresented as being the original software. * * 3.
This notice may not be removed or altered from any source distribution.
* *</p>
<p>Ethan &quot;flibitijibibo&quot; Lee <a href="mailto:CustomerUis/NavitrolMonitor3rdPartyLicenses/flibitijibibo@flibitijibibo.com">flibitijibibo@flibitijibibo.com</a></p>
<h4 id="opentkglcontrol"><a class="header" href="#opentkglcontrol">OpenTK.GLControl</a></h4>
<p>Library version 1.1.0.0<br />
Package is used for graphics.
The Open Toolkit Library License</p>
<p>Copyright (c) 2006 - 2009 the Open Toolkit library, except where noted.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE</p>
<h4 id="sshnet"><a class="header" href="#sshnet">SSH.NET</a></h4>
<p>Library version 2016.0.0<br />
Package is used for secure communication.</p>
<p>The MIT License (MIT)</p>
<p>Copyright (c) Renci, Oleg Kapeljushnik, Gert Driesen and contributors</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<h2 id="other"><a class="header" href="#other">Other</a></h2>
<h3 id="tar-cs"><a class="header" href="#tar-cs">tar-cs</a></h3>
<p>Library version 1.0<br />
Package is used for compressing/uncompressing data</p>
<p>BSD License</p>
<p>Copyright (c) 2009, Vladimir Vasiltsov All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:</p>
<ul>
<li>
<p>Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright
notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Names of its contributors may not be used to endorse or promote
products derived from this software without specific prior written
permission.</p>
</li>
</ul>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS
IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER
OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<h3 id="easyzlib"><a class="header" href="#easyzlib">Easyzlib</a></h3>
<p>Library version 1.0<br />
Package is used for compressing/uncompressing data</p>
<p>License easyzlib specific</p>
<p>Copyright (C) 2008 First Objective Software, Inc. All rights reserved
This entire notice must be retained in this source code. Redistributing
this source code requires written permission This software is provided
&quot;as is&quot;, with no warranty. Latest fixes enhancements and documentation
at <a href="http://www.firstobject.com">www.firstobject.com</a></p>
<p>Copyright (C) 1995-2005 Jean-loup Gailly and Mark Adler</p>
<p>Permission is granted to anyone to use this software for any purpose,
including commercial applications, and to alter it and redistribute it
freely, subject to the following restrictions:</p>
<ul>
<li>
<p>The origin of this software must not be misrepresented; you must
notclaim that you wrote the original software. If you use this
softwarein a product, an acknowledgment in the product documentation
would beappreciated but is not required.</p>
</li>
<li>
<p>Altered source versions must be plainly marked as such, and must not
be misrepresented as being the original software.</p>
</li>
<li>
<p>This notice may not be removed or altered from any source
distribution.</p>
</li>
</ul>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="webinterface"><a class="header" href="#webinterface">WebInterface</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="general-2"><a class="header" href="#general-2">General</a></h2>
<p>The Navitrol WebInterface is a web-based user interface that allows for manually driving and controlling the AGV. This is meant to facilitate the integration process by making it easy for the user to create and store teach data, test some of the control sequences and quickly move the AGV if needed. The WebInterface can be accessed via a web browser from both desktop and mobile environments and is shipped as a part of the Navitrol installation package (.deb).</p>
<h2 id="setup-and-configuration"><a class="header" href="#setup-and-configuration">Setup and Configuration</a></h2>
<p>Before getting started with the WebInterface, it must first be configured correctly to make sure that the software versions are compatible and that the lighttpd server on the Navitrol IPC is running properly. If the IPC's Linux image has been configured by Navitec Systems, the necessary packages have already been installed and the lighttpd server configuration has been adapted to the requirements.
Additionally, if the Debian installation package (.deb) is used to install Navitrol it will also enforce that the software versions match and there is no additional configuration to be done. If the Linux image has not been provided by Navitec Systems, the reader is referred to our Support to get more information about the dependencies and configurations.</p>
<h2 id="getting-started-1"><a class="header" href="#getting-started-1">Getting Started</a></h2>
<p>Assuming that the setup and configuration has been done properly, the WebInterface UI and all its features can be accessed by following two simple steps:</p>
<ol>
<li>
<p>Make sure that Navitrol is running on the IPC</p>
</li>
<li>
<p>After verifying that the machine is in the same network, type the IP of it to the browser and connect</p>
</li>
</ol>
<p>At this point the main UI should be visible as seen in Figure (1) with the following information/options:</p>
<ol>
<li>
<p>AGV state. The AGV may be controlled manually only if it is in the Manual state.</p>
</li>
<li>
<p>Green light indicates that manual driving is possible, red light indicates that it is not</p>
</li>
<li>
<p>Velocity of the AGV</p>
</li>
<li>
<p>Indicates if the AGV is in teach mode and if it is on top of the route </p>
</li>
<li>
<p>Drive mode of the AGV</p>
</li>
<li>
<p>IP of the IPC</p>
</li>
<li>
<p>Main menu</p>
</li>
<li>
<p>Battery level of the AGV</p>
</li>
<li>
<p>Joystick to control the AGV</p>
</li>
</ol>
<p><img src="CustomerUis/WebInterface/./media-en/image2.png" alt="" /></p>
<blockquote>
<p>Figure 1: An overview of the WebInterface.</p>
</blockquote>
<p>Additional information/options can be accessed from behind the menu (7 in Figure 1) seen in Figure 2:</p>
<ol>
<li>
<p>Web interface and Navitrol version and possibility to change the language of the UI.</p>
</li>
<li>
<p>If multiple clients are using the same vehicle, only one client may control it. This button allows the user to request the control</p>
</li>
<li>
<p>Toggle manual driving on/off</p>
</li>
<li>
<p>Limit the joystick to the main axes</p>
</li>
<li>
<p>Toggle teach mode on/off</p>
</li>
<li>
<p>Save the current position to the teach file to use with some of the Navithor Tools features</p>
</li>
<li>
<p>Select the steer type of the AGV (see section Steer Types)</p>
</li>
<li>
<p>Select the wheel rotation (only valid in parallel mode for omni kinematics)</p>
</li>
<li>
<p>Scale the speed reference output</p>
</li>
</ol>
<p><img src="CustomerUis/WebInterface/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 2: An overview of the WebInterface menu.</p>
</blockquote>
<h2 id="drive-control-2"><a class="header" href="#drive-control-2">Drive Control</a></h2>
<p>Manual control, contrary to automatic control, refers to controlling the vehicle without any pre-planning based on defined routes and/or other properties. It allows the user to give instructions to the AGV in real-time and there are currently two functionalities available in manual mode: driving and actuator control. Both require that manual mode is activated from the WebInterface UI.</p>
<h3 id="joystick-system"><a class="header" href="#joystick-system">Joystick System</a></h3>
<p>When the manual mode is activated, it is possible to control the AGV by moving the joystick to the desired direction. This allows for a stepless and easy way to control the driving direction and speed of the AGV. The joystick vector is defined in the coordinate system as seen in Figure 3, where <strong>a</strong> is the angle relative to the y-axis.</p>
<p><img src="CustomerUis/WebInterface/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 3: Joystick coordinate system where x,y ϵ [-1, 1].</p>
</blockquote>
<h3 id="steer-types"><a class="header" href="#steer-types">Steer Types</a></h3>
<p>The steer types are meant to facilitate the control by explicitly defining how the vehicle should react to the joystick input and thus give the user the possibility to select between different drive modes.
Which steer types that are available depends on the kinematic model of the vehicle and its driving properties, as it for example is not possible to do parallel driving with a vehicle based on a differential drive kinematic.</p>
<p>Each steer type handles the conversion from the joystick vector to a driving reference differently and this is explained further in the designated subsections.</p>
<h3 id="curvature-driving"><a class="header" href="#curvature-driving">Curvature Driving</a></h3>
<p>The driving references given to the position controller of the vehicle are in this case based on curvature and velocity while the frame heading in relation to the driven path is zero, see Figure 4.</p>
<p><img src="CustomerUis/WebInterface/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 4: Illustration of curvature driving.</p>
</blockquote>
<p>The magnitude of the velocity reference is scaled by the magnitude of the joystick vector ([0,1]) and the maximum possible speed reference is set by either  <strong>mot_ctrl_max_wheel_v_fw</strong> or <strong>mot_ctrl_max_wheel_bw</strong> depending on the drive direction. The curvature reference is calculated from the angle of the joystick in relation to its y-axis, increasing with the angle until its maximum value of 5 is reached at a joystick angle of +- 90 degrees.</p>
<p>Basic curvature driving is activated by the Mid steer type and is available for all kinematic types.
In this mode, the AGV will turn with respect to its nominal navigation point. Additionally, for vehicles based on the omni kinematic there is also a possibility to select either the Front or Rear steer types.
Front means that the x-coordinate of the navigation point (in machine coordinates) is moved to the wheel with the smallest x-coordinate while Rear means that it is moved to the wheel with the largest x-coordinate, effectively keeping the orientation of that wheel static in turns.</p>
<h4 id="pivoting-2"><a class="header" href="#pivoting-2">Pivoting</a></h4>
<p>Enabling Pivoting forces the AGV to keep its navigation point static while pivoting around it either clockwise or counterclockwise and is available for all kinematic types. However, if pivoting is not possible because of steering wheel limitations, the possibility to pivot is disabled in the UI.</p>
<p>The pivoting direction is determined by the sign of the x-coordinate of the joystick vector and the speed is scaled by its magnitude.
The maximum pivoting speed reference is defined by the Navitrol parameter <strong>pivot_speed</strong>.</p>
<h4 id="parallel-driving"><a class="header" href="#parallel-driving">Parallel Driving</a></h4>
<p>The Parallel mode forces the AGV to keep its frame heading constant while driving as illustrated by Figure 5.</p>
<p><img src="CustomerUis/WebInterface/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 5: Illustration of parallel driving.</p>
</blockquote>
<p>The driving direction is given by the joystick angle <strong>a</strong> and is calculated in relation to the vehicle frame. Like for the other steer types, the magnitude of the velocity reference is scaled by the magnitude of the joystick vector and depending on the rotation direction of the wheels (default forward) it is limited by either <strong>mot_ctrl_max_wheel_v_fw</strong> or <strong>mot_ctrl_max_wheel_bw</strong>.</p>
<p>Additionally, for the omni kinematic it is also possible to determine the wheel rotation direction. This feature can be especially useful when driving parallel into a docking station as it prevents the wheels from turning around which can cause the AGV frame to move and possibly collide with surrounding obstacles.</p>
<p>When driving in Parallel mode there might be situations where it is needed to prevent certain wheel angles. These limits are defined in the Navitrol parameters by <strong>omni_joystick_sector_limit_1_deg</strong> and <strong>omni_joystick_sector_limit_2_deg</strong> and the forbidden circle section is visualized in grey as seen in Figure 6. Furthermore, it is also possible to define a deadband for the speed reference with the Navitrol parameter <strong>omni_joystick_deadband ([0,1])</strong> and this is visualized as the small grey circle in Figure 6.</p>
<p><img src="CustomerUis/WebInterface/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 6: Steering sector limits and deadband visualization.</p>
</blockquote>
<h3 id="limit-axes"><a class="header" href="#limit-axes">Limit Axes</a></h3>
<p>In some situations, it might be practical to limit the control to only the main axes of the joystick as that allows for straight driving in a controlled manner. This feature can be enabled by toggling the Limit Axes switch and is visualized with a yellow cross indicating the possible joystick positions as seen in Figure 7.</p>
<p><img src="CustomerUis/WebInterface/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 7: Limiting the joystick control to the main axes.</p>
</blockquote>
<h3 id="speed-scale"><a class="header" href="#speed-scale">Speed Scale</a></h3>
<p>The output speed reference can be scaled between 10-100% of the maximum value for all the different steer types by adjusting the speed scale bar in the UI.</p>
<h3 id="actuator-control"><a class="header" href="#actuator-control">Actuator Control</a></h3>
<p>It is possible to use the WebInterface for manual actuator control when an actuator is configured. The actuator can either be controlled manually using the joystick or with the Load resource-button which either ascends or descends the actuator depending on the current load status of the vehicle. The actuator control functionality only supports reference value-controlled actuators (Navitrol parameter <strong>actuator_type</strong> is 2).</p>
<p>Using the manual actuator control requires the activation of manual mode after which the actuator specific controls will appear. The Control actuator-switch will limit the joystick to allow only up/down adjustment which is visualized by the in yellow high-lighted axis. The joystick is used to control the speed change of the actuator reference value where the maximum change rate is defined by the Navitrol parameter <strong>web_ctrl_actuator_max_speed_mm_per_s</strong> [mm/s].</p>
<p><img src="CustomerUis/WebInterface/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 8: Actuator control.</p>
</blockquote>
<h2 id="safety-features"><a class="header" href="#safety-features">Safety features</a></h2>
<p>Navitrol control via WebInterface has following safety related features:</p>
<ul>
<li>
<p><strong>Idle start</strong>: After (re)connecting to Navitrol all joystick data is required to be 0 for certain amount of time before manual control can be activated. That time is defined by parameter <strong>remote_ctrl_idle_start_ms</strong>. During this startup phase &quot;State&quot; and &quot;Manual possible&quot; on WebInterface are visualized with red color, indicating that manual control is disabled.</p>
</li>
<li>
<p><strong>Communication interval watchdog</strong>: WebInterface to Navitrol message intervals are continuously monitored. Control is disabled if limit defined by parameter <strong>remote_ctrl_watchdog_ms</strong> is exceeded.</p>
</li>
<li>
<p><strong>Mode change glitch filtering</strong>: Whenever enabling manual control from WebInterface, Navitrol requires number of consecutive manual mode messages prior to manual control activation (glitch filtering). Number of messages required is defined by parameter <strong>remote_ctrl_nbr_consecutive_manual_mode</strong>.</p>
</li>
</ul>
<h2 id="navitrol-parameters-10"><a class="header" href="#navitrol-parameters-10">Navitrol Parameters</a></h2>
<p>Parameters related to the WebInterface are:</p>
<ul>
<li>
<p><strong>I,remote_ctrl_watchdog_ms</strong>: The maximum time interval for received WebInterface data. Default value is 1000 ms.</p>
</li>
<li>
<p><strong>I,remote_ctrl_idle_start_ms</strong>: After (re)connection all joystick data is required to be 0 for this amount of time [ms] before manual control can be activated. Default value is 2000 ms.</p>
</li>
<li>
<p><strong>I,remote_ctrl_nbr_consecutive_manual_mode</strong>: Number of consecutive manual mode messages required for manual mode activation (glitch filtering). Default value is 3.</p>
</li>
<li>
<p><strong>F,omni_joystick_sector_limit_1_deg</strong> and <strong>F,omni_joystick_sector_limit_2_deg</strong>: Limit the steer sector in parallel driving. In the WebInterface the zero angle is directly up. Range is 0 -- 360 degrees and positive direction is counterclockwise. Limited sector is from limit1 to limit2 in positive direction. Default values are 0.</p>
</li>
<li>
<p><strong>F,omni_joystick_deadband</strong>: Visual deadband indicator for parallel driving. Does not affect sent values and deadband is handled at Navitrol side. Default value is 0.</p>
</li>
<li>
<p><strong>I,web_ctrl_actuator_max_speed_mm_per_s</strong>: Maximum change rate of the actuator when controlled with the WebInterface. Default value is 2500 mm/s.</p>
</li>
<li>
<p><strong>F,remote_ctrl_stop_ramp_dec</strong>: Deceleration rate to zero speed when joystick control is released.</p>
</li>
<li>
<p><strong>F,remote_ctrl_max_steer_rate_deg_p_s:</strong> Reference steering rate limit for Omni vehicles</p>
</li>
</ul>
<h2 id="troubleshooting-19"><a class="header" href="#troubleshooting-19">Troubleshooting</a></h2>
<p><strong>Problem #1:</strong> <em>When connecting to the IP, a blank white page shows up.</em></p>
<p>Possible solutions:</p>
<ul>
<li>
<p>Delete cookies and browsing history</p>
</li>
<li>
<p>Try another browser</p>
</li>
<li>
<p>Restart the IPC or Navitrol</p>
</li>
</ul>
<p>If none of the above helps, take a Navitrol log and send to Navitec Systems.</p>
<p><strong>Problem #2:</strong> <em>Updating Navitrol using the Debian installation package with WebInterface included does not update the user interface.</em></p>
<p>Possible solution:</p>
<p>Check the path set to &quot;server.document-root&quot; in /etc/lighttpd/lighttpd.conf. Find an index.html file in /var/www or from the subfolders of that path that has a creation date matching with the installation time. Make sure that &quot;server.document-root&quot; in /etc/lighttpd/lighttpd.conf is set to the path of index.html. If this is not the case, modify the configuration file accordingly. After that, restart the server by entering:</p>
<p>/etc/init.d/lighttpd restart</p>
<p>The status of the server can be checked by entering:</p>
<p>/etc/init.d/lighttpd status</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parameter-tool-ui-beta"><a class="header" href="#parameter-tool-ui-beta">Parameter Tool UI (BETA)</a></h1>
<p>Updated 20.06.2024</p>
<h2 id="overview-15"><a class="header" href="#overview-15">Overview</a></h2>
<h3 id="introduction-21"><a class="header" href="#introduction-21">Introduction</a></h3>
<p>Parameter tool is a user interface to change <a href="CustomerUis/Parameter%20Tool/../../Introduction/Parameters/Parameters.html">Navitrol parameters</a> (params.txt file). With this tool the user can:</p>
<ul>
<li>Open a Navitrol parameter file and change parameter values as needed</li>
<li>Load Navitrol parameter files offline and online</li>
<li>Observe parameters current, default, minimum and maximum value</li>
<li>Modify parameter values graphically and save the modified parameters to Navitrol directly (offline and online when Navitrol is running).</li>
<li>Observe parameter descriptions (by comment column or hovering on top of the parameter)</li>
</ul>
<p><img src="CustomerUis/Parameter%20Tool/./media/whereToOpenParamsTool.png" alt="" />
<img src="CustomerUis/Parameter%20Tool/./media/introduction_picture2.png" alt="" /></p>
<blockquote>
<p>Parameter Tool</p>
</blockquote>
<p><strong>Parameter Tool Beta version is available on Navitrol 6.54</strong></p>
<p>Please note that the Parameter Tool is still in beta-phase. The development for the Tool is ongoing and most of the limitations will only apply for the beta version. In addition to this, the beta version might have many unexpected defects that Navitec Systems have not found during initial testing.</p>
<h3 id="requirements-10"><a class="header" href="#requirements-10">Requirements</a></h3>
<p>NavitrolMonitor 6.54 includes the Parameter Tool Beta version. User should use the same Navitrol and Navitrolmonitor version when changing parameters with the Parameter Tool UI.
Using a higher version of NavitrolMonitor than Navitrol can lead to a situation of adding invalid parameters to existing Navitrol.</p>
<h3 id="limitations-8"><a class="header" href="#limitations-8">Limitations</a></h3>
<p>The Parameter tool modifies the params.txt file and changes parameter order and removes extra comment lines between parameters. The following things will occur when parameters are modified using the Parameter Tool:</p>
<ul>
<li>Parameter order will change in params.txt file</li>
<li>Extra comment lines on parameter files are removed.
<ul>
<li>Separate comment lines without any preceding parameter value are removed</li>
<li>The parameter comments (# after parameter value) will stay as user has written them.</li>
</ul>
</li>
<li>A parameter file needs to contain all required parameters for this machine type (machine_type_id)
<ul>
<li>A parameter file that contains a subset of parameters cannot be opened. For example:
<ul>
<li>Parameter zone files (params_zoneX.txt) or parameter override files (params_override.txt)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="dependencies-6"><a class="header" href="#dependencies-6">Dependencies</a></h3>
<ul>
<li><a href="CustomerUis/Parameter%20Tool/../../Introduction/Parameters/Parameters.html">Navitrol Parameters</a></li>
</ul>
<h2 id="quick-guide"><a class="header" href="#quick-guide">Quick Guide</a></h2>
<ul>
<li>Connect to an AGV with NavitrolMonitor</li>
<li>Open Parameter tool by clicking &quot;Edit Parameters&quot;</li>
<li>Parameters from Navitrol are automatically downloaded to Parameter Tool. If not, click File --&gt; Load Parameters</li>
<li>Modify parameters in Parameter tool UI. Click &quot;Upload To Navitrol&quot; after parameters changes</li>
<li>Wait until Navitrol parameters are saved and parameters automatically reloaded.</li>
</ul>
<h2 id="how-to-use-7"><a class="header" href="#how-to-use-7">How To use</a></h2>
<h3 id="load-parameters-to-parameter-tool"><a class="header" href="#load-parameters-to-parameter-tool">Load Parameters to Parameter Tool</a></h3>
<p>Navitrol parameter file can be loaded to Parameter tool when Navitrol is offline or online. The preferred way to use parameter tool is when Navitrol is running.</p>
<p>Parameter Tool will automatically take the same IP as user has defined in NavitrolMonitor.
When user clicks &quot;Edit parameters&quot;, Parameter Tool will open and parameters automatically uploaded from Navitrol. If parameters are not listed in Parameter Tool, user can click Load Parameters or change the IPC Communication settings.</p>
<p><img src="CustomerUis/Parameter%20Tool/./media/settingsView.png" alt="" /></p>
<blockquote>
<p>Parameters can be loaded from Navitrol or a local parameter file can be opened</p>
</blockquote>
<p>A parameter file can also be opened without the connection to Navitrol. This can be done by clicking <em>File --&gt; Open</em> and choosing the parameter file from your local drive. Please note that the parameter file format must follow <a href="CustomerUis/Parameter%20Tool/../../Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html#parameters">Navitrol parameters</a> formatting.</p>
<p>Parameter tool will list all loaded parameters. By default current, new, default, minimum and maximum values for each parameter is listed. These can be changed under <em>View</em> on the top navigation bar.
Loaded parameters that have different than default value are shown in light yellow (wheat) color.</p>
<p><img src="CustomerUis/Parameter%20Tool/./media/loaded_params.png" alt="" /></p>
<blockquote>
<p>Loaded params*.txt file on Parameter Tool</p>
</blockquote>
<h3 id="modify-parameters-and-upload-to-navitrol"><a class="header" href="#modify-parameters-and-upload-to-navitrol">Modify Parameters And Upload to Navitrol</a></h3>
<p>Parameters are modified by changing the value on <strong>New Value</strong> column. Always press enter to apply the new value. This triggers a validation step. User can search also different parameters by typing the parameter name on <strong>Search</strong> field.</p>
<p>After a parameter value has been changed, the parameter row will turn orange.
<img src="CustomerUis/Parameter%20Tool/./media/modified_parameter_one.png" alt="" /></p>
<blockquote>
<p>Parameter values that user has modified will change their color to orange</p>
</blockquote>
<p>User can change multiple parameters at once if needed. After all parameters have been modified, the modified parameters can be listed by checking modified only Filter.</p>
<p><img src="CustomerUis/Parameter%20Tool/./media/modified_only.png" alt="" /></p>
<blockquote>
<p>Modified parameters can be listed to check if modified values still need more adjusting</p>
</blockquote>
<p>After the parameters have been modified with desired values, save the parameters and upload to Navitrol.</p>
<p><img src="CustomerUis/Parameter%20Tool/./media/save_and_upload.png" alt="" /></p>
<blockquote>
<p>Save and Upload parameters after modifying them</p>
</blockquote>
<h3 id="adding-new-parameters-to-the-parameter-file"><a class="header" href="#adding-new-parameters-to-the-parameter-file">Adding new parameters to the parameter file</a></h3>
<p>By default the parameter tool shows only the parameters that already exist in the params.txt file. To add new parameters to the file click on the &quot;Show all available&quot; filter to see also the parameters that are not in the params.txt. You can then search for the parameters normally and add a new value to any parameter that does not already exist in the parameter file. Always press enter after modifying the new value column. This triggers a validation step. Saving the parameters will automatically add the parameters with new values to the parameter file. Currently the parameter tool does not cross check parameters like Navitrol does so by adding new parameters it is possible to cause parameter validation errors on Navitrol. In such cases refer to the troubleshooting section.</p>
<h3 id="removing-parameters-from-the-parameter-file"><a class="header" href="#removing-parameters-from-the-parameter-file">Removing parameters from the parameter file</a></h3>
<p>To remove a parameter from the parameter file, change the value of the parameter to an empty string. Parameter tool does not allow removing required parameters but again it's possible that removing parameters causes invalid parameter combinations. In such cases Navitrol will report ERROR_PARAM_PARSE after uploading and Navitrol does not anymore start after restarting the system. To recover please refer to the troubleshooting section.</p>
<h2 id="troubleshooting-20"><a class="header" href="#troubleshooting-20">Troubleshooting</a></h2>
<h3 id="wrong-parameters-were-changed-i-need-to-return-the-previous-ones"><a class="header" href="#wrong-parameters-were-changed-i-need-to-return-the-previous-ones">Wrong parameters were changed, I need to return the previous ones</a></h3>
<p>A backup of each downloaded parameter file is saved under NavitrolMonitor/ParamsTool.</p>
<p>A backup file is saved the following format: <em>params_Navitrol_yyyy_MM_dd-HHmmss.txt</em></p>
<h3 id="i-added-or-removed-a-parameter-and-navitrol-does-not-start-anymore"><a class="header" href="#i-added-or-removed-a-parameter-and-navitrol-does-not-start-anymore">I added or removed a parameter and Navitrol does not start anymore</a></h3>
<p>Most likely this is because Navitrol does not know the added parameter or a parameter cross check forbids using the new parameter value. To recover from a situation like this you can open the parameter tool in offline mode and remove the parameter you added. Another recovery option is to upload a backup parameter file to Navitrol. Backups locations is instructed above.</p>
<h3 id="parameters-are-not-loaded-to-parameter-tool"><a class="header" href="#parameters-are-not-loaded-to-parameter-tool">Parameters are not loaded to Parameter Tool</a></h3>
<p>If parameters are not seen in Parameter Tool, often the reason is that there is no connection to the IPC.</p>
<p><img src="CustomerUis/Parameter%20Tool/./media/failedToDownload.png" alt="" /></p>
<p>The following things should be validated:</p>
<ul>
<li>Is the IP address of the IPC valid</li>
<li>Is the Port valid</li>
<li>Are SSH Username and Password valid</li>
<li>Does the IPC have an existing params.txt file in path /home/navitec (Remote file path)</li>
</ul>
<p><img src="CustomerUis/Parameter%20Tool/./media/settingsView.png" alt="" /></p>
<h3 id="a-parameter-is-highlighted-with-red"><a class="header" href="#a-parameter-is-highlighted-with-red">A parameter is highlighted with red</a></h3>
<p>Parameters that are invalid for the machine type are highlighted with red. These parameters need to be manually removed from the params.txt file.</p>
<p><img src="CustomerUis/Parameter%20Tool/./media/invalid_param_for_machine_type.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="position-confidence-1"><a class="header" href="#position-confidence-1">Position confidence</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-16"><a class="header" href="#overview-16">Overview</a></h2>
<p>The estimated pose of the AGV has always some amount of uncertainty and the position confidence value describes how well the pose of the AGV is known. Position confidence is a value from 0-100% which is determined by several factors telling how accurately and uniquely the scanner measurements match to the mapped environment. The position confidence value can be used to stop the AGV when the uncertainty of the pose is too high to avoid the risk of driving outside of the planned path.</p>
<hr />
<h2 id="setup-13"><a class="header" href="#setup-13">Setup</a></h2>
<p>Position confidence value is dependent on the environment and used sensors, so it is good to check for each project that the outputs are reasonable. The confidence value can be adjusted with Navitrol parameters. The default parameters work well in most cases but sometimes they need to be adjusted. For example when there are only few natural features available for navigation or when the resolution of the scanner is low. In those cases the number of points that must match to the environment should be lowered. Listed below are some typical parameters which the user can adjust.</p>
<p><strong>Common position confidence parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pos_conf_limit</td><td>Float</td><td>25.0</td><td>Defines the minimum position confidence [%] for the machine to be able to operate. If the confidence drops below this value ERROR_POSITION_CONFIDENCE_LOW is set and the AGV stops</td></tr>
<tr><td>corr_conf_min_scale_npts</td><td>Int</td><td>50</td><td>Defines the lower threshold for the number of points that have to match to the environment. If this is not reached, the confidence will be zero.</td></tr>
<tr><td>corr_conf_max_scale_npts</td><td>Int</td><td>150</td><td>Defines the upper threshold for the number of points that are matching to the environment. The confidence factor is scaled linearly between corr_conf_min_scale_npts and this value from 0 to 100.</td></tr>
</tbody></table>
<p>The position confidence is filtered so that sudden short-term confidence drops wouldn't cause unnecessary stops of the drive. There is a gain value <strong>pos_conf_gain</strong> which determines how fast the reported confidence drops.</p>
<p>For the position initialization there is typically a higher position confidence requirement to avoid starting the drive from a wrong position. See the parameters for the filtering and position initialization in the table below.</p>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pos_conf_gain</td><td>Float</td><td>0.9</td><td>The gain &lt; 1 defines how quickly the reported position confidence reacts to the drop of confidence. 0 means no filtering and the closer to value 1 the higher amount of filtering is applied</td></tr>
<tr><td>pos_ini_min_conf</td><td>Float</td><td>70.0</td><td>Position initialization will not be accepted if the position confidence [%] is lower than this threshold.</td></tr>
</tbody></table>
<p>The position confidence value can be also used to slow down the AGV in areas where the position confidence gets worse to avoid losing the control of the AGV. AGV will slow down to speed value defined by parameter <strong>pc_soft_slow_wheel_speed</strong>.</p>
<p><strong>Slow down due to low confidence parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pc_soft_slow_conf_limit</td><td>Float</td><td>0.0</td><td>When position confidence drops below this limit [%], AGV will slow down</td></tr>
<tr><td>pc_soft_slow_raw_conf_limit</td><td>Float</td><td>0.0</td><td>When unfiltered position confidence drops below this limit [%], AGV will slow down</td></tr>
</tbody></table>
<h2 id="how-to-use-8"><a class="header" href="#how-to-use-8">How to use</a></h2>
<h3 id="monitoring-position-confidence"><a class="header" href="#monitoring-position-confidence">Monitoring position confidence</a></h3>
<p><strong>Navitrol Monitor</strong></p>
<p>The position confidence chart can be found in Navitrol Monitor on the right side of the GUI.</p>
<p><img src="Localization/PositionConfidence/./media-en/position_confidence_basic.png" alt="" /></p>
<blockquote>
<p>Position confidence of the AGV</p>
</blockquote>
<p>In Navitrol Monitor there exists also more detailed representation of the position confidence. This can be found under <em>Chart &gt; Positioning</em> menu.</p>
<p><img src="Localization/PositionConfidence/./media-en/position_confidence_advanced.png" alt="" /></p>
<blockquote>
<p>Position confidence with affecting factors: <br />NHits = Confidence factor from scanner hits matching to environment, <br />DtE = How close the matched scanner points are to the environment, <br />EdgeD = Describes how precise is the match,<br />Refl = Confidence from reflectors, <br />Conf = Reported position confidence. <br />NHits graph tells the number of scanner point hits to the environment.</p>
</blockquote>
<p><strong>Supervisor interface</strong></p>
<p>Navitrol reports the position confidence over supervisor interface in default section of <a href="Localization/PositionConfidence/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html#3102---navitrol-status">3102 - Navitrol status</a> message. This value can be read by the supervisor and used for example for automatic monitoring, logging or visualization.</p>
<hr />
<h2 id="troubleshooting-21"><a class="header" href="#troubleshooting-21">Troubleshooting</a></h2>
<h3 id="errors-and-warnings-8"><a class="header" href="#errors-and-warnings-8">Errors and Warnings</a></h3>
<h4 id="207---error_position_confidence_low"><a class="header" href="#207---error_position_confidence_low">207 - ERROR_POSITION_CONFIDENCE_LOW</a></h4>
<p>This error is active when the position confidence is lower than the threshold <strong>pos_conf_limit</strong>.</p>
<p>To recover, check how the scanner points match to the environment in Navitrol Monitor. If the points match to only some part of the environment well but in some other area there are considerable deviations, consider building the map again for this area. The problem can also be due to badly calibrated scanner positions/angles, see <a href="Localization/PositionConfidence/../ScannerCalibration/ScannerCalibration-en.html">Scanner calibration</a> document.</p>
<p><img src="Localization/PositionConfidence/./media-en/well-and-ill-matching-env.png" alt="" /></p>
<blockquote>
<p>On the left a situation where the scanner data matches the environment really well and AGV has high position confidence. On the right a situation where the scanner data does not match well to the walls and the AGV has thus low position confidence.</p>
</blockquote>
<p>This error might also be triggered when there are too low number of scanner points matching to the environment. See <a href="Localization/PositionConfidence/PositionConfidence-en.html#monitoring-position-confidence">Monitoring position confidence</a> chapter how to see number of matching scanner points.  If this case check that the AGV has enough static features in its view even when some of the map is obscured. Consider lowering the parameters <strong>corr_conf_min_scale_npts</strong> and <strong>corr_conf_max_scale_npts</strong> if there are low amount of contours or if the scanner resolution is low. When only some part of the map has low amount of static contours, you can apply the parameter adjustments only in specific regions using the <a href="Localization/PositionConfidence/../../Miscellaneous/ParameterZones/ParameterZones-en.html">Parameter zone</a> feature. Other option is to use <a href="Localization/PositionConfidence/../DynamicMapping/DynamicMappingServer/DynamicMappingServer-en.html">Dynamic mapping</a> feature.</p>
<h4 id="615---warning_low_pos_conf_slowed_down"><a class="header" href="#615---warning_low_pos_conf_slowed_down">615 - WARNING_LOW_POS_CONF_SLOWED_DOWN</a></h4>
<p>AGV slows down due to low position confidence to maintain the control of the AGV.</p>
<p>This warning will inform when the position confidence has dropped under threshold limits. The limits are defined with parameters <strong>pc_soft_slow_conf_limit</strong> and <strong>pc_soft_slow_raw_conf_limit</strong>.
See above ERROR_POSITION_CONFIDENCE_LOW for the possible reasons to low confidence.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scanner-calibration-guide"><a class="header" href="#scanner-calibration-guide">Scanner Calibration Guide</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-12"><a class="header" href="#glossary-12">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Navigation software for an individual vehicle</td></tr>
<tr><td>Navitrol Monitor</td><td>Monitoring software for the Navitrol positioning software running an on individual vehicle</td></tr>
<tr><td>Navithor Tools</td><td>Software for creating and editing environment and routes for the Navitrol navigation software</td></tr>
</tbody></table>
<hr />
<h2 id="general-information"><a class="header" href="#general-information">General Information</a></h2>
<p>This document aims to cover the calibration of the measurement scanners that Navitrol directly reads scanner data from. Therefore, this does not include pure safety scanners where only the safety zone status is reported.</p>
<p>Before performing the Navitrol scanner calibration it is vital that the height and seen angle of the laser scanners are first mechanically adjusted to be as level as possible in relation to the ground.
Furthermore, the position of each scanner needs to be accurately specified in the Navitrol parameter file according to the AGV CAD model.
If a CAD model is not available, it is important to estimate the relevant dimensions as accurate as possible as they have a direct effect on the localization/driving performance of the AGV.</p>
<p>When tuning the scanner related parameters, odometry is used as a reference. In practice this means that one should not attempt this calibration process before making sure that the kinematic model reflects the reality and that hardware such as encoders are properly configured for the system. See our kinematic specific calibration guides for information about these topics.</p>
<h2 id="scanner-calibration-1"><a class="header" href="#scanner-calibration-1">Scanner Calibration</a></h2>
<p>Navitrol currently supports the use of two separate measurement scanners: <em>front</em> and <em>rear</em> in the parameter file. If both are active and in use it is important that they are well aligned not only to the floor but also to each other as conflicting scanner views can cause jumps in the position estimate when switching between the scanners.
Navithor Tools implements a feature that automates this process by matching recorded measurements to each other and this is further explained under section 2.1.
If only one measurement scanner is used the reader is advised to proceed to section 2.2.</p>
<h3 id="automatic-scanner-alignment"><a class="header" href="#automatic-scanner-alignment">Automatic Scanner Alignment</a></h3>
<p>The calibration tool in Navithor Tools calibrates the positions of two scanners relative to each other but not relative to the navigation point. In practice this means that the position of one scanner must be considered a reference point and that the relative offset estimated by the automatic calibration tool is applied only to the other scanner. How
to optimally calibrate one of the scanners to function as a reference point is explained in section 2.2.</p>
<p>As the algorithm aims to minimize the discrepancy between the measurements collected by the two scanners it is of high importance that the teach file fulfils some certain requirements:</p>
<ul>
<li>
<p>The environment must be well suited for positioning, i.e. straight and large features around the vehicle in several directions.</p>
</li>
<li>
<p>The distance to the environment must not be less than 2 meters or more than 10 meters since most scanners displays the best accuracy within this interval.</p>
</li>
<li>
<p>The environment should preferably not be shiny/exceptionally reflective as that reduces the performance.</p>
</li>
<li>
<p>The AGV should be driven slow (&lt; 0.5 m/s) in a figure eight pattern three times and preferably also straight for a while. The total distance should be a few dozen meters. It is important that there are no large obstructions between any of the recorded points.</p>
</li>
</ul>
<p>When the teach file has been recorded and exported from the IPC to the computer running Navithor Tools it can be uploaded to the Tools project.
After selecting the relevant range of measurements and matching them to each other using the matching tool one can access the calibration tool under <em>Tools --&gt; Calibrate Scanners</em> in the top bar. The UI can be seen in Figure 1.</p>
<p><img src="Localization/ScannerCalibration/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1: User interface of the Scanner Calibration tool.</p>
</blockquote>
<p>To start the calibration process press <em>Run Calibration</em> and the heatmap and graph seen in Figure 1 should become visible. They can be used to deduce whether there is a problem with the calibration data or not. With good data, there should be one smooth circular peak in the image and one smooth peak in the graph as seen in the above example. If there are several peaks, record teach data again at a slower speed or use a longer range of measurements.</p>
<p>It is recommended to run the calibration multiple times until the positions stabilize, i.e. when the peak is not moving substantially between the runs and is close to the center which usually takes two or three calibration rounds. Once the results are satisfactory the suggested heading changes should be applied to the scanner angles in the
parameter file while the (x,y) coordinates usually can be kept as they are:</p>
<ul>
<li>
<p><strong>scan_front_sen_angle,</strong></p>
</li>
<li>
<p><strong>scan_rear_sen_angle.</strong></p>
</li>
</ul>
<p>Calibrated scanner positions are transformed so that they stay on the same line that passed through the original scanner positions. This means for instance that centered scanners will stay centered after calibration.</p>
<h3 id="manual-fine-tuning-of-scanner-angles-1"><a class="header" href="#manual-fine-tuning-of-scanner-angles-1">Manual Fine Tuning Of Scanner Angles</a></h3>
<p>After the localization scanners have been aligned with each other they will still need to be aligned with the vehicle frame/odometry. If this is not done carefully there will be discrepancies between measured odometry and scanner data which in turn will have a negative impact on the performance of the AGV, causing false position corrections. This
discrepancy usually shows up as large lateral corrections and a good performance is only achieved after these have been reduced to fulfil the defined requirements.</p>
<p>The lateral corrections should be monitored under <em>Navitrol Monitor</em> --&gt; <em>Charts --&gt; Odometry Correction --&gt; Position Correction Averages</em> (see Figure 2) while the AGV is driving on a straight route. The target is to reach a lateral correction within [-0.1, 0.1] [cm/m]</p>
<p><img src="Localization/ScannerCalibration/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2: Odometry corrections in Navitrol Monitor.</p>
</blockquote>
<p>If the average correction is not within the acceptable limits (as in the picture above) manual tuning of the scanner angles is required. This can be broken down into the following steps:</p>
<ol>
<li>If using two scanners, disable the rear one by setting <strong>I,scan_rear_front_selection = 2</strong> and <strong>I,scan_rear_front_localization_selection = 2</strong>. If automatic odometry correction is available for your machine type, turn it off by setting</li>
</ol>
<ul>
<li>
<p><strong>F,odo_err_est_alpha = 0,</strong></p>
</li>
<li>
<p><strong>F,odo_auto_corr_alpha_dh = 0,</strong></p>
</li>
<li>
<p><strong>F,odo_auto_corr_alpha_ds = 0,</strong></p>
</li>
<li>
<p><strong>F,odo_auto_corr_alpha_h = 0.</strong></p>
</li>
</ul>
<ol start="2">
<li>
<p>Reboot Navitrol, for example by using a SSH client such as PUTTY and execute the command <strong>killall Navitrol</strong> followed by <strong>./startNavitrol.sh</strong> from <em>/home/navitec</em>.</p>
</li>
<li>
<p>Record a teach file where only one scanner is activated and create a new project with clearly defined environment and a straight route of 3-10 meters, the longer the better. Make sure that one of the lanes is set to reverse.</p>
</li>
<li>
<p>Raise the average position correction gain by increasing <strong>F,odo_err_est_alpha</strong> to <strong>0.006</strong>.</p>
</li>
<li>
<p>Create a drive order between the two endpoints of the route and set the AGV driving back and forth in an endless loop.</p>
</li>
<li>
<p>Adjust the defined scanner angle with the parameter **F,**<strong>scan_front_sen_angle</strong> until the lateral corrections are within the acceptable range. Start by both increasing and lowering it by 1 degree to determine which direction it should be adjusted in before tuning it more accurately. NOTE! If the lateral correction     chart displays large jumps during the calibration process it is likely that the environment is not good enough and should be redefined.</p>
</li>
<li>
<p>When the front scanner has been well aligned with the odometry the final calibration step is to activate and adjust the angle of the rear scanner accordingly. E.g. if <strong>scan_front_sen_ang</strong> was decreased from <strong>90</strong> to <strong>89</strong> one has to adjust <strong>scan_rear_sen_ang</strong> from <strong>-90</strong> to <strong>-91</strong>.</p>
</li>
<li>
<p>Finally, set <strong>odo_err_est_alpha</strong>, <strong>scan_rear_front_selection and scan_rear_front_localization_selection</strong> back to their original values and analyse the corrections once again. If the scanners are not matching each other, start by adjusting <strong>scan_rear_sen_ang</strong>. The scanner points should match each other on both sides of the  vehicle.</p>
</li>
<li>
<p>When the corrections are satisfactory, reset the correction gains and the automatic odometry parameters back to their original values.</p>
</li>
</ol>
<p><strong>NOTE!</strong> Matching the scanner views to each other is the most vital part of the scanner calibration process. Once the front scanner is calibrated according to the procedure and it is time to calibrate the rear scanner, pay more attention to matching the scanner views than the correction charts.</p>
<h3 id="notes-on-accuracy"><a class="header" href="#notes-on-accuracy">Notes On Accuracy</a></h3>
<p>Calibration accuracy depends heavily on the scanner model, environment and how the scanners are positioned relative to each other.
Additionally,</p>
<ul>
<li>
<p>the automatic scanner alignment will run with any teach file driven at any speed in most environments but will not be as accurate and may not result in correct results if the teach data is not good. It is therefore important to make sure that the odometry is well calibrated and that the surrounding environment is suitable for the process.</p>
</li>
<li>
<p>the automatic scanner alignment can be run on any length of teach data. The longer the teach data, the more accurate the results but the slower the process.</p>
</li>
<li>
<p>the calibration of safety scanners can be very sensitive to the distance to natural features. With long distance teach data, it is normal for calibrated safety scanner positions to deviate by several centimeters from positions measured with a tape measure. Some scanner models are also much more accurate than others.</p>
</li>
<li>
<p>with safety scanners the highest accuracy is achieved between roughly 3 and 8 meters.</p>
</li>
<li>
<p>due to the scanners' sensitivity to distance, it is recommended that the calibration is done in an environment where distances from scanners to natural features are mostly within the most accurate range.</p>
</li>
<li>
<p>scanner calibration varies over time. In practice this means that usually when an AGV is recalibrated the results will not be identical to previous calibration even when mechanically everything is identical. This does not mean that the scanners should be recalibrated periodically as the variation is not significant enough to affect positioning accuracy significantly.</p>
</li>
<li>
<p>distance accuracy also varies between scanner units. For instance, at long distances wall to wall distance measurement can differ as much as 10 cm between different scanner units of the same model. At shorter distances, less than 2 meters, the difference can be several centimeters as well.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="guidelines-for-the-environment"><a class="header" href="#guidelines-for-the-environment">Guidelines for the Environment</a></h1>
<p>Updated 17.05.2024</p>
<hr />
<h2 id="navitrol-basic-positioning-principle"><a class="header" href="#navitrol-basic-positioning-principle">Navitrol basic positioning principle</a></h2>
<p>Navitrol determines the machine position by using the odometry data from the wheels and correcting it with the data that is received from the laser scanners. The data from the laser scanners is matched with the map and this information is used for correcting the position. For the map, Navitrol can use both natural features and reflectors or either of them.
There are different requirements for reflectors and natural features.</p>
<p>Navitrol supports also other positioning methods and aids; like matrix codes, magnetic line, GPS (outdoor), IMU. Some of these methods are more like options for basic positioning, while some add accuracy and robustness. This document however focuses only on environment guidelines to be used for laser scanner position corrections.</p>
<h2 id="scanner-features-and-their-effect-to-the-performance"><a class="header" href="#scanner-features-and-their-effect-to-the-performance">Scanner features and their effect to the performance</a></h2>
<p>Different scanners have different performance. The features of the scanner affect both the accuracy of the positioning and the distance where the natural features can be seen.</p>
<p>Modern laser scanners have a long measurement range with good data quality. For example laser scanners like:</p>
<ul>
<li>
<p>Pepperl&amp;Fuchs R2000UHD</p>
</li>
<li>
<p>Leuze RSL400 series</p>
</li>
<li>
<p>Sick MicroScan/NanoScan</p>
</li>
</ul>
<p>would be considered modern.</p>
<p>For laser scanners that are not considered modern, a good rule of thumb is that they do not reliably see natural features from longer distances than 10 meters. Laser scanners like:</p>
<ul>
<li>
<p>Sick S300</p>
</li>
<li>
<p>Omron OS32C</p>
</li>
</ul>
<p>can still be used but are not considered modern.</p>
<h2 id="supported-reflector-types"><a class="header" href="#supported-reflector-types">Supported reflector types</a></h2>
<p>Navitrol supports two reflector types, flat and round reflectors.
Triangle (two flat reflectors together) shaped reflectors are not supported. Reflectors should be minimum 50 cm from each other.</p>
<p>The reflectivity material matters also. The best one that is recommended especially to flat reflectors is 3M™ Diamond Grade™ DG Reflective Sheeting 4090 White. It is important that the microstructure / grooves are vertical; if not, the reflector will not work right.</p>
<h2 id="what-are-the-criteria-that-result-in-a-map-with-good-environment"><a class="header" href="#what-are-the-criteria-that-result-in-a-map-with-good-environment">What are the criteria that result in a map with good environment</a></h2>
<p><strong>Overview</strong></p>
<p>Best results are achieved when the laser scanner can see static natural features, the more, the better. Also, the surface structure/finish, structure size and shape as well as the arrangement of the static features are important.</p>
<p>When recording a map with a vehicle (AGV), one typically drives the vehicle through the area where the AGV will later drive on a route. It is not important that the route driven when mapping is identical to the production routing system. The critical part is that the route driven during mapping can see all the environment needed for navigation in the production route system and that the recorded map can be processed in the easiest way possible. Putting some thought into the mapping process will make life a lot easier, especially when mapping large areas. To be able to close the map, it is critical that the laser can see the identical environment points at the starting point and ending point of the mapping drive. Typically, one would overlap start and end a little bit. It is not important to exactly hit the same spot, just for the laser to see the same environment points. And in this area, it is very beneficial to have good static environment as this will allow for an easy and exact closing / of the map.</p>
<p><strong>Good environment</strong></p>
<p>When doing map matching, the easiest is to match the laser view to static features. When the static features are not blocked, close enough and have features in all directions, it is a good environment. In these cases, Navitrol can provide an accuracy that is +- 1 cm in position and +- 1 degree in heading.</p>
<h3 id="natural-features"><a class="header" href="#natural-features">Natural features</a></h3>
<p><img src="Localization/EnvironmentGuidelines/./media-en/GoodEnvironment.png" alt="" /></p>
<blockquote>
<p>Good environment.</p>
</blockquote>
<p>The example above shows a good environment if the AGV has two scanners, one facing forwards and the other facing backwards.
A single 360 degree scanner would have the same benefits. Even if there is not that much environment, both scanners have 2 meters of wall visible in both directions - longitudinal and transversal. There are enough features to be seen even if one scanner gets blocked.</p>
<p>All static natural features do not however perform the same, some type of features being totally unusable. It is quite typical that laser scanner view(s) tilt slightly while driving, due to uneven floor for example. When the scanner view is tilted, the laser beams at certain view angles may hit something else than expected. In case of longitudinal tilt</p>
<ul>
<li>
<p>laser beams on the left/right sides are not considerably affected</p>
</li>
<li>
<p>laser beams in front/rear directions are affected with full tilt angle -- hitting the target lower or higher than expected</p>
</li>
<li>
<p>other beams then with varying amount depending on the direction of the beam</p>
</li>
</ul>
<p>In the figure below some scenarios are presented.</p>
<p><img src="Localization/EnvironmentGuidelines/./media-en/TiltedScanner.png" alt="" /></p>
<blockquote>
<p>Tilted scanner view with different natural features.</p>
</blockquote>
<p>In case A (optimal vertical feature, like a straight wall) small tilt angles causing the scanner beams to hit higher have no effect at all. For example at a 10 m distance the distance error would be &lt;2mm. On the other hand, when tilted downwards, the laser beams at longer distances start to hit the floor.
When the scanner is mounted very low (as safety scanners typically are), the laser measurements start to deviate from the taught environment really heavily. This is actually a good thing as measurements that do not hit close to the environment are not used at all. If the measurements would hit the floor very close to the actual environment, then they might cause erroneous corrections. So, typically measurements hitting the floor result in &quot;lost&quot; measurements rather than wrong data being used. Whether this is a problem or not, depends on the amount and quality of the measurements not hitting the floor.</p>
<p>In cases B, C and D, the tilting of the scanner may cause erroneous position corrections. Even minor tilt angles might make an impact at certain distances.</p>
<p>It should be noted that issues in cases B, C and D are encountered also when the distance to the measured feature/target changes. So, a &quot;bad&quot; environment feature can cause issues even if there is a perfectly even floor and no tilting. Whenever possible, those kinds of features should not be included in the environment data at all or be covered by vertical artificial objects.</p>
<h3 id="reflectors"><a class="header" href="#reflectors">Reflectors</a></h3>
<p><img src="Localization/EnvironmentGuidelines/./media-en/Reflectors.png" alt="" /></p>
<blockquote>
<p>Reflectors</p>
</blockquote>
<p>The figure above shows an example of optimal reflector positioning.
The scanners can see 4 reflectors and the reflectors are spread around the vehicle in such a way that blocking either scanner still leaves 2 reflectors visible. 2 reflectors is a minimum for positioning the vehicle with reflectors only.</p>
<p>Reflectors are visible on longer distances than natural features. However, the accuracy that reflectors provide is not as good as from natural features because of the small amount of measurement points received from the reflectors.</p>
<p>It should however be noted that if reflectors shall be used for automatic position initialization, symmetrical reflector positions like in the example above, is not a good solution as it can produce multiple equivalent vehicle positions.</p>
<h2 id="what-are-the-minimum-requirements-for-the-environment-using-natural-features"><a class="header" href="#what-are-the-minimum-requirements-for-the-environment-using-natural-features">What are the minimum requirements for the environment using natural features</a></h2>
<p>Navitrol uses odometer as a primary source for position update. The position from the odometry however drifts depending on wheel slippage and vehicle calibration errors. This is the reason why laser scanner data is used to define the vehicle position in global coordinates and correct the drift that accumulates.</p>
<p>Navitrol can drive with odometry only. Because of the drift the position needs to be updated from features every now and then. In practice, the maximum distance the vehicle is capable to drive without scanner corrections is 15 meters in a straight path. When the vehicle is turning, the amount of error from the odometer is higher and in turns correction should always be possible in order not to lose position.</p>
<h3 id="minimum-requirements-for-natural-features"><a class="header" href="#minimum-requirements-for-natural-features">Minimum requirements for natural features</a></h3>
<p>Navitrol is capable to use very little of environment for matching.</p>
<p><img src="Localization/EnvironmentGuidelines/./media-en/MinimumAmountFeatures.png" alt="" /></p>
<blockquote>
<p>Minimum amount of features needed for natural features navigation</p>
</blockquote>
<p>Figure above shows a situation where the AGV route is driven through an environment with pillars sized 1m*1m. These pillars are situated every 15 meters (spacing). When seeing a pillar, Navitrol can correct the position in both longitudinal and transversal direction. Depending on laser scanner measuring distance capability and angular resolution
and/or temporary blocking of a pillar by a non-static object (human, cart, another vehicle, etc.), a single pillar only maybe visible to the AGV at times. In this case, XY position will not be a problem if any one of these features is able to give both longitudinal and transversal correction. However, heading can only be corrected when two of these features are visible at the same time.</p>
<p>The environment described above should be considered a minimum environment for the common suitable laser scanner. 1 meter of natural features in both directions every 15 meters. With a high resolution laser, meaning a device with an angular resolution of 0.1 degree or better, positioning will be possible with further reduced environment.
Please consult Navitec for such applications.</p>
<h3 id="minimum-requirements-for-reflectors"><a class="header" href="#minimum-requirements-for-reflectors">Minimum requirements for reflectors</a></h3>
<p>Navitrol needs to see minimum of 2 reflectors in order to define the position. In practice the amount of 3 reflectors should be visible when navigating using reflectors. These reflectors need to be installed so that they can be seen from different angles. Just seeing two reflectors in front of the machine does not provide the position accurately.</p>
<h3 id="minimum-requirements-for-the-environment-with-both-reflectors-and-natural-features"><a class="header" href="#minimum-requirements-for-the-environment-with-both-reflectors-and-natural-features">Minimum requirements for the environment with both reflectors and natural features</a></h3>
<p>Reflectors can be used in order to be able to define position in a case when there are not enough static features. Typical cases are for example corridors like in figure below. It is sufficient if one reflector at a time is visible. The transversal position and heading can be calculated from the corridor walls. Reflectors are however the only source for longitudinal correction.</p>
<p><img src="Localization/EnvironmentGuidelines/./media-en/CorridorWithReflectors.png" alt="" /></p>
<blockquote>
<p>Corridor with reflectors</p>
</blockquote>
<h3 id="double-walls"><a class="header" href="#double-walls">Double walls</a></h3>
<p>Double (or multiple) walls can occur in the environment for the following reasons:</p>
<ul>
<li>Problems in teaching and/or poorly matched teach data in Navithor Tools can result in features, like straight walls, being multiplied close to each other. A map including such multiplied features does not work properly for localization purposes. Those issues should be fixed in Navithor Tools by making a better teach file or being more careful in merging or erasing excessive environment – or any other corrective means.</li>
<li>Some areas in the working environment are separated by a wall and the environment on both sides of that wall has been taught. In this case the double wall in the map is representing a real wall seen from opposite directions. See figure below.</li>
</ul>
<p><img src="Localization/EnvironmentGuidelines/./media-en/DoubleWall.png" alt="" /></p>
<blockquote>
<p>Double wall in the environment - indicated by a red rectangle.</p>
</blockquote>
<p>Even if these double walls in the map would represent a real wall seen from two directions, localization can be severely disturbed. As there are two more or less identical features close to each other, there is a possibility that localization locks to the wrong one. Issues can be expected especially if the wall is very thin, or if there are few or no other features aligned with the orientation of the wall (green rectangles). </p>
<p>If double walls cause localization issues, and they are not essentially important for the localization, it is reasonable to remove those walls altogether from Navitrol map. Each case with double walls in the map is however unique. Therefore, there is no single clear guideline what to do, other than paying special attention to how localization works in such areas - remembering that in any position on the route it should be possible to detect sufficiently separated features providing both longitudinal and transversal position correction.</p>
<h2 id="dynamic-mapping-lite"><a class="header" href="#dynamic-mapping-lite">Dynamic mapping lite</a></h2>
<p>Dynamic mapping lite is a special feature, where Navitrol builds a local map adding on to previous measurements in the static map that was originally recorded. This local dynamic map is stored in the local memory in the IPC of the AGV for the last 15 meters (can be changed by parameters). Dynamic mapping lite does not make position more accurate.
It helps in cases where the AGV needs to drive through an area where there are very little static contours, but enough dynamic features. Navitrol is able to correct position from these dynamic features. As a dynamic map can always drift, static features or reflectors are needed to lock the dynamic part to the original static map.</p>
<h2 id="dynamic-mapping-full"><a class="header" href="#dynamic-mapping-full">Dynamic mapping full</a></h2>
<p>Dynamic mapping full is an extension to dynamic mapping lite. It means that all the AGVs send the dynamic map lite data to a dynamic mapping server that combines the data and sends update to map to all the AGVs.
This allows to navigate through an area that is gradually changing. When one AGV has mapped the area and another one drives to the same area, it can use the map that was stored by the first one. Repeating this, the map keeps changing all the time and will always be up to date assuming that there is a sufficient number of AGVs to record the changes.</p>
<p>Dynamic mapping full needs also static features or reflectors. These are the only ones that lock the map to right coordinates. Otherwise, updating the map dynamically could cause drift that is not corrected.</p>
<p>Dynamic mapping full cannot work in an environment where everything changes at once. If an AGV drives to a location where dynamic objects have moved and their locations have not been updated to the map, using dynamic mapping does not help, unless the area is sufficiently small.
There is a requirement that position needs to be trusted in order to update the map. Therefore, a sufficient amount of features need to be in same location in order to be able to update the map. For example: If dynamic mapping is in a factory where there is a cleaning day, and on this day all the trolleys would be moved, the map would be out of date after that.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="automatic-odometry-correction"><a class="header" href="#automatic-odometry-correction">Automatic Odometry Correction</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-17"><a class="header" href="#overview-17">Overview</a></h2>
<p>This document describes how automatic odometry correction can be applied, monitored, and what are current limitations. Automatic odometry correction helps to diminish fixed errors in odometry, thus making localization of the vehicle more stable and reliable.</p>
<p>There are three types of odometry corrections: distance, turning rate and heading. Distance correction is applied to reduce the longitudinal odometry error of the AGV. Basically, it corrects the speed measurement received by the navigation system.</p>
<p>Turning rate correction is typically applied to correct steer wheel angle offset error. When steering wheel is not straight while measuring zero angle, vehicle would end up having wrong heading in the map with odometry calculation. This causes scanner-based position correction to constantly correct the heading of the vehicle in the same direction.</p>
<p>Finally, the automatic heading correction is applied to correct the heading of the vehicle in the map. Typically, wrong heading of the vehicle is caused by scanner angle offset error. It will cause scanner-based localization to correct vehicle position laterally.</p>
<h2 id="setup-14"><a class="header" href="#setup-14">Setup</a></h2>
<p>Automatic odometry correction can be applied by setting up designated parameters. They are found in params.txt under title <em>Automatic odometry correction parameters</em>.</p>
<p><em>odo_err_est_alpha, 0.002 # Positioning error averaging weight, must be higher than odo_auto_corr_alpha</em></p>
<p><em>odo_auto_corr_alpha_dh, 0.000 # Percentage of averaged positioning error applied on odometry turning rate correction, set to 0 to disable, ex. value 0.001</em></p>
<p><em>odo_auto_corr_alpha_ds, 0.000 # Percentage of averaged positioning error applied on odometry distance correction, set to 0 to disable, ex. value 0.001</em></p>
<p><em>odo_auto_corr_alpha_h, 0.000 # Percentage of averaged positioning error applied on odometry heading correction, set to 0 to disable, ex. value 0.001</em></p>
<p><em>odo_auto_corr_h_mode, 0 # How odometry heading correction is applied, 0 = to scanner heading(s), 1 = to driving axle heading</em></p>
<p>There are also some limiting parameters for the automatic odometry correction, which may not be directly found in params.txt, but are in use.</p>
<p><em>odo_auto_corr_max_curv_deg_p_m, 10.0 # Maximum curvature for odometry correction to be updated, degrees / meter</em></p>
<p><em>odo_auto_corr_max_dherr_deg, 4.0 # Maximum odometry turning correction amount, degrees / meter</em></p>
<p><em>odo_auto_corr_max_dserr, 0.08 # Maximum odometry distance correction amount, percentage of travelled distance</em></p>
<p><em>odo_auto_corr_max_herr_deg, 4.0 # Maximum odometry heading correction amount, degrees</em></p>
<p>The vehicle kinematic types that support the feature currently are Steer-drive and Differential-drive. So, this feature shouldn't be activated for Omni-driven vehicles.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>After setting parameters <em>odo_err_est_alpha &gt; 0</em> and <em>odo_auto_corr_alpha_* &gt; 0</em>, the automatic odometry correction starts. The target is to get the average position corrections to go close to zero i.e. getting rid of long-term errors in odometry.
Vehicle needs to drive straight routes for a period of time before the automatic correction values will slowly stabilize to the right values.</p>
<p>The correction values are saved to <em>startInfo.bin</em> ensuring that the correction values will stay even if the navigation software is rebooted.
However, there's a margin of 5% from the maximum odometry correction value <em>odo_auto_corr_max_*</em>, within the automatic odometry correction values are set to zero in the file. This means that after a restart, the automatic odometry correction would reset.</p>
<p>If the correction values reach the maximum values, navigation software will set Warning flags active. Each correction type has its own warning:</p>
<p><strong>Distance correction</strong> -- WARNING_TOO_LARGE_AUTO_ODO_CORR (316)</p>
<p><strong>Turning rate correction</strong> -- WARNING_TOO_LARGE_AUTO_ANG_RATE_CORR (315)</p>
<p><strong>Heading correction</strong> -- WARNING_TOO_LARGE_AUTO_ANG_CORR (318)</p>
<p>Distance and turning rate corrections are also applied to the speed and turning rate targets of the vehicle. For example, If the measured speed is 1m/s and the odometry corrections find that vehicle is actually driving 1.01m/s, the target speed for 1m/s is then ~0.99m/s.</p>
<h2 id="monitoring"><a class="header" href="#monitoring">Monitoring</a></h2>
<p>User can see the values of automatic odometry correction in the Monitoring software using Charts (<em>Charts -&gt; Odometry Correction</em>). In the opened window there is a graph called <em>Odometry Auto correction</em> (see image below). The graph is color-coded so it's easy to compare the values of automatic odometry correction to the average position corrections.</p>
<p>Head -- Heading odometry correction (to reduce lateral position corrections)</p>
<p>Dist -- Distance odometry correction (to reduce longitudinal position corrections)</p>
<p>DHead -- Turning rate odometry correction (to reduce heading position corrections)</p>
<p><img src="Localization/AutomaticOdometryCorrection/./media-en/image4.png" alt="" /></p>
<p>Optimum would be that all of the graph lines in both of the charts would be close to zero. This would indicate that the calculated odometry is sufficient even without automatic odometry corrections. A rule of thumb is that the Odometry Auto Correction graph lines should be within ± 1.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reflector-based-position-initialization"><a class="header" href="#reflector-based-position-initialization">Reflector Based Position Initialization</a></h1>
<p>Updated 09.04.2024</p>
<hr />
<h2 id="introduction-22"><a class="header" href="#introduction-22">Introduction</a></h2>
<p>Navitrol has a feature that the AGV position can be initialized using reflectors in the mapped environment. This feature can be used only with single level (single map/environment file) system.</p>
<h2 id="requirements-11"><a class="header" href="#requirements-11">Requirements</a></h2>
<p>There are no special requirements for the feature other than that the reflectors should have as good of geometry as possible since the position acquisition is based on triangulation.</p>
<p>Basic requirements for triangulation:</p>
<p>The basic requirement: A well-conditioned triangle. A well-conditioned triangle is the one in which the error in angular measurement has a minimum affect on the computed lengths of the sides of triangle.</p>
<p>It is usually a good idea to create an isosceles triangle with the reflectors in the area where it is known that the position would need to be initialized using them.</p>
<p>There is always an error when the angle is determined. When the lengths are determined using the angles then the side lengths also get affected.</p>
<h2 id="current-possibilities-to-initialize-position"><a class="header" href="#current-possibilities-to-initialize-position">Current possibilities to initialize position</a></h2>
<p>Initialize using the startInfo.bin</p>
<p>Initialize manually from different sources.</p>
<p>Initialize using reflectors.</p>
<h2 id="scenarios-where-automatic-position-initialization-can-be-utilized"><a class="header" href="#scenarios-where-automatic-position-initialization-can-be-utilized">Scenarios where automatic position initialization can be utilized</a></h2>
<p>It can be used in any area that has reflectors. Sometimes it happens that the environment is not good and the AGV momentarily loses position.
In this case the position can be automatically initialized using this feature.</p>
<p>It must be safe to keep the AGV driving in such a situation to continue after automatically re-initializing the position.</p>
<h2 id="feature-flow"><a class="header" href="#feature-flow">Feature flow</a></h2>
<p><img src="Localization/ReflectorBasedPositionInitialization/./media-en/figure1.png" alt="" /></p>
<h2 id="requirements-12"><a class="header" href="#requirements-12">Requirements</a></h2>
<p>Three reflectors at the minimum are required for using this feature. It is good to have as many reflectors as possible in the area where the position is to be automatically initialized.</p>
<p>As Navitrol creates sets of three reflectors from the available ones.
Therefore, it is better to have enough reflectors around the AGV such that it can create three reflector sets at any given location.
The geometry or the angles between the reflectors affect the calculation.
The angles between all reflectors should be such that they satisfy the following condition: 0 &lt; β &lt; 180 where β is the angle.</p>
<p><img src="Localization/ReflectorBasedPositionInitialization/./media-en/figure2.png" alt="" /></p>
<blockquote>
<p>Figure 1: Reflector distances and angles to all other reflectors</p>
</blockquote>
<h2 id="setup-15"><a class="header" href="#setup-15">Setup</a></h2>
<p>To set the feature up. First add reflectors to the environment. Then set the parameters given in the following table.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td> pos_ini_refl_based_auto_pos_acq_en</td><td>Enable the automatic position initialisation based on the reflectors seen</td></tr>
<tr><td> pos_ini_refl_based_co_dist_refl</td><td>Reflector-based position initialization - Distance (cutoff) between the reflectors to consider determining angles between them.<br><strong>Needs Navitrol restart.</strong></td></tr>
<tr><td> pos_ini_refl_dist_match_eps</td><td>Distance difference between calculated map dist and seen ref dist for auto pos initialisation</td></tr>
<tr><td>pos_ini_refl_ang_match_eps</td><td>Angle difference [deg] between the observed angle and the calculated angle created at a particular reflector point by vectors joing any other two reflectors</td></tr>
<tr><td>pos_ini_refl_auto_repos_en</td><td>If 1, Navitrol will reset position whenever it loses position and not if 0.</td></tr>
<tr><td> pos_ini_refl_try_count</td><td>Max number of attempts to initialize position; When position is initialized this counter will be reset. (max value = 1000)</td></tr>
<tr><td>pos_ini_refl_matching_interval_ms</td><td>Time interval (in milliseconds) between two consecutive position initialization attempts.</td></tr>
<tr><td>pos_ini_refl_min_conf</td><td>Automatic reflector position initialization should not be triggered if position confidence is above this threshold.</td></tr>
<tr><td> pos_ini_refl_number_sets</td><td>Number of reflector sets to be checked from the reflectors seen by the scanner. Modify this to reduce the time taken by algorithm and also the computational cost</td></tr>
<tr><td> log_pos_ini_refl</td><td> Log reflector-based position initialisation</td></tr>
<tr><td>pos_init_max_wait_time</td><td>Once the solution is calculated and the position is initialized then Navitrol waits for 1.5*pos_init_max_wait_time before it re-initializes the position.</td></tr>
</tbody></table>
<p>The parameters then should be tuned so that the feature works properly.
Most commonly, the parameters <strong>pos_ini_refl_dist_match_eps</strong> and <strong>pos_ini_refl_ang_match_eps</strong> need to be tuned.</p>
<h2 id="constraints-and-limitations"><a class="header" href="#constraints-and-limitations">Constraints and limitations</a></h2>
<p>Worst case scenario is the one where the reflectors are colinear. This means that the angle between the reflectors is 0 or 180 degrees. In this case that position can be initialized on either side of the reflectors if they are equidistant from eachother. In this case, a good practice is to have them at different distances from eachother.
This still will help find a unique position.</p>
<p><img src="Localization/ReflectorBasedPositionInitialization/./media-en/figure3.png" alt="" /></p>
<blockquote>
<p>Figure 2: Equidistant, colinear reflectors give poor results for position initialization</p>
</blockquote>
<h2 id="example-parameters"><a class="header" href="#example-parameters">Example parameters</a></h2>
<p>An example set of parameters is given below. They can be used to start with and tuned thereon to see what helps the most.</p>
<table><thead><tr><th>Parameters</th></tr></thead><tbody>
<tr><td>I,pos_ini_refl_based_auto_pos_acq_en, 1</td></tr>
<tr><td>F,pos_ini_refl_based_co_dist_refl, 25.0</td></tr>
<tr><td>F,pos_ini_refl_dist_match_eps, 0.09</td></tr>
<tr><td>F,pos_ini_refl_ang_match_eps, 0.9</td></tr>
<tr><td>I,pos_ini_refl_number_sets, 30</td></tr>
<tr><td>I,log_pos_ini_refl, 1</td></tr>
<tr><td>I,pos_ini_refl_auto_repos_en, 1</td></tr>
<tr><td>I,pos_ini_refl_try_count, 10</td></tr>
<tr><td>I,pos_ini_refl_matching_interval_ms, 1000</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="precision-positioning-1"><a class="header" href="#precision-positioning-1">Precision Positioning</a></h1>
<p>Updated 02.05.2024</p>
<hr />
<h2 id="glossary-13"><a class="header" href="#glossary-13">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Navigation software for an individual vehicle.</td></tr>
<tr><td>NavitrolMonitor</td><td>Monitoring software for the Navitrol positioning software running an on individual vehicle.</td></tr>
<tr><td>NavithorTools</td><td>Software for creating and editing environment and routes for the Navitrol navigation software.</td></tr>
<tr><td>Navigation point</td><td>Centre point of the vehicle's coordinate system which is used as a reference for all other dimensions.</td></tr>
</tbody></table>
<hr />
<h2 id="introduction-23"><a class="header" href="#introduction-23">Introduction</a></h2>
<p>Precision positioning is a Navitrol feature unlockable by additional licensing and parameters. Precision positioning uses a different kind of positioning algorithm that allows the user to select which environment points should be used for navigation when more precise positioning is required and also uses these points in a way that increases positioning accuracy. In normal positioning, every generated environment point is used at all times.</p>
<p>Most common use cases for the feature are cases when docking to a station needs to be done only with the static features of the station itself since these features are more reliable for navigation than points seen at a larger distance. However, precision positioning can also be applied to driving through environment normally if more precision is needed in specific areas.</p>
<p>Precision positioning can be applied to every kind of vehicle to improve the positioning accuracy but the best results can be accomplished with having the navigation scanner(s) mounted symmetrically in relation to the navigation point of the vehicle.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image4.png" alt="" /></p>
<p>The best results have been achieved with the combination of having the scanners mounted symmetrically and performing the precision positioning with reflectors that are mounted symmetrically in relation to the driving axle of the vehicle.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image5.png" alt="" /></p>
<h2 id="relevant-parameters"><a class="header" href="#relevant-parameters">Relevant parameters</a></h2>
<table><thead><tr><th>Parameters</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,precision_positioning_enable,</strong></td><td>0 to disable precision positioning areas, 1 to enable; min 0, max 1</td></tr>
<tr><td><strong>I,precision_positioning_in_pos_init_enabled,</strong></td><td>0 to disable precision positioning areas when initializing position and use the whole environment, 1 to enable; min 0, max 1</td></tr>
<tr><td><strong>F,precision_map_max_dist_m,</strong></td><td>Maximum distance offset of the vehicle navigation point in meters when driving into or out of a precision positioning area and switching from positioning between only the environment within the area and the environment outside of it. Recommended start value 0.2.</td></tr>
<tr><td><strong>F,precision_map_max_hdiff_deg,</strong></td><td>Maximum heading offset of the vehicle in degrees when driving into or out of a precision positioning area and switching from positioning between only the environment within the area and the environment outside of it.<br>Recommended start value 30.</td></tr>
<tr><td><strong>F,precision_min_point_dist,</strong></td><td>Minimum distance in meters between precision positioning points generated from the environment within the precision positioning area. <br>Recommended start value 0.02.</td></tr>
<tr><td><strong>I,precision_reflectors_only,</strong></td><td>1 to only use reflectors within precision positioning areas, 0 to use environment point too; min 0, max 1</td></tr>
<tr><td><strong>F,precision_ref_conf_multiplier,</strong></td><td>Multiplier for position confidence gained by detected reflectors. Recommended start value 2.</td></tr>
<tr><td><strong>F,precision_large_xy</strong></td><td>If the xy-correction residual (|detected correction xy -- loc_xy_max_corr|) is larger than this value the maximum xy-correction is limited to <strong>precision_xy_corr_large</strong>, otherwise it is limited to <strong>precision_xy_corr_small.</strong> Valid inside the precision positioning zones.</td></tr>
<tr><td><strong>F,precision_xy_corr_large</strong></td><td>Threshold for the xy-corrections inside the precision positioning zones. See explanation for <strong>precision_large_xy.</strong></td></tr>
<tr><td><strong>F,precision_xy_corr_small</strong></td><td>Threshold for the xy-corrections inside the precision positioning zones. See explanation for <strong>precision_large_xy.</strong></td></tr>
<tr><td><strong>F,precision_large_h</strong></td><td>If the h-correction residual (|detected correction h -- loc_h_max_corr|) is larger than this value the maximum h-correction is limited to precision_h_corr_large**, otherwise it is limited to <strong>precision_h_corr_small.</strong> Valid inside the precision positioning zones.</td></tr>
<tr><td><strong>F,precision_h_corr_large</strong></td><td>Threshold for the h-corrections inside the precision positioning zones. See explanation for <strong>precision_large_h.</strong></td></tr>
<tr><td><strong>F,precision_h_corr_small</strong></td><td>Threshold for the h-corrections inside the precision positioning zones. See explanation for <strong>precision_large_h.</strong></td></tr>
<tr><td><strong>F,precision_ref_mac_dist_err</strong></td><td>Maximum position error [m] for the reflector to be considered. Replaces <strong>corr_ref_max_dist_err</strong> inside the precision positioning zone.</td></tr>
<tr><td><strong>F,precision_ref_max_ang_err_deg</strong></td><td>Maximum angular error [deg] for the reflector to be considered. Replaces <strong>corr_ref_max_ang_err_deg</strong> inside the precision positioning zone.</td></tr>
</tbody></table>
<p>Other parameters are recommended to be kept in their default values unless recommended otherwise by Navitec Systems.</p>
<h2 id="setting-up-a-precision-positioning-area"><a class="header" href="#setting-up-a-precision-positioning-area">Setting up a precision positioning area</a></h2>
<h3 id="creating-the-environment"><a class="header" href="#creating-the-environment">Creating the environment</a></h3>
<p>Precision positioning can be used with any environment points but to reach the most accurate results, it is recommended that a separate teach file is made where the vehicle is driven through the elements designed to be used as environment for the positioning. The environment points should then be generated from the measurements from this teach file, where all of the measurements are from a situation simulating the real use case. This way it can be verified that the environment is seen in the same way when teaching it and when navigating with it autonomously.</p>
<p>Match the new teach file to the original environment.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 1. Additional precision positioning area teach file matched to the original environment.</p>
</blockquote>
<p>Follow the regular procedure for creating an environment that is explained in the Navithor Tools user guide document and generate the environment designed to be used for the precision positioning.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 2. New environment points generated from the precision positioning teach file.</p>
</blockquote>
<p>If reflectors are to be used for precision positioning, they also have to be generated according to the normal procedure.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 3. Reflectors generated.</p>
</blockquote>
<h3 id="creating-the-precision-positioning-area"><a class="header" href="#creating-the-precision-positioning-area">Creating the precision positioning area</a></h3>
<p>For activating the precision positioning algorithm, a precision positioning area has to be defined in Navithor Tools.
Precision positioning will only activate within this zone and will only use environment points defined inside this zone for navigation.</p>
<p>An area polygon can be defined in Navithor Tools from Zones/Zones, by setting the Zone Type &quot;Precision positioning zone&quot;</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 4. Creating a precision positioning area.</p>
</blockquote>
<p>If there are other routes inside the precision positioning area, where precision positioning is not needed, there is also an option to define angle limits for the vehicle heading that activate the precision positioning. The angle limits can be altered in Navithor Tools from Environment Precision positioning Edit angles.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 5. A precision positioning area that will only be triggered when the heading is within 30° of the route heading causing the precision positioning algorithm to only be triggered when driving the route leading inside the docking area.</p>
</blockquote>
<p>The heading of the angle limitation can be changed by changing to the heading alteration view by clicking the centre point of the figure. The heading can then be changed by dragging the orange handle of the figure.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image11.png" alt="" />
<img src="Localization/PrecisionPositioning/./media-en/image12.png" alt="" />
<img src="Localization/PrecisionPositioning/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>Figures 6, 7 &amp; 8. Switching between the heading alteration view and the angle limit alteration view and changing the heading.</p>
</blockquote>
<p>The angle limitation can be altered by dragging the purple handle while in the angle alteration view. If the handle is dragged to create a full circle, there are no angle limitations.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image14.png" alt="" />
<img src="Localization/PrecisionPositioning/./media-en/image15.png" alt="" /></p>
<blockquote>
<p>Figures 9 &amp; 10. Changing the angle limit from 30° to no angle limitations.</p>
</blockquote>
<p>When the environment with the precision positioning area is uploaded to the vehicle, if there are reflectors within the defined area, Navithor Tools will ask whether the reflectors should be used for navigation only within the precision positioning are or outside of it too.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image16.png" alt="" /></p>
<blockquote>
<p>Figure 11. Message box that appears when there are reflectors inside the precision positioning area.</p>
</blockquote>
<h2 id="using-precision-positioning"><a class="header" href="#using-precision-positioning">Using precision positioning</a></h2>
<p>The precision positioning areas are shown in Navitrol Monitor as light-yellow areas when they are not active and yellow when active.</p>
<p>The conditions for activating the precision positioning area are</p>
<ul>
<li>
<p>Vehicles navigation point is within the precision positioning area</p>
</li>
<li>
<p>The heading of the vehicle is within the limits defined for the precision positioning area.</p>
</li>
</ul>
<p>When the precision positioning area is active, only the environment points and the reflectors within the area are used for positioning to increase accuracy.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image17.png" alt="" />
<img src="Localization/PrecisionPositioning/./media-en/image18.png" alt="" /></p>
<blockquote>
<p>Figures 12 &amp; 13. Precision positioning area activates when the vehicles navigation point is driven within the area.</p>
</blockquote>
<p>When the area is uploaded to Navitrol, Navithor Tools asks if reflectors within the precision positioning area are to be used for navigation only within the area or everywhere.
Depending on the selection here, the reflectors are detected also outside of the area or igrored.</p>
<p><img src="Localization/PrecisionPositioning/./media-en/image19.png" alt="" />
<img src="Localization/PrecisionPositioning/./media-en/image17.png" alt="" /></p>
<blockquote>
<p>Figures 14 &amp; 15. Reflectors within the precision positioning area enabled and disabled outside the area.</p>
</blockquote>
<h2 id="troubleshooting-22"><a class="header" href="#troubleshooting-22">Troubleshooting</a></h2>
<p><strong>Large position corrections on the edge of the precision positioning area:</strong></p>
<ul>
<li>
<p>Check that is the environment within the precision positioning area matched to the other environment properly.</p>
</li>
<li>
<p>If there is an offset between the environment inside the area and outside of it the target position of the vehicle will jump by the distance of the offset when entering or exiting the area.</p>
</li>
</ul>
<p><strong>Precision positioning area not activating when driving into the area:</strong></p>
<ul>
<li>
<p>Check that the precision positioning areas are enabled with the following parameter <strong>I,precision_positioning_enable, 1</strong></p>
</li>
<li>
<p>Check that the heading of the vehicle on the route that is going into the precision positioning area is allowed with the heading limitation feature for the area in Navithor Tools.</p>
</li>
</ul>
<p><strong>Navitrol prompts ERROR_LICENSE_OPTION_MISSING when the precision positioning is enabled:</strong></p>
<ul>
<li>
<p>The licensekey inside the IPC does not include the license option for this feature.</p>
</li>
<li>
<p>Contact Navitec Systems to get a license for precision positioning.</p>
</li>
</ul>
<p><strong>Vehicle is driving inaccurately inside the precision positioning area:</strong></p>
<ul>
<li>
<p>Check that the environment within the precision positioning area is seen by the scanners similarly as it has been defined in Navithor Tools.</p>
</li>
<li>
<p>If there is error in the environment points in relation to the scanner views, run a a new teach file or if possible, try matching the current teach file properly.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="localization-scanner-change-on-the-fly"><a class="header" href="#localization-scanner-change-on-the-fly">Localization scanner change on the fly</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="introduction-24"><a class="header" href="#introduction-24">Introduction</a></h2>
<p>In certain kind of environments safety scanners or other low mounted scanners provide reasonable amount of data for localization, while in some other situations they do not.
In those cases top mounted scanner might be a better solution.</p>
<p>Navitrol has a feature that makes it possible to change the map and localization scanner(s) used on the fly. Namely this is tied to concept of levels but can be used in single level environment as well.</p>
<p>Level in this case is just selector for map and localization scanners in use.</p>
<h2 id="current-limitations"><a class="header" href="#current-limitations">Current limitations</a></h2>
<p>This feature has some quite strict limitations for the time being.</p>
<p>Levels are used as means for changing maps and scanners. This means that only &quot;positioning only&quot; systems are supported as multiple levels are not supported in other systems.</p>
<p>Front scanner has to be defined/enabled for localization on lower level.
Front/rear scanner selection used for localization can then be either</p>
<ul>
<li>
<p>Front only</p>
</li>
<li>
<p>Front and rear</p>
</li>
</ul>
<p>Upper level scanner</p>
<ul>
<li>
<p>Only one upper level scanner can be used for localization and that scanner has to be defined as measurement scanner 0; meaning parameters scanner_meas_xxxxxxx[0].</p>
</li>
<li>
<p>Measurement scanner 0 in such a system can't be used for other purposes (obstacle avoidance, target detection,..)</p>
</li>
</ul>
<h2 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h2>
<p>All scanners used are defined and communication is started at program startup. Parameter changes to scanner models, number of scanners used and connection details (IP:port or serialport) can NOT be changed on the fly. This same applies to P&amp;FR2000 settings:</p>
<table><thead><tr><th>Parameter</th></tr></thead><tbody>
<tr><td>I,scan_pef_samples_per_scan, 2400</td></tr>
<tr><td>I,scan_pef_freq, 25</td></tr>
<tr><td>I,scan_pef_display_on, 0</td></tr>
</tbody></table>
<p>Changes to other parameters mentioned in this document are effective also when changed and reloaded at run time.</p>
<h3 id="enabling-the-feature"><a class="header" href="#enabling-the-feature">Enabling the feature</a></h3>
<p>Localization scanner change on the fly is enabled by parameter scanner_meas_loc_override_level</p>
<p>I,scanner_meas_loc_override_level, -1</p>
<ul>
<li>
<p>Default value of -1 means that this feature is not used (front/rear used on all levels)</p>
</li>
<li>
<p>0 - means forced override -- upper level scanner always used (can be used for teaching)</p>
</li>
<li>
<p>&gt;0 above this level measurement scanner 0 will be used as localization scanner</p>
</li>
</ul>
<p><strong>NOTE:</strong> If this feature is enabled without defining proper upper level scanner scanner_meas_xxxxxxx[0], then ERROR appears as soon as level is changed to this level or higher.</p>
<h3 id="configuring-the-scanners"><a class="header" href="#configuring-the-scanners">Configuring the scanners</a></h3>
<p>Use and configuration of &quot;front&quot; and &quot;rear&quot; scanners is the same as in any Navitrol system. These are effective in levels lower than scanner_meas_loc_override_level.</p>
<p>Upper level scanner shall be defined as measurement scanner 0 -- using parameters scanner_meas_xxxxxxx[0].</p>
<p>Parameters and example values</p>
<table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody>
<tr><td>I,scanner_meas_model[0],</td><td>3 (default is -1 =&gt; disabled)</td></tr>
<tr><td>S,scanner_meas_addr[0],</td><td>192.168.2.182:80 (IP:port)</td></tr>
<tr><td>F,scanner_meas_x[0],</td><td>0.0</td></tr>
<tr><td>F,scanner_meas_y[0],</td><td>0.0</td></tr>
<tr><td>F,scanner_meas_sen_ang_deg[0],</td><td>0.0</td></tr>
<tr><td>F,scanner_meas_beam_min_ang_deg[0],</td><td>0.0</td></tr>
<tr><td>F,scanner_meas_beam_max_ang_deg[0],</td><td>360.0</td></tr>
<tr><td>I,scanner_meas_use_nth_meas[0],</td><td>1</td></tr>
<tr><td>I,scanner_meas_upside_down[0],</td><td>0</td></tr>
<tr><td>F,scanner_meas_scan_delay[0],</td><td>0.0</td></tr>
<tr><td>F,scanner_meas_dang_factor[0],</td><td>-1.0  (#-1 -- disable, reasonable<br># values 0.995 ... 1.005)</td></tr>
<tr><td>I,scanner_meas_scan_rot_cor_invert_dir[0],</td><td>0</td></tr>
<tr><td>I,scanner_meas_offset_mm[0],</td><td>0</td></tr>
<tr><td>I,scanner_meas_use_nth_meas[0],</td><td>1 (#Use only every nth meas)</td></tr>
</tbody></table>
<h3 id="position-confidence-2"><a class="header" href="#position-confidence-2">Position confidence</a></h3>
<p>Position confidence is calculated by default using same parameters for each level. It is possible to define the effective values of parameters corr_conf_min_scale_npts, corr_conf_max_scale_npts for override levels separately using parameters:</p>
<p><code>I,corr\_conf\_min\_scale\_npts\_override</code></p>
<p><code>I,corr\_conf\_max\_scale\_npts\_override</code></p>
<p>Both have a default value 0 which means &quot;not used&quot;. Then corr_conf_min_scale_npts, corr_conf_max_scale_npts are used for all levels. If the value of these parameters is anything &gt;0, then that value is used on the override levels. It is also ok to define only one of these, like</p>
<p><code>I,corr\_conf\_max\_scale\_npts\_override, 125</code></p>
<p>In such a case corr_conf_min_scale_npts would be used as min parameter for all levels.</p>
<h2 id="switching-localization-scanners-on-the-fly"><a class="header" href="#switching-localization-scanners-on-the-fly">Switching localization scanners on the fly</a></h2>
<p>Whenever current level &gt;= scanner_meas_loc_override_level, additional scanner_meas_only_model[0] is used for localization. In such a case</p>
<ul>
<li>
<p>meas[0] scanner becomes effectively front scanner</p>
</li>
<li>
<p>rear scanner is disabled.</p>
</li>
</ul>
<p>It is the &quot;AGV Controller&quot; that tells Navitrol the level and therefore the scanner(s) to use for localization.</p>
<p>Example: <code>I,scanner\_meas\_loc\_override\_level, 2</code></p>
<p>This would result in using basic front/rear scanners on levels 0 and 1.
For level 2 and &quot;above&quot; scanner_meas_model[0] would be used for localization.</p>
<p>Communication to all defined scanners is always active regardless of the use case. This enables immediate localization scanner change on the fly with very small extra cost in CPU load.</p>
<h2 id="teaching"><a class="header" href="#teaching">Teaching</a></h2>
<p>In order to utilize this feature there has to be a separate map for all levels in use. Matching these maps in exactly same coordinates is critical for the change to work smoothly.</p>
<p>&quot;AGV Controller&quot; tells Navitrol the level and therefore the scanner(s) to use for localization as well as for teaching. Teaching for each map must obviously be done using the scanner intended to be used as localization for that level.</p>
<p>Regardless of the level info sent by &quot;AGV Controller&quot;, one can also select/force scanners used for localization and teaching by setting:</p>
<blockquote>
<p>Use &quot;normal&quot; front/rear scanners =&gt; I,scanner_meas_loc_override_level, -1
Use scanner_meas_only_model[0] =&gt; I,scanner_meas_loc_override_level, 0</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ramp-zones"><a class="header" href="#ramp-zones">Ramp Zones</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-18"><a class="header" href="#overview-18">Overview</a></h2>
<p>Ramp zone is a Navitrol feature that aims to remedy navigation issues related to driving the AGV on tilted zones, such as ramps.</p>
<p>Ramps typically have following navigation related issues:</p>
<ul>
<li>The length of the ramp on the map is often the horizontal length only (if map is based on CAD file) while the length that an AGV travels is the hypotenuse of the ramp.
<ul>
<li>The ramp zone will scale the odometry so that the traveled distance matches the defined map.</li>
</ul>
</li>
<li>The environment outside of the ramp is unusable for navigation purposes because the AGV tilts on the ramp.
<ul>
<li>The ramp zone will use only environment inside the ramp zone, so the tilted environment is not used.</li>
</ul>
</li>
<li>The static environment inside the ramp zone is often insufficient.
<ul>
<li>The ramp zone will disable longitudinal position correction based on scanners so that only the scaled odometry is used to define the traveled distance.</li>
<li>The ramp zone will reduce position confidence slower and only when the AGV is moving.</li>
</ul>
</li>
</ul>
<p>After leaving the ramp zone the AGV can have a small position error but that will be automatically corrected when the drive continues.</p>
<h2 id="how-to-use-9"><a class="header" href="#how-to-use-9">How to use</a></h2>
<h3 id="preconditions-1"><a class="header" href="#preconditions-1">Preconditions</a></h3>
<ul>
<li>Minimum software version requirements
<ul>
<li>Navitrol 6.32.00</li>
<li>Navithor tools 4.07.00</li>
</ul>
</li>
<li>Need to be used with a position controlled AGV</li>
<li>The incline percentage of each ramp must be known
<ul>
<li>Incline percentage = Rise / Run * 100</li>
</ul>
</li>
</ul>
<p><img src="Localization/RampZones/./media-en/image3.png" alt="" /></p>
<h3 id="set-up-1"><a class="header" href="#set-up-1">Set up</a></h3>
<ol>
<li>Measure the incline percentage of each ramp</li>
<li>Define the ramp zones using Navithor Tools (see the image below)
<ol>
<li>Environment and routes should be already defined</li>
<li>Open &quot;Zones&quot;-tab</li>
<li>Open &quot;Feature zones&quot;-tab</li>
<li>Select &quot;RampZone&quot; from &quot;Zone type&quot; drop down menu</li>
<li>Draw the ramp zone
<ul>
<li>The ramp zone should include only the ramp and the environment that is correctly seen when on the ramp. Typically, only the walls of the ramp can be used</li>
</ul>
</li>
<li>Insert the incline of the ramp
<ul>
<li>When inserted the measured incline percentage should be visible on the defined ramp zone</li>
</ul>
</li>
<li>Repeat steps e.-f. for each new ramp.</li>
</ol>
</li>
</ol>
<p><img src="Localization/RampZones/./media-en/image4.png" alt="" /></p>
<ol start="3">
<li>Upload the Tools project to the system</li>
<li>Optionally tune Navitrol parameters
<ol>
<li>I,corr_conf_max_dist_ramp_area, 10.0
<ul>
<li>Scales the position confidence based on speed and given maximum distance.</li>
<li>It takes roughly the parameter number of meters to fully apply position confidence.</li>
<li>Default value of 10.0 meters should work in most cases but if the ramp is very long and has very little static environment and the AGV loses position while driving on the ramp the value can be increased.</li>
</ul>
</li>
</ol>
</li>
<li>All ready!</li>
</ol>
<h2 id="troubleshooting-23"><a class="header" href="#troubleshooting-23">Troubleshooting</a></h2>
<h3 id="agv-loses-position-inside-the-ramp-zone"><a class="header" href="#agv-loses-position-inside-the-ramp-zone">AGV loses position inside the ramp zone</a></h3>
<p>If there is very little static environment inside the ramp area and the ramp is longer than the value of <strong>corr_conf_max_dist_ramp_area</strong> parameter, it is possible that the position confidence decreases too much within the ramp.</p>
<p>If this happens increase the value of <strong>corr_conf_max_dist_ramp_area</strong> to match the length of the longest ramp on the project file.</p>
<h3 id="agv-loses-position-after-the-ramp-zone"><a class="header" href="#agv-loses-position-after-the-ramp-zone">AGV loses position after the ramp zone</a></h3>
<p>When on the ramp zone only scaled odometry is used to determine the length wise position of an AGV. If the odometry is untrustworthy or the incline percentage miscalculated the position error can increase during the ramp so much that when leaving the ramp zone, the position error has grown so large that the position is lost.</p>
<p>To fix this issue the odometry calibration and the incline percentage should be checked. It is also possible that the ramp on the environment does not have same horizontal length than in reality. In this case the incline percentage should be adjusted accordingly. For example, by decreasing the incline percentage, if the AGV position on the map after the ramp is further away than in reality.</p>
<p>Incline percentage can also be tried to adjust so that the scaling factor compensates for the odometry error.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gps-positioning"><a class="header" href="#gps-positioning">GPS Positioning</a></h1>
<p>Updated 11.06.2024</p>
<hr />
<h2 id="introduction-and-prerequisites"><a class="header" href="#introduction-and-prerequisites">Introduction and Prerequisites</a></h2>
<p>In outdoor environments where there is no environment for reliable positioning with laser scanners, Navitrol can localize by using GPS signals instead. GPS units are able to provide a cm-accuracy position and a sub-degree accuracy heading if RTK fix is provided by a nearby base station.</p>
<p>The following requirements must be fulfilled to use GPS localization with Navitrol.</p>
<h3 id="hardware-requirements"><a class="header" href="#hardware-requirements">Hardware Requirements</a></h3>
<p>Navitrol requires the following hardware for GPS positioning:</p>
<ul>
<li>Septentrio AsteRx SB ProDirect as GPS receiver or suitable replacement.</li>
</ul>
<p><strong>Note:</strong> It is required to have both main and auxiliary antennas.</p>
<ul>
<li>
<p>Septentrio AsteRx SB ProConnect as the base station. Details can be found in supplier webpage:
<a href="https://www.septentrio.com/en/products/gps/gnss-rugged-boxes">link</a></p>
</li>
<li>
<p>An external IMU supported by Navitrol. Please refer to &quot;Navitrol-IMU Support&quot; document for details.</p>
</li>
</ul>
<h3 id="physical-requirements"><a class="header" href="#physical-requirements">Physical Requirements</a></h3>
<p>To get an accurate heading from GPS receivers, the main and auxiliary antennas need to be as far away from each other as possible.
Furthermore, they need to be installed to the vehicle such that the line between them is either parallel or perpendicular to the driving direction of the vehicle. See Section 2 for a graphical representation.</p>
<p>For this reason, it is required to have sufficient space on the AGV to mount the antennas. Recommended distance is 1 meter, and the minimum distance is 70 cm. Please note that heading estimation performance will be worse as the distance gets shorter.</p>
<h3 id="software-requirements"><a class="header" href="#software-requirements">Software Requirements</a></h3>
<p>GPS positioning is built on the sensor fusion algorithm. Therefore, sensor fusion should be enabled and running for it to work. Please refer to following two documents for instructions:</p>
<ul>
<li>
<p>Navitrol - Sensor Fusion</p>
</li>
<li>
<p>Navitrol - IMU Support</p>
</li>
</ul>
<p>Furthermore, for environment generation when using GPS positioning, NavithorTools version 4.07.00 or higher needs to be used.</p>
<h2 id="configuring-the-gps-receiver"><a class="header" href="#configuring-the-gps-receiver">Configuring the GPS Receiver</a></h2>
<p>Follow the instructions in this section to configure the GPS receiver.
Most of the section contains references directly to Septentrio material.</p>
<p><strong>Step 1:</strong> Define static IP addresses for both the base station and rover unit. Instructions are available here:
<a href="https://customersupport.septentrio.com/s/article/How-to-configure-a-static-IP-address-on-my-receiver">link</a></p>
<p>Note down the address of the receiver, as it is needed in Navitrol parameters later.</p>
<p><strong>Step 2:</strong> Define the RTK correction stream from base station to rover. Instructions are available here:
<a href="https://youtu.be/UVUVXpA8rB4">link</a></p>
<p><strong>Step 3:</strong> Define an NMEA output stream from the rover.
The stream should contain RBP and HRP messages and have 50 milliseconds sending interval. Instructions are available here (video title is mosaic receiver, but configuration is the same): <a href="https://youtu.be/ArtePkC58-o">youtu.be/ArtePkC58-o</a></p>
<p>Note down the port number of the stream, which will be needed in Navitrol parameters later on.</p>
<p><strong>Step 4:</strong> After installing the two antennas on the AGV, define the heading offset according to antenna position. To do this, go to GNSS -&gt; Attitude -&gt; Heading offset in the web interface.</p>
<p>In the Figure below, graphical examples can be found. In all figures, the top side is the front of the AGV.</p>
<p><img src="Localization/GpsPositioning/./media-en/image3.png" alt="" /></p>
<h2 id="configuring-the-navitrol-parameters"><a class="header" href="#configuring-the-navitrol-parameters">Configuring the Navitrol Parameters</a></h2>
<p>Navitrol parameters related to GPS navigation are presented in this section, with recommended values.</p>
<h3 id="agv-specific-gps-parameters"><a class="header" href="#agv-specific-gps-parameters">AGV Specific GPS Parameters</a></h3>
<p>These parameters will have different values according to configuration.
Therefore, they should be set separately for each AGV.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>S,gps_receiver_ip, 192.168.0.0</td><td>IP address of the gps receiver</td></tr>
<tr><td>I,gps_receiver_port, 0</td><td>Ethernet port number of the NMEA stream</td></tr>
</tbody></table>
<p>Set the above two parameters according to IP address and port number defined in Section 2.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>F,gps_main_antenna_offset_x, 0.000</td><td>X position of main antenna in the vehicle frame</td></tr>
<tr><td>F,gps_main_antenna_offset_y, 0.000</td><td>Y position of main antenna in the vehicle frame</td></tr>
<tr><td>F,gps_main_antenna_offset_z, 0.000</td><td>Z position of main antenna in the vehicle frame</td></tr>
</tbody></table>
<p>For the offset parameters above, x and y axes are defined in the vehicle frame. For example, please see the figure below:</p>
<p><img src="Localization/GpsPositioning/./media-en/image4.PNG" alt="" /></p>
<p>In such a configuration, the y offset parameter would be positive, and x offset parameter would be negative. The offset in z direction is equal to the vertical distance between the antenna and the vehicle axis.</p>
<h3 id="generic-gps-parameters"><a class="header" href="#generic-gps-parameters">Generic GPS Parameters</a></h3>
<p>These parameters should be configured only once. Ideally, same set of parameters will work in all situations, but they might be tuned for better performance.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I, gps_receiver_type, 1</td><td>GPS receiver to be used in localization:<br>0 - Disable GPS based localization<br>1 - Septentrio AsteRxProDirect.</td></tr>
<tr><td>I, gps_teach_enabled, 1</td><td>Use the GPS data for teach files:<br>0 - No<br>1 - Yes.</td></tr>
<tr><td>I, gps_teach_interval_ms, 5000</td><td>Save GPS poses with this interval when teaching.</td></tr>
<tr><td>I, gps_initialize_posion, 1</td><td>Enable position initialization from GPS:<br>0 - No<br>1- Yes.</td></tr>
<tr><td>I, gps_disable_laser_corr, 1</td><td>Disable laser updates in sensor fusion when gps fix is available:<br>0 - Apply laser corrections<br>1 - Prevent laser corrections.</td></tr>
<tr><td>I, gps_disabled_area_mode, 0</td><td>How GPS behaves in the GPS disabled areas:<br>0 - Completely disable GPS<br>1 - Use GPS position but not heading.</td></tr>
<tr><td>I, sf_gps_limit_corr, 1</td><td>Filter the maximum gps correction in each cycle:<br>0 - Don't limit<br>1 - Limit.</td></tr>
<tr><td>F sf_gps_h_max_corr_deg, 0.3</td><td>Maximum heading correction per cycle by gps in degrees.<br>Recommended to have same value as loc_h_max_corr_deg.<br>Only used if sf_gps_limit_corr is 1.</td></tr>
<tr><td>F, sf_gps_xy_max_corr, 0.01</td><td>Maximum xy correction per cycle by gps in meters.<br>Recommended to have same value as loc_xy_max_corr.<br>Only used if sf_gps_limit_corr is 1</td></tr>
</tbody></table>
<p><strong>Note:</strong> If the gps_teach_enabled parameter is set to 1 as above, the AGV will initialize the position when the following conditions are all set:</p>
<ul>
<li>
<p>Position is not already initialized.</p>
</li>
<li>
<p>Position is not being actively requested to initialize, such as setting the position from Navitrol Monitor.</p>
</li>
<li>
<p>RTK fix is available from the GPS receiver.</p>
</li>
</ul>
<p>It is recommended to set this parameter to 1, so that position initialization is possible outside of the laser navigation area as well.</p>
<h3 id="other-navitrol-parameters"><a class="header" href="#other-navitrol-parameters">Other Navitrol Parameters</a></h3>
<p>Parameters in this group are not directly related to GPS and in many cases already exist in your parameters file. They should be verified to have the correct settings before GPS navigation is used.</p>
<ul>
<li>
<p>All parameters related to sensor fusion and IMU. Please see the relevant documents for more details.</p>
</li>
<li>
<p>I, teach_file_format, 5 # Format of the saved teach files. GPS navigation only works with format 5 and higher.</p>
</li>
</ul>
<h2 id="using-gps-positioning"><a class="header" href="#using-gps-positioning">Using GPS Positioning</a></h2>
<p>Once the parameters are correctly set, using GPS positioning is very similar to laser scanner-based navigation with Navitrol. The AGV will localize with GPS signals whenever an RTK fix is available, and automatically switch to scanner, IMU and odometry based localization when it is not. Follow the steps below to localize with the GPS positioning.</p>
<h3 id="teaching-the-environment"><a class="header" href="#teaching-the-environment">Teaching the Environment</a></h3>
<p>Teaching with GPS works the same as teaching with laser scanners. Start Navitrol, ensure that WARNING_NO_GPS_FIX warning is not set, and teach the environment as usual.</p>
<h3 id="matching-environment-to-gps-coordinates"><a class="header" href="#matching-environment-to-gps-coordinates">Matching Environment to GPS coordinates</a></h3>
<p>The GPS coordinates will be automatically included in the teach file.
Import the teach file to NavithorTools as usual. In the matching phase, recorded GPS points should be matched to the laser scanner points, such that they give the same position and heading output when the AGV is at the same location. Detailed instructions can be found in the &quot;Navithor Tools User Instructions&quot; document's &quot;Correct Global Coordinates&quot; chapter. For most of the cases, clicking the &quot;Correct Global Coordinates&quot; button is enough to do the matching. The matching can be verified by checking that the base station is approximately at the origin of the resulting map, and the top side of the map corresponds to North.</p>
<h3 id="environment-and-route-generation"><a class="header" href="#environment-and-route-generation">Environment and Route Generation</a></h3>
<p>Generating routes and environment points with GPS navigation has no difference from usual.</p>
<h3 id="defining-gps-disabled-zones"><a class="header" href="#defining-gps-disabled-zones">Defining GPS Disabled Zones</a></h3>
<p>If desired, it is possible to define zones in Navithor Tools where GPS is disabled. In such zones, GPS signals will not be used even if high quality RTK fix is available. This is mostly beneficial for cases where there is a stable environment around the AGV such that laser scanner can provide a reliable navigation, such as for docking. Please refer to
Navithor Tools User Instructions for defining them.</p>
<h3 id="localization-in-the-environment"><a class="header" href="#localization-in-the-environment">Localization in the Environment</a></h3>
<p>Once the environment is uploaded to Navitrol, the following data will be utilized for localization.</p>
<p><strong>AGV within GPS Disabled Zone:</strong></p>
<ul>
<li>
<p>GPS data will always be ignored by default. It is possible to change this behavior so that the position from gps will still be utilized but the heading will be ignored by changing &quot;gps_disabled_area_mode&quot; parameter to 1.</p>
</li>
<li>
<p>If laser scanner is matching an environment, it will be used to position the AGV.</p>
</li>
<li>
<p>If there is no stable environment, localization will be performed by fusion of IMU and odometry for some distance (defined by sf_conf_max_dist parameter) before AGV stops.</p>
</li>
</ul>
<p><strong>AGV outside of GPS Disabled Zone:</strong></p>
<ul>
<li>
<p>If GPS data is available with RTK fix, it will be used for localization.</p>
</li>
<li>
<p>Positioning from the laser scanner will be ignored when GPS with RTK fix is available.</p>
</li>
<li>
<p>If GPS with RTK fix is not available, but the laser scanner is matching an environment, it will be used to position the AGV.</p>
</li>
<li>
<p>If there is neither GPS signal nor stable environment available, localization will be performed by fusion of IMU and odometry for some distance (defined by sf_conf_max_dist parameter) before AGV stops.</p>
</li>
</ul>
<h2 id="errors-and-troubleshooting"><a class="header" href="#errors-and-troubleshooting">Errors and Troubleshooting</a></h2>
<p>Navitrol has two possible errors that are raised when using GPS positioning, to indicate there are unexpected problems. This section explains possible causes and instructions to fix them.</p>
<p><strong>ERROR_GPS_NO_CONNECTION</strong></p>
<p>This error is raised when there is no connection between Navitrol and GPS receiver. Possible causes include:</p>
<ul>
<li>
<p>IP address or port number of the GPS receiver does not match the one in parameters.</p>
</li>
<li>
<p>Ethernet cable between Navitrol IPC and receiver is not properly connected.</p>
</li>
</ul>
<p><strong>WARNING_NO_GPS_FIX</strong></p>
<p>This warning is raised when there is no RTK fix received by the GPS receiver. Possible causes are below:</p>
<ul>
<li>
<p>RTK fix is not available in the receiver side. Make sure the web interface of the receiver indicates the positioning mode is &quot;RTK fixed&quot;. If it is anything else (RTK Float, differential, standalone), this indicates the problem is not related to Navitrol, but RTK fix is not available in the first place. Here are possible fixes:</p>
<ul>
<li>
<p>First, please check that &quot;corrections&quot; icon is indicating the corrections are correctly being sent from base station and received by the receiver. This video shows it in more detail <a href="https://youtu.be/UVUVXpA8rB4">youtu.be/UVUVXpA8rB4</a>. If the corrections are not available, try moving the AGV into a more open position and make sure the signal quality indicated on the front page are high.</p>
</li>
<li>
<p>If the GPS signal quality indicator is high, corrections are being received, there is no interference, but the mode is still not RTK fixed, one solution is to wait for a while. The very first time may take up to 15 minutes until RTK fixes become available (only once, not on subsequent startups).</p>
</li>
</ul>
</li>
<li>
<p>If RTK fix is available on the receiver side but Navitrol is still raising this warning, these are the possible causes:</p>
<ul>
<li>
<p>Main antenna has high quality signals but the auxiliary antenna does not, so only position corrections are received but not heading ones. This can be verified by checking that both antennas have high signal quality from the main page of the receiver web interface.</p>
</li>
<li>
<p>NMEA stream is not properly defined, so Navitrol is not receiving the stream. Check the stream includes both RBP and HRP messages. Also, make sure that no other stream is defined using the same port number. In addition, make sure that the stream is visible when Navitrol is running on the front page of the web interface, in the &quot;Data Streams&quot; section.</p>
</li>
<li>
<p>Sometimes a power cycle is needed to restore the stream. So try restarting the receiver and Navitrol if the above does not work.</p>
</li>
</ul>
</li>
</ul>
<p>If you encounter an issue not listed here or the above solutions did not solve your problem, please take a log and contact Navitec Systems.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="imu-and-sensor-fusion"><a class="header" href="#imu-and-sensor-fusion">IMU and Sensor Fusion</a></h1>
<p>Updated 19.03.2024</p>
<hr />
<h2 id="sensor-fusion-and-use-cases"><a class="header" href="#sensor-fusion-and-use-cases">Sensor Fusion and Use Cases</a></h2>
<p>Sensor fusion is a localization method that localizes the AGV with combined measurements from different sensors. The current implementation supports using laser scanners, encoders (odometry), external localization and IMU data (accelerometer and gyroscope). An Extended Kalman Filter is used as the sensor fusion method, which activates after
position is initialized.</p>
<p>Using sensor fusion is beneficial for the following use cases:</p>
<ul>
<li>
<p>Heading estimation will be improved, as the IMU can provide more accurate angular velocity than encoders. This is especially beneficial if you are experiencing a lot of heading corrections and oscillations.</p>
</li>
<li>
<p>It will be possible to navigate outside of the static environment for short distances with fused location estimates from odometry and IMU.</p>
</li>
<li>
<p>Navigation performance will be improved in worse environments with small amount of environment points. This is because the initial estimate of heading will be better, so that smaller corrections will be sufficient.</p>
</li>
<li>
<p>If the environment consists of inclined surfaces or ramps, the tilt angle will be estimated and compensated.</p>
</li>
<li>
<p>An online bias compensation for IMUs that does not depend on magnetic conditions is included, which provides more reliable estimation than using IMU without sensor fusion.</p>
</li>
</ul>
<p>Sensor fusion does NOT help with the following:</p>
<ul>
<li>
<p>Position initialization.</p>
</li>
<li>
<p>Calibration of encoders or scanners.</p>
</li>
<li>
<p>Any errors coming from incorrect calibration, such as driving axle being off or scaling errors.</p>
</li>
</ul>
<p>Instructions on how to configure and use sensor fusion with a supported IMU model are presented in Chapter 3. It is also possible to use the IMU as a standalone device without enabling sensor fusion, for which instructions are available in Chapter 4.</p>
<h2 id="supported-imu-models"><a class="header" href="#supported-imu-models">Supported IMU Models</a></h2>
<p>Please see the following table for supported IMU models and
corresponding interfaces for each model.</p>
<table><thead><tr><th>IMU Model</th><th>USB Interface</th><th>CAN Interface</th><th>Serial (RS232) Interface</th></tr></thead><tbody>
<tr><td>LPMS-CU2</td><td><strong>Yes</strong></td><td><strong>Yes</strong></td><td>No</td></tr>
<tr><td>LPMS-URS2</td><td><strong>Yes</strong></td><td>No</td><td><strong>Yes</strong></td></tr>
<tr><td>LPMS-IG1</td><td><strong>Yes</strong></td><td><strong>Yes</strong></td><td>No</td></tr>
<tr><td>LPMS-CU3</td><td><strong>Yes</strong></td><td><strong>Yes</strong></td><td>No</td></tr>
<tr><td>LPMS-URS3</td><td><strong>Yes</strong></td><td>No</td><td><strong>Yes</strong></td></tr>
</tbody></table>
<h2 id="using-imu-with-sensor-fusion"><a class="header" href="#using-imu-with-sensor-fusion">Using IMU With Sensor Fusion</a></h2>
<p>To use sensor fusion, the first step is to configure the IMU. If you have received a pre-configured IMU from Navitec Systems, please skip Chapter 3.1 and start from Chapter 3.2.</p>
<h3 id="configuring-the-imu"><a class="header" href="#configuring-the-imu">Configuring the IMU</a></h3>
<p>Please follow the instructions in this chapter depending on the IMU model you have.</p>
<h3 id="lpms-cu2-and-urs2-models"><a class="header" href="#lpms-cu2-and-urs2-models">LPMS-CU2 and URS2 Models</a></h3>
<p>Download and install OpenMAT software from the manufacturer's website, from the following link: <a href="https://lp-research.atlassian.net/wiki/spaces/LKB/pages/1138294814/LPMS+Data+Acquisition+Software">lp-research.atlassian.net/LPMS-Data-Acquisition-Software</a></p>
<p>Upon installation, launch the LpmsControl software on your computer, then follow these steps:</p>
<ol>
<li>
<p>Connect the LPMS device using USB interface to your PC</p>
</li>
<li>
<p>In LpmsControl, add new device to device list by following these steps:</p>
<p>a. Click the plus icon</p>
<p>b. Click &quot;Scan Devices&quot;. If nothing is found select &quot;Scan system serial ports (only for LPMS-UART)&quot; and try &quot;Scan Devices&quot; again.</p>
<p>c. Click &quot;Add Device&quot; after a device has been found</p>
<p>d. Click &quot;Save Devices&quot;, your device should be visible now in the Preferred Devices section.</p>
<p>e. On the main menu, click the lightning symbol to connect to IMU</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image3.PNG" alt="" /></p>
</li>
<li>
<p>Change all parameters according to screenshots (see next pages for basic settings)</p>
</li>
</ol>
<p><strong>Basic settings for both serial LPMS-URS2 and CAN device LPMS-CU2</strong></p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image4.PNG" alt="" /></p>
<p><strong>Additional settings for CAN device LPMS-CU2 (when using CAN
interface)</strong></p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image5.png" alt="Table Description automatically generated" /></p>
<ol start="4">
<li>Select &quot;Save parameters to sensor&quot; in Calibration menu (see picture below)</li>
</ol>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image6.png" alt="" /></p>
<ol start="5">
<li>
<p>Perform a manual calibration of the sensor. To do this, make sure the IMU is not moving, is on a horizontal surface, and is not tilted. From the same &quot;Calibration&quot; tab as the screenshot above, click &quot;Calibrate gyroscope&quot;.</p>
</li>
<li>
<p>Disconnect the IMU by clicking the cross button.</p>
</li>
</ol>
<p>After these steps are completed, you can disconnect the IMU from the computer, and it is ready to be mounted on the AGV.</p>
<h3 id="lpms-ig1-model"><a class="header" href="#lpms-ig1-model">LPMS-IG1 Model</a></h3>
<p>Download and install IG1-Control software from the manufacturer's website, from the following link: <a href="https://lp-research.com/support/">lp-research.com/support</a></p>
<p>Upon installation, launch the IG1Control software on your computer, then follow these steps:</p>
<ul>
<li>
<p>Connect the device to your computer to a free USB port.</p>
</li>
<li>
<p>Locate the COM port number of the device. This can be done by going to Device Manager in Windows and choosing &quot;Ports&quot;. In the list, look for the &quot;USB to UART Bridge&quot; port, for example in the screenshot below, it is COM8.</p>
</li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image7.PNG" alt="" /></p>
<ul>
<li>In IG1 Control, click the refresh button next to the sensor list so the connected sensor appears in the list. Then, choose the correct COM port and click &quot;connect&quot;.</li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image8.PNG" alt="" /></p>
<ul>
<li>Once connected, you should see some data coming from the sensor on the right side. From the bottom tabs, click &quot;Sensor&quot; and set the settings as shown in the following two screenshots:</li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image9.PNG" alt="" /></p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image10.PNG" alt="" /></p>
<ul>
<li>After all settings are set, click &quot;Save&quot;. Then, from the top tabs click &quot;Settings&quot; and choose &quot;Save parameters to sensor&quot;.</li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image11.PNG" alt="" /></p>
<ul>
<li>Finally, choose the &quot;Calibration&quot; tab, and click &quot;Calibrate Gyro&quot;.
Make sure the IMU is stationary at this point and is on a horizontal and stationary surface.</li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image12.PNG" alt="" /></p>
<ul>
<li>After gyroscope calibration is finished, disconnect the IMU in the IG1 control software. Then, you can disconnect it from the USB port and the gyroscope is ready to be mounted on an AGV.</li>
</ul>
<h3 id="lpms-cu3urs3"><a class="header" href="#lpms-cu3urs3">LPMS-CU3/URS3</a></h3>
<p>Download the LPMSControl2 from the following link: <a href="https://lp-research.atlassian.net/wiki/spaces/LKB/pages/1138294814/LPMS+Data+Acquisition+Software">lp-research.atlassian.net/LPMS-Data-Acquisition-Software</a>.
Select the self-contained zip-file. Run LpmsControl2.exe.</p>
<p>The general options to be selected for the LPMS CU3 and LPMS URS3 are visible in the figure below. The Sensor parameters section is accessible from the bottom left by going to the Sensor-tab. </p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/general_CU3_options.png" alt="" /></p>
<ul>
<li>Set the baudrate to 921600 bps for USB</li>
<li>Set the baudrate to 115200 bps for Serial (only URS3) </li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/CU3_USB.png" alt="" /></p>
<ul>
<li>The CANOpen options are shown in the figure below (only CU3)</li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/CU3_CANOpen.png" alt="" /></p>
<ul>
<li>Click Apply and Settings→Save parameters to sensor</li>
</ul>
<h3 id="installing-imu-on-the-agv"><a class="header" href="#installing-imu-on-the-agv">Installing IMU on the AGV</a></h3>
<p>Once the IMU is configured, it should be mounted rigidly on the AGV. It can be mounted as desired, but the recommendation is to align the IMU with the vehicle so that there is no tilt with respect to vehicle, i.e. no roll and pitch deviation. The IMU turning rate is used for heading estimation. In the context of 2D estimation, the yaw angle, i.e. the rotation around the Z-axis, does not affect estimation, as the turn rate is the same regardless. For the optimal performance, try to find a spot with a good suspension in order to minimize shaking while navigating. Finally, add the IMU
installation parameters to the params.txt, according to how the IMU is mounted with respect to the AGV navigation point. Two examples of such parameters are explained below.</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>An example IMU mounting.</p>
</blockquote>
<p>In the above Figure, the AGV navigation point is in the middle. The x-axis points to the vehicle's forward direction and the y-axis points to the vehicle's left direction by default. In this case, the IMU is mounted on the place indicated by a blue box, 42 cm in the positive x direction and 25 cm in negative y direction. It is aligned with the vehicle, so that the positive x direction of the IMU also points to the vehicle's forward direction. In this case, the IMU mounting parameters should be entered as below:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>F,sf_imu_mounting_x_angle_deg, 0.000</td><td>IMU installation angle around vehicle x axis in degrees</td></tr>
<tr><td>F,sf_imu_mounting_y_angle_deg, 0.000</td><td>IMU installation angle around vehicle y axis in degrees</td></tr>
<tr><td>F,sf_imu_mounting_z_angle_deg, 0.000</td><td>IMU installation angle around vehicle z axis in degrees</td></tr>
<tr><td>F,sf_imu_mounting_x_pos, 0.420</td><td>IMU installation position in x axis</td></tr>
<tr><td>F,sf_imu_mounting_y_pos, -0.250</td><td>IMU installation position in y axis</td></tr>
<tr><td>F,sf_imu_mounting_z_pos, 0.000</td><td>IMU installation position in z axis</td></tr>
</tbody></table>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image14.png" alt="" /></p>
<blockquote>
<p>An alternative IMU mounting example.</p>
</blockquote>
<p>In the example above, the IMU is instead placed 15 cm in positive x direction and 8 cm in positive y direction. Also, the IMU is flipped 180 degrees around vehicle's z axis, so that the x axis of the IMU is pointing towards the back of the vehicle. In this case, the correct parameters would be as follows:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>F,sf_imu_mounting_x_angle_deg, 0.000</td><td>IMU installation angle around vehicle x axis in degrees</td></tr>
<tr><td>F,sf_imu_mounting_y_angle_deg, 0.000</td><td>IMU installation angle around vehicle y axis in degrees</td></tr>
<tr><td>F,sf_imu_mounting_z_angle_deg, 180.000</td><td>IMU installation angle around vehicle z axis in degrees</td></tr>
<tr><td>F,sf_imu_mounting_x_pos, 0.150</td><td>IMU installation position in x axis</td></tr>
<tr><td>F,sf_imu_mounting_y_pos, 0.080</td><td>IMU installation position in y axis</td></tr>
<tr><td>F,sf_imu_mounting_z_pos, 0.000</td><td>IMU installation position in z axis</td></tr>
</tbody></table>
<p>If the IMU is mounted such that there is a tilt, please see Appendix 1 for an explanation of how to determine the correct parameters.</p>
<h3 id="sensor-fusion-charts"><a class="header" href="#sensor-fusion-charts">Sensor fusion charts</a></h3>
<p>This sections describes how to interpret sensor fusion charts, and how to perform any required troubleshooting. The charts are visible from Charts → Sensor Fusion Orientations and Charts → Sensor Fusion Corrections in Navitrol Monitor.</p>
<h4 id="orientation"><a class="header" href="#orientation">Orientation</a></h4>
<p>If <strong>sf_imu_mode</strong> is set to 1, the most important charts are the yaw and yaw rate. The yaw describes the heading, and yaw rate the angular velocity for the heading. It has to be noted that odometry and IMU do not need to match perfectly, depending on how noisy the odometry data is.</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/sensor_fusion_orientations_driving.png" alt="" /></p>
<blockquote>
<p>Correct sensor fusion orientations</p>
</blockquote>
<p>In the above Figure, the IMU, Fusion and odometry curves are matching for the yaw rate chart.</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/sensor_fusion_orientations_imu_upside_down.png" alt="" /></p>
<blockquote>
<p>Incorrect sensor fusion orientations - mounted upside-down</p>
</blockquote>
<p>In the above Figure, the IMU is mounted upside-down resulting in opposite signs for the IMU and odometry. </p>
<h4 id="corrections"><a class="header" href="#corrections">Corrections</a></h4>
<p><img src="Localization/ImuAndSensorFusion/./media-en/sensor_fusion_corrections.png" alt="" /></p>
<blockquote>
<p>Correct sensor fusion corrections</p>
</blockquote>
<p>The applied corrections are not limited by much for the laser, meaning the red and blue curves more or less coincide, in the above Figure. The corrections are small and are not cumulating only in one direction.</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/sensor_fusion_corrections_imu_upside_down.png" alt="" /></p>
<blockquote>
<p>Incorrect sensor fusion corrections - mounted upside-down</p>
</blockquote>
<p>The applied corrections are substantially smaller than the laser corrections, in the above Figure. The X and Y corrections are almost constantly deviating from zero. The AGV loses position and such the individual scan quality decreases significantly as time progresses.</p>
<h3 id="setting-up-imu-parameters-in-navitrol"><a class="header" href="#setting-up-imu-parameters-in-navitrol">Setting Up IMU Parameters in Navitrol</a></h3>
<p>In Navitrol parameters file, please set the following parameters:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,imu_type, X</td><td>0 - no IMU<br>1 - LPMS-CU2/URS2 USB<br>2 - LPMS-URS2 serial<br>3 - LPMS-CU2 CANOpen<br>4 - LPMS-IG1 USB <br>5 - LPMS-IG1 CANOpen<br>6 - LPMS-CU3/URS3 USB<br>7 - LPMS-CU3 CANOpen<br>8 - LPMS-URS3 serial<br>Replace X with correct model.</td></tr>
<tr><td>I,imu_id, 1</td><td>In case of CAN IMU, this is CAN node id (LPMS settings IMU ID)</td></tr>
<tr><td>S,imu_serial_port, /dev/ttyUSB0</td><td>Serial port to be used for IMU communication.<br>This might be different if more USB devices are connected.</td></tr>
<tr><td>I,imu_lpms_data_size, 1</td><td>LPMS USB/serial data element size:<br>0 - 16 bit data<br>1 - 32 bit data</td></tr>
</tbody></table>
<h3 id="setting-up-sensor-fusion-parameters"><a class="header" href="#setting-up-sensor-fusion-parameters">Setting Up Sensor Fusion Parameters</a></h3>
<p>There are many additional parameters that are used with sensor fusion, which can be fine-tuned for maximum performance. Depending on how you want to use the IMU, below are 3 parameter set options that have been tested to perform well. If you are experiencing unexpected behavior or low localization performance, please contact Navitec Systems for advice on how to tune the parameters for your use case.</p>
<p><strong>Option 1: Gyroscope only</strong></p>
<p>Use the following parameter set if you would like to use only the gyroscope from the IMU and perform only a 2D orientation estimation. This is the recommended sensor fusion setup for non-GPS applications.
This is for instance beneficial if the odometry heading is not reliable.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,sf_use_sensor_fusion, 1</td><td>Use sensor fusion instead of only laser localization.<br>0 = NO<br>1 = YES</td></tr>
<tr><td>I,sf_imu_mode, 1</td><td>IMU usage mode:<br>0 - Don't use<br>1 - Only gyro<br>2 - 2D gyro and acc<br>3 - 3D gyro and acc<br>4 - Full 3D estimation</td></tr>
<tr><td>I,sf_laser_quality_mode, 2</td><td>Choose mode of laser quality:<br>0 - Disregard laser quality<br>1 - Apply quality scale to x and y<br>2 - Apply quality scale to x, y heading</td></tr>
<tr><td>I,sf_laser_quality_scale, 10</td><td>How much quality should affect the filtering.<br>Between 10 and 100, higher number means scan quality affects the corrections more.</td></tr>
<tr><td>F,sf_odom_wz_std_deg, 100.0000</td><td>Standard deviation of Wh of odom R matrix</td></tr>
</tbody></table>
<p><strong>Option 2: 3D estimation</strong></p>
<p>Use the following parameter set if you would like to use a 3D orientation estimation with a combination of gyroscope and accelerometers. This is beneficial if the operating environment includes slopes or tilted surfaces, or in applications where AGV tilt is important, such as GPS positioning.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,sf_use_sensor_fusion, 1</td><td>Use sensor fusion instead of only laser localization. 0 = NO, 1 = YES</td></tr>
<tr><td>I,sf_imu_mode, 3</td><td>IMU usage mode<br>0 - Dont use<br>1 - Only gyro<br>2 - 2D gyro and acc<br>3 - 3D gyro and acc<br>4 - Full 3D estimation</td></tr>
<tr><td>I,sf_laser_quality_mode, 2</td><td>Choose mode of laser quality<br>0 - Disregard laser quality<br>1- Apply quality scale to x and y<br>2 - Apply quality scale to x, y heading</td></tr>
<tr><td>I,sf_laser_quality_scale, 10</td><td>How much quality should affect the filtering. Between 10 and 100, higher number means scan quality affects the corrections more.</td></tr>
<tr><td>F,sf_odom_wz_std_deg, 100.0000</td><td>Standard deviation of Wh of odom R matrix</td></tr>
<tr><td>I,sf_linear_acc_comp_for_tilt, 0</td><td>Whether IMU mode 3 should compensate for linear accelerations when calculating tilt. 0 is better for inclined environments, 1 is better for high accel drives. 0 = No, 1 = Yes</td></tr>
<tr><td>F,sf_imu_roll_deg, 10.000</td><td>Standard deviation of roll measurement of imu R matrix</td></tr>
<tr><td>F,sf_imu_pitch_deg, 10.000</td><td>Standard deviation of pitch measurement of imu R matrix</td></tr>
</tbody></table>
<p><strong>Option 3: 3D estimation alternative</strong></p>
<p>If you are expecting drives with very high accelerations, the following parameter set compensates better for it, in the expense of slower reaction speed on ramps.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,sf_use_sensor_fusion, 1</td><td>Use sensor fusion instead of only laser localization.<br>0 = NO<br>1 = YES</td></tr>
<tr><td>I,sf_imu_mode, 3</td><td>IMU usage mode:<br>0 - Dont use<br>1 - Only gyro<br>2 - 2D gyro and acc<br>3 - 3D gyro and acc<br>4 - Full 3D estimation</td></tr>
<tr><td>I,sf_laser_quality_mode, 2</td><td>Choose mode of laser quality:<br>0 - Disregard laser quality<br>1- Apply quality scale to x and y<br>2 - Apply quality scale to x, y heading</td></tr>
<tr><td>I,sf_laser_quality_scale, 10</td><td>How much quality should affect the filtering. Between 10 and 100, higher number means scan quality affects the corrections more.</td></tr>
<tr><td>F,sf_odom_wz_std_deg, 100.0000</td><td>Standard deviation of Wh of odom R matrix</td></tr>
<tr><td>I,sf_linear_acc_comp_for_tilt 1</td><td>Whether IMU mode 3 should compensate for linear accelerations when calculating tilt. 0 is better for inclined environments, 1 is better for high accel drives.<br>0 = No<br>1 = Yes</td></tr>
<tr><td>F,sf_imu_roll_deg, 2.000</td><td>Standard deviation of roll measurement of imu R matrix</td></tr>
<tr><td>F,sf_imu_pitch_deg, 2.000</td><td>Standard deviation of pitch measurement of imu R matrix</td></tr>
</tbody></table>
<p><strong>Additional Option: Noisy gyroscope data</strong></p>
<p>Uneven terrain or similar reasons may cause the IMU data to be exceptionally noisy. This can be alleviated by adding the following parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>F,sf_imu_wx_std_deg, 1.3300</td><td>Standard deviation of wx of imu R matrix</td></tr>
<tr><td>F,sf_imu_wy_std_deg, 1.3300</td><td>Standard deviation of wy of imu R matrix</td></tr>
<tr><td>F,sf_imu_wz_std_deg, 0.3300</td><td>Standard deviation of wz of imu R matrix</td></tr>
</tbody></table>
<p>Please note that this is not a comprehensive list of possible parameters for tuning sensor fusion, but instead a recommended starting point for a functional system. Many additional parameters can be tuned and changed in the final navigation environment for maximum performance. In case of any performance issues, please contact Navitec Systems so these parameters can be fine-tuned.</p>
<h3 id="bias-calibration"><a class="header" href="#bias-calibration">Bias calibration</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,sf_gyro_bias_mode, 1</td><td>Mode of estimating gyroscope bias:<br>0 = With filter<br>1 = With filter and recalibrate when stationary<br>2 = Only recalibration when stationary</td></tr>
<tr><td>F,sf_gyro_max_turnrate_recalib_deg_per_s, 0.5</td><td>The maximum gyroscope turnrate degrees per second to recalibrate bias. Should be a bit higher than the turnrates when AGV is standing still.</td></tr>
</tbody></table>
<h3 id="agv-stationary"><a class="header" href="#agv-stationary">AGV stationary</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>F,sf_stationary_max_speed_m_per_s, 0.01</td><td>The maximum odometry speed m/s to define AGV being stationary.</td></tr>
<tr><td>F,sf_stationary_max_turnrate_deg_per_s, 0.5</td><td>The maximum odometry turnrate degrees/s to define AGV being stationary.</td></tr>
</tbody></table>
<h3 id="disabling-incompatible-features"><a class="header" href="#disabling-incompatible-features">Disabling Incompatible Features</a></h3>
<p>Some optional features are incompatible with sensor fusion and should be set as below. These parameters should already exist in the parameter file, and can simply be changed as described:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,imu_dh_use, 0</td><td>Use IMU for dead reckoning:<br>0 - never use imu<br>1 - use imu dh as is<br>2 - use combination</td></tr>
<tr><td>I,loc_corr_when_stationary, 1</td><td>0 to disable position correction when odometry data indicates the vehicle isn't moving. Must be enabled with sensor fusion; min 0, max 1</td></tr>
</tbody></table>
<p>If the parameters do not exist yet, it is recommended to add them.</p>
<h3 id="position-confidence-with-sensor-fusion"><a class="header" href="#position-confidence-with-sensor-fusion">Position Confidence with Sensor Fusion</a></h3>
<p>When sensor fusion is in use, the position confidence of the AGV is calculated differently, as is allowed to drive for a time without any matching static environment.
Below are two figures illustrating the position confidence of the AGV when no static environment is seen.</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image19.PNG" alt="" /></p>
<blockquote>
<p>Position confidence when going outside of the static map without sensor fusion.</p>
</blockquote>
<p>In the figure above, sensor fusion was turned off. The AGV was matching with the static environment up to 12 second mark, and then lost the sight of it.
The position confidence therefore decreased rapidly and went down to zero.</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image20.PNG" alt="" /></p>
<blockquote>
<p>Position confidence when going outside of the static map with sensor fusion.</p>
</blockquote>
<p>By contrast, in the above figure sensor fusion feature is turned on.
When the AGV is out of the static environment, position confidence is decreased with a slope instead of immediately. How fast the confidence should drop in such a situation can be adjusted with the <strong>sf_conf_max_dist</strong> parameter.
The value describes approximately for how many meters the otherwise immediate loss of confidence is divided.
When this parameter is set to higher values, the confidence will decrease more slowly.
It can be set, for example, to 10 meters by defining it in the parameter file as below:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>F, sf_conf_max_dist, 10.0</td><td>The maximum travelled distance where xy pos conf drop will be fully reported</td></tr>
</tbody></table>
<p>For most use cases, the recommended value is between 5 to 10 meters. It can be lowered down as much as desired if a sharper response to matching environment is desired. Conversely, it can go up to 100 meters if such long distances are sensible. Such high values could be used for example for very large outdoor environments.</p>
<p>It should be noted that sensor fusion itself can never increase the confidence. It only prevents confidence from decreasing.
This means that if the AGV was never in a place with a good static environment, the confidence will stay low regardless of having sensor fusion on.</p>
<h2 id="using-imu-without-sensor-fusion"><a class="header" href="#using-imu-without-sensor-fusion">Using IMU Without Sensor Fusion</a></h2>
<p>It is also possible to use the CU2 and URS2 IMU models without enabling sensor fusion. In this mode, the values from the IMU will be used as dead reckoning values, either together with the wheel encoders or completely replacing them.</p>
<p>In this case, both IMU configuration and Navitrol parameters are different from the sensor fusion case, so please follow instructions in this chapter instead of the previous one.</p>
<h3 id="configuring-the-imu-1"><a class="header" href="#configuring-the-imu-1">Configuring the IMU</a></h3>
<p>Download and install OpenMAT software from the manufacturer's website, from the following link: <a href="https://lp-research.com/support/">lp-research.com/support</a></p>
<p>Upon installation, launch the LpmsControl software on your computer, then follow these steps:</p>
<ol>
<li>
<p>Connect LPMS device using USB interface to your PC</p>
</li>
<li>
<p>In LpmsControl, add new device to device list by following these steps:</p>
<p>a.  Click the plus icon</p>
<p>b.  Click &quot;Scan Devices&quot;</p>
<p>c.  Click &quot;Add Device&quot; after a device has been found</p>
<p>d.  Click &quot;Save Devices&quot;, your device should be visible now in the Preferred Devices section.</p>
<p>e.  On the main menu, click the lightning symbol to connect to IMU</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image3.PNG" alt="" /></p>
</li>
<li>
<p>Change all parameters according to screenshots (see next pages for basic settings)</p>
</li>
</ol>
<p><strong>Basic settings for both serial LPMS-URS2 and CAN device LPMS-CU2</strong></p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image21.png" alt="" /></p>
<p><strong>Additional settings for CAN device LPMS-CU2 (when using CAN interface)</strong></p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image5.png" alt="" /></p>
<ol start="4">
<li>Select &quot;Save parameters to sensor&quot; in Calibration menu (see pic below)</li>
</ol>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image6.png" alt="" /></p>
<ol start="5">
<li>
<p>Perform a manual calibration on the sensor. To do this, make sure the IMU is not moving, is on a horizontal surface, and is not tilted. From the sane &quot;Calibration&quot; tab as the screenshot above, click &quot;Calibrate gyroscope&quot;.</p>
</li>
<li>
<p>Disconnect the IMU by clicking the cross button.</p>
</li>
</ol>
<h4 id="notes-on-settings"><a class="header" href="#notes-on-settings">Notes on settings:</a></h4>
<p>In case of CAN sensor using CAN bus interface</p>
<ul>
<li>
<p>IMU ID is the CAN node id. It is most important that you pick &quot;free&quot; node ID for the sensor.</p>
</li>
<li>
<p>Settings in section &quot;Data&quot; are not relevant. (*)</p>
</li>
</ul>
<p>*<em>It is important to understand that if CAN device is connected using USB interface, then it is configured just like the serial interface device.</em></p>
<h4 id="connecting-the-lp-research-imu-to-navitrol-ipc"><a class="header" href="#connecting-the-lp-research-imu-to-navitrol-ipc">Connecting the LP research IMU to Navitrol IPC</a></h4>
<p>Connecting the IMU to IPC involves two things -- power supply and communication interface. There are several options for the supported models (LPMS-URS2, LPMS-CU2, LPMS-CU3).</p>
<h4 id="automatic-bias-calibration"><a class="header" href="#automatic-bias-calibration">Automatic bias calibration</a></h4>
<p>Estimates the gyroscope bias by calculating the average angular displacement at standstill. See section Bias calibration.</p>
<p>The bias is estimated at standstill to isolate the drift of the IMU. A reported turning rate of 0.1 degrees per second at standstill gives the bias. In the same scenario, a reported turning rate of 1 degree per second when the AGV is in motion, would mean the IMU is actually turning at 0.9 degrees per second. The bias is not a static value, and thus the bias must be continuously estimated.</p>
<h4 id="manual-calibration"><a class="header" href="#manual-calibration">Manual calibration</a></h4>
<p><em><strong>Gyroscope bias calibration</strong></em></p>
<p>To determine the bias value manually the following calibration procedure needs to be applied.</p>
<ol>
<li>
<p>Sensor shall be non-moving (preferably mounted on AGV and AGV not moving)</p>
</li>
<li>
<p>Use the &quot;Calibrate gyroscope&quot; function in LpmsControl software</p>
</li>
<li>
<p>The gyroscope calibration will take around 30s. After that the gyroscope is calibrated, normal operation can be resumed.</p>
</li>
</ol>
<p><em><strong>Magnetometer calibration</strong></em></p>
<p>See &quot;LPMS Reference Manual&quot; for the procedure.</p>
<h4 id="powering-the-lpms"><a class="header" href="#powering-the-lpms">Powering the LPMS</a></h4>
<p>Both models have two options</p>
<ul>
<li>
<p>Powering using the USB interface</p>
</li>
<li>
<p>Powering through D9 connector (see the LPMS quick start quide for detailed infromation)</p>
</li>
</ul>
<h4 id="communication-connection-to-lpms"><a class="header" href="#communication-connection-to-lpms">Communication connection to LPMS</a></h4>
<p>Both models can be connected to Navitrol IPC using USB for communication and that is the easiest way for a serial model (URS2) -- having both powering and communication over USB.</p>
<p>Serial/USB communication does however have issues not affecting CAN.
Therefore CAN model should be connected to CAN bus for communication whenever possible even if the power would be supplied over USB.</p>
<h3 id="setting-up-imu-parameters-in-navitrol-1"><a class="header" href="#setting-up-imu-parameters-in-navitrol-1">Setting Up IMU Parameters in Navitrol</a></h3>
<p>Navitrol uses the following parameters to set the IMU:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,imu_type, 0</td><td>0 - no IMU<br>1 - LPMS-CU2/URS2 USB<br>2 - LPMS-URS2 serial<br>3 - LPMS-CU2 CANOpen<br>4 - LPMS-IG1 USB <br>5 - LPMS-IG1 CANOpen<br>6 - LPMS-CU3 USB<br>7 -LPMS-CU3 CANOpen.</td></tr>
</tbody></table>
<ul>
<li>
<p>In order to disable IMU interface completely, set to 0</p>
</li>
<li>
<p>Specific IMU type and interface used</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,imu_id, 1</td><td>In case of CAN IMU, this is CAN node id (LPMS settings IMU ID)</td></tr>
</tbody></table>
<ul>
<li>
<p>Numeric ID of the IMU (not relevant in all cases)</p>
</li>
<li>
<p>In case of CAN device, this is the node ID of IMU</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>S,imu_serial_port, /dev/ttyS0</td><td>Serial port to be used for IMU communication</td></tr>
</tbody></table>
<ul>
<li>Serial port in case of device using serial or USB interface</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,imu_dh_use, 0</td><td>Use IMU for dead reckoning:<br>0 - never use imu<br>1 - use imu dh as is<br>2 - use combination</td></tr>
</tbody></table>
<ul>
<li>
<p>In order to disable use of IMU data in positioning set to 0</p>
</li>
<li>
<p>Set to 1 for trusting IMU only in all cases</p>
</li>
<li>
<p>Set to 2 for using IMU data conditionally (see parameters below)</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>I,imu_disable_after_in_standstill_ms, 0</td><td>Disable IMU usage after given time (ms) standing still, 0 = never disable based on movement</td></tr>
<tr><td>I,log_imu, 0</td><td>enable detailed logging for IMU<br>0 - disable<br>1 - log details &amp; parsed data<br>2 - log details, parsed &amp; raw data</td></tr>
</tbody></table>
<ul>
<li>As the comment says, this is used to enable detailed logging for IMU
interface (use for troubleshooting only)</li>
</ul>
<table><thead><tr><th>Parameter</th></tr></thead><tbody>
<tr><td>F,imu_deg_p_sec_diff_max, 1000.0</td></tr>
</tbody></table>
<ul>
<li>
<p>Effective only if imu_dh_use == 2</p>
</li>
<li>
<p>If angular rate from two sources (odometry &amp; IMU) differ more than
this limit, then IMU is used</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th></tr></thead><tbody>
<tr><td>F,imu_deg_p_sec_lo, 1000.0</td></tr>
</tbody></table>
<ul>
<li>
<p>Effective only if imu_dh_use == 2</p>
</li>
<li>
<p>See graph below for details</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th></tr></thead><tbody>
<tr><td>F,imu_deg_p_sec_hi, 1000.0</td></tr>
</tbody></table>
<ul>
<li>
<p>Effective only if imu_dh_use == 2</p>
</li>
<li>
<p>See graph below for details</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th></tr></thead><tbody>
<tr><td>F,imu_gain_lo, 0.0</td></tr>
</tbody></table>
<ul>
<li>
<p>Effective only if imu_dh_use == 2</p>
</li>
<li>
<p>See graph below for details</p>
</li>
</ul>
<table><thead><tr><th>Parameter</th></tr></thead><tbody>
<tr><td>F,imu_gain_hi, 0.0</td></tr>
</tbody></table>
<ul>
<li>
<p>Effective only if imu_dh_use == 2</p>
</li>
<li>
<p>See graph below for details</p>
</li>
</ul>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image22.png" alt="" /></p>
<p>IMU_GAIN in the figure has a value in range of 0.0 -- 1.0, 1.0 meaning that for turning we trust IMU alone.</p>
<ul>
<li>
<p>Red curve shows this gain using the four lo/hi parameters.</p>
</li>
<li>
<p>Green curve shows the gain using imu_deg_p_sec_diff_max</p>
</li>
</ul>
<p>IMU_GAIN related parameters should be evaluated case by case, both the IMU model and the application having an effect on them. All, especially low cost, gyros and IMU's have some noise/drift, that introduces some heading change even if the AGV is not moving. The localization can be disabled at standstill by parameter sf_loc_at_standstill_enabled. This heading change is corrected using laser measurements, but still it might be advisable in such cases to &quot;disable&quot; use of IMU/gyro, when it sees no movement. A starting point for these parameters could be for example:</p>
<table><thead><tr><th>Parameter</th></tr></thead><tbody>
<tr><td>F,imu_deg_p_sec_diff_max, 3.0</td></tr>
<tr><td>F,imu_deg_p_sec_lo, 2.0</td></tr>
<tr><td>F,imu_deg_p_sec_hi, 5.0</td></tr>
<tr><td>F,imu_gain_lo, 0.0</td></tr>
<tr><td>F,imu_gain_hi, 1.0</td></tr>
<tr><td>I,sf_loc_at_standstill_enabled, 0</td></tr>
</tbody></table>
<h2 id="navitrol-errors"><a class="header" href="#navitrol-errors">Navitrol Errors</a></h2>
<p>Navitrol can generate an ERROR or a WARNING if there is a problem with IMU:</p>
<ul>
<li>
<p>If either sensor fusion is in use with the IMU, or the parameter imu_dh_use has value 1, <strong>Error 825 ERROR_IMU_FAILURE is set</strong></p>
</li>
<li>
<p>Otherwise, <strong>warning 924 WARNING_IMU_FAILURE is set</strong></p>
</li>
</ul>
<p>This error/warning indicates that IMU interface does not get acceptable data from IMU, possible reasons being</p>
<ul>
<li>
<p>No communication at all</p>
</li>
<li>
<p>Communication timeout</p>
</li>
<li>
<p>Data received is not acceptable (serial interface devices)</p>
</li>
</ul>
<p>Things to check in general</p>
<ul>
<li>
<p>Check IMU configuration</p>
</li>
<li>
<p>Check that IMU is powered and connected properly</p>
</li>
</ul>
<p>Things to check if you use serial/USB interface</p>
<ul>
<li>
<p>Check Navitrol communication parameters</p>
</li>
<li>
<p>Check serial port used (in case of USB, this may change from restart to restart if there are multiple USB devices with same kind of profiles attached)</p>
</li>
</ul>
<p>Things to check if you use CAN interface</p>
<ul>
<li>
<p>Check Navitrol communication parameters</p>
</li>
<li>
<p>Check IMU CAN settings (bitrate, id)</p>
</li>
<li>
<p>Check that CAN communication works otherwise</p>
</li>
<li>
<p>Check the CAN bus status with CAN Analyzer.</p>
</li>
<li>
<p>Check for bus issues: CAN bus topology and termination, CAN wiring (HI/LO), grounding</p>
</li>
<li>
<p>Check for duplicate Node id's, nodes with different speeds, multiple masters, non CANOpen devices messing on bus.</p>
</li>
</ul>
<p>If you are experiencing issues and cannot find the reason, please take a log and contact Navitec Systems.</p>
<h2 id="troubleshooting-24"><a class="header" href="#troubleshooting-24">Troubleshooting</a></h2>
<h3 id="position-shifts-after-agv-standing-still-for-a-long-time"><a class="header" href="#position-shifts-after-agv-standing-still-for-a-long-time">Position shifts after AGV standing still for a long time</a></h3>
<p>In such a case, it is recommended to put parameter <strong>sf_gyro_bias_mode</strong> to 1. It will enable filtering gyroscope bias and recalibrate it when AGV is stationary. </p>
<h2 id="agv-rotates-when-standing-still"><a class="header" href="#agv-rotates-when-standing-still">AGV rotates when standing still</a></h2>
<p>The bias could have been calibrated to wrong value. Try to set <strong>sf_gyro_max_turnrate_recalib_deg_per_s</strong> to smaller value.</p>
<h2 id="appendix-1-mounting-the-imu-tilted"><a class="header" href="#appendix-1-mounting-the-imu-tilted">Appendix 1: Mounting the IMU Tilted</a></h2>
<p>A tilted IMU causes issues as the gravitational factor applied to the Z-axis, is partly also applied to either X- or Y-axes, which affects the motion estimation. The correct way to align the coordinate frames of IMU and the vehicle is to go from vehicle frame to AGV frame in Z-Y-X order. Here is an example:</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image23.png" alt="" /></p>
<p>In the picture, AGV axes is red while IMU axes are blue. The first step
is to rotate the AGV around its z axis. In this example, rotation of -90
degrees would align the x axis of both, so it becomes like below:</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image24.png" alt="" /></p>
<p>Now if we rotate around the new x axis for 90 degrees, they align as below:</p>
<p><img src="Localization/ImuAndSensorFusion/./media-en/image25.png" alt="" /></p>
<p>Since we made a rotation around z by -90 and then around x by 90, the correct parameters in this case are:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>F,sf_imu_mounting_x_angle_deg, 90.000000</td><td>IMU installation angle around vehicle x axis</td></tr>
<tr><td>F,sf_imu_mounting_y_angle_deg, 0.000000</td><td>IMU installation angle around vehicle y axis</td></tr>
<tr><td>F,sf_imu_mounting_z_angle_deg, -90.000000</td><td>IMU installation angle around vehicle z axis</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="external-localization"><a class="header" href="#external-localization">External localization</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="positioning-and-docking"><a class="header" href="#positioning-and-docking">Positioning and docking</a></h2>
<h3 id="introduction-25"><a class="header" href="#introduction-25">Introduction</a></h3>
<p>External localization feature introduces positioning on data matrix lines using a camera-based system. It can be used for locating vehicle's position on areas where laser scanners cannot be used. The feature also provides accurate docking since the cameras can provide sub millimeter X,Y position on the data matrix.</p>
<p>The system works so that camera(s) read absolute position from the data matrix tape. Then, using coordinate transformations, the position of the vehicle is located on the map, thus avoiding the need for natural feature positioning with laser scanners. Vehicle will correct its position to the center of data matrix line and simultaneously correct
its heading to be aligned with the line. The stopping point is determined by the given end position on the route, the same way as in normal navigation.</p>
<p>Hardware requirements for the feature include Position Guided Vision sensor(s) and Data matrix code tape from Pepperl+Fuchs. Navitrol can read data directly from sensors using CAN Open. For other type of sensors, the customer is required to read the data from the sensors and send the data to Navitrol via Ethernet TCP/IP connection (see Appendix).</p>
<h3 id="teaching-of-data-matrix-lines-into-a-map"><a class="header" href="#teaching-of-data-matrix-lines-into-a-map">Teaching of data matrix lines into a map</a></h3>
<p>There are multiple reasons why data matrix lines are needed in the global map.</p>
<ul>
<li>
<p>Enable localization of the vehicle based on the camera measurements.</p>
</li>
<li>
<p>Determine when the vehicle should start and stop using the data matrix positioning.</p>
</li>
<li>
<p>Detecting error situations when the camera is unable to read measurements from the line.</p>
</li>
<li>
<p>Driving offsets can be added to individual lines in Navithor Tools.</p>
</li>
</ul>
<h3 id="storing-line-positions"><a class="header" href="#storing-line-positions">Storing line positions</a></h3>
<p>Teaching of a data matrix line is done by driving over the line in teaching mode and storing the position of the line into the teach data at certain intervals. Positions that are needed to teach are the start point and end point of the line, but sometimes also the points where it is planned that an AGV can enter or leave the line for easier drawing of the routes.</p>
<p>The most convenient way to teach these points is to do it manually, i.e., a position is saved by pushing the <strong>Save Pos</strong> button on the teaching interface (See Figure 1). This results in a convenient number of taught points in the teach file. Manual saving is selected by setting the <strong>ext_loc_teach_mode</strong> parameter to 2. There are also two options
for automatically saving the points. If mode 1 is selected, a time interval for saving is defined in parameter <strong>ext_loc_teach_interval_ms.</strong> If mode 3 is selected, a distance interval for saving is defined in parameter <strong>ext_loc_teach_interval_dist</strong> (see external localization parameters in section 1.4).</p>
<p><img src="Localization/ExternalLocalization/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1: Web interface screen</p>
</blockquote>
<p><strong>Observe!</strong></p>
<p>When teaching lines in big environments it is vital that the map is built from the same teach data as the line, because this guarantees the best accuracy between the line and the map. If a line is added to an old map from a new teach file it is very important that the new teach data is carefully shifted and rotated to accurately match the old map.
Otherwise, the scanner positioning and line positioning will not match, and it will be difficult to draw the routes accurately onto the line.</p>
<p>Before teaching it is important to calibrate the vehicle, so that all tapes are correctly aligned with the scanner environment. The calibration process is described in the end of this document.</p>
<p><strong>The teaching process</strong>:</p>
<ul>
<li>
<p>Start the teaching mode from the WEB interface</p>
</li>
<li>
<p>Drive through the environment that shall be taught</p>
</li>
<li>
<p>When coming to a data matrix line, drive the sensor indexed 0 in parameter file (ext_loc_x_offset[0] etc.) to the beginning of the line and stop. In this document we use front camera to denote the 0 indexed sensor.</p>
</li>
<li>
<p>Verify that the camera sees the line (green detection led on camera, or if the Monitor is used measurements from camera appear on the map starting with &quot;Ext0&quot;) and save the position by pushing the Save Pos button on the WEB interface</p>
</li>
<li>
<p>Continue along the line to the next line position to save (the vehicle does not need to follow the line accurately while driving, but the camera must detect the line when stopping to save the position). Stop the vehicle, verify that the camera detects the line and save the position.</p>
</li>
<li>
<p>Repeat driving to all desired line positions and save them</p>
</li>
<li>
<p>Save a final point at the end of the line (where the vehicles shall exit the line or stop to station)</p>
</li>
<li>
<p>Continue environment teaching until the desired part of the environment is taught</p>
</li>
<li>
<p>Turn off the teaching from the WEB interface</p>
</li>
</ul>
<p>The preferable way of teaching a data matrix line is in the normal driving direction and along growing distance values of the line.</p>
<h3 id="processing-the-teach-file-in-navithor-tools"><a class="header" href="#processing-the-teach-file-in-navithor-tools">Processing the teach file in Navithor Tools</a></h3>
<p>The data matrix line must be built into the scanned map by drawing the line according to the saved line positions. The saved line positions represent vehicle navigation points.
Positions are not directly usable as they are in the teach file since they are not recorded exactly at the center of the line. A specific position shifting tool is used to
transform the points as if the vehicle would be in an ideal position along the tape line at the saved point. This work is done in the following steps:</p>
<ul>
<li>
<p>Normal matching and finalizing of the teach data and generation of the map (see Figure 2)</p>
<ul>
<li>If a map is already built, it is not necessary to finalize this teach data but matching it to the existing map is still necessary</li>
</ul>
</li>
<li>
<p>Go to the External Localization tab (see Figure 3)</p>
</li>
<li>
<p>Select the first saved line point and push the Transform Point button</p>
</li>
<li>
<p>A transformation window opens, containing three sets of data:</p>
<ul>
<li>
<p>The camera position on tape when the point was saved</p>
</li>
<li>
<p>The position where the camera position should be shifted so that it's on the center of the line and aligned with the tape</p>
</li>
<li>
<p>The camera position on-board the vehicle (vehicle parameter values for reference)</p>
</li>
</ul>
</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2: Matching and finalizing the measurements</p>
</blockquote>
<p><img src="Localization/ExternalLocalization/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 3: External Localization tab (red arrow).</p>
</blockquote>
<ul>
<li>
<p>Set the target pose values according to the teaching situation: The X-value should be the same as in the saved pose because it is the tape position</p>
</li>
<li>
<p>The Y-value should be 0 so that the position is shifted to the middle of the tape (as if the camera would detect it ideally centered)</p>
</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 4: Transformation window for shifting the saved point data.</p>
</blockquote>
<ul>
<li>The heading shall be according to how the vehicle shall detect the tape when driving the route (see Figure 5 Cases 1-3).</li>
</ul>
<ol>
<li>
<p>If the AGV follows the tape longitudinally as it was taught into the map, the heading is the camera offset (-90 degrees in the example in Figure 6)</p>
</li>
<li>
<p>If the AGV follows the route in the opposite direction than it was taught into the map, the heading shall be the camera offset ±180</p>
</li>
<li>
<p>If the route shall be driven transversally, the heading shall be the camera offset ±90 degrees depending on which side of the tape the route shall be. When two tapes are used, transform the line points so that the route points between the tapes are transformed from the route on which the front camera shall be when driving the route. The route points of the other tape can be transformed with the same angle, making the transformed points outside the tapes. Only the point pair of the front camera is used for route generation, but both need to be transformed anyway.</p>
</li>
</ol>
<p><img src="Localization/ExternalLocalization/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 5: Transforming line points. Green point 1 is original saved position. Red point 1 is transformed saved position. Blue rectangles are the PGV camera positions.</p>
</blockquote>
<ul>
<li>When the values are set, push the <strong>Transform</strong> button in the Transformation window and close the window (see Figure 6 and Figure 7).</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image8.png" alt="" />
<img src="Localization/ExternalLocalization/./media-en/image9.png" alt="" /></p>
<ul>
<li>
<p>Transform all the saved line points in the same manner</p>
</li>
<li>
<p>Select Define Connection and combine start and end point of line to form the data matrix in to the map (see Figure 8). <strong>Note:</strong> Before NavithorTools v. 4.05.00 it is necessary to select first the line point with smaller X-value.</p>
</li>
<li>
<p>Select the Routes and Symbolic Points tab and draw the routes into the map.</p>
</li>
<li>
<p>Draw the route from point to point through all transformed line points, then add small straights at both ends to avoid affecting the line straightness by connecting curved segments to it (see Figure 9). The route needs to be straight for data matrix following.</p>
</li>
<li>
<p>Finally combine the line route to the rest of the route network.</p>
</li>
<li>
<p>When planning routes where cameras are along two different data matrix lines, the route needs to be marked with a route property tag Enable line docking along the entire data matrix line length. <strong>Need for tag will be obsolete from Navitrol 6.32 onwards</strong>.</p>
</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 8: Defining the connection between the shifted points to form the line into the map.</p>
</blockquote>
<p><img src="Localization/ExternalLocalization/./media-en/image11.png" alt="" /></p>
<blockquote>
<p>Figure 9: Drawing the route through the transformed line position points.</p>
</blockquote>
<p><strong>Note!</strong></p>
<p>If driving along two lines, it is important that the lengthwise coordinates of the lines match each other so that the heading of the machine is calculated correctly relative to the tapes from X-measurements (see Figure 10). If the vehicle is not driving in correct angle to the tapes, start point of one of the lines must be shifted lengthwise using the Transform Point function (see Figure 11). The start point is the saved point with a smaller data matrix X-value. The shifting is done to the start point by changing the X-value of the point. When driving along two lines, teach only the start and end positions of the line.</p>
<p><img src="Localization/ExternalLocalization/./media-en/image12.png" alt="" /></p>
<blockquote>
<p>Figure 10: If the tape position detections are not giving a correct angle of the vehicle the saved positions starting the tape must be shifted.</p>
</blockquote>
<p><img src="Localization/ExternalLocalization/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>Figure 11: Shifting of the saved start point of a tape. a) Saved point (red) before shifted forwards on data matrix tape b) Saved point after being shifted 22mm forwards (27.118-26.898 = 0.022). The starting points of both connections are now at the same level.</p>
</blockquote>
<h3 id="calibration-of-camera-positions"><a class="header" href="#calibration-of-camera-positions">Calibration of camera positions</a></h3>
<p>In external localization, the navigation controls the vehicle so that the cameras are as accurately as possible on a data matrix line. In the line following two things need to be calibrated.</p>
<ol>
<li>
<p>Parameters adjusting the reported position of the AGV relative to the map.</p>
</li>
<li>
<p>Parameters adjusting the AGV position relative to the line.</p>
</li>
</ol>
<p>The calibration is preferably done so that vehicle is standing with both cameras on the same tape and tape X-coordinates growing towards the front of vehicle.</p>
<h3 id="adjust-camera-positions-relative-to-machine"><a class="header" href="#adjust-camera-positions-relative-to-machine">Adjust camera positions relative to machine</a></h3>
<p>The position of the AGV's navigation point is prioritized to be calculated from the front camera detection, i.e. X-position on the tape and Y-offset from the tape centre line. These values are combined with the tape position in the map, which is defined by transformation points saved during teach-in of the environment and the data matrix tape. If
only rear camera is on tape, then it is used for localizing navigation position.</p>
<p>If only one camera is used for data matrix following, the angle detection of the camera is used to get the heading of the AGV. If two cameras are used, the heading is calculated from the front camera detection point and the rear camera detection point. The latter is much more precise since the point detections are more precise than the angle
resolution of the camera. However, heading accuracy will depend also on the calibration of the camera positions.</p>
<p>These parameters below represent the nominal positions of the cameras in meters which should be ideally equal in all the machines. Check that these parameters are valid before teaching any of the lines.</p>
<p>e.g. front camera:</p>
<p>ext_loc_x_offset[0] which is the X offset of the front camera from the navigation point to the sensor in machine coordinate system, positive forwards. Should be the full camera distance from navigation point in x-direction, which is easy to get from front and rear camera readings when both cameras are on the same tape.</p>
<p>ext_loc_y_offset[0] which is the Y offset of the front camera from the navigation point to the sensor in machine coordinate system, positive to the left. If one camera is used, this is the full camera distance from navigation point in y-direction, but when two cameras are used, they should be on the centre line and this value should be 0.</p>
<p>ext_loc_h_offset_deg[0] which is the heading offset between the machine coordinate system and the sensor coordinate system, positive CCW. Note that this is effective only when a single camera is detecting the line, since else the heading is calculated from front/rear camera positions.</p>
<p><strong>Note: From Navitrol 6.32 onwards, two cameras can be mounted also to the left and right side of navigation point.</strong></p>
<h3 id="calibrating-the-agv-position-relative-to-the-data-matrix-line"><a class="header" href="#calibrating-the-agv-position-relative-to-the-data-matrix-line">Calibrating the AGV position relative to the data matrix line</a></h3>
<p>In case the cameras are not accurately positioned to the nominal positions (ext_loc_*_offset parameters) on the AGV body the AGV will not drive completely aligned with the tape. To correct this, the transversal camera positions can be adjusted with a small offset so that the tape line is followed accurately. This is done using the below offset parameters:</p>
<p>pgv_y_offset[0] for the front camera. This offset is positive to the left of the tape, seen in the growing value direction of the tape.</p>
<p>pgv_y_offset[1] for the rear camera. This offset is positive to the left of the tape, seen in the growing value direction of the tape.</p>
<p>It is important to note, that offsets must be so small that there is not a risk that the camera loses the tape from its view. The reading area of the camera is typically around 3-5 cm from the center of tape.</p>
<p>Longitudinal offsets can be adjusted using parameters below:</p>
<p>pgv_x_offset[0] for the front camera. This offset is positive to the growing value of the tape, seen in the growing value direction of the tape.</p>
<p>pgv_x_offset[1] for the rear camera. This offset is positive to the growing value of the tape, seen in the growing value direction of the tape.</p>
<p>The heading of the cameras can be adjusted using parameters:</p>
<p>pgv_angle_offset_deg[0] for the front camera. Positive value rotates camera's measurement to clockwise direction. Note: Monitor shows camera's measurement so that positive is to counter-clockwise in machine coordinates.</p>
<p>pgv_angle_offset_deg[1] for the rear camera. Positive value is to clockwise direction.</p>
<p>These should be adjusted so that the tape measurement is 0 degrees when the tape is aligned with the vehicle and the tape values are growing in the forward direction of the AGV. Let ext_loc_h_offset_deg[] parameters to be zero if using pgv_angle_offset_deg[] parameters.</p>
<p>In Appendix section 3.2, proposed calibration method for omni vehicle with two PGVs is represented.</p>
<h3 id="when-to-adjust-line-position-on-map-and-when-to-calibrate-the-vehicle-parameters"><a class="header" href="#when-to-adjust-line-position-on-map-and-when-to-calibrate-the-vehicle-parameters">When to adjust line position on map and when to calibrate the vehicle parameters</a></h3>
<p>If the scanner points do not match to the environment when the vehicle comes to a line, check if this happens for the AGV that was used for teaching the line. If true, check that the camera parameters have been calibrated properly and try to reteach the line, carefully following the teaching process. When the AGV is positioning well, calibrate then the camera parameters for the rest of the AGVs so that each AGV's scanner measurements match equally to the map. <strong>Note:</strong> Laser scanner positions should be calibrated before calibrating camera parameters.</p>
<p>Following one line: If all vehicles are driving on the side of the route and the scanner measurements match with the map, the route shall be adjusted. If the tape is sidewise offset to the desired position, the tape can be adjusted in Tools by setting an offset to it (add offset in the transform window). Offsets must be small to keep the cameras above the tape.</p>
<p>Following two lines: If all AGVs are driving in a wrong angle to the route, the transformation points of the tapes shall be adjusted. If individual AGVs are driving with different angles to the tape, return to calibrations of the vehicles.</p>
<h3 id="parameters-for-external-localization-pgv-camera"><a class="header" href="#parameters-for-external-localization-pgv-camera">Parameters for External localization (PGV camera)</a></h3>
<table><thead><tr><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>int</td><td>teach_file_format</td><td>Only teach file format 5 enables to save line positions</td></tr>
<tr><td>int</td><td>ext_loc_enabled</td><td>External localization<br>0 = disabled<br>1 = enabled</td></tr>
<tr><td>int     ext_loc_teach_mode                            Teach mode<br>0 = pose not saved<br>1 = save pose with time interval<br>2 = save pose only when Save <strong>Pos</strong> is pressed (recommended)</td><td></td><td></td></tr>
<tr><td>int</td><td>ext_loc_teach_interval_ms</td><td>Interval for position storing of line position when automatic storing is selected (ext_loc_teach_mode is 1)</td></tr>
<tr><td>float</td><td>ext_loc_x_offset[0...3]</td><td>Nominal X offset from the navigation point to sensor in machine coordinate system, positive forwards</td></tr>
<tr><td>float</td><td>ext_loc_y_offset[0...3]</td><td>Nominal Y offset from the navigation point to sensor in machine coordinate system, positive to the left</td></tr>
<tr><td>float</td><td>ext_loc_h_offset_deg[0...3]</td><td>Nominal heading offset between machine coordinate system and sensor coordinate system, positive CCW</td></tr>
<tr><td>float</td><td>pgv_x_offset[0...3]</td><td>X-offset in meters from nominal position, only small correction values</td></tr>
<tr><td>float</td><td>pgv_y_offset[0...3]</td><td>Y-offset in meters from nominal position, only small correction values</td></tr>
<tr><td>float</td><td>pgv_angle_offset_deg[0...3]</td><td>Angle offset in degrees from nominal heading</td></tr>
<tr><td>float</td><td>ext_loc_dist_from_line</td><td>Distance from line when external localization is enabled</td></tr>
<tr><td>int</td><td>ext_loc_for_pos_ctrl_mode</td><td>External localization used directly for position control (e.g. in case of line following)<br>0 = disabled<br>1 = using only one sensor<br>2 = using two sensors when applicable<br>3 = require always two sensors (Navitrol 6.32 onwards)</td></tr>
<tr><td>int</td><td>ext_loc_pos_ctrl_dist_err_only</td><td>Position control option to use only distance error from line, when just one sensor is reading the data matrix. Intended for non-omni type vehicles that have sensor(s) outside of navigation point (Navitrol 6.32 onwards).</td></tr>
<tr><td>int</td><td>ext_loc_pos_ctrl_axis</td><td>Axis where the offset to the route is calculated:<br>0 = y-axis,1 = x-axis</td></tr>
<tr><td>int</td><td>ext_loc_pos_ctrl_max_h_err</td><td>Max heading error to continue line following</td></tr>
<tr><td>int</td><td>ext_loc_max_time_since_last_meas_ms</td><td>Maximum time in ms since last valid measurement when inside external localization area</td></tr>
<tr><td>float</td><td>ext_loc_max_dist_since_last_meas</td><td>Maximum travelled distance since last valid measurement when inside external localization area (Navitrol 6.32 onwards). Recommended to use this instead of ...time_since_last_meas_ms. Set 0 to disable one or the other.</td></tr>
<tr><td>float</td><td>ext_loc_heading_filt_alpha</td><td>Filtering gain for heading measurement from sensor (0.1 -- 1.0), default 1.0</td></tr>
<tr><td>int</td><td>ext_loc_pos_ctrl_only</td><td>Driving line following but not using data matrix for localization of the AGV</td></tr>
<tr><td>float</td><td>ext_loc_max_h_err_deg</td><td>Maximum heading difference between previous and newly calculated AGV heading. External localization pose is ignored if change is too much.</td></tr>
<tr><td>float</td><td>ext_loc_max_xy_err</td><td>Maximum difference between new and previous xy-position. External localization pose is ignored if change is too much. (Navitrol 6.32 onwards).</td></tr>
<tr><td>int</td><td>ext_loc_localize_without_pos_ctrl_checks</td><td>Option to keep localizing when position control sanity checks prevent use of data matrix for driving corrections (Navitrol 6.32 onwards).</td></tr>
<tr><td>float</td><td>ext_loc_pid_heading_p</td><td>Position control gain for heading when external localization is active<br>&lt;= 0.1 use normal pc_pid values&lt;br&gt;&gt; 0.1 use this parameter</td></tr>
<tr><td>float</td><td>ext_loc_pid_dist_p</td><td>Position control gain for distance when external localization is active<br>&lt;= 0.1 use normal pc_pid values&lt;br&gt;&gt; 0.1 use this parameter</td></tr>
<tr><td>int</td><td>ext_loc_stop_point_enabled</td><td>Stop point is given in data matrix coordinates for sensor (X-position) instead of driving to route end position.</td></tr>
<tr><td>float</td><td>ext_loc_stop_point</td><td>Stop point value for sensor (X-position)</td></tr>
<tr><td>float</td><td>ext_loc_check_path_ready_dist</td><td>Distance from stop point inside of which the stopping check starts. After drive is ready and before next stop can be checked, a measurement must be outside of this distance from stop value.</td></tr>
<tr><td><strong>Communication parameters</strong></td><td></td><td></td></tr>
<tr><td>uint</td><td>pgv_enabled</td><td>PGV sensor enabled (CAN only)</td></tr>
<tr><td>int</td><td>pgv_can_node_id[0...3]</td><td>CAN node ID of camera</td></tr>
<tr><td>int</td><td>pgv_model[0...3]</td><td>0 = default<br>1 = safePGV</td></tr>
<tr><td>int</td><td>pgv_max_missing_msg</td><td>Number of missing messages for error to be triggered (Ethernet only)</td></tr>
<tr><td>float</td><td>pgv_cam_res_x</td><td>The x-axis resolution of the PGV cameras in meters, default 0.0001</td></tr>
<tr><td>float</td><td>pgv_cam_res_y</td><td>The y-axis resolution of the PGV cameras in meters, default 0.0001</td></tr>
<tr><td>float</td><td>pgv_cam_res_h</td><td>The heading resolution (deg) of the PGV cameras, default 0.1</td></tr>
<tr><td>int</td><td>ext_loc_eth_model[0...3]</td><td>Linefollowing config for ethernet comms<br>-1 = disabled<br>0 = PGV (custom message)</td></tr>
<tr><td>int</td><td>ext_loc_eth_port[0...3]</td><td>Linefollowing port (5333)</td></tr>
<tr><td>int</td><td>ext_loc_eth_swap_bytes</td><td>0 = little endian<br>1 = big endian</td></tr>
<tr><td>int</td><td>ext_loc_eth_protocol</td><td>1 = Stream<br>2 = DGRAM</td></tr>
</tbody></table>
<p><strong>Example parameters to get started for two PGV (CAN Open) cameras</strong></p>
<table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody>
<tr><td>I,ext_loc_enabled,</td><td>1</td></tr>
<tr><td>I,ext_loc_teach_mode,</td><td>2</td></tr>
<tr><td>F,ext_loc_x_offset[0],</td><td>0.5</td></tr>
<tr><td>F,ext_loc_y_offset[0],</td><td>0.0</td></tr>
<tr><td>F,ext_loc_h_offset_deg[0],</td><td>0.0</td></tr>
<tr><td>F,ext_loc_x_offset[1],</td><td>-0.5</td></tr>
<tr><td>F,ext_loc_y_offset[1],</td><td>0.0</td></tr>
<tr><td>F,ext_loc_h_offset_deg[1],</td><td>0.0</td></tr>
<tr><td>F,ext_loc_dist_from_line,</td><td>0.05</td></tr>
<tr><td>I,ext_loc_for_pos_ctrl_mode,</td><td>2</td></tr>
<tr><td>F,ext_loc_heading_filt_alpha,</td><td>0.3</td></tr>
<tr><td>U, pgv_enabled,</td><td>1</td></tr>
<tr><td>I,pgv_can_node_id[0],</td><td>3</td></tr>
<tr><td>I,pgv_can_node_id[1],</td><td>4</td></tr>
<tr><td>F, pgv_x_offset[0],</td><td>0.0</td></tr>
<tr><td>F,pgv_y_offset[0],</td><td>0.0</td></tr>
<tr><td>F,pgv_x_offset[1],</td><td>0.0</td></tr>
<tr><td>F,pgv_y_offset[1],</td><td>0.0</td></tr>
<tr><td>F,pgv_angle_offset_deg[0],</td><td>90.0</td></tr>
<tr><td>F,pgv_angle_offset_deg[1],</td><td>-90.0</td></tr>
</tbody></table>
<h3 id="troubleshooting-25"><a class="header" href="#troubleshooting-25">Troubleshooting</a></h3>
<ul>
<li>
<p><em>External localization does not start even though PGV gets readings from the tape</em></p>
<ul>
<li>
<p>Check that you have properly transformed teach points and defined the connection in Navithor Tools.</p>
</li>
<li>
<p>Check that your camera parameters are correct. Typical issue is that heading of the camera is wrong and a sanity check rejects the measurement (ext_loc_max_h_err_deg).</p>
</li>
<li>
<p>From Navitrol 6.32 onwards there is a possibility to show the location of the data matrix on the map and PGV positions in Navitrol Monitor (see Figure 12). The position difference from the center of the line to the PGV can't differ more than distance defined by parameter ext_loc_dist_from_line.</p>
</li>
<li>
<p>Check that the camera parameters for the position and for the connection have the same index. In other words, the measurements come from the correct camera.</p>
</li>
</ul>
</li>
<li>
<p><em>ERROR_EXT_LOC_TOO_LONG_SINCE_MEASUREMENT is shown</em></p>
<ul>
<li>
<p>This means that based on AGVs position, the PGV should be able to read measurements from the data matrix but it is not. The distance which defines if the PGV should be able to read the data matrix is ext_loc_dist_from_line. This is the distance between the PGV's center position to the closest line point on the map. The Error is triggered after a timeout expires without getting valid measurements (ext_loc_max_time_since_last_meas_ms).
<strong>Note:</strong> From Navitrol 6.32 onwards it is recommended to use ext_loc_max_dist_since_last_meas instead of the timer to avoid situation when AGV stops at the edge of the start/end of tape, thus triggering error when AGV is not moving.</p>
</li>
<li>
<p>Check what is the reason for not receiving measurements from the PGV</p>
</li>
<li>
<p>To get AGV out of the error situation, move the AGV manually so that PGV is able to get measurements or move the AGV to route point that is far enough from the data matrix.</p>
</li>
<li>
<p>If the AGV stops just before or after the data matrix starts, this error might be triggered unwanted. Adjust ext_loc_dist_from_line to a smaller value to diminish these situations (e.g. 0.05). This parameter is also used as a search area to identify from which data matrix the PGV is getting measurements, so the value of the parameter cannot be arbitrarily small. <strong>Note:</strong> When using parameter ext_loc_max_dist_since_last_meas, ext_loc_dist_from_line can be left a bit higher value (e.g. 0.08) but set then ext_loc_max_dist_since_last_meas to a bigger value (e.g. 0.15).</p>
</li>
</ul>
</li>
<li>
<p><em>AGV position jumps when changing to external localization and scanners don't match to environment</em></p>
<ul>
<li>
<p>If this happens to the AGV that was used to teach the line, check that you followed the calibration and teaching process.
<strong>Note:</strong> In case the taught data matrix line is very short (less than a meter), the heading inaccuracies of the PGV sensors and other inaccuracies in the teaching process might generate a poor result. Try to get PGV sensors center point to be close to center of the line and aligned with the tape when saving the teach positions. The less it is needed to transform the points in Navithor Tools the better the result. It's also always better if the map in this area can be built from the same teach file that is used to teach the line positions.</p>
</li>
<li>
<p>If this happens to other AGVs, ensure first that you have calibrated the laser scanner positions. Then, calibrate the camera parameters (see section 1.3.2)</p>
</li>
</ul>
</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image14.png" alt="" /></p>
<blockquote>
<p>Figure 12: View external localization on Monitor. Grey line is data matrix and blue rectangle represents the PGV.</p>
</blockquote>
<h2 id="data-matrix-code-dmc-docking"><a class="header" href="#data-matrix-code-dmc-docking">Data Matrix Code (DMC) Docking</a></h2>
<h3 id="introduction-26"><a class="header" href="#introduction-26">Introduction</a></h3>
<p>In context of External localization, docking is a separate feature that requires its own license. The idea is to use the data matrix tape for line following only and leave out the positioning with the PGV camera.
This means that data matrices are not taught to the environment nor will their exact position on the map be known. Instead, symbolic points on the route network will hold the needed information about the data matrix lines.</p>
<p>In short, the AGV is given a drive order to a destination symbolic point which has data matrix information defined. When the AGV is close enough to the symbolic point and receives a valid measurement from the PGV camera, it goes to a docking state and uses from here on only the data matrix as a reference for the drive. The AGV will stop based on a predefined value on the data matrix tape. After it gets a drive order to leave the location, it will follow the data matrix tape until the sensor(s) stop receiving valid measurements from the tape.</p>
<p><strong>Feature is available from Navitrol 6.34 onwards.</strong></p>
<h3 id="configuration-2"><a class="header" href="#configuration-2">Configuration</a></h3>
<p>The DMC docking has following requirements for its configuration:</p>
<ul>
<li>The Data matrix tape must be placed so that data matrix X-values grow towards the symbolic point the AGV is driving to (See Figure 13).
<ul>
<li>This means that the stop point cannot be approached from both sides along the data matrix</li>
</ul>
</li>
<li>AGV can drive both forwards and reversing to the symbolic point. The route should be straight and without branches whenever the AGV is driving along the data matrix tape.
<ul>
<li>Only one heading per QR docking symbolic point is supported</li>
</ul>
</li>
<li>Symbolic point must have QR docking enabled. In addition, symbolic point must be placed so that it is close to the location that the AGV is needed to be stopped.</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image15.png" alt="" /></p>
<blockquote>
<p>Figure 13: Orientation of data matrix tape to the route</p>
</blockquote>
<p>There can be only one data matrix line that the AGV follows but there can be one or two PGVs used for driving. However, mainly the PGV camera that is 0-indexed in the parameter file will be used for stopping the AGV (ext_loc_x_offset[0] etc.). Only when the 0-indexed PGV camera is not on the tape, the other camera would be used for stopping the AGV.</p>
<p>In Navithor Tools, symbolic point should be filled with the data matrix tape information. These include the start point, end point and stop point (X-coordinate). Start and end point will determine the valid range for the PGV measurement when driving in or out of the symbolic point.
Stop point will naturally trigger stopping of the AGV. It is incorporated with stopping offsets (pc_stop_distance_offset &amp; ext_loc_stop_distance_offset) for targeting that PGV reading would be close to the stop point value at the end.</p>
<p>There can be also a driving offset defined for the symbolic point which will be activated when the AGV starts following the data matrix line.
Positive transversal offset will drive the AGV to the left side from the route heading. Positive frame heading offset will drive the AGV rotated to counter-clockwise direction. Offsets should be kept small.</p>
<p><img src="Localization/ExternalLocalization/./media-en/image16.PNG" alt="" /></p>
<blockquote>
<p>Figure 14: Docking configuration</p>
</blockquote>
<h3 id="logic-and-error-detection"><a class="header" href="#logic-and-error-detection">Logic and error detection</a></h3>
<h4 id="main-logic"><a class="header" href="#main-logic">Main logic</a></h4>
<p>When the AGV is approaching the symbolic point that has data matrix values defined, it will change the driving reference point from route to data matrix line as soon as following conditions are met:</p>
<ul>
<li>
<p>PGV X-measurement is between defined start and end point.</p>
</li>
<li>
<p>Distance between the AGV and symbolic point is less than data matrix length + PGV offset from navigation point (Euclidean distance) + small tolerance (0.1m)</p>
</li>
<li>
<p>Heading of the AGV relative to the tape is close enough to the target heading (parameter ext_loc_docking_max_h_err_deg).</p>
</li>
</ul>
<p>Once the AGV changes to follow data matrix line, it will not switch to follow route in the same drive order anymore.</p>
<p>The AGV starts to calculate when to stop after the PGV X-measurement is closer than &quot;Check path ready dist&quot; from the stop point value. Trigger to stop, as mentioned, is determined by the PGV X-measurement and stopping offsets.</p>
<p>After finishing the stop and executing possible tasks at the location, the AGV will be given a drive order away from the symbolic point. The AGV will be following the data matrix line until it stops receiving valid measurements from the PGV sensor(s) for small driven distance (ext_loc_strict_max_dist_since_last_meas).</p>
<h4 id="error-detection"><a class="header" href="#error-detection">Error detection</a></h4>
<p>As it is desired to drive to the data matrix stop point accurately, it will be constantly supervised that the AGV is receiving valid PGV measurements while approaching or leaving the symbolic points.</p>
<ol>
<li><strong>Approaching the symbolic point</strong></li>
</ol>
<ul>
<li>
<p>The AGV must get at least one valid PGV measurement before it is closer than &quot;Check path ready dist&quot; from symbolic point, otherwise error ERROR_EXT_LOC_NOT_SAFE_TO_DRIVE is triggered.</p>
</li>
<li>
<p>After getting first valid measurement and changing to data matrix line follow, it is checked that the AGV does not travel without valid measurement for more than ext_loc_max_dist_since_last_meas while outside &quot;Check path ready dist&quot; from the symbolic point.
ERROR_EXT_LOC_TOO_LONG_SINCE_MEASUREMENT.
<strong>Note:</strong> If AGV stops to this error at very start of data matrix line, it is likely that the heading validation has failed.</p>
</li>
<li>
<p>While inside &quot;Check path ready dist&quot; from symbolic point, a stricter limit is used ext_loc_strict_max_dist_since_last_meas.
ERROR_EXT_LOC_TOO_LONG_SINCE_MEASUREMENT</p>
</li>
</ul>
<ol start="2">
<li><strong>Leaving the symbolic point</strong></li>
</ol>
<ul>
<li>
<p>The AGV must get valid PGV measurements also when leaving the symbolic point while inside &quot;Check path ready dist&quot; from symbolic point. Parameter ext_loc_strict_max_dist_since_last_meas will be used for error detection.
ERROR_EXT_LOC_TOO_LONG_SINCE_MEASUREMENT</p>
</li>
<li>
<p>After the AGV is further than &quot;Check path ready dist&quot; distance from symbolic point, it will change to route following once there is no more valid PGV measurements for travelled distance of ext_loc_strict_max_dist_since_last_meas.</p>
</li>
</ul>
<ol start="3">
<li>
<p><strong>After software reboot</strong></p>
<ul>
<li>
<p>If the AGV is closer than &quot;Check path ready dist&quot; from the symbolic point that is target for a new drive order (or there is some other ambiguity from which direction the AGV is approaching the stop point), it will be checked whether the drive is ok to be ready.</p>
<p>i.  Drive is ready if PGV X-measurement is closer than ext_loc_path_ready_max_dist_err from the stop point.</p>
<p>ii. Error ERROR_EXT_LOC_NOT_SAFE_TO_DRIVE will be triggered if the first condition is not true</p>
</li>
</ul>
</li>
</ol>
<p><strong>Note!</strong>
Some of the errors are persistent. Put the AGV to Manual state and possibly drive away from the error location. Turn off the Manual state and wait for the error to be cleared.</p>
<h3 id="parameters-2"><a class="header" href="#parameters-2">Parameters</a></h3>
<p>Main parameter for enabling the feature is <strong>ext_loc_docking_enabled</strong>. Enabling the feature also requires a license (External Localization -- Docking). Other parameters that are required to be set are:</p>
<ul>
<li>
<p>ext_loc_stop_point_enabled, 1</p>
</li>
<li>
<p>ext_loc_max_dist_since_last_meas &gt; 0</p>
</li>
<li>
<p>ext_loc_strict_max_dist_since_last_meas &gt; 0</p>
</li>
</ul>
<p>List of docking related parameters can be seen in the table below:</p>
<table><thead><tr><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>Int</td><td>ext_loc_docking_enabled</td><td>Enable docking<br>0 = Disabled<br>1 = Enabled</td></tr>
<tr><td>Int</td><td>ext_loc_stop_point_enabled</td><td>Enable stop point<br>0 = Disabled<br>1 = Enabled</td></tr>
<tr><td>Float</td><td>ext_loc_max_dist_since_last_meas</td><td>Maximum distance in meters since last valid measurement when data matrix following is active but the AGV outside &quot;Check path ready dist&quot;</td></tr>
<tr><td>Float</td><td>ext_loc_strict_max_dist_since_last_meas</td><td>Maximum distance in meters since last valid measurement when data matrix following is active and the AGV inside &quot;Check path ready dist&quot;</td></tr>
<tr><td>Float</td><td>ext_loc_check_path_ready_dist</td><td>&quot;Check path ready dist&quot; is a multipurpose distance parameter. It is used in error detection. It is also used for starting to check when to stop the AGV.</td></tr>
<tr><td>Float</td><td>ext_loc_path_ready_max_dist_err</td><td>Max distance between PGV measurement and stop point to determine drive to be instantly ready at the start of new drive order.</td></tr>
<tr><td>Float</td><td>ext_loc_docking_max_h_err_deg</td><td>Maximum heading error to the target heading when data matrix line follow is active</td></tr>
<tr><td>Float</td><td>ext_loc_stop_distance_offset</td><td>Additional offset for stopping (pc_stop_distance_offset in general use) on data matrix. Positive value if the AGV stops too early.</td></tr>
<tr><td>Int</td><td>ext_loc_for_pos_ctrl_mode</td><td>Position control parameter<br>1 = use always only one PGV<br>2 = use two PGVs when applicable<br>3 = require always two PGVs</td></tr>
</tbody></table>
<p>Same PGV position and communication parameters are needed to be set as when using the positioning and line following feature ext_loc_enabled (see section 1.4). It is also necessary to calibrate the position of the PGV cameras to achieve accurate driving from the whole fleet of AGVs (see Chapter 1.3 and 3.2).</p>
<h2 id="appendix"><a class="header" href="#appendix">Appendix</a></h2>
<h3 id="ethernet-communication-protocol"><a class="header" href="#ethernet-communication-protocol">Ethernet communication protocol</a></h3>
<p>Navitrol can directly communicate with CAN Open PGVs. For all other type of PGVs, the customer is required first to read the data from the sensors and send the data to Navitrol via TCP/IP Ethernet connection.
Navitrol will act as a server and can be configured to receive data to STREAM sockets or DGRAM (UDP) sockets. UDP is recommended. The port is configurable with parameter (see section 1.4). Default port is 5333 and default byte order is little endian. The customer should send the message periodically, for example with 30ms interval.</p>
<table><thead><tr><th>Module</th><th>Content</th><th>Type</th><th>Byte count</th><th>Comments</th></tr></thead><tbody>
<tr><td></td><td>Counter</td><td>UINT32</td><td>0.0</td><td>Running number 0, 1, 2...</td></tr>
<tr><td>PGV_Module 2</td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td>Status ERR</td><td>UINT16</td><td>4.0</td><td>Error message present</td></tr>
<tr><td></td><td>Status NP</td><td>4.1</td><td>No position information/OUT</td><td></td></tr>
<tr><td></td><td>Status WRN</td><td>4.2</td><td>Warnings present</td><td></td></tr>
<tr><td></td><td>Status RES</td><td>4.3</td><td>Reserved</td><td></td></tr>
<tr><td></td><td>Position data Y</td><td>INT32</td><td>6.0</td><td>Default resolution 0.1mm</td></tr>
<tr><td></td><td>Angle data</td><td>UINT16</td><td>10.0</td><td>Default resolution 0.1 deg</td></tr>
<tr><td></td><td>Position data X</td><td>UINT32</td><td>12.0</td><td>Default resolution 0.1 mm</td></tr>
<tr><td></td><td>Speed</td><td>INT16</td><td>16.0</td><td>Default resolution 0.1 m/s</td></tr>
<tr><td></td><td>Position data Z</td><td>UINT16</td><td>18.0</td><td>Default resolution 1mm</td></tr>
<tr><td></td><td></td><td></td><td>20</td><td></td></tr>
</tbody></table>
<h3 id="proposed-calibration-method-for-vehicle-with-two-pgvs"><a class="header" href="#proposed-calibration-method-for-vehicle-with-two-pgvs">Proposed calibration method for vehicle with two PGVs</a></h3>
<h4 id="calibration-setup"><a class="header" href="#calibration-setup">Calibration setup</a></h4>
<ul>
<li>
<p>Attach a QR tape to the floor in a testing area, where calibration markers can be permanently attached to the floor for later use.</p>
</li>
<li>
<p>Teach-in the tape line and make a map in Tools.</p>
</li>
<li>
<p>Draw short routes with target symbolic points along the tape line, one forwards and the other reversing from the same direction. The route should be parallel to the tape at a distance of ext_loc_y_offset from the tape and the symbolic points should be on equal positions along the tape. One route on the tape is enough if the sensors are on the vehicle centre line.</p>
</li>
<li>
<p>Mark the route lines on the floor, i.e. lines parallel with the tape on a ext_loc_y_offset distance from the tape.</p>
</li>
<li>
<p>Mount laser pointers pointing towards the floor in both ends of the AGV. The laser points should be exactly on the centre line of the AGV -- or the tape line, i.e. the sensor line. They should also be lengthwise on equal distance from the vehicle navigation point, else the calibration will not work.</p>
</li>
</ul>
<p><strong>[NOTE]</strong>: Any inaccuracy in line marking, mounting the laser pointers and subsequent calibration evaluation all directly influence the final driving accuracy and equality between AGVs.</p>
<p><img src="Localization/ExternalLocalization/./media-en/image17.PNG" alt="" /></p>
<blockquote>
<p>Figure 15: Calibration setup. Green and red circles represent the laser scanners and green rectangles represent the PGV cameras.</p>
</blockquote>
<h4 id="calibration-sequence"><a class="header" href="#calibration-sequence">Calibration sequence</a></h4>
<ul>
<li>
<p>Give the AGV a forward's drive order to the symbolic point (Test drive fwd in Figure 16)</p>
</li>
<li>
<p>When the AGV stops at the symbolic point:</p>
<ul>
<li>
<p>Read the x-readings from both sensors and set initial pgv_x_offset values so that they form the correct distance between the sensors according to the equation below</p>
<p><em>x<sub>meas</sub>[0] - x<sub>meas</sub>[1] = ext_loc_offset[0] + pgv_x_offset[0] - ext_loc_offset[1] - pgv_x_offset[1] #(1)</em></p>
</li>
</ul>
</li>
<li>
<p>As an initial guess, set zero values to pgv_x_offset[0] and pgv_x_offset[1].</p>
</li>
<li>
<p>Measure how far sideways the laser points are from the marked route line (or QR tape) and adjust the pgv_y_offset values to align the vehicle with the line and side shift it onto the line.</p>
</li>
<li>
<p>Give the AGV a backwards drive order to the start of the test route and then a new drive order to the symbolic point.</p>
</li>
<li>
<p>When the AGV stops at the symbolic point:</p>
<ul>
<li>
<p>Measure how far the laser points are from the marked route line and re-adjust the pgv_y_offset values to align the vehicle with the route line and tape.</p>
</li>
<li>
<p>If the laser points are on equal distances from the line, adjust both pgv_y_offsets equally to side shift the vehicle to the line.</p>
</li>
</ul>
</li>
<li>
<p>Repeat the test drives until both laser points are on the route line.</p>
</li>
<li>
<p>When both laser points are on the line, mark the laser point positions on the floor with movable laser targets.</p>
</li>
</ul>
<p>At this stage the pgv_y_offsets should be correct, the pgv_x_offsets are only adjusted for correct distance between sensors according to Equation 1. Thus, longitudinally the sensors are on a correct distance from each other but may still need shifting relative to the vehicle navigation point.</p>
<p>Since vehicle position is calculated from the front sensor, the calibration must be done alternately forwards and backwards until the stopping point is the same in both directions.</p>
<ul>
<li>
<p>Turn the AGV 180 degrees, so that it now reverses to the symbolic point from the same direction as it previously drove forwards (Test drive rew, in Figure 16).</p>
</li>
<li>
<p>Give the AGV a backwards drive order to the symbolic point</p>
</li>
<li>
<p>When the AGV stops at the symbolic point:</p>
<ul>
<li>
<p>Verify that the laser points are on the marked route line, no adjustments to the pgv_y_offset should be necessary at this stage. Any transversal errors will depend on line setup inaccuracy, difference in vehicle control between forwards and reverse driving or other such reasons.</p>
</li>
<li>
<p>Measure how far the laser points are longitudinally from the laser targets and adjust both front and rear sensor pgv_x_offset by half of the error, keeping in mind the relation described in Equation 1 should still be valid, i.e. if pgv_x_offset[0] must be increased to stop earlier, the pgv_x_offset[1] must be reduced accordingly.</p>
</li>
</ul>
</li>
<li>
<p>Make a new test drive and mark the laser positions on the floor</p>
</li>
<li>
<p>Turn the vehicle 180 degrees and repeat the Test drive fwd.</p>
<ul>
<li>
<p>Verify that the laser points are on the marked route line.</p>
</li>
<li>
<p>Measure how far the laser points are longitudinally from the laser targets and adjust both front and rear sensor pgv_x_offset by half of the error, remembering that the relation in Equation 1 should still be valid.</p>
</li>
<li>
<p>If the laser points match with the laser targets, the parameter calibration is ready for repetitive verification drives alternating between forwards and backwards driving.</p>
</li>
</ul>
</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image18.PNG" alt="" /></p>
<blockquote>
<p>Figure 16: Calibration sequence</p>
</blockquote>
<p>Repeat this testing by adjusting the laser point markers and alternating between forwards and backwards driving until the laser points match with the laser targets in both forwards and backwards driving.</p>
<p>Finally, verify that the repetition accuracy at the laser points is less than the required accuracy in production, every time in both directions.
Mark the laser spots from several tests and make master targets from the mean results of the tests. These master targets shall be used in the calibration of all other AGVs in the fleet.</p>
<p><img src="Localization/ExternalLocalization/./media-en/image19.PNG" alt="" /></p>
<blockquote>
<p>Figure 17: Coordinates, parameters and readings. L = distance to laser target from stop position.</p>
</blockquote>
<p><img src="Localization/ExternalLocalization/./media-en/image20.png" alt="" /></p>
<blockquote>
<p>Figure 18: Calibration sequence visualized.</p>
</blockquote>
<h4 id="calibrating-next-agvs"><a class="header" href="#calibrating-next-agvs">Calibrating next AGVs</a></h4>
<p>Follow the calibration sequence of the first vehicle. In this calibration temporary movable laser targets can be used for the sake of the calibration sequence, but finally the calibration must result in accurate positioning to the original master targets from the first vehicle calibration. Otherwise, the vehicles will not drive accurately to the same position.</p>
<p>NOTE: Even though the calibration is done only in longitudinal driving, the calibration values are valid also in transversal driving. Calibration values should not be changed in any other case than in this calibration sequence.</p>
<p><strong>Longitudinal driving:</strong></p>
<ul>
<li>
<p>A transversal position error can be solved by adding a transversal offset to the line transformation of the tape in Navithor Tools.
This is naturally affecting the driving of all vehicles, so individual differences cannot be corrected. Currently, the transversal offset can be only used when approaching the stop point always from the same side. Positive offset will make the AGV drive to left of the route heading.</p>
</li>
<li>
<p>A heading error can be solved by adding a heading offset to the line transformation of the tape in Navithor Tools. Positive heading offset will make the AGV drive with a counter-clockwise heading offset.</p>
</li>
<li>
<p>If there are differences in position or heading between individual machines, the only means to correct the situation (except for recalibration) is to give drive orders with different transversal offsets to each machine.</p>
</li>
</ul>
<p><img src="Localization/ExternalLocalization/./media-en/image21.png" alt="" /></p>
<blockquote>
<p>Figure 19: Transversal offset</p>
</blockquote>
<ul>
<li>
<p>For longitudinal stop position errors, the route end must be corrected, since the navigation point position is calculated from the tape, but then compared to the route end.</p>
</li>
<li>
<p>If there are differences in longitudinal position between individual machines, the only means to correct the situation (except for recalibration) is to give drive orders with longitudinal offset.</p>
</li>
</ul>
<p><strong>Driving onto or away from a tape</strong></p>
<ul>
<li>Any transversal offset between the planned route and the actual line following trajectory causes a driving action to correct the offset when the tape line is entered or left. This is corrected by moving the route transversally to match the line once the line following has been finally adjusted.</li>
</ul>
<p><strong>Do not attempt to</strong></p>
<ul>
<li>
<p>Change the starting point of a tape by moving the transformation x-point value forwards. This works, but it can cause heading errors as it changes the x,y-relation in the tape line transformation.
Therefore, always set a teach point at a location where the line following shall be started.</p>
</li>
<li>
<p>Change the tape line angle by modifying the transformation y-point value.</p>
</li>
</ul>
<p><strong>Transversal driving</strong></p>
<p>If the sensors have been calibrated on the longitudinal line, and alignment and stopping behaviour are consistent in all directions, the calibration values should not be adjusted anymore. It is tempting to change calibrations if the transversal behaviour is incorrect, but it will only destroy the results of the structured calibration sequence.</p>
<p>NOTE: vehicle dependent line following behaviour cannot be calibrated separately for longitudinal and transversal driving!</p>
<p>In transversal driving the transversal error is calculated from the rear sensor position on the tape. The calculation utilizes positions from both front and rear sensor to get the heading of the machine and uses this heading and the ext_loc_x_offset[1] distance to calculate the vehicle navigation point relative to the rear sensor position.</p>
<p>This must be remembered when adjusting a vehicle to drive equally and stop at the same location irrespective of heading direction (vehicle heading +90° or -90 ° to the route).</p>
<p>The first thing to calibrate is the vehicle heading. If the vehicle heading is not perpendicular to the tapes, the transformation points of either tape must be adjusted along the tape direction. In the example Figure 20 the rear tape transformation must be shifted in +x direction or the front tape transformation in the --x direction. The calibration
is correct when the vehicle is in the same direction in both driving directions, i.e. driving with vehicle heading +90° or -90 ° to the route.</p>
<p><img src="Localization/ExternalLocalization/./media-en/image22.PNG" alt="" /></p>
<blockquote>
<p>Figure 20: Transform X-position of the start teach point to adjust heading.</p>
</blockquote>
<p>When the vehicle drives in a correct angle to the tapes, the transversal position of the vehicle can be calibrated. The reason for transversal difference when driving with the heading in different directions is that the position is calculated from the rear sensor as base point. If the tapes are not exactly on the correct distance from each other, this
distance difference will cause a position error. This is illustrated by X-diff in Figure 21.</p>
<p><img src="Localization/ExternalLocalization/./media-en/image23.PNG" alt="" /></p>
<blockquote>
<p>Figure 21: Transversal errors when driving with different orientations.</p>
</blockquote>
<p><strong>Also note</strong>, that PGV sensors must be on equal distance (within PGV offset calibration range) from the navigation point. Otherwise, the vehicle will not drive along the same line with heading in opposite directions.</p>
<ul>
<li>
<p>The transversal position error can be solved by adding a transversal offset to the line transformations of the tapes in Navithor Tools.
This is affecting the driving of all vehicles, so individual differences cannot be corrected.</p>
</li>
<li>
<p>If there are differences in transversal position between individual machines, the only means to correct the situation (except for recalibration) is to give drive orders with different transversal offset to each machine.</p>
</li>
<li>
<p>For longitudinal stop position errors, the route ends must be corrected since the navigation point position is compared to the route end. Since there are different routes for heading +90° and -90° the route ends must be moved longitudinally to match each other. They are correct when the vehicle stops equally in both directions (see Figure 22).</p>
</li>
<li>
<p>If there are differences in longitudinal position between individual machines, the only means to correct the situation (except for recalibration) is to give drive orders with longitudinal offset.</p>
</li>
</ul>
<p>NOTE: that the route stopping offset is not for adjusting the stopping position on individual routes as it acts equally on all stop situations.</p>
<p><img src="Localization/ExternalLocalization/./media-en/image24.PNG" alt="" /></p>
<blockquote>
<p>Figure 22: Stopping points for transversal driving.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="navitrol-dynamic-mapping-server-and-client"><a class="header" href="#navitrol-dynamic-mapping-server-and-client">Navitrol Dynamic Mapping Server and Client</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-14"><a class="header" href="#glossary-14">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Navigation software for an individual vehicle</td></tr>
<tr><td>NavitrolMonitor</td><td>Monitoring software for the Navitrol positioning software running an on individual vehicle</td></tr>
<tr><td>NavithorTools</td><td>Software for creating and editing environment and routes for the Navitrol navigation software</td></tr>
<tr><td>Dynamic Mapping Lite</td><td>Dynamic environment updating for an individual vehicle</td></tr>
<tr><td>Dynamic Mapping Full</td><td>Dynamic environment updating for a fleet of vehicles</td></tr>
<tr><td>Dynamic Mapping Server</td><td>A server where dynamic points from Dynamic Mapping Lite are gathered to be used in Dynamic Mapping Full</td></tr>
<tr><td>Dynamic Mapping Client</td><td>User interface software used to display and control Dynamic Mapping Server when running server</td></tr>
</tbody></table>
<hr />
<h2 id="dynamic-mapping-lite-1"><a class="header" href="#dynamic-mapping-lite-1">Dynamic Mapping Lite</a></h2>
<p>Dynamic Mapping Lite is a Navitrol feature that keeps a set of the most recent matched scanner measurements in memory and stores them as temporary environment points to be used for navigation.</p>
<h3 id="relevant-parameters-1"><a class="header" href="#relevant-parameters-1">Relevant Parameters</a></h3>
<ul>
<li>
<p><strong>I,dyn_map_lite_pos_corr, =</strong> 0 to disable, 1 to enable position correction based on dynamic mapping.</p>
</li>
<li>
<p><strong>I,dyn_map_lite_n_meas, =</strong> Has to be &gt; 0 for dynamic mapping to be enabled. Determines how many measurements to keep in dynamic map lite. Recommended value 50.</p>
</li>
<li>
<p><strong>I,dyn_map_lite_only_on_auto, =</strong> 1 to only update dynamic map when auto driving, 0 for all driving.</p>
</li>
<li>
<p><strong>F,dyn_map_lite_resolution, =</strong> Resolution of dynamic mapping points. Recommended value 0.02.</p>
</li>
<li>
<p><strong>F,dyn_map_lite_meas_interval_m, =</strong> Minimum distance in meters between measurements added to map. Recommended value 0.05.</p>
</li>
<li>
<p><strong>F,dyn_map_lite_meas_interval_deg, =</strong> Minimum heading difference in degrees between measurements added to map. Recommended value 10.</p>
</li>
<li>
<p><strong>F,dyn_map_lite_update_min_env_conf, =</strong> Minimum position confidence in percentages to update dynamic map.</p>
</li>
<li>
<p><strong>F,dyn_map_lite_wait_dist_after_pos_lost, =</strong> Distance in meters required to travel after position had been lost before starting to update dynamic map.</p>
</li>
<li>
<p><strong>I,dyn_map_lite_excluded_areas, =</strong> 1 to use dynamic mapping excluded areas and not add points within them, 0 to disable.</p>
</li>
<li>
<p><strong>F,corr_conf_dyn_map_lite_max_dist, =</strong> Determines in meters how fast position confidence drops once no static features are seen. Recommended 10 meters. Much larger values shouldn't be used as drift cumulates.</p>
</li>
<li>
<p><strong>F,dyn_map_pt_min_weight_logged, =</strong> Limit amount of dynamic points written to log and sent to the Monitor. Set minimum map weight for point to be included in the log. Recommended 0.0 - 0.2.</p>
</li>
<li>
<p><strong>I, dyn_map_lite_make_xy_corrs, =</strong> 1 to use the dynamic mapping confidence for xy gain if it is higher than static map. Recommended 1.</p>
</li>
<li>
<p><strong>I, dyn_map_lite_pos_init_mode, =</strong> 0 disable position initializing from dynamic mapping, 1 initialize position and restore confidence if AGV's surrounding has not been changed significantly.</p>
<p>Principle of operation: On startup, if scanner points are matching the saved points before shutdown, Navitrol will create dynamic map from scanner points that are visible on startup and restore the confidence saved before shutdown. Accuracy of initial match to the saved scanner points can be changed with parameter <strong>F,start_pos_ini_min_match_rate.</strong></p>
</li>
<li>
<p><strong>F, dyn_map_lite_pos_init_weight, =</strong> Weight of dynamic mapping points added during position initialization. Recommended 0.02-0.05.</p>
</li>
</ul>
<h3 id="environment-update"><a class="header" href="#environment-update">Environment Update</a></h3>
<p>When Dynamic Mapping Lite is switched on and the vehicle starts moving, Navitrol will start storing the most recent matched scanner measurements to the map as light blue dots.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image4.png" alt="" />
&gt;Figure 1. Dynamic points created by Dynamic Mapping Lite.</p>
<p>Dynamic environment points will start to gather more weight as they receive more scanner hits. The weight of the dynamic point is indicated with the shade of blue. The darker the blue, the higher weight the dynamic point has.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image5.png" alt="" />
&gt;Figure 2. Dynamic points with different weights.</p>
<p>Updating the dynamic points is done by removing the oldest points from the memory when memory is full and replacing them with new points.</p>
<p>When using Dynamic Mapping it is vital that there are some static features in the environment to lock the dynamic features in the correct places. Even though the dynamic map is only updated when position confidence is high enough, the sufficient position confidence can be reached with dynamic points only. In this case if there is no static environment to lock the dynamic points in place the dynamic map can start cumulatively drifting from the correct position.</p>
<h3 id="dynamic-mapping-excluded-areas"><a class="header" href="#dynamic-mapping-excluded-areas">Dynamic Mapping Excluded Areas</a></h3>
<p>Dynamic Mapping might not be needed in all areas of the route of the vehicle. These areas can be excluded by defining them in NavithorTools using feature zones.</p>
<p>Areas where updating the dynamic map is not needed are defined using polygons.</p>
<p>It is advised to exclude areas that do not create a solid environment model. In picture below a round ventilation channel runs horizontally on the height of the scanner view. The wall is thus not detected as thin line but is blurred instead. As dynamic mapping cannot then have any good reference from this kind of wall it is strongly advised to exclude this kind of features from the dynamic map.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image6.png" alt="" />
&gt;Figure 3. Example of bad environment for dynamic map.</p>
<p>Also, open areas with lot of moving manual traffic seen by AGV's laser scanners should also be set as excluded.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/FeatureZoneTool.PNG" alt="" />
&gt;Figure 4. Defining an feature zone polygon to be excluded from Dynamic Mapping.</p>
<h2 id="dynamic-mapping-full-1"><a class="header" href="#dynamic-mapping-full-1">Dynamic Mapping Full</a></h2>
<p>Dynamic Mapping Full is a feature that combines dynamic environment points from several vehicles to a <strong>Dynamic Mapping Server</strong> to create a shared dynamic map for all of them. Dynamic Mapping Lite points from every individual vehicle are sent to the Dynamic Mapping Server, where they are gathered and stored into a combined larger dynamic map. <strong>Dynamic Mapping Client</strong> is used to control server and edit stored dynamic map. <strong>Dynamic Mapping Server</strong> has only a basic UI for displaying server state.</p>
<h3 id="relevant-parameters-navitrol-side"><a class="header" href="#relevant-parameters-navitrol-side">Relevant Parameters (Navitrol side)</a></h3>
<ul>
<li>
<p><strong>I,dyn_map_server_enable, =</strong> 0 to disable, 1 to enable Dynamic Mapping Full.</p>
</li>
<li>
<p><strong>S,dyn_map_server_ip, =</strong> IP address of the Dynamic Mapping Server.</p>
</li>
<li>
<p><strong>I,dyn_map_server_port, =</strong> Port used for communication between Navitrol clients and the server.</p>
</li>
<li>
<p><strong>I,dyn_map_server_update_interval_ms, =</strong> Interval in milliseconds for updating the Dynamic Mapping Server. Recommended value 500-2000 ms. With larger fleets it is recommended to keep the interval low.</p>
</li>
<li>
<p><strong>I,dyn_map_server_update_min_n_new_meas, =</strong> Determines how many dynamic mapping light measurements have to have changed in memory for update to be sent to server. Recommended value half of dyn_map_lite_n_meas.</p>
</li>
<li>
<p><strong>I,dyn_map_server_recv_timeout_ms, =</strong> Maximum time in milliseconds for connection break before timeout. Recommended value 5000 ms.</p>
</li>
</ul>
<h3 id="installation"><a class="header" href="#installation">Installation</a></h3>
<p>For instruction how to install and run Dynamic Mapping Server as a windows service see section <em>Installing</em> <em>Dynamic Mapping Server as a service</em> for more details.</p>
<p>Dynamic Mapping Server is operated with separate programs named <strong>NavitrolDynamicMappingServer.exe</strong> and <strong>DynamicMappingClient.exe</strong></p>
<p>To establish connection between the Dynamic Mapping Server and the Navitrol clients:</p>
<ol>
<li>
<p>Every Navitrol client must have the IP address of the server set as <strong>dyn_map_server_ip</strong> in the params.txt file.</p>
</li>
<li>
<p>Every Navitrol client must have a port number as  <strong>dyn_map_server_port</strong> in the params.txt file that matches the port set for the Dynamic Mapping Server as <strong>ServerPort</strong> in the  server's Parameters.xml file (not to be confused with Server Port  in the Dynamic Mapping Client configuration).</p>
</li>
<li>
<p>Every Navitrol client must have a license to run Dynamic Mapping Full.</p>
</li>
<li>
<p>Dynamic Mapping Full must be enabled with <strong>dyn_map_server_enable</strong> parameter in the params.txt file</p>
</li>
</ol>
<p>After the environment with all the static features has been created, the environment data must be exported for the Dynamic Mapping Server. This can be done from:</p>
<p><strong>Export / Upload Export Dynamic Mapping Server Data</strong></p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image8.png" alt="" /> <img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image9.png" alt="" />
&gt;Figure 5. Exporting Dynamic Mapping Server Data from NavithorTools.</p>
<p>The file name by default will take the form of <strong>dyn_********.ntdi</strong> where the file extension indicates a
Dynamic Mapping Server Data file.</p>
<p>Tools will prompt user to confirm using the <strong>finalized measurements</strong> as base data for the new dynamic map. If the finalized measurements are still valid data saying 'Yes' is safe. If the area has lots of dynamic features and the teach data is so old that it contains lot of false data, then saying 'No' is a better a choice. If 'No' is selected, then the dynamic base map will be empty and will only contain the information about possible excluded areas.</p>
<p>After the ntdi-file is created it needs to be loaded to Dynamic Mapping Server using Dynamic Mapping Client.</p>
<p>Uploading maps to server is done using Dynamic Mapping Client. The server stream port needs to be open to successfully upload maps. To upload new map from the client, first select <strong>Server</strong> -&gt; <strong>Change Map</strong> -&gt; <strong>Upload new map.</strong> After successful upload, the selected map will appear to the MapSelectionForm list. Clicking listed map item and pressing <strong>Select</strong> will load the map to the server as well as to all connected clients.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image11.png" alt="" /> <img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image10.png" alt="" />
&gt;Figure 6. Loading a Dynamic Mapping Server Data file to be used for the
server.</p>
<p>If successful, the base environment will appear on the user interface.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image12.png" alt="" />
&gt;Figure 7. Base environment for the Dynamic Mapping Server.</p>
<h4 id="installing-dynamic-mapping-server-as-a-service"><a class="header" href="#installing-dynamic-mapping-server-as-a-service">Installing Dynamic Mapping Server as a service</a></h4>
<p>Dynamic Mapping Server can be run as a Windows service. To do this, the Dynamic Mapping Server service needs to be installed as a service.</p>
<p>First, the NavitrolDynamicMappingServer.exe.config file must be edited in a text editor. In section <strong>&lt;userSettings&gt;</strong> parameter value <strong>runAsService</strong> marked in red below must be set to <strong>True</strong>. The file can be found in the same folder as the NavitrolDynamicMappingServer executable. Dynamic Mapping server can be run as an executable if this parameter is kept as false.</p>
<pre><code class="language-xml">&lt;userSettings&gt;
  &lt;NavitrolDynamicMappingServer.Properties.Settings&gt;
    &lt;setting name=&quot;runAsService&quot; serializeAs=&quot;String&quot;&gt;
      &lt;value&gt;False&lt;/value&gt;
    &lt;/setting\&gt;
    &lt;setting name=&quot;serverServicePort&quot; serializeAs=&quot;String&quot;&gt;
      &lt;value&gt;8080&lt;/value&gt;
    &lt;/setting&gt;
    &lt;setting name=&quot;serverStreamPort&quot; serializeAs=&quot;String&quot;&gt;
      &lt;value&gt;8090&lt;/value&gt;
    &lt;/setting&gt;
  &lt;/NavitrolDynamicMappingServer.Properties.Settings&gt;
&lt;/userSettings&gt;
</code></pre>
<p>Next, using Command Prompt as an admin navigate to the path where the NavitrolDynamicMappingServer.exe is located. Type in command:</p>
<p><strong>NavitrolDynamicMappingServer.exe -install</strong>.</p>
<p>Server as a service can be uninstalled by typing in:</p>
<p><strong>NavitrolDynamicMappingServer.exe -uninstall</strong>.</p>
<p>Once installed, &quot;<strong>Dynamic Mapping Server as a Service</strong>&quot; should appear listed in the windows service when viewed with Services app. To start or stop the server right click the service in the list and select &quot;start&quot; or &quot;stop&quot;. These are not to be confused with &quot;start&quot; and &quot;stop&quot; option available in the Dynamic Mapping Client user interface, where starting and stopping controls the processing of incoming dynamic data from Navitrol clients.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>Figure 8. Dynamic Mapping Server as a service listed in Windows Services
app</p>
</blockquote>
<p>Server can be accessed and operated with a separate client application <strong>DynamicMappingClient.exe</strong>. To connect client to the Dynamic Mapping Server navigate to <strong>Tools</strong> <strong>Configuration,</strong> open server configurations menu and type in the IP-address of the server. Network traffic through <strong>Server port</strong> and <strong>Server Stream</strong> port must allowed. These are by default set to ports 8080 and 8090, but can be changed from the NavitrolDynamicMappingServer.exe.config. It must be noted that these need to match in both config file and client configuration in order to establish connection between server and client. After succesfull connection the status indicator chages from &quot;Disconnected&quot; to &quot;Running&quot; or &quot;Stopped&quot; depending on current server state. Most likely communication to these ports need to be allowed from the windows firewall before data starts to come through.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image14.png" alt="" /></p>
<blockquote>
<p>Figure 9. Server Configurations location</p>
</blockquote>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image15.png" alt="" /></p>
<blockquote>
<p>Figure 10. Server Configurations menu</p>
</blockquote>
<h3 id="dynamic-mapping-client-user-interface"><a class="header" href="#dynamic-mapping-client-user-interface">Dynamic Mapping Client User Interface</a></h3>
<p>All server controlling is done through Dynamic Mapping Client including starting and stopping server update process, creating backups, changing map, or editing map. Start and stop will control the processing and incorporation of incoming dynamic data to the dynamically generated and shared map. Stopping the server does not shut down the server. If server needs to be shut down either the windows service needs to be stopped from Windows Service manager, or if running directly from executable closing the executable.</p>
<p>All Navitrol clients connected to the server will be displayed on their live location on the dynamic map. After a Navitrol client has established connection with the server once, it will be displayed in the user interface even if connection is lost. Only the status of the client will change in this case.</p>
<p>Navitrol client status is indicated with ok, map mismatch, disconnected or outside area messages. Map mismatch indicates that the map on the server and on Navitrol client is different. Outside area status indicates that the AGV is outside production area. If an AGV is getting hits from outside the production area these are logged as well as displayed besides status message as unsaved points. These points are not stored to Dynamic Mapping server as they are coming from outside the production area.</p>
<p>Dynamic Mapping Client displays an About tab which shows current client and server versions as well as their compatibility.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image16.png" alt="" /></p>
<blockquote>
<p>Figure 11. Dynamic Mapping Client displaying server to client
compatibility</p>
</blockquote>
<p>On the <strong>Server Clients</strong> data table, the following information about the connected Navitrol clients are displayed:</p>
<ul>
<li>IP address</li>
<li>Map level or floor where the vehicle is currently</li>
<li>X and Y coordinates of the vehicle's navigation point</li>
<li>Position confidence</li>
<li>Navitrol version</li>
<li>Indication that server is uploading new dynamic points</li>
<li>Status messages
<ul>
<li>OK</li>
</ul>
</li>
<li>Map mismatch (different environments uploaded for the client and the server)
<ul>
<li>Disconnected</li>
</ul>
</li>
<li>Outside Area with unsaved points count</li>
</ul>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image17.png" alt="" />
&gt;Figure 12. Dynamic Mapping Server user interface.</p>
<h3 id="environment-update-1"><a class="header" href="#environment-update-1">Environment Update</a></h3>
<p>When the vehicles are operating and the position confidence stays high enough, the dynamic map will continuously update adding environment points for new dynamic features added to it.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image18.png" alt="" />
<img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image19.png" alt="" /></p>
<blockquote>
<p>Figure 13. Dynamic environment points generated by Dynamic Mapping Server.</p>
</blockquote>
<p>After the Dynamic Mapping Server has uploaded the updated dynamic points for the Navitrol client, they are also displayed on the NavitrolMonitor side. All dynamic environment points that are currently being used for the client are displayed as black dots in the NavitrolMonitor.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image20.png" alt="" /> <img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image21.png" alt="" />
&gt;Figure 14. Dynamic environment points generated by Dynamic Mapping Server displayed in NavitrolMonitor.</p>
<h3 id="dynamic-map-editing"><a class="header" href="#dynamic-map-editing">Dynamic Map Editing</a></h3>
<p>If there is a need to edit the dynamic environment created by the Dynamic Mapping Server, this can be done with the Edit Dynamic Map tool:</p>
<p><strong>Tools Edit Map</strong></p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image22.png" alt="" /> <img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image23.png" alt="" />
&gt;Figure 15. Opening the Edit Dynamic Map form.</p>
<p>Measurements can be selected by clicking them on the map. Selected set of measurements are highlighted with a blue color. The selected measurements can be erased from the environment with <strong>Delete All</strong>.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image24.png" alt="" />
&gt;Figure 16. Selecting a set of measurements for deleting.</p>
<p>Measurements can also be deleted one by one by selecting individual measurements form the Edit Dynamic Map form. Selected measurements are highlighted with a bugurdy colour. The selected measurement can be erased from the environment with <strong>Delete Selected</strong>.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image25.png" alt="" /></p>
<blockquote>
<p>Figure 17. Selecting an individual measurement for deleting.</p>
</blockquote>
<p>The retrieval of data is indicated with a <strong>RetrievingData</strong> status in the client UI. Server processes map edit request when a suitable window for data gathering opens amid handling incoming updates from connected Navitrol clients. The processing of incoming updates takes priority. Also, depending on the amount of data on a particular section of the map, the gathering and sending data back to user might take some time. If gathering takes up considerable long, lowering server-side parameter <strong>MaxHandledPoseAndPointSets</strong> should speed up the process by lowering the amount of data sent in one request.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image26.png" alt="" /></p>
<blockquote>
<p>Figure 18. Dynamic Mapping Client map edit request</p>
</blockquote>
<h3 id="backups-and-restore"><a class="header" href="#backups-and-restore">Backups and Restore</a></h3>
<p>Dynamic Mapping Server stores backups of the dynamic environment periodically. Backup interval can be adjusted from server side Parameters.xml file with parameter <code>&lt;BackupInterval_s&gt;</code>. Negative number will disable periodic backupping. Backups of the current dynamic environment can also be saved manually with: <strong>Tools Save Backup</strong></p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image27.png" alt="" />
&gt;Figure 19. Saving a backup of the dynamic map.</p>
<p>Backups are saved in the <strong>Backups</strong> folder located in the same folder as the <strong>DynamicMappingServer.exe</strong> program.</p>
<p>Server will start backupping when a suitable window for backupping is avaiable while handling incoming updates from Navitrol clients take priority. When backupping is in process all other user actions are temporarily prevented and the status indicator will display &quot;Backupping&quot;.</p>
<p>To restore dynamic mapping server to a earlier backup Dynamic Mapping Server must be closed and a backup-file needs to be unzipped to Storage-folder. After starting Server the backup-files are read and map data is restored to the moment stored in the backup-file.</p>
<h2 id="position-confidence-with-dynamic-mapping"><a class="header" href="#position-confidence-with-dynamic-mapping">Position Confidence with Dynamic Mapping</a></h2>
<p>When dynamic mapping feature is in use, the position confidence of the AGV is calculated differently, as it is allowed to drive for a time without a matching static environment. Below are two figures illustrating the position confidence of the AGV when it goes out of static environment.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image28.PNG" alt="" /></p>
<blockquote>
<p>Figure 20: Position confidence when going outside of the static map without dynamic mapping.</p>
</blockquote>
<p>In the figure above, dynamic mapping feature was turned off. The AGV was matching with the static environment up to 12 second mark, then it went outside of it. The position confidence therefore decreased rapidly and went down to zero.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image29.PNG" alt="" /></p>
<blockquote>
<p>Figure 21: Position confidence when going outside of the static map with dynamic mapping.</p>
</blockquote>
<p>Conversely, in the above figure, dynamic mapping feature is turned on.
When the AGV is out of the static environment, position confidence is decreased with a slight slope instead of immediately. How fast the confidence should drop in such a situation can be adjusted with the <strong>corr_conf_dyn_map_lite_max_dist</strong> parameter.
When this parameter is set to higher values, the confidence will decrease more slowly.</p>
<p>The following points should be noted regarding position confidence with dynamic mapping:</p>
<ol>
<li>
<p>This behavior is only valid when dynamic mapping is deemed to be &quot;OK&quot;, that is, there are enough dynamic points, and they match sufficiently to the static map. If that is not the case, even if dynamic mapping is feature is enabled, the confidence will decrease rapidly without a static map.</p>
</li>
<li>
<p>Dynamic mapping points can never increase the confidence. They only prevent confidence decrease. This means that if the AGV was never in a place with a good static environment, the confidence will stay low regardless of the dynamic points.</p>
</li>
</ol>
<h2 id="relevant-server-parameters"><a class="header" href="#relevant-server-parameters">Relevant Server Parameters</a></h2>
<p>Below are listed some useful server-side parameters and their default values defined in the Parameters.xml file located in the Dynamic Mapping Server folder.</p>
<ul>
<li>
<p><strong>&lt;ServerPort&gt;6089&lt;/ServerPort&gt;</strong> = port to which Navitrol clients connect.</p>
</li>
<li>
<p><strong>&lt;MaxBackupFiles&gt;50&lt;/MaxBackupFiles&gt;</strong> = Max number of backups kept before overwriting.</p>
</li>
<li>
<p><strong>&lt;BackupInterval_s&gt;3600&lt;/BackupInterval_s&gt;</strong> = Interval of periodic backups.</p>
</li>
<li>
<p><strong>&lt;MaxHandledPoseAndPointSets&gt;50&lt;/MaxHandledPoseAndPointSets</strong>&gt; = Max number of processed and retrieved measurement sets when map edit is requested from client. If retrieving data from server to client using Edit Map form takes considerable long, lower this parameter will speed the data gathering process.</p>
</li>
<li>
<p><strong>&lt;ServerStatusUpdateInterval_ms&gt;500&lt;/ServerStatusUpdateInterval_ms&gt;</strong>= interval defines how often server status is sent to connected  Dynamic Mapping Client interfaces.</p>
</li>
<li>
<p><strong>&lt;MaxMapUpdateCycleTime_ms&gt;30000&lt;/MaxMapUpdateCycleTime_ms&gt;</strong> = maximum time allowed for the Dynamic Mapping Server to process new map update packets. If the time is exceeded packets received but not yet processed will be skipped to prevent server from cumulating unprocessed packets. There could be a situation where handling a update takes considerably long time due to amount of data it contains. During this more packets are being sent from Navitrol clients and cumulated. Lower this value gives server a limit of how long it can process a packet before moving on.</p>
</li>
</ul>
<h2 id="language-options"><a class="header" href="#language-options">Language options</a></h2>
<p>Dynamic Mapping Client supports English, German and Japanese localization available from Language tab.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServer/./media-en/image30.PNG" alt="" /></p>
<blockquote>
<p>Language options</p>
</blockquote>
<h2 id="troubleshooting-26"><a class="header" href="#troubleshooting-26">Troubleshooting</a></h2>
<p>While using the Dynamic mapping feature there will be cases when the dynamic feature is not working or configured properly. Also, there could be situations when the parameters are not set correctly, or the user needs to know what to do in case a certain error appears. This section discusses different situations where trouble shooting, or fine tuning of parameters will be required. This section does not cover the exhaustive list of errors and contains only the most commonly occurring errors or trouble shooting situations.</p>
<h3 id="dynamic-mapping-lite-not-activating"><a class="header" href="#dynamic-mapping-lite-not-activating">Dynamic mapping lite not activating</a></h3>
<p>This can happen when the parameters are not enabled or set correctly. Make sure the parameter 'dyn_map_lite_pos_corr' is set to 1, in addition the parameter 'dyn_map_lite_n_meas' should have some value greater than zero. If this parameter is set to 0 then no measurement is stored for dynamic mapping lite and the environment is not read at all. This will lead the user to think that the feature is not working at all.</p>
<h3 id="dynamic-mapping-full-not-activating"><a class="header" href="#dynamic-mapping-full-not-activating">Dynamic mapping full not activating</a></h3>
<p>The most common mistake for dynamic mapping full to not work at all is that the parameters for dynamic full are enabled but the parameters for dynamic mapping lite are disabled. To make use of dynamic mapping full, the parameters for both dynamic lite and full should be enabled.</p>
<h3 id="dynamic-mapping-server-is-not-connected"><a class="header" href="#dynamic-mapping-server-is-not-connected">Dynamic mapping server is not connected</a></h3>
<p>There can be an instance when the Dynamic mapping server is running but under the 'Status' it says 'Disconnected'. This can happen when the IP address of the machine where the Dynamic mapping server is running is not entered correctly. Depending on how the machine is connected the IP address can be of Wi-Fi or of LAN. Entering the command 'ipconfig' in command prompt will displays the IP addresses of the machine being used from which the correct one can be selected. After entering the correct IP address, the 'Status' should be changed to 'Running' or &quot;stopped&quot; and this verifies that the dynamic mapping server is connected properly.</p>
<p>Issue may also occur due to windows firewall and incorrectly set rules for incoming traffic for the ports used by Dynamic Mapping Server and Client. Extra care must be paid when setting up inbound rules for the used ports. This is the most common issue when setting up Dynamic Mapping Server and no data comes through to Client.</p>
<p>If AGVs cannot connect to server even if the correct server IP and port number has been configured to the AGV parameter file, it could be that windows firewall blocks communication to the port on the server-side pc. In this case inbound rule should be added to add the used port as allowed.</p>
<p>Connection issue may also be caused by trying to use incompatible server and client versions.</p>
<h3 id="agv-loses-position-confidence"><a class="header" href="#agv-loses-position-confidence">AGV loses position confidence</a></h3>
<p>There can be a situation where the environment around the AGV is dynamic for a very long distance with no static features present and then the AGV might lose its position confidence. In that situation the parameter corr_conf_dyn_map_lite_max_dist' should be increased, the recommended value for this parameter is 10 meters. However, it is suggested that much larger values should not be used as it will accumulate the drift and it may require changing some of the other dynamic mapping parameters as well.</p>
<h3 id="map-mismatch-error"><a class="header" href="#map-mismatch-error">Map mismatch error</a></h3>
<p>Sometime there can be a situation where 'Map mismatch' message is seen under the 'Status' in Dynamic mapping server and connected AGVs. This can happen when the environments or maps uploaded to dynamic mapping server and the AGV are different. If there is a slight difference between the two maps, then this error will persist initially.</p>
<p>To remove this error export new file for dynamic mapping server from the environment and upload the same environment to the AGV as well.</p>
<h3 id="parametererror-status"><a class="header" href="#parametererror-status">ParameterError status</a></h3>
<p>This error occurs if no new packets are being processed by the Dynamic Mapping Server coming from Navitrol clients. It is caused when <strong>MaxMapUpdateCycleTime_ms</strong> parameters is set too low and server never has enough time to process incoming data. Server needs to be shut down and parameter adjusted before restart.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dynamic-mapping-clientserver-compatibility"><a class="header" href="#dynamic-mapping-clientserver-compatibility">Dynamic Mapping Client/Server Compatibility</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="introduction-27"><a class="header" href="#introduction-27">Introduction</a></h2>
<p>This document lists compatibilities between Dynamic Mapping Client (DMC)
and Dynamic Mapping Server (DMS) versions. Product version can be
checked by right clicking exe file, selecting <strong>Properties</strong> and
navigating to <strong>Details</strong> tab, as shown in Figure 1.</p>
<p><img src="Localization/DynamicMapping/DynamicMappingServerAndClientCompatibility/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 1: Finding product version of dynamic mapping server and client</p>
</blockquote>
<h2 id="compatibility-table"><a class="header" href="#compatibility-table">Compatibility Table</a></h2>
<p>Dynamic Mapping Server versions and compatible client versions can be seen in the table below.</p>
<table><thead><tr><th>Server product version</th><th>Compatible Client product version</th></tr></thead><tbody>
<tr><td>2.00.00</td><td>2.0.0.0</td></tr>
<tr><td>2.01.00</td><td>2.0.0.0</td></tr>
<tr><td>2.02.00</td><td>2.0.1.0</td></tr>
<tr><td>2.02.00</td><td>2.02.00</td></tr>
<tr><td>2.03.00</td><td>2.03.00</td></tr>
<tr><td>2.04.00</td><td>2.04.00</td></tr>
<tr><td>2.05.00</td><td>2.04.00</td></tr>
<tr><td>2.05.00</td><td>2.05.00</td></tr>
<tr><td>2.04.00</td><td>2.05.00</td></tr>
<tr><td>2.06.00</td><td>2.06.00</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dynamic-mapping-server---hardware-requirements"><a class="header" href="#dynamic-mapping-server---hardware-requirements">Dynamic Mapping Server - Hardware requirements</a></h1>
<p>Updated 27.02.2023</p>
<hr />
<h2 id="dynamic-mapping-server-requirements"><a class="header" href="#dynamic-mapping-server-requirements">Dynamic Mapping Server requirements</a></h2>
<p><strong>Minimum</strong></p>
<p>•	Screen resolution: 1920x1080 (not required if running as a service)
•	GPU: OpenGL 1.1 support (not required if running as a service)
•	CPU: Intel i7 / i9 or similar 3.0 GHz+
•	RAM: 8 GB
•	SSD: 240 GB</p>
<p><strong>Recommended</strong></p>
<p>•	Screen resolution: 1920x1080 (not required if running as a service)
•	GPU: OpenGL 3.3 or newer support (not required if running as a service)
•	CPU: Intel i7 / i9 or similar 3.0 GHz+ with high single thread performance
•	RAM: 8 GB
•	SSD: 500 GB</p>
<hr />
<h2 id="dynamic-mapping-client-requirements"><a class="header" href="#dynamic-mapping-client-requirements">Dynamic Mapping Client requirements</a></h2>
<p><strong>Minimum</strong></p>
<p>•	Screen resolution: 1920x1080
•	CPU: 4 logical cores, 2.4 GHz+
•	RAM: 8 GB
•	GPU: OpenGL 1.1 support
•	HDD/SSD: 200 GB</p>
<p><strong>Recommended</strong></p>
<p>•	Screen resolution: 1920x1080
•	CPU: 4 logical cores, 2.4 GHz+
•	RAM: 8 GB
•	GPU: OpenGL 3.3 or newer support
•	SSD: 200 GB</p>
<hr />
<h2 id="general-software-requirements"><a class="header" href="#general-software-requirements">General software requirements</a></h2>
<p>•	Operating Systems: 10, Windows Server 2016 / 2019
•	Team Viewer version 14 – for remote installation and support of Navitec software
•	.Net Framework 4.7.2
•	Dynamic Mapping Server should not run on the same PC as the Navithor Server</p>
<p>Windows Remote Desktop</p>
<p>Dynamic Mapping Server and Client is using OpenGL as rendering backend which has compatibility issues with Windows Remote Desktop when used to connect to the server/client pc remotely and will affect Client performance negatively. Windows Server 2016 (or newer) and Windows 10 have optionally enabled group policy which will allow remote desktop connections to use hardware graphics adapter.</p>
<p>This can be enabled by doing the following (precise name of option might vary):</p>
<p>Open the Edit Group Policy tool from Control Panel or use the Windows Search dialog (Windows Key + R, then type in gpedit.msc)<br />
Browse to: Local Computer Policy\Computer Configuration\Administrative Templates\Windows Components\Remote Desktop Services\Remote Desktop Session Host\Remote Session Environment<br />
Then enable “Use hardware graphics adapters for all Remote Desktop Services sessions”</p>
<p>Hardware requirements are directly linked to the size of the AGV fleet and the size of the production area and may therefore vary. For optimal server performance quick file operations using SSDs and high single thread performance CPU are necessary.</p>
<hr />
<h2 id="guidelines-for-network-bandwidth-and-latency"><a class="header" href="#guidelines-for-network-bandwidth-and-latency">Guidelines for Network Bandwidth and Latency</a></h2>
<p>These are some general guidelines on the network bandwidth and latency. For optimal performance there should be as much margin as possible for the network. Other software and components on the factory network should be taken into account when building a sufficient network.</p>
<p>Notice that when the number of AGV's or other devices connected to the network increases the latencies and load on the network and different access points increase often in a non-linear way. Network should be available everywhere where AGV's move on the production floor and the requirements should to be filled even in the worst case.</p>
<p>Our recommendation would be to use Gigabit ethernet connections and Wlan 802.11n or 802.11ac standard.</p>
<table><thead><tr><th>Application</th><th>Server</th><th>Bandwidth</th><th>Connection</th></tr></thead><tbody>
<tr><td>Navithor Server</td><td>SQL Server</td><td>Gigabit</td><td>Preferably cable connected with gigabit ethernet</td></tr>
<tr><td>Navithor Client</td><td>Navithor Server</td><td>100 - 1000 kBps / per Navithor Client</td><td>Wlan with low latency ( &lt; 30 ms ). Bandwidth depends on area size, number of AGV's and MES behaviour.</td></tr>
<tr><td>MES Connection</td><td>Navithor Server</td><td>5 kBps / per MES application</td><td>Preferably cable connected. Depends on the MES program and Navithor configuration.</td></tr>
<tr><td>Navithor Server</td><td>Navitrol</td><td>10 kBps / per Navitrol AGV</td><td>Wlan with low latency ( &lt; 30 ms). Bandwidth requirement is more on large areas and with AGV's using multiple scanners.</td></tr>
<tr><td>Navitrol Monitor</td><td>Navitrol</td><td>1.2 MBps</td><td>Meant to be connected only for analysing situations, configuring and debugging. Not more than 1 connection per time recommended.</td></tr>
<tr><td>Navitrol</td><td>Dynamic Mapping Server</td><td>50 kBps / Navitrol</td><td>Wlan with low latence ( &lt; 30 ms). Bandwidth requirement is more on large areas and with AGVs using multiple scanners.</td></tr>
<tr><td>Dynamic Mapping Client</td><td>Dynamic Mapping Server</td><td>100 - 1000 kBps / per Navithor Client</td><td>Wlan with low latency ( &lt; 30 ms ). Bandwidth depends on area size, number of AGV's.</td></tr>
</tbody></table>
<h3 id="example-system-and-bandwidth-requirements"><a class="header" href="#example-system-and-bandwidth-requirements">Example system and bandwidth requirements</a></h3>
<p>With 3 AGV's, 1 Navithor Client, 1 MES connection and Dynamic Mapping Server with 1 Dynamic Mapping Client. Capability to use Navitrol Monitor.</p>
<table><thead><tr><th>Components</th><th></th></tr></thead><tbody>
<tr><td>SQL Server</td><td>Running on the Navithor Server computer</td></tr>
<tr><td>AGV's</td><td>3 * 10 kBps</td></tr>
<tr><td>Navithor Client</td><td>300 kBps</td></tr>
<tr><td>MES Connection</td><td>5 kBps</td></tr>
<tr><td>Dynamic Mapping server</td><td>3 * 50 kBps</td></tr>
<tr><td>Navitrol Monitor</td><td>1.2 MBps</td></tr>
<tr><td>Dynamic Mapping Serve to Client</td><td>500 kBps</td></tr>
<tr><td>Minimum Bandwidth requirement</td><td><strong>2.2 MBps</strong></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wheel-slipping-diagnostic"><a class="header" href="#wheel-slipping-diagnostic">Wheel slipping diagnostic</a></h1>
<p>Updated 09.02.2024</p>
<h2 id="overview-19"><a class="header" href="#overview-19">Overview</a></h2>
<h3 id="introduction-28"><a class="header" href="#introduction-28">Introduction</a></h3>
<p>This feature is used to differentiate between driven motion and slipping. A warning and soft slow is triggered, meaning the AGV will slow down, in case of slipping.</p>
<h2 id="set-up-2"><a class="header" href="#set-up-2">Set up</a></h2>
<h3 id="quick-start-4"><a class="header" href="#quick-start-4">Quick start</a></h3>
<p>The wheel slipping diagnostic is active when the AGV is moving, i.e. the velocity is larger than <strong>pc_stopped_speed_limit</strong>. The slipping distance and angle is determined from the scanner corrections. If the corrections have been for two consecutive cycles above the small correction limits the wheel is concluded to be slipping, and once for the large correction limits. For odometry velocities above <strong>loc_slip_det_speed_lim</strong>, parameters <strong>loc_slip_det_max_dir_diff_deg</strong> and <strong>loc_slip_det_small_v_drop</strong> are acknowledged. The slipping detection limits cannot be too small, otherwise it might false-positively determine the AGV is slipping, and if the limits are too big the slipping is not detected. </p>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>loc_slip_det_small_xy_corr</td><td>Float</td><td>0.0</td><td>The smaller distance limit for detecting slipping. 0.0 to disable. Unit is meters</td></tr>
<tr><td>loc_slip_det_large_xy_corr</td><td>Float</td><td>0.0</td><td>The larger distance limit for detecting slipping. 0.0 to disable. Unit is meters</td></tr>
<tr><td>loc_slip_det_large_h_corr_deg</td><td>Float</td><td>0.0</td><td>The larger angular limit for detecting slipping. 0.0 to disable. Unit is degrees</td></tr>
</tbody></table>
<h3 id="fine-tuning-4"><a class="header" href="#fine-tuning-4">Fine-tuning</a></h3>
<p>Using <strong>loc_slip_det_corr_apply_mode</strong> we can define how scanners are trusted to compensate the error in pose caused by inaccurate dead-reckoning. There are two types of corrections: heading correction and distance correction.</p>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>loc_slip_det_corr_apply_mode</td><td>Int</td><td>0</td><td>Slipping correction mode: <br> 0 - apply both heading and distance corrections completely, <br> 1 - apply heading correction completely, <br> 2 - apply distance correction completely</td></tr>
<tr><td>loc_slip_det_xy_corr_limit</td><td>Float</td><td>1.0</td><td>The maximum distance correction applied if loc_slip_det_corr_apply_mode is 2. Unit is meters</td></tr>
<tr><td>loc_slip_det_xy_corr_increase_per_cycle</td><td>Float</td><td>0.1</td><td>The increase in distance correction in each cycle when wheel slip is detected. Unit is meters</td></tr>
<tr><td>loc_slip_det_h_corr_increase_per_cycle_deg</td><td>Float</td><td>1.0</td><td>The increase in heading correction in each cycle when wheel slip is detected. Unit is degrees</td></tr>
<tr><td>loc_slip_det_max_dir_diff_deg</td><td>Float</td><td>360.0</td><td>The maximum difference between slipping direction and machine heading. Unit is degrees</td></tr>
<tr><td>loc_slip_det_small_v_drop</td><td>Float</td><td>0.4</td><td>Decrease in odometry velocity for small xy slip to trigger position correction. Unit is m/s^2</td></tr>
<tr><td>loc_slip_det_speed_lim</td><td>Float</td><td>0.1</td><td>The maximum speed for slip detection to ignore speed and direction difference limits. Unit is m/s</td></tr>
</tbody></table>
<h3 id="errors-and-warnings-9"><a class="header" href="#errors-and-warnings-9">Errors and warnings</a></h3>
<h4 id="328---warning_odometry_slipping"><a class="header" href="#328---warning_odometry_slipping">328 - WARNING_ODOMETRY_SLIPPING</a></h4>
<p><a href="Localization/WheelSlipping/../../Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html#328-warning_odometry_slippings">Error descriptions</a></p>
<h3 id="advanced-troubleshooting-6"><a class="header" href="#advanced-troubleshooting-6">Advanced troubleshooting</a></h3>
<p>The feature has logging prefix &quot;Odometry slipping&quot;</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="3d-positioning"><a class="header" href="#3d-positioning">3D positioning</a></h1>
<p>Updated 06.02.2024</p>
<hr />
<h2 id="overview-20"><a class="header" href="#overview-20">Overview</a></h2>
<h3 id="introduction-29"><a class="header" href="#introduction-29">Introduction</a></h3>
<p>3D positioning is a feature, which enables the AGV to localize itself in 3D space by using a 3D laser scanner.</p>
<p><img src="Localization/3dPositioning/./media-en/example_garage.png" alt="" /></p>
<blockquote>
<p>Example outdoor environment for 3D positioning</p>
</blockquote>
<h3 id="requirements-13"><a class="header" href="#requirements-13">Requirements</a></h3>
<ul>
<li>Hardware
<ul>
<li>AGV IPC
<ul>
<li>Recommended:
<ul>
<li><a href="https://www.bressner.de/datenblatt/Nuvo-9531-series-Datasheet-EN.pdf">Nuvo-9531-PoE-IGN</a></li>
</ul>
</li>
<li>Minimum requirements:
<ul>
<li>CPU: i7-12700DTE</li>
<li>RAM: DDR4-16GB</li>
<li>SSD: 128GB</li>
</ul>
</li>
</ul>
</li>
<li>Mapping PC
<ul>
<li>Minimum:
<ul>
<li>Linux Ubuntu 20.04 operating system
<ul>
<li>Other Linux versions migt work as well, as the software is running inside Docker containers</li>
</ul>
</li>
</ul>
</li>
<li>Recommendation:
<ul>
<li>CPU: 6 cores, 64 bit processor, AVX or Neon instructions set support with 12 MB cache</li>
<li>RAM: 32 GB, DDR4 with transfer rate of 2666 MT/s</li>
<li>SSD: 500 GB or more</li>
<li>GPU: NVIDIA RTX A1000 (or equivalent)</li>
</ul>
</li>
<li>Notes:
<ul>
<li>More powerful CPU reduces the time used for building the map</li>
<li>GPU is optional: Having it increases the mapping performance</li>
<li>Big amount of disk space is needed mostly for storing the sensor data recording files</li>
</ul>
</li>
</ul>
</li>
<li>Operator PC
<ul>
<li>Minimum:
<ul>
<li>Windows 10, 64 bit operating system
<ul>
<li>.Net Framework 4.7.2</li>
<li>C++ Redistributable package 2017 x86 version</li>
</ul>
</li>
<li>Screen resolution: 1920x1080</li>
<li>CPU: 4 logical core, 2.4 GHz+</li>
<li>RAM: 8 GB</li>
<li>GPU: OpenGL 2.0 support</li>
<li>Storage: 120GB</li>
</ul>
</li>
<li>Recommendation:
<ul>
<li>Windows 10</li>
<li>RAM: 16 GB</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Devices
<ul>
<li>3D laser scanner
<ul>
<li>Minimum:
<ul>
<li><a href="https://data.ouster.io/downloads/datasheets/datasheet-rev06-v2p5-os1.pdf">Ouster OS1-32 rev6</a></li>
<li>Range over 100 meters is a required for outdoor navigation</li>
<li>32 scan lines are acceptable for structured environments</li>
</ul>
</li>
<li>Recommendation:
<ul>
<li><a href="https://data.ouster.io/downloads/datasheets/datasheet-rev06-v2p5-os1.pdf">Ouster OS1-64 rev6</a></li>
<li>64 scan lines are recommended for outdoor positioning</li>
</ul>
</li>
<li>Virtual bumper feature:
<ul>
<li><a href="https://data.ouster.io/downloads/datasheets/datasheet-rev7-v3p0-os0.pdf">Ouster OS0-64 rev7</a></li>
<li>Rev7 series offers range up to 100m which is requirement for outdoor navigation</li>
<li>Detecting obstacles for slowing down / stopping requires a 90 degree vertical field of view (VFOW) and 64 scan lines</li>
</ul>
</li>
</ul>
</li>
<li>IMU
<ul>
<li>Either:
<ul>
<li>GIMU (GIM Robotics IMU)</li>
<li><a href="https://www.microstrain.com/sites/default/files/3dm-gx5-10_datasheet_8400-0095_rev_l.pdf">Microstarin 3DM-GX-IMU</a></li>
</ul>
</li>
</ul>
</li>
<li>GNSS
<ul>
<li>Either:
<ul>
<li>GNSS unit:
<ul>
<li><a href="https://www.u-blox.com/en/product/c102-f9r-application-board">Ublox, C102-F9R</a></li>
</ul>
</li>
<li>Survey GNSS multiband antenna:
<ul>
<li><a href="https://www.ardusimple.com/product/calibrated-survey-gnss-multiband-antenna-ip67/">Ardusimple</a> SKU AS-ANT2B-CAL-L1L2-15SMA-00</li>
</ul>
</li>
<li>Base station:
<ul>
<li><a href="https://files.emlid.com/docs/Datasheet%20RS2%20ENG%20web.pdf">Emlid, Reach RS2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="related-features"><a class="header" href="#related-features">Related features</a></h3>
<ul>
<li>Features which are supported with 3D positioning
<ul>
<li>Normal position control driving for any kinematics</li>
<li>Virtual bumper
<ul>
<li>Speed limitation when obstacles appear on the route</li>
</ul>
</li>
</ul>
</li>
<li>Features which are partially supported with 3D positioning
<ul>
<li>Fleet control
<ul>
<li>3D positioning map must exists on the AGV IPC beforehand, as it is not downloaded / updated automatically</li>
</ul>
</li>
</ul>
</li>
<li>Features which are planned to be supported with 3D positioning later
<ul>
<li>Multilevel</li>
<li>Obstacle avoidance</li>
<li>Features requiring use of (separate) 2D scanner
<ul>
<li>Load &amp; target detection</li>
<li>Docking</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="dependencies-7"><a class="header" href="#dependencies-7">Dependencies</a></h3>
<ul>
<li>Sensor fusion</li>
<li>ROS</li>
<li>GIM</li>
</ul>
<hr />
<h2 id="setup-16"><a class="header" href="#setup-16">Setup</a></h2>
<h3 id="quick-start-5"><a class="header" href="#quick-start-5">Quick start</a></h3>
<ul>
<li>GIM software &amp; hardware is installed &amp; calibrated
<ul>
<li>Consult Navitec for setting up</li>
</ul>
</li>
<li>ROS2 Docker image is installed
<ul>
<li>See <a href="Localization/3dPositioning/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a> for installing Docker and the images</li>
</ul>
</li>
</ul>
<p><strong>Required parameters</strong></p>
<h4 id="ros---3d-positioning"><a class="header" href="#ros---3d-positioning">ROS - 3D positioning</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_enabled</td><td>Int</td><td>1</td><td>Enable Navitrol to communicate with GIM</td></tr>
<tr><td>ros_localization_enabled</td><td>Int</td><td>1</td><td>Enable Navitrol to receive external positioning data from GIM</td></tr>
<tr><td>ros_pose_topic_name</td><td>String</td><td>/ndt_mcl/aggregated</td><td>ROS topic name for GIM positioning data</td></tr>
<tr><td>ros_pose_topic_type</td><td>Int</td><td>2</td><td>ROS topic type for GIM positioning data<br/>2 - nav_msgs/msg/Odometry</td></tr>
<tr><td>ros_pose_quality_topic_name</td><td>String</td><td>/ndt_mcl/pose_quality</td><td>ROS topic name for GIM positioning confidence</td></tr>
<tr><td>ros_pose_quality_min_value</td><td>Int</td><td>0.0</td><td>GIM positioning confidence minimum value</td></tr>
<tr><td>ros_pose_quality_max_value</td><td>Int</td><td>1.0</td><td>GIM positioning confidence maximum value</td></tr>
<tr><td>ros_publish_map_to_odom_tf</td><td>Int</td><td>0</td><td>Disable Navitrol to publish coordinate transform <code>map -&gt; odometry</code></td></tr>
<tr><td>ros_publish_odom_to_agv_tf</td><td>Int</td><td>0</td><td>Disable Navitrol to publish coordinate transform <code>odometry -&gt; AGV</code></td></tr>
<tr><td>ros_publish_agv_tf</td><td>Int</td><td>0</td><td>Disable Navitrol to publish coordinate transform <code>AGV -&gt; sensors</code></td></tr>
</tbody></table>
<h4 id="ros---3d-scan-data-visualization"><a class="header" href="#ros---3d-scan-data-visualization">ROS - 3D scan data visualization</a></h4>
<p>Rear scanner data is used for visualizing 2D projected 3D scanner data in Navitrol Monitor. Front scanner data (which contains only couple dummy scan points) is used for disabling the 2D localization interference with 3D positioning.</p>
<p><strong>Note:</strong> Use 0.0 values for the scanner locations/orientations, as the scanner data from 3D position system is received in AGV coordinate frame.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>scan_rear_front_selection</td><td>Int</td><td>3</td><td>Defines which scanners are connected<br/>3 - Rear &amp; front scanners</td></tr>
<tr><td>scan_rear_front_localization_selection</td><td>Int</td><td>2</td><td>Defines which scanners are selected as localization scanner<br/>2 - Front scanner</td></tr>
<tr><td>scanner_model_rear</td><td>Int</td><td>10</td><td>Rear scanner model (ROS)</td></tr>
<tr><td>scan_rear_x</td><td>Float</td><td>0.0</td><td>Rear scanner location along AGV's x-axis</td></tr>
<tr><td>scan_rear_y</td><td>Float</td><td>0.0</td><td>Rear scanner location along AGV's y-axis</td></tr>
<tr><td>scan_rear_sen_ang</td><td>Float</td><td>0.0</td><td>Rear scanner orientation along AGV's yaw-axis</td></tr>
<tr><td>scanner_model_front</td><td>Int</td><td>10</td><td>Front scanner model (ROS)</td></tr>
<tr><td>scan_front_x</td><td>Float</td><td>0.0</td><td>Front scanner location along AGV's x-axis</td></tr>
<tr><td>scan_front_y</td><td>Float</td><td>0.0</td><td>Front scanner location along AGV's y-axis</td></tr>
<tr><td>scan_front_sen_ang</td><td>Float</td><td>0.0</td><td>Front scanner orientation along AGV's yaw-axis</td></tr>
</tbody></table>
<h4 id="sensor-fusion-1"><a class="header" href="#sensor-fusion-1">Sensor fusion</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>sf_use_sensor_fusion</td><td>Int</td><td>1</td><td>Enable Navitrol to use sensor fusion for GIM positioning data</td></tr>
<tr><td>sf_abspos_only</td><td>Int</td><td>1</td><td>Inform Navitrol, that GIM positioning data is global/absolute</td></tr>
<tr><td>sf_abspos_source_arr[0]</td><td>Int</td><td>3</td><td>Inform sensor fusion, that the positioning source is ROS (= GIM)</td></tr>
</tbody></table>
<h4 id="logging-1"><a class="header" href="#logging-1">Logging</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_dump_3d_positioning_logs</td><td>Int</td><td>1</td><td>Defines if 3d positioning logging should be included in Navitrol log file.</td></tr>
</tbody></table>
<h3 id="fine-tuning-5"><a class="header" href="#fine-tuning-5">Fine-tuning</a></h3>
<p><strong>Suggested parameters</strong></p>
<h4 id="sensor-fusion-2"><a class="header" href="#sensor-fusion-2">Sensor fusion</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Suggested value</th><th>Description</th></tr></thead><tbody>
<tr><td>sf_abspos_x_std_arr[0]</td><td>Float</td><td>0.0001</td><td>Standard deviation of x of external loc R matrix [m]</td></tr>
<tr><td>sf_abspos_y_std_arr[0]</td><td>Float</td><td>0.0001</td><td>Standard deviation of y of external loc R matrix [m]</td></tr>
<tr><td>sf_abspos_h_std_deg_arr[0]</td><td>Float</td><td>0.0001</td><td>Standard deviation of h of external loc R matrix [deg]</td></tr>
<tr><td>sf_abspos_limit_corr_arr[0]</td><td>Int</td><td>0</td><td>Filter the maximum correction in each cycle for selected sensor<br/>0 - Don't limit<br/>1 - Limit</td></tr>
<tr><td>sf_abspos_h_max_corr_deg_arr[0]</td><td>Float</td><td>0.3</td><td>Maximum heading correction per cycle for selected sensor in degrees. Only used if <code>sf_abspos_limit_corr for corresponding index</code> is 1</td></tr>
<tr><td>sf_abspos_xy_max_corr_arr[0]</td><td>Float</td><td>0.2</td><td>Maximum xy correction per cycle by selected sensor in meters. Only used if corresponding <code>sf_extloc_limit_corr_arr is 1</code></td></tr>
<tr><td>sf_abspos_max_time_since_valid_meas_ms_arr[0]</td><td>Int</td><td>500</td><td>The maximum time (in ms) since last valid absolute positioning measurement</td></tr>
<tr><td>sf_abspos_max_position_deviation</td><td>Float</td><td>0.15</td><td>The maximum position deviation (x,y) between current and new absolute positioning pose [m]</td></tr>
<tr><td>sf_abspos_max_angle_deviation_deg</td><td>Float</td><td>5.0</td><td>The maximum angular deviation between current and new absolute positioning pose [deg]</td></tr>
</tbody></table>
<h4 id="other-1"><a class="header" href="#other-1">Other</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Suggested value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_ros</td><td>Int</td><td>1</td><td>Enabled ROS data logging in Navitrol</td></tr>
</tbody></table>
<h3 id="start"><a class="header" href="#start">Start</a></h3>
<p>Once both GIM &amp; Navitrol software are installed, configured and calibrated, start all the software by restarting the AGV IPC. For manual software (re)start, check <a href="Localization/3dPositioning/3dPositioning-en.html#system-restart">System restart</a>.</p>
<h3 id="teaching-1"><a class="header" href="#teaching-1">Teaching</a></h3>
<p>Open Navitrol Monitor, and</p>
<ul>
<li>Connect it to the AGV</li>
<li>Start teaching by selecting <code>Navitrol -&gt; Start Teach</code></li>
<li>Drive the AGV manually around in areas intended to be mapped
<ul>
<li><code>Navitrol -&gt; Keyboard Control</code></li>
</ul>
</li>
<li>Stop teaching by selecting <code>Navitrol -&gt; Stop Teach</code></li>
</ul>
<h3 id="generating-environment-and-routes"><a class="header" href="#generating-environment-and-routes">Generating environment and routes</a></h3>
<ul>
<li>Build 3D positioning map with GIM's map editor tool and export files
<ul>
<li><code>&lt;map_name&gt;.mapdb</code></li>
<li><code>&lt;map_name&gt;.pcd</code></li>
</ul>
</li>
<li>Upload the <code>&lt;map_name&gt;.mapdb</code> file to <code>/home/navitec/gim/maps/</code></li>
<li>Open Navithor Tools and open/create a project</li>
<li>Import <code>&lt;map_name&gt;.pcd</code> pointcloud file from <code>Project settings -&gt; Add pointcloud file</code></li>
<li>Generate environment in <code>Environment</code>
<ul>
<li>Select imported pointcloud file</li>
<li>Adjust the z-axis height range for clearer environment visualization (does not have functional effect)</li>
<li>Click <code>Generate</code></li>
</ul>
</li>
<li>Draw the routes in <code>Routes</code></li>
<li>Upload to Navitrol from <code>Export | Upload</code> and request Navitrol to take the files into use</li>
</ul>
<p><img src="Localization/3dPositioning/./media-en/pointcloud_import.jpg" alt="" /></p>
<blockquote>
<p>Import pointcloud file</p>
</blockquote>
<p><img src="Localization/3dPositioning/./media-en/pointcloud_generate.jpg" alt="" /></p>
<blockquote>
<p>Generate environment from pointcloud</p>
</blockquote>
<hr />
<h2 id="how-to-use-10"><a class="header" href="#how-to-use-10">How to use</a></h2>
<p>After</p>
<ul>
<li>Setuping both GIM and Navitrol software</li>
<li>Teaching, generating and uploading environment files</li>
</ul>
<p>Initialize the position (e.g. <code>Set Pos</code> from Monitor) and wait few seconds, that errors</p>
<ul>
<li><code>ERROR_3D_POSITION_NOT_INITIALIZED</code></li>
<li><code>ERROR_ABS_POS_NO_MEAS_RECEIVED</code></li>
<li><code>ERROR_ABS_POS_TOO_LARGE_ESTIMATE_DEVIATION</code></li>
</ul>
<p>disappear. If not, try initializing the position again to the correct location</p>
<p>After successful position initialization, Navitrol can be used as normally. The 3D scanner measurements are visualized as projected 2D scan view on Navitrol Monitor.
<img src="Localization/3dPositioning/./media-en/monitor.jpg" alt="" /></p>
<blockquote>
<p>2D projected visualization of the 3D map and 3D scanner data</p>
</blockquote>
<h3 id="system-restart"><a class="header" href="#system-restart">System restart</a></h3>
<p>To restart both GIM &amp; Navitrol software, either</p>
<ul>
<li>Reboot the IPC/AGV, <em>OR</em></li>
<li>Run the following commands in the IPC
<ul>
<li><code>/home/navitec/gim/gim-navitec-deploy/stop_robot.sh</code> (stops GIM software)</li>
<li><code>sudo killall Navitrol</code> (stops Navitrol software)</li>
<li><code>/home/navitec/ros_config/scripts/startRos.sh</code> (restarts Navitec's ROS Docker container)</li>
<li><code>/home/navitec/gim/gim-navitec-deploy/start_robot.sh</code> (starts GIM software)</li>
<li><code>/home/navitec/Navitrol</code> (starts Navitrol software)</li>
</ul>
</li>
</ul>
<hr />
<h2 id="troubleshooting-27"><a class="header" href="#troubleshooting-27">Troubleshooting</a></h2>
<h3 id="most-common-issues-4"><a class="header" href="#most-common-issues-4">Most common issues</a></h3>
<p>For the following situations, such as</p>
<ul>
<li>Parameters have been changed</li>
<li>Some (specific, predefined) errors/warnings do not disappear</li>
</ul>
<p>check <a href="Localization/3dPositioning/3dPositioning-en.html#system-restart">System restart</a> for restarting the software.</p>
<h3 id="errors-and-warnings-10"><a class="header" href="#errors-and-warnings-10">Errors and warnings</a></h3>
<h4 id="207---error_position_confidence_low-1"><a class="header" href="#207---error_position_confidence_low-1">207 - ERROR_POSITION_CONFIDENCE_LOW</a></h4>
<p>If the error appears often when there is seemingly no reason for it, check that parameters</p>
<ul>
<li><code>ros_pose_quality_*</code> are set correctly</li>
<li><code>pos_conf_limit</code> is tuned correctly</li>
</ul>
<h4 id="564---error_abs_pos_too_large_estimate_deviation"><a class="header" href="#564---error_abs_pos_too_large_estimate_deviation">564 - ERROR_ABS_POS_TOO_LARGE_ESTIMATE_DEVIATION</a></h4>
<p>The obtained absolute positioning pose estimate deviates by more than <code>sf_abspos_max_position_deviation</code> or <code>sf_abspos_max_angle_deviation_deg</code> from the current pose.</p>
<h4 id="617---warning_speed_limited"><a class="header" href="#617---warning_speed_limited">617 - WARNING_SPEED_LIMITED</a></h4>
<p>3D positioning system (if not any other speed limit source) has detected an obstacle in the AGV's movement direction. This might limit AGV's speed down to 0, if the AGV's movement is still towards the obstacle.</p>
<h4 id="839---error_abs_pos_no_meas_received"><a class="header" href="#839---error_abs_pos_no_meas_received">839 - ERROR_ABS_POS_NO_MEAS_RECEIVED</a></h4>
<p>Navitrol has not received any valid absolute positioning measurement in a time interval of parameter <code>sf_abspos_max_time_since_valid_meas_ms</code>.</p>
<h4 id="854---error_3d_position_not_initialized"><a class="header" href="#854---error_3d_position_not_initialized">854 - ERROR_3D_POSITION_NOT_INITIALIZED</a></h4>
<p>Position has not been initialized successfully. Set position (from Navitrol Monitor -&gt; <code>Set Pos</code>) and wait few seconds. Repeat if error does not disappear.</p>
<h4 id="945---warning_initializing_3d_position"><a class="header" href="#945---warning_initializing_3d_position">945 - WARNING_INITIALIZING_3D_POSITION</a></h4>
<p>If this warning does not automatically disappear after few seconds, try initializing the position again</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="start-offset-slowdown"><a class="header" href="#start-offset-slowdown">Start Offset Slowdown</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-21"><a class="header" href="#overview-21">Overview</a></h2>
<p>Start offset slowdown is a feature that limits the maximum acceleration and speed if the AGV has distance error and/or heading error from the path when the drive is started.</p>
<p>The feature can be helpful when using AGV's capable of high speeds and accelerations as without it the AGV might start accelerating to high speed while correcting the position at the same time. Such situation can lead to wheel slip and losing position.</p>
<p><strong>Functional description:</strong> When starting a new drive Navitrol checks if the heading and distance errors are withing given limits (start_offset_slowdown_heading_limit_deg, start_offset_slowdown_dist_limit). If they are withing the limits the slowdown is not triggered and if they are not it is triggered.</p>
<p>When the slowdown is active the acceleration and speed is limited with <strong>start_offset_slowdown_mot_ctrl_max_wheel_v_fw</strong>, <strong>start_offset_slowdown_mot_ctrl_max_wheel_v_bw</strong> and <strong>start_offset_slowdown_mot_ctrl_max_wheel_acc</strong></p>
<p>The slowdown is released when the distance and heading errors have been within the given limits for a time defined by <strong>start_offset_slowdown_release_delay_ms</strong></p>
<h2 id="how-to-use-11"><a class="header" href="#how-to-use-11">How to use</a></h2>
<h3 id="preconditions-2"><a class="header" href="#preconditions-2">Preconditions</a></h3>
<p>None. This feature can be used with any AGV with Navitrol position control.</p>
<h3 id="set-up-3"><a class="header" href="#set-up-3">Set up</a></h3>
<p>Enable setting <strong>I,start_offset_slowdown_enabled,1</strong> and adjust with following parameters.</p>
<table><thead><tr><th>Parameter name</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>start_offset_slowdown_enabled</td><td>0</td><td>Enables check for start offset slowdown, which limits speed and acceleration. Slowdown is activated based on slowdown_heading_offset_limit and slowdown_dist_offset_limit</td></tr>
<tr><td>start_offset_slowdown_heading_limit_deg</td><td>2.0</td><td>Start offset slowdown is activated if AGV's heading offset from the route is more than the given value (degrees).</td></tr>
<tr><td>start_offset_slowdown_dist_limit</td><td>0.1</td><td>Start offset slowdown is activated if AGV's distance offset from the route is more than the given value (meters).</td></tr>
<tr><td>start_offset_slowdown_release_delay_ms</td><td>500</td><td>If start offset slowdown has been activated, it must be within the slowdown_heading_offset_limit and slowdown_dist_offset_limit for given time limit until the slowdon is released</td></tr>
<tr><td>start_offset_slowdown_mot_ctrl_max_wheel_v_fw</td><td>0.8</td><td>Max drive wheel forwards velocity when start offset slowdown is active (m/s). Only used is smaller than original limit</td></tr>
<tr><td>start_offset_slowdown_mot_ctrl_max_wheel_v_bw</td><td>0.8</td><td>Max drive wheel backwards velocity when start offset slowdown is active (m/s). Only used is smaller than original limit</td></tr>
<tr><td>start_offset_slowdown_mot_ctrl_max_wheel_acc</td><td>0.5</td><td>Max aceleration when start offset slowdown is active (m/s^2). Only used is smaller than original limit</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="coupled-driving"><a class="header" href="#coupled-driving">Coupled Driving</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-15"><a class="header" href="#glossary-15">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Formation</td><td>AGVs coupled together driving as a single unit</td></tr>
<tr><td>Formation Error</td><td>Error between nominal and actual position of an AGV within formation</td></tr>
<tr><td>Coupling</td><td>Switching AGV from individual driving state to coupled/formation driving state</td></tr>
<tr><td>Decoupling</td><td>Switching AGV from coupled/formation driving state to individual driving state</td></tr>
<tr><td>Formation Navigation Point</td><td>Formation or Load navigation point is the point on load that should follow route defined for coupled driving</td></tr>
</tbody></table>
<hr />
<h2 id="introduction-30"><a class="header" href="#introduction-30">Introduction</a></h2>
<p>Coupled driving in Navitrol allows two AGVs to drive in a formation maintaining fix relative position to each other.
This feature enables transportation of large objects with multiple AGVs.</p>
<p>Navitrol uses a Leader-Follower architecture for coordinated motion of the AGVs, one of the AGV in formation is designated as Leader whereas other is Follower.
Leader AGV ensures position control and route following of the formation by commanding all AGVs with reference drive commands.
Follower AGVs in addition to following drive commands from Leader, try to minimize the relative error from load all the time.</p>
<h2 id="system-requirements-1"><a class="header" href="#system-requirements-1">System Requirements</a></h2>
<p>Coupled driving requires all AGVs in formation to drive synchronously and keep the formation intact. To ensure this, the system must fulfil following requirements:</p>
<ul>
<li><strong>Omni Kinematics</strong></li>
</ul>
<p>Coupled Driving is supported only for Omni kinematic AGVs</p>
<ul>
<li><strong>Identical control response</strong></li>
</ul>
<p>It is critical that response of AGVs to drive command is similar. It is therefore recommended to use identical AGVs for coupled driving.</p>
<ul>
<li><strong>Error measurement on each machine relative to Load</strong></li>
</ul>
<p>To keep the formation intact during driving, Follower AGVs need error measurement relative to their nominal position in formation. More details in <em>Formation Error Sensor Setup</em> section.</p>
<ul>
<li><strong>Fast and reliable communication between AGVs</strong></li>
</ul>
<p>Leader-Follower architecture requires continuous flow of data between AGVs. It is essential to have a reliable communication between AGVs.
More details in <em>Communication Between Coupled AGVs</em> section.</p>
<ul>
<li>
<p><strong>Identical Navitrol version</strong>  All AGVs in coupled driving must be running identical Navitrol version.</p>
</li>
<li>
<p><strong>Unique machine_id</strong> All AGVs must have unique machine_id parameter value.</p>
</li>
<li>
<p><strong>Identical mapping and localization</strong> All AGVs must have identical coordinate reference for localizations. Additionally, during coupled driving, each AGV must have correct position fix.</p>
</li>
</ul>
<h2 id="coupled-driving-1"><a class="header" href="#coupled-driving-1">Coupled Driving</a></h2>
<p>Coupled driving allows AGVs to transport load larger than possible with a single AGV. When in formation, AGVs need to move in coordination and navigation has to be done for load instead of for individual AGVs. This requires defining a navigation point on load, which will follow route defined for coupled driving.</p>
<h3 id="coupling-formation-configuration"><a class="header" href="#coupling-formation-configuration">Coupling Formation Configuration</a></h3>
<p>Formation configuration is defined in formation frame of reference with origin at navigation point of the load and x-axis in the direction of desired load heading.</p>
<p>Formation configuration include:</p>
<ul>
<li>
<p>Nominal pose of AGVs relative to formation navigation point</p>
</li>
<li>
<p>Dimensions of the load</p>
</li>
<li>
<p>IPs for establishing communication between AGVs</p>
</li>
</ul>
<p>Configurations is specified as part of coupling command through Navithor or Supervisor interface. Please see corresponding interface documentation for more details.</p>
<p>Figure 1 below shows a simple formation setup and associated dimensions. Nominal pose of AGVs is specified in Load reference frame; i.e., in Figure 1 AGV1 and AGV2 have nominal pose (x, y, h) to be (X, 0, 0) and (-X, 0, 0) respectively; where X is the AGV distance from origin on x axis.</p>
<p><img src="PositionControl/CoupledDriving/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1 Simple coupled drive formation</p>
</blockquote>
<p>It is also possible to define a formation with non-zero AGV nominal headings. &gt; Figure 2 shows an example of such formation where AGVs are on Y axis on the load and have a nominal heading of 180 degrees with the load. The nominal position in formation reference frame for AGV1 and AGV2 in this case will be (0, -Y, 180°) and (0, Y, 180°)  respectively.</p>
<p><img src="PositionControl/CoupledDriving/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2 Coupled formation with 180 degrees difference between Load and AGV heading</p>
</blockquote>
<p>It is recommended to have AGVs symmetric around the load in formation.
AGVs must also be collinear with the Load navigation point. Furthermore, it is recommended to define formation with heading along the length of the load (as in Figure 1).Figure 2 Coupled formation with 180 degrees difference between Load and AGV heading</p>
<h3 id="coupled-state"><a class="header" href="#coupled-state">COUPLED state</a></h3>
<p>All AGVs in formation are in COUPLED state during coupled driving. This state is activated by sending coupling command to Navitrol from Fleet control or Supervisor interface. Transition to COUPLED state is only possible from STANDBY state.</p>
<p>Transition to and from COUPLED state is further described in Coupling Commands section.</p>
<p>In COUPLED state, Navitrol uses a different segment file than normal driving. The segment file for coupled drive is named with <strong>segCD_</strong> prefix. Navithor tools can be used to generate coupled driving segment file.</p>
<h3 id="coupling-modes"><a class="header" href="#coupling-modes">Coupling Modes</a></h3>
<p>Navitrol is in one of the Coupling Modes when COUPLED state is active.
Coupling mode defines AGV's role within coupled drive. Desired mode for an AGV is specified at the time of coupling in coupling command.</p>
<p>Following are three possible coupling modes:</p>
<ul>
<li>
<p><strong>Decoupled</strong>
When coupled driving is not active, coupling mode is Decoupled.</p>
</li>
<li>
<p><strong>Follower</strong>
AGV in Follower coupling mode follows drive commands from the Leader AGV. During driving, Follower AGV also minimizes error from nominal position in formation using a local PI controller.</p>
</li>
<li>
<p><strong>Leader</strong>
Leader AGV is the brain of coupled formation. Responsibilities of Leader include localization and position control of formation, and coordination between all AGVs in formation. All communication related to drive orders and status messages with fleet control or supervisor system are also done through Leader AGV. Since position control for coupled formation is running on the Leader, it has a coupled driving state (STANDBY/AUTO/FSTOP etc.) in addition to normal Navitrol state that stays COUPLED during coupled driving.</p>
</li>
</ul>
<h3 id="coupling-commands"><a class="header" href="#coupling-commands">Coupling Commands</a></h3>
<p>To start coupled driving, machines must be switched to COUPLED state.
This is done through coupling commands. The command can be sent through fleet control or supervisor interface. Detailed command structure could be found in relevant communication interface specifications.</p>
<p>Coupling commands include:</p>
<ul>
<li>
<p><strong>Coupling Command</strong> Coupling command is required to switch to COUPLED state. The command specifies mode of coupling and other details required to establish the coupled formation. Following are the important points to consider for coupling command:</p>
<ul>
<li>
<p>Coupling is possible only in STANDBY state</p>
</li>
<li>
<p>Both Follower and Leader must be commanded to COUPLED state individually. It is recommended to first command Follower to COUPLED state.</p>
</li>
<li>
<p>Coupling as Leader requires details about formation (size, configuration, Follower IPs, machine ids etc.)</p>
</li>
<li>
<p>Command could get rejected if coupling with specified configuration is not possible</p>
</li>
<li>
<p>Response indicates success or failure of coupling command</p>
</li>
</ul>
</li>
<li>
<p><strong>Decoupling Command</strong> Decoupling command is needed to switch from COUPLED state back to STANDBY state. Following are a few points to consider when Decoupling:</p>
<ul>
<li>
<p>Decoupling is possible only when coupled driving state is STANDBY, FSTOP or START</p>
</li>
<li>
<p>All AGVs in formation must be decoupled individually</p>
</li>
<li>
<p>Response indicates success or failure of decoupling</p>
</li>
</ul>
</li>
<li>
<p><strong>Coupling Status</strong>
When Navitrol is in COUPLED state, a Coupling Status message indicates status of coupled driving. Though both Leader and Follower AGVs can send coupling status message, complete information is available only in the status from Leader machine. Coupling status can be received through both Navithor or Supervisor interface.</p>
</li>
</ul>
<h3 id="communication-between-coupled-agvs"><a class="header" href="#communication-between-coupled-agvs">Communication Between Coupled AGVs</a></h3>
<p>Coupled driving required a fast and reliable communication link between Leader and Followers at all times. Leader machine connects to Follower with a TCP stream connection. IP of the Follower machine must be provided in coupling command to Leader machine. For reliable communication, there should be a peer-to-peer communication link between Leader and Follower AGVs.</p>
<p>Navitrol establishes a one-to-one TCP connection between Leader and Follower AGVs to enable communication. In each control cycle, Leader sends a status request to Followers and expects a status response in return. On receiving response from all AGVs, a drive command is computed and sent to each AGV. For smooth coupled control, it is essential that request-to-response time between AGVs is no more than 40ms.</p>
<p>In addition to IPs in coupling command, following parameters should be configured properly in parameters:</p>
<ul>
<li>
<p>navicomm_inte_ip: Required when using Navithor fleet control and IP for coupled driving communication is different than Navitrol-Navithor communication.</p>
</li>
<li>
<p>navicomm_inte_port: Must be same on all AGVs to be coupled.</p>
</li>
</ul>
<h3 id="formation-error-measurements"><a class="header" href="#formation-error-measurements">Formation Error Measurements</a></h3>
<p>During coupled driving, formation error measurements are used to keep the machine close to their nominal orientations within the formation. A formation error control actively minimizes these errors.</p>
<p>Formation error measurement is the measure of AGV pose relative to its nominal pose in formation. Since nominal pose is fixed relative to the load, formation error measurement is also a load relative measurement.
Figure 3 shows formation error measurement for one AGV in the formation.</p>
<p>Different option to configure these measurements are described in Section <em>Formation Error Sensor Setup</em>.</p>
<p><img src="PositionControl/CoupledDriving/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 3: Formation Error Measurement for one AGV</p>
</blockquote>
<p>In a two AGV formation, Leader AGV can only have header error, whereas the follower can have error in heading and the axis aligned with leader.
Figure 4 shows one such formation where AGV-1 is the Leader-</p>
<p><img src="PositionControl/CoupledDriving/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 4: Formation Error measurements for 2 AGV formation</p>
</blockquote>
<h3 id="driving-in-coupled-state"><a class="header" href="#driving-in-coupled-state">Driving in COUPLED State</a></h3>
<p>Once all AGVs are in coupled mode and communication between AGVs has been established, it is possible to drive the formation. Drive commands and status related communication is possible only through Leader. Drive commands can be sent from Fleet control, Supervisor interface or Navitrol Monitor in the same way as done for a single AGV.</p>
<p>During the driving, a 2-layered control is executed to follow the driving route and keep the formation intact. The two layers are formation position control on Leader AGV and formation error control individually on all AGVs in the formation.</p>
<h3 id="position-control-1"><a class="header" href="#position-control-1">Position Control</a></h3>
<p>Position control during coupled drive needs to ensures that the navigation point on load follows defined route. As described in communication section, Leader AGV requests status update from all AGVs in each cycle. Once status update is received from all AGVs, following steps are executed for position control:</p>
<ul>
<li>
<p><strong>Formation Localization</strong>: Position of load is estimated from position of the AGVs and formation error measurements</p>
</li>
<li>
<p><strong>Formation Position Control</strong>: Drive reference is computed for formation.</p>
</li>
<li>
<p><strong>Drive Commands for each AGV</strong>: Formation drive reference is transformed to drive reference for each AGV.</p>
</li>
</ul>
<h3 id="minor-features"><a class="header" href="#minor-features">Minor features</a></h3>
<p><strong>Direction change delay</strong>
Direction change delay can be used to define a period of zero speed reference when the formation speed reference changes direction and when pivot starts or ends. The delay is defined by the <strong>pc_direction_change_wait_ms</strong>-parameter and by default it is 500 milliseconds.</p>
<h3 id="formation-error-control"><a class="header" href="#formation-error-control">Formation Error Control</a></h3>
<p>To keep each AGV at it nominal position within formation, an additional formation error PI control tries to minimize <em>Formation Error Measurements</em>. This controller continuously adjusts the drive command from Leader Position control; thereby reducing the formation error alongside following the Leader drive command.</p>
<p>It is essential to monitor formation errors and tune controller gains such that the error remains within acceptable range during driving.
Controller gain parameters are listed in Section <em>Parameters</em>. Formation errors of both Leader and Follower AGVs can be monitored through &quot;Coupled Drive Formation Errors&quot; chart in Navitrol Monitor as shown in Figure 5. Error measurements are available only through Leader AGV.</p>
<p><img src="PositionControl/CoupledDriving/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 5: Formation Errors chart in Navitrol Monitor on Leader AGV</p>
</blockquote>
<h4 id="override-formation-error-controller"><a class="header" href="#override-formation-error-controller">Override Formation Error Controller</a></h4>
<p>To better tune the controller around small formation errors, it is possible to define an override region around zero error where a separate set of formation error control gains will be used by the controller. These override gains are used only if non-zero limits are defined for override region. The relevant parameter for override controller can be found in Section <em>Parameters</em>, group <em>Override Formation Error Control Parameters</em>.</p>
<h4 id="disable-formation-error-controller"><a class="header" href="#disable-formation-error-controller">Disable Formation Error Controller</a></h4>
<p>It is possible to disable formation error control on specific route segments by setting a disable property in route custom properties using Navithor Tools. This might be needed on short segments where either formation error measurement is not possible or formation error control is not needed for any other reason. However, it is not recommended to
disable it for long drive segments since that may result in AGVs drift away from their nominal position in formation.</p>
<p>Custom route property name for disabling formation error control is &quot;FormationErrCtrlDisabled&quot; by default. Property value must be set to 1 through Navithor Tools for disabling formation error control on specific route segments.</p>
<h2 id="formation-error-sensor-setup"><a class="header" href="#formation-error-sensor-setup">Formation Error Sensor Setup</a></h2>
<p>Three types of sensor setups are possible for formation error measurements. Appropriate sensor setup can be configured through coupled_formation_err_sensor parameter.</p>
<h3 id="simulated-formation-error-sensor"><a class="header" href="#simulated-formation-error-sensor">Simulated formation error sensor</a></h3>
<p>Navitrol compares coupling configuration and localization from each AGV to estimate the formation error. However, due to possible imprecisions and low frequency of measurements, this is only recommended for simulations or preliminary testing.
Parameter coupled_formation_err_sensor should be set to 0 on all AGVs for simulated error measurements.</p>
<h3 id="load-relative-sensor"><a class="header" href="#load-relative-sensor">Load relative sensor</a></h3>
<p>AGV can have on-board sensors (e.g., laser measurements) to continuously measure distance and heading errors relative to load after coupling. These measurements can be sent to Navitrol through CAN or Supervisor interface. To configure load relative sensor measurements for formation error, coupled_formation_err_sensor parameter must be set to 1 on all AGVs.</p>
<h3 id="formation-error-from-pattern-detection"><a class="header" href="#formation-error-from-pattern-detection">Formation error from pattern detection</a></h3>
<p>Pattern-detection based formation error measurement requires reflector pattern installed on Follower machine that can be seen by the Leader during coupled drive. Based on coupling and pattern configurations, Leader AGV computes relative distance and heading error between AGVs and transforms it to formation error measurements.</p>
<p>Following parameters must be configured correctly to use pattern detection for formation errors:</p>
<ul>
<li>
<p>On Leader AGV:</p>
<ul>
<li>
<p>Sensor type: coupled_formation_err_sensor to 2</p>
</li>
<li>
<p>Reflector Pattern: See pattern detection document.</p>
</li>
</ul>
</li>
<li>
<p>On Follower AGV:</p>
<ul>
<li>
<p>Sensor type: coupled_formation_err_sensor to 2</p>
</li>
<li>
<p>Reflector board position in vehicle reference frame:
<em>pattern_detection_refl_board_pos_x</em>
<em>pattern_detection_refl_board_pos_y</em>
<em>pattern_detection_refl_board_pos_angle_deg</em></p>
</li>
</ul>
</li>
</ul>
<h2 id="actuator-control-1"><a class="header" href="#actuator-control-1">Actuator Control</a></h2>
<p>Navitrol supports binary actuator control during coupled driving.
Actuator control signals are sent through Leader AGV only and status signals are also expected from Leader AGV. Additionally, actuator control is supported only when formation is in LOAD state at load/unload points. There will be no actuator action during coupled AUTO driving.</p>
<p>Actuator control in coupled driving is disabled by default. It could be enabled by setting the parameter coupled_actuator_control to 1. Note that despite this parameter being set to 1, coupled actuator control will work only if actuator_type parameter is set to binary actuator control (value 3).</p>
<h2 id="external-localization-in-coupled-driving"><a class="header" href="#external-localization-in-coupled-driving">External Localization in Coupled Driving</a></h2>
<p>Basic concept of external localization remains the same in coupled drive system. There are no extra parameters either. In coupled drive, it is required that both AGVs have two PGV cameras installed. The cameras should be installed in machine coordinates to the X-axis or to the Y-axis passing navigation point. The cameras should be in the opposite
sides relative to navigation point (see &gt; Figure 6). External localization is active when at least 3 out of 4 PGVs can read measurements from the data matrix.</p>
<p>The AGVs must also be in the coupled configuration so that their navigation point lies on the coupled system's X-axis or Y-axis (see Figure 7). The heading of AGVs relative to the coupled system can be freely chosen as longs as the previous conditions hold. Coupled system can be driven longitudinally or transversally and it can follow one to four data matrix tapes depending on the configuration. The more data matrix tapes it must follow, the more burdensome is the teaching process of the lines into map. Define only one connection per data matrix tape in Navithor Tools. A few example configurations are shown in Figure 8.</p>
<p><img src="PositionControl/CoupledDriving/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 6: Possible camera placements</p>
</blockquote>
<p><img src="PositionControl/CoupledDriving/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 7: AGV positions on X-axis or Y-axis of coupled system</p>
</blockquote>
<p><img src="PositionControl/CoupledDriving/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 8: Different possible configurations of AGVs in the coupled system. There can be one to four data matrix lines that the coupled system can follow.</p>
</blockquote>
<h2 id="obstacle-detection-and-obstacle-avoidance-during-coupled-driving"><a class="header" href="#obstacle-detection-and-obstacle-avoidance-during-coupled-driving">Obstacle detection and obstacle avoidance during Coupled driving</a></h2>
<p>If obstacle detection and obstacle avoidance features are enabled for a single AGV, they will be disabled for the duration of coupled driving.</p>
<h2 id="warnings-and-errors"><a class="header" href="#warnings-and-errors">Warnings and Errors</a></h2>
<p>In addition to normal position control warnings and errors, following are coupled driving specific errors.</p>
<table><thead><tr><th>Error</th><th>Description</th><th>Comments</th></tr></thead><tbody>
<tr><td>ERROR_COUPLED_DRIVE_COMMS</td><td>Communication error with one or more machines in coupled drive</td><td>Make sure that IPs and machine ids in coupling command are correct and AGVs are able to ping each other over configured network.</td></tr>
<tr><td>ERROR_NAVI_COMM_VERSION</td><td>Version mismatch in Navitrol-Navitrol communication</td><td>Check Navitrol versions on coupling machines and ensure that they are the same.</td></tr>
<tr><td>ERROR_COUPLED_DRIVE_CONFIG</td><td>Invalid configuration for coupled drive</td><td>Make machine types and load configurations are supported by Navitrol.</td></tr>
<tr><td>ERROR_LARGE_FORMATION_ERR</td><td>Formation error is larger than configured limits</td><td>If active at the time of coupling, ensure that AGVs are at correct positions and formation configuration is correct.<br>If recurring during driving, tune coupled control parameters.</td></tr>
<tr><td>ERROR_COUPLED_FORMATION_OFFSET_DETECTION</td><td>Coupled formation offset detection measurement failure</td><td>Formation error measurements not received by Navitrol. Check error sensor setup.</td></tr>
<tr><td>ERROR_COUPLED_DRIVE_ACTIVE_ERRORS</td><td>Errors are active on one or more machines in coupled drive</td><td>Resolve any active errors on coupled AGVs before coupled driving.</td></tr>
</tbody></table>
<h2 id="parameters-3"><a class="header" href="#parameters-3">Parameters</a></h2>
<p>Coupled drive related Navitrol parameters are listed in table below:</p>
<table><thead><tr><th>Name</th><th>Data Type</th><th>Default Value</th><th>Comments</th></tr></thead><tbody>
<tr><td><strong>Basic Configurations</strong></td><td></td><td></td><td></td></tr>
<tr><td>coupled_drive_enabled</td><td>Int</td><td>0: disabled</td><td>Enable/disable coupled driving feature</td></tr>
<tr><td>coupled_max_drive_v</td><td>Float</td><td>0.3 m/s</td><td>Maximum allowed driving velocity in coupled driving</td></tr>
<tr><td>coupled_actuator_control</td><td>Int</td><td>0: disabled</td><td>Enable/disable actuator control in coupled driving</td></tr>
<tr><td><strong>Formation Error Sensor configuration</strong></td><td></td><td></td><td></td></tr>
<tr><td>coupled_formation_err_sensor</td><td>UInt</td><td>0: Simulated from localization</td><td>Configures the type of sensor setup used for formation error measurements.<br><br>0: Simulated<br>1: Measurements from CAN/Supervisor interface<br>2: Pattern-detection based error calculation</td></tr>
<tr><td>coupled_formation_err_disable_route_property</td><td>String</td><td>FormationErrCtrlDisabled</td><td>Name of route property that can be used to disable coupled formation error on specific routes.</td></tr>
<tr><td>coupled_formation_offset_max_read_fail_count</td><td>Int</td><td>5</td><td></td></tr>
<tr><td><strong>CAN sensors for Formation Err</strong></td><td></td><td></td><td></td></tr>
<tr><td>coupled_formation_err_x_can_enc_idx</td><td>Int</td><td>-1</td><td></td></tr>
<tr><td>coupled_formation_err_h_can_enc_idx</td><td>Int</td><td>-1</td><td></td></tr>
<tr><td><strong>Reflector Pattern for Formation Err</strong></td><td></td><td></td><td></td></tr>
<tr><td>pattern_detection_refl_board_pos_x</td><td>Float</td><td>0.0 m</td><td>X position of reflector pattern in vehicle coordinate frame</td></tr>
<tr><td>pattern_detection_refl_board_pos_y</td><td>Float</td><td>0.0 m</td><td>Y position of reflector pattern in vehicle coordinate frame</td></tr>
<tr><td>pattern_detection_refl_board_angle_deg</td><td>Float</td><td>0.0 m</td><td>Angle of reflector pattern in vehicle coordinate frame</td></tr>
<tr><td><strong>Communication Parameters</strong></td><td></td><td></td><td></td></tr>
<tr><td>navicomm_inte_ip</td><td>String</td><td></td><td>IP for AGV-to-AGV communication -- empty bydefault.<br>Required only when AGV-to-AGV communication has a dedicated network and Navithor fleet control is in use.</td></tr>
<tr><td>navicomm_inte_port</td><td>Int</td><td>1236</td><td>Port used for AGV-to-AGV communication.<br>Must be identical on all AGVs in coupled driving</td></tr>
<tr><td>coupled_comm_status_update_interval_ms</td><td>Int</td><td>100 ms</td><td></td></tr>
<tr><td>coupled_comm_control_ref_timeout_ms</td><td>Int</td><td>200 ms</td><td></td></tr>
<tr><td>coupled_comm_loss_stop_time</td><td>Float</td><td>2.0 sec</td><td></td></tr>
<tr><td>coupled_comm_loss_fstop_timeout</td><td>Float</td><td>5.0 sec</td><td></td></tr>
<tr><td><strong>Formation Error Control Parameters</strong></td><td></td><td></td><td></td></tr>
<tr><td>coupled_pid_heading_err_p</td><td>Float</td><td>1.0</td><td>Proportional gain for heading error</td></tr>
<tr><td>coupled_pid_heading_err_i</td><td>Float</td><td>0.0</td><td>Integral gain for heading error</td></tr>
<tr><td>coupled_pid_lon_dist_err_p</td><td>Float</td><td>2.0</td><td>Proportional gain for distance error in the direction of motion</td></tr>
<tr><td>coupled_pid_lon_dist_err_i</td><td>Float</td><td>0.0</td><td>Integral gain for distance error in the direction of motion</td></tr>
<tr><td>coupled_pid_trans_dist_err_p</td><td>Float</td><td>2.0</td><td>Proportional gain for distance error perpendicular to direction of motion</td></tr>
<tr><td>coupled_pid_trans_dist_err_i</td><td>Float</td><td>0.0</td><td>Integral gain for distance error perpendicular to direction of motion</td></tr>
<tr><td>coupled_pid_delta_v_lim</td><td>Float</td><td>0.2 m/s</td><td>Maximum allowed change in velocity due to formation error compensation</td></tr>
<tr><td>coupled_pid_delta_c_lim</td><td>Float</td><td>0.3</td><td>Maximum allowed change in curvature due to formation error compensation</td></tr>
<tr><td><strong>Override Formation Error Control Parameters</strong></td><td></td><td></td><td></td></tr>
<tr><td>coupled_pid_override_lon_dist_err_cm</td><td>Float</td><td>0.0</td><td>Coupled drive longitudinal distance error controller will use override gains if error is below this distance</td></tr>
<tr><td>coupled_pid_override_trans_dist_err_cm</td><td>Float</td><td>0.0</td><td>Coupled drive transversal distance error controller will use override gains if error is below this distance</td></tr>
<tr><td>coupled_pid_override_head_err_deg</td><td>Float</td><td>0.0</td><td>Coupled drive heading error controller will use override gains if error is below this limit</td></tr>
<tr><td>coupled_pid_override_heading_err_p</td><td>Float</td><td>0.0</td><td>Coupled drive controller gain for heading error control in override control region</td></tr>
<tr><td>coupled_pid_override_lon_dist_err_p</td><td>Float</td><td>0.0</td><td>Coupled drive controller gain for longitudinal distance error control in override control region</td></tr>
<tr><td>coupled_pid_override_trans_dist_err_p</td><td>Float</td><td>0.0</td><td>Coupled drive controller gain for transversal distance error control in override control region</td></tr>
<tr><td><strong>Formation Error Diagnostics Parameters</strong></td><td></td><td></td><td></td></tr>
<tr><td>coupled_max_dist_err_cm</td><td>Float</td><td>3.0 cm</td><td>An error will be raised if error between nominal and current AGV position exceeds this limit</td></tr>
<tr><td>coupled_max_head_err_deg</td><td>Float</td><td>2.0 degree</td><td>An error will be raised if error between nominal and current AGV heading exceeds this limit</td></tr>
</tbody></table>
<h2 id="quick-start-guide"><a class="header" href="#quick-start-guide">Quick Start Guide</a></h2>
<p>Please ensure system requirements listed in Section <em>System Requirements</em> before starting this guide. Follow the steps below to start coupled driving.</p>
<ol>
<li>
<p>Enable coupled driving on each AGV
Copy the parameter below in params.txt file
<strong>I,coupled_drive_enabled, 1</strong>
Note that this requires feature license for coupled driving.</p>
</li>
<li>
<p>Check Formation Error Sensor Settings
For preliminary testing, localization-based simulation of sensor setup can be used with following parameter:
<strong>U,coupled_formation_err_sensor, 0</strong>
Refer to Section <em>Formation Error Sensor Setup</em> for correct configuration according to formation error sensors present on AGVs.</p>
</li>
<li>
<p>Drive AGVs to coupling start position
Drive individual AGVs to coupled driving start positions on the map.
Start positions must correspond to desired coupling formation configuration as specified in Section <em>Coupling Formation Configuration</em>.</p>
</li>
<li>
<p>Command AGVs to COUPLED state
AGVs can be commanded to coupled state from Navithor or Supervisor interface. Navitrol state will change to COUPLED if coupling command was successful.</p>
</li>
<li>
<p>Ensure that machines are coupled and no errors are active
COUPLED state indicates that an individual AGV is in coupled driving mode; however, it may not be connected to formation yet. Leader AGV will load coupled driving segment file when switched to COUPLED state.
<strong>ERROR_COUPLED_DRIVE_COMMS</strong> remains active until communication is established between the AGVs. If communication error is active after all AGVs has been switched to COUPLED state, it may indicate an error in IP configurations or communication network.
Before starting coupled driving, ensure that no errors are active on any AGV in formation. Formation state can be monitored through Leader AGV (from Monitor, Supervisor or Navithor). Formation must be in STANDBY state for auto driving.</p>
</li>
<li>
<p>Drive Order
Once coupling has been successful and there are no active errors, drive orders can be sent to Leader AGV the same way as sent to a single AGV. This can be done through Monitor, Navithor or Supervisor interface.</p>
</li>
<li>
<p>Tune formation error controllers
When configuring the feature for first time, it is essential to monitor formation errors and calibrate error control parameters accordingly for acceptable machine response. List of controller parameters can be found in Section <em>Parameters</em>.</p>
</li>
<li>
<p>Adjust Coupled Driving Configuration
A list of settings for coupled driving including maximum allowed formation errors, max drive velocity, actuator control etc. can be configured through parameters. All coupled driving parameters are listed in Section <em>Parameters</em>.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="line-following-with-a-magnetic-tape-sensor"><a class="header" href="#line-following-with-a-magnetic-tape-sensor">Line following with a magnetic tape sensor</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-22"><a class="header" href="#overview-22">Overview</a></h2>
<h3 id="introduction-31"><a class="header" href="#introduction-31">Introduction</a></h3>
<p>The feature is used for following a magnetic tape, allowing for more precise docking and position control. It is used for position control, but not for localization. For localization and position control or for accurate stopping when docking, the data matrix feature is required. The sensor provides a lateral error and is of use when the route segment requires high lateral accuracy. The AGV drives with laser scanner localization until the tape is detected. Then it disables the horizontal laser scanner corrections and uses the magnetic line instead until the drive is finished or the magnetic tape is no longer detected. The AGV follows the magnetic tape when present and the feature is enabled for the route segment and therefore limits the versatility of the AGV.</p>
<h3 id="requirements-14"><a class="header" href="#requirements-14">Requirements</a></h3>
<ul>
<li>SICK MLS magnetic tape sensor</li>
<li>External localization license</li>
<li>Web UI for teaching</li>
<li>Magnetic tape. See SICK MLS manual for more information</li>
</ul>
<h3 id="limitations-9"><a class="header" href="#limitations-9">Limitations</a></h3>
<ul>
<li>Not supported in curved routes and intersections</li>
<li>Teaching of line points only with Web UI</li>
</ul>
<h2 id="setup-17"><a class="header" href="#setup-17">Setup</a></h2>
<h3 id="quick-start-6"><a class="header" href="#quick-start-6">Quick start</a></h3>
<p>The sensor measures the offset to the sensor's geometrical center point in millimeters. A measurement is obtained if a magnetic tape is detected, and its track level (induction) is above a certain threshold. The sensor has two LEDs, when the magnetic tape is detected with sufficient field strength the first LED is yellow and the second one is green or blue. The light of the second LED depends on which side of the sensor's centre point the magnetic line is detected. Avoid initializing the sensor on magnetic tape, as this might result in non-deterministic measurements. Powering off the device can fix the issue. See Sick MLS manual for more information.</p>
<p>The AGV will minimize its the error with respect to the magnetic tape, and follow the magnetic tape instead of the route if the two diverge. During docking with magnetic line following, a magnetic tape equaling a distance of at least <strong>line_following_sensor_pos_x[0]</strong> or <strong>line_following_sensor_pos_x[1]</strong>, depending on which sensor is first to detect the magnetic tape, is assumed after the last trajectory point. </p>
<p>The nominal sensor position is determined by parameters <strong>line_following_sensor_pos_x</strong> and <strong>line_following_sensor_pos_y</strong> with respect to the AGV's navigation point for each sensor. Negative measurements are obtained from the centre towards the cable outlet. </p>
<p>In the below Figure <strong>line_following_sensor_flipped[0]</strong> is 0 and <strong>line_following_sensor_flipped[1]</strong> would be 1.  The navigation point is represented as a black circle and the nominal sensor position line as a dashed orange line in the below Figure. The y-deviation with respect to the nominal sensor position (dashed orange line) is defined by parameter <strong>line_following_sensor_offset_y</strong> for each sensor, visualized as offset1 y in the Figure</p>
<p><img src="PositionControl/MagneticLineFollowing/./media-en/sensor_pos.png" alt="" />
&gt;&gt; Line following sensor positions</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>line_following_sensor_communication</td><td>Int</td><td>0</td><td>0 - disabled, 1 - CAN, 2 - Ethernet</td></tr>
<tr><td>line_following_sensor_model[]</td><td>Int</td><td>0</td><td>0 - disabled, 1 - Sick MLS</td></tr>
<tr><td>line_following_sensor_pos_x[]</td><td>Float</td><td>0.0</td><td>The sensor X-position with respect to navigation point. See above Figure for reference</td></tr>
<tr><td>line_following_sensor_pos_y[]</td><td>Float</td><td>0.0</td><td>The sensor Y-position with respect to navigation point. See above Figure for reference</td></tr>
<tr><td>line_following_sensor_offset_y[]</td><td>Float</td><td>0.0</td><td>The y deviation from the nominal sensor position. See above Figure for reference</td></tr>
<tr><td>line_following_sensor_flipped[]</td><td>Int</td><td>0</td><td>A flipped sensor will give wrong signs for the measurements, to transform the measurements to machine coordinate frame, parameter <strong>line_following_sensor_flipped</strong> is introduced. See above Figure for reference</td></tr>
<tr><td>line_following_max_dist_since_last_meas</td><td>Float</td><td>0.1</td><td>Maximum allowed driven distance between two measurements before error</td></tr>
</tbody></table>
<h4 id="teaching-the-magnetic-line"><a class="header" href="#teaching-the-magnetic-line">Teaching the magnetic line</a></h4>
<p>The principle of teaching the magnetic line is the same as for teaching external localization tape. The basis of saving teach points, can be time, distance or user input. The parameters introduced below are for saving on a distance basis. For more information on the parameters and the procedure, see document <a href="PositionControl/MagneticLineFollowing/../../Localization/ExternalLocalization/ExternalLocalization-en.html">External localization</a></p>
<p>Teaching is done via web UI. Drive the AGV along the magnetic tape with the feature enabled and the parameters set. The below parameters are for teaching the magnetic line points based on distance.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>teach_file_format</td><td>Int</td><td>5</td><td>Required for teaching magnetic tapes. See external localization document for more information</td></tr>
<tr><td>ext_loc_teach_mode</td><td>Int</td><td>3</td><td>Distance based teaching of points. See external localization document for more information</td></tr>
<tr><td>ext_loc_teach_interval_dist</td><td>Float</td><td>0.1</td><td>Distance between teach points. See external localization document for more information</td></tr>
</tbody></table>
<p>Add the teach file into Tools. Under Routes → Route properties, select 'MagneticLineFollowing' as visualized in the Figure below.</p>
<p><img src="PositionControl/MagneticLineFollowing/./media-en/teach_file_tools.PNG" alt="" />
&gt;&gt; Teach points in Tools</p>
<h4 id="can-setup"><a class="header" href="#can-setup">CAN setup</a></h4>
<p>The baud-rate and node-id must be modified for allowing CAN communication with Navitrol. The default node-id for the sensor is 10, in decimal, and the default baud rate is 125k. Changing the default node id and baudrate can be done via e.g. CANKing. Set the device to pre-operational state with the following instructions in the below Figure</p>
<p><img src="PositionControl/MagneticLineFollowing/./media-en/can_setup.png" alt="" />
&gt;&gt; Setup of node-id and baudrate in CANKing</p>
<p>Send the following commands to the device to change node-id and baudrate. Baudrate 250 Bd corresponds to 03. Restart the device after saving the new parameters. The below table is described in hexadecimal.</p>
<p><strong>Setting node-id and baudrate via CAN</strong></p>
<table><thead><tr><th>CAN identifier</th><th>Byte 0</th><th>Byte 1</th><th>Byte 2</th></tr></thead><tbody>
<tr><td>7E5</td><td>04</td><td>01</td><td>00</td></tr>
<tr><td>7E5</td><td>5E</td><td>00</td><td>00</td></tr>
<tr><td>7E5</td><td>11</td><td>NodeId</td><td>00</td></tr>
<tr><td>7E5</td><td>13</td><td>00</td><td>Baudrate</td></tr>
<tr><td>7E5</td><td>17</td><td>00</td><td>00</td></tr>
<tr><td>7E5</td><td>04</td><td>00</td><td>00</td></tr>
</tbody></table>
<p>See Sick MLS manual for more information regarding Sick MLS specific parameters.</p>
<h4 id="ethernet-protocol"><a class="header" href="#ethernet-protocol">Ethernet protocol</a></h4>
<p>The message structure for each sensor is the same, only the port differs for the ethernet communication. The endianness can be configured by parameter, <strong>line_following_swap_bytes</strong>.</p>
<p>The message protocol is a direct copy of the CAN message PDO1 and is sent to Navitrol in UDP format, separately for each sensor.
The IPC will act as a server and the default port is 5333, but can be changed via parameter <strong>line_following_sensor_eth_port</strong>.</p>
<p><strong>Ethernet UDP message</strong></p>
<table><thead><tr><th>Data field</th><th>Type</th><th>Length (bytes)</th><th>Comment</th></tr></thead><tbody>
<tr><td>Sending count</td><td>Uint_16</td><td>2</td><td>Incremented for each message, to verify if the received message is valid</td></tr>
<tr><td>LCP1</td><td>Int_16</td><td>2</td><td>Position of Line Center Point 1 [mm]</td></tr>
<tr><td>LCP2</td><td>Int_16</td><td>2</td><td>Position of Line Center Point 2 [mm]</td></tr>
<tr><td>LCP3</td><td>Int_16</td><td>2</td><td>Position of Line Center Point 3  [mm]</td></tr>
<tr><td>Line info</td><td>Uint_8</td><td>1</td><td><strong>Bits0...2</strong>:<br>0 - No track found<br>2 - One track found<br>3 - Two tracks found: Left diverter<br>6 - Two tracks found: Right diverter<br>7 - Three tracks found or 90° intersection<br></td></tr>
<tr><td>Status</td><td>Uint_8</td><td>1</td><td><strong>Bits0...3</strong><br>7 - Field level 4500-2000<br>6 - Field level 1750<br>5 - Field level 1500<br>4 - Field level 1250<br>3 - Field level 1000<br>2 - Field level 750<br>1 - Field level 500<br>0 - Field level 450<br>0 - Field level 350<br></td></tr>
</tbody></table>
<p>In case of one magnetic line present, the measurement reading will be read from LCP2</p>
<h3 id="parameters-4"><a class="header" href="#parameters-4">Parameters</a></h3>
<h4 id="can-parameters"><a class="header" href="#can-parameters">CAN parameters</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>line_following_sensor_nodeid[]</td><td>Int</td><td>10</td><td>CAN node id (decimal)</td></tr>
<tr><td>can_sick_mls_event_timer_ms</td><td>Int</td><td>10</td><td>Time between two transmissions. See MLS document</td></tr>
<tr><td>can_sick_mls_calibrate_offset[]</td><td>Int</td><td>0</td><td>Trigger offset calibration. See MLS document</td></tr>
<tr><td>can_sick_mls_factory_reset[]</td><td>Int</td><td>0</td><td>Factory reset the sensor. See MLS document</td></tr>
</tbody></table>
<p>For more information about the <strong>can_sick_mls</strong> parameters see the SICK MLS manual.</p>
<h4 id="ethernet-parameters"><a class="header" href="#ethernet-parameters">Ethernet parameters</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>line_following_sensor_eth_port[]</td><td>Int</td><td>5333</td><td>Port of the device</td></tr>
<tr><td>line_following_swap_bytes</td><td>Int</td><td>0</td><td>Swap bytes in line following ethernet interface. 0 = Little endian, 1 = Big endian</td></tr>
</tbody></table>
<h2 id="how-to-use-12"><a class="header" href="#how-to-use-12">How to use</a></h2>
<p>The line following is active when the sensor in the direction of motion, as seen from the navigation point, detects the tape and when the driven route has line following tag. If these conditions are met Navitrol Monitor will print <em>Line following active</em> in the top left corner while in AUTO state.</p>
<p><img src="PositionControl/MagneticLineFollowing/./media-en/line_following_active.PNG" alt="" />
&gt;&gt; Line following active in Monitor</p>
<h2 id="troubleshooting-28"><a class="header" href="#troubleshooting-28">Troubleshooting</a></h2>
<h3 id="errors-and-warnings-11"><a class="header" href="#errors-and-warnings-11">Errors and warnings</a></h3>
<h4 id="225---error_no_data_from_line_following_sensor"><a class="header" href="#225---error_no_data_from_line_following_sensor">225 - ERROR_NO_DATA_FROM_LINE_FOLLOWING_SENSOR</a></h4>
<p>No valid data received for ethernet procotol. Verify that the received data is valid by setting parameter <strong>log_veh_inte_eth</strong> to 4. Setting the parameter allows to see the received raw data in the log with prefix <em>SICK_MLS_ERROR byte</em>. Reset after received valid data. </p>
<h4 id="226---error_msg_parse_line_following_sensor"><a class="header" href="#226---error_msg_parse_line_following_sensor">226 - ERROR_MSG_PARSE_LINE_FOLLOWING_SENSOR</a></h4>
<p>The error is triggered for the Ethernet protocol if the sending counter is invalid or error parsing the measurement data, and for CAN if there is an error parsing the measurement data. Verify that the sent data is valid and there is connection to the device, and that the sending counter, if using Ethernet, is valid from <em>SICK MLS ethernet - current sending counter</em>. Error is reset after received valid data.</p>
<h4 id="227---error_line_following_no_measurement"><a class="header" href="#227---error_line_following_no_measurement">227 - ERROR_LINE_FOLLOWING_NO_MEASUREMENT</a></h4>
<p>The AGV has driven a distance of <strong>line_following_max_dist_since_last_meas</strong> since last measurement on a route with magnetic line following tag. <em>Line following active</em> will be visualized in Navitrol Monitor if measurements are received on the magnetic tape. In case there are 2 sensors an error is triggered if the second sensor to detect the tape does not detect the tape after driving a distance equaling the sum of <strong>line_following_sensor_pos_x[0]</strong>, <strong>line_following_sensor_pos_x[1]</strong> and <strong>line_following_max_dist_since_last_meas</strong> after the first sensor has reached the line following route tag start point. The error is reset by driving manually or by setting parameter <strong>line_following_sensor_communication</strong> to 0.</p>
<h3 id="advanced-troubleshooting-7"><a class="header" href="#advanced-troubleshooting-7">Advanced troubleshooting</a></h3>
<p>The parsed data for ethernet and CAN is logged as follows:<br />
<em>SICK MLS - LCP1, LCP2 (raw), LCP2, LCP3, LCP status, Measurement status, Track status</em>,<br />
where LCP1-3 is the sensor reading in millimeter, LCP status is the line info (how many tracks are detected), measurement status is a Boolean describing if the track is detected and track status is the induction level of the track (range 0 to 7). LCP is logged twice, the raw data and the potentially flipped data.</p>
<h4 id="line-following-is-not-active-although-the-sensor-is-on-the-magnetic-tape"><a class="header" href="#line-following-is-not-active-although-the-sensor-is-on-the-magnetic-tape">Line following is not active although the sensor is on the magnetic tape</a></h4>
<p>Under the assumption that the trajectory has magnetic line following tag, that the curvature of the trajectory is negligible and the AGV is not currently pivoting, the root cause is invalid sensor measurements. A measurement (LCP) of 0 is valid and can mean it is in the center of the sensor, or that no measurement was received. To differentiate between these, see output of Measurement status and/or Track status, with the above mentioned log line. The measurement status and/or track status will be non-zero if a measurement was received and the magnetic tape was detected. LCP1 and LCP3 are used to detect multiple magnetic lines and should be zero if there is only one detectable line. Place the sensor closer to the magnetic tape to see if the track status changes to non-zero. If issue persists, verify that the wiring is correct. </p>
<h4 id="line-following-is-active-but-the-driving-is-not-robust"><a class="header" href="#line-following-is-active-but-the-driving-is-not-robust">Line following is active but the driving is not robust</a></h4>
<p>The <strong>line_following_sensor_flipped</strong> parameter might be wrong for one or more sensors. Another possible cause is that the sensor has been initialized on the magnetic line, which might result in infeasible measurements. A feasible measurement range is sensor dependent, and is within [-range / 2, range / 2], if the centre offset has not been altered. The measuring range for the MLSE-0300 is -15000 and 15000. If the Measurement status or Track status is non-zero but the measurement value for LCP2 remains 0 regardless of where the magnetic line is with respect to the sensor's centre point, the measurements is invalid.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trailer-transport-1"><a class="header" href="#trailer-transport-1">Trailer Transport</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-23"><a class="header" href="#overview-23">Overview</a></h2>
<h3 id="introduction-32"><a class="header" href="#introduction-32">Introduction</a></h3>
<p>Trailer transport is a Navitrol feature that makes it possible to transport trailers with an omni AGV. When connected to the trailer, the omni AGV behaves like a truck pulling or pushing the trailer with it.</p>
<p><img src="PositionControl/TrailerTransport/./media-en/example_trailer.png" alt="" /></p>
<blockquote>
<p>Example trailer</p>
</blockquote>
<p>In a typical use case an uncoupled omni AGV gets an order to transport a trailer from location to another. The AGV drives to the trailer location and couples itself to the kingpin of the trailer. Then the AGV drives to the target location and uncouples itself from the trailer.</p>
<p>When the AGV is coupled to a trailer, the coupled trailer system behaves like a steer drive where the navigation point is in the middle of the middlemost axle of the trailer and the omni AGV acts like a steering wheel. See the image below.</p>
<p><img src="PositionControl/TrailerTransport/./media-en/omni_coupled_with_trailer.png" alt="" /></p>
<blockquote>
<p>Blue AGV coupled with with gray trailer frame. <br />1. Navigation point of the omni AGV and location of trailer kingpin. <br />2. Trailer support legs. <br />3. Navigation point of the trailer. <br />4. Trailer wheels</p>
</blockquote>
<p>In case you are looking for a way to use multiple AGVs simultaneously to transport a single large resource, see <a href="PositionControl/TrailerTransport/../CoupledDriving/CoupledDrivingFeature-en.html">Coupled driving feature</a> instead.</p>
<h3 id="requirements-15"><a class="header" href="#requirements-15">Requirements</a></h3>
<p><strong>Knowledge:</strong></p>
<ul>
<li>Basics of AGV calibration</li>
</ul>
<p><strong>Hardware:</strong></p>
<ul>
<li>A well calibrated omni drive AGV, see <a href="PositionControl/TrailerTransport/../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial calibration guide</a></li>
<li>Actuators for coupling and uncoupling a trailer and an AGV
<ul>
<li>The AGV system is responsible of controlling the actuators based on generic commands from Navitrol</li>
</ul>
</li>
<li>2D scanner for trailer angle detection
<ul>
<li>This is used to determine the angle between the AGV and the trailer based on wheels of the trailer.</li>
<li>Optionally this scanner can be attached to extendable telescope structure</li>
</ul>
</li>
<li>Separate scanner for positioning</li>
<li>For outdoor environments
<ul>
<li>GPS sensors and IMU for navigating without scanner measurements. See <a href="PositionControl/TrailerTransport/../../Localization/GpsPositioning/GpsPositioning-en.html">GPS positioning</a></li>
</ul>
</li>
<li>Trailer must have two support legs</li>
</ul>
<p><strong>Software:</strong></p>
<ul>
<li>Navitrol standalone or Navithor fleet control based production system</li>
<li>Navitrol version 6.34.00 or later</li>
<li><a href="PositionControl/TrailerTransport/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet supervisor communication interface</a> with messages 3002 - section 12, 3102 - section 17, 3042 and 3142.</li>
<li><a href="PositionControl/TrailerTransport/../../TargetAndObstacleDetection/PalletDetection/PalletDetection-en.html">Pallet detection v2 feature</a>, requiring target detection license
<ul>
<li>Required for trailer angle detection</li>
<li>Highly recommended for docking to trailer before coupling</li>
</ul>
</li>
</ul>
<p><strong>Environment and routes:</strong></p>
<ul>
<li>Enough space for long straight routes for coupling and uncoupling</li>
<li>Routes must be suitable for both the uncoupled AGV and the coupled trailer system</li>
</ul>
<h3 id="limitations-10"><a class="header" href="#limitations-10">Limitations</a></h3>
<ul>
<li>Low drive speeds when transporting a trailer
<ul>
<li>Typically maximum of 1.5m/s forwards and 1m/s in reverse</li>
</ul>
</li>
<li>UI visualization
<ul>
<li>Trailer is not visualized in Navitrol monitor and Navithor client</li>
</ul>
</li>
<li>When using with Standalone, separate pick up and drop of symbolic points must be defined for each trailer size</li>
<li>The trailer angle detection scanner must be installed to the middle of the AGV's rear end</li>
</ul>
<p><strong>When coupled to a trailer following features cannot be used:</strong></p>
<ul>
<li>Omni frame heading</li>
<li>Obstacle avoidance</li>
</ul>
<h3 id="dependencies-8"><a class="header" href="#dependencies-8">Dependencies</a></h3>
<ul>
<li><a href="PositionControl/TrailerTransport/../../TargetAndObstacleDetection/PalletDetection/PalletDetection-en.html">Pallet detection &amp; Docking</a></li>
<li><a href="PositionControl/TrailerTransport/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet supervisor interface</a></li>
<li><a href="PositionControl/TrailerTransport/../../DriveControl/ReturnToRoute/ReturnToRoute-en.html">Return to Route</a></li>
<li><a href="PositionControl/TrailerTransport/../../DriveControl/Standalone/Standalone-en.html">Standalone</a> OR Navithor</li>
<li><a href="PositionControl/TrailerTransport/../../Localization/GpsPositioning/GpsPositioning-en.html">GPS positioning</a></li>
<li><a href="PositionControl/TrailerTransport/../../Localization/ImuAndSensorFusion/ImuAndSensorFusion-en.html">Imu and Sensor Fusion</a></li>
</ul>
<hr />
<h2 id="set-up-4"><a class="header" href="#set-up-4">Set up</a></h2>
<h3 id="quick-start-7"><a class="header" href="#quick-start-7">Quick start</a></h3>
<ol>
<li>Install the required hardware to the AGV
<ul>
<li>See &quot;Requirements&quot; chapter</li>
<li><a href="PositionControl/TrailerTransport/../../Localization/ImuAndSensorFusion/ImuAndSensorFusion-en.html">Imu and Sensor Fusion</a></li>
<li><a href="PositionControl/TrailerTransport/../../Localization/GpsPositioning/GpsPositioning-en.html">GPS Positioning</a></li>
</ul>
</li>
<li>Calibrate positioning and driving of the omni AGV without trailer
<ul>
<li><a href="PositionControl/TrailerTransport/../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial Calibration Guide</a></li>
</ul>
</li>
<li>Teach the production environment</li>
<li>Define routes suitable for the coupled and uncoupled AGV systems</li>
<li>Set up pallet detection feature for detecting and docking to trailer legs
<ul>
<li><a href="PositionControl/TrailerTransport/../../TargetAndObstacleDetection/PalletDetection/PalletDetection-en.html">Pallet Detection</a></li>
<li>Coupling sequence, see &quot;Coupling sequence&quot; chapter.</li>
</ul>
</li>
<li>Implement the required supervisor messages
<ul>
<li>See &quot;Requirements chapter&quot; and <a href="PositionControl/TrailerTransport/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet Supervisor Interface Specification</a></li>
</ul>
</li>
<li>Enable trailer transport feature
<ul>
<li>Add <strong>trailer_transport_enabled</strong> to params.txt and set the value to 1</li>
</ul>
</li>
<li>Calibrate Trailer angle detection
<ul>
<li>See the related chapter</li>
</ul>
</li>
<li>Calibrate driving with a trailer
<ul>
<li>See the related chapter</li>
</ul>
</li>
<li>Set production control parameters
<ul>
<li>Either Navitrol standalone</li>
<li>Or Navithor fleet control, see &quot;Navithor set up&quot; chapter</li>
</ul>
</li>
</ol>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>trailer_transport_enabled</td><td>Int</td><td>1</td><td>Enables the trailer transport feature</td></tr>
</tbody></table>
<h3 id="fine-tuning-6"><a class="header" href="#fine-tuning-6">Fine-tuning</a></h3>
<h4 id="calibrating-trailer-driving"><a class="header" href="#calibrating-trailer-driving">Calibrating trailer driving</a></h4>
<p>For route following purposes the uncoupled AGV behaves like a normal omni AGV and when coupled to a trailer the system behaves like a steer drive.
When switching between the two the behavior of the AGV system will change so much that separate control gain parameters will be needed.</p>
<p>Uncoupled system uses normal control parameters (<strong>pc_pid_heading_p</strong>, <strong>pc_pid_dist_p</strong> and related speed-based gains).</p>
<p>Coupled system uses loaded gain parameters (<strong>pc_pid_heading_p_loaded</strong>, <strong>pc_pid_dist_p_loaded</strong> and related speed adjusted gains). In addition to normal control gains the coupled systems uses <strong>trailer_transport_pid_heading_err_p</strong> which determines how aggressively the detected trailer heading error is corrected.
Heading, distance and trailer heading gains must be adjusted so that the AGV system follows the route as accurately as possible.</p>
<p>If the coupled system drives accurately on slower speeds but starts to oscillate on higher ones, <strong>pc_pid_speed_setting_loaded</strong> parameters can be used to define separate control gains for different speeds. Typically lower gains are needed for higher speeds.</p>
<p>Note: When the AGV is pulling a trailer (AGV system is driving forwards) the trailer angle error naturally decrease so accurate control on higher speeds can be achieved compared to the situation where AGV is pushing the trailer. For this reason, it is recommended to design routes so that forward direction is used wherever possible.</p>
<p>It is also important to calibrate the angle detection well so that there is no offset. Otherwise, the trailer heading error correction will constantly fight against the normal heading and distance control.
The trailer angle detection offset can be measured by driving the AGV manually straight forward for couple of meters while pulling the trailer. After the drive the real trailer angle should be zero. If the detected trailer angle is not, scanner heading parameters should be tuned.</p>
<p>Instructions on how to use the forementioned parameters and how to calibrate the heading and distance control can be found from the <a href="PositionControl/TrailerTransport/../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial Calibration Guide</a></p>
<h4 id="fine-tuning-parameters"><a class="header" href="#fine-tuning-parameters">Fine tuning parameters</a></h4>
<p><strong>Coupling and uncoupling sequence parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>trailer_error_timer_ms</td><td>Int</td><td>60000</td><td>Determines the wait time during coupling and uncoupling sequences to adjust the actuator between states. <br />For example, at the start of coupling sequence Navitrol request the AGV system to prepare actuator for coupling. If supervisor has not sent coupling status &quot;ready for coupling&quot; within the time defined by this parameter ERROR_TRAILER_TRANSPORT_COUPLING will be triggered. <br /> The value should be larger than the time required for the slowest (un)coupling action.</td></tr>
<tr><td>trailer_kingpin_approach_max_dist</td><td>Float</td><td>1.0</td><td>The maximum drive distance in meters for approaching/searching the kingpin during the coupling sequence. If the AGV system does not report that the kingpin has been detected before this distance has been driven Navitrol will stop the AGV and ERROR_TRAILER_TRANSPORT_COUPLING will be triggered.<br /> The value should be set so that it is large enough to cover the distance from the pick up sp to to the kingpin but low enough that the AGV is safely stopped in case the AGV does not detect the kingpin.</td></tr>
<tr><td>trailer_kingpin_approach_max_v</td><td>Float</td><td>0.2</td><td>Defines the maximum velocity during the kingpin approach search drive. <br /> In general, lower speeds increase position control accuracy and are safer where higher ones save time.</td></tr>
<tr><td>trailer_uncoupling_straight_leave_dist</td><td>Float</td><td>0.5</td><td>The drive distance after unlocking the actuators from kingpin during uncoupling. <br />Will be driven straight so that the AGV gets fully out of under the trailer before resuming normal driving and following the defined routes. <br />The value should be large enough so that after the drive AGV can move freely without a possibility to collide with the dropped of trailer.</td></tr>
<tr><td>trailer_uncoupling_straight_leave_max_v</td><td>Float</td><td>0.2</td><td>Defines the maximum velocity during the uncoupling straight leave drive. In general, lower speeds increase position control accuracy and are safer where higher ones save time.</td></tr>
</tbody></table>
<p><strong>Parameters for defining maximum trailer heading errors based on the scanner telescope length</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>trailer_max_heading_err_close_deg</td><td>Float</td><td>7.0</td><td>Used for stopping the AGV before the compressed scanner telescope can hit the trailer wheels <br /> ERROR_TRAILER_ANGLE_TOO_LARGE is set, if trailer heading error is larger than this value and scanner telescope length is less than the distance to frontmost axle</td></tr>
<tr><td>trailer_max_heading_err_far_deg</td><td>Float</td><td>1.5</td><td>Used for stopping the AGV before the extended scanner telescope can hit the trailer wheels <br /> ERROR_TRAILER_ANGLE_TOO_LARGE is set, if trailer heading error is larger than this value and scanner telescope length is larger than the distance to frontmost axle</td></tr>
</tbody></table>
<p><img src="PositionControl/TrailerTransport/./media-en/trailer_max_heading_err_visualization.png" alt="" /></p>
<blockquote>
<p>Trailer max heading error visualized: <br /> 1. Navigation point of the AGV (kingpin of the trailer).  <br /> 2. Scanner telescope length <br /> 3. Distance to frontmost axle <br /> 4. Trailer heading error</p>
</blockquote>
<p>Note: If the system does not have scanner telescope, only one of these parameters are used, based on the constant scanner telescope length provided to Navitrol</p>
<p><strong>Position control parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>trailer_transport_pid_heading_err_p</td><td>Float</td><td>3.0</td><td>Position control gain for trailer to AGV heading error control in trailer transport. <br />Affects how aggressively the heading error is corrected towards zero. <br />This control gain will compete with normal heading and distance correction gains (pc_pid_heading_p,loaded pc_pid_dist_p_loaded). <br />The higher the value of any of these parameters the more the related correction is prioritized over the other two.</td></tr>
</tbody></table>
<p><strong>Logging parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_trailer_transport</td><td>Int</td><td>0</td><td>Used to control amount of trailer transport related logging. 0 - basic level, 1 - detailed logging enable. <br />If you encounter any issues with the feature set the value to 1 before taking and sending a log for further inspection.</td></tr>
</tbody></table>
<h4 id="navithor-set-up"><a class="header" href="#navithor-set-up">Navithor set up</a></h4>
<p>When Navithor fleet control system is used with trailer transport feature following parameters must be set to make sure that the coupled/uncoupled status will be updated between the systems even outside pick up and drop off situations.</p>
<p><img src="PositionControl/TrailerTransport/./media-en/navithor_production_manager_resource_missmatch_rules_setup.png" alt="" /></p>
<blockquote>
<p>ProductionManager_ResourceMismatchRules to set</p>
</blockquote>
<p><strong>ProductionManager_AlwaysCheckResourceMismatch</strong> set to True</p>
<h2 id="how-to-use-13"><a class="header" href="#how-to-use-13">How to use</a></h2>
<h3 id="use-case-sequence"><a class="header" href="#use-case-sequence">Use case sequence</a></h3>
<ol>
<li>An uncoupled AGV is on standby waiting for a production order</li>
<li>AGV receives a production order to pick up a trailer</li>
<li>AGV starts to drive towards the target pick up symbolic point</li>
<li>AGV approaches the trailer reversing</li>
<li>Target detection determines the exact trailer position for example based on the trailer legs.
<ul>
<li>Note: If pallet detection is not used the trailer must be located on the target symbolic point with minimal position and angle errors.</li>
</ul>
</li>
<li>Navitrol docs to the pick up symbolic point</li>
<li>Coupling sequence is performed
<ol>
<li>AGV reverses straight towards the kingpin of the trailer and stops when the kingpin is reached</li>
<li>AGV locks to the trailer and lifts it up</li>
<li>AGV sends trailer dimensions to Navitrol</li>
<li>Navigation point is changed from the AGV to the trailer wheels</li>
<li>The AGV and trailer are now coupled and work as a trailer system</li>
</ol>
<ul>
<li>See related chapter for more info</li>
</ul>
</li>
<li>Trailer system gets a drive order to a drop of symbolic point</li>
<li>Trailer system drives to the target symbolic point so that
<ul>
<li>The trailer navigation point follows the defined routes</li>
<li>The detected trailer angle is used for position control</li>
</ul>
</li>
<li>Trailer navigation point reaches the drop of symbolic point</li>
<li>Uncoupling sequence is performed
<ol>
<li>AGV lowers and unlocks the trailer</li>
<li>AGV drives straight forward from under the trailer so that it won't hit the trailer support legs</li>
<li>AGV preforms return to route function</li>
</ol>
<ul>
<li>See related chapter for more info</li>
</ul>
</li>
<li>The AGV is now ready for next production order</li>
</ol>
<h3 id="trailer-coupling-and-uncoupling"><a class="header" href="#trailer-coupling-and-uncoupling">Trailer coupling and uncoupling</a></h3>
<h4 id="coupling-sequence"><a class="header" href="#coupling-sequence">Coupling sequence</a></h4>
<p>A description of the trailer coupling sequence from Navitrol point of view.</p>
<p>The terms in <em>italic</em> are references to &quot;coupling actions&quot; and supervisor's &quot;coupling status&quot; information defined in the ethernet supervisor document.</p>
<ol>
<li>Production order to pick up point
<ul>
<li>Navitrol gets drive order to a pick up symbolic point while unloaded <br />Note: The AGV is considered unloaded when it is uncoupled from the trailer. The trailer is considered uncoupled after the Supervisor has sent <em>Uncoupled</em> as <em>Trailer coupling status</em></li>
</ul>
</li>
<li>Docking to the pick up point with pallet detection
<ul>
<li>Pallet detection can be used to dock to the target pick up point</li>
<li>Optional but recommended step as without docking it is very hard to hit the kingpin.</li>
<li>Requires pallet model based on the trailer legs</li>
<li>For more information see pallet detection documentation</li>
</ul>
</li>
</ol>
<p><img src="PositionControl/TrailerTransport/./media-en/docking_to_trailer_legs_with_pallet_detection.png" alt="" /></p>
<blockquote>
<p>Docking to trailer coupling start point using pallet detection. The red circle is the load symbolic point where the coupling sequence will start. Parameter <strong>docking_stop_dist</strong> defines the expected distance from the symbolic point to the middle of the trailer legs -- the pallet detection will search the target around that point.</p>
</blockquote>
<ol start="3">
<li>Arriving to pick up point
<ul>
<li>The AGV arrives to pick up symbolic point (with or without docking)</li>
<li>Navitrol enters load state starting the trailer coupling sequence.</li>
</ul>
</li>
<li>Navitrol requests coupling preparations
<ul>
<li>Navitrol sends <em>trailer coupling action</em> to <em>Prepare for coupling</em>. This action is sent in Trailer transport status section's &quot;Trailer coupling action&quot;-data field</li>
</ul>
</li>
<li>Navitrol will wait until coupling preparations are done
<ul>
<li>AGV system sends this information by changing the <em>Trailer coupling status</em> to <em>Ready for coupling.</em></li>
<li>Coupling preparations can be for example raising actuator to kingpin level.</li>
</ul>
</li>
<li>Navitrol will start reversing towards the kingpin
<ul>
<li>Navitrol will start reversing straight backwards from the current position until <em>Trailer coupling status</em> changes to <em>Kingpin detected</em>
<ul>
<li><strong>trailer_kingpin_approach_max_v</strong> defines the speed of the drive</li>
<li><strong>trailer_kingpin_approach_max_dist</strong> defines the maximum distance of the drive</li>
</ul>
</li>
<li>If the maximum distance is driven without receiving <em>Kingpin detected</em> trailer coupling error is raised</li>
</ul>
</li>
<li>AGV stops at the kingpin</li>
<li>Navitrol request coupling action
<ul>
<li>Navitrol will send <em>Couple</em> action</li>
<li>Coupling action in this phase can include for example raising the actuator and locking AGV to the kingpin of the AGV</li>
</ul>
</li>
<li>Navitrol will wait until coupling is ready
<ul>
<li>AGV system send this information by sending <em>Coupled</em> status</li>
</ul>
</li>
<li>Navitrol will wait for trailer dimensions
<ul>
<li>Only happens if the trailer dimensions have not been received before this point
<ul>
<li><strong>Note</strong>: Navitrol will start requesting this information when the coupling sequence starts after entering the load state</li>
</ul>
</li>
<li>Navitrol needs the trailer dimensions for trailer angle detection</li>
</ul>
</li>
<li>Coupling sequence is ready
<ul>
<li>The AGV is coupled to the trailer and is ready to transport it based on incoming production orders</li>
</ul>
</li>
</ol>
<p><img src="PositionControl/TrailerTransport/./media-en/coupling_sequence_diagram.png" alt="" /></p>
<blockquote>
<p>Coupling sequence communication diagram</p>
</blockquote>
<h4 id="uncoupling-sequence"><a class="header" href="#uncoupling-sequence">Uncoupling sequence</a></h4>
<p>A description of the trailer uncoupling sequence from Navitrol point of view.</p>
<p>The sentences in <em>italic</em> are references to coupling actions and coupling status in supervisor document.</p>
<ol>
<li>Production order to drop off symbolic point
<ul>
<li>Navitrol receives drive order to an drop off symbolic point while loaded. <br /> Note: The AGV considered loaded when the trailer is coupled to the AGV. Trailer is considered coupled when AGV system sends <em>Coupled</em> in <em>Trailer coupling status</em> data field of Supervisor trailer transport status section</li>
</ul>
</li>
<li>AGV enters the target drop off point
<ul>
<li>Uncoupling sequence starts</li>
</ul>
</li>
<li>Navitrol request uncoupling preparations
<ul>
<li>Navitrol sends action to <em>Prepare for uncoupling</em></li>
<li>Uncoupling preparations at this point can include for example lowering the actuators so that the trailer is unlocked and the AGV can be driven out from under the trailer.</li>
</ul>
</li>
<li>Navitrol will wait until uncoupling preparations are ready
<ul>
<li>AGV system must inform this by changing <em>Trailer coupling status</em> to <em>Ready for uncoupling</em></li>
<li>AGV is now physically uncoupled from the trailer</li>
</ul>
</li>
<li>Navitrol will drive from under the trailer
<ul>
<li>Navitrol will drive straight forward away from the kingpin for a defined distance</li>
<li><strong>trailer_uncoupling_straight_leave_dist</strong> defines the drive distance that is driven fully</li>
<li><strong>trailer_uncoupling_straight_leave_max_v</strong> defines the speed of the drive</li>
</ul>
</li>
<li>Navitrol will stop and request finishing uncoupling
<ul>
<li>Navitrol sends action to <em>Uncouple</em></li>
<li>Finishing uncoupling can include for example lowering the actuators to a drive height</li>
</ul>
</li>
<li>Wait until uncoupling has been finished
<ul>
<li>AGV system must inform this by sending <em>Uncoupled</em> status.</li>
</ul>
</li>
<li>Navitrol will perform automatic return to route
<ul>
<li>It is possible that the AGV is not on the defined route, if the straight drive from under the trailer is very long and there is even a slight angle error at the beginning</li>
<li>Note: the return to route feature parameters need to be calibrated to suit your needs</li>
</ul>
</li>
<li>Uncoupling sequence is ready
<ul>
<li>The AGV is free for new trailer production orders</li>
</ul>
</li>
</ol>
<h3 id="user-interfaces"><a class="header" href="#user-interfaces">User interfaces</a></h3>
<p><strong>Navitrol monitor</strong>
When the AGV is coupled to a trailer, following trailer transport related information is available in Navitrol Monitor:</p>
<p><img src="PositionControl/TrailerTransport/./media-en/trailer_in_monitor_view.png" alt="" /></p>
<blockquote>
<p>Trailer transport Navitrol Monitor view: <br />1. Trailer Navigation point, <br />2. Detected trailer wheels / angle, <br />3. Scanner that is moved with telescope</p>
</blockquote>
<p><strong>Navithor client</strong>
Navithor client has no trailer transport specific visualization implemented. Instead the position of AGV can be seen to jump on the map when the navigation point changes from AGV to the picked up trailer at the end of coupling sequence. This can be partly hidden by defining the carried resource to match the trailer dimensions.</p>
<h3 id="communication-between-agv-and-navitrol"><a class="header" href="#communication-between-agv-and-navitrol">Communication between AGV and Navitrol</a></h3>
<p>Trailer transport feature requires the trailer status and dimension data from the AGV.</p>
<p>The status data should be sent with recommended interval of 40-100ms.
After Navitrol has received the status once, Navitrol expects to get it at maximum interval of one second. If the data is not received ERROR_TRAILER_STATUS_NOT_RECEIVED will be set.</p>
<p>The trailer dimension data is needed for trailer angle detection. Navitrol will request the data using Navitrol trailer status section. Without trailer angle detection Navitrol cannot control the trailer and will refuse driving in auto mode.</p>
<p>The data can be sent using trailer transport messages in Ethernet Supervisor interface. See the <a href="PositionControl/TrailerTransport/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Supervisor documentation</a> for following messages:</p>
<ul>
<li>Message 3002 - Supervisor status, Trailer transport status section (section ID = 12)</li>
<li>Message 3102 - Navitrol status, Trailer transport status section (section ID = 17)</li>
<li>Message 3042 - Set trailer dimensions</li>
<li>Message 3142 - Set trailer dimensions result</li>
</ul>
<h3 id="trailer-angle-detection"><a class="header" href="#trailer-angle-detection">Trailer angle detection</a></h3>
<p>The angle between the trailer and the AGV is required for controlling the system. The angle can be detected using 2D laser scanner either from front or behind the trailer rear wheels.
Optionally this scanner can be attached to an extendable telescope structure so that the scanner can be moved behind rear wheels. This makes it possible to use the same scanner for safety when reversing with the trailer.</p>
<p><img src="PositionControl/TrailerTransport/./media-en/trailer_angle_detection.png" alt="" /></p>
<blockquote>
<p>Trailer angle detection with 2D scanner. The measured angle is the angle between the AGV and the trailer. Trailer angle is determined by the front wheels (orange) using pallet detection feature.</p>
</blockquote>
<p>The trailer angle detection algorithm requires the trailer wheel dimensions which can be provided with the Ethernet supervisor message <em>3042 - Trailer Transport: Set Trailer Dimensions</em>.</p>
<p>The detection scanner is selected with <strong>target_detection_scan_selection</strong> parameter. The scanner must be installed to the center of the AGV frame (on the x-axis of the AGV frame) as seen in figure above. It gets the distance from the navigation point (kingpin) from the <em>Scanner Telescope Length</em> data in Ethernet supervisor status message 3002 section <em>Trailer transport section</em>.</p>
<p>The detection algorithm uses the pallet detection v2 implementation.
Parameter <strong>pallet_det_2_detect_only_front_legs</strong> should be set to 1.</p>
<p>The angle detection results might be noisy which will affect directly to the calculated trailer navigation position and furthermore the stability of the driving. To filter the noise in the angle detection results, parameter <strong>target_detection_results_dampening</strong> can be used. The closer to zero the value is set the more the angle results are filtered.
However, too much filtering will cause delay to the angle detection.
Value 0.3 is a good starting point for further tuning.</p>
<h2 id="troubleshooting-29"><a class="header" href="#troubleshooting-29">Troubleshooting</a></h2>
<h3 id="most-common-issues-5"><a class="header" href="#most-common-issues-5">Most common issues</a></h3>
<h4 id="trailer-system-oscillates-while-driving"><a class="header" href="#trailer-system-oscillates-while-driving">Trailer system oscillates while driving</a></h4>
<p>Oscillation is most often caused by several accumulating error sources.</p>
<p>Check from &quot;Calibrating trailer driving&quot; chapter that:</p>
<ul>
<li>Omni AGV is well calibrated when not coupled to the trailer
<ul>
<li>The AGV follows control references accurately</li>
<li>Scanner (and GPS) positioning is accurate</li>
</ul>
</li>
<li>Trailer angle detection is accurate
<ul>
<li>The scanner must be firmly attached in relation to the AGV frame</li>
<li>The given trailer wheel positions and dimensions must be accurate</li>
<li>There is no angle offset when the trailer is straight</li>
</ul>
</li>
<li>Driving with trailer is well calibrated
<ul>
<li>Loaded gain parameters are tuned</li>
<li>Given trailer dimensions must be accurate</li>
</ul>
</li>
<li>Routes are planned so that the trailer system drives forward as much as possible as the control is more stable when the AGV is pulling the trailer compared to pushing.</li>
</ul>
<h3 id="errors-and-warnings-12"><a class="header" href="#errors-and-warnings-12">Errors and warnings</a></h3>
<h4 id="713---error_trailer_transport_coupling"><a class="header" href="#713---error_trailer_transport_coupling">713 - ERROR_TRAILER_TRANSPORT_COUPLING</a></h4>
<p>This error is set, and drive stopped if</p>
<ul>
<li>Trailer was lost or connected unexpectedly
<ul>
<li>While coupled or uncoupled the trailer coupling status from supervisor is changed unexpectedly.</li>
<li>For example, while Navitrol thinks that the trailer is coupled to the AGV and driving and reported coupling status changes to uncoupled.</li>
<li>No error is raised on unexpected changes during coupling and uncoupling sequences</li>
</ul>
</li>
<li>Kingpin was not found
<ul>
<li>During coupling when reversing to kingpin the maximum drive distance is reached without coupling status indicating that the kingpin is detected.</li>
<li>Max drive distance is determined by <strong>trailer_kingpin_straight_drive_dist</strong></li>
</ul>
</li>
<li>The AGV system does not respond to coupling action requests
<ul>
<li>During coupling or uncoupling sequence the reported state has been same for over the max wait time determined by <strong>trailer_error_timer_ms</strong></li>
</ul>
</li>
<li>During uncoupling if the automatic return to route fails
<ul>
<li>Either return to route parameters have not been calibrated correctly or the AGV is too far from the route to return.</li>
</ul>
</li>
</ul>
<p>The error is fatal, and it needs to be reset manually by the user after the issue causing it has been resolved.</p>
<p>After the error is cleared Navitrol will determine the correct coupling state based on the coupling status received from the AGV system.</p>
<h4 id="715---error_trailer_angle_not_detected"><a class="header" href="#715---error_trailer_angle_not_detected">715 - ERROR_TRAILER_ANGLE_NOT_DETECTED</a></h4>
<p>This error is set if trailer angle is not detected successfully when coupled to a trailer. Possible reasons are that the pallet detection is not enabled and set up correctly or the angle detection scanner does find the wheels in the near the axles defined with &quot;Set trailer dimensions&quot;-message.</p>
<p>The error is automatically reset when the trailer angle is successfully detected -- Successfully detected angle is rendered as a green line in Navitrol Monitor.</p>
<h4 id="716---error_trailer_angle_too_large"><a class="header" href="#716---error_trailer_angle_too_large">716 - ERROR_TRAILER_ANGLE_TOO_LARGE</a></h4>
<p>This error is set if detected trailer angle error compared to the AGV angle is larger than the limits set with parameters <strong>trailer_max_heading_err_close_deg</strong> and <strong>trailer_max_heading_err_far_deg.</strong> See the &quot;Fine tuning parameters&quot; chapter for more information.</p>
<p>The error is automatically reset when the trailer angle is back within the limits. However, getting the angle error to the limits while error is active will most likely require manual control since automatic driving is prevented by the error.</p>
<h4 id="714---error_trailer_status_not_received"><a class="header" href="#714---error_trailer_status_not_received">714 - ERROR_TRAILER_STATUS_NOT_RECEIVED</a></h4>
<p>This error is set if valid trailer status has been received once but after that either the communication is lost, or data received is invalid for more than one second.</p>
<p>To fix the issue make sure that the supervisor sends <strong>Message 3002 -- Supervisor status, Trailer transport status section (section ID = 12)</strong> with valid data.</p>
<h3 id="advanced-troubleshooting-8"><a class="header" href="#advanced-troubleshooting-8">Advanced troubleshooting</a></h3>
<p>This chapter provides instructions for advanced trouble shooting.
See the <a href="PositionControl/TrailerTransport/../../Miscellaneous/Logging/Logging-en.html">Guide for taking and reading log files</a> as well.</p>
<p><strong>Logging parameters</strong><br />
Set both <strong>log_trailer_transport</strong> and <strong>log_veh_inte_eth</strong> to value 1 before taking a log for advanced troubleshooting.</p>
<p><strong>Log keywords</strong><br />
Following keywords can be used to search more information on specific points of interest. They are case sensitive.</p>
<table><thead><tr><th>Point of interest</th><th>Keyword</th><th>Use case</th></tr></thead><tbody>
<tr><td>Everything</td><td>&quot;railer&quot;</td><td>Start point for narrowing down the issue if it is not quite sure what goes wrong.</td></tr>
<tr><td>Coupling state changes</td><td>&quot;Trailer state&quot;</td><td>Helpful if there seems to be issues in coupling or uncoupling sequences.</td></tr>
<tr><td>Supervisor interface</td><td>&quot;trailer transport&quot;</td><td>Can be used to check if Navitrol receives the required trailer transport data over the supervisor interface and if Navitrol responds with valid data to the supervisor.</td></tr>
<tr><td>Trailer angle error</td><td>&quot;TrailerTransport - Angle error&quot;</td><td>Can be used to observe trailer angle error and for example to calibrate angle detection offset.</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="barrier-stop-1"><a class="header" href="#barrier-stop-1">Barrier Stop</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-24"><a class="header" href="#overview-24">Overview</a></h2>
<p>Barrier stop is a Navitrol feature that allows the use of signals, such as line sensors, to stop omni wheels individually to increase stopping orientation accuracy. Designed only for two wheeled omni drive.</p>
<p><strong>Example case:</strong></p>
<ul>
<li>There is a line on the ground on the stopping area and two sensors on the AGV for detecting the line.</li>
<li>When AGV approaches the stopping point it waits for signals from the sensors.</li>
<li>When it receives a signal, it stops the related wheel while the second wheel keeps driving (turning the AGV around the stopped wheel) until the second signal is received or fail safe timer is triggered.</li>
<li>As a result, the AGV should turn to same orientation (both wheels on the line) each time.</li>
</ul>
<h2 id="how-to-use-14"><a class="header" href="#how-to-use-14">How to use</a></h2>
<h3 id="preconditions-3"><a class="header" href="#preconditions-3">Preconditions</a></h3>
<ul>
<li>An omni drive with exactly two wheels</li>
<li>Two sensors for detecting the line</li>
<li>Some kind of line that can be detected by the sensors and can be installed at the desired stopping location</li>
<li>Ethernet supervisor communication interface
<ul>
<li>Message 3002 -- Supervisor status, Inputs section (section ID = 4)</li>
</ul>
</li>
</ul>
<h3 id="set-up-5"><a class="header" href="#set-up-5">Set up</a></h3>
<ol>
<li>Install the line(s) at the desired stopping location(s)</li>
<li>Use Navithor Tools to
a. Add symbolic points to those locations
b. Enable barrier stop feature at the added symbolic points
c. Enable &quot;NavitrolEna&quot; virtual tag with no additional features checked (value 65280). See the images below. If you cannot see &quot;Barrier stop&quot;-option in &quot;Navitrol features&quot;-list please update Navithor Tools software to version 4.07.00 or newer.</li>
</ol>
<p><img src="PositionControl/BarrierStop/./media-en/image3.png" alt="" /></p>
<p><img src="PositionControl/BarrierStop/./media-en/image4.png" alt="" /></p>
<ol start="3">
<li>Define Navitrol parameters</li>
</ol>
<ul>
<li>F,barrier_stop_check_dist,0.2
<ul>
<li>Enables the barrier stop if larger than zero.</li>
<li>Defines the distance from the symbolic point (before and after) where the barrier stop signals are expected.</li>
<li>The signals are ignored when the AGV is outside of this distance from a barrier stop symbolic point</li>
</ul>
</li>
<li>I,barrier_stop_signal_max_wait_time_ms,2000
<ul>
<li>Defines the maximum wait time between the first and the second signal to prevent the AGV potentially spinning in place if the second signal is not received.</li>
</ul>
</li>
<li>I,use_virtual_io,1
<ul>
<li>Enables virtual IO for delivering the signals to Navitrol</li>
</ul>
</li>
<li>I,disable_sending_inputs, 0
<ul>
<li>Must be 0 or blocs the input actions</li>
</ul>
</li>
<li>I,input_0_action, 201
<ul>
<li>Defines that bit 0 is the signal for the wheel 0</li>
</ul>
</li>
<li>I,input_1_action, 202
<ul>
<li>Defines that bit 1 is the signal for the wheel 1</li>
</ul>
</li>
<li>I,physical_binary_inputs_n, 2
<ul>
<li>Defines the total number of binary inputs in use.</li>
<li>The parameter value needs to be 2 (barrier stop inputs) + number of other binary inputs in use (if any).</li>
</ul>
</li>
</ul>
<h3 id="implementing-the-messages"><a class="header" href="#implementing-the-messages">Implementing the messages</a></h3>
<ol>
<li>Use the &quot;Inputs&quot;-section (id = 4) of &quot;Supervisor status&quot;-message to send the sensor signals to Navitrol.</li>
<li>For more information see document: <strong>Ethernet Communication specification between Navitrol and AGV supervisor_v4.docx</strong></li>
</ol>
<p><img src="PositionControl/BarrierStop/./media-en/image5.png" alt="" /></p>
<ol start="3">
<li>Only binary inputs are needed
<ul>
<li>&quot;Num of binary inputs&quot; should be 2</li>
<li>When value 1 (8 bit unsigned int) is sent
<ul>
<li>Binary input index 0 stops the wheel 0</li>
<li>Binary input index 1 stops the wheel 1</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="activating-the-stop"><a class="header" href="#activating-the-stop">Activating the stop</a></h3>
<ol>
<li>When a sensor detects the line, related inputs section bit for that wheel should be set to 1 (0 otherwise)
<ul>
<li>This activates the stop if the AGV was driving to a symbolic point that has barrier stop enabled and is within the distance defined by barrier_stop_check_dist-parameter</li>
</ul>
</li>
</ol>
<h2 id="warnings-1"><a class="header" href="#warnings-1">Warnings</a></h2>
<p>WARNING_BARRIER_STOP_FAILED is set and drive stopped if</p>
<ul>
<li>AGV drives barrier_stop_check_dist past the symbolic point without getting both signals</li>
<li>First signal is received, but the second is not received within barrier_stop_signal_max_wait_time_ms</li>
</ul>
<p><strong>Note:</strong> The warning will be set for couple of seconds. The AGV will try to continue the drive order after that.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-matrix-code-dmc-docking-v2"><a class="header" href="#data-matrix-code-dmc-docking-v2">Data Matrix Code (DMC) Docking V2</a></h1>
<p>Updated 29.04.2024</p>
<h2 id="overview-25"><a class="header" href="#overview-25">Overview</a></h2>
<h3 id="introduction-33"><a class="header" href="#introduction-33">Introduction</a></h3>
<p>In context of External localization, Data matrix docking is a separate feature that requires its own license. The idea is to use the data matrix tape for line following only.
This means that data matrices are not taught to the environment nor will their exact position on the map be known. Instead, symbolic points on the route network will hold the needed information about the data matrix lines.</p>
<p>In short, the AGV is given a drive order to a destination symbolic point which has data matrix information defined. When the AGV is close enough to the symbolic point and receives a valid measurement from the PGV camera, it goes to a docking state and uses from here on the data matrix code / QR code line as a reference for the drive. This means that the AGV will correct its position to the center of data matrix line and simultaneously correct it's heading to be aligned with the line.</p>
<p>The AGV will stop based on a predefined stopping values on the data matrix tape. After it gets a drive order to leave the location, it will follow the data matrix tape until the primary sensor is far enough from the symbolic point (configurable). The feature provides accurate docking since the cameras can provide sub millimeter X,Y position on the data matrix.</p>
<p>The DMC Docking V2 is an improved version of the old Data Matrix docking. The improved version provides the means for:</p>
<ul>
<li>Docking to a same symbolic point forward and backward</li>
<li>Docking to a symbolic point that is middle of the route</li>
<li>Docking to a symbolic point from all directions</li>
<li>Docking with DMC line ascending and descending values</li>
<li>Choosing active PGV cameras to be used when docking</li>
<li>Possibility to use 4 PGV cameras</li>
</ul>
<p><strong>DMC Docking V2 is available in Navitrol 6.48 Official Release</strong></p>
<h3 id="requirements-16"><a class="header" href="#requirements-16">Requirements</a></h3>
<p>Hardware requirements for the feature include Position Guided Vision sensor(s) and Data matrix code tape from Pepperl+Fuchs. Navitrol can read data directly from sensors using CAN Open. For other type of sensors, the customer is required to read the data from the sensors and send the data to Navitrol via Ethernet TCP/IP connection (see Appendix).</p>
<p><strong>Note: From Navitrol 6.32 onwards, two cameras can be mounted also to the left and right side of navigation point.</strong></p>
<h3 id="limitations-11"><a class="header" href="#limitations-11">Limitations</a></h3>
<p>The DMC docking has following limitations for its configuration:</p>
<ul>
<li>The Data matrix tapes cannot cross each others.</li>
<li>AGV can follow only one QR-code line at a time.</li>
<li>The route should be straight and without branches whenever the AGV is following the data matrix tape.</li>
<li>Symbolic point must have DMC docking enabled. In addition, symbolic point must be placed so that it is close to the location that the AGV is needed to be stopped. Maximum allowed distance is 0.1 meters.</li>
<li>If AGV has restarted or driven manually closer than &quot;Check path ready&quot; distance from the symbolic point, The DMC docking does not activate in following situations:
<ul>
<li>If route is forward or reverse only</li>
<li>Data matrix docking stop point is defined only to be approached from one direction and starting to drive to the other side of the symbolic point</li>
</ul>
</li>
<li>Drive order to the same symbolic point where AGV already docked not possible if AGV would approach the same segment (i.e. a loop). AGV should be given drive order to somewhere else first.</li>
<li>When testing with Navitrol Monitor, disable fleet control since it can cause problems (I, fleet_control_type, 0)</li>
</ul>
<p>AGV can follow only one data matrix line at a time, but there can be one or two PGV cameras used for driving. 
However, only the PGV camera that is configured as primary camera will be used for stopping the AGV. The other (secondary camera) is used only for alignment with respect to data matrix line.</p>
<h3 id="dependencies-9"><a class="header" href="#dependencies-9">Dependencies</a></h3>
<ul>
<li><a href="PositionControl/DataMatrixDocking/../../Localization/ExternalLocalization/ExternalLocalization-en.html">External localization</a></li>
</ul>
<h2 id="setup-18"><a class="header" href="#setup-18">Setup</a></h2>
<h3 id="quick-start-8"><a class="header" href="#quick-start-8">Quick start</a></h3>
<ul>
<li>Configure and calibrate the PGV cameras 
<ul>
<li><a href="PositionControl/DataMatrixDocking/../../Localization/ExternalLocalization/ExternalLocalization-en.html#calibration-of-camera-positions">External localization - Calibration of camera positions</a></li>
<li><a href="PositionControl/DataMatrixDocking/../../Localization/ExternalLocalization/ExternalLocalization-en.html#calibrating-the-agv-position-relative-to-the-data-matrix-line">External localization - Calibration of the AGV position relatvie to the Data matrix line</a></li>
<li><a href="PositionControl/DataMatrixDocking/../../Localization/ExternalLocalization/ExternalLocalization-en.html#proposed-calibration-method-for-vehicle-with-two-pgvs">External localization - Calibration setup for vehicle with two PGV:s</a></li>
</ul>
</li>
<li>Create straight routes and symbolic points along the DMC lines</li>
<li>Define stopping points for these symbolic points (<a href="PositionControl/DataMatrixDocking/DataMatrixDockingDMC-en.html#configuration">Configuration</a>)</li>
<li>Give a drive order to the symbolic point along the route DMC docking was configured</li>
</ul>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>ext_loc_docking_enabled</td><td>Int</td><td>1</td><td>Enable docking<br>0 = Disabled<br>1 = Enabled</td></tr>
<tr><td>ext_loc_docking_version</td><td>Int</td><td>2</td><td>Data matrix code (DMC) Docking version. <br> 1 = Version 1 (V1) <br> 2 = Version 2 (V2)</td></tr>
<tr><td>ext_loc_stop_point_enabled</td><td>Int</td><td>1</td><td>Stop point is given in data matrix coordinates for sensor (X-position) instead of driving to route end position. Needs to be enabled with DMC docking. <br>0 = Disabled<br>1 = Enabled</td></tr>
<tr><td>ext_loc_for_pos_ctrl_mode</td><td>Int</td><td>1-3</td><td>External localization used directly for position control (e.g. in case of line following)<br>0 = disabled<br>1 = using only one sensor<br>2 = using two sensors when applicable<br>3 = require always two sensors (Navitrol 6.32 onwards)</td></tr>
<tr><td>ext_loc_max_dist_since_last_meas</td><td>Float</td><td>0.01 - 1.0</td><td>Maximum travelled distance since last valid measurement when inside external localization area</td></tr>
<tr><td>ext_loc_check_path_ready_dist</td><td>Float</td><td>0.01 - 0.2</td><td>Distance from stop point inside of which the stopping check starts. After drive is ready and before next stop can be checked, a measurement must be outside of this distance from stop value.</td></tr>
<tr><td>ext_loc_strict_max_dist_since_last_meas</td><td>Float</td><td>0.01 - 0.5</td><td>Maximum distance in meters since last valid measurement when data matrix following is active and the AGV inside &quot;Check path ready dist&quot;</td></tr>
<tr><td>ext_loc_path_ready_max_dist_err</td><td>Float</td><td>0.0001 - 0.2</td><td>Max distance between PGV measurement and stop point to determine drive to be instantly ready at the start of new drive order.</td></tr>
<tr><td>ext_loc_docking_max_h_err_deg</td><td>Float</td><td>0.5 - 180.0</td><td>Maximum heading error in degrees to the target heading when data matrix line follow is active</td></tr>
<tr><td><strong>CANOpen Communication parameters</strong></td><td></td><td></td><td></td></tr>
<tr><td>pgv_enabled</td><td>Uint</td><td>1</td><td>PGV sensor enabled (CAN only)</td></tr>
<tr><td>pgv_can_node_id[0...3]</td><td>Int</td><td>1-127</td><td>CAN node ID of camera</td></tr>
<tr><td>pgv_model[0...3]</td><td>Int</td><td>0</td><td>0 = default<br>1 = safePGV</td></tr>
</tbody></table>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ext_loc_x_offset[0...3]</td><td>Float</td><td>0.0</td><td>Nominal X offset from the navigation point to sensor in machine coordinate system, positive forwards</td></tr>
<tr><td>ext_loc_y_offset[0...3]</td><td>Float</td><td>0.0</td><td>Nominal Y offset from the navigation point to sensor in machine coordinate system, positive to the left</td></tr>
<tr><td>ext_loc_h_offset_deg[0...3]</td><td>Float</td><td>0.0</td><td>Nominal heading offset between machine coordinate system and sensor coordinate system, positive CCW</td></tr>
<tr><td>pgv_x_offset[0...3]</td><td>Float</td><td>0.0</td><td>X-offset in meters from nominal position, only small correction values</td></tr>
<tr><td>pgv_y_offset[0...3]</td><td>Float</td><td>0.0</td><td>Y-offset in meters from nominal position, only small correction values</td></tr>
<tr><td>pgv_angle_offset_deg[0...3]</td><td>Float</td><td>0.0</td><td>Angle offset in degrees from nominal heading</td></tr>
<tr><td>ext_loc_pos_ctrl_dist_err_only</td><td>Int</td><td>0</td><td>Position control option to use only distance error from line, when just one sensor is reading the data matrix. Intended for non-omni type vehicles that have sensor(s) outside of navigation point (Navitrol 6.32 onwards).</td></tr>
<tr><td>ext_loc_heading_filt_alpha</td><td>Float</td><td>1.0</td><td>Filtering gain for heading measurement from sensor (0.1 -- 1.0)</td></tr>
<tr><td>ext_loc_pid_heading_p</td><td>Float</td><td>0.0</td><td>Position control gain for heading when external localization is active<br>&lt;= 0.1 use normal pc_pid values&lt;br&gt;&gt; 0.1 use this parameter</td></tr>
<tr><td>ext_loc_pid_dist_p</td><td>Float</td><td>0.0</td><td>Position control gain for distance when external localization is active<br>&lt;= 0.1 use normal pc_pid values&lt;br&gt;&gt; 0.1 use this parameter</td></tr>
<tr><td>ext_loc_stop_distance_offset</td><td>Float</td><td>0.0</td><td>Additional offset for stopping (pc_stop_distance_offset in general use) on data matrix. Positive value if the AGV stops too early.</td></tr>
<tr><td>ext_loc_stop_point_min_agv_dist_from_sp</td><td>Float</td><td>0.5</td><td>AGV needs to be within this distance from the target symbolic point to start checking for the stop point</td></tr>
<tr><td>pgv_max_missing_msg</td><td>Int</td><td>5</td><td>Number of missing messages for error to be triggered (Ethernet only)</td></tr>
<tr><td>pgv_cam_res_x</td><td>Float</td><td>0.0001</td><td>The x-axis resolution of the PGV cameras in meters</td></tr>
<tr><td>pgv_cam_res_y</td><td>Float</td><td>0.0001</td><td>The y-axis resolution of the PGV cameras in meters</td></tr>
<tr><td>pgv_cam_res_h</td><td>Float</td><td>0.1</td><td>The heading resolution (deg) of the PGV cameras</td></tr>
<tr><td><strong>Ethernet Communication parameters if CanOpen not used</strong></td><td></td><td></td><td></td></tr>
<tr><td>ext_loc_eth_model[0...3]</td><td>Int</td><td>-1</td><td>Linefollowing config for ethernet comms<br>-1 = disabled<br>0 = PGV</td></tr>
<tr><td>ext_loc_eth_protocol[0...3]</td><td>Int</td><td>2</td><td>1 = Stream<br>2 = DGRAM</td></tr>
<tr><td>ext_loc_eth_port[0...3]</td><td>Int</td><td>5333</td><td>Linefollowing port</td></tr>
<tr><td>ext_loc_eth_swap_bytes</td><td>Int</td><td>0</td><td>0 = little endian<br>1 = big endian</td></tr>
</tbody></table>
<p><strong>Example parameters to get started for two PGV (CAN Open) cameras</strong></p>
<table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody>
<tr><td>I,ext_loc_docking_enabled,</td><td>1 # Data matrix docking enabled</td></tr>
<tr><td>I,ext_loc_docking_version,</td><td>2 # Data matrix docking V2 active</td></tr>
<tr><td>I,ext_loc_stop_point_enabled</td><td>1</td></tr>
<tr><td>F,ext_loc_x_offset[0],</td><td>0.5</td></tr>
<tr><td>F,ext_loc_y_offset[0],</td><td>0.0</td></tr>
<tr><td>F,ext_loc_h_offset_deg[0],</td><td>0.0</td></tr>
<tr><td>F,ext_loc_x_offset[1],</td><td>-0.5</td></tr>
<tr><td>F,ext_loc_y_offset[1],</td><td>0.0</td></tr>
<tr><td>F,ext_loc_h_offset_deg[1],</td><td>0.0</td></tr>
<tr><td>I,ext_loc_for_pos_ctrl_mode,</td><td>2</td></tr>
<tr><td>F,ext_loc_heading_filt_alpha,</td><td>0.3</td></tr>
<tr><td>U, pgv_enabled,</td><td>1</td></tr>
<tr><td>I,pgv_can_node_id[0],</td><td>3</td></tr>
<tr><td>I,pgv_can_node_id[1],</td><td>4</td></tr>
<tr><td>F, pgv_x_offset[0],</td><td>0.0</td></tr>
<tr><td>F,pgv_y_offset[0],</td><td>0.0</td></tr>
<tr><td>F,pgv_x_offset[1],</td><td>0.0</td></tr>
<tr><td>F,pgv_y_offset[1],</td><td>0.0</td></tr>
<tr><td>F,pgv_angle_offset_deg[0],</td><td>90.0</td></tr>
<tr><td>F,pgv_angle_offset_deg[1],</td><td>-90.0</td></tr>
</tbody></table>
<h2 id="how-to-use-15"><a class="header" href="#how-to-use-15">How to use</a></h2>
<h3 id="configuration-3"><a class="header" href="#configuration-3">Configuration</a></h3>
<p>In Navithor Tools, symbolic point should be filled with the data matrix tape information. These include</p>
<ul>
<li>
<p>Selected symbolic point and approaching segment: The approaching segment needs to be selected for each docking direction separately</p>
<ul>
<li>If you want to dock from different directions relative to symbolic point you must define all these cases separately</li>
</ul>
</li>
<li>
<p>Docking direction: Forward or Backward. This defines the direction with which the AGV docks the symbolic point.</p>
</li>
<li>
<p>Start point: Starting value defines</p>
<ul>
<li>The first value read from the DMC tape when approaching docking location</li>
<li>The last value when leaving docking location the same route.</li>
</ul>
</li>
<li>
<p>End point: Defines the last value read from the DMC tape when leaving docking location over the docking symbolic point.</p>
</li>
<li>
<p>Stop point (X-coordinate): Stop point will trigger stopping of the AGV. It is incorporated with stopping offsets (pc_stop_distance_offset &amp; ext_loc_stop_distance_offset) for targeting that PGV reading would be close to the stop point value at the end.</p>
</li>
<li>
<p>Sideway offset: The offset in Y direction wrt the AGV forward driving direction. If AGV drives forward normally, the sideway offset is positive to the left. This will offset the center of the camera by this value from the tape. Thus, a positive sideway offset will drive the AGV to the left side from the route heading.</p>
</li>
<li>
<p>Heading offset: Defines the heading offset with which to drive the DMC tape. Allowed range [-10, 10] degrees. Positive heading offset will drive the AGV rotated to counter-clockwise direction. Offsets should be kept small.</p>
</li>
<li>
<p>Primary Camera: The index of the primary camera used for DMC position control and for stopping to the defined X-coordinate Stop-point. <strong>Primary camera index needs to be always defined as the AGV is stopped based on the primary camera to the defined stopping point.</strong></p>
<ul>
<li>Indexes match to parameters:
<ul>
<li>PGV:s defined with CanOpen: pgv_can_node_id[<strong>index</strong>]</li>
<li>PGV:s defined with Ethernet communication: ext_loc_eth_model[<strong>index</strong>]</li>
</ul>
</li>
</ul>
</li>
</ul>
<br>
<ul>
<li>Secondary Camera: Defines the index of the secondary camera used for DMC position control. Only used for Y-directional (perpendicular direction with respect to the DMC line) and heading corrections.</li>
</ul>
<br>
<p><img src="PositionControl/DataMatrixDocking/./media-en/image16.PNG" alt="" /></p>
<blockquote>
<p>Docking configuration</p>
</blockquote>
<p><img src="PositionControl/DataMatrixDocking/./media-en/ToolsDockingConfiguration.png" alt="" /></p>
<blockquote>
<p>DMC line configuration for symbolic point on Navithor Tools</p>
</blockquote>
<h3 id="logic-and-error-detection-1"><a class="header" href="#logic-and-error-detection-1">Logic and error detection</a></h3>
<h4 id="main-logic-1"><a class="header" href="#main-logic-1">Main logic</a></h4>
<p>When the AGV is approaching the symbolic point that has data matrix values defined, it will change the driving reference point from route to data matrix line as soon as following conditions are met:</p>
<ul>
<li>
<p>PGV:s primary X-measurement is between defined start and end point.</p>
<ul>
<li>If parameter ext_loc_for_pos_ctrl_mode is set to 3, then both primary and secondary camera X-measurements need to be between start and end point.</li>
</ul>
</li>
<li>
<p>Distance along the route between the AGV and symbolic point is less than data matrix length + small tolerance (0.4m)</p>
</li>
<li>
<p>Heading of the AGV relative to the tape is close enough to the target heading (parameter ext_loc_docking_max_h_err_deg).</p>
</li>
</ul>
<p>Once the AGV changes to follow data matrix line, it will not switch to follow route in the same drive order anymore.</p>
<p>The AGV starts to calculate when to stop after the primary PGV X-measurement is closer than &quot;Check path ready dist&quot; from the stop point value. Trigger to stop, as mentioned, is determined by the primary PGV X-measurement and stopping offsets.</p>
<p>After finishing the stop and executing possible tasks at the location, the AGV will be given a drive order away from the symbolic point. The AGV will be following the data matrix line until primary camera measurements are between start and end point (If both PGV cameras required, then data matrix line following is stopped when either of the cameras are outside start or end point values).</p>
<p>Navitrol Monitor can visualize the active data matrix line by opening a form <em>Navitrol</em> &gt;&gt; <em>Data Matrix Docking V2</em>. In addition, when DMC docking is activated, the primary PGV camera measurements are shown in green and secondary camera measurements in orange.</p>
<p><img src="PositionControl/DataMatrixDocking/./media-en/dataMatrixDockingBackward.png" alt="" /></p>
<blockquote>
<p>Docking to symbolic point 2 backwards using camera indices 0 and 1</p>
</blockquote>
<p><img src="PositionControl/DataMatrixDocking/./media-en/dataMatrixDockingForward.png" alt="" /></p>
<blockquote>
<p>Docking to symbolic point 2 forwards using camera indices 2 and 3</p>
</blockquote>
<h4 id="error-detection-1"><a class="header" href="#error-detection-1">Error detection</a></h4>
<p>As it is desired to drive to the data matrix stop point accurately, it will be constantly supervised that the AGV is receiving valid PGV measurements while approaching or leaving the symbolic points.</p>
<ol>
<li><strong>Approaching the symbolic point</strong></li>
</ol>
<ul>
<li>
<p>The AGV must get at least one valid PGV measurement before it is closer than &quot;Check path ready dist&quot; from symbolic point, otherwise error ERROR_EXT_LOC_NOT_SAFE_TO_DRIVE is triggered.</p>
</li>
<li>
<p>After getting first valid measurement and changing to data matrix line follow, it is checked that the AGV does not travel without valid measurement for more than ext_loc_max_dist_since_last_meas while outside &quot;Check path ready dist&quot; from the symbolic point. Otherwise error EXT_LOC_TOO_LONG_SINCE_VALID_MEASUREMENT is triggered.
<strong>Note:</strong> If AGV stops to this error at very start of data matrix line, it is likely that the heading validation has failed.</p>
</li>
<li>
<p>While inside &quot;Check path ready dist&quot; from symbolic point, a stricter limit is used ext_loc_strict_max_dist_since_last_meas.</p>
</li>
</ul>
<ol>
<li><strong>Leaving the symbolic point</strong></li>
</ol>
<ul>
<li>
<p>The AGV must get valid PGV measurements also when leaving the symbolic point while inside active DMC line start and end value. Otherwise error ERROR_EXT_LOC_TOO_LONG_SINCE_MEASUREMENT is triggered.</p>
<ul>
<li>Parameter ext_loc_strict_max_dist_since_last_meas will be used for error detection within &quot;Check path ready dist&quot; from the symbolic point.</li>
<li>After that parameter ext_loc_max_dist_since_last_meas is used for measurement validation</li>
</ul>
</li>
<li>
<p>After the primary camera PGV X-measurements are outside of start and end values of active DMC line, the AGV will change to route following.</p>
</li>
</ul>
<ol>
<li>
<p><strong>After software reboot</strong></p>
<ul>
<li>
<p>If the AGV is closer than &quot;Check path ready dist&quot; from the symbolic point that is target for a new drive order (or there is some other ambiguity from which direction the AGV is approaching the stop point), it will be checked whether the drive is ok to be ready.</p>
<p>i.  Drive is ready if PGV X-measurement is closer than ext_loc_path_ready_max_dist_err from the stop point.</p>
<p>ii. Error ERROR_EXT_LOC_NOT_SAFE_TO_DRIVE will be triggered if the first condition is not true</p>
</li>
</ul>
</li>
</ol>
<h3 id="troubleshooting-30"><a class="header" href="#troubleshooting-30">Troubleshooting</a></h3>
<ul>
<li>
<p><em>Data matrix Docking does not start even though PGV gets readings from the tape when close to symbolic point</em></p>
<ul>
<li>
<p>Check that your camera parameters are correct. Typical issue is that heading of the camera is wrong and a sanity check rejects the measurement (ext_loc_docking_max_h_err_deg).</p>
</li>
<li>
<p>From Navitrol 6.48 onwards there is a possibility to show the PGV positions in Navitrol Monitor.</p>
</li>
<li>
<p>Check that the camera parameters for the position and for the connection have the same index. In other words, the measurements come from the correct camera.</p>
</li>
<li>
<p>Check that the Data matrix docking has been configured to the symbolic point and for the correct driving direction.</p>
</li>
</ul>
</li>
<li>
<p><em>ERROR_EXT_LOC_TOO_LONG_SINCE_MEASUREMENT is shown</em></p>
<ul>
<li>
<p>The data matrix docking is active and PGV camera should be able to read the QR code but PGV has not received any valid measurements. The Error is triggered after the AGV has travelled distance longer than ext_loc_max_dist_since_last_meas without valid measurements (when close to symbolic point using the ext_loc_strict_max_dist_since_last_meas value when defined).</p>
</li>
<li>
<p>Check what is the reason for not receiving measurements from the PGV. For example, is the tape damaged or is the PGV camera too far away from the tape.</p>
</li>
<li>
<p>To get AGV out of the error situation, move the AGV manually to route point that is out of the the data matrix.</p>
</li>
</ul>
</li>
<li>
<p><em>AGV does not drive accurately enough on the data matrix tape</em></p>
<ul>
<li>
<p>View the performance of the AGV by opening the graphs from the upper left corner 'Show Graphs' of the Data Matrix Code Docking V2 window.</p>
</li>
<li>
<p>Verify that the target offsets are set correctly.</p>
</li>
<li>
<p>Check the calibration of the PGV camera pose.</p>
</li>
<li>
<p>Tune the position control gains (pc_pid_dist_p, pc_pid_heading_p / ext_loc_pid_heading_p, ext_loc_pid_dist_p).</p>
</li>
<li>
<p>Slow down the AGV's speed if possible.</p>
</li>
<li>
<p>Correct the stop position with stop offset (pc_stop_distance_offset / ext_loc_stop_distance_offset).</p>
</li>
</ul>
<p><img src="PositionControl/DataMatrixDocking/./media-en/dataMatrixDockingGraphs.PNG" alt="" /></p>
<blockquote>
<p>Graphs show the lateral position and heading of the AGV on the data matrix line.</p>
</blockquote>
</li>
</ul>
<p><strong>Note!</strong>
Some of the errors are persistent. Put the AGV to Manual state and possibly drive away from the error location. Turn off the Manual state and wait for the error to be cleared.</p>
<h2 id="appendix-1"><a class="header" href="#appendix-1">Appendix</a></h2>
<h3 id="ethernet-communication-protocol-1"><a class="header" href="#ethernet-communication-protocol-1">Ethernet communication protocol</a></h3>
<p>Please refer to External localization document for configuring PGV cameras for Etherner communication protocol</p>
<p><a href="PositionControl/DataMatrixDocking/../../Localization/ExternalLocalization/ExternalLocalization-en.html#ethernet-communication-protocol">External localization - ethernet communication protocol</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docking-1"><a class="header" href="#docking-1">Docking</a></h1>
<p>Updated 25.06.2024</p>
<hr />
<h2 id="overview-26"><a class="header" href="#overview-26">Overview</a></h2>
<p>Docking allows for deviating from the nominal route to align the AGV to the target by creating a new route. If docking is not enabled, then the AGV will only drive on the route until it reaches the Symbolic point. </p>
<h3 id="introduction-34"><a class="header" href="#introduction-34">Introduction</a></h3>
<p>Docking can be for example used with a forklift AGV to align the fork tips with the pockets of a EUR-pallet for more precise pick-up, allowing the position and heading of the pallet to deviate from the symbolic point. </p>
<h3 id="dependencies-10"><a class="header" href="#dependencies-10">Dependencies</a></h3>
<p>The source for the docking pose can be any of the following.</p>
<ul>
<li>Target detection:
<ul>
<li>Pallet detection</li>
<li>Pattern detection</li>
<li>3D load detection</li>
<li>Table detection</li>
<li>External target detection</li>
</ul>
</li>
</ul>
<h2 id="setup-19"><a class="header" href="#setup-19">Setup</a></h2>
<h3 id="quick-start-9"><a class="header" href="#quick-start-9">Quick start</a></h3>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>docking_to_target_enabled</td><td>Int</td><td>0</td><td>1 = Enables docking to target. 2 = docking with custom route. If target_detection_type_selection = 0, won't do anything.</td></tr>
<tr><td>docking_stop_distance</td><td>Float</td><td>0.5</td><td>Defines how close to the target vehicle tries to drive (calculated from navigation point to target).</td></tr>
<tr><td>docking_approach_dist</td><td>Float</td><td>1.25</td><td>After this distance vehicle stops, if the approach error is too big.</td></tr>
</tbody></table>
<h3 id="fine-tuning-7"><a class="header" href="#fine-tuning-7">Fine-tuning</a></h3>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>docking_max_start_distance</td><td>Float</td><td>3.5</td><td>Beyond maximum distance docking won't be triggered.</td></tr>
<tr><td>docking_max_start_angle</td><td>Float</td><td>15.0</td><td>Maximum angle difference from navigation point to the target compared to tarjectory's end point's heading, when starting to dock [+-degrees fov].</td></tr>
<tr><td>docking_max_start_heading</td><td>Float</td><td>5.0</td><td>Maximum angle diff for vehicle heading and trajectory's end point heading, when starting to dock [+-degrees fov].</td></tr>
<tr><td>docking_max_dist_error_from_end_point</td><td>Float</td><td>0.5</td><td>Maximum distance difference for the stopping point compared to the symbolic point.</td></tr>
<tr><td>docking_max_target_angle</td><td>Float</td><td>15.0</td><td>Maximum difference between target and end point's headings.</td></tr>
<tr><td>docking_y_offset</td><td>Float</td><td>0.0</td><td>Offset in y-coordinate for docking (in machine coordinates).</td></tr>
<tr><td>docking_approach_max_dist_err</td><td>Float</td><td>0.1</td><td>If distance error is bigger than this in approach area, vehicle stops.</td></tr>
<tr><td>docking_approach_max_h_err_deg</td><td>Float</td><td>5.0</td><td>If heading error is bigger than this [deg] in approach area, vehicle stops.</td></tr>
<tr><td>docking_allow_maneuver</td><td>Int</td><td>0</td><td>If errors are too high on approach, 0 = stop the machine, 1 = try to maneuver back and forward.</td></tr>
<tr><td>docking_small_gains_dist</td><td>Float</td><td>0.5</td><td>The distance before stopping where curvature is limited with docking_limit_curv_on_approach.</td></tr>
<tr><td>docking_limit_corr_dist</td><td>Float</td><td>0.5</td><td>The distance before stopping which is driven only with odometry. Location correction disabled or limited with docking_max_xy_corr and docking_max_h_corr.</td></tr>
<tr><td>docking_small_gains</td><td>Int</td><td>1</td><td>Enables curvature limit that uses docking_limit_curv_on_approach and docking_limit_curv_on_approach_dist.</td></tr>
<tr><td>docking_max_xy_corr</td><td>Float</td><td>0.0001</td><td>Maximum XY-corrections while approaching target.</td></tr>
<tr><td>docking_max_h_corr</td><td>Float</td><td>0.003</td><td>Maximum heading corrections [deg] while approaching target.</td></tr>
<tr><td>docking_limit_curv_on_approach</td><td>Float</td><td>0.1</td><td>Fraction to limit the calculated curvature. For example, 0.1 means that the curvature is 10% from the calculated value.</td></tr>
<tr><td>docking_limit_curv_on_leave</td><td>Float</td><td>0.05</td><td>Fraction to limit the calculated curvature. For example, 0.05 means that the curvature is 5% from the calculated value. Used only when docking_leave_unload_loc_straight is set to 1.</td></tr>
<tr><td>docking_limit_drive_vector_angle_change_on_leave</td><td>Float</td><td>0.01</td><td>Fraction to limit the drive vector angle change when leaving a docking situation. For example, 0.05 means that the drive vector change is 5% from the calculated value. Used only when docking_leave_unload_loc_straight is set to 1.</td></tr>
<tr><td>docking_dist_gain</td><td>Float</td><td>1.0</td><td>Factor for the position control distance gain when docking. 0 = use pc_pid_dist_p.</td></tr>
<tr><td>docking_heading_gain</td><td>Float</td><td>1.0</td><td>Factor for the position control heading gain when docking. 0 = use pc_pid_heading_p.</td></tr>
<tr><td>docking_ref_v_source</td><td>Int</td><td>0</td><td>Speed source when doing docking: 0 = calculated from distance to target, 1 = using route velocity value, 2 = use fixed parameter docking_speed.</td></tr>
<tr><td>docking_speed</td><td>Float</td><td>0.3</td><td>Speed while docking, if docking_ref_v_source == 2. If it is 0, this is minimum starting speed for the docking drive.</td></tr>
<tr><td>docking_limit_leave_speed</td><td>Float</td><td>0.2</td><td>Limit speed while driving out from docking location, if docking_limit_leave_speed_and_actuator_height_dist &gt; 0. If it is below 0, speed is not limited.</td></tr>
<tr><td>docking_limit_leave_speed_and_actuator_height_dist</td><td>Float</td><td>-1.0</td><td>Distance from the unload location, where the speed is limited to docking_limit_leave_speed and fork height kept at the measured value. If negative, they are not limited. If enabled, must be smaller than docking_mode_to_fleet_control_dist parameter.</td></tr>
<tr><td>docking_leave_unload_loc_straight</td><td>Int</td><td>0</td><td>Enables limit curvature when leaving unload or docking location.</td></tr>
<tr><td>docking_leave_unload_loc_straight_dist</td><td>Float</td><td>1.0</td><td>Limit curvature until this distance from load or unload.</td></tr>
<tr><td>docking_mode_to_fleet_control_dist</td><td>Float</td><td>2.5</td><td>Keep the reported docking mode for fleet control active for this distance after leaving the docking location. The distance is measured from the navigation point position at the end of previous docking to its current position.</td></tr>
<tr><td>docking_notify_approach_dist</td><td>Float</td><td>0.5</td><td>Distance from docking target when a notification is sent to the AGV control.</td></tr>
<tr><td>docking_stopping_point_offset_mode</td><td>Int</td><td>0</td><td>0 = Use general stopping offsets, 1 = offsets are defined individually for each pallet model with parameters.</td></tr>
<tr><td>docking_follow_route_properties</td><td>Int</td><td>1</td><td>Use defined properties on the route while creating custom route for docking.</td></tr>
<tr><td>docking_refpoint_max_err</td><td>Float</td><td>-0.5</td><td>Maximum error [m] for the docking point after started docking. Indicate pushing pallet. If negative, not used.</td></tr>
<tr><td>docking_actuator_height_control_mode</td><td>Int</td><td>0</td><td>Defines how lift / fork actuator is controlled in relation to the detected target height during docking. 0 = Disabled, 1 = Direct control. Detected target height is given directly as actuator height reference. 2 = Relative control. Actuator is controlled so that detected height matches value defined by docking_actuator_target_height.</td></tr>
<tr><td>docking_actuator_target_height</td><td>Float</td><td>0.0</td><td>Defines the desired target height [m] during docking. Actuator is controlled so that height of the detected target matches this value. Only used when docking_actuator_height_control_mode is set to 2.</td></tr>
<tr><td>docking_actuator_height_strict_dist</td><td>Float</td><td>0.0</td><td>Defines a distance [m] from the docking target point within which actuator height must be on the reference or the drive is stopped.</td></tr>
<tr><td>docking_actuator_height_start_dist</td><td>Float</td><td>20.0</td><td>Defines a distance [m] from the docking target point within which the actuator height control is allowed.</td></tr>
<tr><td>docking_control_point_1_dist_from_machine</td><td>Float</td><td>0.2</td><td>Minimum required distance for the node straight to the AGV heading. The start node is calculated automatically, but if it is closer to the AGV than this parameter, an error is set. Used to avoid driving too sharp curves.</td></tr>
<tr><td>docking_control_point_2_dist_from_target</td><td>Float</td><td>0.8</td><td>Distance for the node to create straight route before target.</td></tr>
<tr><td>docking_allow_custom_route_update</td><td>Int</td><td>0</td><td>0 = custom route is locked after it is created, 1 = custom route is updated if the target changes.</td></tr>
<tr><td>docking_custom_route_min_xy_diff</td><td>Float</td><td>0.02</td><td>Minimum distance difference [m] between the old pallet and the new to update the last part of the custom route. If set to positive, custom route is updated. Also uses target_detection_max_diff_in_xy_results to check that the difference is not too large.</td></tr>
<tr><td>docking_custom_route_min_angle_diff</td><td>Float</td><td>2.0</td><td>Minimum angle difference [deg] between the old pallet and the new to update the last part of the custom route. If set to positive, custom route is updated. Also uses target_detection_max_diff_in_angle_results to check that the difference is not too large.</td></tr>
<tr><td>docking_custom_route_max_allowed_xy_diff_for_target</td><td>Float</td><td>0.2</td><td>Maximum limit [m] for the custom route update related to the initial target. The custom route is not updated if the new target is further away than this parameter from the initial target (target location when the custom route is created for the first time).</td></tr>
<tr><td>docking_use_route_heading</td><td>int</td><td>0</td><td>Defines how the docking end heading is selected. 0 = Detected heading of the target is used requiring more space for manouvering. 1 = Route heading is used allowing a heading offset to the target. Only used when docking_to_target_enabled = 1.<br/>Designed to be used in narrow corridors with large AGV:s.<br/>When the route heading is used the nominal route from the docking start point forwards must be exactly straight.<br/>Note: Replaces detected target heading with current trajectory point heading.<br/>Supported only when docking_to_target_enabled = 1.</td></tr>
<tr><td>docking_approach_warning_to_error_timeout_s</td><td>int</td><td>-1</td><td>Defines a time [s] after which the WARNING_TARGET_APPROACH_ERROR activates ERROR_DOCKING_FAILED. <br/>-1 = Never. <br/>It is recommended to set this to suitable value so that failed docking attempt becomes clearly visible as an error.</td></tr>
<tr><td>docking_with_only_distance_control_enabled</td><td>int</td><td>0</td><td>Enables docking to target with only distance control. docking_to_target_enabled must be 1 for this parameter to have effect.</td></tr>
</tbody></table>
<p>The docking is started when:</p>
<ul>
<li>
<p>AGV is within the <strong>docking_max_start_distance</strong> to Symbolic point the target is found</p>
</li>
<li>
<p>Pallet heading is inside <strong>docking_max_start_angle</strong> (related to symbolic point)</p>
</li>
<li>
<p>AGV heading is inside <strong>docking_max_start_heading</strong> (related to symbolic point)</p>
</li>
<li>
<p>AGV is driving to same direction as the trajectory end.</p>
</li>
<li>
<p>Target is within <strong>docking_max_dist_error_from_end_point</strong> distance from symbolic point</p>
</li>
<li>
<p>There are no pivot points or direction changes on the active path between AGV and the target symbolic point</p>
</li>
</ul>
<p>These start condition parameters are explained with pictures down below.</p>
<p>The docking target points is calculated from the middle point from the front line. It can be changed with these parameters:</p>
<p>F,docking_stop_distance, 0.50 # Defines how close to the target vehicle tries to drive (calculated from navigation point to target)</p>
<p>F,docking_y_offset, 0.0 # Offset in y-coordinate for docking (in machine coordinates)</p>
<p>NOTE! The y-offset is not needed in normal use if the scanner is calibrated correctly. It is useful for example for AGV that has to always drive to the side. For example, if the pallet is weighted or the forks are on the side of the AGV.</p>
<p><img src="PositionControl/Docking/./media-en/image17.png" alt="" /></p>
<blockquote>
<p>Offsets. The small red circle is the middle of the target. The docking_stop_distance and docking_y_offset is calculated from that location to get the target where the AGV will drive (blue dot). The coordinate shows what direction the offsets are calculated related to the small red circle.</p>
</blockquote>
<p>If both parameters are zero, the target will be on the middle of the front line (the small red circle on the picture above). This red circle is not normally drawn on Monitor, but used here only for explanation.
The offsets are calculated always related to the navigation point and its coordinates. The positive x is forward to the forward driving direction and positive y is left-hand side (see the coordinates on the picture). On this picture, the AGV is driving backwards, that's why the offsets are calculated on this direction.</p>
<p>These two parameters are general for all models. If there is a need to define different offsets for certain model, they can be set with these model-based parameters. These model-based parameters are used instead if parameter <strong>docking_stopping_point_offset_mode</strong> is set to 1.</p>
<p>F,pallet_model_y_offset[0], 0.0 # Offset in y-coordinate for docking (in machine coordinates)</p>
<p>F,pallet_model_stop_distance[0], 0.0 # Defines how close to the target vehicle tries to drive (calculated from navigation point to target)</p>
<p><img src="PositionControl/Docking/./media-en/image18.png" alt="" /></p>
<blockquote>
<p>Docking_max_start_distance is calculated as linear distance.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image19.png" alt="" /></p>
<blockquote>
<p>Angle difference between symbolic point heading and angle from a line calculated from navigation point to the symbolic point has to be within limit of docking_max_start_angle.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image20.png" alt="" /></p>
<blockquote>
<p>Angle difference between symbolic point's and AGV's headings has to be withing limits of docking_max_start_heading.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image21.png" alt="" /></p>
<blockquote>
<p>Angle difference between target angle and symbolic point's heading has to be within limits of docking_max_target_angle.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image22.png" alt="" /></p>
<blockquote>
<p>Distance error between symbolic point and the calculated stopping point has to be inside limit of docking_max_dist_error_from_end_point.</p>
</blockquote>
<h3 id="recommended-docking-mode-for-kinematic-type"><a class="header" href="#recommended-docking-mode-for-kinematic-type">Recommended docking mode for kinematic type</a></h3>
<p>With non-omnidirectional AGVs, such as <strong>steer and diff</strong> drives, <strong>custom route</strong> docking should be preferred.</p>
<ul>
<li>
<p>If the error to the path is large when the docking starts, the position controller might start oscillating, which would decrease docking accuracy.</p>
</li>
<li>
<p>Custom routes are smoother to drive.</p>
</li>
</ul>
<p>With <strong>omni drive</strong> <strong>both modes work well</strong>, so it is a preference question</p>
<ul>
<li>
<p>Driving the straight path allows correcting the position faster and position can be still corrected while driving.</p>
</li>
<li>
<p>Custom route is smoother but requires more space.</p>
</li>
</ul>
<h3 id="normal-docking"><a class="header" href="#normal-docking">Normal docking</a></h3>
<p>Normal docking (<strong>docking_to_target_enabled</strong> = 1) updates the reference point (green point on the pictures below) to the straight line from the target and to AGV navigation point. Recommended to be used with omni.</p>
<p>The target is locked when the AGV is at the distance of <strong>pallet_det_2_min_dist_from_nav_point_to_traj_end</strong> from the end point. After that distance, the reference point is not updated.</p>
<h4 id="normal-docking-with-steer-or-diff"><a class="header" href="#normal-docking-with-steer-or-diff">Normal docking with steer or diff</a></h4>
<p>One downside with normal docking with steer or differential is that the position correction is done based on heading and distance gains (<strong>pc_pid_dist_p</strong> and <strong>pc_pid_heading</strong> or <strong>docking_dist_gain</strong> and <strong>docking_heading_gain</strong>). This might cause issues, because these kinematic types can't follow large changes on reference point very fast.</p>
<p><img src="PositionControl/Docking/./media-en/image23.png" alt="" /></p>
<blockquote>
<p>The green reference point is created to straight line from the target. The blue point is the target.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image24.png" alt="" /></p>
<blockquote>
<p>The AGV starts to control itself to the reference point based on pid heading and distance gains. With steer type AGV, the heading correction cannot be done very fast.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image25.png" alt="" /></p>
<blockquote>
<p>There might be some error at the end with steer type AGV, because it requires much space to get the heading correct.</p>
</blockquote>
<h4 id="normal-docking-with-mechanum-or-omni"><a class="header" href="#normal-docking-with-mechanum-or-omni">Normal docking with mechanum or omni</a></h4>
<p>With omni or mechanum kinematic types, the normal docking is recommended, because these types allow the AGV to correct its position quickly to the reference point. The next four Figures shows one example where the mechanum is driven under table. Then the next four Figures shows more extreme example drive with mechanum. This is quite extreme case, but the idea is just to show the difference related to the steer type AGV and how fast the position can be corrected. This kind of situation would even not be possible in every location, because the angle difference is so high and it makes the AGV to drive quite far from the route.</p>
<p><img src="PositionControl/Docking/./media-en/image26.png" alt="" /></p>
<blockquote>
<p>Normal example with mechanum.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image27.png" alt="" /></p>
<blockquote>
<p>Now the AGV has driven close to the reference point.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image28.png" alt="" /></p>
<blockquote>
<p>AGV will drive closer to the pallet.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image29.png" alt="" /></p>
<blockquote>
<p>AGV arrives at target.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image30.png" alt="" /></p>
<blockquote>
<p>This is extreme example with mechanum AGV. This shows where the reference point can go if the pallet angle is not ideal.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image31.png" alt="" /></p>
<blockquote>
<p>The mechanum and omni AGVs can start driving immediately to the reference point.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image32.png" alt="" /></p>
<blockquote>
<p>Then the AGV can just drive straight to the target.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image33.png" alt="" /></p>
<h3 id="docking-with-custom-route"><a class="header" href="#docking-with-custom-route">Docking with custom route</a></h3>
<p>In this mode (<strong>docking_to_target_enabled</strong> == 2), the custom route is created from the AGV position to target. It is created based on five nodes. The nodes are created to these locations.</p>
<ol>
<li>
<p>AGV navigation point.</p>
</li>
<li>
<p>AGV heading direction to line that goes through target and node 3. See Figure down below.</p>
</li>
<li>
<p>Straight to the target angle (see black dashed line on Figure down below) and <strong>docking_control_point_2_dist_from_target</strong> distance.</p>
</li>
<li>
<p>Same as 3, but to the half distance from target.</p>
</li>
<li>
<p>Target x + <strong>docking_stop_distance</strong> and target y + <strong>docking_y_offset</strong>.</p>
</li>
</ol>
<p><img src="PositionControl/Docking/./media-en/image34.png" alt="" /></p>
<blockquote>
<p>The 2nd node distance (blue arrow) is the smallest distance from the line that goes to target heading to navigation point (black arrow). Here the black and blue arrow has the same length, but blue just indicates the direction where the node is created. The node is created to AGV heading direction depending on driving direction.</p>
</blockquote>
<p>The main advantage for the normal docking is that the straight part to the target can be modified with parameter. That is really useful for steer and differential kinematic types.</p>
<p>By default, the custom route is created only once and it is not updated after that. Even if the target location changes. However, the custom route can be updated during the drive if this parameter is set:</p>
<p><strong>I,docking_allow_custom_route_update, 1</strong></p>
<p>Then the target is locked when the AGV is at the distance of <strong>pallet_det_2_min_dist_from_nav_point_to_traj_end</strong> from the end point.</p>
<p>NOTE! Custom route cannot be created if the AGV is closer to the target than <strong>docking_control_point_1_dist_from_machine</strong> + <strong>docking_control_point_2_dist_from_target</strong>. Otherwise the route would be impossible to create. The control_point_1 parameter is used only to check the minimum distance from the AGV to the 2^nd^ node, but it's not used for calculating the route.</p>
<p><img src="PositionControl/Docking/./media-en/image35.png" alt="" /></p>
<blockquote>
<p>Start of the custom route docking. If the custom route is not allowed to update, this would be the route to the target.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image36.png" alt="" /></p>
<blockquote>
<p>Here the update is allowed, so the last three nodes are moved based on the updated target location. The first two are keep as static, so the AGV would be close to the route.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image37.png" alt="" /></p>
<blockquote>
<p>AGV will continue driving the custom route and updating the target position.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image38.png" alt="" /></p>
<blockquote>
<p>The lock distance is roughly 0.5m, so the target is still update quite late.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image39.png" alt="" /></p>
<blockquote>
<p>AGV at the target.</p>
</blockquote>
<h3 id="docking-with-only-distance-control"><a class="header" href="#docking-with-only-distance-control">Docking with only distance control</a></h3>
<p>Docking with only distance control is a docking method in which the angle and sideways offset of a detected target are ignored and the docking is performed by stopping at <strong>docking_stop_distance</strong> from the target. </p>
<p>Docking with only distance control works similarly to setting a longitudinal offset to a drive order but instead of using constant offset from the original target location, the offset is calculated based on the detected target location.</p>
<p>The feature was designed for docking to a target in narrow spaces where angle and sideways corrections in relation to the target are either not desired or are otherwise not feasible.</p>
<p>Docking with only distance control is a sub feature of docking without a custom route.<br />
As a sub feature of docking without custom route the same parameters can be used with the sub feature as well.</p>
<p>The feature can be enabled with <strong>docking_with_only_distance_control_enabled</strong>.</p>
<p>Related parameters that can be adjusted:</p>
<ul>
<li><strong>docking_to_target_enabled</strong> </li>
<li><strong>docking_stop_distance</strong></li>
<li><strong>docking_max_dist_error_from_end_point</strong></li>
<li><strong>docking_max_start_distance</strong></li>
</ul>
<h3 id="docking-speed"><a class="header" href="#docking-speed">Docking speed</a></h3>
<p>Adjusting driving speed while docking:</p>
<p><strong>F,docking_ref_v_source, 0</strong></p>
<p>Speed source when doing docking, 0 = calculated from distance to target and linearly decreased (starting speed is current driving speed when docking starts), 1 = using route velocity value, 2 = use fixed parameter docking_speed.</p>
<p><strong>NOTE!</strong> With speed source parameter 0, the start speed is quite critical. If for example the docking starts on the curve, the initial start speed can be quite slow already and then the speed is just linearly decreased from that value based on distance.</p>
<p><strong>F,docking_speed, 0.30 (m/s)</strong></p>
<p>Speed while docking, if docking_ref_v_source == 2. If docking_ref_v_source is 0, this defines the minimum start speed for the docking drive.</p>
<p><strong>F, docking_limit_leave_speed, 0.20 (m/s)</strong></p>
<p>Limit speed while driving out from docking location, if docking_limit_leave_speed_and_actuator_height_dist &gt; 0. If it is below 0, speed is not limited.</p>
<p><strong>F, docking_limit_leave_speed_and_actuator_height_dist, -1.0</strong></p>
<p>Distance from the unload location, where the speed is limited to <strong>docking_limit_leave_speed</strong> and fork height is limited to the measured value. If negative, they are not limited. If enabled, has to be smaller than docking_mode_to_fleet_control_dist parameter.</p>
<h3 id="actuator-height-control"><a class="header" href="#actuator-height-control">Actuator height control</a></h3>
<p>Fork and lift actuators can be controlled based on the height measurement from target detection algorithm when approaching the docking position. This requires using target detection method, such as reflector height detection, that provides z coordinate of the target in addition to x and y coordinates.</p>
<p>Feature requires height measurements from the controlled actuator and that the target detection gives height / z coordinate in meters and actuator operation unit is millimeters.</p>
<p>Typically target height based height control is only needed when docking is done while driving on uneven floor or when the target height can vary. On even floor constant approach height defined as route property is typically sufficient.</p>
<p><strong>I,docking_actuator_height_control_mode, 0</strong><br />
Defines how lift / fork actuator is controlled in relation to the detected target height during docking.<br />
0 = Disabled, height actuator is not controlled based on target detection.<br />
1 = Direct control. Detected target height is given directly as actuator height reference. Makes it possible to detect different targets as long as the target detection gives the correct docking height. Requires that detected target height is independent from actuator height control.<br />
2 = Relative control. Actuator is controlled so that detected height matches value defined by <strong>docking_actuator_target_height</strong>. Makes it possible to dock relatively to target without knowing its exact height and in cases where the target detection measurement changes in relation to the actuator height. </p>
<p><strong>F,docking_actuator_target_height, 0.0</strong><br />
Defines the desired target height [m] during docking. Actuator is controlled so that height of the detected target matches this value. For example if detected target height is 1.5m and the parameter value is set to 1m actuator is lowered 0.5m.<br />
Only used when <strong>docking_actuator_height_control_mode</strong> is set to 2.<br />
To define correct value for this parameter, first dock manually to desired height, then check the height received from the target detection and set the value to this parameter.</p>
<p><strong>F,docking_actuator_height_start_dist, 20.0</strong><br />
Defines a distance in meters from the docking target point within which the actuator height control is allowed. Should be adjusted if it is not desired to start controlling the actuator height instantly when the docking is started. Must be larger than <strong>docking_actuator_height_strict_dist</strong>.</p>
<p><strong>F,docking_actuator_height_strict_dist, 0.0</strong><br />
Defines a distance in meters from the docking target point within which the actuator height must be on the reference value or the drive is stopped until measured value reaches the reference. Must be smaller than <strong>docking_actuator_height_start_dist</strong>.</p>
<p>In case the the actuator control must be limited when leaving the docking location (undocking) use <strong>docking_limit_leave_speed_and_actuator_height_dist</strong> parameter as described in &quot;Docking speed&quot; chapter.</p>
<h3 id="limit-curvature-on-approach"><a class="header" href="#limit-curvature-on-approach">Limit curvature on approach</a></h3>
<p>Curvature can be limited also when approaching a target in order to prevent any unnecessary heading corrections in the end of the docking.</p>
<p>If the docking to target goes fine, these do not need to be changed from their default values.</p>
<p><strong>I,docking_small_gains, 1</strong></p>
<p>If set to 1, the curvature is limited with <strong>docking_limit_curv_on_approach</strong> gain within <strong>docking_small_gains_dist</strong> distance.</p>
<p><strong>F,docking_small_gains_dist, 0.50 (meters)</strong></p>
<p>When AGV is closer than this distance to the target, the curvature is limited.</p>
<p><strong>F,docking_limit_curv_on_approach, 0.1</strong></p>
<p>Limiting gain parameter for maximum curvature, while approaching target.
Setting this to 0.0 would mean no curvature is allowed at all. 0.50 would mean half of the normal curvature calculated is still applied.</p>
<h3 id="limit-curvature-on-leave"><a class="header" href="#limit-curvature-on-leave">Limit curvature on leave</a></h3>
<p>In some situations, the AGV should not be allowed to make any heading corrections, after a pallet has been picked up to avoid collisions with pallets or other obstacles nearby the loading location.</p>
<ul>
<li>
<p>When the AGV starts driving away, it has to return to the nominal route, which often causes the AGV to turn.</p>
</li>
<li>
<p>This is not a problem, if the pallets are always very close to the expected location, or if there is enough space between the pallets.</p>
</li>
</ul>
<p>While driving away from the load location after using target detection (or after unloading), curvature change can be limited with parameters:</p>
<p><strong>F,docking_limit_curv_on_leave, 0.05</strong></p>
<p>Limiting gain parameter for maximum curvature, while leaving the location. Setting this to 0.0 would mean no curvature is allowed at all.
0.50 would mean half of the normal curvature calculated is still applied.</p>
<p><strong>F,docking_leave_unload_loc_straight_dist, 1.0 (meters)</strong></p>
<p>Curvature is limited until the AGV has driven further away from the target detection location than the distance defined by this parameter.
(Even though it says unload_loc, the parameter has multiple uses).</p>
<p><strong>I,docking_leave_unload_loc_straight, 0</strong></p>
<p>Limit curvature after unloading, if set to 1. Parameters above are
applied also for this case.</p>
<p>This feature works even without pallet detection being enabled.</p>
<p><img src="PositionControl/Docking/./media-en/image40.png" alt="" /></p>
<blockquote>
<p>Without limiting the curvature, AGV just drives straight back to the route.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image41.png" alt="" /></p>
<blockquote>
<p>AGV is back on the route.</p>
</blockquote>
<p><img src="PositionControl/Docking/./media-en/image42.png" alt="" /></p>
<blockquote>
<p>When limiting curvature, AGV will drive straight for certain distance before returning back to route.</p>
</blockquote>
<h3 id="adjusting-position-correction"><a class="header" href="#adjusting-position-correction">Adjusting position correction</a></h3>
<p>In some cases, driving under target blocks the sight of the scanner or scanners in a way that it affects the localization causing unnecessary peaks in the scanner corrections. This can be limited by applying more strict maximum values for corrections, while close to the target:</p>
<p><strong>F,docking_limit_corr_dist, 0.50</strong></p>
<p>When AGV is closer to the target than the distance defined by this parameter, docking_max_xy and h_corr are used.</p>
<p><strong>F, docking_max_xy_corr, 0.0001</strong></p>
<p>Max loc xy corr while approaching target.</p>
<p><strong>F, docking_max_h_corr, 0.003</strong></p>
<p>Max loc h corr while approaching target.</p>
<p>If both parameters are set to 0, scanner correction is disabled and the AGV drives this distance based on odometry alone.</p>
<p>Parameters described down below have more effect when using normal docking, as custom route should usually work with the normal PID values.
Use different position controller values while docking:</p>
<p><strong>F,docking_dist_gain, 1.0</strong></p>
<p>Dist gain while docking, 0 = use standard pc_pid_dist_p</p>
<p><strong>F,docking_heading_gain, 1.0</strong></p>
<p>Heading gain while docking, 0 = use standard pc_pid_heading_p</p>
<p>These are gain parameters, that scale the standard position controller values, so using value 1.0 mean that normal correction values are used.</p>
<p>Values over 1.0 strengthen the distance or heading correction and lower value lessens the correction.</p>
<p><strong>Distance gain</strong></p>
<p>If the AGV does not correct the position to the path fast enough, dist gain should be increased - Increasing too much causes oscillation.</p>
<p>If position controller is unstable, dist gain should be lowered.</p>
<p><strong>Heading gain</strong></p>
<p>If the AGV does not keep the correct heading when under the pallet, heading gain should be increased.</p>
<h2 id="troubleshooting-31"><a class="header" href="#troubleshooting-31">Troubleshooting</a></h2>
<h3 id="errors-and-warnings-13"><a class="header" href="#errors-and-warnings-13">Errors and warnings</a></h3>
<h4 id="569-error_docking_failed"><a class="header" href="#569-error_docking_failed">569 ERROR_DOCKING_FAILED</a></h4>
<p>This error indicates that the docking has failed in a way that a manual intervention is required.</p>
<p>For example this error is set after the WARNING_TARGET_APPROACH_ERROR has been active for longer than <strong>docking_approach_warning_to_error_timeout_s</strong>. </p>
<p><strong>How to recover:</strong><br />
See the automatically taken log for more details and resolve the docking situation and the error reason manually. Release the fatal error and retry docking from the beginning.</p>
<h4 id="613-warning_target_approach_error"><a class="header" href="#613-warning_target_approach_error">613 WARNING_TARGET_APPROACH_ERROR</a></h4>
<p>This warning is given in various situations:</p>
<p>When AGV is within <strong>docking_max_start_distance</strong> from the target but  the distance or angle error between the detected target and the expected target location exceeds the limits defined by  <strong>docking_max_dist_error_from_end_point</strong> or  <strong>docking_max_target_angle</strong>.</p>
<p>When AGV is within <strong>docking_approach_dist</strong> from the target and either the target is not found, is lost or the heading or distance of the calculated docking position compared to the original drive end position would exceed the limits defined by  <strong>docking_approach_max_h_err</strong> or <strong>docking_approach_max_dist_err</strong>.</p>
<p>This warning always pauses the docking but if the issue causing it is resolved, the docking continues.</p>
<p>By default the docking can be paused indefinitely with only the warning being visible. To set an error to notify the operator for the need of manual intervention see <strong>docking_approach_warning_to_error_timeout_s</strong>.</p>
<p><strong>How to recover:</strong><br />
Check the reason for the warning from the log, adjust the target location or parameters accordingly and try again.</p>
<h4 id="612-warning_target_not_detected"><a class="header" href="#612-warning_target_not_detected">612 WARNING_TARGET_NOT_DETECTED</a></h4>
<p>This warning is set if the target is lost when the AGV is within <strong>docking_max_start_distance</strong> from the target.
If the target is detected again, the warning disappears and the docking process continues.</p>
<p><strong>How to recover:</strong><br />
Check that the correct target is placed into a correct location and that the target detection parameters are calibrated correctly.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="driving-options"><a class="header" href="#driving-options">Driving Options</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-27"><a class="header" href="#overview-27">Overview</a></h2>
<p>The purpose of this document is to give reader an overview of the different alternatives that exist for driving the AGV. There is a vast variety of different tools and interfaces from which the vehicle can be commanded to drive. This is to ensure that there are enough options to cover the needs of different productions, and to provide effective tools for calibration and testing. To achieve smooth and accurate driving, there are also some tips on how to affect the driving performance.</p>
<h2 id="driving-manually"><a class="header" href="#driving-manually">Driving manually</a></h2>
<p>Manual driving refers to the cases where the reference values given to the AGV are coming from a manual source rather than from a predefined trajectory. It is needed for different purposes, e.g., teaching the environment, initial calibrations and driving vehicle out of production for maintenance. Navitrol provides a few different ways to handle this.</p>
<h3 id="web-interface"><a class="header" href="#web-interface">Web interface</a></h3>
<p>Web interface gives a joystick-like control for manual driving. The user can type the IP address of the ethernet port in IPC to a browser e.g., in mobile phone and open the user interface. See more information of the Web interface in its own document.</p>
<p><em>Navitrol - WebInterface Instructions</em></p>
<h3 id="keyboard-control"><a class="header" href="#keyboard-control">Keyboard control</a></h3>
<p>Keyboard control can be used in Navitrol Monitor. It can be enabled from the <em>Navitrol</em> selection (See Figure 1) or by holding Shift-key whereafter the arrow keys are used to set the reference values. In some situations, this may not offer enough degree of freedom to accurately perform a certain driving sequence. Thus, keyboard control is usually used only for initial calibration and testing. For more information, see the document <em>Navitrol Monitor - User Instructions</em>.</p>
<p><img src="DriveControl/DrivingOptions/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 1: Keyboard control</p>
</blockquote>
<h3 id="ethernet-interface"><a class="header" href="#ethernet-interface">Ethernet Interface</a></h3>
<p>The ethernet interface gives customers the freedom to use their owndevice to control the vehicle manually through Navitrol. There are two <em>Supervisor status</em> message sections that are offered: <em>Remote control section</em> and <em>Manual section</em>. The definition for these can be found in the <em>Ethernet Communication specification between Navitrol and AGV
supervisor</em> document.</p>
<p>The remote-control section allows user to have the same joystick-like control as the previously mentioned Web interface and relies on the same parameters.</p>
<p>Manual section gives a keyboard-like control, so driving forward, backward, turning left and turning right. The speed can be set in the message itself while the turning rate is defined using parameters:</p>
<p><strong>F,veh_inte_manual_ang_vel</strong> 0.785 # turning rate in radians per second
<strong>F,max_turn_rate_deg_p_s</strong> 30.00 # maximum limit for turning rate (deg/s)</p>
<h2 id="driving-automatically"><a class="header" href="#driving-automatically">Driving automatically</a></h2>
<p>In automatic driving mode, the vehicle follows a virtual route to a target location and a map must be defined for the AGV to be able to localize itself. There are multiple sources that can initiate the driving, but this document mainly concentrates on the Navitrol Monitor software which is the main tool when taking new vehicles into use.</p>
<h3 id="overview-of-driving-commands"><a class="header" href="#overview-of-driving-commands">Overview of driving commands</a></h3>
<p>As mentioned before, there are many ways to command vehicle to start automatic driving. Table 1 briefly describes all the current drive command options.</p>
<p>Table 1: Different types of drive commands</p>
<table><thead><tr><th>Navitrol Monitor</th><th>Description</th></tr></thead><tbody>
<tr><td>Route driver</td><td>Click the target symbolic point or use Hold-Release functionality. The vehicle plans the route automatically.</td></tr>
<tr><td>Production Simulation</td><td>Select a driving path on the route or add multiple targets and do production demos.</td></tr>
<tr><td>Custom route</td><td>Give a custom route to the vehicle.</td></tr>
<tr><td>Return to route</td><td>Drive the vehicle to a route close by automatically.</td></tr>
<tr><td><strong>Navithor fleet control</strong></td><td></td></tr>
<tr><td>GotoXY</td><td>Click on a target on the route or at a symbolic point using Navithor Client.</td></tr>
<tr><td>Resource-based triggering</td><td>Resource added to a symbolic point triggers a drive order for one of the enabled vehicles.</td></tr>
<tr><td>Transfer request</td><td>Pickup location, target location and resource type are sent to Navithor</td></tr>
<tr><td>Hold, Release</td><td>Vehicle is released from current location where it is in Hold to the next desired target location by a timer or external input.</td></tr>
<tr><td>Production order lists</td><td>Similar to Hold-Release but the destinations the vehicle drives are given in one or several lists</td></tr>
<tr><td><strong>Standalone / (fleet control)</strong></td><td></td></tr>
<tr><td>Supervisor -- Go to destination</td><td>External system on vehicle gives drive command to a symbolic point.</td></tr>
<tr><td>Supervisor -- Hold, Release</td><td>External system releases vehicle from a symbolic point where it is in Hold to another symbolic point.</td></tr>
<tr><td>Supervisor -- Start new drive / Extend drive</td><td>External system on vehicle sends trajectories for the vehicle to drive.</td></tr>
<tr><td>Supervisor -- Return to route</td><td>Drive vehicle to a route close by automatically.</td></tr>
<tr><td>Supervisor -- Drive order from segments</td><td>External system gives drive orders in segments parsed from the segment file created with Navithor Tools.</td></tr>
<tr><td>Touch screen -- Hold, Release</td><td>The user releases the vehicle from a symbolic point where it is in Hold to another location using Navitec's Touch screen solution.</td></tr>
</tbody></table>
<h3 id="different-driving-motions"><a class="header" href="#different-driving-motions">Different driving motions</a></h3>
<p>By default, the vehicle follows the route with one continuous motion so that the heading of the vehicle follows the tangent of the route. This section provides a few alternatives for increased flexibility of the AGV motion.</p>
<h3 id="pivot-point"><a class="header" href="#pivot-point">Pivot point</a></h3>
<p>Most of the AGVs can rotate around their navigation point which often is useful in compact spaces. In Navitec's products, these are called as pivot points and they can be added when defining the routes for the project in Navithor Tools. The vehicle will slow down before it stops at a pivot point, to then start rotating around its axis to the heading of the subsequent route.</p>
<p><img src="DriveControl/DrivingOptions/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 2: Driving through a pivot point</p>
</blockquote>
<h4 id="wheel-turning-point"><a class="header" href="#wheel-turning-point">Wheel turning point</a></h4>
<p>Wheel turning points are special pivot points that are available for omnidirectional AGVs. The difference between a pivot point and a wheel turning point is that the AGV frame can't turn on a wheel turning point. The AGV stops on a wheel turning point. Turns the wheels to the driving direction and continues the when the wheels point to the correct direction.</p>
<h3 id="direction-change"><a class="header" href="#direction-change">Direction change</a></h3>
<p>A direction change means that the sign of velocity in the route changes.
A simple example is that vehicle drives first in forward direction, stops at the direction change point and then continues driving in reverse (see Figure 3). In similarity to pivot points, the vehicle will slow down before the direction change to stop more accurately. A short stop during the direction change is defined by the parameter
pc_direction_change_wait_ms with the purpose to let the motor controllers stabilize before changing the direction. Vehicles which have steered wheels will also wait for the wheels to reach an acceptable angle before giving a speed reference.</p>
<p><img src="DriveControl/DrivingOptions/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 3: Direction change motion</p>
</blockquote>
<h3 id="omni-driving"><a class="header" href="#omni-driving">Omni driving</a></h3>
<p>For vehicles with omni directional capabilities, where the frame heading is not tangent to the direction of motion, additional options are available. Route sections can be defined to be driven with a certain frame heading with respect to the map coordinates. For example, in Figure 4 the vehicle drives in and out of pivot point maintaining the
same orientation during the whole motion. Only the wheels of the vehicle are steered 90 degrees on the pivot point to move the vehicle accordingly.</p>
<p><img src="DriveControl/DrivingOptions/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 4: Omni driving in a pivot point. Vehicle maintains its orientation.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="standalone-feature"><a class="header" href="#standalone-feature">Standalone Feature</a></h1>
<p>Updated 13.09.2024</p>
<hr />
<h2 id="introduction-35"><a class="header" href="#introduction-35">Introduction</a></h2>
<p>The standalone Navitrol, as the name suggests, means that Navitrol works independently of any fleet controller that would otherwise keep track of the AGV and get the production tasks done. In this case Navitrol is still dependant on an external source to provide it with the commands and directions to perform the tasks.
Navitrol provides many of the features that are available if used with Navithor, the Navitec's fleet control software, but not all.
The standalone version of Navitrol is feasible for the case where the user wants to have full control over the tasks performed by the AGV and wants to command the AGV at every step of the production using the AGV's onboard PLC. Navitrol calculates the routes to target destination itself in standalone mode whereas when connected with the fleet controller, the route segments are specified by the fleet controller.
This gives Navitrol the capability to drive to any specified location independently.</p>
<p>Standalone Navitrol is also suitable for use in the cases where there is no need to a coordinating fleet controller. Such cases are not limited to but include the assembly line or single AGV production scenarios.</p>
<h3 id="licenses-required"><a class="header" href="#licenses-required">Licenses required</a></h3>
<p>The IPC that hosts and runs Navitrol should have the correct licenses so that the AGV can drive. The licenses required are Route driver license along with the license for any additional feature that is needed and is enabled only if a valid license is available.</p>
<h3 id="basic-requirements-for-standalone-navitrol"><a class="header" href="#basic-requirements-for-standalone-navitrol">Basic requirements for standalone Navitrol</a></h3>
<p>The basic requirement is that Navitrol can receive the commands for driving the AGV i.e. the drive orders. The external drive orders can be recieved via ethernet interface connected to a supervisor which, in most cases, is a PLC. The supervisor interface specifies the message formats and the protocol specifications. The messages that can be used to drive the AGV are given in section 1.2.2.</p>
<h3 id="route-driver"><a class="header" href="#route-driver">Route Driver</a></h3>
<p>The Navitrol route driver must be enabled in the Navitrol parameter file by setting the following parameter</p>
<p>I,route_driver_enabled, 1 # 1 to enable route driver; min 0, max 1</p>
<p>Since the fleet control will not be used in the case of standalone Navitrol, it is better to set fleet_control_enabled as 0 to disable the fleet control in standalone mode.</p>
<h2 id="messages-to-drive-the-agv"><a class="header" href="#messages-to-drive-the-agv">Messages to drive the AGV</a></h2>
<p>Navitrol will need to be commanded to perform the driving tasks using, for example, the following non-exhaustive list of supervisor messages:</p>
<h3 id="message-id-1001---initialize-position"><a class="header" href="#message-id-1001---initialize-position">Message ID 1001 - Initialize position</a></h3>
<p>Used to initialize position at a certain location.</p>
<h3 id="message-id-1002---initialize-position-at-symbolic-point"><a class="header" href="#message-id-1002---initialize-position-at-symbolic-point">Message ID 1002 - Initialize position at symbolic point</a></h3>
<p>Used to initialize the position at a certain symbolic point.</p>
<h3 id="message-id-3001---release-hold"><a class="header" href="#message-id-3001---release-hold">Message ID 3001 - Release Hold</a></h3>
<p>When Navitrol drives the AGV to a certain symbolic point then it goes to hold state.
It can then be released from the hold state using the 'release hold' message which triggers the AGV to drive to the selected destination.</p>
<h3 id="message-id-3004---release-hold-to-custom-destination"><a class="header" href="#message-id-3004---release-hold-to-custom-destination">Message ID 3004 - Release hold to custom destination</a></h3>
<p>In the case that the AGV is to be driven to a certain destination and is in hold state then it can be released using this message where the next destination is specified.
This message is then acknowledged by Navitrol using message ID 3104.</p>
<h3 id="message-id-3005---go-to-destination"><a class="header" href="#message-id-3005---go-to-destination">Message ID 3005 - Go to destination</a></h3>
<p>When the AGV is to be driven to any of the defined symbolic points then this message can be sent to Navitrol by the supervisor.
This message always specifies the ID of the symbolic point to be driven to.</p>
<h3 id="message-id-3006---pause-drive"><a class="header" href="#message-id-3006---pause-drive">Message ID 3006 - Pause drive</a></h3>
<p>Used to pause the current drive order being executed by Navitrol.</p>
<h3 id="message-id-3007---resume-drive"><a class="header" href="#message-id-3007---resume-drive">Message ID 3007 - Resume drive</a></h3>
<p>Navitrol resumes a previously paused drive when this message is received.</p>
<h3 id="message-id-3008---abort-drive"><a class="header" href="#message-id-3008---abort-drive">Message ID 3008 - Abort drive</a></h3>
<p>The current drive being executed will be aborted upon reception of this message.</p>
<p>Please see the document titled 'Ethernet Communication specification between Navitrol and AGV supervisor' for the details regarding the above messages.
The above list of messages is not exhaustive.</p>
<h3 id="message-id-3102-section-2---hold-section"><a class="header" href="#message-id-3102-section-2---hold-section">Message ID 3102, Section 2 - Hold section</a></h3>
<p>Tells whether AGV is in Hold and the defined possible destinations to release the AGV.</p>
<h2 id="destination-update"><a class="header" href="#destination-update">Destination update</a></h2>
<p>By default drive commands from supervisor (e.g. Go to destination - 3005) are accepted only when AGV is in STANDBY state. With the destination update feature it is also possible to update drive destination during AUTO driving. Destination update feature can be enabled by setting following parameter:</p>
<p>I, route_driver_dest_update_enabled, 1 # Enables option of updating destination during drive</p>
<p>When destination update is enabled, drive commands during driving will be processed as destination update commands. Route driver will plan for a new route to updated destination. New route is accepted only if it can be continued from AGV's position and driving direction. If appropriate route is not found, drive command will be rejected and AGV will stop driving.</p>
<p>Driving distance of AGV during route planning for destination update can be limited using parameter:</p>
<p>F, route_driver_dest_update_stop_dist, 0.0 # Maximum distance [m] to drive when planning route for destination update during drive. No stopping if zero.</p>
<h2 id="hold-release-production-in-standalone-mode"><a class="header" href="#hold-release-production-in-standalone-mode">Hold-release production in standalone mode</a></h2>
<p>Hold-release feature offers easy configuration for simple production logic like assembly lines. AGV drives from one symbolic point to another and it is held until released to next given location. Please note that hold-release is different feature than <a href="DriveControl/Standalone/../StopAndHold/StopAndHold-en.html">stop-and-hold</a> where AGV stops and waits for a release to continue the drive.</p>
<p>The routes and symbolic points have to be defined in the Navithor Tools project for Navitrol's standalone production.
Then, the AGV can be commanded via the <a href="DriveControl/Standalone/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">supervisor interface</a> or via the Navitrol Monitor's 'Standalone' form opened with the 'Drive Orders' button to drive to a specific symbolic point.</p>
<p>As the AGV arrives at the symbolic point, Navitrol goes into 'Hold' state and can be released using one of the messages which will trigger the AGV to drive to the selected destination. When the release is requested using message ID 3001, then Navitrol will release the AGV and command it to drive to the default symbolic point or to one of the three alternatives, possible to define in Navithor Tools. This is also shown in the figure below.</p>
<p><img src="DriveControl/Standalone/./media-en/hold-rules.png" alt="" /></p>
<p>The highlighted symbolic point at the right end of the example route is of type Stop and is named 'Body and assembly' for this example. On the pane onto the left of the figure, the characteristics of the selected symbolic point are shown.
The first checkbox is checked to enable the hold state at the symbolic point. The release timer can be set by checking the 'Release after' checkbox and then setting a value for the release timer. This value is in seconds.
Then comes the default destination followed by the three optional or alternate destinations that can be set for any symbolic point.</p>
<p>The message ID 3004 also offers the possibility to define a specific symbolic point ID to drive to irrespective of what has been defined in the Navithor Tools.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stop-and-hold"><a class="header" href="#stop-and-hold">Stop-and-hold</a></h1>
<p>Updated 26.01.2024</p>
<h2 id="overview-28"><a class="header" href="#overview-28">Overview</a></h2>
<h3 id="introduction-36"><a class="header" href="#introduction-36">Introduction</a></h3>
<p>Stop-and-hold is a feature for stopping the AGV to a defined location to wait for a trigger to advance on the same drive order.
There could be for example a gate in front of a pick-up location and the AGV must wait behind the gate until the path is free, after which it is triggered to advance the drive.</p>
<p>Please note that this is a different feature than hold-release production logic where the AGV goes to 'Hold' state when entering a symbolic point and can be released to drive to some other symbolic point. More information on hold-release can be found in <a href="DriveControl/StopAndHold/../Standalone/Standalone-en.html">Standalone</a> document.</p>
<h3 id="requirements-17"><a class="header" href="#requirements-17">Requirements</a></h3>
<p><strong>Project settings:</strong></p>
<ul>
<li>Symbolic point with StopAndHold type</li>
</ul>
<hr />
<h2 id="set-up-6"><a class="header" href="#set-up-6">Set up</a></h2>
<h3 id="quick-start-10"><a class="header" href="#quick-start-10">Quick start</a></h3>
<ol>
<li>Define a symbolic point that is of StopAndHold type somewhere on the route that the AGV will drive over.</li>
<li>Set <strong>I, stop_and_hold_mode, 0</strong> (triggered with timer) and <strong>I, stop_and_hold_moving_delay_msec, 3000</strong></li>
<li>Give drive order for the AGV so that the end location is somewhere ahead of the StopAndHold location.</li>
<li>AGV should stop close to the StopAndHold point, wait for 3 seconds and move on to the end location.</li>
</ol>
<p><img src="DriveControl/StopAndHold/./media-en/stop_and_hold.PNG" alt="" /></p>
<blockquote>
<p>Example setting</p>
</blockquote>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>stop_and_hold_mode</td><td>Int</td><td>&gt;= 0</td><td>-1 = ignore all, <br /> 0 = release AGV from StopAndHold point with timer, <br /> 1 = release signal from supervisor message 3002 section 1, <br /> 2 = release signal from fleet control, <br /> 3 = release signal from supervisor message 3011</td></tr>
</tbody></table>
<p><strong>Related parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>stop_and_hold_moving_delay_msec</td><td>Int</td><td>2000</td><td>Delay time in msecs before AGV continues driving from StopAndHold symbolic point</td></tr>
<tr><td>stop_and_hold_stop_distance_offset</td><td>Int</td><td>0.0</td><td>Stopping distance offset from stop-and-hold point (to positive if AGV stops too early)</td></tr>
</tbody></table>
<h2 id="how-to-use-16"><a class="header" href="#how-to-use-16">How to use</a></h2>
<p>AGV will stop close to StopAndHold symbolic point when it has a drive order which passes the StopAndHold point. The stop point can be fine-tuned with the <strong>stop_and_hold_stop_distance_offset</strong> parameter. At StopAndHold point, AGV will wait in 'AUTO' state for a release signal to continue the drive. While AGV is stopped, warning WARNING_SLOWED_DOWN_AUTO_MOVE_DELAY will be shown.</p>
<h3 id="release-signals-to-continue-the-drive"><a class="header" href="#release-signals-to-continue-the-drive">Release signals to continue the drive</a></h3>
<ul>
<li><strong>Timer</strong>: Set <strong>stop_and_hold_mode, 0</strong> and adjust the waiting time with <strong>stop_and_hold_moving_delay_msec</strong></li>
<li><a href="DriveControl/StopAndHold/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Supervisor interface</a>: There are two different messages that can be used to give release signal. Supervisor message 3002 section 1 or supervisor message 3011 (preferred). Choose with <strong>stop_and_hold_mode</strong> which one to use. Information whether AGV is held at StopAndHold can be read in status message 3102 section 5.</li>
<li><strong>Navithor</strong>: Release signal can be given using MES interface ReleaseStopAndHold (ID=362) or using HTTP API (URL: /api/ReleaseStopAndHold). It's also possible to use button in Navithor Client for releasing the AGV. Set <strong>stop_and_hold_mode, 2</strong> </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vda5050-interface"><a class="header" href="#vda5050-interface">VDA5050 interface</a></h1>
<p>Updated 26.08.2024</p>
<hr />
<h2 id="overview-29"><a class="header" href="#overview-29">Overview</a></h2>
<p>The VDA5050 interface allows the interoperability of different fleet control systems with the AGV control software.
The protocol is based on JSON data serialization format that is sent over MQTT broker. The AGV publishes status, connection and visualization topics and listens to order and instantActions topics.
The topics have the following format</p>
<blockquote>
<p>uagv/ProtocolVersion/Manufacturer/SerialNumber/topic
eg.
uagv/v1/Navitec/0001/connection</p>
</blockquote>
<p>The AGV control software implements several versions of the VDA5050 protocol for interoperability with different fleetcontrol systems. Only one of these dialects is active at a time. </p>
<p>Unfortunately, the documentation for VDA5050 protocol version 1.012 is no longer available online. The protocol version 2.0 is available at https://github.com/VDA5050/VDA5050/releases/tag/2.0.0 and version 1.1 at https://github.com/VDA5050/VDA5050/blob/1.1.0/VDA5050_EN.md</p>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<ul>
<li>The VDA5050 interface requires separate license option.</li>
<li>The interface has to be enabled in the parameters</li>
</ul>
<h2 id="parameters-5"><a class="header" href="#parameters-5">Parameters</a></h2>
<table><thead><tr><th>Parameter name</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>vdma_version</td><td>2</td><td>VDMA version - 0 = v1.01.2, 1 = v1.1, 2 = v.2.0.</td></tr>
<tr><td>vdma_drive_order_type</td><td>2</td><td>VDMA dialect - 0 = JSON mapped segment (v.1.01.2), 1 = Segment based dialect (v1.1 and v2.0), 2 = Trajectory based (v1.1 and v2.0).</td></tr>
<tr><td>vdma_host</td><td>127.0.0.1</td><td>Hostname or IP of the MQTT broker the VDMA interface should connect to</td></tr>
<tr><td>vdma_port</td><td>1883</td><td>The port the MQTT broker for VDMA interface is on</td></tr>
<tr><td>vdma_manufacturer</td><td>Navitec</td><td>The name of the AGV manufacturer for the VDMA interface</td></tr>
<tr><td>vdma_serial_number</td><td>0001</td><td>The serial number of the AGV for the VDMA interface</td></tr>
<tr><td>vdma_visualization_interval_ms</td><td>1000</td><td>The update interval [ms] for the visualization topic. 0 to disable</td></tr>
<tr><td>vdma_mqtt_password</td><td></td><td>Password for connecting to the MQTT broker</td></tr>
<tr><td>vdma_mqtt_user</td><td></td><td>Username for connecting to the MQTT broker</td></tr>
<tr><td>vdma_area_name_override</td><td></td><td>Override the area name from map, in case the fleet control uses different name</td></tr>
<tr><td>vdma_interface_name</td><td>uagv</td><td>The interface name part of the MQTT topics</td></tr>
<tr><td>vdma_topic_override_version</td><td>0</td><td>Override the version number part of the MQTT topic name. 0 to use default (no override)</td></tr>
<tr><td>log_dump_vdma_max_files</td><td>20</td><td>Maximum number of log files triggered by VDMA to keep on disk.</td></tr>
<tr><td>fleet_control_type</td><td>0</td><td>0 - No fleet control, 1 - Our own fleet control, 2 - External fleet control, 3 - VD(M)A fleet control</td></tr>
<tr><td>vdma_default_drive_speed_m_p_s</td><td>2.0</td><td>In trajectory drive mode, the default drive speed if no drive speed is given</td></tr>
<tr><td>vdma_traj_min_radius_m</td><td>0.5</td><td>The turning radius used in the trajectory interpolation (trajectory mode only)</td></tr>
<tr><td>vdma_traj_pt_dist_m</td><td>0.1</td><td>How dense the trajectory interpolation is before the spline smoothing is applied</td></tr>
<tr><td>vdma_traj_interpolation_type</td><td>2</td><td>0 disables the trajectory interpolation (only spline smoothing), 1 uses the Dubins curves, 2 - Linear interpolation (default)</td></tr>
<tr><td>log_vdma_extra</td><td>0</td><td>1 enables extra logging for debug purposes</td></tr>
<tr><td>vdma_debug_topic_enabled</td><td>0</td><td>1 publishes extra debug information on the MQTT broker (about the interpolated trajectory)</td></tr>
<tr><td>vdma_actions_check_sp</td><td>1</td><td>Require compatible symbol point on the map to perform certain actions (eg. loading) 1 yes, 0 no</td></tr>
<tr><td>vdma_actions_sp_close_dist</td><td>0.3</td><td>How close does the symbol point have to be to be accepted (see previous parameter)</td></tr>
<tr><td>vdma_treat_all_loads_as_racks</td><td>0</td><td>In the trajectory mode, forces the VDA to treat all load&amp;unload as racks</td></tr>
<tr><td>vdma_ssl_mode</td><td>1</td><td>0 Disable, 1 use the same parameters as the rest of Navitrol (ssl_enabled, ssl_agv_certificate_file, ssl_agv_key_file, ssl_pem_password, ssl_ca_file, ssl_cipher_list), 2 Enable using separate parameters (vdma_ssl_agv_certificate_file, vdma_ssl_agv_key_file, vdma_ssl_pem_password, vdma_ssl_ca_file, vdma_ssl_cipher_list)</td></tr>
<tr><td>vdma_ssl_agv_certificate_file</td><td></td><td>The name of the certificate file to use to identify the AGV. Empty means none.</td></tr>
<tr><td>vdma_ssl_agv_key_file</td><td></td><td>The keyfile used by the AGV. Only needed if vdma_ssl_agv_certificate_file is set</td></tr>
<tr><td>vdma_ssl_pem_password</td><td></td><td>The password used to unlock the key file</td></tr>
<tr><td>vdma_ssl_ca_file</td><td>./agv_certs/root.crt</td><td>The root certificate file used to verify the server certificate</td></tr>
<tr><td>vdma_ssl_cipher_list</td><td></td><td>The list of allowed ciphers. Empty means use default cipher list</td></tr>
<tr><td>vdma_ssl_version</td><td>2</td><td>Which TLS version to use.   0 = TLS v1, 1 = TLS v1.1 and 2 = TLS v1.2</td></tr>
<tr><td>vdma_ssl_verify_hostname</td><td>1</td><td>Whether the certificate hostname is required to match the actual server hostname. 1 = Yes, 0 = No</td></tr>
<tr><td>vdma_escalate_errors_to_fatal_timeout_s</td><td>0.0</td><td>Navitrol errors are first considered 'warnings' until this time passes and then escalated to 'fatal'</td></tr>
<tr><td>vdma_error_reporting_policy</td><td>0</td><td>0 report only active Navitrol errors, 1 Keep orders that happen during drive order active for longer time</td></tr>
<tr><td>vdma_loadunload_check_load_state</td><td>1</td><td>Should vdma load&amp;unload actions check the AGV load state.</td></tr>
<tr><td>vdma_trivially_reach_multiple_nodes</td><td>1</td><td>Make the VDA5050 interface treat multiple nodes in the beginning of the order as trivially reachable.</td></tr>
<tr><td>vdma_use_symbolic_points_for_actions</td><td>0</td><td>Use virtual symbolic points to implement actions. Currently only used for racking</td></tr>
<tr><td>vdma_pivot_generation_angle_deg</td><td>30.0</td><td>Automatically generate pivots if there are sharper corners in the route than this</td></tr>
<tr><td>vdma_rotation_on_edge_margin_points</td><td>2</td><td>When rotating on an edge, reach the target orientation this many (linear interpolation) points before the end of the edge. Increase if the AGV doesn't reach the target orientation in time.</td></tr>
<tr><td>vdma_reverse_tolerance_deg</td><td>90</td><td>Tolerance for reversing on an edge, in degrees. AGV will reverse when edge has tangential orientation that deviates from PI at most by this margin</td></tr>
<tr><td>vdma_clear_order_when_losing_position</td><td>1</td><td>Make the VDA5050 interface clear the order if position is not initialized.</td></tr>
<tr><td>vdma_escalate_errors_to_fatal_timeout_s</td><td>0.0</td><td>Timeout for escalating errors to fatal. Navitrol errors are initially reported as 'warnings' and changed to 'fatal' after this time. 0 = disabled (immediately fatal).</td></tr>
</tbody></table>
<h2 id="v20-navitec-trajectory-based-dialect"><a class="header" href="#v20-navitec-trajectory-based-dialect">v2.0 Navitec trajectory based dialect</a></h2>
<h3 id="how-to-enable"><a class="header" href="#how-to-enable">How to enable</a></h3>
<p>Set <strong>fleet_control_type</strong> to 3 and <strong>vdma_version</strong> to 2 and <strong>vdma_drive_order_type</strong> to 2. <strong>vdma_host</strong> and <strong>vdma_port</strong> should be configured to the address where the fleet control software (or in some cases separate MQTT broker) is running. Navithor has a built-in MQTT broker. If the broker uses username and password to authenticate, those should be set in <strong>vdma_mqtt_user</strong> and <strong>vdma_mqtt_password</strong>. In this mode the Navitrol doesn't require a route definition file, but will still require an environment model if Navitrol is responsible for localization.</p>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p>This is perhaps the most natural version of VDA5050 for use with third party fleet control systems. The drive is based on node coordinates and optionally edge trajectories and node and edge names don't have to encode any special information.</p>
<h3 id="trajectories-on-edges"><a class="header" href="#trajectories-on-edges">Trajectories on edges</a></h3>
<p>The edge trajectory currently only supports degree 1. It doesn't use any actual NURBS algrithm, but fits a spline to the points internally. The trajectory points can specify orientation as in v1.1 specification, but that may be dropped when the implementation evolves.</p>
<h3 id="rotationallowed-property"><a class="header" href="#rotationallowed-property">rotationAllowed property</a></h3>
<p>The rotation allowed property defaults to 'false' on edges with trajectory (contrary to what the VDA5050 specification says). If you try to specify rotationAllowed property as &quot;true&quot; on an edge with a trajectory, it will cause an error and the drive order will be rejected. We consider the rotationAllowed to be an allowance for the AGV, an option we choose not to exercise in this case. This is because rotating on a curved trajectory would require careful control to make sure the driving is smooth.</p>
<h3 id="pivot-points"><a class="header" href="#pivot-points">Pivot points</a></h3>
<p>To encode a pivot point, use two edges with the &quot;rotationAllowed&quot; property set to false. The AGV will pivot where the edges meet.</p>
<h3 id="direction-changes"><a class="header" href="#direction-changes">Direction changes</a></h3>
<p>The drive direction is determined by the orientation of the previous node or the orientation of the edge. orientationType property can be set to GLOBAL or TANGENTIAL as in v2.0 specification.
When the orientation is opposite to route orientation, the AGV will reverse. For the direction change to work, there should be a sharp corner in the route. </p>
<h3 id="route-interpolation"><a class="header" href="#route-interpolation">Route interpolation</a></h3>
<p>Navitrol will attempt to interpolate between node coordinates if the nodes are far apart. The interpolation is similar to Dubins curve: it contains only circle arcs and straight lines. These are further softened a little bit before driving.</p>
<h3 id="actuator-control-2"><a class="header" href="#actuator-control-2">Actuator control</a></h3>
<p>If the AGV has reference controlled actuator, for example a fork lift, the reference base height comes from parameter <strong>actuator_home_val_mm</strong> (default 0 mm). The actuator has also minimum and maximum height (<strong>actuator_min_val</strong> &amp;&amp; <strong>actuator_max_val</strong>) defined. A load aboard offset (<strong>actuator_load_aboard_offset_mm</strong>) is added on top of the base height when the AGV is carrying a load.</p>
<p>There are custom actuator actions supported for the trajectory based dialect called &quot;setActuator&quot; and &quot;releaseActuator&quot;. The &quot;setActuator&quot; action can be used to set for example a fork lift height according to a shelf height in a node before the pick/drop node so that the AGV has the fork's at correct height before driving to the shelf location. When the AGV has driven away from the shelf location, another node with &quot;releaseActuator&quot; action can be set to control the forks back to the normal base height i.e. home position.</p>
<p>Additionally <em>pick</em> and <em>setActuator</em> actions can override the <strong>actuator_load_aboard_offset_mm</strong>, the parameter that determines the difference between the actuator reference height when the AGV is carrying a load and when it is not. This is useful when the AGV is picking up a load that needs to be carried at a different height than the default load aboard offset. Both actions can override this parameter by setting a value for the &quot;loadAboardOffset&quot; parameter. This parameter is valid until the next <em>drop</em> actions. When AGV executes a <em>drop</em> action, the load aboard offset is set back to the default value (i.e., <strong>actuator_load_aboard_offset_mm</strong>). This feature is implemented in version 6.56.</p>
<p><em>Important: Navitrol stores actuator reference height for safety, if Navitrol is restarted between the &quot;setActuator&quot; and &quot;releaseActuator&quot; actions. To reset actuator to home position send order with &quot;releaseActuator&quot; action. Alternatively, release the height by moving the actuator manually using Navitec's UI tools (e.g., Actuator control form in Navitrol Monitor). Always drive AGV out from the rack manually before releasing the actuator!</em></p>
<table><thead><tr><th>Action</th><th>Implemented (Navitrol version)</th><th>Custom</th><th>Notes</th></tr></thead><tbody>
<tr><td>pick</td><td>Yes (6.38)</td><td>No</td><td></td></tr>
<tr><td>drop</td><td>Yes (6.38)</td><td>No</td><td></td></tr>
<tr><td>setActuator</td><td>Yes (6.52)</td><td>Yes</td><td>Set actuator base height at node and keep until released. <br> Parameter: &quot;height&quot; [m]</td></tr>
<tr><td>releaseActuator</td><td>Yes (6.52)</td><td>Yes</td><td>Release actuator height that was set with &quot;setActuator&quot; action. No parameters.</td></tr>
</tbody></table>
<h3 id="pallet-detection-and-docking"><a class="header" href="#pallet-detection-and-docking">Pallet detection and docking</a></h3>
<p>Navitrol supports docking to a pallet using action &quot;detectObject&quot; on an edge. Enable docking from parameters <strong>docking_to_target_enabled &gt; 0</strong>. The node following the edge should be the assumed pick-up location. Set the &quot;allowedDeviationXY&quot; for the node to be large enough as the actual pick-up position will vary based on the position of the pallet. The optional &quot;objectType&quot; parameter can be left out from the message or set to a string &quot;PALLET&quot;. Parameters for the pallet detection and docking should be adjusted. Read <a href="DriveControl/VDA5050/../../TargetAndObstacleDetection/PalletDetection/PalletDetection-en.html">Pallet detection</a> document to get more information.</p>
<p>There is also optional parameter called &quot;duration&quot; [s] which is a timeout for the action. If the docking has not finished in the specified time, the action will fail. By default there is no timeout for the action. The action will fail if the drive is interrupted on the edge (e.g., error is raised or docking fails for some reason). To reach the next node, it is required that the action finishes succesfully. In case of failure, cancel the current order before giving a new order.</p>
<table><thead><tr><th>Action</th><th>Navitrol version</th><th>Custom</th><th>Notes</th></tr></thead><tbody>
<tr><td>detectObject</td><td>6.54</td><td>No</td><td>Edge action used for docking to a pallet. <br> action parameters:<br> &quot;objectType&quot; (string, optional) <br> &quot;duration&quot; (Integer, optional) [s]</td></tr>
</tbody></table>
<h3 id="buffer-lanes-1"><a class="header" href="#buffer-lanes-1">Buffer lanes</a></h3>
<p><a href="DriveControl/VDA5050/../../LoadHandling/BufferLanes/BufferLanes-en.html">Buffer lane</a> is feature that allows to pickup or drop-off loads that are in a queue. To activate the feature, the order must be given to a node with either pick or drop action that has stationType &quot;buffer&quot;, and the edge leading to the node must have action &quot;detectObject&quot;. The loads are placed in a straight queue on the edge leading to the node.</p>
<p>The length of the buffer lane is determined by the allowed deviation object &quot;allowedDeviationXY&quot; of the node, and the loads should be placed within this length. Navitrol validates that the length is given and reports error with errorType &quot;invalidAction&quot; if it is not. The edge leading to the node should be long enough so that the AGV has time and space to detect the first load on the edge and possibly to dock to it.</p>
<p>There are required parameters that need to be set to use the buffer lane feature itself. Read <a href="DriveControl/VDA5050/../../LoadHandling/BufferLanes/BufferLanes-en.html">Buffer lane</a> document for more information. Specifically for VDA-5050, parameter <strong>unload_buffer_error_when_lane_full</strong> is recommended to be set to 1. This is to detect a failed state when the drop buffer lane is already full of loads.</p>
<table><thead><tr><th>Action</th><th>Navitrol version</th><th>Custom</th><th>Notes</th></tr></thead><tbody>
<tr><td>detectObject (edge) <br> <strong>And</strong> <br> pick / drop (node)</td><td>6.54</td><td>No</td><td>Buffer lane actions are started on an edge with &quot;detectObject&quot; action that leads to a node with pick/drop action having stationType &quot;buffer&quot;.</td></tr>
</tbody></table>
<h3 id="block-stacking"><a class="header" href="#block-stacking">Block stacking</a></h3>
<p>With block stacking feature the pallets can be either <a href="DriveControl/VDA5050/../../LoadHandling/StackLoading/StackLoading-en.html">picked from a stack</a> or <a href="DriveControl/VDA5050/../../LoadHandling/BlockStacking/BlockStacking-en.html">dropped to a stack</a>. Dropping to the stack always requires also a buffer lane but picking from a stack can be performed without one from a single stack. To enable these features, configure the related parameters with the help of the documentation.</p>
<p>The feature can be activated with an order to a node with pick or drop action that has stationType &quot;stack&quot;, and the edge leading to the node must have action &quot;detectObject&quot;. To incorporate the block stacking with <a href="DriveControl/VDA5050/VDA5050-en.html#buffer-lanes">buffer lane</a>, the stationType should have value &quot;buffer stack&quot;.</p>
<p>The action is required to finish on the edge before the node is reached and pick/drop action can be performed. In case the action fails due to any interrupt while doing the block stacking sequence, the order should be cancelled and then new order must be given.</p>
<table><thead><tr><th>Action</th><th>Navitrol version</th><th>Custom</th><th>Notes</th></tr></thead><tbody>
<tr><td>detectObject (edge) <br> <strong>And</strong> <br> pick / drop (node)</td><td>6.56</td><td>No</td><td>Block stacking actions are started on an edge with &quot;detectObject&quot; action that leads to a node with pick/drop action having stationType &quot;buffer stack&quot; or &quot;stack&quot; (latter only for pick action).</td></tr>
</tbody></table>
<h3 id="factsheet-topic"><a class="header" href="#factsheet-topic">Factsheet topic</a></h3>
<p>Navitrol supports sending a <strong>factsheet</strong> topic to the fleet control, as specified in VDA5050 2.0. The data that is sent is currently a fixed base document describing the implementation, but manufacturer specific values can be set in vda_factsheet.json file. This file should be placed in the folder containing the Navitrol executable. The file must contain a JSON object that gets recursively merged with the base values: if a key is present in the object its value will override the value in the base factsheet unless the value is an object in which case it will get merged with the object in the base factsheet using this same recursive strategy. The base factsheet describes the trajectory based VDA5050 dialect, so the sending is automatically disabled if another dialect has been picked. <strong>Be careful when editing the factsheet as the values are not checked for standard conformance before sending them to the fleet control.</strong> See VDA5050 standard documentation for the structure of factsheet and the possible values.</p>
<p>An example of a vda_factsheet.json that overrides the seriesName property</p>
<pre><code class="language-json">{
    &quot;typeSpecification&quot;: {
        &quot;seriesName&quot;: &quot;Exampe of an override value&quot;
    }
}
</code></pre>
<h2 id="navitec-trajectory-based-dialect"><a class="header" href="#navitec-trajectory-based-dialect">Navitec trajectory based dialect</a></h2>
<h3 id="how-to-enable-1"><a class="header" href="#how-to-enable-1">How to enable</a></h3>
<p>Set <strong>fleet_control_type</strong> to 3 and <strong>vdma_version</strong> to 1 and <strong>vdma_drive_order_type</strong> to 2.  Otherwise the configuration is the same as for the <strong>v2.0 Navitec trajectory based dialect</strong></p>
<h2 id="description-1"><a class="header" href="#description-1">Description</a></h2>
<p>This is very similar to <strong>v2.0 Navitec trajectory based dialect</strong> except that it sends v1.1.0 as the version number. When receiving v1.1 orders, there are couple of small differences, such as the default value for rotationAllowed property and the coordiate system in which the route orientations are given. Please refer to the protocol specification for details if needed.</p>
<h2 id="navitec-segment-id-based-dialect"><a class="header" href="#navitec-segment-id-based-dialect">Navitec segment ID based dialect</a></h2>
<h3 id="how-to-enable-2"><a class="header" href="#how-to-enable-2">How to enable</a></h3>
<p>Set <strong>fleet_control_type</strong> to 3 and <strong>vdma_version</strong> to 1 or 2 and <strong>vdma_drive_order_type</strong> to 1. <strong>vdma_host</strong> and <strong>vdma_port</strong> should be configured to the address where the fleet control software (or in some cases separate MQTT broker) is running. Navithor has a built-in MQTT broker. If the broker uses username and password to authenticate, those should be set in <strong>vdma_mqtt_user</strong> and <strong>vdma_mqtt_password</strong>.</p>
<h3 id="description-2"><a class="header" href="#description-2">Description</a></h3>
<p>This is the first VDA5050 implementation that is interoperable with the Navithor fleet control. The Navitec segment ID based dialect is based on VDA5050 version 1.1. It uses the edge IDs to send the route segments that form the drive order. There are some custom extensions to the protocol that allow things like sending an fstop (which immediately stops the machine) and handling environment and segment files.</p>
<h3 id="edge-and-node-names"><a class="header" href="#edge-and-node-names">Edge and node names</a></h3>
<p>Navitrol doesn't depend on node names in this mode. Edge names should be either just segment IDs or, if there is an internal node in the middle of a segment, segment id followed by colon followed by a number, eg. &quot;2:2&quot;</p>
<h3 id="map-sharing"><a class="header" href="#map-sharing">Map sharing</a></h3>
<p>The VDA5050 interface doesn’t at the moment specify how the maps should be shared between fleet control and AGV control software. Navitrol has its own map format for the environment, which is a binary file. The routes are stored in a proprietary XML-based format.
Navitrol implements two custom actions in the instantActions topic for the map sharing:</p>
<ol>
<li>getFileVersions is used to query the environment and route file versions. It takes no parameters and returns a string of the form “actionVersion|environmentName|environmentVersion|segmentFileVersion|segmentFileMD5”
<ul>
<li>actionVersion is 1 for this implementation</li>
<li>environmentName is the first 25 characters of area name, with any possible pipe characters replaced by an underscore; or empty string if no environment file is loaded</li>
<li>environmentVersion is the version of the environment file; or 0 if no environment file is loaded</li>
<li>segmentFileVersion is the version of the segment file; or 0 if no segment file exists</li>
<li>segmentFileMD5 is an md5 hash of the segment file as 32 hexadecimal numbers. All of these are 0 if no segment file is loaded.</li>
</ul>
</li>
<li>The fleet control then decides if it should send new files. Currently these files are sent with SFTP protocol, but it is intended to be replaced in the future. The drawback is that with SFTP the fleet control needs to know the IP of the AGV:s</li>
<li>The fleet control then issues “reloadAreaFiles” action, which causes Navitrol to read new files in. This action takes no parameters.</li>
</ol>
<h3 id="actions"><a class="header" href="#actions">Actions</a></h3>
<table><thead><tr><th>Name</th><th>Implemented (Navitrol version)</th><th>Custom</th><th>Notes</th></tr></thead><tbody>
<tr><td>initPosition</td><td>Yes (6.38)</td><td>No</td><td>MapID is the current floor ID</td></tr>
<tr><td>cancelOrder</td><td>Yes (6.38)</td><td>No</td><td></td></tr>
<tr><td>logRequest</td><td>Yes (6.38)</td><td>No</td><td>Saves the log with different name than other triggers</td></tr>
<tr><td>stateRequest</td><td>Yes (6.38)</td><td>No</td><td></td></tr>
<tr><td>startCharging</td><td>Yes (6.38)</td><td>No</td><td>Not tested</td></tr>
<tr><td>stopCharging</td><td>Yes (6.38)</td><td>No</td><td>Not tested</td></tr>
<tr><td>pick</td><td>Yes (6.38)</td><td>No</td><td>parameters not supported yet</td></tr>
<tr><td>drop</td><td>Yes (6.38)</td><td>No</td><td>parameters not supported yet</td></tr>
<tr><td>startPause</td><td>Yes (6.38)</td><td>Params</td><td>Supports also F-stop via parameter pauseType: &quot;fstop&quot;</td></tr>
<tr><td>stopPause</td><td>Yes (6.38)</td><td>Params</td><td>Supports also F-stop via parameter pauseType: &quot;fstop&quot;</td></tr>
<tr><td>reloadAreaFiles</td><td>Yes (6.38)</td><td>Yes</td><td>Reloads the segment and environment files</td></tr>
<tr><td>getFileVersions</td><td>Yes (6.38)</td><td>Yes</td><td>Return Environment and segment file versions</td></tr>
<tr><td>finePositioning</td><td>No</td><td>No</td><td></td></tr>
<tr><td>detectObject</td><td>Experimental</td><td>No</td><td>Support is implemented but has not been verified</td></tr>
</tbody></table>
<h2 id="v10-dialect"><a class="header" href="#v10-dialect">v1.0 dialect</a></h2>
<h3 id="how-to-enable-3"><a class="header" href="#how-to-enable-3">How to enable</a></h3>
<p>Set <strong>fleet_control_type</strong> to 3 and <strong>vdma_version</strong> to 0 and <strong>vdma_drive_order_type</strong> to 0. <strong>vdma_host</strong> and <strong>vdma_port</strong> should be configured to the address where the fleet control software (or in some cases separate MQTT broker) is running. If the broker uses username and password to authenticate, those should be set in <strong>vdma_mqtt_user</strong> and <strong>vdma_mqtt_password</strong>. <strong>vdma_area_name_override</strong> parameter can be set to the environment name that the fleet control is using. If not provided, the environment name is assumed to be the same as the area name in the environment file.</p>
<h3 id="description-3"><a class="header" href="#description-3">Description</a></h3>
<p>This dialect is based on VDA5050 version 1.012. It uses a JSON configuration file to convert the edge IDs to the segments that form the drive order. This file is called VDArouteNetwork.json</p>
<h2 id="background"><a class="header" href="#background">Background</a></h2>
<p>Navitrol drives based on a route network. This route network is defined in Navithor Tools and uploaded to the AGV. The routes are composed of segments and these segments have segment points. The segment point placement describes the geometrical properties of the routes and the network also contains information about the topological properties: which segments are reachable from any given other segments. On the segments, there are special points where the AGV performs functions such as charging and loading or unloading. These special points are called “symbolic points” in our terminology.
The fleet control traditionally gives the drive order to the AGV in the form of a list of segment IDs and a desired stopping point. The fleet control uses proprietary binary protocol for this purpose.
The AGV has limited capability to navigate outside the route network: in some obstacle avoidance scenarios the AGV may autonomously plan an avoidance route. The AGV is also capable of returning to the route network if its current location is sufficiently close to the network. Note that these functionalities have not yet been integrated with the VDMA protocol.
Because of this history, Navitrol receives a lot of the information it needs to perform actions or drive routes from the segment file. Some actions may not be available unless near a compatible symbolic point and some of the properties like frame headings etc. are read from the segment file rather than through the VDA5050 interface. Those optional properties are therefore not supported in the drive orders.
Because Navitrol implementation of VDA5050 support begun when the standard was still in its early phases, it is sometimes internally referred to as the VDMA protocol. This naming is currently used in eg. parameters.</p>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<p>The VDA5050 protocol supports sending error messages to the fleet control software. How these errors are visualized to the user depends on the fleet control.
In addition to the errors specified by the standard, there are some errors that are custom to the drive control software.
Most of these internal errors are described in other documents. Here is a list of errors that you may encounter specific to the VDA interface.</p>
<table><thead><tr><th>errorType</th><th>Error Message</th><th>Explanation</th><th>Fix</th></tr></thead><tbody>
<tr><td>internalError</td><td>VDA5050 license option is missing from the AGV</td><td>VDA5050 support is sold as a separate license option and has not been enabled</td><td>Get a license with the option enabled and install it on the AGV</td></tr>
<tr><td>internalError</td><td>Failed to build route</td><td>Internal error when building a drive trajectory from the order</td><td>Send logs to support</td></tr>
<tr><td>internalError</td><td>Failed to send route</td><td>Internal error when sending the trajectory to the component controlling the drive</td><td>Send logs to support</td></tr>
<tr><td>versionMismatch</td><td>Segment file version # doesn't match route network file #</td><td>The VDArouteNetwork.json has gone offsync with the route fisegment file on the AGV</td><td>Re-export the files from Tools and upload to the AGV</td></tr>
<tr><td>modeError</td><td>Invalid mode for autodriving</td><td>AGV is in wrong mode for autodriving (eg. in manual control, driving disabled from supervisor status message 3002 section 7 Drive control)</td><td>Release manual control or enable drive orders from supervisor. If nothing else helps, restart the AGV.</td></tr>
<tr><td>noRouteError</td><td>Map id mismatch</td><td>Level ID in the order didn't match the expected value</td><td></td></tr>
<tr><td>noRouteError</td><td>Position not initialized</td><td>AGV doesn't know where it is and can't drive</td><td>Use fleet control to initialize the AGV position</td></tr>
<tr><td>noRouteError</td><td>Starting position too far</td><td>The starting position of the drive order is too far away from AGV position</td><td>Depends on fleet control</td></tr>
<tr><td>orderUpdateError</td><td>Order already active</td><td>The fleet control sent a new drive order, but previous one is still active</td><td>Cancel the previous order with cancelOrder action</td></tr>
<tr><td>invalidAction</td><td>Action type is not supported as instantAction</td><td>Some VDA5050 actions can only be used as a part of an order</td><td>Depends on fleet control</td></tr>
<tr><td>invalidAction</td><td>Action has invalid format or invalid parameters</td><td>An action was received, but it was malformed</td><td>Depends on the fleet control.</td></tr>
<tr><td>invalidAction</td><td>Action type is not supported, invalid parameters or invalid format</td><td>Fleet control sent an unsupported action or parameters as a part of the order</td><td>Depends on fleet control</td></tr>
<tr><td>noOrderToCancel</td><td></td><td>Cancel order action was sent by fleet control, but no order is active</td><td>Typically no fix needed</td></tr>
<tr><td>mapNameMismatch</td><td>Map name '' is not a valid level number</td><td>Fleet control sent a position initialization action with incorrect map ID</td><td>Make sure that the map files are in sync between the AGV and fleet control.</td></tr>
<tr><td>mapNameMismatch</td><td>Map name '' doesn't match expected ''</td><td>Fleet control sent a position initialization action with incorrect map ID</td><td>Make sure that the map files are in sync between the AGV and fleet control. Use 'vdma_area_name_override' parameter if needed</td></tr>
<tr><td>internalError</td><td>Failed to replace order</td><td>Something went wrong with order replacement</td><td>Contact support if this problem persists</td></tr>
<tr><td>orderUpdateError</td><td>Order update failed</td><td>Something went wrong in updating an existing drive order</td><td>Contact support if this problem persists</td></tr>
<tr><td>validationError</td><td><em>message depends on validation error</em></td><td>The fleetcontrol has sent an order that was somehow malformed. The problem is described in the message</td><td></td></tr>
</tbody></table>
<h2 id="critical-actions"><a class="header" href="#critical-actions">Critical actions</a></h2>
<p>A critical action is an action that has to be completed in order for the drive order to meaningfully continue. Therefore the critical actions upon failure cause the order to stop and a fatal error to be reported to the fleet control.
The actuator related actions pick, drop, setActuator and releaseActuator are critical by default. The criticality of individual actions can be configured using the <a href="DriveControl/VDA5050/../../Introduction/Parameters/JsonConfigurationFile-en.html">JSON configuration file</a> </p>
<p>Navitrol error levels are mapped to VDA5050 error levels according to the following rule:</p>
<table><thead><tr><th>Navitrol error level</th><th>VDA5050 error level</th></tr></thead><tbody>
<tr><td>Warning</td><td>Warning</td></tr>
<tr><td>Error (<strong>vdma_escalate_errors_to_fatal_timeout_s</strong> set)</td><td>First warning, then turns to fatal</td></tr>
<tr><td>Error (<strong>vdma_escalate_errors_to_fatal_timeout_s</strong> = 0)</td><td>Fatal</td></tr>
<tr><td>Fatal</td><td>Fatal</td></tr>
</tbody></table>
<h2 id="vda5050-ssl-configuration"><a class="header" href="#vda5050-ssl-configuration">VDA5050 SSL configuration</a></h2>
<p>VDA5050 supports connecting over SSL encrypted connections. Using this feture requires the server to have a certificate that is signed by a root certificate. The root certificate is placed on the AGV.
In addition the AGV itself can have a certificate and a key that are used to verify the AGV:s identity when it connects to the fleetcontrol. 
By default VDA5050 uses the same SSL configuration than the rest of the Navitrol. So if SSL is enabled according to <a href="DriveControl/VDA5050/../../Miscellaneous/SslCertificates/SslCertificates-en.html">the SSL guide</a>, it will also be enabed for VDA5050 connections.
However, it is possible to disable the SSL for VDA5050 even when it is otherwise in use by setting <strong>vdma_ssl_mode</strong> to 0 or enable it just for VDA5050 by setting <strong>vdma_ssl_mode</strong> to 2.</p>
<p>By default the VDA5050 interface checks the hostname of the server it connects to and it has to match the value in the server certificate. This can sometimes be problematic and it can be disabled by setting <strong>vdma_ssl_verify_hostname</strong> to 0.
The <strong>vdma_ssl_version</strong> parameter can be used to select the TLS version used, but there should rarely be need to change it.
The other <strong>vdma_ssl_</strong> parameters are used only when <strong>vdma_ssl_mode</strong> is set to 2 (The SSL is turned on separately for VDA5050) and each of those has a corresponding regular Navitrol SSL parameter that it replaces (eg. <strong>vdma_ssl_agv_key_file</strong> is used instead of <strong>ssl_agv_key_file</strong>).</p>
<h3 id="troubleshooting-32"><a class="header" href="#troubleshooting-32">Troubleshooting</a></h3>
<p>SSL errors come from the OpenSSL library and are not always the easiest to understand. Here are couple of them you might encounter, but the list is not exhaustive. </p>
<h4 id="erroneous-certificate-common-names"><a class="header" href="#erroneous-certificate-common-names">Erroneous certificate common names</a></h4>
<blockquote>
<p>OpenSSL Error: error:1416F086:SSL routines:tls_process_server_certificate:certificate verify failed</p>
</blockquote>
<p>The Certificates used (CA certificate, AGV certificate and the server certificate) need to have different Common Name (CN) field values.</p>
<h4 id="wrong-hostname-in-certificate"><a class="header" href="#wrong-hostname-in-certificate">Wrong hostname in certificate</a></h4>
<blockquote>
<p>Error: host name verification failed.
OpenSSL Error: error:1416F086:SSL routines:tls_process_server_certificate:certificate verify failed</p>
</blockquote>
<p><strong>vdma_ssl_verify_hostname</strong> is enabled and the certificate host name doesn't match the server host name. Could be due to wrong certificate, changed hostname or yuo may need to disable the <strong>vdma_ssl_verify_hostname</strong> parameter. It can also be caused by an attempt by an attacker to impersonate the server. </p>
<h4 id="agv-certificate-not-configured"><a class="header" href="#agv-certificate-not-configured">AGV certificate not configured</a></h4>
<blockquote>
<p>OpenSSL Error: error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert handshake failure</p>
</blockquote>
<p>This error could be because you have not configured the AGV certificate, but the server has requested it. </p>
<h4 id="certificate-and-key-files-dont-match"><a class="header" href="#certificate-and-key-files-dont-match">Certificate and key files don't match</a></h4>
<blockquote>
<p>OpenSSL error: error:0B080074:x509 certificate routines:X509_check_private_key:key values mismatch</p>
</blockquote>
<p>The certificate file doesn't match the key file. Perhaps one of them was updated and the other one wasn't.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="features-affected-when-using-vda5050-interface"><a class="header" href="#features-affected-when-using-vda5050-interface">Features affected when using VDA5050 interface</a></h1>
<p>Updated 03.06.2024</p>
<hr />
<h2 id="features-affected-by-vda5050"><a class="header" href="#features-affected-by-vda5050">Features affected by VDA5050</a></h2>
<p>The rule is that anything related to localization is not affected by VDA5050 and everything related to driving the AGV or controlling the actuators on the AGV are affected. There are also differences between the different dialect options. In the segment based dialect Navitrol still has the segment file and reads it in. Thus many of the features that rely on the information stored in the segment file work with the segment based dialect but might not yet work with the trajectory based dialect. Below is a table which shows common Navitrol features and if they are supported by different VDA5050 dialects.</p>
<p>VDA5050 does not affect the supported hardware.</p>
<h3 id="localization-features-1"><a class="header" href="#localization-features-1">Localization features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Trajectory based dialect</th><th align="center">Segment based dialect</th></tr></thead><tbody>
<tr><td align="center">Precision positioning</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Ramp zones</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Dynamic mapping</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">GPS</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">IMU and sensor fusion</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Magnetic line following</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">External localization</td><td align="center">✔️</td><td align="center">✔️</td></tr>
</tbody></table>
<h3 id="drive-control-features-1"><a class="header" href="#drive-control-features-1">Drive control features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Trajectory based dialect</th><th align="center">Segment based dialect</th></tr></thead><tbody>
<tr><td align="center">Speed on route</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Omni frame heading</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Pivoting</td><td align="center">❌</td><td align="center">✔️</td></tr>
<tr><td align="center">Other route properties</td><td align="center">❌</td><td align="center">✔️</td></tr>
<tr><td align="center">DMC Docking</td><td align="center">❌</td><td align="center">✔️</td></tr>
<tr><td align="center">Obstacle avoidance</td><td align="center">❌</td><td align="center">❌</td></tr>
<tr><td align="center">Synchronized driving</td><td align="center">❌</td><td align="center">❌</td></tr>
<tr><td align="center">Return to route</td><td align="center">✔️*</td><td align="center">✔️</td></tr>
<tr><td align="center">Barrier stop</td><td align="center">❌</td><td align="center">✔️</td></tr>
</tbody></table>
<p>*<em>The fleet control can drive the AGV back on its own definition of a route.</em></p>
<h3 id="actuator-control-features-1"><a class="header" href="#actuator-control-features-1">Actuator control features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Trajectory based dialect</th><th align="center">Segment based dialect</th></tr></thead><tbody>
<tr><td align="center">Pickup from floor / default height</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Pickup from different heights at different locations</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Pallet detection</td><td align="center">✔️</td><td align="center">✔️*</td></tr>
<tr><td align="center">Buffer lanes</td><td align="center">✔️</td><td align="center">❌</td></tr>
<tr><td align="center">Block stacking</td><td align="center">❌</td><td align="center">✔️**</td></tr>
<tr><td align="center">Racking</td><td align="center">✔️</td><td align="center">✔️</td></tr>
</tbody></table>
<p>*<em>Limitations on how far away from the original segments must be set to the nodes correctly for the AGV to be able to dock to target that are not right at the expected destination.</em></p>
<p>**<em>Only loading from a single symbolic point</em></p>
<h3 id="miscellaneous-features-1"><a class="header" href="#miscellaneous-features-1">Miscellaneous features</a></h3>
<table><thead><tr><th align="center">Feature</th><th align="center">Trajectory based dialect</th><th align="center">Segment based dialect</th></tr></thead><tbody>
<tr><td align="center">Parameter zones</td><td align="center">✔️</td><td align="center">✔️</td></tr>
<tr><td align="center">Charging</td><td align="center">❌</td><td align="center">❌</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="return-to-route-2"><a class="header" href="#return-to-route-2">Return to Route</a></h1>
<p>Updated 29.04.2024</p>
<h2 id="overview-30"><a class="header" href="#overview-30">Overview</a></h2>
<h3 id="introduction-37"><a class="header" href="#introduction-37">Introduction</a></h3>
<p>Return to route is a feature that allows an AGV that is off the route to drive to the closest suitable route. The feature can be useful when driving the AGV manually near the route and then performing the automatic return to route so that the AGV can be taken into production.</p>
<p>There's also option to <a href="DriveControl/ReturnToRoute/ReturnToRoute-en.html#allow-larger-deviation-from-route-at-the-start-of-drive">allow a larger deviation from the route at the start of a drive</a> without the need for return to route.</p>
<h3 id="limitations-12"><a class="header" href="#limitations-12">Limitations</a></h3>
<ul>
<li>AGV is in standby state when given return to route order</li>
<li>Does not acknowledge obstacles or environment points.</li>
</ul>
<h2 id="how-to-use-17"><a class="header" href="#how-to-use-17">How to use</a></h2>
<p>The return to route feature always requires an external trigger. It can be triggered for example from the Supervisor interface, Navitrol monitor or Navithor client.</p>
<h2 id="set-up-7"><a class="header" href="#set-up-7">Set up</a></h2>
<h3 id="return-to-route-by-shortest-route-for-omni"><a class="header" href="#return-to-route-by-shortest-route-for-omni">Return to route by shortest route for omni</a></h3>
<p>For omni AGVs without steering limitations. It generates a reference point on the route to which it drives.</p>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I, rtr_use_custom_route</td><td>0</td><td>Sets the return to route mode: <br>0 = Shortest route for omni<br>1 = Custom route for Diff/Steer drive<br>2 = Custom route for limited omni wheels</td></tr>
</tbody></table>
<h3 id="return-to-route-with-custom-drive-order"><a class="header" href="#return-to-route-with-custom-drive-order">Return to route with custom drive order</a></h3>
<p>The AGV cannot return to the route by reversing to a route that only supports forward driving. Supported by all kinematic models. An AGV must have relatively small heading and distance errors to at least one route defined in the active map to successfully return to route. Return to route path is constructed automatically to the closest suitable point. It always consists of four route points connected with splines. The four points include start point, start smooth distance point, end smooth distance point and the end point.</p>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>F, rtr_max_dist</td><td>2.0</td><td>This limit constitutes the maximum Euclidean distance (m) from the navigation point to a trajectory segment point.</td></tr>
<tr><td>F, rtr_speed</td><td>0.3</td><td>The maximum speed (m/s) during the return to route drive</td></tr>
<tr><td>F, rtr_max_head_err_deg</td><td>5.0</td><td>The maximum heading error when checking if the AGV is already on the route and return to route is not needed</td></tr>
<tr><td>F, rtr_max_head_diff</td><td>90.0</td><td>The maximum heading difference between the heading of potential route point and the current heading of the AGV, for the return to route to be feasible.</td></tr>
<tr><td>I, rtr_use_custom_route</td><td>1</td><td>Sets the return to route mode: <br>0 = Shortest route for omni<br>1 = Custom route for Diff/Steer drive<br>2 = Custom route for limited omni wheels</td></tr>
<tr><td>F, rtr_control_point_dist</td><td>2.5</td><td>Required minimum Euclidean distance (m) to potential return to route target point.</td></tr>
<tr><td>F, rtr_control_point_start_smooth_dist</td><td>0.8</td><td>Defines the smooth distance at the start of the return to route path</td></tr>
<tr><td>F, rtr_control_point_end_smooth_dist</td><td>0.8</td><td>Defines the smooth distance before the end of the return to route path</td></tr>
<tr><td>F, rtr_already_on_route_dist</td><td>0.1</td><td>The maximum distance error when checking if the AGV is already on the route and return to route is not needed</td></tr>
</tbody></table>
<p>The below Figure visualizes the custom drive order return to route. The orange line denotes the Euclidean distance between navigation point and nominal trajectory segment point. This distance must be smaller than <strong>rtr_max_dist</strong> for the return to route to be further evaluated. The <strong>rtr_control_point_dist</strong>-parameter constitutes how aggressively it converges to the nominal route. </p>
<p><img src="DriveControl/ReturnToRoute/./media-en/rtr_custom_drive_order.png" alt="" /></p>
<blockquote>
<p>Return to route - Custom drive order.</p>
</blockquote>
<h3 id="return-to-route-for-omnis-with-limited-steering"><a class="header" href="#return-to-route-for-omnis-with-limited-steering">Return to route for omnis with limited steering</a></h3>
<p>This subfeature is only supported by omni and mecanum kinematic models. Limited return to route is designed for omni drive AGVs that have heavy steering limitations and are not able to pivot or perform any other high curvature manoeuvres. See documentation for <a href="DriveControl/ReturnToRoute/../../Kinematics/OmniSteerLimit/OmniSteerLimit-en.html">Omni steer limit</a>.
Limited steering return to route mode will approach the nearest route by crab-like movement, see Figure below. There is a small, curved part in the very end of the path to adjust wheels.</p>
<p><img src="DriveControl/ReturnToRoute/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Crabbing to route</p>
</blockquote>
<p>The AGV tries to correct any heading errors while returning to the route. For the latter subfigure below, adjusting the frame heading to the route when approaching requires larger wheel angles.</p>
<p><img src="DriveControl/ReturnToRoute/./media-en/image4.png" alt="" />
<img src="DriveControl/ReturnToRoute/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Crabbing to route with frame heading errors</p>
</blockquote>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I, rtr_use_custom_route</td><td>2</td><td>Strictly curvature limited custom route.</td></tr>
<tr><td>F, rtr_already_on_route_dist</td><td>0.05</td><td>If the distance to nearest route segment point is smaller than this value AGV is considered to be on route. The return route is calculated but not driven.</td></tr>
</tbody></table>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>F, rtr_max_dist</td><td>2.00</td><td>Defines the maximum search distance [m] for the first target point on the route.</td></tr>
<tr><td>F, rtr_speed</td><td>0.30</td><td>Upper threshold [m/s] for the rtr trajectory speed.</td></tr>
<tr><td>F, rtr_max_head_err_deg</td><td>5.00</td><td>Lower threshold for the angle [deg] between the vehicle and the route for return to route to be possible.</td></tr>
<tr><td>F, rtr_max_head_diff</td><td>30.0</td><td>Maximum heading difference between the vehicle and the target point on the route.</td></tr>
<tr><td>F, rtr_control_point_dist</td><td>0.25</td><td>Defines the maximum distance from close point (see rtr_max_dist) to a custom return to route target point.</td></tr>
<tr><td>F, rtr_control_point_end_smooth_dist</td><td>0.05</td><td>Defines the minimum distance between the last two control points in the custom route creation.</td></tr>
</tbody></table>
<p>Parameter <strong>rtr_control_point_start_smooth_dist</strong> has no affect on this subfeature.</p>
<h3 id="limited-omni-steering-recovery"><a class="header" href="#limited-omni-steering-recovery">Limited omni steering recovery</a></h3>
<p>Limited omni steering recovery is a feature for trying to drive the AGV automatically back to the route if it has been driven too far from the route. The idea is that in a case, where there normally would be the POS_CONT_POS_ERROR or POS_CONT_HEADING_ERROR, this rescue return to route is triggered instead. Navitrol will then take segment points from the history that the AGV has just driven that are closer than the <strong>rtr_max_dist</strong> parameter and tries to create custom route to those points. There is a cost function that tries to find a segment point that</p>
<ul>
<li>Has the smallest heading error to the AGV current heading.</li>
<li>The limited omni feasibly can drive. Only segment points with wheel target angles within limits are considered.</li>
</ul>
<p>The <strong>rtr_control_point_end_smooth_dist</strong> parameter is used to define the length of the curved part in the end of the custom route. </p>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I, rtr_use_custom_route</td><td>2</td><td>Strictly curvature limited custom route.</td></tr>
</tbody></table>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I, rtr_omni_steer_limit_recovery_time_ms</td><td>20000</td><td>0 = Disabled<br> <br> 5000 - 100000 = Enabled <br> Heavily limited omni stuck in warning_limited_steering_active too long time trigger limited steering recovery.<br> Active only when rtr_use_custom_route is set to value 2.</td></tr>
</tbody></table>
<h4 id="preconditions-4"><a class="header" href="#preconditions-4">Preconditions</a></h4>
<ul>
<li>AGV is limited steering omni</li>
<li>WARNING_LIMITED_STEERING_ACTIVE is enabled</li>
<li>AGV is further away from route than <strong>pc_max_dist_err</strong> or AGV heading error to the route is higher than <strong>pc_max_head_err</strong></li>
</ul>
<p><img src="DriveControl/ReturnToRoute/./media-en/rescue_rtr_overshoot.png" alt="" /></p>
<blockquote>
<p>AGV has overshot the trajectory curve due to limited steering.</p>
</blockquote>
<p><img src="DriveControl/ReturnToRoute/./media-en/rescue_rtr_route_back.png" alt="" /></p>
<blockquote>
<p>Navitrol will use return to route feature to drive the AGV back to some route point in the history. </p>
</blockquote>
<p><img src="DriveControl/ReturnToRoute/./media-en/rescue_rtr_back_on_route.png" alt="" /></p>
<blockquote>
<p>AGV has driven back to the nominal route.</p>
</blockquote>
<h3 id="errors-and-warnings-14"><a class="header" href="#errors-and-warnings-14">Errors and warnings</a></h3>
<h4 id="657---warning_return_to_route_failed"><a class="header" href="#657---warning_return_to_route_failed">657 - WARNING_RETURN_TO_ROUTE_FAILED</a></h4>
<h4 id="551---error_rtr_and_vector_drive_conflict"><a class="header" href="#551---error_rtr_and_vector_drive_conflict">551 - ERROR_RTR_AND_VECTOR_DRIVE_CONFLICT</a></h4>
<p>See <a href="DriveControl/ReturnToRoute/../../Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html">Error description</a>.</p>
<h2 id="troubleshooting-33"><a class="header" href="#troubleshooting-33">Troubleshooting</a></h2>
<h3 id="advanced-troubleshooting-9"><a class="header" href="#advanced-troubleshooting-9">Advanced troubleshooting</a></h3>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I, log_rtr_generation</td><td>1</td><td>Enables logging of return to route generation.</td></tr>
</tbody></table>
<p>All related logging is under prefix &quot;RTR:&quot;</p>
<h2 id="allow-larger-deviation-from-route-at-the-start-of-drive"><a class="header" href="#allow-larger-deviation-from-route-at-the-start-of-drive">Allow larger deviation from route at the start of drive</a></h2>
<p>There is also possibility to increase the allowed deviation from the route at the start of drive so that a trigger for return to route wouldn't be needed. The AGV can then start the drive faster, as it corrects the distance error to the route while driving. The downside compared to the return to route feature is the lower controllability.</p>
<p><img src="DriveControl/ReturnToRoute/./media-en/startLargerDeviation.png" alt="" /> <img src="DriveControl/ReturnToRoute/./media-en/startLargerDeviation2.png" alt="" /></p>
<blockquote>
<p>AGV starts the drive with larger deviation from the route than normally allowed when driving</p>
</blockquote>
<p>This feature is enabled by setting the parameter <strong>pc_start_err_factor</strong> &gt; 1. This parameter multiplies the normal deviation limit <strong>pc_max_dist_err</strong> at start. The larger deviation limit will last until the AGV is well inside <strong>pc_max_dist_err</strong> limit or it has travelled a distance of <strong>pc_start_err_max_travelled_dist</strong>. The user can also limit how far from starting point of the path the larger deviation can be activated with a parameter <strong>pc_start_err_max_dist_to_traj_start</strong>.</p>
<p><img src="DriveControl/ReturnToRoute/./media-en/max_dist_to_traj_start_scaled.png" alt="" />
&gt;AGV is too far from the start of the trajectory to allow larger start deviation</p>
<h3 id="limitations-13"><a class="header" href="#limitations-13">Limitations</a></h3>
<ul>
<li>The route planner needs to be able to find the starting point. For example in Standalone production <strong>route_driver_max_diff_dist_m</strong> must be set high enough to find the start point from the route.</li>
<li>Navitrol Monitor's production simulation doesn't support this feature</li>
<li>Heading error limit to the route is not affected. Non-holonomic vehicles might change the heading too much when returning to the route with large deviation from route at start, which will trigger an error.</li>
</ul>
<h3 id="parameters-6"><a class="header" href="#parameters-6">Parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>pc_start_err_factor</td><td>Float</td><td>1.0</td><td>Determines maximum distance error [m] from the route at the start of drive order (multiplies pc_max_dist_err)</td></tr>
<tr><td>pc_start_err_max_travelled_dist</td><td>Float</td><td>1.0</td><td>Maximum travelled distance [m] from the start of drive order when larger deviation from route is allowed</td></tr>
<tr><td>pc_start_err_max_dist_to_traj_start</td><td>Float</td><td>FLT_MAX</td><td>Maximum distance [m] to the first point of trajectory to allow the larger deviation at start to activate</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="obstacle-avoidance"><a class="header" href="#obstacle-avoidance">Obstacle Avoidance</a></h1>
<hr />
<h2 id="introduction-38"><a class="header" href="#introduction-38">Introduction</a></h2>
<p>Obstacle avoidance is an algorithm that detects collisions and drives around the obstacles to continue the mission. Thus, the AGV may react dynamically to changes in the environment. The collision detection uses 2D safety scanners to predict whether there are any upcoming collisions.
Upon a collision detection, the AGV will begin to plan a new route.</p>
<p>If there is enough space to perform the bypass, fleet control is sent a message to request the bypass and reserve the area from other AGVs in the fleet. After getting the permission the AGV will begin the bypass and continue to poll the environment for other obstacles.</p>
<p>To ensure controlled behavior there are several constraints under which obstacle avoidance plans the paths such as time spent planning and the area in which the bypass must happen. These are discussed in more detail below.</p>
<p>The complete list of obstacle avoidance parameters, their valid values and explanations is in the end of this document. The obstacle avoidance parameters are marked with bold when referenced in text. They always begin with prefix <strong>obst_</strong>.</p>
<h3 id="obstacle-avoidance-modes"><a class="header" href="#obstacle-avoidance-modes">Obstacle Avoidance Modes</a></h3>
<p>There are two modes of obstacle avoidance that can be used in Navitrol.
By setting <strong>obst_av_mode</strong> parameter to 1, only detection mode of obstacles is activated, meaning that the AGV will detect obstacles on its path and stop a certain distance before collision, but will not attempt to plan a route to avoid obstacles.</p>
<p>Setting <strong>obst_av_mode</strong> to 2 enables obstacle detection and avoidance mode. With this mode, AGV will detect obstacles on its path and plan a bypass route avoiding them.</p>
<p>Note for those using coupled driving feature: Both obstacle detection and obstacle avoidance will be disabled for the duration of coupled driving, but they will work normally when the AGVs are uncoupled.</p>
<h3 id="obstacle-avoidance-zones"><a class="header" href="#obstacle-avoidance-zones">Obstacle avoidance zones</a></h3>
<p>By default, obstacles may be detected and avoided only if the AGV is inside an obstacle avoidance zone. There may be one or many obstacle avoidance zones. The zones hold information on direction policy, or in other words, which direction the AGV may use to drive around the obstacle. The AGV must be always inside an obstacle avoidance zone when
it is driving around the obstacle. Thus, if the obstacle is too close to obstacle zone boundaries, the AGV may not drive around it. The zones can be ignored, allowing obstacle avoidance anywhere by setting the value of the parameter <strong>obst_use_zones</strong> to 0.</p>
<p>With default value of 1 <strong>obst_use_zones</strong> obstacles are bypassed only if the bypass route can be planned inside the zone according to zone rules. Obstacles themselves are however detected everywhere also outside zones, and AGV is stopped according to the obstacle avoidance related parameters. With <strong>obst_use_zones</strong> in value 2 obstacles are not only bypassed, but also only detected inside zones. This option makes it possible to configure obstacle avoidance to be used only in certain areas, without affecting the AGV driving globally. It should be noted that this option also ignores the scanner points outside of the obstacle zones, meaning that even when the AGV is inside a zone, obstacles outside of a zone will not be detected or avoided.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1: the AGV (grey) sees an obstacle (red) because the AGV is inside an obstacle avoidance zone (blue). There is enough space to bypass the obstacle inside the obstacle avoidance zone. The route around the obstacle is shown with green dashed line; the nominal route is shown with black dashed line.</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2: The AGV will detect the obstacle but there is not enough space to bypass the obstacle because the obstacle is close to obstacle avoidance zone boundaries. The route around the obstacle would be outside the obstacle avoidance zone (red dashed line). Thus, driving around the obstacle is not possible. In this scenario, AGV will stop and wait for the obstacle to disappear.</p>
</blockquote>
<h3 id="detecting-collisions"><a class="header" href="#detecting-collisions">Detecting collisions</a></h3>
<p>The seamless functioning of obstacle detection is crucial for obstacle avoidance. If no obstacles are detected, it is impossible to drive around them.</p>
<p>The parameter <strong>obst_detection_scanners</strong> determines which localization scanners are used for obstacle detection. Different scanners may be used for localization and obstacle detection. Please see the Appendix for instructions on how to set this parameter for different scanners.</p>
<p>Similarly, the parameter <strong>obst_detection_meas_scanners</strong> determines which measurement-only scanners are used for obstacle avoidance.</p>
<p>For each route point, if there are at least <strong>obst_detect_min_scan_points</strong> number of scanner measurements close to the AGV, a collision is detected in that route point. Being &quot;close&quot; to the AGV is determined by <strong>obst_free_zone_left</strong>, <strong>obst_free_zone_right, obst_free_zone_front</strong> and <strong>obst_free_zone_rear</strong> parameters, which determine the zone that must be obstacle-free around the vehicle.</p>
<p>Note that the distance to the obstacle and its size determines the number of scanner beams that hit it. Thus, obstacles that are seen as less than <strong>obst_detect_min_scan_points</strong> number of points are not detected as obstacles.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 3: the AGV (grey) with the safety margin (red). Increasing the value of the parameters makes the required free zone grow in the specified direction.</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 4: Left: collision is not detected because there are no obstacles inside the safety zone (red). Right: collision is detected because the wall is inside the safety zone.</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 5: The AGV (left) is driving towards an obstacle (right). The environment points are shown with brown lines whereas the front scanner measurements are shown with green dots. As more than <strong>obst_detect_min_scan_points</strong> (here, the value is 4) points are inside the red rectangle, the AGV would collide in that route point.
Note that for bigger values of <strong>defined obstacle free zone parameters</strong>, the collision is detected in an earlier point in the route than for smaller values.</p>
</blockquote>
<p>The parameter <strong>obst_detect_obstacles_dist</strong> determines the range of obstacle detection. If an obstacle is farther than this limit from the AGV, it will not be detected. All obstacles closer than this limit are detected.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 6: Obstacle is not detected (up) as the distance to the obstacle is larger than <strong>obst_detect_obstacles_dist</strong> (value of 9.0 meters was used). As the AGV moves closer than the limit, the obstacle is eventually detected (down). The side of a big square is 1.0 meters.</p>
</blockquote>
<h3 id="detecting-moving-obstacles"><a class="header" href="#detecting-moving-obstacles">Detecting moving obstacles</a></h3>
<p>If the velocity of the obstacle is more than <strong>obst_moving_det_treshold</strong> meters per second, it is interpreted as moving. If the obstacle is detected as moving, the AGV must wait <strong>obst_moving_time_ms</strong> milliseconds before it may continue to plan a route around the obstacle.</p>
<h3 id="planning-the-route"><a class="header" href="#planning-the-route">Planning the route</a></h3>
<p>When the AGV is closer to the collision than <strong>obst_distance_to_begin_planning</strong> meters, it may begin planning a route around the obstacle. The angle to the obstacle edge to be bypassed must be at most <strong>obst_bypass_trajectory_max_angle_deg</strong> degrees.
The reason for this is to prevent the AGV from driving around obstacles that are too wide, too far away from the nominal route and obstacles that require the AGV to make sharp turns.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 7: Visualization of how the angle between the AGV and obstacle edge is calculated. If the AGV is close to the obstacle or if the obstacle is wide, the angle will be large. In both cases, driving around such obstacle could be dangerous as the AGV would have to make sharp turns and the whole area behind the obstacle would be occluded and thus
unknown.</p>
</blockquote>
<p>The maximum AGV velocity during the bypass is determined by the parameter <strong>obst_bypass_velocity</strong>.</p>
<p>Because there is some noise in scanner measurements, the obstacle edges may appear in different places depending on the time when the
measurement is taken. The parameter <strong>obst_bypass_edge_safety_addition</strong> determines, how much additional free space there will be between the AGV with safety limits when the
route around the obstacle is planned.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 8: Up: Driving around an obstacle, <strong>obst_bypass_safety_addition</strong> = 0.1 meters Down: Driving around an obstacle, <strong>obst_bypass_safety_addition</strong> = 0.5 meters. In this case, driving farther from the obstacle would be safer but it also requires more free space around the obstacle in order to successfully plan the route.</p>
</blockquote>
<p>If the replan fails, the algorithm must wait at least <strong>obst_replan_wait_time_ms</strong> milliseconds before trying again.</p>
<p>The parameter <strong>obst_return_wait_time_s</strong> limits, how many seconds the AGV may try to replan at maximum. The time is calculated when the AGV is not on nominal route and is standing still. Every time the AGV manages to get forwards, the timer is reset. In other words, the purpose of this parameter and condition is to prevent the AGV getting stuck in one place when driving around the obstacle.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image11.png" alt="" /></p>
<blockquote>
<p>Figure 9: (1) The AGV begins to drive around an obstacle (2) After driving further, the AGV sees another obstacle around which it does not find a route (3) After trying to find a route around the obstacle for <strong>obst_return_wait_time_s</strong> seconds, the AGV reverses back to nominal route the same way it came. After that, it is possible to try drive around the obstacle from the other direction or try again until the obstacle disappears.</p>
</blockquote>
<p>After planning the route, a permission must be gotten from the fleet control. In order to send smaller messages, not every route point has to be sent to fleet control. The parameter <strong>obst_send_fleet_every_nth_point</strong> determines, how many points are sent: 1 = every point, 2 = every second point, etc. This can be beneficial if the wireless connection is not fast.</p>
<p>The AGV may wait at most <strong>obst_wait_time_for_answer_s</strong> seconds for answer from fleet control. If it doesn't get an answer, it must begin planning a route around the obstacle again from scratch and send a new request before beginning the bypass. The reason to limit the time waiting for answer from fleet control is to avoid that the AGV would be standing and waiting for the permission for a long time when, for example, the wireless connection is not good.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image12.png" alt="" /></p>
<blockquote>
<p>Figure 10: The effect of obstacle avoidance parameters when the AGV is moving from right to left towards the obstacle. The side of each square is 1.0 meters. (1) Point after which obstacle detection is active (2) Point where the obstacle is detected (<strong>obst_detect_obstacles_dist</strong> = 9.0 meters). (3) Point where planning a route around the obstacle is begun (<strong>obst_distance_to_begin_planning</strong> = 8.0 meters) (4) Point where the AGV would begin driving around the obstacle. This depends from the obstacle apparent width, the AGV size, <strong>obst_free_zone_front</strong>, <strong>obst_free_zone_left,</strong> <strong>obst_bypass_safety_addition</strong> and <strong>obst_bypass_trajectory_max_angle_deg</strong> (5). The distance of the bypass route from the obstacle is (6) in the figure.</p>
</blockquote>
<p>When the AGV gets permission from fleet control, the fleet control has automatically reserved exclusive area for the AGV to drive around the obstacle. Fleet control will not give the AGV permission for bypass until the area is clear from other AGVs. During the bypass, other AGVs may not drive in this area.</p>
<h3 id="limitations-14"><a class="header" href="#limitations-14">Limitations</a></h3>
<p>There are several cases where obstacle detection or driving around the obstacle is not possible. Before installing obstacle avoidance, positioning and navigating should be calibrated. The map must be accurate enough so that the AGV will never lose its position -- even if some features would occlude environment features temporarily.</p>
<p>Obstacle detection is not able to see through walls. It cannot deduce how big the obstacle really is because part of the obstacle is always occluded.</p>
<p>Obstacle detection is not able to recognize <em>what</em> the obstacle is: it does not know whether the measurements represent a box, human, forklift driven by a human or an AGV. The algorithm may not predict where a moving obstacle is going next.</p>
<p>Driving around moving obstacles is not possible. If a moving obstacle is detected, the AGV will always stop and wait until the obstacle has stopped.</p>
<p>Driving around obstacles is not allowed in a curve. In other words, it is possible only in a relatively straight route with a small curvature.
In addition, the route ahead the AGV must be long enough so that the AGV may return to the nominal route after the bypass. If the obstacle is near trajectory end, it may not be bypassed.</p>
<p>Driving around obstacles that appear less wide than they really are is not supported. After the AGV has chosen the route around the obstacle, it cannot change the distance to the nominal route.</p>
<p>From Navitrol version 6.34.00, bypassing obstacles with an omni-type AGV on a route that has a frame heading is supported. However, it needs to be a static frame heading and not a linearly changing one. Furthermore, only cases where the avoidance starts and ends at the same frame heading are supported.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>Figure 11: bypassing obstacles (1) and (2) is possible because they do not get wider from what the AGV initially sees when it begins planning a route around the obstacle.</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image14.png" alt="" /></p>
<blockquote>
<p>Figure 12: Bypassing obstacle (3) is possible because the AGV sees that the obstacle gets wider when it begins the bypass. Bypassing obstacle (4) is not supported because it gets wider along the route from what the AGV initially sees. The parameter <strong>obst_detect_obstacles_dist</strong> determines, how far the AGV sees obstacles. The parameter <strong>obst_distance_to_begin_planning</strong> determines, at which distance to the obstacle the AGV begins planning for the bypass.</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image15.png" alt="" /></p>
<blockquote>
<p>Figure 13: driving around an obstacle in a curve is not possible. Obstacles may only be bypassed in straight or almost straight paths.</p>
</blockquote>
<h2 id="setup-guide"><a class="header" href="#setup-guide">Setup guide</a></h2>
<p>After obtaining a license for obstacle avoidance, only the environment file and parameters must be set up to begin using obstacle avoidance.</p>
<h3 id="setting-up-the-navithortools-project"><a class="header" href="#setting-up-the-navithortools-project">Setting up the NavithorTools project</a></h3>
<p>To set up a NavithorTools project to support obstacle avoidance, first create the environment from teach data and routes as usual or open an existing project with environment and route data. After those steps are done, choose the Zones tab and Feature Zone underneath it.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image16.png" alt="" /></p>
<p>From the Feature Zone tab, several zones may be specified. In general, a zone encodes certain properties and allowed actions for an area in the environment. In case of obstacle avoidance, the zones are the only allowed areas for obstacle bypassing (unless the value of the parameter <strong>obst_use_zones</strong> is 0). No routes are generated outside the
boundaries. In addition, a unique direction policy of the bypass may be specified for each obstacle avoidance zone. This is discussed in detail below.</p>
<p>To create an obstacle avoidance zone, choose ObstacleAvoidance from the Zone type drop menu. After that, obstacle avoidance zones may be drawn over the environment and routes when the Edit areas button is active.
This is indicated by the yellow color of the button. After choosing ObstacleAvoidance zone type, the Edit areas will turn automatically on.</p>
<p>Note that obstacle avoidance zones may not overlap as such situation would result into undefined bypass behavior. If any zones overlap, they will be drawn with red color and the project may not be exported before fixing the issue.</p>
<p>Obstacle avoidance zones should not be placed over routes with high curvature. Behavior of obstacle avoidance at such locations is undefined. The AGV may not drive from one obstacle avoidance zone to another during a bypass -- the whole bypass route must be inside one obstacle avoidance zone.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image17.png" alt="" /></p>
<p>After drawing the obstacle avoidance zone, the zone data may be specified from the table below the Zone type drop menu and description text. Any number of zones may be first drawn, and the zone data may be specified later.</p>
<p>First, select an obstacle avoidance zone by clicking on it. Obstacle avoidance zones are drawn as purple polygons. Obstacle avoidance zones may be selected whether the Edit areas is selected or not.</p>
<p>After selecting a zone, you may browse and edit the zone data in the table simply by clicking on any cell on the right column and typing with the keyboard. A zone may be deleted by double clicking it.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image18.png" alt="" /></p>
<table><thead><tr><th>Field</th><th>Explanation</th><th>Valid values</th></tr></thead><tbody>
<tr><td>LeftPassAllowed</td><td>Can bypass from left in this zone</td><td>True/False or 1/0</td></tr>
<tr><td>RightPassAllowed</td><td>Can to bypass from right in this zone</td><td>True/False or 1/0</td></tr>
<tr><td>PrioritizeLeft</td><td>When both left and right pass are allowed, selecting this option will make the AGV try bypass from left first. When only one direction is allowed, this property has no effect.</td><td>True/False or 1/0</td></tr>
<tr><td>ID</td><td>Unique identifier for each zone</td><td>Not modifiable by the user</td></tr>
</tbody></table>
<p>An example of two valid zones and their zone data below. Only zone data for the selected zone is visualized in the table.</p>
<p><img src="DriveControl/ObstacleAvoidance/./media-en/image19.png" alt="" /></p>
<p>Finally, after finishing the zones, the file must be exported and uploaded to Navitrol, and to Database if using fleet control.­</p>
<h3 id="setting-up-parameters"><a class="header" href="#setting-up-parameters">Setting up parameters</a></h3>
<p>Obstacle avoidance may be used with either standalone production or with fleet control. The required parameters when using fleet control are</p>
<table><thead><tr><th>Parameters</th></tr></thead><tbody>
<tr><td>I,agv_status_message_version, 2</td></tr>
<tr><td>I,fleet_control_type, 1</td></tr>
<tr><td>I,obst_av_mode, 2</td></tr>
</tbody></table>
<p>The required parameters when using standalone are</p>
<table><thead><tr><th>Parameters</th></tr></thead><tbody>
<tr><td>I,fleet_control_type, 0</td></tr>
<tr><td>I,obst_av_mode, 2</td></tr>
</tbody></table>
<p><strong>If any other values for these parameters are used, the AGV may not leave the nominal trajectory to drive around the obstacle.</strong></p>
<p>In addition to these parameters, the obstacle avoidance parameters should be set up according to <strong>Chapter 1</strong>. A complete list of all obstacle avoidance parameter is in the end of this document.</p>
<h2 id="troubleshooting-34"><a class="header" href="#troubleshooting-34">Troubleshooting</a></h2>
<h3 id="general-3"><a class="header" href="#general-3">General</a></h3>
<p>Always use the latest version of Navitrol, Navithor and Navithor Tools when using obstacle avoidance. There is no support for obstacle avoidance in older versions of the software. Use the feature in outdated versions at your own risk.</p>
<p>In each case, see which warnings and errors are raised. Most situations either are features or byproducts of certain parameter values and thus may be avoided by setting the parameters correctly.</p>
<p>Obstacle avoidance will never be able to bypass every possible obstacle as it prioritizes safety over getting to the goal. Moving obstacles will never be bypassed.</p>
<p>If there are some parsing problems when using a map or parameters, errors will show up in Navitrol.</p>
<p>Make sure by reading the parameters with a text editor that you have the right file.</p>
<p>Ensure that your AGV has a high position confidence in every part of the map, even if there would be some obstacles that would occlude environment features.</p>
<p>Check the height of your 2D safety scanner. Acknowledge the fact that the environment may appear partial viewing from that height: some objects may appear smaller than they really are because only one height is sensed by the scanner.</p>
<p>Make sure the scanners do not see additional points such as dust in the lens, AGV chassis or other noise.</p>
<p>It is not recommended to have two scanners that are of different type.
Note that when using such configuration, front and rear scanner may sense the same environment in different ways.</p>
<p>Safety zones should be used with obstacle avoidance for safety measures.
Obstacle avoidance does not replace or implement the existing safety standards.</p>
<p>If the value of <strong>obst_free_zone_(corresponding direction)</strong> is smaller than the safety zones of the scanner, the safety logic will prevent driving around any obstacles as the AGV would drive too close to the obstacles. The obstacle avoidance parameters should always be tuned according to the scanner settings.</p>
<p>Triggering safety zones is seen as red and yellow circle around the scanner in Navitrol Monitor. In addition, warnings will be set.</p>
<h3 id="an-obstacle-avoidance-error-is-raised-upon-startup"><a class="header" href="#an-obstacle-avoidance-error-is-raised-upon-startup">An obstacle avoidance error is raised upon startup</a></h3>
<p>Make sure that you have the correct license that enables obstacle avoidance.</p>
<p>Make sure that you have a version of Navitrol, Navithor Client and Navithor Server that supports obstacle avoidance.</p>
<p>Make sure that you have defined at least one obstacle avoidance zone in NavithorTools and that the environment and segment files are available and loaded correctly by Navitrol.</p>
<h3 id="the-agv-stops-before-the-obstacle-but-does-not-bypass-it"><a class="header" href="#the-agv-stops-before-the-obstacle-but-does-not-bypass-it">The AGV stops before the obstacle but does not bypass it</a></h3>
<p>The AGV may also not be inside an obstacle avoidance zone and thus the obstacle bypass is not allowed. This may only be fixed by editing the obstacle avoidance zones.</p>
<p>If the value of the parameters <strong>obst_av_mode</strong> is 1, AGV will not attempt to bypass the obstacle.</p>
<p>If the collision is too close to the AGV, driving around obstacles is not allowed. See parameters</p>
<table><thead><tr><th>Parameters</th></tr></thead><tbody>
<tr><td>obst_free_zone_left</td></tr>
<tr><td>obst_free_zone_right</td></tr>
<tr><td>obst_free_zone_front</td></tr>
<tr><td>obst_free_zone_rear</td></tr>
<tr><td>obst_bypass_trajectory_max_angle_deg</td></tr>
</tbody></table>
<p>Additionally, if the collision is at the very end of the drive order, there might not be enough space to place the whole bypass route before its end.
If the obstacle is moving, the AGV has to stop and wait until the obstacle stops.
If the obstacle is close enough to trigger the safety zones, driving around the obstacle is impossible.</p>
<h3 id="there-is-an-obstacle-on-the-route-but-obstacles-are-not-detected"><a class="header" href="#there-is-an-obstacle-on-the-route-but-obstacles-are-not-detected">There is an obstacle on the route, but obstacles are not detected</a></h3>
<p>Look if the obstacle is seen by the scanners in monitor. Make sure that the measurements seem as red or green dots for localization scanners, or orange or pink ones for measurement scanners. Grey dots mean that the points are &quot;not ok&quot; and thus not used for obstacle detection. If there are no points in monitor where the obstacle should be or if the points are grey, obstacle avoidance has no means to detect these obstacles.</p>
<p>Please note that if the <strong>obst_use_zones</strong> parameter is set to 2 only the scanner points from within the obstacle avoidance zones are used for obstacle detection.</p>
<p>See the values of</p>
<table><thead><tr><th>Parameters</th></tr></thead><tbody>
<tr><td>obst_detect_obstacles_dist</td></tr>
<tr><td>obst_detect_min_scan_points</td></tr>
</tbody></table>
<p>and see the documentation of these parameters below in the Appendix. If the obstacles are not visible as scanner points in monitor, obstacle avoidance may not sense those points either.</p>
<p>If the obstacles are visible, most likely there are not enough scanner points to count the points as an obstacle as per the parameter values.
See the parameter <strong>obst_detect_min_scan_points</strong>.</p>
<h3 id="there-are-not-any-obstacles-on-the-route-but-obstacles-are-detected"><a class="header" href="#there-are-not-any-obstacles-on-the-route-but-obstacles-are-detected">There are not any obstacles on the route, but obstacles are detected</a></h3>
<p>This is known as false positive detected obstacles. This may result from safety scanner noise or too sensitive obstacle detection.</p>
<p>Increase the value of <strong>obst_detect_min_scan_points</strong> to make sure that a small number of scan points does not trigger obstacle avoidance.</p>
<h3 id="it-seems-there-is-enough-space-to-bypass-the-obstacle-but-the-algorithm-will-not-begin-bypass"><a class="header" href="#it-seems-there-is-enough-space-to-bypass-the-obstacle-but-the-algorithm-will-not-begin-bypass">It seems there is enough space to bypass the obstacle, but the algorithm will not begin bypass</a></h3>
<p>See the parameters</p>
<table><thead><tr><th>Parameters</th></tr></thead><tbody>
<tr><td>obst_free_zone_left</td></tr>
<tr><td>obst_free_zone_right</td></tr>
<tr><td>obst_free_zone_front</td></tr>
<tr><td>obst_free_zone_rear</td></tr>
</tbody></table>
<p>Also see if the bypass happens too close to obstacle avoidance zone boundaries. The bypass route must be inside one and only one such zone.</p>
<p>Note that 2D safety scanners sense the 3D environment at only one height and angle. Thus, some obstacles may seem smaller or larger than they really are.</p>
<h2 id="appendix-list-of-parameters"><a class="header" href="#appendix-list-of-parameters">Appendix: List of parameters</a></h2>
<table><thead><tr><th>Type</th><th>Name</th><th>Minimum value</th><th>Default value</th><th>Maximum value</th><th>Information</th></tr></thead><tbody>
<tr><td>int</td><td>obst_av_mode</td><td>0</td><td>0</td><td>2</td><td>0 = disabled 1 = only detect obstacles 2 = detect and drive around the obstacles</td></tr>
<tr><td>float</td><td>obst_free_zone_left</td><td>0</td><td>0.25</td><td>2.0</td><td>The margin (m) at AGV left dimension that has to be free of obstacles</td></tr>
<tr><td>float</td><td>obst_free_zone_right</td><td>0</td><td>0.25</td><td>2.0</td><td>The margin (m) at AGV fright dimensions that has to be free of obstacles</td></tr>
<tr><td>float</td><td>obst_free_zone_front</td><td>0</td><td>0.25</td><td>2.0</td><td>The margin (m) at AGV front dimension that has to be free of obstacles</td></tr>
<tr><td>float</td><td>obst_free_zone_rear</td><td>0</td><td>0.25</td><td>2.0</td><td>The margin (m) at AGV rear dimension that has to be free of obstacles</td></tr>
<tr><td>float</td><td>obst_distance_to_begin_planning</td><td>0.05</td><td>8.0</td><td>40.0</td><td>Distance (m) along the trajectory from AGV to obstacle to begin planning the bypass</td></tr>
<tr><td>float</td><td>obst_bypass_velocity</td><td>0.01</td><td>0.3</td><td>3.0</td><td>Maximum velocity (m/s) during the obstacle bypass when out of nominal route</td></tr>
<tr><td>float</td><td>obst_detect_obstacles_dist</td><td>1.0</td><td>9.0</td><td>20.0</td><td>Maximum distance (m) from which obstacles are polled along the trajectory</td></tr>
<tr><td>float</td><td>obst_moving_det_treshold</td><td>0.01</td><td>0.5</td><td>10.0</td><td>Minimum obstacle velocity (m/s) to count it as moving</td></tr>
<tr><td>int</td><td>obst_detect_min_scan_points</td><td>1</td><td>4</td><td>30</td><td>Amount of colliding scan points required to start obstacle avoidance</td></tr>
<tr><td>int</td><td>obst_moving_wait_time_ms</td><td>10</td><td>4000</td><td>10000</td><td>Number of milliseconds to wait if obstacle moves before replanning</td></tr>
<tr><td>int</td><td>obst_return_wait_time_s</td><td>5</td><td>10</td><td>900</td><td>Number of seconds to try replanning before aborting and returning to nominal route</td></tr>
<tr><td>int</td><td>obst_replan_wait_time_ms</td><td>10</td><td>2000</td><td>10000</td><td>Amount of milliseconds to wait between consecutive replans</td></tr>
<tr><td>int</td><td>obst_send_fleet_every_nth_point</td><td>1</td><td>1</td><td>20</td><td>When sending obstacle bypass trajectory to fleet control, send every nth point to send less data</td></tr>
<tr><td>int</td><td>obst_wait_time_for_answer_s</td><td>1</td><td>10</td><td>60</td><td>Maximum time (s) for waiting an answer from the fleet control. After that obstacle avoidance status will be reset</td></tr>
<tr><td>float</td><td>obst_bypass_edge_safety_addition</td><td>0.0</td><td>0.25</td><td>5.0</td><td>Additional free space between obstacle and AGV during bypass for the trajectory</td></tr>
<tr><td>float</td><td>obst_bypass_trajectory_max_angle_deg</td><td>0.0</td><td>45.0</td><td>90.0</td><td>Maximum angle (deg) that the AGV may turn when bypassing</td></tr>
<tr><td>Int</td><td>obst_detection_scanners</td><td>0</td><td>3</td><td>3</td><td>Defines which localization scanners are used for obstacle detection:<br>0 = none<br>1 = rear scanner only<br>2 = front scanner only<br>3 = both scanners</td></tr>
<tr><td>Int</td><td>obst_detection_meas_scanners</td><td>0</td><td>0</td><td>3</td><td>Defines which measurement scanners are used for obstacle detection:<br>0 = none<br>1 = first scanner only<br>2 = second scanner only<br>3 = both scanners</td></tr>
<tr><td>Int</td><td>obst_use_zones</td><td>0</td><td>1</td><td>2</td><td>1 = Only bypass in obstacle avoidance zones defined in tools<br>2 = Detect and bypass obstacles only inside zones</td></tr>
<tr><td>Int</td><td>obst_detect_moving</td><td>0</td><td>1</td><td>1</td><td>Detect if obstacles are moving.<br>0 = disabled<br>1 = enabled</td></tr>
<tr><td>Int</td><td>obst_omni_constant_frame_heading</td><td>0</td><td>1</td><td>1</td><td>For omni machine type, use constant frame heading when driving around the obstacle</td></tr>
<tr><td>Int</td><td>obst_drive_near_close_obstacle</td><td>0</td><td>0</td><td>1</td><td>Whether to keep going when an obstacle is too close but not clashing directly with agv frame.<br>0 = stop<br>1 = keep going</td></tr>
<tr><td>float</td><td>obst_close_obstacle_safety_zone</td><td>0.00</td><td>0.05</td><td>5.00</td><td>Distance around the agv in meters that is used to check close obstacles when obst_drive_near_close_obstacle is set to 1</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="obstacle-avoidance-v2"><a class="header" href="#obstacle-avoidance-v2">Obstacle avoidance V2</a></h1>
<p>Updated 19.08.2024</p>
<h2 id="overview-31"><a class="header" href="#overview-31">Overview</a></h2>
<h3 id="introduction-39"><a class="header" href="#introduction-39">Introduction</a></h3>
<p>Obstacle avoidance V2 is a feature which allows the AGV to detect obstacles and create bypass routes around them. The obstacle detection is performed using measurements from 2D laser scanners.
When an obstacle has been detected, the bypass route is planned based on the measurements from the obstacle detection scanners, borders of obstacle avoidance zones and taught environment, so that the AGV does not collide with any of them.</p>
<p>Obstacle avoidance can be helpful in production environments having dynamic objects, such as parked trucks, momentarily blocking the routes defined for the AGVs. In such case, AGV can bypass the obstacle instead of stopping and waiting it to be cleared.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/overviewCaseScaled.png" alt="" /></p>
<blockquote>
<p>An AGV having a drive order going trough the yellow wooden obstacles blocking the route drawn in blue</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/overviewMonitor.png" alt="" /></p>
<blockquote>
<p>The violet bypass route that has been generated around the detected obstacles from the image above. <br/> The obstacle avoidance zone is rendered in light blue. Bypass routes are by default limited to be generated only within these areas.</p>
</blockquote>
<p><strong>Typical use case</strong>
In a typical use case the AGV drives on a route in an area where obstacle avoidance is allowed. These areas are called obstacle avoidance zones. A box has been left farther away partly blocking the nominal route. When AGV approaches the box, obstacle detection sensors gets measurements from it and obstacle detection feature detects the approaching collision. At this point, AGV will slow down and continue driving closer. If the collision is still detected when the AGV arrives within a few meters from it, a bypass route around the obstacle is created starting from and ending to the original route.* If a new obstacle is detected on the bypass route, the AGV will replan the route to bypass it as well. When the AGV has successfully bypassed the obstacle(s), it will continue driving to the original destination.</p>
<p>* When Navithor fleet control is used, Navitrol will wait for Navithor's bypass permission before starting a bypass to make sure that the bypass route does not collide with other AGVs in the fleet.</p>
<p>Obstacle avoidance V2 utilizes the Navigation2 package of ROS2 (Robot Operating System).</p>
<p>The Obstacle avoidance V2 feature is an improved solution compared to the <a href="DriveControl/ObstacleAvoidanceV2/../ObstacleAvoidance/ObstacleAvoidance-en.html">original obstacle avoidance feature</a>. The ROS version is capable of creating more advanced collision free routes in tighter spaces while also supporting curved route sections, as seen in the example image above. It is strongly recommended to use this new feature instead of the original one.</p>
<h3 id="requirements-18"><a class="header" href="#requirements-18">Requirements</a></h3>
<ul>
<li>Obstacle avoidance license</li>
<li>Position controlled AGV (e.g., position only is not supported)
<ul>
<li>All kinematic types are supported</li>
</ul>
</li>
<li>Docker Engine &amp; Docker Compose to be installed
<ul>
<li>The installation requires internet connection</li>
</ul>
</li>
<li>10GB of free hard disk space
<ul>
<li>5GB for the Obstacle avoidance V2 base Docker image</li>
<li>5GB or more for storing (binary) logs</li>
</ul>
</li>
<li>At least 1 2D scanner (connected either to Navitrol or ROS)
<ul>
<li>Up to maximum of 4 Navitrol scanners and 4 ROS scanners</li>
<li>Scanner(s) must be installed so that they have line of sight to any possible obstacles that shall be avoided</li>
<li>Navitrol's navigation scanners can be simultaneously used for positioning and obstacle avoidance</li>
</ul>
</li>
<li>Environment with sufficient space for bypassing obstacles</li>
<li>An IPC powerful enough to run ROS at the same time with Navitrol
<ul>
<li>For example VBOX-3121-i3</li>
</ul>
</li>
</ul>
<h3 id="limitations-15"><a class="header" href="#limitations-15">Limitations</a></h3>
<p>The obstacle avoidance does not currently support</p>
<ul>
<li>Bypass routes starting with a direction change (e.g. current driving direction is completely blocked)</li>
<li>Bypass routes starting from or ending in a route sections with a defined frame heading</li>
<li>Defining a preferred bypass side (left / right) with respect to the obstacle</li>
<li>Parameter change on-the-fly
<ul>
<li>When updating parameters, ROS Docker container must be manually restarted for the changes to take effect</li>
</ul>
</li>
<li>Returning early to the nominal route in case the bypassed obstacle would disappear</li>
<li>Multilevel production areas</li>
</ul>
<p>The feature is not fully optimized with</p>
<ul>
<li>Extremely large production environments
<ul>
<li>Recommend maximum size is 40 000 square meters (200m x 200m), which is suitable for e.g. VBOX-3121-i3 IPC hardware</li>
<li>Production areas up to 250 000 square meter (500m x 500m) require at least 8 GB of memory</li>
<li>Production areas up to maximum 1 000 000 square meter (1km x 1km) require at least 16 GB of memory</li>
</ul>
</li>
<li>Moving obstacles</li>
<li>Noisy sensor data</li>
<li>Obstacles entering the very edge of the collision zone of the AGV</li>
<li>Other fleet control types than Navithor (with standard communication)
<ul>
<li>With other fleet control types (e.g. VDA), the feature behaves like there is no fleet control enabled</li>
</ul>
</li>
</ul>
<p>The consequences in forementioned cases might cause</p>
<ul>
<li>Bypass route planning to be triggered too easily, too early or too late</li>
<li>Unnecessarily long or complex bypass trajectories</li>
<li>Being unable to bypass the obstacle</li>
</ul>
<p>Obstacle avoidance V2 is incompatible with following features</p>
<ul>
<li>Original obstacle avoidance</li>
<li>Wall monitor</li>
</ul>
<p>Additionally, Obstacle avoidance V2 Docker container must be run on the same computer as the Navitrol software is running.</p>
<h3 id="dependencies-11"><a class="header" href="#dependencies-11">Dependencies</a></h3>
<ul>
<li>Navithor or <a href="DriveControl/ObstacleAvoidanceV2/../Standalone/Standalone-en.html">Standalone</a> system</li>
<li><a href="https://docs.docker.com/engine/install/debian/">Docker Engine &amp; Compose</a></li>
<li>ROS interface</li>
</ul>
<hr />
<h2 id="set-up-8"><a class="header" href="#set-up-8">Set up</a></h2>
<h3 id="quick-start-11"><a class="header" href="#quick-start-11">Quick start</a></h3>
<ol>
<li><a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#docker-engine-and-docker-compose-installation">Install Docker Engine and Docker Compose</a></li>
<li><a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#ros2-navigation2-installation">Install ROS2 Navigation2 libraries</a></li>
<li><a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#obstacle-avoidance-v2-docker-layer-installation">Install Obstacle avoidance V2 Docker layer</a></li>
<li><a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#set-ros-to-start-automatically-on-boot">Set ROS to start automatically on boot</a></li>
<li><a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#obstacle-avoidance-zones">Define obstacle avoidance zones</a></li>
<li>Set <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#required-parameters">required parameters</a></li>
<li>Reboot the IPC to launch Navitrol and ROS</li>
</ol>
<p>Note: When any changes to parameter, environment or segment file is made, <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#launching-obstacle-avoidance-v2">restart ROS Docker container</a>. Otherwise the changes won't be effective for ROS.</p>
<h3 id="docker-engine-and-docker-compose-installation"><a class="header" href="#docker-engine-and-docker-compose-installation">Docker Engine and Docker Compose installation</a></h3>
<p>Docker installations are required only on systems that do not have them already. For example, Navitec's official Bullseye Linux image has them preinstalled.</p>
<p><strong>Checking the installation</strong></p>
<p>To check, whether Docker Engine &amp; Docker Compose are installed, use commands</p>
<pre><code>docker --version
docker compose --version
</code></pre>
<p><strong>Note</strong>: Older versions of Docker require the command <code>docker compose</code> to be written as <code>docker-compose</code>.</p>
<p>If they are installed the command output should be similar to:</p>
<pre><code>Docker version &lt;version&gt;, build &lt;version&gt;
docker compose version &lt;version&gt;, build &lt;version&gt;
</code></pre>
<p>If they are not installed the output looks similar to:</p>
<pre><code>Command 'docker' not found
</code></pre>
<p>If they are installed, you can skip the &quot;Installing Docker Engine and Docker Compose&quot; instructions below and move to <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#ros2-navigation2-installation">ROS2 Navigation2 installation</a>.</p>
<p><strong>Installing Docker Engine and Docker Compose</strong></p>
<p>Instructions on how Docker Engine and Docker Compose can be installed following the &quot;Set up the repository&quot; &amp; &quot;Install Docker Engine&quot; sections from <a href="https://docs.docker.com/engine/install/debian/#set-up-the-repository">https://docs.docker.com/engine/install/debian/#set-up-the-repository</a></p>
<p>Internet connection is highly recommended for the installation. Alternatively, an offline Debian package can be used, but managing the dependencies might require some effort.</p>
<h3 id="ros2-navigation2-installation"><a class="header" href="#ros2-navigation2-installation">ROS2 Navigation2 installation</a></h3>
<p>After Docker has been installed, deploy the Docker base image provided by Navitec for ROS2 Humble distribution &amp; ROS2 Navigation2 package:</p>
<ol>
<li>Transfer <code>ros2_navigation2_humble.tar.gz</code> Docker image to Navigation IPC (into any directory)</li>
<li>In that directory, run command <code>docker load -i ros2_navigation2_humble.tar.gz</code></li>
<li>Optionally, after successful installation, the <code>ros2_navigation2_humble.tar.gz</code> file can be removed from the IPC to free around 1GB of disk space</li>
</ol>
<p>To verify ROS2 Navigation2 Docker base image being installed successfully, run command <code>docker images</code>. The following line should exist in the output:</p>
<pre><code>  REPOSITORY                       TAG                     IMAGE ID            CREATED                   SIZE
  ros2_navigation2                 humble                  &lt;image-id&gt;          &lt;time-of-installation&gt;    &lt;image-size&gt;
</code></pre>
<p>This step is required to be performed only once (until a new Docker base image is provided by Navitec). There is <strong>no need</strong> to reinstall the ROS2 Navigation2 Docker base image everytime again when a new Navitrol Debian package is installed, as described in the <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#obstacle-avoidance-v2-docker-layer-installation">next step</a> below.</p>
<h3 id="obstacle-avoidance-v2-docker-layer-installation"><a class="header" href="#obstacle-avoidance-v2-docker-layer-installation">Obstacle avoidance V2 Docker layer installation</a></h3>
<p><strong>If the ROS2 Navigation2 Docker base image is successfully installed</strong> as described in the <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#ros2-navigation2-installation">previous step</a>, the Obstacle avoidance V2 Docker layer is installed automatically by the Debian installer package <code>Navitrol_&lt;version&gt;.deb</code>. The Navitrol Debian package is installed by running command</p>
<pre><code>  dpkg -i Navitrol_&lt;version&gt;.deb
</code></pre>
<p>This will install</p>
<ul>
<li>Navitrol software</li>
<li>Obstacle avoidance V2 Docker layer <code>nav_sw_ros_obstacle_avoidance</code></li>
<li><code>ros_config/</code> directory</li>
</ul>
<p>To verify Obstacle avoidance V2 Docker layer being installed successfully, run command <code>docker images</code>. The following line should exist in the output:</p>
<pre><code>  REPOSITORY                       TAG                     IMAGE ID            CREATED                   SIZE
  nav_sw_ros_obstacle_avoidance    latest                  &lt;image-id&gt;          &lt;time-of-installation&gt;    &lt;image-size&gt;
</code></pre>
<p><strong>Note:</strong> After the <code>Navitrol_&lt;version&gt;.deb</code> package is installed, the script <code>startNavitrol.sh</code> is run automatically, which starts the Navitrol software. See the <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#set-ros-to-start-automatically-on-boot">next step</a> below to configure Obstacle avoidance V2 to be launched also automatically along the start up of Navitrol/IPC.</p>
<h3 id="set-ros-to-start-automatically-on-boot"><a class="header" href="#set-ros-to-start-automatically-on-boot">Set ROS to start automatically on boot</a></h3>
<p>To launch Obstacle avoidance V2 automatically when the IPC is booted, the <code>startNavitrol.sh</code> script located in <code>/home/navitec/</code> folder must be modified. Add the following line at the end of the <code>startNavitrol.sh</code> file:</p>
<pre><code>$AGV_INSTALL_PATH/ros_config/scripts/startRos.sh
</code></pre>
<h3 id="obstacle-avoidance-zones-1"><a class="header" href="#obstacle-avoidance-zones-1">Obstacle avoidance zones</a></h3>
<p>Obstacle avoidance is by default limited to be allowed only inside obstacle avoidance zones, which are defined in Tools.
By default, obstacle avoidance (= bypass trajectory generation) is active only inside the zones, whereas obstacle detection (= stopping the AGV before obstacle) is active both inside and outside the zones.</p>
<ul>
<li>Check parameter <code>ros_obst_av_zone_mode</code> for further configuration</li>
</ul>
<p>The obstacle avoidance zones must have sufficient space to bypass obstacles while considering also the safety zones around the AGV.</p>
<p>Following instructions assume that environment and routes are already defined.</p>
<p><strong>Adding obstacle avoidance zones:</strong></p>
<ol>
<li>Select obstacle avoidance zone tool
<ul>
<li>From the left side menu, select <strong>Zones</strong> -&gt; <strong>Zones</strong> -&gt; <strong>Zone type</strong> -&gt; <strong>ObstacleAvoidanceZone</strong></li>
</ul>
</li>
<li>Draw desired zone(s)</li>
<li>Upload the environment to Navitrol/Navithor from <strong>Export | Upload</strong> menu</li>
</ol>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/complexBypassTools2.png" alt="" />
&gt;Obstacle avoidance zone defined in an example Tools project around a simple route <br/> <strong>Note:</strong> The circles of static environment are added to represent obstacles. In reality, the locations of the obstacles are not known and the routes should never be drawn through known static environment.</p>
<p><strong>Important notes:</strong></p>
<ul>
<li>&quot;Zone options&quot; are not effective
<ul>
<li>The &quot;zone options&quot; seen in the bottom left corner of the image above are relics related to the original obstacle avoidance feature.</li>
<li>For example, setting a priority for bypassing direction is not possible. However, it is possible to limit the bypass direction by defining the zones so that there is room to bypass only from one side.</li>
</ul>
</li>
<li>Route sections with defined frame heading are not supported. They can exist inside obstacle avoidance zones but bypass routes starting from or ending in those sections are discarded, possibly preventing a bypass.</li>
</ul>
<h3 id="required-parameters"><a class="header" href="#required-parameters">Required parameters</a></h3>
<p>These are the minimum parameters that must be set in <code>params.txt</code> file to enable and use the feature.</p>
<ul>
<li><strong>Note:</strong> Use of <code>params_override.txt</code> file is <strong>not</strong> supported at the moment</li>
</ul>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_enabled</td><td>Int</td><td>1</td><td>Enable ROS communication (min: 0, max: 1)</td></tr>
<tr><td>ros_obst_av_mode</td><td>Int</td><td>1</td><td>Enable Obstacle avoidance V2 feature (min: 0, max: 1)</td></tr>
<tr><td>ros_send_scan_data</td><td>Int</td><td>non zero</td><td>A bitmap value defining which scanners are used for ROS obstacle detection. Navitrol sends scanner data from the selected scanners to ROS <br/>The value is bitmapped, which means that e.g. sending rear &amp; front scanner data corresponds to value 3 in decimal, which is 0011 in binary<br/>- Bit 0: Rear<br/>- Bit 1: Front<br/>- Bit 2: Measurement 0<br/>- Bit 3: Measurement 1 <br/>(min: 0, max: 15)<br>See <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#navitrol-scanners-to-select-for-obstacle-detection">Appendix</a> section for full table of the possible combinations</td></tr>
</tbody></table>
<p><strong>Other parameters to check:</strong></p>
<ul>
<li>If the AGV has limited curvature (for example due to steer wheel angle limitations), <code>ros_obst_av_min_turning_radius</code> should be tuned accordingly.</li>
<li>If obstacle detection (and avoidance) should be active only inside obstacle avoidance zones, set <code>ros_obst_av_zone_mode</code> to 2.</li>
<li>If obstacle avoidance is desired to be used without obstacle avoidance zones (or outside them), set <code>ros_obst_av_zone_mode</code> to 0.</li>
</ul>
<h3 id="fine-tuning-8"><a class="header" href="#fine-tuning-8">Fine tuning</a></h3>
<p>In addition to the required parameters there are several ways to fine tune the behavior of the obstacle avoidance feature. However, before fine tuning, it is recommend to test the feature first with only the required parameters.</p>
<p>Note: If a parameter is not defined in the <code>params.txt</code>, its default value will be in use.</p>
<h4 id="obstacle-detection"><a class="header" href="#obstacle-detection">Obstacle detection</a></h4>
<p>Obstacle detection is a sub-feature responsible for detecting upcoming collisions on a driven route. An obstacle is detected when the algorithm detects one or more sensor measurements that would collide with the AGVs collision frame, if the AGV would keep driving the current route. Note that taught environment is not detected as an obstacle, unless sensor measurements are received from it.</p>
<p>The collision frame is an obstacle free zone around the AGV, i.e. an extra safety area in addition to the AGV dimensions. Anything inside this frame is considered to collide with the AGV for purposes of obstacle detection.</p>
<p>Smaller collision frame allows bypassing in tighter spaces while larger frame leaves more room between the AGV and an obstacle while bypassing.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/agvDimensions.png" alt="" /></p>
<blockquote>
<p>Collision frame and the parameters to define it</p>
</blockquote>
<p>Note, that <strong>dim_front</strong> &amp; <strong>dim_left</strong> are positive values, and <strong>dim_rear</strong> &amp; <strong>dim_right</strong> are negative values, whereas all the <strong>ros_obst_free_zone_</strong> values are positive.</p>
<p><strong>Collision frame parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_obst_free_zone_front</td><td>Float</td><td>0.1</td><td>Extra safety area around the AGV added to the <strong>dim_front</strong> value used for obstacle detection and bypass route planning [m] (min: 0.0, max: 2.0)</td></tr>
<tr><td>ros_obst_free_zone_rear</td><td>Float</td><td>0.1</td><td>Extra safety area around the AGV added to the <strong>dim_rear</strong> value used for obstacle detection and bypass route planning [m] (min: 0.0, max: 2.0)</td></tr>
<tr><td>ros_obst_free_zone_left</td><td>Float</td><td>0.1</td><td>Extra safety area around the AGV added to the <strong>dim_left</strong> value used for obstacle detection and bypass route planning [m] (min: 0.0, max: 2.0)</td></tr>
<tr><td>ros_obst_free_zone_right</td><td>Float</td><td>0.1</td><td>Extra safety area around the AGV added to the <strong>dim_right</strong> value used for obstacle detection and bypass route planning [m] (min: 0.0, max: 2.0)</td></tr>
</tbody></table>
<p>Unlike obstacle avoidance, by default the obstacle detection is always active, even when driving outside of the defined obstacle avoidance zones. In addition, it is important to note that obstacle detection only works for automatic drive orders and not for manual driving.</p>
<p>Once a collision is detected on the current route the AGV is following, the collision frame will be visualized in Navitrol Monitor. See the image below.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/complexBypass1.png" alt="" /></p>
<blockquote>
<p>Monitor view of an detected obstacle that is blocking the current path (violet). The detected collision point is rendered as yellow circle and the collision frame as orange box around it.</p>
</blockquote>
<p><strong>Obstacle detection parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_obst_av_zone_mode</td><td>Int</td><td>1</td><td>Defines how obstacle avoidance zones affect obstacle avoidance and detection. <br/>- 0: Obstacles are detected and avoided everywhere.<br/>- 1: Obstacles are always detected but avoided only within the zones.<br/>- 2: Obstacles are detected and avoided only within the zones.<br/>Note:<br/>- Mode 0 does not allow bypass routes to go through obstacle avoidance zone edges. The bypass routes are generated either fully inside or outside the zones.<br/>- AGV is considered to be within a zone when it's navigation point is inside it. In practice, this means that with mode 2 obstacles will not be detected before the AGV enters the zone, even if the obstacle itself would be inside the zone.<br/>- In mode 2, if AGV's navigation point is inside the zone, obstacles outside the zones are detected, if AGV's collision frame would collide with them.</td></tr>
<tr><td>ros_obst_det_dist</td><td>Int</td><td>10</td><td>How far ahead to check for collisions along the active route [m]. This does not affect the bypass route planning (min: 1, max: 20)</td></tr>
<tr><td>ros_obst_det_slow_dist</td><td>Float</td><td>5.0</td><td>How much before a detected collision the AGV will start slowing down to speed defined by parameter <strong>pc_soft_slow_wheel_speed</strong> [m] (min: 0.1, max: 100.0)<br/>Greater values cause the AGV to drive slower for longer distance before an obstacle, thus giving more time for the obstacle to disappear from the route.<br/>Lower values might cause the AGV to overshoot the start of the bypass route</td></tr>
<tr><td>ros_obst_det_stop_dist</td><td>Float</td><td>2.0</td><td>How much before a detected collision the AGV will stop [m] (min: 0.1, max: 25.0)<br/>Small values might lead the AGV to stop too close to the obstacle, which will reduce the chance of finding a bypass route around it<br/>Greater values might require the obstacle avoidance zones to be extended from the entry side, otherwise the AGV might stop before being completely inside the zone, causing bypass route planning to fail<br/>The value <strong>must be</strong> smaller than <strong>ros_obst_av_bypass_planning_dist</strong></td></tr>
<tr><td>ros_obst_det_max_scan_dist</td><td>Float</td><td>0.0</td><td>Maximum scanner range measurement to consider for obstacle detection [m] (min: 0.0, max: 40.0)<br/> - 0.0: Use value <code>ros_obst_det_dist</code> for collision detection and <code>ros_obst_av_max_plan_dist</code> for bypass route planning</td></tr>
</tbody></table>
<h4 id="bypass-route-calculation"><a class="header" href="#bypass-route-calculation">Bypass route calculation</a></h4>
<p>Bypass route calculation is the part of obstacle avoidance feature responsible for generating the bypass routes around the obstacles.</p>
<p>The bypass route calculation uses a larger <em>planning frame</em> instead of the <em>collision frame</em> for checking if planned bypass routes would collide with the static environment, the current sensor measurements or obstacle avoidance zone borders. This helps the AGV to avoid driving too close to the obstacles at its sides, as a bypass route will be calculated a bit further away from obstacles than the collision frame would require.</p>
<p>The planning frame is defined by multiplying each of the collision frame's dimension with the value of <strong>ros_obst_free_zone_gain_for_planning</strong> parameter as seen in the figure below.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/planningFrame.png" alt="" /></p>
<blockquote>
<p>Planning frame and the parameter to define its size visualized</p>
</blockquote>
<p><strong>Basics of the bypass route calculation:</strong></p>
<p>The bypass route calculation is based on five key points in relation to the navigation point of the agv:</p>
<ol>
<li><em>The first collision point</em> is the first point along the route where the planning frame would collide with the detected obstacle(s).</li>
<li><em>The last collision point</em> is the last point along the route where the planning frame would collide with the detected obstacle(s).</li>
<li><em>Bypass route planning point</em> is the point from where the bypass route calculation starts. In other words, when the AGV reaches this point, the feature tries to calculate a bypass. If a collision free route is found, the AGV will proceed to bypass the obstacle along it. The planning point is always located at <strong>ros_obst_av_bypass_planning_dist</strong> before the first collision point.</li>
<li><em>Bypass route diverge point</em> is the point from where the bypass route will diverge from the current route. It is located <strong>ros_obst_av_bypass_start_dist</strong> distance from the first collision point. Note that the distance can be smaller, if the AGV is already closer than <strong>ros_obst_av_min_diverge_dist</strong> from the planned diverge point.</li>
<li><em>Bypass route merging point</em> is the point where the bypass route will merge back to the nominal route. It is located <strong>ros_obst_av_bypass_end_dist</strong> ahead from the last collision point of a particular obstacle, but is moved further away in steps of <strong>ros_obst_av_plan_step_dist</strong> in case the merge point is not reachable. See more info a bit below in <strong>Active bypass route planning</strong>
<ol>
<li><strong>Note:</strong> Merge point is always set to the nominal route. In case of an obstacle appearing on currently driven bypass trajectory, the first possible merge point will be set <strong>ros_obst_av_bypass_start_dist</strong> + <strong>ros_obst_av_bypass_end_dist</strong> ahead from bypass route's diverge point projected to the nominal route (in case of no obstacles, otherwise further)</li>
</ol>
</li>
</ol>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/bypassPlanningSimple.png" alt="" /></p>
<blockquote>
<p>Bypass route calculation key points and parameters visualized:<br/>- The <em>first collision point</em> is defined by the navigation point location on the route where the red planning frame would collide with the detected obstacle<br/>- The <em>bypass route planning point</em> is located <strong>ros_obst_av_bypass_planning_dist</strong> from the first collision point. (Gray AGV)<br/>- The <em>bypass route diverge point</em> is located <strong>ros_obst_av_bypass_start_dist</strong> from the first collision point. (AGV silhouette on the left)<br/>- The <em>bypass route merging point</em> is located <strong>ros_obst_av_bypass_end_dist</strong> from last collision point (AGV silhouette on the right)</p>
</blockquote>
<p>In case of many obstacles, the merging point can be calculated between two obstacles, if the distance between two collision points is greater than the sum of the diverge and merging distances (<strong>ros_obst_av_bypass_start_dist</strong> + <strong>ros_obst_av_bypass_end_dist</strong>) as shown in the image below:</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/bypassPlanningComplex.png" alt="" /></p>
<blockquote>
<p>The bypass route diverging before Obstacle 1 is calculated to merge between Obstacles 2 &amp; 3, as the available space between these obstacles is greater than the sum of the diverge and merging distances. In turn, the space between the Obstacles 1 &amp; 2 is not sufficient, meaning that the bypass route won't be merged there.</p>
</blockquote>
<p><strong>Active bypass route planning</strong></p>
<p>When bypass route planning is active, this is indicated (in Navitrol Monitor) by</p>
<ul>
<li>Warning <code>WARNING_BYPASS_ROUTE_PLANNING_ACTIVE</code></li>
<li>Green control points on the trajectory</li>
</ul>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/bypassControlPointsPlanning.png" alt="" /></p>
<blockquote>
<p>Bypass route over the obstacle is being calculated. The first green control point (closer to the AGV) indicates, from which point on the nominal route the bypass route is attempted to be diverged. The second green control point (behind the obstacle) indicates, to which point on the nominal route the bypass route is attempted to be merged. In this case, a valid bypass route will not be found (as there is not enough room for the AGV to squeeze through the small gap).</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/bypassControlPointsPlanned.png" alt="" /></p>
<blockquote>
<p>If a valid bypass route can not be found for an attempted merge point (1.), a new merge point candidate (2.) will be taken further ahead by a distance defined with parameter <code>ros_obst_av_plan_step_dist</code>. This is repeated (3. &amp; 4.) until a valid bypass route is found (4.). If the distance between AGV's navigation point and the merge point candidate exceeds the limit defined with parameter <code>ros_obst_av_max_plan_dist</code>, the iteration starts again from the first merge point candidate (1.).</p>
</blockquote>
<blockquote>
<p>Note: If parameter <code>ros_obst_av_max_plan_dist_prioritized</code> is set (value 1), the iteration order is reversed to start/go from point (4.) towards point (1.).</p>
</blockquote>
<p><strong>Effect of obstacle avoidance zones to bypass route calculation</strong></p>
<p>The bypass route calculation is started when the navigation point of the AGV enters the zone, see <em>bypass route planning point</em>. However, It is important to note, that the <ins>borders of the obstacle avoidance zones are considered as obstacles</ins> when calculating bypass trajectories. This means, that the planning frame must be <ins>completely</ins> inside the zone before bypassing an obstacle is possible.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/bypassPlanningZoneEdge.png" alt="" /></p>
<blockquote>
<p>Bypass route calculation near the obstacle avoidance zone borders: <br/>- Green circle: AGV navigation point is inside the obstacle zone, so the bypass route planning is activated when withing the <em>bypass planning point</em> distance from the obstacle.<br/>- Red circle: Finding any valid bypass trajectories will fail, as the AGV won't fit completely inside the obstacle avoidance zone after the obstacle. Reducing the parameter <strong>ros_obst_av_bypass_end_dist</strong>, or increasing the obstacle avoidance zone could help in this case.<br/></p>
</blockquote>
<p>Known issue: Before end of the zone there has to be available space at least the sum of the parameter values <strong>ros_obst_av_bypass_end_dist</strong> &amp; <strong>ros_obst_av_bypass_start_dist</strong> even if only <strong>ros_obst_av_bypass_end_dist</strong> would be required in practice. See the image below.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/bypassPlanningZoneEnd.png" alt="" /></p>
<blockquote>
<p>Returning to route just before end of obstacle avoidance zone requires at least <strong>ros_obst_av_bypass_end_dist</strong> &amp; <strong>ros_obst_av_bypass_start_dist</strong> of free space.</p>
</blockquote>
<p><strong>Bypass route calculation parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_obst_av_min_turning_radius</td><td>Float</td><td>0.4</td><td>Minimum turning radius for the bypass routes [m] (min: 0.05, max: 10.0)<br/>Smaller values allow more tight turns during the bypass while larger values make the bypass routes smoother. Should not exceed the capabilities of a steer angle limited AGVs</td></tr>
<tr><td>ros_obst_av_bypass_planning_dist</td><td>Float</td><td>3.0</td><td>How much before a <em>first collision point</em> to start planning for a new bypass route [m]. See <em>Bypass route planning point</em> (min: 0.0, max: 10.0)<br/>Larger values can cause unnecessary bypass routes to be calculated for moving obstacles<br/>Smaller values might lead the AGV to drive too close to the obstacle, which will reduce the chances of finding a bypass route<br/>The value <ins>must be</ins> greater than <strong>ros_obst_av_bypass_start_dist</strong> and <strong>ros_obst_det_stop_dist</strong></td></tr>
<tr><td>ros_obst_av_bypass_start_dist</td><td>Float</td><td>1.0</td><td>Defines how much before the <em>first collision point</em> to diverge the bypass route from nominal route [m] See <em>Bypass route diverge point</em> (min: 0.0, max: 10.0)<br/>Larger values usually result in smoother start connections but can reduce the chance of finding bypass routes at the end of the obstacle avoidance zone<br/>Smaller values reduce the chance of finding bypass routes especially if <strong>ros_obst_av_min_turning_radius</strong> is large<br/>The value <ins>must be</ins> smaller than <strong>ros_obst_av_bypass_planning_dist</strong> and <strong>ros_obst_det_stop_dist</strong></td></tr>
<tr><td>ros_obst_av_bypass_end_dist</td><td>Float</td><td>1.0</td><td>The minimum distance from the <em>last collision point</em> to merge the bypass route back to nominal route [m] See <em>Bypass route diverge point</em> (min: 0.0, max: 10.0)<br/>If this merging distance from the obstacle is not achievable, <strong>ros_obst_av_plan_step_dist</strong> will be incrementally added to the previous merging distance target up to <strong>ros_obst_av_max_plan_dist</strong> or the end of the current obstacle avoidance zone to search for potential return points<br/>Larger values can reduce the chance of finding bypass routes at the end of the obstacle avoidance zone<br/>Smaller values might cause looping bypass routes</td></tr>
<tr><td>ros_obst_av_plan_step_dist</td><td>Float</td><td>1.0</td><td>How much to shift forward a new potential merging point on nominal route after a failed bypass route planning attempt [m] (min: 0.05, max: 10.0)<br/>Small values will the keep the bypass route's merging point more closer to the target <strong>ros_obst_av_bypass_end_dist</strong> value, but might increase the bypass route calculation time in general</td></tr>
<tr><td>ros_obst_av_max_plan_dist</td><td>Float</td><td>20.0</td><td>How far ahead (along the nominal route) to check collisions and free space for a return point to nominal route [m] (min: 5.0, max: 40.0)<br/>Increasing this value will improve the success rate of calculating bypass routes over long/complex obstacles with slight performance reduction</td></tr>
<tr><td>ros_obst_av_max_plan_dist_prioritized</td><td>Int</td><td>0</td><td>Prioritize calculating bypass routes directly to the maximum planning distance ahead</br>- 0: Disabled</br>- 1: Enabled</td></tr>
<tr><td>ros_obst_av_min_diverge_dist</td><td>Float</td><td>0.3</td><td>Minimum distance to use for suggested diverge point from current AGV location [m] (min: 0.0, max: 1.0)<br/>Values close to zero might lead bypass route to drift away from AGVs current location in case of multiple route replannings and thus cause position errors<br/>Larger values decrease generally the success rate of finding valid bypass routes, when obstacle is close to the AGV</td></tr>
<tr><td>ros_obst_free_zone_gain_for_planning</td><td>Float</td><td>1.3</td><td>AGV dimension multiplier for route planning, see <em>planning frame</em> (min: 1.0, max: 2.0) <br/>Increasing the value makes the route planner to calculate routes further away from the obstacle while reducíng the general success rate of finding bypass trajectories<br/>Smaller values might cause AGV ending up too close to an obstacle during the bypass and becoming unable to continue</td></tr>
</tbody></table>
<h4 id="scanner-data-filtering"><a class="header" href="#scanner-data-filtering">Scanner data filtering</a></h4>
<p>Scanner data filtering is a sub feature that can be used to reduce the number of false positives in obstacle detection caused by noisy sensor data. The incorrectly detected obstacles can cause the AGV to stuck behind an obstacle that does not exist in reality or drive unnecessary or overly complex bypass routes.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/noisyData.png" alt="" /></p>
<blockquote>
<p>An example case of noisy sensor data causing the obstacle detection to react for a non-existing obstacle.</p>
</blockquote>
<p>There are two ways to filter out the scanner data:</p>
<ol>
<li>Limit certain scanner angles to be disabled
<ul>
<li>See Scanner Configurations document's <a href="DriveControl/ObstacleAvoidanceV2/../../AgvInterfaces/ScannerConfigurations/ScannerConfigurations-en.html#universal-scanner-parameters">Universal scanner parameters</a> chapter.</li>
</ul>
</li>
<li>Filter single or group of scan points out
<ul>
<li>See &quot;Cluster filter&quot; and &quot;Intense filter&quot; below</li>
</ul>
</li>
</ol>
<p><strong>Cluster filter</strong></p>
<p>The Cluster filter categorizes the scan points into groups, and deletes those which have less than <strong>ros_scan_filter_min_cluster_size</strong> amount of points in them. The filter compares current scan point's range value to previous scan points' ranges up to <strong>ros_scan_filter_sector_size</strong> points back. If the range difference distance (<strong>ros_scan_filter_max_range_diff</strong>) is less than the previous points' ranges, the scan point is grouped together with the point having the least range difference. In other case, the scan point creates a new group (= cluster).</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/scanFilterClusterSector.png" alt="" /></p>
<blockquote>
<p>Cluster filter's <em>point ranges</em> and <em>sector size</em> visualized</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/scanFilterClusterRange.png" alt="" /></p>
<blockquote>
<p>An example of cluster filtering done with values <em>sector size</em> = 1, <em>minimum cluster size</em> = 3 and <em>maximum range difference</em> as shown in the picture. The black points are filtered out. <br/>If the <em>minimum cluster size</em> was set to 4, the blue points would have been filtered out also.</p>
</blockquote>
<p>The recommended values to start with are</p>
<ul>
<li><strong>ros_scan_filter_max_range_diff</strong> = 0.1 (m)</li>
<li><strong>ros_scan_filter_sector_size</strong> = 3</li>
<li><strong>ros_scan_filter_min_cluster_size</strong> = 3</li>
</ul>
<p><strong>Intense filter</strong></p>
<p>Intense filter compares each scan point's range value to it's neighbors' ranges. The amount of the selected neighbors points <strong>from each side</strong> of a particular scan point is defined with the parameter <strong>ros_scan_filter_sector_size</strong>. If any of the neighbors' ranges is greater than the <strong>ros_scan_filter_max_range_diff</strong>, the scan point is filtered out.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/scanFilterIntenseSector.png" alt="" /></p>
<blockquote>
<p>Intense filtering <em>point ranges</em> and <em>filter sector size</em> visualized</p>
</blockquote>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/scanFilterIntenseRange.png" alt="" /></p>
<blockquote>
<p>An example of intense filtering done with values <em>sector size</em> = 1 and <em>maximum range difference</em> as shown in the picture. The black points are filtered out.</p>
</blockquote>
<p>Intense filter is recommended only when there is a need for a really heavy filtering, and the tuning of the cluster filter does not seem to be effective enough. It is important to note that this filter will remove also the valid scan points around the noisy ones.</p>
<p>The recommended values to start with are</p>
<ul>
<li><strong>ros_scan_filter_max_range_diff</strong> = 0.1 (m)</li>
<li><strong>ros_scan_filter_sector_size</strong> = 1</li>
</ul>
<p><strong>Scanner data filtering parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_scan_filter_mode</td><td>Int</td><td>0</td><td>Selects the filtering mode for scanner measurements for noisy data <br/>0: Disabled<br/>1: Cluster filter - Recommended<br/>2: Intense filter<br/>See filter descriptions and images above<br/>Note that scanner data filtering is disabled by default as it is not needed if the scanner data is not noisy. The filtering takes more computation resources and can cause too much filtering for low resolution scanners.</td></tr>
<tr><td>ros_scan_filter_max_range_diff</td><td>Float</td><td>0.1</td><td>How much an individual scan point's range can differ at max from the surrounding scan points to prevent filtering out [m]. Reducing the value increases the amount of total scan points being filtered out<br/>See filter descriptions and images above<br/> (min: 0.01, max: 10.0)</td></tr>
<tr><td>ros_scan_filter_sector_size</td><td>Int</td><td>3</td><td>Amount of surrounding scan points (from one side) to take into comparison with the current scan point.<br/>Increasing the value decreases the amount of points filtered out for the cluster filter and increases it for the intense filter.<br/> For intense filter recommended start value is 1<br/>See filter descriptions and images above<br/> (min: 1, max: 10)</td></tr>
<tr><td>ros_scan_filter_min_cluster_size</td><td>Int</td><td>3</td><td>Minimum amount of scan points needed in a cluster group to prevent filtering out. Increasing the value increases the amount of total scan points being filtered out. <br/>This is effective only with the Cluster filter mode<br/>See filter descriptions and images above<br/> (min: 2, max: 30)</td></tr>
</tbody></table>
<h4 id="driving-on-a-bypass-route"><a class="header" href="#driving-on-a-bypass-route">Driving on a bypass route</a></h4>
<p>The driving during the bypass and before it can be adjusted with following parameters.</p>
<p><strong>Bypass driving parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_obst_av_soft_stop_enabled</td><td>Int</td><td>1</td><td>Defines whether soft or hard stop should be used when the obstacle avoidance feature stops the AGV (for example when a close obstacle is detected). The soft stop is generally better for the hardware and hard stop stops the AGV faster as Navitrol sets the speed references instantly to zero without ramping them down.<br/>0:  Use hard stop <br/>1:  Use soft stop</td></tr>
<tr><td>ros_obst_av_bypass_start_slow_dist</td><td>Float</td><td>1.5</td><td>The distance [m] how far before the <em>bypass diverge point</em> to start slow down to <strong>pc_soft_slow_wheel_speed</strong> (min: 0.1, max: 30.0)<br/>Distance is calculated along the route from navigation point to a route point, in which the first obstacle would violate the <em>collision frame</em>. Larger values leave more time to calculate the bypass path without stopping</td></tr>
<tr><td>ros_obst_av_bypass_velocity</td><td>Float</td><td>0.3</td><td>AGV's maximum velocity on bypass route [m] (min: 0.01, max: 3.0)<br/>Smaller values increase navigation accuracy and safety in general during bypasses</td></tr>
</tbody></table>
<h4 id="reverting-a-bypass"><a class="header" href="#reverting-a-bypass">Reverting a bypass</a></h4>
<p>When the AGV is bypassing an obstacle, it is possible that the planned bypass route proves blocked as well. If a new bypass route cannot be calculated around the blockage, the options are to either wait for the obstacles to move or return back to nominal by reverting the bypass.</p>
<p><strong>Bypass revert parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_obst_av_reverse_to_nominal_mode</td><td>Int</td><td>0</td><td>Whether to backtrack back to nominal route in case AGV got stuck on bypass route<br/>0: Do not reverse to nominal. Wait for obstacles to move <br/> 1: Reverse to nominal by backtracking the driven bypass route</td></tr>
<tr><td>ros_obst_av_max_wait_time_before_reversing_sec</td><td>Int</td><td>10</td><td>How long to wait in seconds before starting to backtrack (min: 1, max: 900)<br/>- Has no effect if <strong>ros_obst_av_reverse_to_nominal_mode</strong> is set to zero<br/>- Countdown starts after <strong>ros_obst_av_bypass_trigger_wait_time</strong> has elapsed</td></tr>
<tr><td>ros_obst_av_return_to_nominal_max_dist_diff</td><td>Float</td><td>0.05</td><td>Defines the distance [m] from target point when the backtracking is considered completed. Adjust only if instructed to</td></tr>
<tr><td>ros_obst_av_return_to_nominal_max_angle_diff_deg</td><td>Float</td><td>5.0</td><td>Defines the angle [deg] from target point when the backtracking is considered completed (min: 0.1, max: 180.0) Adjust only if instructed to</td></tr>
</tbody></table>
<h4 id="logging-2"><a class="header" href="#logging-2">Logging</a></h4>
<p>See general <a href="DriveControl/ObstacleAvoidanceV2/../../Miscellaneous/Logging/Logging-en.html">Logging</a> document for Navitrol logging.</p>
<p>Obstacle avoidance V2 has a separate logging system for ROS data in addition to the to normal Navitrol logging.</p>
<ul>
<li>ROS binary logs are saved into <code>/home/navitec/ros_logs/</code> directory and are helpful for solving more complex ROS side issues. The ROS binary data can be visualized e.g. with RViz of Foxglove Studio software. Note, that binary logging uses significant amount of computer's computational resources, and should not be enabled if not needed.</li>
<li>ROS text logs are handled by Docker's JSON log driver, which are kept on temporarily files in Docker system during the run.</li>
</ul>
<p>Both the text and binary logs can be compressed to a single <code>ros_logs.tar.gz</code> by running <code>/home/navitec/scripts/takeRosLogs.sh</code> script. The file will be saved into Navitrol's log <code>/home/navitec/logs/</code> directory.</p>
<p>ROS logging mode is defined with the parameter <strong>ros_log_mode</strong>, which is by default set to 1 (= log detailed text logs). The <code>start_log.txt</code> is always created in the <code>/home/navitec/ros_logs/</code> directory, which can be used for troubleshooting an unsuccessful start up of the Obstacle avoidance V2.</p>
<p>It is important to note, that the <code>ros_logs/</code> directory is cleared on every new ROS launch, and the compressed <code>ros_logs.tar.gz</code> file is replaced by new logs when <code>takeRosLogs.sh</code> script is run. <strong>Please remember to rename/copy the compressed log file before running the script again.</strong></p>
<p>The amount of used hard disk space for ROS logging is defined mostly by two factors:</p>
<ul>
<li>The environment/map size and the length of the binary data recording (<strong>ros_log_duration_s</strong>), if binary logging is enabled. This can be up to gigabytes.</li>
<li>Text logging is limited by default to 100 megabytes (10 * 10MB files), which covers about 10 minutes of detailed level logging. This can be tuned by changing the values for <code>max-size</code> and <code>max-file</code> variables in <code>ros_config/docker/docker-compose.yml</code> file under <code>logging: options:</code>.</li>
</ul>
<p><strong>Navitrol logging parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_ros</td><td>Int</td><td>0</td><td>Defines the level of obstacle avoidance logging. Should be 0 in production and 2 when taking a log for bypass route calculation related issue.<br/>0: Minimum logging level<br/>1: Detailed logging enabled<br/>2: Detailed route logging enabled.</td></tr>
<tr><td>log_get_traj</td><td>Int</td><td>0</td><td>Defines the logging level for general trajectory generation. Should be increased when taking a log about trajectory related errors related to obstacle avoidance<br/>0: Minimum level<br/>1: Detailed logging</td></tr>
</tbody></table>
<p><strong>ROS logging parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_log_mode</td><td>Int</td><td>1</td><td>Defines if ROS text and binary logs are recorded<br/>0: Simple text logs<br/>1: Detailed text logs<br/>2: Detailed text and binary data logs</td></tr>
<tr><td>ros_log_duration_s</td><td>Int</td><td>100</td><td>Maximum duration [s] for ROS binary logs. Larger values will make the binary logs cover more history but use more hard drive space (min: 30, max: 300)</td></tr>
<tr><td>ros_obst_av_publish_map</td><td>Int</td><td>1</td><td>Defines if ROS global costmap is published. Recorded to binary logs if <code>ros_log_mode</code> is set to 2<br/>0: Disabled<br/>1: Only costmap updates <em>(recommended)</em><br/>2: Full costmap <em>(not recommended due to performance issues)</em></td></tr>
</tbody></table>
<h4 id="timers"><a class="header" href="#timers">Timers</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_obst_av_bypass_trigger_wait_time</td><td>Float</td><td>0.0</td><td>How long to wait before triggering bypass route calculation once the distance to the obstacle is less than <strong>ros_obst_av_bypass_planning_dist</strong> [s] (min: 0.0, max: 60.0)<br/>- Disabled by value 0.0</td></tr>
<tr><td>ros_obst_av_bypass_trigger_reset_time</td><td>Float</td><td>0.0</td><td>How long to wait before resetting the bypass route calculation trigger [s] (min: 0.0, max: 60.0)<br/>- Prevents the <strong>ros_obst_av_bypass_trigger_wait_time</strong> countdown from starting again, if the obstacle disappears from the route momentarily e.g. due to movement or noise<br/>- Disabled by value 0.0</td></tr>
<tr><td>ros_obst_av_max_wait_time_sec</td><td>Int</td><td>10</td><td>Maximum waiting time [s] for bypass route calculation before raising the WARNING_UNABLE_TO_BYPASS_OBSTACLE (min: 0, max: 18000)<br/>- This warning is only an indication for the operator that the AGV might be unable to bypass an obstacle and manual intervention might be needed to clear the obstacle<br/>- Warning can be disabled by value 0<br/>- Countdown starts after <strong>ros_obst_av_bypass_trigger_wait_time</strong> has elapsed</td></tr>
<tr><td>ros_obst_av_fleet_control_request_timeout_s</td><td>Int</td><td>10</td><td>Maximum waiting time [s] for bypass request for fleet control before raising WARNING_CANNOT_BYPASS_DID_NOT_GET_FLEET_CONTROL_PERMISSION and retrying (min: 1, max: 60). <br/> In general should not need to be adjusted but increasing the value can help, if communication delays between Navitrol and the Fleet Control are common</td></tr>
</tbody></table>
<h4 id="advanced---ros-scanners"><a class="header" href="#advanced---ros-scanners">Advanced - ROS scanners</a></h4>
<p>For obstacle detection, up to 4 ROS scanners can be used along with the Navitrol scanners.</p>
<p>Setting up the ROS scanners and related Navitrol parameters requires basic knowledge of ROS, and expert level understanding the concepts of ROS topics and ROS TF. For these reasons, <ins>it is recommended to use Navitrol scanners</ins>, see <strong>ros_send_scan_data</strong>.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_obst_det_scanner_enabled_arr[]</td><td>Int</td><td>0</td><td>Enable external ROS scanner for obstacle detection (min: 0, max: 1)</td></tr>
<tr><td>ros_obst_det_scanner_topic_arr[]</td><td>String</td><td>&quot;&quot;</td><td>ROS scanner topic</td></tr>
<tr><td>ros_obst_det_scanner_frame_arr[]</td><td>String</td><td>&quot;&quot;</td><td>ROS scanner frame</td></tr>
<tr><td>ros_obst_det_scanner_x_arr[]</td><td>Float</td><td>0.0</td><td>ROS scanner x position [m] with respect to navigation point</td></tr>
<tr><td>ros_obst_det_scanner_y_arr[]</td><td>Float</td><td>0.0</td><td>ROS scanner y position [m]  with respect to navigation point</td></tr>
<tr><td>ros_obst_det_scanner_h_arr[]</td><td>Float</td><td>0.0</td><td>ROS scanner orientation [deg] with respect to navigation point</td></tr>
<tr><td>ros_obst_det_scanner_upside_down_arr[]</td><td>Int</td><td>0</td><td>ROS scanner is installed upside down (flipped over Y-axis) (min: 0, max: 1)</td></tr>
<tr><td>ros_obst_det_create_scanner_frame_arr[]</td><td>Int</td><td>1</td><td>Create and publish automatically ROS scanner coordinate frame and transform based on<br/>- <strong>ros_obst_det_scanner_frame_arr</strong><br/>- <strong>ros_obst_det_scanner_&lt;x/y/h&gt;_arr</strong><br/>- <strong>ros_obst_det_scanner_upside_down_arr</strong><br/>parameters (min: 0, max: 1)</td></tr>
</tbody></table>
<h4 id="advanced---general"><a class="header" href="#advanced---general">Advanced - General</a></h4>
<p>ROS specific configuration settings, which are <strong>not</strong> needed to be modified usually. Requires basic/expert level knowledge of ROS concepts, such as</p>
<table><thead><tr><th>Concept</th><th>Description</th></tr></thead><tbody>
<tr><td>Topic</td><td>Data channel</td></tr>
<tr><td>TF</td><td>Coordinate transform</td></tr>
<tr><td>Costmap</td><td>Environment representation</td></tr>
<tr><td>URDF</td><td>Robot model description</td></tr>
</tbody></table>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_auto_config</td><td>Integer</td><td>1</td><td>Defines if Navitrol parameter, environment and segment files are automatically converted for ROS (into <code>ros_config/</code> folder). The modified/generated files are<br/>- <code>ros_params.yaml</code><br/>- <code>agv/agv.urdf</code><br/>- <code>map/map.yaml</code><br/>- <code>map/map.pgm</code><br/>Disabling the auto configuration allows defining the parameters manually for ROS. <ins>Adjust only if instructed to</ins><br/>0: Do not convert anything<br/>1: Convert all data<br/>2: Convert all data except URDF (<code>ros_config/agv/agv.urdf</code>)</td></tr>
</tbody></table>
<hr />
<h2 id="how-to-use-18"><a class="header" href="#how-to-use-18">How to use</a></h2>
<h3 id="example-use-case"><a class="header" href="#example-use-case">Example use case</a></h3>
<p>Following figures describe an example obstacle avoidance case where the AGV is given an drive order but on the route there is three (round) obstacles which the AGV must bypass to be able to reach the destination.</p>
<p>First the obstacle detection detects the first two obstacles and starts the bypass route calculation:</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/complexBypass1.png" alt="" /></p>
<blockquote>
<p>Obstacle detection detects the obstacle based on the green scanner points and renders the collision frame (orange rectangle) and (yellow) collision point.</p>
</blockquote>
<p>Bypass route calculation generates a bypass path to avoid the detected obstacles.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/complexBypass2.png" alt="" /></p>
<blockquote>
<p>The bypass route around the first two obstacles. It was calculated to merge back to the nominal route after the second obstacle, as there was not enough space available between the first two obstacles.</p>
</blockquote>
<p>The third obstacle is detected while bypassing the second.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/complexBypass3.png" alt="" /></p>
<blockquote>
<p>When a new obstacle is detected either on the nominal or bypass route, the collision frame will be again visualized.</p>
</blockquote>
<p>The bypass route around the third obstacle is calculated when the distance <ins>along the current route</ins> to the collision point from AGV's current location is below the <strong>ros_obst_av_bypass_planning_dist</strong>.</p>
<p><img src="DriveControl/ObstacleAvoidanceV2/./media-en/complexBypass4.png" alt="" /></p>
<blockquote>
<p>Bypass route around the third obstacle</p>
</blockquote>
<h3 id="launching-obstacle-avoidance-v2"><a class="header" href="#launching-obstacle-avoidance-v2">Launching Obstacle avoidance V2</a></h3>
<p>If the setup is done correctly, Obstacle avoidance V2 launches automatically with Navitrol whenever the IPC is powered up / rebooted. For manual launch, see <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#manual-control-of-ros-docker">Manual control of ROS Docker</a> chapter.</p>
<h3 id="taking-ros-logs"><a class="header" href="#taking-ros-logs">Taking ROS logs</a></h3>
<p>See <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#logging">Logging</a> for taking ROS text and binary logs. Shortly, run script <code>/home/navitec/scripts/takeRosLogs.sh</code> and pick up the created <code>ros_logs.tar.gz</code> from <code>/home/navitec/logs</code> directory.</p>
<hr />
<h2 id="troubleshooting-35"><a class="header" href="#troubleshooting-35">Troubleshooting</a></h2>
<p>This chapter explains the most common issues, errors and warnings related to the issue.
If you cannot resolve your issue by following these instructions please</p>
<ol>
<li>Set <strong>log_ros</strong> to value 2, <strong>log_get_traj</strong> to value 3, and <strong>ros_log_mode</strong> to value 2</li>
<li>Reboot the IPC</li>
<li>Reproduce the issue</li>
<li>Take <a href="DriveControl/ObstacleAvoidanceV2/../../Miscellaneous/Logging/Logging-en.html">Navitrol</a> and <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#taking-ros-logs">ROS</a> log</li>
<li>Deliver the logs and issue description to Navitec support</li>
</ol>
<p>Note: Please prefer setting the three aforementioned parameters back to their default values before putting the AGV back to production to save some hardware resources</p>
<h3 id="most-common-issues-6"><a class="header" href="#most-common-issues-6">Most common issues</a></h3>
<h4 id="a-script-does-not-work"><a class="header" href="#a-script-does-not-work">A script does not work</a></h4>
<p>Typically this is caused by missing execution rights. Try running the script again after giving <code>sudo chmod +x &lt;script_name&gt;</code> command.
Make sure that the script exists in the correct folder and the name and the commands are correctly written.</p>
<h4 id="updated-parameters-or-environment-have-no-effect"><a class="header" href="#updated-parameters-or-environment-have-no-effect">Updated parameters or environment have no effect</a></h4>
<p>Typically this is caused by forgetting to restart the ROS Docker container after updating the parameter/environment/segment files. Easiest way to restart the Docker is to boot the IPC but it can be also restarted <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#manual-control-of-ros-docker">manually</a>.</p>
<h4 id="agv-does-not-detect-an-obstacle"><a class="header" href="#agv-does-not-detect-an-obstacle">AGV does not detect an obstacle</a></h4>
<p>If the obstacle is not detected make sure that:</p>
<ol>
<li>The feature is enabled, see <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#required-parameters">required parameters</a></li>
<li>The detection scanners are selected and installed so that they see the obstacles</li>
<li>If <code>ros_obst_av_zone_mode</code> is set to 2, AGV will detect obstacles only when it's navigation point is inside an obstacle avoidance zone</li>
</ol>
<h4 id="agv-does-not-bypass-an-obstacle"><a class="header" href="#agv-does-not-bypass-an-obstacle">AGV does not bypass an obstacle</a></h4>
<p>There is several reasons why AGV might not bypass the detected obstacle:</p>
<ul>
<li>
<p><strong>The defined obstacle avoidance zone is too small</strong></p>
<ul>
<li>Note, that the <em>planning frame</em> must fit completely inside the zone borders.</li>
<li>Increase the size of the obstacle avoidance zone if feasible</li>
<li>Or decrease the size of <em>planning frame</em></li>
</ul>
</li>
<li>
<p><strong>The obstacle is too close</strong></p>
<ul>
<li>AGV is too close to the detected obstacle to bypass it. Typically this occurs only if the obstacle is detected too late, obstacle moves closer after detection or the stop and planning distances are set too small. Note that the obstacle avoidance does not support starting the bypass with a direction change. For the first two issues the only solution is to clear the obstacles from the route.</li>
<li>For the planning distance check that:
<ul>
<li><code>ros_obst_det_stop_dist</code> is not unnecessarily small</li>
<li><code>ros_obst_av_min_turning_radius</code> is not larger than it has to be</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>No obstacle avoidance zone is defined</strong></p>
<ul>
<li>If parameter <code>ros_obst_av_zone_mode</code> is greater than 0, bypass trajectory planning can occur only when AGV's navigation point is inside obstacle avoidance zone</li>
</ul>
</li>
</ul>
<p>Check also if any of the <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#errors-and-warnings">Errors and warnings</a> are active for more information.</p>
<h4 id="agv-cannot-reach-a-target-point-near-static-environment"><a class="header" href="#agv-cannot-reach-a-target-point-near-static-environment">AGV cannot reach a target point near static environment</a></h4>
<p>By default, obstacle detection is always enabled also outside obstacle avoidance zones, meaning that obstacle detection might stop the AGV e.g. in situation where AGV is trying to dock to a charging station. Obstacle detection can be disabled outside obstacle detection zones by setting parameter <code>ros_obst_av_zone_mode</code> to 2.</p>
<h3 id="errors-and-warnings-15"><a class="header" href="#errors-and-warnings-15">Errors and warnings</a></h3>
<h4 id="835---error_ros_no_connection"><a class="header" href="#835---error_ros_no_connection">835 - ERROR_ROS_NO_CONNECTION</a></h4>
<p>This error indicates that the connection between ROS and Navitrol is not working. It is set when Navitrol does not get any messages over ROS interface in 500 ms.</p>
<p>Check file <code>/home/navitec/ros_logs/start_log.txt</code>, for hints why ROS Docker container is not starting correctly.</p>
<p>The error is automatically reset when the communication resumes.</p>
<h4 id="837---error_obstacle_avoidance_v2_communication_timeout"><a class="header" href="#837---error_obstacle_avoidance_v2_communication_timeout">837 - ERROR_OBSTACLE_AVOIDANCE_V2_COMMUNICATION_TIMEOUT</a></h4>
<p>This error indicates delays in the communication between Navitrol and Obstacle avoidance V2 node. The error is set when Navitrol does not receive data from the obstacle avoidance node for over 1 second.</p>
<p>Check file <code>/home/navitec/ros_logs/start_log.txt</code>, which might give a hint of incorrect configuration. In addition to that, check that</p>
<ul>
<li>Parameter <strong>ros_enabled</strong> is set to 1</li>
<li>Parameter <strong>ros_log_mode</strong> is set lower than 2</li>
<li>There exist only one environment file (<code>env_*.nte</code>) and one segment file (<code>seg*.xml</code>)</li>
</ul>
<p>The error is automatically reset when the communication resumes.</p>
<p>If the error appears often, the IPC might lack of sufficient amount of performance resources. See more info from warning <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#623---warning_obstacle_avoidance_v2_high_dt">623 - WARNING_OBSTACLE_AVOIDANCE_V2_HIGH_DT</a></p>
<h4 id="622---warning_obstacle_detected"><a class="header" href="#622---warning_obstacle_detected">622 - WARNING_OBSTACLE_DETECTED</a></h4>
<p>This warning informs the operator that the obstacle detection has detected an obstacle on current route. The point on a route where the collision would happen is visualized in Navitrol Monitor.</p>
<p>The warning is automatically reset when there is no longer obstacles on the current route. The reset typically happens when the obstacle either moves away or a bypass route is created around it.</p>
<p>If the warning remains active and the AGV is stopped for a longer time, check other active errors and warnings for more information.</p>
<h4 id="936---warning_unable_to_bypass_obstacle"><a class="header" href="#936---warning_unable_to_bypass_obstacle">936 - WARNING_UNABLE_TO_BYPASS_OBSTACLE</a></h4>
<p>This warning indicates that creating an bypass route around the obstacle has taken longer than expected and it is likely that the obstacle cannot be bypassed without manual intervention.
If WARNING_OBSTACLE_TOO_CLOSE or WARNING_OBST_AV_V2_PATH_REJECTED_DUE_FRAME_HEADING is also active, try to solve them first as they are more specific reasons for the AGV not being able to bypass an obstacle.</p>
<p>The expected time is defined by <strong>ros_obst_av_max_wait_time_sec</strong> + <strong>ros_obst_av_bypass_trigger_wait_time</strong> parameters by default. If reversing to nominal is enabled with  <strong>ros_obst_av_reverse_to_nominal_mode</strong> parameter, this warning is also set when the reverse starts after <strong>ros_obst_av_max_wait_time_before_reversing_sec</strong> + <strong>ros_obst_av_bypass_trigger_wait_time</strong>.</p>
<p>This warning is automatically reset in case the detected obstacle or dynamic environment around the AGV changes so that a bypass becomes possible. However, it is recommended that the operator manually checks and resolves the situation in case the route is blocked for a long time.</p>
<h4 id="628---warning_obstacle_too_close"><a class="header" href="#628---warning_obstacle_too_close">628 - WARNING_OBSTACLE_TOO_CLOSE</a></h4>
<p>This warning indicates that the detected collision point is closer than 10cm from AGVs current position and bypassing it will not be possible</p>
<p>The warning is automatically cleared if the obstacle is cleared or moves further from the AGV.</p>
<h4 id="937---warning_obst_av_v2_path_rejected_due_frame_heading"><a class="header" href="#937---warning_obst_av_v2_path_rejected_due_frame_heading">937 - WARNING_OBST_AV_V2_PATH_REJECTED_DUE_FRAME_HEADING</a></h4>
<p>This warning indicates that Navitrol rejects a route provided by ROS because it would start from or end to a route with a defined frame heading, which is not supported.</p>
<p>If the warning remains active while the AGV is stopped for a longer time, bypassing is most likely prevented by the route sections with frame heading. In which case the either the detected obstacle must be cleared from the route or the frame headings removed from those routes using Navithor Tools.</p>
<p>The warning is automatically reset if a suitable route is found or when the obstacle is cleared.</p>
<h4 id="936---warning_obst_av_v2_path_ended"><a class="header" href="#936---warning_obst_av_v2_path_ended">936 - WARNING_OBST_AV_V2_PATH_ENDED</a></h4>
<p>This warning indicates that the AGV has reached the end of the active route while on a bypass route instead of nominal. This is caused by route handling issue between Navitrol and ROS.</p>
<p>To fix this error drive the AGV manually back to nominal route. Additionally, take a log and send it to Navitec support.</p>
<h4 id="623---warning_obstacle_avoidance_v2_high_dt"><a class="header" href="#623---warning_obstacle_avoidance_v2_high_dt">623 - WARNING_OBSTACLE_AVOIDANCE_V2_HIGH_DT</a></h4>
<p>This warning indicates that the hardware lacks of sufficient computational resources. The main factors for a higher performance usage are</p>
<ul>
<li>Large environments / production areas</li>
<li>Large AGV frame size</li>
<li>Long scanner measurements</li>
<li>Collision checking for a long part of the trajectory</li>
</ul>
<p>Methods for saving computational resources by adjusting parameters is to reduce the value of the following ones:</p>
<ul>
<li><code>ros_obst_av_max_plan_dist</code> -&gt; Reduce collision checking distance ahead</li>
<li><code>ros_obst_det_max_scan_dist</code> -&gt; Reduce scanner measurement range for obstacle avoidance - less environment area is needed to update</li>
<li><code>ros_obst_av_publish_map</code> (to 0) -&gt; Disable publishing costmap data for logging purposes</li>
</ul>
<h4 id="624---warning_waiting_obstacle_bypass_permission"><a class="header" href="#624---warning_waiting_obstacle_bypass_permission">624 - WARNING_WAITING_OBSTACLE_BYPASS_PERMISSION</a></h4>
<p>This warning indicates that Navitrol is waiting for a permission from Navithor fleet control before starting a bypass.</p>
<p>The warning is automatically reset when an answer is received from Navithor either approving or rejecting the offered bypass route or if time defined by <strong>ros_obst_av_fleet_control_request_timeout</strong> parameter has been passed without an answer.</p>
<h4 id="630---warning_cannot_bypass_did_not_get_fleet_control_permission"><a class="header" href="#630---warning_cannot_bypass_did_not_get_fleet_control_permission">630 - WARNING_CANNOT_BYPASS_DID_NOT_GET_FLEET_CONTROL_PERMISSION</a></h4>
<p>This warning indicates that the fleet control has rejected a suggested bypass route. One reason for rejection is that the bypass route would collide with another AGV of the fleet.</p>
<p>Obstacle avoidance V2 will continue to suggest new bypass routes until one is accepted by the fleet control. However, if the warning stays active for long, manual intervention might be required.</p>
<h4 id="659---warning_obstacle_avoidance_v2_suspended"><a class="header" href="#659---warning_obstacle_avoidance_v2_suspended">659 - WARNING_OBSTACLE_AVOIDANCE_V2_SUSPENDED</a></h4>
<p>This warning indicates that obstacle avoidance has been suspended due to other feature being active. The conflicting features are</p>
<ul>
<li>SLAM</li>
</ul>
<h4 id="662---warning_bypass_route_planning_active"><a class="header" href="#662---warning_bypass_route_planning_active">662 - WARNING_BYPASS_ROUTE_PLANNING_ACTIVE</a></h4>
<p>This warning indicates that obstacle avoidance has activated bypass route planning, making the AGV to not trespass the planned diverge point until</p>
<ul>
<li>Bypass route is found (and accepted by Navithor)</li>
<li>Finding a bypass route failed</li>
</ul>
<h2 id="advanced-troubleshooting-10"><a class="header" href="#advanced-troubleshooting-10">Advanced troubleshooting</a></h2>
<h3 id="log-keywords"><a class="header" href="#log-keywords">Log keywords</a></h3>
<p>Following keywords can be used to search more information from Navitrol logs on specific points of interest. They are case sensitive.</p>
<table><thead><tr><th>Point of interest</th><th>Keyword</th><th>Use case</th></tr></thead><tbody>
<tr><td>Everything</td><td>&quot;[ROS_OA]&quot;</td><td>Works as a start point if not quite sure what goes wrong</td></tr>
<tr><td>Messages between Navitrol and ROS</td><td>&quot;ros_inte&quot;</td><td>Helpful when suspecting that something goes wrong in Navitrol - ROS communication</td></tr>
</tbody></table>
<h3 id="manual-control-of-ros-docker"><a class="header" href="#manual-control-of-ros-docker">Manual control of ROS Docker</a></h3>
<p>Typically ROS Docker does not need manual interaction after it has been set to start automatically on system boot. However, it can be launched and stopped manually using terminal commands with superuser privileges:</p>
<p><strong>Manual launch</strong></p>
<ul>
<li><code>cd /home/navitec/ros_config/scripts/</code></li>
<li><code>./startRos.sh</code></li>
</ul>
<p><strong>Manual stop</strong></p>
<ul>
<li><code>cd /home/navitec/ros_config/scripts/</code></li>
<li><code>./stopNavitrolAndRos.sh</code></li>
</ul>
<p><strong>Checking Docker status</strong>
To check running containers and their statuses and IDs, run command <code>docker ps -a</code>
<img src="DriveControl/ObstacleAvoidanceV2/./media-en/dockerPsCommand.png" alt="" /></p>
<p><strong>Viewing output of ROS Docker container</strong>
The Docker container output can be printed into terminal to e.g. troubleshoot Obstacle avoidance V2 issues. There are few ways to achieve this:</p>
<ul>
<li>At runtime (non-active): See container output by typing command <code>docker logs --follow ros_obstacle_avoidance</code></li>
<li>At runtime (active): Attach to the container running in the background by typing command <code>docker attach ros_obstacle_avoidance</code></li>
<li>At launch (active): Remove argument <code>-d</code> from <code>docker compose up -d -V --force-recreate</code> command in <code>/home/navitec/ros_config/scripts/startRos.sh</code> script, and run <code>/home/navitec/startNavitrol.sh</code> script again</li>
</ul>
<p>Methods tagged with</p>
<ul>
<li><em>non-active</em> will only follow the container output, and pressing e.g. command <code>Ctrl + C</code> to exit the container will <strong>not</strong> shutdown the container</li>
<li><em>active</em> will have an active keyboard control to the container. This means, that pressing e.g. command <code>Ctrl + C</code> to exit the container will also shutdown the container from running</li>
</ul>
<p><strong>ROS Docker container status is Exited</strong>
If the status of the obstacle avoidance container is &quot;Exited&quot;, the Obstacle avoidance V2 is not running. Check that</p>
<ul>
<li>There is no invalid configuration set (see file <code>ros_logs/start_log.txt</code>)</li>
<li>ROS container itself has not countered an error
<ul>
<li>Run script <code>ros_config/scripts/takeRosLogs.sh</code></li>
<li>Open file <code>ros_logs/*-json.log</code> (without trailing number)
<ul>
<li>For example, the following error might appear, if the used Docker (Compose) version is too old<br/>
<img src="DriveControl/ObstacleAvoidanceV2/./media-en/dockerPermissionError.png" alt="" /><br/>
The permission issue above has been encountered at least with the version shown below. Please update the <a href="DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#docker-engine-and-docker-compose-installation">Docker Engine &amp; Compose</a> versions to newest ones.<br/>
<img src="DriveControl/ObstacleAvoidanceV2/./media-en/tooOldDockerVersion.png" alt="" /></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<h2 id="appendix-2"><a class="header" href="#appendix-2">Appendix</a></h2>
<h3 id="navitrol-scanners-to-select-for-obstacle-detection"><a class="header" href="#navitrol-scanners-to-select-for-obstacle-detection">Navitrol scanners to select for obstacle detection</a></h3>
<p>Below is a complete list of all the possible value combinations for parameter <code>ros_send_scan_data</code>. This value defines, which Navitrol scanners are used for ROS obstacle detection</p>
<table><thead><tr><th>Value for<br>the parameter</th><th>Value in<br>binary</th><th>Selected scanners for obstacle detection</th></tr></thead><tbody>
<tr><td>0</td><td>0000</td><td>No scanner selected</td></tr>
<tr><td>1</td><td>0001</td><td>Rear scanner selected</td></tr>
<tr><td>2</td><td>0010</td><td>Front scanner selected</td></tr>
<tr><td>3</td><td>0011</td><td>Front &amp; rear scanners selected</td></tr>
<tr><td>4</td><td>0100</td><td>Measurement 0 scanner selected</td></tr>
<tr><td>5</td><td>0101</td><td>Measurement 0 &amp; rear scanners selected</td></tr>
<tr><td>6</td><td>0110</td><td>Measurement 0 &amp; front scanners selected</td></tr>
<tr><td>7</td><td>0111</td><td>Measurement 0, front &amp; rear scanners selected</td></tr>
<tr><td>8</td><td>1000</td><td>Measurement 1 scanner selected</td></tr>
<tr><td>9</td><td>1001</td><td>Measurement 1 &amp; rear scanners selected</td></tr>
<tr><td>10</td><td>1010</td><td>Measurement 1 &amp; front scanners selected</td></tr>
<tr><td>11</td><td>1011</td><td>Measurement 1, front &amp; rear scanners selected</td></tr>
<tr><td>12</td><td>1100</td><td>Measurement 1 &amp; measurement 0 scanners selected</td></tr>
<tr><td>13</td><td>1101</td><td>Measurement 1, measurement 0 &amp; rear scanners selected</td></tr>
<tr><td>14</td><td>1110</td><td>Measurement 1, measurement 0 &amp; front scanners selected</td></tr>
<tr><td>15</td><td>1111</td><td>Measurement 1, measurement 0, front &amp; rear scanners selected</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="unmapped-areacontainer-driving"><a class="header" href="#unmapped-areacontainer-driving">Unmapped area/container driving</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="introduction-40"><a class="header" href="#introduction-40">Introduction</a></h2>
<p>Navitrol offers a feature where it can drive to an unmapped area without
routes. The area where Navitrol should drive the AGV into is required to
have straight-line features on both sides of the AGV. Navitrol uses
these features to compute the center line. The center line is then used
to create the trajectory and drive the AGV into the area following the
center line.</p>
<h2 id="feature-details"><a class="header" href="#feature-details">Feature details</a></h2>
<p>This feature is specially designed for the scenario in which the
unmapped environment's exact position might not be known or might change
slightly during the production process. Hence, Navitrol will detect the
environment every time the AGV arrives at the start of the area which
may be called the entry point. The AGV must stop at the entry point and
detect the straight-line features that can be sensed by the scanners.
The Navitrol can then determine the center line and continue driving. An
example scenario is presented in Figure 1.</p>
<p><img src="DriveControl/ContainerDriving/./media-en/image3.PNG" alt="" /></p>
<blockquote>
<p>Figure 1 - Mapped environment leading to the unmapped container</p>
</blockquote>
<p>The AGV uses natural feature navigation until the container's entry
point. Once at Pre-container (11) symbolic point, Navitrol initiates the
unmapped area navigation and once the straight-line features are
detected, Navitrol commands the AGV to drive into the area. Navitrol
keeps the AGV in the centre of the side walls. This is shown in Figure
2.</p>
<p><img src="DriveControl/ContainerDriving/./media-en/image4.PNG" alt="" /></p>
<blockquote>
<p>Figure 2 - AGV driving inside the unmapped area</p>
</blockquote>
<h2 id="setup-20"><a class="header" href="#setup-20">Setup</a></h2>
<p>The setup for this feature requires the setting and tuning of several
parameters. These parameters are explained in the following table.</p>
<table><thead><tr><th>Parameter</th><th>Explanation</th></tr></thead><tbody>
<tr><td>unmapped_reefer_nav_enable</td><td>Enable the feature</td></tr>
<tr><td>unmapped_reefer_nav_dist_two_cons_scan_pts_meters</td><td>Distance between 2 consecutive points used for reefer scanner data segmentation. It should be less than unmapped_reefer_nav_line_detection_point_dist_threshold_meters</td></tr>
<tr><td>unmapped_reefer_nav_use_scanner</td><td>Scanner to be used for navigation. 0: rear scanner; 1: front scanner; -1: use both</td></tr>
<tr><td>unmapped_reefer_nav_container_width_meters</td><td>Half the reefer's internal width in meters. Used to consider points within this distance from the route</td></tr>
<tr><td>unmapped_reefer_nav_scanner_min_ind</td><td>Minimum scanner index to consider for including scanner points in calculations</td></tr>
<tr><td>unmapped_reefer_nav_scanner_max_ind</td><td>Maximum scanner index to consider for including scanner points in calculations</td></tr>
<tr><td>unmapped_reefer_nav_scanner_min_points_close_to_first_point</td><td>Minimum number of points close</td></tr>
<tr><td></td><td>to the closest point such that the cluster can be formed of these points</td></tr>
<tr><td>unmapped_reefer_nav_max_dist_to_first_point_meters</td><td>The max distance to the wall farther away from the scanner. Used to find the closest point as the starting point</td></tr>
<tr><td>unmapped_reefer_side_wall_reference_length_to_match_meters</td><td>The length of the reefer to match with the scanner data points</td></tr>
<tr><td>unmapped_reefer_length_err_tolerance_meters</td><td>The difference in the specified length to match in unmapped_reefer_side_wall_reference_length_to_match_meters and cluster length</td></tr>
<tr><td>unmapped_reefer_end_wall_length_err_tolerance_meters</td><td>The difference between side wall length and end wall to accept the endwall</td></tr>
<tr><td>unmapped_reefer_min_pts_in_cluster</td><td>How many points should there be in the cluster to consider it</td></tr>
<tr><td>unmapped_reefer_min_dist_bw_clusters</td><td>Minimum distance between side wall clusters</td></tr>
<tr><td>unmapped_reefer_max_dist_bw_clusters</td><td>Maximum distance between side wall clusters</td></tr>
<tr><td>unmapped_reefer_max_angle_bw_side_walls_deg</td><td>The maximum angle that is allowed for two clusters to be considered the reefer's side walls</td></tr>
<tr><td>unmapped_reefer_dist_to_create_traj_for_meters</td><td>The distance for which the trajectory is initially created for</td></tr>
<tr><td>unmapped_reefer_driving_velocity</td><td>The velocity for the AGV while driving in the reefer [m/s]</td></tr>
<tr><td>unmapped_reefer_dist_from_end_wall</td><td>The distance to the end wall where the trajectory should end</td></tr>
<tr><td>unmapped_reefer_dist_from_traj_end_to_extend_drive_meters</td><td>In the case that the end wall is found, the drive is extended when the AGV is within this distance to the end of current trajectory</td></tr>
<tr><td>unmapped_reefer_max_dist_from_endWall_to_adjust_traj_to_wall</td><td>If the distance to the end wall is less than this parameter then trajectory is extended to (wall - offset from wall)</td></tr>
<tr><td>unmapped_reefer_nav_filter_outlier_points</td><td>Filter the outliers in the cluster</td></tr>
<tr><td>unmapped_reefer_use_prev_sol_if_new_not_fnd</td><td>Use the prev solution if new not found provided a previous solution already exists</td></tr>
<tr><td>unmapped_reefer_dist_to_drive_back_meters</td><td>Distance to drive backwards</td></tr>
<tr><td>unmapped_reefer_percentage_of_new_sol_to_use</td><td>The percentage of the new solution to use</td></tr>
<tr><td>unmapped_reefer_det_lines_every_iter</td><td>Specifies whether to determine side walls and fit lines every time or not. 0 = just once, 1 = every time a new trajectory is to be created</td></tr>
<tr><td>unmapped_reefer_cluster_max_length</td><td>Maximum length of cluster for reefer driving</td></tr>
<tr><td>unmapped_reefer_drive_from_terminal</td><td>1 = Send drive command from terminal, 0 = drive from supervisor interface via msg ID 3041</td></tr>
<tr><td>unmapped_reefer_d_to_end_to_set_arrived_flag</td><td>distance to container end wall to set arrived flag</td></tr>
<tr><td>unmapped_reefer_d_to_end_to_set_finished_seq_flag</td><td>distance to initial start point to set finished sequence to 1</td></tr>
<tr><td>unmapped_reefer_end_pt_offset</td><td>offset for adjusting the end point inside the container</td></tr>
</tbody></table>
<h2 id="control-via-supervisor-ethernet-interface"><a class="header" href="#control-via-supervisor-ethernet-interface">Control via supervisor ethernet interface</a></h2>
<p>The supervisor can send the following message, ID 3041, to Navitrol to
initiate the driving process.</p>
<h3 id="3041----request-drive-to-area-with-parallel-side-walls-without-environment-mapping"><a class="header" href="#3041----request-drive-to-area-with-parallel-side-walls-without-environment-mapping">3041 -- Request drive to area with parallel side walls without environment mapping</a></h3>
<p>The AGV supervisor can request Navitrol to drive to the area by
providing the following information and triggering drive initiation.</p>
<table><thead><tr><th>Data field</th><th>Type</th><th>Length (bytes)</th><th>Comment</th></tr></thead><tbody>
<tr><td>Protocol Version = 4</td><td>Unsigned Short</td><td>2</td><td></td></tr>
<tr><td>Message ID = 3041</td><td>Unsigned Short</td><td>2</td><td></td></tr>
<tr><td>Message length = 23</td><td>Unsigned Integer</td><td>4</td><td>Message length in bytes including all data fields (including Protocol Version and Message ID)</td></tr>
<tr><td>Drive forwards/backwards</td><td>Unsigned Char</td><td>1</td><td>1 = drive forwards, 0 = drive backwards</td></tr>
<tr><td>Distance from end wall to drive to</td><td>Float</td><td>4</td><td>AGV drives to this distance (meters) from the end wall</td></tr>
<tr><td>Distance to drive backwards</td><td>Float</td><td>4</td><td>When driving backwards (meters), this is required so the AGV drives back this distance</td></tr>
<tr><td>Enable driving</td><td>Unsigned Char</td><td>1</td><td>1 = start driving<br>0 = stop driving</td></tr>
<tr><td>Container length</td><td>Float</td><td>4</td><td>Container length (in meters)</td></tr>
<tr><td>Clear Data</td><td>Unsigned char</td><td>1</td><td>1 = clear previous container data stored in memory<br>0 = Do not clear previous container data stored in memory<br>The data is always cleared on leaving container</td></tr>
</tbody></table>
<p>The drive must start with forward driving because that is how the area
is mainly mapped. The route is calculated as the AGV drives into the
area. The end of the route is determined when the AGV detects an end
wall or principally a straight-line feature perpendicular to the side
walls as specified by the parameters. However, once a straight-line
feature is detected in front of the AGV then the AGV stops at some
distance to the straight-line feature. This is specified by the field
'Distance from end wall to drive to'.</p>
<p>The whole process can be initiated by setting the 'Enable driving' field
to one. Setting it to zero at any particular instant will stop the AGV.
The data collected and used for localization and control will stay in
the memory until it is commanded to be cleared by setting 'Clear Data'
field to one.</p>
<p>The AGV stops once it has driven to the end wall. To drive it out of the
area, the driving direction has to be changed to zero and the AGV will
start to drive backwards the specified distance at a time. The backwards
driving distance is specified in the field 'Distance to drive backwards'
in message 3041.</p>
<h3 id="3102----supervisor-status-message-section-for-unmapped-container-driving"><a class="header" href="#3102----supervisor-status-message-section-for-unmapped-container-driving">3102 -- Supervisor status message section for unmapped container driving</a></h3>
<p>Navitrol keeps updating the supervisor of its status using a specific
section of the status message. The AGV supervisor can request Navitrol
to send the status message and the unmapped area driving section. This
section contains all the status information for the drive to the
unmapped area.</p>
<p>When starting the drive and once the side walls are detected then the
field 'Side walls detected' is set to 1 in status message. Similarly,
when the AGV drives into the container and detects the end wall then the
field 'End wall detected' is set to one otherwise it stays at zero.
While driving forwards into the container, the field 'Driving in/out' is
set to 1 otherwise to zero. As the AGV arrives at the distance from the
end wall to which AGV should drive to, Navitrol sets the field 'At end
of container' to one otherwise it is zero.</p>
<p>Once the AGV is at the end of the container, it can be commanded to
drive backwards and out of the container whenever needed.</p>
<p>When a backwards driving command is sent to Navitrol and the AGV has
driven back the specified distance then the field 'Current backward
driving segment driven' will be set to one.</p>
<p>The status message also provides the means to monitor if Navitrol has
detected the end wall and whether the AGV has already driven 2/3^rd^ of
the container length. If the 'Passed two thirds of the container' is set
to one and 'End wall detected' is set to zero then the PLC should set
'Enable driving' to zero to stop the AGV.</p>
<table><thead><tr><th>Data field</th><th>Type</th><th>Length (bytes)</th><th>Comment</th></tr></thead><tbody>
<tr><td>Section ID = 17</td><td>Unsigned Short</td><td>2</td><td></td></tr>
<tr><td>Section length = 17</td><td>Unsigned Integer</td><td>4</td><td>Length of the section including all data fields of the section</td></tr>
<tr><td>Side walls detected</td><td>Unsigned char</td><td>1</td><td>1 = side walls are detected and Navitrol can calculate the center<br>0 = side walls not detected</td></tr>
<tr><td>End wall detected</td><td>Unsigned char</td><td>1</td><td>1 = End wall detected<br>0 = End wall not detected</td></tr>
<tr><td>Driving in/out</td><td>signed Short</td><td>2</td><td>1 = Driving in<br>0 = Driving out</td></tr>
<tr><td>At end of container</td><td>Unsigned char</td><td>1</td><td>1 = at the end of container<br>0 = not at the end</td></tr>
<tr><td>Sequence</td><td>Unsigned char</td><td>1</td><td>1 = finished sequence<br>0 = not finished</td></tr>
<tr><td>Passed two thirds of the container</td><td>Unsigned char</td><td>1</td><td>1 = already travelled two thirds of container<br>0 = has not yet travelled two thirds of container</td></tr>
<tr><td>Current backward riving segment driven</td><td>Unsigned char</td><td>1</td><td>1 = at end of current backward driving distance<br>0 = current backward driving distance not driven</td></tr>
<tr><td>Reserved byte</td><td>Unsigned char</td><td>1</td><td>N/A</td></tr>
<tr><td>Reserved bytes</td><td>Unsigned Integer</td><td>4</td><td>N/A</td></tr>
</tbody></table>
<h2 id="limitations-16"><a class="header" href="#limitations-16">Limitations</a></h2>
<ol>
<li>
<p>The drive should start when the AGV is driving forwards into the
container area.</p>
</li>
<li>
<p>Once the area is mapped, there is no limitation on how many times
the AGV can drive back and forth using the same data until the
'Clear Data' command is received and the data is cleared.</p>
</li>
<li>
<p>If the end wall is not detected, the AGV will continue driving until
either the wall is detected or an abort signal is received.</p>
</li>
<li>
<p>At the beginning, if the scan points are not enough to detect the
side walls as straight lines as specified by the parameters, the
driving will never be started. Because, the side walls are the only
reference available in such a driving scenario.</p>
</li>
<li>
<p>Navitrol will keep all the data from one particular drive until the
data is cleared using the 'Clear Data' field in message 3041.</p>
</li>
<li>
<p>The data should be cleared from the memory before driving to a
different area than the one mapped earlier.</p>
</li>
</ol>
<h2 id="commands-and-status-monitoring-sequence-for-an-example-use-case"><a class="header" href="#commands-and-status-monitoring-sequence-for-an-example-use-case">Commands and status monitoring sequence for an example use case</a></h2>
<p>The following flowgraph in Figure 3 and Figure 4 show the example
execution sequence. The environment and the setup considered and used
for the development of the flowgraph is the same as shown in Figure 1.</p>
<p><img src="DriveControl/ContainerDriving/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 3 - Execution sequence based on commands and status message interchange between Navitrol and supervisor</p>
</blockquote>
<p><img src="DriveControl/ContainerDriving/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 4 - continuation of the sequence flowgraph</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="record--play"><a class="header" href="#record--play">Record &amp; Play</a></h1>
<p>Updated 06.06.2024</p>
<hr />
<h2 id="overview-32"><a class="header" href="#overview-32">Overview</a></h2>
<h3 id="introduction-41"><a class="header" href="#introduction-41">Introduction</a></h3>
<p>Record &amp; Play is a Navitrol feature, in which the user controls the AGV manually first, and then Navitrol is able to replicate the same movements <strong>on-the-fly</strong>, without the need of using Navithor Tools. The feature (in short) consists of the following steps:</p>
<ul>
<li>Start the recording</li>
<li>Drive the AGV around with manual control</li>
<li>Stop the recording</li>
<li>Give a name for the recorded area</li>
<li>Load the recorded area</li>
<li>Drive the AGV manually back to the starting point of the recording</li>
<li>Initialize AGV position to the starting point of the recording</li>
<li>Command Navitrol to repeat the recording</li>
</ul>
<p><img src="DriveControl/RecordAndPlay/./media-en/ManualDriving.PNG" alt="" /></p>
<blockquote>
<p>AGV is controlled manually to teach the environment and the trajectory for Navitrol</p>
</blockquote>
<p><img src="DriveControl/RecordAndPlay/./media-en/GeneratedArea.PNG" alt="" /></p>
<blockquote>
<p>After teaching, Navitrol generated automatically the map and the trajectory performed by the user</p>
</blockquote>
<h3 id="requirements-19"><a class="header" href="#requirements-19">Requirements</a></h3>
<ul>
<li><code>ROS2 Navigation2 Humble</code> Docker base image is installed</li>
<li>Powerful enough IPC
<ul>
<li>Preferably processor from <code>Intel i3</code> series or higher</li>
<li>10 GB of free hard disk space</li>
</ul>
</li>
</ul>
<h3 id="limitations-17"><a class="header" href="#limitations-17">Limitations</a></h3>
<ul>
<li>Scanners:
<ul>
<li>Only one scanner can be used for creating the map</li>
<li>Scanner <strong>can not be</strong> installed upside down (without manual ROS configuration)</li>
</ul>
</li>
<li>Kinematics:
<ul>
<li>Pivoting is not supported</li>
<li>Small turning radius (&lt; 0.5 m) can cause trajectory generation issues, especially close to the driving direction changing points</li>
</ul>
</li>
<li>Map:
<ul>
<li>The bigger the map/area to record, the greater the need for more powerful IPC</li>
</ul>
</li>
</ul>
<h3 id="dependencies-12"><a class="header" href="#dependencies-12">Dependencies</a></h3>
<ul>
<li><a href="https://docs.docker.com/engine/install/debian/#install-using-the-repository">Docker Engine &amp; Compose</a></li>
<li>ROS</li>
<li>Standalone (= Route Driver) enabled</li>
</ul>
<hr />
<h2 id="setup-21"><a class="header" href="#setup-21">Setup</a></h2>
<h3 id="first-time"><a class="header" href="#first-time">First time</a></h3>
<ul>
<li>
<p>Install <a href="https://docs.docker.com/engine/install/debian/#install-using-the-repository">Docker Engine &amp; Compose</a> software into IPC if not yet done (requires internet connection)</p>
</li>
<li>
<p>Install <code>ROS2 Navigation2 Humble</code> Docker base image (<code>ros2_navigation2_humble.tar.gz</code>), if not yet done</p>
<ul>
<li>Provided by Navitec</li>
<li>Check with command <code>docker images</code>, if the base image already exist</li>
</ul>
<p><img src="DriveControl/RecordAndPlay/./media-en/DockerImages.PNG" alt="" /></p>
<blockquote>
<p>Base image is existing</p>
</blockquote>
<ul>
<li>If the base image is not installed:
<ul>
<li>Transfer <code>ros2_navigation2_humble.tar.gz</code> to the IPC (into any directory)</li>
<li>Run command (as root user) <code>docker load -i ros2_navigation2_humble.tar.gz</code></li>
<li>Check with <code>docker images</code>, that the base image got installed successfully</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="quick-setup-3"><a class="header" href="#quick-setup-3">Quick setup</a></h3>
<ul>
<li>Check, that <code>startNavitrol.sh</code> script (located in <code>/home/navitec/</code>) has the line <code>./ros_config/scripts/startRos.sh</code> at the end of the file</li>
<li>Install Navitrol_&lt;version&gt;.deb package
<ul>
<li><code>dpkg -i Navitrol_&lt;version&gt;.deb</code></li>
</ul>
</li>
<li>Run stop script
<ul>
<li><code>/home/navitec/ros_config/scripts/stopNavitrolAndRos.sh</code>
<ul>
<li>Might require to be run with <code>sudo</code> prefix if not run as root user</li>
</ul>
</li>
</ul>
</li>
<li>Set required parameters in <code>params.txt</code> file as described below
<ul>
<li>Note: <code>params_override.txt</code> file is <strong>not</strong> supported at the moment (for parameters used by ROS)</li>
</ul>
</li>
</ul>
<h3 id="required-parameters-1"><a class="header" href="#required-parameters-1">Required parameters</a></h3>
<h4 id="category-slam"><a class="header" href="#category-slam">Category: SLAM</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>ros_enabled</td><td>Integer</td><td>1</td><td>Enable Navitrol to communicate with ROS</td></tr>
<tr><td>ros_slam_enabled</td><td>Integer</td><td>1</td><td>Enable SLAM nodes to start up</td></tr>
<tr><td>ros_slam_scanner</td><td>Integer</td><td>0-3</td><td>Scanner selection for SLAM<br>0 - Rear<br>1 - Front<br>2 - Measurement 0<br>3 - Measurement 1</td></tr>
<tr><td>ros_send_scan_data</td><td>Integer</td><td>1/2/4/8</td><td>Enable Navitrol to send scanner data to ROS (bitmap value)<br>1 - Rear (Bit 0)<br>2 - Front (Bit 1)<br>4 - Measurement 0 (Bit 2)<br>8 - Measurement 1 (Bit 3)</td></tr>
</tbody></table>
<h4 id="category-user-interface"><a class="header" href="#category-user-interface">Category: User interface</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>supervisor_eth_enabled</td><td>Integer</td><td>1</td><td>Communication with graphical user interface is enabled</td></tr>
<tr><td>supervisor_eth_ip</td><td>String</td><td>IP address of the UI</td><td>Graphical user interface IP address</td></tr>
<tr><td>supervisor_eth_port</td><td>Integer</td><td>5015</td><td>Graphical user interface IP port</td></tr>
<tr><td>supervisor_eth_server</td><td>Integer</td><td>0</td><td>Graphical user interface works as TCP client</td></tr>
<tr><td>veh_inte_error_message_type</td><td>Integer</td><td>0</td><td>Defines which error message will be sent: 0 = basic (201), 1 = with error levels (202)</td></tr>
<tr><td>veh_inte_heartbeat_interval</td><td>Integer</td><td>1000</td><td>Defines how often the error message is sent to supervisor [ms]. 0 = Periodic sending disabled</td></tr>
</tbody></table>
<h4 id="category-other"><a class="header" href="#category-other">Category: Other</a></h4>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>route_driver_enabled</td><td>Integer</td><td>1</td><td>Enable Navitrol to drive autonomously by driving commands from UI</td></tr>
</tbody></table>
<hr />
<h2 id="how-to-use-19"><a class="header" href="#how-to-use-19">How to use</a></h2>
<table><thead><tr><th>Step</th><th>Source</th><th>Input</th><th>Description</th></tr></thead><tbody>
<tr><td>1.</td><td>Terminal</td><td><code>cd /home/navitec/</code><br><code>cd ros_config/scripts/</code><br><code>./stopNavitrolAndRos.sh</code><br><code>cd /home/navitec/</code></td><td>Stop Navitrol and ROS by running the stop script in Navitrol's installation directory</td></tr>
<tr><td>2.</td><td>Terminal<br><em>OR</em><br>Windows</td><td><code>nano params.txt</code><br><em>OR</em><br>Notepad++</td><td>Make sure, that the <a href="DriveControl/RecordAndPlay/RecordAndPlay-en.html#required-parameters">required parameters</a> are set in <code>params.txt</code> as described above. There is no need for environment (<code>env*.nte</code>) and/or segment (<code>seg_*.xml</code>) file to exist beforehand in the IPC</td></tr>
<tr><td>3.</td><td>Terminal</td><td><code>./startNavitrol.sh</code></td><td>Start Navitrol and ROS by running the start script (which is automatically performed when powering up IPC)</td></tr>
<tr><td>4.</td><td>AGV</td><td><code>Manual control</code></td><td>Drive the AGV manually (AGV's own controls, Navitrol Monitor, Web UI, ...) to the starting point from which the trajectory being recorded is desired to start</td></tr>
<tr><td>5.</td><td>Windows</td><td><code>MCSClientTouchWPF.exe</code></td><td>Start <code>Record &amp; Play</code> graphical user interface (= UI) software on Windows. The following window appears</td></tr>
</tbody></table>
<p><img src="DriveControl/RecordAndPlay/./media-en/UI.PNG" alt="" /></p>
<table><thead><tr><th>Step</th><th>Source</th><th>Input</th><th>Description</th></tr></thead><tbody>
<tr><td>6.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/GearIcon.PNG" alt="" /></td><td>Click the <code>Settings</code> icon on the left side menu</td></tr>
<tr><td>7.</td><td>UI</td><td><br><code>&lt;AGV-IP&gt;</code><br><code>5015</code><br><code>navitec</code><br><code>navitrol</code></td><td>Set <br>- Machine IP address<br>- Port<br>- User name<br>- Password</td></tr>
<tr><td>8.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/ConnectIcon.PNG" alt="" /></td><td>Click the <code>Connect</code> icon below to connect to Navitrol. The icon on the right-top corner of the window should turn from <code>DISCONNECTED</code> to <code>CONNECTED</code></td></tr>
<tr><td>9.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/MapView.PNG" alt="" /></td><td>Click the <code>Map view</code> icon below the <code>CONNECTED</code> icon on the right-top corner to exit the <code>Settings</code> view</td></tr>
<tr><td>10.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/RecordMenuIcon.PNG" alt="" /></td><td>Click the <code>RECORD &amp; PLAY</code> icon on the left-bottom corner to enter <code>Record</code> view</td></tr>
<tr><td>11.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/RecordIcon.PNG" alt="" /></td><td>Click the <code>REC</code> icon on the left-top corner to start recording. The recording should start in few seconds, and the window look as below</td></tr>
</tbody></table>
<p><img src="DriveControl/RecordAndPlay/./media-en/RecordingState.PNG" alt="" /></p>
<table><thead><tr><th>Step</th><th>Source</th><th>Input</th><th>Description</th></tr></thead><tbody>
<tr><td>12.</td><td>AGV</td><td><code>Manual control</code></td><td>Drive the AGV manually (AGV's own controls, Navitrol Monitor, Web UI, ...) the path which is desired to be repeated later by Navitrol</td></tr>
<tr><td>13.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/SaveIcon.PNG" alt="" /></td><td>Once finished driving, click the <code>Save</code> icon on left-top corner</td></tr>
<tr><td>14.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/AreaName.PNG" alt="" /></td><td>A pop-window will appear requesting a name to be used for the recorded area. Type name and click <code>OK</code><br><strong>Note</strong>: If the recorded area was big, the saving process can take up to half minute</td></tr>
<tr><td>15.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/RefreshIcon.PNG" alt="" /></td><td>Refresh the list of existing area files on the left side by clicking <code>REFRESH</code></td></tr>
<tr><td>16.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/AreaList.PNG" alt="" /></td><td>Select the previously recorded area name and click <code>TAKE INTO USE</code>. The generated map and trajectory should become visible in a moment</td></tr>
</tbody></table>
<p><img src="DriveControl/RecordAndPlay/./media-en/AreaLoaded.PNG" alt="" /></p>
<table><thead><tr><th>Step</th><th>Source</th><th>Input</th><th>Description</th></tr></thead><tbody>
<tr><td>17.</td><td>AGV</td><td><code>Manual control</code></td><td>Drive the AGV manually (AGV's own controls, Navitrol Monitor, Web UI, ...) back to the starting point where the recording was started. Make sure, that the AGV is also oriented the same way as in the start of the recording</td></tr>
<tr><td>18.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/BackIcon.PNG" alt="" /></td><td>Click the <code>BACK</code> icon on left-top corner to enter the main window for giving drive orders</td></tr>
<tr><td>19.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/SymbolPoint.PNG" alt="" /><br>+<br><img src="DriveControl/RecordAndPlay/./media-en/PoseInitIcon.PNG" alt="" /></td><td>Click the start symbolic point and the <code>Position initialization</code> icon to initialize the AGV position on the start of the recorded trajectory</td></tr>
</tbody></table>
<p><img src="DriveControl/RecordAndPlay/./media-en/WrongPose.PNG" alt="" /></p>
<table><thead><tr><th>Step</th><th>Source</th><th>Input</th><th>Description</th></tr></thead><tbody>
<tr><td>20.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/SymbolPoint.PNG" alt="" /><br>+<br><img src="DriveControl/RecordAndPlay/./media-en/PlayIcon.PNG" alt="" /></td><td>Click the end symbolic point and the <code>Play</code> icon to start automatic driving. Navitrol will repeat the same trajectory as performed by the user in manual control during the recording</td></tr>
</tbody></table>
<p><img src="DriveControl/RecordAndPlay/./media-en/RightPose.PNG" alt="" /></p>
<table><thead><tr><th>Step</th><th>Source</th><th>Input</th><th>Description</th></tr></thead><tbody>
<tr><td>21.</td><td>UI</td><td><img src="DriveControl/RecordAndPlay/./media-en/PlayIcon.PNG" alt="" /></td><td>Alternatively, replay of the recorded area can be triggered directly by pressing the <code>Play</code> icon in the <code>RECORD &amp; PLAY</code> view. This will automatically initialize the position of the AGV at the start symbolic point and give a drive order to the end symbolic point</td></tr>
</tbody></table>
<h2 id="img-srcdrivecontrolrecordandplaymedia-enreplayingrecordedareapng-alt-"><a class="header" href="#img-srcdrivecontrolrecordandplaymedia-enreplayingrecordedareapng-alt-"><img src="DriveControl/RecordAndPlay/./media-en/ReplayingRecordedArea.png" alt="" /></a></h2>
<h2 id="additional-info"><a class="header" href="#additional-info">Additional info</a></h2>
<ul>
<li>
<p>Many areas can be recorded sequentially without the need of playing them in between</p>
</li>
<li>
<p>AGV pose initialization status</p>
<table><thead><tr><th>Initialized</th><th>Not initialized</th></tr></thead><tbody>
<tr><td><img src="DriveControl/RecordAndPlay/./media-en/AGVInitPose.PNG" alt="" /></td><td><img src="DriveControl/RecordAndPlay/./media-en/AGVUninitPose.PNG" alt="" /></td></tr>
</tbody></table>
</li>
<li>
<p>Recording can be aborted by clicking <code>Trash can</code> icon<br><img src="DriveControl/RecordAndPlay/./media-en/TrashCanIcon.PNG" alt="" /></p>
</li>
<li>
<p>Playing can be aborted by clicking <code>Stop</code> icon<br><img src="DriveControl/RecordAndPlay/./media-en/StopIcon.PNG" alt="" /></p>
</li>
<li>
<p>Generated environment and segment files are stored in sub directory <code>slam_maps</code></p>
</li>
</ul>
<h2 id="troubleshooting-36"><a class="header" href="#troubleshooting-36">Troubleshooting</a></h2>
<ul>
<li>From Obstacle avoidance V2 document can be found more useful hints for Docker use / issue solving</li>
</ul>
<h3 id="most-common-issues-7"><a class="header" href="#most-common-issues-7">Most common issues</a></h3>
<p><img src="DriveControl/RecordAndPlay/./media-en/ErrorIcon.PNG" alt="" /></p>
<ul>
<li>Click the <code>AGV Information</code> icon and check for active warnings and errors</li>
</ul>
<h3 id="agv-does-not-start-driving"><a class="header" href="#agv-does-not-start-driving">AGV does not start driving</a></h3>
<ul>
<li>Make sure AGV is physically at the starting symbolic point with right orientation
<ul>
<li>Initialize position on the starting symbolic point
<ul>
<li>Click the start symbolic point</li>
<li>Click the <code>Position initialization</code> icon</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="agv-stops-completely-during-driving-and-does-not-reach-the-end-symbolic-point"><a class="header" href="#agv-stops-completely-during-driving-and-does-not-reach-the-end-symbolic-point">AGV stops completely during driving and does not reach the end symbolic point</a></h3>
<ul>
<li>Check, that the generated trajectory does not have invalid direction change points (short tails / sharp corners)</li>
<li>During teaching, there must be performed enough (0.5+ m) straight overlapping driving between the incoming and outgoing paths</li>
</ul>
<p><img src="DriveControl/RecordAndPlay/./media-en/AllowedCurves.PNG" alt="" /></p>
<h3 id="map-saving-takes-too-much-time-over-maximum-30-seconds-on-large-maps-100--100-meters"><a class="header" href="#map-saving-takes-too-much-time-over-maximum-30-seconds-on-large-maps-100--100-meters">Map saving takes too much time (over maximum 30 seconds) on large maps (100+ * 100+ meters)</a></h3>
<p>Try setting parameter <code>F, ros_slam_map_resolution, 0.1</code> (min: 0.01, max: 0.1). Recommended/default value is 0.05. This parameter is not recommended to be modified (unless there is a clear need to reduce the resource usage of the IPC)</p>
<ul>
<li>Note for <code>0.1</code>: The localization parameters are likely required to be tuned to work efficiently with the significantly smaller amount of environment points, otherwise
<ul>
<li>Position can be lost (too) easily</li>
<li>Position confidence can drop significantly</li>
</ul>
</li>
<li>Note for <code>0.01</code>: Decreasing the resolution does not automatically mean better quality of the generated map
<ul>
<li>For maps smaller than 50 * 50 meters, the minimum value can be tested (in case the default <code>0.05</code> does not seem to provide accurate enough map)</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="route-free-navigation"><a class="header" href="#route-free-navigation">Route-free Navigation</a></h1>
<p>Updated 10.02.2024</p>
<h2 id="overview-33"><a class="header" href="#overview-33">Overview</a></h2>
<p>Route-free navigation is a feature that allows the AGV to plan a path to target location defined by coordinates and a heading. The path will take into account the walls defined in the environment file and avoid them. The route-free navigation doesn't require a segment file, unlike normal Navitrol navigation, but will also work with segment file present.</p>
<h3 id="introduction-42"><a class="header" href="#introduction-42">Introduction</a></h3>
<p>Route-free navigation can be used to drive the AGV directly into a desired location. It utilizes a path planning algorithm implemented in ROS to plan a route from current AGV position to a given target, based on the environment file. If combined with <a href="DriveControl/RouteFreeNavigation/../ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a> feature, the AGV can also avoid new obstacles discovered on the way. Both features use the same underlying planner.</p>
<p>The route free drive can be activated through multiple interfaces.</p>
<ul>
<li>Route-free Drive command given in Monitor</li>
<li>Command given from Navithor</li>
<li>Command given through <a href="DriveControl/RouteFreeNavigation/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Ethernet Supervisor Interface</a>
<ul>
<li>Message 3057 - Route-free Navigation Request</li>
</ul>
</li>
</ul>
<p>If connected to Navithor, the AGV will ask for permission to drive the route-free path before doing so.</p>
<h3 id="limitations-18"><a class="header" href="#limitations-18">Limitations</a></h3>
<ul>
<li>The route-free navigation can't plan arbitrarily long paths. The exact maximum path length is difficult to determine and depends on the complexity of the environment and the route</li>
<li>The feature can't plan routes that enter or exit an obstacle avoidance zone. This means, that planning a route can be successful only when the current AGV position and the given target location are both inside the same zone, or outside of any zone</li>
</ul>
<h2 id="how-to-use-20"><a class="header" href="#how-to-use-20">How to use</a></h2>
<p>To use the feature through Navitrol Monitor, connect Monitor to the AGV. There should be a button labeled &quot;Route-free Drive&quot;. When you click on this button, a green AGV outline will appear on the cursor and the button will turn green. Left-click the desired target position (coordinates) in the map. The AGV frame will be hold in that place, and the target heading of the AGV can be changed by moving the cursor around. Left-clicking again confirms the target heading and triggers the route planning. If everything goes well, the AGV will plan a path to the given location and start to drive. If there is an error, the AGV outline will turn red and there will be a warning WARNING_ROUTE_FREE_NAVIGATION_FAILED shown.</p>
<p><strong>The button in Monitor</strong></p>
<p><img src="DriveControl/RouteFreeNavigation/./media-en/route_free_drive_button.png" alt="" /></p>
<p><strong>The navigation target marker.</strong> The exact shape will depend on the shape of the AGV.</p>
<p><img src="DriveControl/RouteFreeNavigation/./media-en/navigation_target.png" alt="" /></p>
<p><strong>Driving the route-free navigation path</strong></p>
<p><img src="DriveControl/RouteFreeNavigation/./media-en/driving_a_route_free_path.png" alt="" /></p>
<p><strong>Failed to plan a path because of a wall</strong></p>
<p><img src="DriveControl/RouteFreeNavigation/./media-en/failed_drive.png" alt="" /></p>
<h2 id="set-up-9"><a class="header" href="#set-up-9">Set up</a></h2>
<h3 id="preconditions-5"><a class="header" href="#preconditions-5">Preconditions</a></h3>
<ul>
<li>The feature needs the ROS2 base Docker image to be installed. See e.g. section <a href="DriveControl/RouteFreeNavigation/../ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html#ros2-navigation2-installation">ROS2 Navigation2 installation</a> in obstacle avoidance v2 document</li>
<li>There has to be an environment file on the AGV</li>
</ul>
<h3 id="parameters-7"><a class="header" href="#parameters-7">Parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I, ros_enabled</td><td>1</td><td>Enables ROS (needed for route free navigation)</td></tr>
<tr><td>I, route_free_navigation_enabled</td><td>1</td><td>Enables route free navigation feature</td></tr>
<tr><td>F, route_free_navigation_end_straight_dist</td><td>0.3</td><td>The planner adds this long straight piece to the end of the route before the target to ensure target is reached with correct orientation</td></tr>
<tr><td>F, route_free_navigation_velocity</td><td>0.3</td><td>The velocity to use [m/s] for the routes if not otherwise specified by the command. This velocity is further limited by other factors.</td></tr>
<tr><td>I, route_free_navigation_set_rtr_bit</td><td>0</td><td>Used for compatibility with older Navithor versions. Pretends that 'Return to route' is active so Navithor allows the AGV to drive a custom route</td></tr>
</tbody></table>
<h3 id="reading-the-logs"><a class="header" href="#reading-the-logs">Reading the logs</a></h3>
<p>There is no common prefix for the log lines related to this feature, but &quot;route free&quot; and &quot;route-free&quot; are common phrases to look for.</p>
<h3 id="errors-and-warnings-16"><a class="header" href="#errors-and-warnings-16">Errors and warnings</a></h3>
<h4 id="661---warning_route_free_navigation_failed"><a class="header" href="#661---warning_route_free_navigation_failed">661 - WARNING_ROUTE_FREE_NAVIGATION_FAILED</a></h4>
<p>See <a href="DriveControl/RouteFreeNavigation/../../Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html">Error description</a>.</p>
<h2 id="troubleshooting-37"><a class="header" href="#troubleshooting-37">Troubleshooting</a></h2>
<h3 id="the-agv-frame-turns-red"><a class="header" href="#the-agv-frame-turns-red">The AGV frame turns red</a></h3>
<ul>
<li>Check that the position you have selected is not too close to a wall</li>
<li>If obstacle avoidance zones exist in the map, check that reaching the target location does not require entering or exiting an obstacle avoidance zone</li>
</ul>
<h3 id="the-button-doesnt-appear-in-monitor"><a class="header" href="#the-button-doesnt-appear-in-monitor">The button doesn't appear in Monitor</a></h3>
<ul>
<li>Check that the feature is enabled in the parameters</li>
</ul>
<h2 id="the-target-marker-is-stuck-and-doesnt-move-with-the-mouse"><a class="header" href="#the-target-marker-is-stuck-and-doesnt-move-with-the-mouse">The target marker is stuck and doesn't move with the mouse</a></h2>
<ul>
<li>Disable the tool and enable it again</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="omni-steer-limit"><a class="header" href="#omni-steer-limit">Omni Steer Limit</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="lightly-steer-limited-omni----total-range-over-180-degrees"><a class="header" href="#lightly-steer-limited-omni----total-range-over-180-degrees">Lightly steer limited omni -- total range over 180 degrees</a></h2>
<h3 id="introduction-43"><a class="header" href="#introduction-43">Introduction</a></h3>
<p><strong>Overview</strong></p>
<p>Steer limit functionality for omni drives that do not have freely turning wheels because of physical limitation, such as connected wires.</p>
<p><strong>Functionality</strong></p>
<p>The omni steer limit limits steer angles of omni AGV between the given maximum and minimum angles.</p>
<p>1. When omni's steer wheel is approaching the steer limit AGV slows down</p>
<p>2. After certain limit is reached the AGV performs wheel adjustment</p>
<ul>
<li>
<p>Performs soft stop</p>
</li>
<li>
<p>Turns wheels to the as middle of the total allowed angle range as possible</p>
</li>
<li>
<p>Resumes driving</p>
</li>
</ul>
<p>Note 1: If the steer angle gets within 5 degrees of the minimum or maximum limit the AGV will perform a hard stop instead of soft stop.</p>
<p><strong>Applicability</strong></p>
<p>Omni steer limit can be used only with omni AGV systems where Navitrol has direct control over all steer limited steering wheels.
Typical examples of such cases are AGVs with Schwarchmueller motor controllers.</p>
<h3 id="parameters-8"><a class="header" href="#parameters-8">Parameters</a></h3>
<ul>
<li>
<p><strong>I, omni_steer_limit_enable[i]</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Enables/Disables the use of omni steer limit for defined wheel
index</p>
</li>
<li>
<p>Other three parameters do not matter if this one is disabled</p>
</li>
</ul>
</li>
<li>
<p>Values</p>
<ul>
<li>
<p>Min: 0 - Omni steer limit disabled</p>
</li>
<li>
<p>Max: 1 - Omni steer limit enabled</p>
</li>
<li>
<p>Default: 0</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_CCW_angle_deg[i]</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>Defines the CounterClockWise hard limit for a single wheel</li>
</ul>
</li>
<li>
<p>Values</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 179.9 (degrees)</p>
</li>
<li>
<p>Default: 179.9 (degrees)</p>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_CW_angle_deg[i]</strong></p>
</li>
<li>
<p>Functionality</p>
<ul>
<li>Defines the ClockWise hard limit for a single wheel</li>
</ul>
</li>
<li>
<p>Values</p>
<ul>
<li>See <strong>omni_steer_limit_CCW_angle_deg[i]</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_angle_tolerance_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Defines the size of a buffer that triggers the wheel adjustment</p>
</li>
<li>
<p>Leaves some room for control so that the wheel can be adjusted before it reaches any hard limits</p>
</li>
<li>
<p>If the parameter is decreased below the default value, it is not guaranteed that the wheel never reaches the hard limits.</p>
</li>
<li>
<p>Bigger the buffer the smoother the stop to adjust the wheels will be.</p>
</li>
<li>
<p>At minimum value there will be only hard stop</p>
</li>
<li>
<p>Same value is used for all steer limited wheels</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 20</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_swap_turn_tolerance_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Determines how close to the swap target angle the wheel must be turned before wheel adjusting is considered as done</p>
</li>
<li>
<p>Smaller values are more reliable.</p>
</li>
<li>
<p>Larger values can be used for AGV:s with fast and accurate steering as they reduce some potentially redundant control.</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0.1</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 2</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_hard_stop_buffer_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Determines how close to the min and max steer limits measured angle must be before activating hard stop</p>
<ul>
<li>
<p>Min max limits defined by</p>
<ul>
<li>
<p><strong>omni_steer_limit_CCW_angle_deg</strong></p>
</li>
<li>
<p><strong>omni_steer_limit_CW_angle_deg</strong></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Activating hard stop can prevent the AGV from drifting out of route and losing position.</p>
</li>
<li>
<p>Should be adjusted only for machines with very limited total range as generally it would be better use larger <strong>omni_steer_limit_angle_tolerance_deg</strong> values so that AGV has enough time to perform slow stop.</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 5</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_active_control_before_stopping_buffer_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Determines how close to the min and max steer limits measured
angle must be before the steer reference is repelled from the
limit even if still moving</p>
</li>
<li>
<p>Using this parameter is a tradeoff for protecting the set limits and staying on the route as when the measured angle is over this limit is a strong steer reference is given away from the limit. This will cause the AGV lose position in most cases so this should be used only as last resort.</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 3</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_adjust_additional_wheels_buffer_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>When one wheel has reached the limit. This value will be added to <strong>omni_steer_limit_angle_tolerance_deg</strong> to check if multiple wheels should be adjusted simultaneously during a single stop.</p>
</li>
<li>
<p>This will not be done if the check limit would go over the defined angle range.</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 20</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_max_reference_diff_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Determines how close to the min and max steer limits the reference can ever be.</p>
</li>
<li>
<p>Example: limit 180, value 1, max reference is 179</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 1</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_soft_slow_buffer_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>This value will be added to <strong>omni_steer_limit_angle_tolerance_deg</strong> to slow down when nearing the limit.</p>
</li>
<li>
<p>This value could be increased when using very small total angle ranges (&lt; 200 deg) as the buffer sizes have to be smaller so steer limit would be met at slower speed and hard stop and active adjustment limits would not be met.</p>
<ul>
<li>The slow down target speed can be defined with parameter: pc_soft_slow_wheel_speed (default value 0.3m/s).</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 10</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_max_control_difference_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Determines the maximum difference between reference and measured
angle.</p>
</li>
<li>
<p>The reference angle will never exceed this difference.</p>
</li>
<li>
<p>Example:</p>
<ul>
<li>
<p>Navitrol would like to control a wheel to angle of 90 degrees.</p>
</li>
<li>
<p>Current angle is 0 degrees.</p>
</li>
<li>
<p>For any reason, the wheel does not follow reference and stays in zero degrees.</p>
</li>
<li>
<p>Reference angle will be increased based on <strong>mot_ctrl_max_steer_rate_deg_p_s</strong> until the defined control difference has been reached and then stays there.</p>
</li>
<li>
<p>With default value the reference would stay in 30 degrees until wheel starts to move again.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 30</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Recommended minimum total range for smooth performance is 270 degrees.</p>
<p>Minimum total range is 180 degrees in theory. (In practice &gt; 200 degrees)</p>
<p>Total range = <strong>omni_steer_limit_CCW_angle_deg + omni_steer_limit_CW_angle_deg</strong></p>
<p>Other parameters are recommended to be kept in their default values unless instructed otherwise by Navitec Systems.</p>
<h3 id="troubleshooting-38"><a class="header" href="#troubleshooting-38">Troubleshooting</a></h3>
<ul>
<li>
<p><strong>Defined steer limit is exceeded</strong></p>
<ol>
<li>
<p>Check that the limits are defined correctly</p>
<ul>
<li>
<p>Right limits for each wheel</p>
</li>
<li>
<p>CCW and CW limits are not mixed</p>
</li>
</ul>
</li>
<li>
<p>Is CCW limit or CW limit over 180 degrees?</p>
<ul>
<li>
<p>It is possible that the value stored into startinfo.bin is out of sync</p>
<ul>
<li>
<p>Shutdown Navitrol</p>
</li>
<li>
<p>Turn all wheels manually to the zero angle</p>
</li>
<li>
<p>Remove the startinfo.bin</p>
</li>
<li>
<p>Restart Navitrol</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>If steps above do not help</p>
<ul>
<li>Take a log and contact Navitec support</li>
</ul>
</li>
</ol>
</li>
<li>
<p>AGV loses position when the steer limit is reached or stops too hard</p>
<ol>
<li>
<p>Increase value of <strong>omni_steer_limit_angle_tolerance_deg</strong></p>
</li>
<li>
<p>If steps above do not help</p>
<ul>
<li>Take a log and contact Navitec support</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="heavily-steer-limited-omni----total-range-less-than-180-degrees"><a class="header" href="#heavily-steer-limited-omni----total-range-less-than-180-degrees">Heavily steer limited omni -- total range less than 180 degrees</a></h2>
<h3 id="introduction-44"><a class="header" href="#introduction-44">Introduction</a></h3>
<p>Overview</p>
<p>Steer limit functionality for omni drives that are heavily limited. A heavily limited omni drive can only turn a wheel less than 180-degree range.</p>
<h3 id="functionality"><a class="header" href="#functionality">Functionality</a></h3>
<p>The omni steer limit limits steer angles of omni AGV between the given maximum and minimum angles. It has two step protection:</p>
<p>1. In route generation</p>
<ul>
<li>
<p>Paths with higher curvature than what given limits are discarded</p>
</li>
<li>
<p>ERROR_CURVATURE_TOO_HIGH is set</p>
</li>
<li>
<p>If this happens when giving drive orders on a defined path, the path must be manually adjusted</p>
</li>
</ul>
<p>2. When calculating final references</p>
<ul>
<li>
<p>With generated routes this is only failsafe. However, driving AGV manually will use only this.</p>
</li>
<li>
<p>If required curvature would exceed the allowed limits. Maximum curvature to same direction will be used.</p>
<ul>
<li>WARNING_LIMITED_STEERING_ACTIVE is set to indicate this</li>
</ul>
</li>
<li>
<p>Waning - when curvature has been limited the AGV will drift out of the route. If it limited only briefly the AGV will be able to recover. Otherwise AGV will eventually stop with ERROR_POS_CONT_POS_ERR</p>
</li>
</ul>
<h3 id="applicability"><a class="header" href="#applicability">Applicability</a></h3>
<p>Can be used with any omni drive. However, if Navitrol does not control the wheels directly, it is user's responsibility to follow the given references.</p>
<h3 id="parameters-9"><a class="header" href="#parameters-9">Parameters</a></h3>
<ul>
<li>
<p><strong>I,omni_steer_limit_enable[i]</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Enables/Disables the use of omni steer limit for defined wheel index</p>
</li>
<li>
<p>Other parameters do not matter if this one is disabled</p>
</li>
</ul>
</li>
<li>
<p>Value: 1 = enable</p>
</li>
</ul>
</li>
<li>
<p><strong>F,omni_steer_limit_CCW_angle_deg[i]</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>Defines the CounterClockWise limit for a single wheel</li>
</ul>
</li>
<li>
<p>Values</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 180</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F,omni_steer_limit_CW_angle_deg[i]</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>Defines the ClockWise limit for a single wheel</li>
</ul>
</li>
<li>
<p>Values</p>
<ul>
<li>See <strong>omni_steer_limit_CCW_angle_deg[i]</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F,omni_steer_limit_angle_tolerance_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Defines the maximum angle tolerance left when checking the trajectory</p>
</li>
<li>
<p>Leaves some room for correcting position error while driving</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 20</p>
</li>
<li>
<p><strong>Recommended: 5</strong></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F,</strong> <strong>omni_steer_limit_max_reference_diff_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Determines how close to the min and max steer limits the reference can ever be.</p>
</li>
<li>
<p>Example: limit 180, value 1, max reference is 179</p>
</li>
<li>
<p>Is used to activate limited steering</p>
</li>
<li>
<p>Used to prevent breaking the reference if the steering control might overshoot from the given references</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 1</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>F, omni_steer_limit_swap_turn_tolerance_deg</strong></p>
<ul>
<li>
<p>Functionality</p>
<ul>
<li>
<p>Activates soft stop the difference between measured and reference values during wheel adjustment is larger than given value.</p>
</li>
<li>
<p>The parameter is used, and the soft stop can be activated only when the WARNING_LIMITED_STEERING_ACTIVE -warning is active.</p>
</li>
<li>
<p>The goal is to prevent driving before all wheels are adjusted
right angles.</p>
</li>
</ul>
</li>
<li>
<p>Values (degrees)</p>
<ul>
<li>
<p>Min: 0.1</p>
</li>
<li>
<p>Max: 90</p>
</li>
<li>
<p>Default: 2</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="single-drive-wheel-omni"><a class="header" href="#single-drive-wheel-omni">Single Drive Wheel Omni</a></h1>
<p>Updated 02.02.2024</p>
<hr />
<h2 id="overview-34"><a class="header" href="#overview-34">Overview</a></h2>
<h3 id="introduction-45"><a class="header" href="#introduction-45">Introduction</a></h3>
<p>A single drive wheel omni vehicle has several steering wheels, like any omni vehicle, but only one of them has traction. This kind of kinematics has limited omni properties, since the complete omni driving capabilities of the steering cannot be utilized as the single driving wheel is lacking a counter force from another driving wheel. It is however more agile than a steer drive as it can turn with both ends and utilize lateral driving to some extent.</p>
<p>Typical use cases are steer drives operating in limited spaces where the wide motions of curvature turning can be reduced by shifting the navigation point to a more central position. Another beneficial feature is the ability to drive sidewise without changing the vehicle heading while approaching a load or a station.</p>
<h3 id="requirements-20"><a class="header" href="#requirements-20">Requirements</a></h3>
<p><strong>Knowledge:</strong></p>
<ul>
<li>The several steering wheels requires that the vehicle is handled as an omni drive in control, calibration, safety etc.</li>
<li>The navigation point i.e., the point which is following the route can be positioned freely as on all omni drives. Thus, if a vehicle with tricycle wheel configuration has the navigation point between the rear wheels, it will normally behave like a steer drive and only steer with the rear wheels when a driving vector angle is applied. When the navigation point is somewhere else on the vehicle it behaves like an omni drive, always steering with all wheels.</li>
<li>Steering limits must be applied so that the single driving wheel never needs to pull the vehicle close to transversally, since that will cause dragging of the non driven wheels. Selecting the navigation point position is a vital part in searching for the best performance of this kind of kinematics. The closer the navigation point is to the non driven wheels, the smaller dragging and better the route following is, because the friction of the steering gives enough counter force without driving force. </li>
</ul>
<p><img src="Kinematics/OneDriveWheelOmni/./media-en/dragging_effect.png" alt="" /></p>
<blockquote>
<p>On the left, force F drags the navigation point inside the curved route as there is no driving force in the rear. Similarly, on the right the force F pushes the navigation point outside the route.</p>
</blockquote>
<ul>
<li>Pivoting is possible only with the navigation point rather close to the non driven wheels. The position of the center of mass is vital for the vehcile properties as well and the load state may also have a significant effect.</li>
</ul>
<p><img src="Kinematics/OneDriveWheelOmni/./media-en/pivoting.png" alt="" />
&gt;The driving force F drags the vehicle sideways moving the navigation point off the pivoting point along v. </p>
<p><strong>Hardware:</strong></p>
<ul>
<li>The omni kinematics requires odometry from two steering wheels for dead reckoning. This means that at least one of the steering wheels without traction must have an encoder for speed measurement. The use of both motor controller feedback and encoder measurements for speed will require calibration of two different odometry calibration parameters.</li>
<li>The drive encoders shall be absolute CAN encoders</li>
</ul>
<p><strong>Software:</strong></p>
<ul>
<li>Navitrol standalone or Navithor fleet control based production system</li>
<li>Navitrol version 6.42.00 or later</li>
<li>Currently only Schwarzmueller control and CAN drive encoders are supported over CAN interface</li>
<li>No Ethernet interface supported yet</li>
</ul>
<p><strong>Environment and routes:</strong></p>
<ul>
<li>The vehicle cannot steer accurately with any curvature. Limits based on driving tests must be applied in route design and in Navitrol wheel angle parameters. Pivoting can only be used if verified by tests. Neither Tools nor Navitrol have any active checking for maximum driving vector angle, so the route designer must take care that angles are drivabile. Completely transversal driving is in any case not possible.</li>
<li>The position of the navigation point must be selected and driving tests executed before designing the routes in Tools.</li>
</ul>
<h3 id="limitations-19"><a class="header" href="#limitations-19">Limitations</a></h3>
<ul>
<li>This kinematic solution has limited steerability as described above. Drivability constraints must be tested and observed.</li>
<li>This kinematics is currently bound to CAN controlled vehicles with Schwarzmueller controllers.</li>
</ul>
<h3 id="dependencies-13"><a class="header" href="#dependencies-13">Dependencies</a></h3>
<ul>
<li><a href="Kinematics/OneDriveWheelOmni/../../AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerParameterSetupInstructions/SchwarzmuellerParameterSetupInstructions-en.html">Scwarzmueller parameter setting</a></li>
<li><a href="Kinematics/OneDriveWheelOmni/../OmniSteerLimit/OmniSteerLimit-en.html">Omni steer limit</a></li>
<li><a href="Kinematics/OneDriveWheelOmni/../../AgvInterfaces/MotorControllers/Schwarzmueller/SchwarzmuellerSetupInstructions/SchwarzmuellerSetupInstructions-en.html">Scwarzmueller setup instructions</a></li>
<li><a href="Kinematics/OneDriveWheelOmni/../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial calibration guide</a></li>
</ul>
<hr />
<h2 id="set-up-10"><a class="header" href="#set-up-10">Set up</a></h2>
<h3 id="quick-start-12"><a class="header" href="#quick-start-12">Quick start</a></h3>
<ol>
<li>Install required hardware on the AGV to ensure driving and steering feedback from at least two wheels. One not drive controlled wheel shall have an encoder.</li>
<li>Define parameters for drives and additional sensors. Set vehicle dimension, scanner position and axle position parameters to define kinematics by navigation point position - the navigation point position defines the agility and space requirements of the AGV.</li>
<li>Calibrate the vehicle as a schwarzmueller omni drive</li>
<li>Test drivability limits to get guidelines for route design. </li>
<li>Design routes leaving margins for driving vector variation during driving.</li>
</ol>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>omni_steer_nbr</td><td>Int</td><td>min 2</td><td>Number of controlled steering wheels (as for all omnis)</td></tr>
<tr><td>mot_ctrl_omni_speed_control_used[]</td><td>Int</td><td>1</td><td>Set for wheel with speed control (in contrast to omnis, one is enough)</td></tr>
<tr><td>wheel_speed_measured_arr[]</td><td>Int</td><td>1</td><td>Set for wheel with separate speed encoder measurement</td></tr>
<tr><td>omni_deadrec_ref_axle[]</td><td>Int</td><td>1</td><td>Set for the two wheels selected for dead reckoning (as for all omnis)</td></tr>
<tr><td>can_enc_drive_node_id_arr[]</td><td>Int</td><td>0...127</td><td>0 = disabled, 1...127 node ID</td></tr>
<tr><td>can_enc_drive_model_arr[]</td><td>Int</td><td>0...2</td><td>0 = generic (no config) 1 = Leine&amp;Linde (RSA608), 2 = Sick (AHS/AHM36)</td></tr>
<tr><td>can_enc_drive_pulses_per_rev_arr[]</td><td>Int</td><td>N</td><td>encoder pulses per revolution</td></tr>
<tr><td>can_enc_drive_pulses_overflow_arr[]</td><td>Int</td><td>N</td><td>maximum encoder value</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="actuator-control-3"><a class="header" href="#actuator-control-3">Actuator control</a></h1>
<p>Updated 17.06.2024</p>
<hr />
<h2 id="glossary-16"><a class="header" href="#glossary-16">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Software that corrects the position of the AGV</td></tr>
<tr><td>Navithor Server</td><td>Fleet control software</td></tr>
<tr><td>Navithor Client</td><td>Client monitoring software for Fleet control</td></tr>
<tr><td>Navithor Machine Tools</td><td>Machine creator tool</td></tr>
<tr><td>Navithor Tools</td><td>Software to create environments and routes</td></tr>
<tr><td>Navitrol Monitor</td><td>Software to monitor and diagnose AGV</td></tr>
<tr><td>Lift</td><td>Device above the AGV moving up and down.</td></tr>
<tr><td>Forklift</td><td>Fork device for moving pallets</td></tr>
<tr><td>VNA</td><td>Very Narrow Aisle AGV</td></tr>
</tbody></table>
<hr />
<h2 id="overview-35"><a class="header" href="#overview-35">Overview</a></h2>
<h3 id="introduction-46"><a class="header" href="#introduction-46">Introduction</a></h3>
<p>This document describes how to control different actuators with Navitrol
software. In a typical case actuator is used to for example picking up or dropping off pallets. </p>
<ul>
<li>Description of the actuator control
<ul>
<li>Control methods</li>
<li>Parameters in Navitrol and Navithor Machine tool</li>
<li>Different actuator types</li>
<li>Load and unload sequences</li>
</ul>
</li>
<li>Sensors
<ul>
<li>Load sensor handling</li>
<li>Errors</li>
</ul>
</li>
<li>Interface to Navithor</li>
<li>Route properties for the actuator in Navithor Tool</li>
<li>Test and monitor actuator control with Navitrol Monitor</li>
<li>Control interfaces
<ul>
<li>CAN Open
<ul>
<li>Schwarzmueller</li>
<li>Curtis</li>
<li>Custom specific CAN interfaces</li>
</ul>
</li>
<li>Ethernet
<ul>
<li>Supervisor status actuator section</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>If you are looking for document about scanner lift actuator, that can be found here: <a href="LoadHandling/ActuatorControl/../../LoadHandling/ScannerLiftActuator/ScannerLiftActuator-en.html">Scanner lift actuator</a>.</p>
<h3 id="requirements-21"><a class="header" href="#requirements-21">Requirements</a></h3>
<ul>
<li>Control interface
<ul>
<li>Encoder or similar sensor for measuring actuator position</li>
<li>Sensors to tell actuator to stop (e.g. low and high limit sensors for lifting table)</li>
<li>Possibility to control actuator to given reference or direction</li>
</ul>
</li>
<li>Fork height should be in mm and relative to the floor level</li>
<li>Position control system required
<ul>
<li>Actuator control logic uses trajectory and symbolic points</li>
</ul>
</li>
</ul>
<h3 id="limitations-20"><a class="header" href="#limitations-20">Limitations</a></h3>
<ul>
<li>Works only on position control systems</li>
</ul>
<h3 id="dependencies-14"><a class="header" href="#dependencies-14">Dependencies</a></h3>
<ul>
<li>Interface to control the actuator. </li>
</ul>
<hr />
<h2 id="setup-22"><a class="header" href="#setup-22">Setup</a></h2>
<h3 id="quick-start-13"><a class="header" href="#quick-start-13">Quick start</a></h3>
<h4 id="example-parameter-setup-for-reference-controlled-fork"><a class="header" href="#example-parameter-setup-for-reference-controlled-fork">Example parameter setup for reference controlled fork</a></h4>
<p><strong>Navitrol params.txt</strong></p>
<pre><code class="language-bash">I,actuator_type, 2 #Reference controlled actuator

I,actuator_outer_tolerance_mm, 10 # Outer tolerance

I,actuator_inner_tolerance_mm, 3 # Inner tolerance

I,actuator_load_aboard_offset_mm, 150 # Load offset

I,actuator_only_on_sp, 0 # Allow actuator to move also when AGV is not at symbolic point

I,actuator_allow_activation_mode, 1 # 0 = allow actuator &gt; activation only in load state, 1 = to move actuator in auto, 2 = &gt; enable protection zone override in standby&amp;auto&quot;

I,actuator_trust_io_load_status, 0 # Use Navithor load status or load sensor

I,actuator_val_io, -1 # &quot;Int io num to fleet control, -1 = disabled&quot;

I,actuator_load_det_io, -1 # &quot;Bin io num to fleet control, -1 = disabled&quot;

I,actuator_load_status_io, -1 # &quot;Load status to fleet control, -1 = disabled&quot;

I,actuator_min_val, 0 # Minimum value in [mm]

I,actuator_load_min_val, 0 # Minimum value with load in [mm]

I,actuator_max_val, 1000 # Maximum value in [mm]

I,actuator_timer_s, 20 # Watchdog timer
</code></pre>
<p><strong>Machine Tool parameter file</strong></p>
<pre><code class="language-bash">Required parameters:

ACTUATOR_TYPE = 1 (Fork)

ACTUATOR_MIN_VAL = 0 # Should be same as the actuator_min_val

ACTUATOR_LOAD_MIN_VAL = 0 # Should be same as the actuator_load_min_val
</code></pre>
<p><strong>Reference controlled actuator</strong></p>
<ul>
<li>Set parameters
<ul>
<li><strong>actuator_type</strong> should be 2</li>
</ul>
</li>
<li>Open Monitor and connect it to the AGV
<ul>
<li>Open &quot;Actuator Control&quot; form from the &quot;Navitrol&quot; tab</li>
<li>Press &quot;Take Control&quot; button</li>
<li>Set Reference value to 200 and press &quot;Send&quot; button</li>
<li>Actuator should move to 200</li>
</ul>
</li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/Actuator_control_form_reference.png" alt="" /></p>
<blockquote>
<p>Actuator Control form with reference controlled actuator</p>
</blockquote>
<p><strong>Binary controlled actuator</strong></p>
<ul>
<li>Set parameters
<ul>
<li><strong>actuator_type</strong> should be 3</li>
</ul>
</li>
<li>Open Monitor and connect it to the AGV
<ul>
<li>Open &quot;Actuator Control&quot; form from the &quot;Navitrol&quot; tab</li>
<li>Press &quot;Take Control&quot; button</li>
<li>Press &quot;Increase&quot; button</li>
<li>Actuator should move to up position</li>
</ul>
</li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/Actuator_control_form_binary.png" alt="" /></p>
<blockquote>
<p>Actuator Control form with binary controlled actuator</p>
</blockquote>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_type</td><td>Int</td><td>2 or 3</td><td>0 = disabled, 1 = manual control, 2 = reference value controlled actuator, 3 = binary controlled actuator (low/high pos only). Navitrol can control the actuator either based on the reference height [mm] or only based on the high and low limit switches. Actuator can also be set to manual control when Navitrol is not giving commands but only listens the incoming measurements.</td></tr>
<tr><td>actuator_outer_tolerance_mm</td><td>Int</td><td>5</td><td>Navitrol activates control when measured value differs more than outer tolerance value from the reference. Used only with reference value controlled actuators.</td></tr>
</tbody></table>
<h3 id="fine-tuning-9"><a class="header" href="#fine-tuning-9">Fine-tuning</a></h3>
<p><strong>Reference controlled fork parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_inner_tolerance_mm</td><td>Int</td><td>-1</td><td>Navitrol stops to control the fork/lift when measured value is within (inner) tolerance compared to requested reference value. Can be used if actuator is required to be more accurately on the reference</td></tr>
<tr><td>actuator_inner_tolerance_timer_ms</td><td>Int</td><td>0</td><td>Time that measured value has to be inside inner tolerance value until actuator control is stopped</td></tr>
<tr><td>actuator_min_val</td><td>Int</td><td>0</td><td>Minimum value where the actuator can be controlled</td></tr>
<tr><td>actuator_max_val</td><td>Int</td><td>800</td><td>Maximum value where the actuator can be controlled</td></tr>
<tr><td>actuator_load_min_val</td><td>Int</td><td>200</td><td>Minimum height where the actuator is controlled when AGV has load.</td></tr>
<tr><td>actuator_load_aboard_offset_mm</td><td>Int</td><td>0</td><td>Offset that is added to reference height when AGV has load</td></tr>
<tr><td>actuator_home_val_mm</td><td>Int</td><td>0</td><td>Height where the actuator is controlled when AGV is inside ActuatorInHomePositionZone. Limits AGV speed to <strong>actuator_not_in_home_position_agv_speed_loaded_m_per_s</strong> or <strong>actuator_not_in_home_position_agv_speed_unloaded_m_per_s</strong> if actuator is not at correct height when AGV comes inside the zone. Takes <strong>actuator_load_min_val</strong> and <strong>actuator_load_aboard_offset_mm</strong> into account.</td></tr>
<tr><td>actuator_eth_ctrl_scale</td><td>Int</td><td>10</td><td>Scale for ethernet supervisor actuator (e.g. lift height) control. Used in Supervisor message ID 6001 or Supervisor status message ID 3002 section 6</td></tr>
<tr><td>actuator_disable_safety_max_value_mm</td><td>Int</td><td>0</td><td>Disable safety if actuator is lower than this value, 0 = not used</td></tr>
<tr><td>docking_limit_leave_speed_and_actuator_height_dist</td><td>Float</td><td>-1.0</td><td>Distance from the drop-off location, where the fork height is limited to the current height. If negative, they are not limited. If enabled, had to be smaller than <strong>docking_mode_to_fleet_control_dist</strong> parameter.</td></tr>
<tr><td>disable_safety_distance_on_buffer</td><td>Float</td><td>-1.0</td><td>Set actuator target val to <strong>actuator_min_val</strong> if driving closer than this distance to detected target in pickup buffer, Negative or zero not used. Used only if <strong>load_buffer_mode</strong> is 1 or 2</td></tr>
<tr><td>buffer_stop_AGV_when_decreasing_fork_before_load</td><td>Int</td><td>1</td><td>0 = Allow AGV drive while decreasing the fork, 1 = stop the AGV until the fork is decreased to the floor level. Used only if <strong>disable_safety_distance_on_buffer</strong> is used.</td></tr>
<tr><td>actuator_filter_single_zeros</td><td>Int</td><td>0</td><td>Filter a single zero from actuator measurements. 0 = Disabled, 1 = Enabled. Can be used to filter out single fork height measurements that are zero.</td></tr>
<tr><td>actuator_not_in_home_position_limit_agv_speed</td><td>Int</td><td>0</td><td>Limit AGV speed if actuator is not in home position: 0 = Speed not limited, 1 = Speed limited</td></tr>
<tr><td>actuator_not_in_home_position_agv_speed_loaded_m_per_s</td><td>Float</td><td>1.0</td><td>AGV speed when actuator is not in home position and actuator is loaded. Meters per second</td></tr>
<tr><td>actuator_not_in_home_position_agv_speed_unloaded_m_per_s</td><td>Float</td><td>1.0</td><td>AGV speed when actuator is not in home position and actuator is not loaded. Meters per second</td></tr>
<tr><td>actuator_home_pos_safety_margin_meters</td><td>Float</td><td>0.5</td><td>Safe area around AGV to keep the actuator at the home position</td></tr>
<tr><td>actuator_strict_for_home_pos_zone</td><td>Int</td><td>1</td><td>Use strict property for actuator when AGV is inside ActuatorInHomePositionZone. 1 = enabled, 0 = disabled</td></tr>
<tr><td>actuator_keep_height_after_dropoff_aborted_distance_m</td><td>Float</td><td>2.0</td><td>Distance from aborted dropoff location in meters to keep the actuator at current height.</td></tr>
</tbody></table>
<p><strong>General parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_simulate</td><td>Int</td><td>1</td><td>0 = don't change actuator measurements when in sim mode, 1 = calculate simulated actuator measurement values when Navitrol is running in Navitrol sim mode</td></tr>
<tr><td>actuator_timer_s</td><td>Int</td><td>20</td><td>ERROR_POS_CONT_FORK_TIME_ERR error is set if actuator control is not stopped within this time limit</td></tr>
<tr><td>actuator_only_on_sp</td><td>Int</td><td>0</td><td>0 = normal control, 1 = allow (un)load only on top of (un)load symbolic point.</td></tr>
<tr><td>actuator_max_dist_err_from_sp</td><td>Float</td><td>0.0</td><td>0 = not used, otherwise if dist err from (un)load point over this (in meters), block actuator control and sets an error</td></tr>
<tr><td>actuator_allow_activation_mode</td><td>Int</td><td>1</td><td>0 = allow actuator activation only in load state, 1 = to move actuator in auto, 2 = enable protection zone override in standby&amp;auto. Mode 2 only set activate actuator bit to 1, so the protection zone is just customer interface specific feature</td></tr>
<tr><td>actuator_val_io</td><td>Int</td><td>-1</td><td>Actuator measured value to fleet control. Overrides one physical Integer input value, -1 = disabled. Not recommended to use.</td></tr>
<tr><td>actuator_load_det_io</td><td>Int</td><td>-1</td><td>If load sensor is used or parameter actuator_trust_io_load_status activated, sends the load status to the fleet control as a Physical Binary Input, -1 = disabled. Not recommended to use.</td></tr>
<tr><td>actuator_load_det_io_type</td><td>Int</td><td>-1</td><td>Define what load status type is sent to fleet control via binary input. 0 = load sensor raw data, 1 = AGV load status. Not recommended to use.</td></tr>
<tr><td>actuator_load_status_io</td><td>Int</td><td>-1</td><td>Load status to fleet control as a Physical Binary Input, -1 = disabled. Not recommended to use.</td></tr>
<tr><td>actuator_load_sequence[10]</td><td>Int</td><td>0</td><td>Loading sequence: 0=none, 1=load, 2=unload, 3=reachFw, 4=reachHome, 5=tiltDn, 6=tiltHome, 7=tiltUp, 8=sideLeft, 9=sideHome, 10=sideRight, 11=notUsed, 12=auxLiftUp, 13=auxLiftDown. Used to define what actuators have to be moved in which sequence when picking up something</td></tr>
<tr><td>actuator_unload_sequence[10]</td><td>Int</td><td>0</td><td>Unloading sequence: 0=none, 1=load, 2=unload, 3=reachFw, 4=reachHome, 5=tiltDn, 6=tiltHome, 7=tiltUp, 8=sideLeft, 9=sideHome, 10=sideRight, 11=notUsed, 12=auxLiftUp, 13=auxLiftDown. Used to define what actuators have to be moved in which sequence when dropping off something</td></tr>
<tr><td>actuator_move_allowed_while_driving_loaded</td><td>Int</td><td>1</td><td>0 = AGV may not move the actuator while driving and loaded, 1 = AGV may move the actuator while driving and loaded</td></tr>
<tr><td>actuator_move_allowed_while_driving_not_loaded</td><td>Int</td><td>1</td><td>0 = AGV may not move the actuator while driving and not loaded, 1 = AGV may move the actuator while driving and not loaded</td></tr>
<tr><td>actuator_safety_zone_margin_meters</td><td>Float</td><td>0.5</td><td>Safe area around AGV to prevent moving fork near racks</td></tr>
<tr><td>trigger_load_unload_sequence_from_poscont</td><td>Int</td><td>0</td><td>0 = no effect, 1 = trigger pickup/drop-off sequence, when AGV arrives at pickup/drop-off symbolic point. Pickup or drop-off is decided based on Navitrol load status. Should be used only if there is no fleet control.</td></tr>
<tr><td>fork_pos_x</td><td>Float</td><td>0.0</td><td>Actuator longitudinal offset relative to the navigation point. Used to stop AGV with this offset when driving to the Pickup or Dropoff points. See Chapter <em>AGV stop offset based on actuator position</em> for more info.</td></tr>
<tr><td>apply_actuator_offset_dist</td><td>Float</td><td>0.5</td><td>Distance in meters from end symbolic point to start applying actuator stop offset. If AGV is going to stop before symbolic point, fork_pos_x is added to this distance. If AGV is going to stop after, custom route is created when AGV is within this distance. Not used if <strong>fork_pos_x</strong> is 0.0</td></tr>
<tr><td>actuator_input_source_arr[20]</td><td>Int</td><td>0</td><td>Defines from which source actuator input is read: 0 = System selects, 1 = CAN Actuator/Encoder, 2 = Supervisor status section, 3 = Supervisor msg 1031, 4 = ROS, 10 = Custom CAN, 11 = Custom Modbus, 12 = Custom Supervisor</td></tr>
<tr><td>actuator_input_type_arr[20]</td><td>Int</td><td>0</td><td>Defines the actuator input source for specific actuator type: 0 = All types, 1 = Lift, 2 = Secondary Lift, 3 = Reach, 4 = Tilt up/down, 5 = Turn fork, 6 = Side shift, 7 = Sensor lift</td></tr>
<tr><td>actuator_periodic_status_update_interval_ms</td><td>Int</td><td>0</td><td>Time interval [ms] for sending actuator status to fleet control. 0 = Periodic update disabled. <br/>Recommended for projects in which Navithor requires periodic actuator status such as fork height. When periodic sending is disabled, the actuator status is updated to Navithor only when an (un)load action is performed.</td></tr>
</tbody></table>
<p><strong>CAN actuator parameters</strong></p>
<p>These parameters are used if Navitrol calculates output value for the controller. For example schwarzmueller, curtis or custom CAN interface. The array index is the index of the actuator controller. There can be in total of 5 actuator controllers at the same time.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>can_actuator_ctrl_model[5]</td><td>Int</td><td>0</td><td>Can actuator controller, 0 = None, 1 = Schwarzmueller (reference). 2 = Curtis (reference/binary)</td></tr>
<tr><td>can_actuator_ctrl_node_id[5]</td><td>Int</td><td>1.0</td><td>Can actuator controller node id, 0 = disabled</td></tr>
<tr><td>can_actuator_ctrl_torque[5]</td><td>Int</td><td>0</td><td>Motor control torque</td></tr>
<tr><td>can_actuator_ctrl_rpm_to_m_per_s[5]</td><td>Float</td><td>1.0</td><td>Motor control convert rpm to m/s. For Curtis, should be set between to actuator max speed / 32767</td></tr>
<tr><td>can_actuator_ctrl_prop_valve_idx[5]</td><td>Int</td><td>0</td><td>Proportional valve index. For Schwarzmueller - 1 (pin27) or 2 (pin16). For Curtis F2-T - 0 (pin 2) or 1 (pin 19)</td></tr>
<tr><td>can_actuator_ctrl_prop_valve_max[5]</td><td>Int</td><td>200</td><td>Proportional valve max output. For Curtis, should be set between 0-32767</td></tr>
<tr><td>can_actuator_ctrl_prop_valve_min[5]</td><td>Int</td><td>0</td><td>Proportional valve min output</td></tr>
</tbody></table>
<p><strong>CAN encoder parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>can_enc_actuator_node_id[5]</td><td>Int</td><td>0</td><td>0 = disabled, 1...127</td></tr>
<tr><td>can_enc_actuator_coeff[5]</td><td>Float</td><td>1.0</td><td>Convert pulses to meters/radians</td></tr>
<tr><td>can_enc_actuator_calib_val_enc[5]</td><td>Int</td><td>0</td><td>encoder value that matches actuator calibration value</td></tr>
<tr><td>can_enc_actuator_calib_val_act[5]</td><td>Float</td><td>0.0</td><td>actuator value that matches encoder calibration value</td></tr>
<tr><td>can_enc_actuator_pulses_overflow[5]</td><td>Uint</td><td>0xFFFFFFFU</td><td>maximum encoder value</td></tr>
<tr><td>can_enc_actuator_pulses_per_rev[5]</td><td>Int</td><td>1000</td><td>encoder pulses per revolution</td></tr>
<tr><td>can_enc_actuator_inv[5]</td><td>Uint</td><td>0</td><td>inverse the value from encoder</td></tr>
<tr><td>can_enc_actuator_model[5]</td><td>Int</td><td>0</td><td>0 = generic (no config), 1 = Leine&amp;Linde (RSA608), 2 = Sick (AHS/AHM36)</td></tr>
</tbody></table>
<p><strong>Low-level control parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_ctrl_i[5]</td><td>Float</td><td>1.0</td><td>I control value</td></tr>
<tr><td>actuator_ctrl_p[5]</td><td>Float</td><td>1.0</td><td>P control value for direct actuator control</td></tr>
<tr><td>actuator_ctrl_speed[5]</td><td>Float</td><td>0.2</td><td>Speed target for the actuator</td></tr>
<tr><td>actuator_ctrl_max_acc[5]</td><td>Float</td><td>1.0</td><td>Acceleration ramps for control</td></tr>
<tr><td>actuator_ctrl_min_output[5]</td><td>Float</td><td>30.0</td><td>Minimum output for actuator control</td></tr>
<tr><td>actuator_ctrl_max_output[5]</td><td>Float</td><td>5000.0</td><td>Maximum output for actuator control. For curtis, should be typically set to 32767</td></tr>
<tr><td>actuator_ctrl_slow_fraction[5]</td><td>Float</td><td>0.5</td><td>Limits the maximum output by the percentage value 0-1 (0-100%) when soft stop is active. 1 means no limitation.</td></tr>
<tr><td>actuator_ctrl_pos_multi[5]</td><td>Float</td><td>1.0</td><td>Control output multiplier for positive control direction</td></tr>
<tr><td>actuator_ctrl_inv_out[5]</td><td>Int</td><td>0</td><td>Inverse output</td></tr>
<tr><td>actuator_crawl_speed</td><td>Float</td><td>0.01</td><td>Actuator speed when close to target</td></tr>
<tr><td>actuator_crawl_dist</td><td>Float</td><td>0.05</td><td>Distance (m) from stopping point to move actuator with a slower speed</td></tr>
<tr><td>actuator_speed_lowpass_alpha</td><td>Float</td><td>0.25</td><td>Low-pass filter coefficient</td></tr>
</tbody></table>
<p><strong>Load sensor parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_trust_io_load_status</td><td>Int</td><td>0</td><td>0 = Load status is decided based on load sensor or based on pickup or drop-off action if there is no sensor. 1 = load status is decided based on low limit and high limit bits (binary actuator), 2 = AGV has a load if lift actuator measured height is higher than <strong>actuator_load_min_val</strong>, otherwise AGV load status will be set empty.</td></tr>
<tr><td>actuator_disable_load_sensor_distance</td><td>Float</td><td>0.8</td><td>Within the distance, in meters, from pickup/drop-off point, load sensor is not used when driving. Used to avoid load sensor to detect the load too early if for example the sensor is able to detect the load before AGV has driven all the way under the pallet</td></tr>
<tr><td>actuator_check_load_sensor_status_before_loading</td><td>Int</td><td>0</td><td>1 = check that load sensor shows a load detected, before performing pickup action. This check is also done during the pickup action. 0 = load sensor is not checked before pickup.</td></tr>
<tr><td>actuator_check_load_sensor_status_after_loading</td><td>Int</td><td>1</td><td>1 = check that load sensor shows a load detected, after performing pickup action. 0 = load sensor is not checked after pickup.</td></tr>
<tr><td>actuator_check_load_sensor_status_after_unloading</td><td>Int</td><td>0</td><td>1 = check that load sensor shows empty, after performing drop-off action. 0 = load sensor is not checked after drop-off.</td></tr>
<tr><td>change_load_status_only_on_load_state</td><td>Int</td><td>0</td><td>0 = Change load status based on load sensor in every state, 1 = Change load status based on sensor only on Load state, 2 = Similar as mode 1, but also changes load status if Navithor and load sensor says empty, but Navigation SW status is full</td></tr>
<tr><td>min_distance_to_check_the_load_sensor</td><td>Float</td><td>0.3</td><td>Minimum distance to check the load sensor. Used to avoid false checks if sensor gives bad data. The check starts at <strong>actuator_disable_load_sensor_distance</strong>. If set to -1.0, check is not used.</td></tr>
<tr><td>load_sensor_conflict_goes_to_manual</td><td>Int</td><td>0</td><td>0 = Load sensor conflict raises error. 1 = Conflict changes the state to Manual. <strong>load_sensor_conflict_manual_reset_source</strong> parameter tells the source to release the Manual state after the load sensor is okay.</td></tr>
<tr><td>load_sensor_conflict_manual_reset_source</td><td>Int</td><td>1</td><td>0 = none, 1 = Manual state is released from supervisor, 2 = Manual state is released using UI</td></tr>
<tr><td>load_sensor_conflict_mode</td><td>Int</td><td>2</td><td>0 = disable, 1 = Trigger error if sensor does not match with the Navithor load status. Check is done at <strong>actuator_disable_load_sensor_distance</strong> from symbolic point, at the beginning of the buffer lanes and when state is changed from Manual. 2 = Trigger error if sensor does not match with the Navithor load status in Auto state.</td></tr>
<tr><td>load_sensor_status_change_timer_ms</td><td>Int</td><td>2000</td><td>Error is set if load sensor status changes in Auto state and stays in new value for this amount of time (ms)</td></tr>
<tr><td>navithor_load_status_reset_on_pickup_dropoff_abort</td><td>Int</td><td>0</td><td>0 = navithor load status is not changed on aborted pickup/dropoff, 1 = navithor load status is reset to value it was before pickup/dropoff if pickup/dropoff is aborted</td></tr>
</tbody></table>
<p><strong>Reach actuator parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_reach_enabled</td><td>Int</td><td>0</td><td>Enable reach actuator. Used for example on sideloaders and VNA trucks</td></tr>
<tr><td>actuator_tolerance_reach_mm</td><td>Int</td><td>0</td><td>Tolerance for reach actuator. Similar as <strong>actuator_outer_tolerance_mm</strong></td></tr>
<tr><td>actuator_reach_home_val</td><td>Int</td><td>0</td><td>Home value for reach to be controlled inside the AGV body. In mm.</td></tr>
<tr><td>actuator_reach_load_val</td><td>Int</td><td>0</td><td>Target value where the reach is controlled when AGV is picking up a load and reach is extended.</td></tr>
<tr><td>actuator_reach_unload_val</td><td>Int</td><td>0</td><td>Target value where the reach is controlled when AGV is dropping off a load and reach is extended.</td></tr>
</tbody></table>
<p><strong>Fork tilt actuator parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_tilt_enabled</td><td>Int</td><td>0</td><td>Enable fork tilt actuator, to move the fork down and up relative to the fork base.</td></tr>
<tr><td>actuator_tolerance_tilt_deg</td><td>Float</td><td>0.0</td><td>Tolerance for fork tilt actuator. Similar as <strong>actuator_outer_tolerance_mm</strong></td></tr>
<tr><td>actuator_tilt_home_val_deg</td><td>Float</td><td>0.0</td><td>Target value for tilt when it is controlled to home</td></tr>
<tr><td>actuator_tilt_dn_val_deg</td><td>Float</td><td>0.0</td><td>Target value for tilt when it is controlled to down position</td></tr>
<tr><td>actuator_tilt_up_val_deg</td><td>Float</td><td>0.0</td><td>Target value for tilt when it is controlled to up position</td></tr>
</tbody></table>
<p><strong>Fork side shift actuator parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_side_shift_enabled</td><td>Int</td><td>0</td><td>Enable fork side shift, to move the fork sideways</td></tr>
<tr><td>actuator_tolerance_side_mm</td><td>Int</td><td>0</td><td>Tolerance for fork sideshift actuator. Similar as <strong>actuator_outer_tolerance_mm</strong></td></tr>
<tr><td>actuator_side_shift_home_val</td><td>Int</td><td>0</td><td>Target value for side shift when it is controlled to middle position. Used if <strong>actuator_load_sequence</strong> or <strong>actuator_unload_sequence</strong> is set to 9 or if racking is active and actuator is controlled to normal driving level</td></tr>
<tr><td>actuator_side_shift_left_val</td><td>Int</td><td>0</td><td>Target value for side shift when it is controlled to left position. Used only if <strong>actuator_load_sequence</strong> or <strong>actuator_unload_sequence</strong> is set to 8</td></tr>
<tr><td>actuator_side_shift_right_val</td><td>Int</td><td>0</td><td>Target value for side shift when it is controlled to right position. Used only if <strong>actuator_load_sequence</strong> or <strong>actuator_unload_sequence</strong> is set to 10</td></tr>
</tbody></table>
<p><strong>Secondary lift actuator parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_auxiliary_lift_enabled</td><td>Int</td><td>0</td><td>Enable secondary lift. Two use-cases: On a two-masted fork, where the main mast is controlled as main fork and smaller mast is this secondary lift and used as pickup and dropoff actuator. Second lifting table on AGV that has two lifting tables.</td></tr>
<tr><td>actuator_auxiliary_lift_type</td><td>Int</td><td>2</td><td>Min 1, max 3. 1 = manual control, 2 = reference value controlled actuator, 3 = binary controlled actuator (low/high pos only)</td></tr>
<tr><td>actuator_auxiliary_lift_tolerance_mm</td><td>Int</td><td>2</td><td>Tolerance for secondary lift actuator. Similar as <strong>actuator_outer_tolerance_mm</strong></td></tr>
<tr><td>actuator_auxiliary_lift_min_val_mm</td><td>Int</td><td>0</td><td>Minimum value where the lift can be controlled. Used as a target value when AGV is empty and as a dropoff target if <strong>actuator_unload_sequence</strong> is 13</td></tr>
<tr><td>actuator_auxiliary_lift_max_val_mm</td><td>Int</td><td>3000</td><td>Maximum value where the lift can be controlled</td></tr>
<tr><td>actuator_auxiliary_lift_load_val_mm</td><td>Int</td><td>100</td><td>Value where the lift is controlled when AGV has load. Used as pickup target if <strong>actuator_load_sequence</strong> is 12</td></tr>
<tr><td>actuator_auxiliary_lift_as_secondary_lifting_device</td><td>Int</td><td>0</td><td>Auxiliary lift is used as secondary lifting device meaning that both main lift and secondary lift can have load separately. For example AGV with two lifting tables</td></tr>
</tbody></table>
<p><strong>Fork rotate actuator parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_rotate_enabled</td><td>Int</td><td>0</td><td>Enable fork rotate. Used to rotate fork relative to the AGV body. For example VNA truck that can rotate the fork from left side to right side</td></tr>
<tr><td>actuator_rotate_tolerance_deg</td><td>Float</td><td>1.0</td><td>Tolerance for rotate actuator. Similar as <strong>actuator_outer_tolerance_mm</strong></td></tr>
<tr><td>actuator_rotate_min_val_deg</td><td>Float</td><td>0.0</td><td>Minimum value where the rotate fork can be controlled</td></tr>
<tr><td>actuator_rotate_max_val_deg</td><td>Float</td><td>180.0</td><td>Maximum value where the rotate fork can be controlled</td></tr>
</tbody></table>
<!-- These parameters are not used yet, but they are added to the code for later use. When the functionality will be added, uncomment these lines.
| actuator_rotate_middle_val_deg | Float | 0.0   | Rotate middle value in degrees. Relative to the AGV frame. Used as a target when this actuator is controlled to the middle position |
| actuator_rotate_right_val_deg  | Float | 0.0   | Rotate right value in degrees. Relative to the AGV frame. Used as a target when this actuator is controlled to the right position |
| actuator_rotate_left_val_deg   | Float | 0.0   | Rotate left value in degrees. Relative to the AGV frame. Used as a target when this actuator is controlled to the left position |
-->
<p><strong>Scanner lift actuator parameters</strong></p>
<p>See <a href="LoadHandling/ActuatorControl/../../LoadHandling/ScannerLiftActuator/ScannerLiftActuator-en.html">Scanner lift document</a></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>actuator_scanner_lift_enabled</td><td>Int</td><td>0</td><td>Enable scanner lift that is attached to the fork. This actuator will move relative to the fork</td></tr>
<tr><td>actuator_scanner_lift_type</td><td>Int</td><td>2</td><td>1 = manual control, 2 = reference value controlled actuator, 3 = binary controlled actuator (low/high pos only)</td></tr>
<tr><td>actuator_tolerance_scanner_lift_mm</td><td>Int</td><td>2</td><td>Tolerance for scanner lift actuator. Similar as <strong>actuator_outer_tolerance_mm</strong></td></tr>
<tr><td>actuator_scanner_lift_home_val_mm</td><td>Int</td><td>0</td><td>Home value for scanner. Should be safe with any fork height and a bit above the fork level if used for load detection</td></tr>
<tr><td>actuator_scanner_lift_detection_level_val_mm</td><td>Int</td><td>-150</td><td>Scanner height value in witch the scanner can see past a loaded resource.</td></tr>
<tr><td>actuator_scanner_lift_min_safe_val_mm</td><td>Int</td><td>100</td><td>Minimum allowed difference from the fork's zero level to scanner val</td></tr>
<tr><td>actuator_lower_scanner_before_unload_buffer_dist</td><td>Float</td><td>0.6</td><td>Distance from unload buffer when scanner is lowered (in meters). Takes <strong>buffer_check_start_dist_offset_m</strong> into account.</td></tr>
</tbody></table>
<!-- This parameter is not used for anything, but it is added to the code if that load detection feature would be done in the future 
| actuator_scanner_lift_used_for_load_det          | Int   | 0    | Scanner in lift is used for load detection. 0 = No, 1 = Yes | 
-->
<hr />
<h2 id="how-to-use-21"><a class="header" href="#how-to-use-21">How to use</a></h2>
<h3 id="actuator-height-while-agv-is-loaded-with-a-resource"><a class="header" href="#actuator-height-while-agv-is-loaded-with-a-resource">Actuator height while AGV is loaded with a resource</a></h3>
<p>Normally Route property &quot;Actuator height&quot; (defined in Navithor Tools ) defines the reference height for the actuator. 
However, it is possible to have <em>absolute minimum</em> height position for the actuator while AGV has load ON.</p>
<ul>
<li>
<p>I, actuator_load_min_val, 200</p>
<ul>
<li>Example: If Actuator height in the route property is set to 0 mm and <strong>actuator_load_min_val</strong> is set to 200 mm:
AGV is loaded -&gt; Actuator is lifted to <strong>actuator_load_min_val</strong> since the route value is less than <strong>actuator_load_min_val</strong></li>
</ul>
</li>
</ul>
<p><em>Additional offset</em> height for the actuator while AGV has load ON. This shall be an additional height increase to Route property &quot;Actuator height&quot;.</p>
<ul>
<li>
<p>I, actuator_load_aboard_offset_mm, 0</p>
<ul>
<li>Example: If Actuator height in the route property is set to 100 mm and <strong>actuator_load_aboard_offset_mm</strong> is set to 250 mm: AGV is loaded -&gt; Actuator is lifted to  &quot;Actuator height&quot; + <strong>actuator_load_aboard_offset_mm</strong> = 350 mm</li>
</ul>
</li>
</ul>
<h3 id="actuator-control-timeout"><a class="header" href="#actuator-control-timeout">Actuator control timeout</a></h3>
<p>Actuator control is stopped if reference value or limit switches are not reached within the timer value since the control sequence is started.</p>
<ul>
<li>I, actuator_timer_s, 20</li>
</ul>
<h3 id="actuator-usage"><a class="header" href="#actuator-usage">Actuator usage</a></h3>
<p>User can define when the actuator is used. Options are to use actuator only in Load state, Move actuator in auto mode OR enable protection zone override.</p>
<ul>
<li>I, actuator_allow_activation_mode, 1 # 0 = allow actuator activation only in load state, 1 = to move actuator in auto, 2 = enable protection zone override in standby&amp;auto</li>
</ul>
<p>User can define, if the actuator is only used on the Load/unload symbolic point</p>
<ul>
<li>I, actuator_only_on_sp, 0 # 0 = normal control, 1 = allow (un)load only on top of (un)load symbolic point</li>
</ul>
<h3 id="tolerances-and-basic-control"><a class="header" href="#tolerances-and-basic-control">Tolerances and basic control</a></h3>
<p>With reference controlled actuator, the control is stopped based on two methods. These two methods are outer and inner tolerances and they are explained down below. The binary actuators are controlled until the low/high limits are reached/triggered. </p>
<h4 id="outer-tolerance"><a class="header" href="#outer-tolerance">Outer tolerance</a></h4>
<p>Outer tolerance for fork is set with <strong>actuator_outer_tolerance_mm</strong> parameter. Other actuator types has their own parameters for tolerances, but they are used in similar way. Actuator control is stopped as soon as the actuator measurement is inside the outer tolerance from the reference or target value. The actuator control is started if actuator is further away from the reference than the outer tolerance.</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/Outer_tolerance.png" alt="" /></p>
<blockquote>
<p>Outer tolerance. Here the <strong>actuator_outer_tolerance_mm</strong> parameter is 5 and inner tolerance is disabled. The actuator control is stopped right on the edge of the tolerance. How close to the actual reference the actuator goes, depends on the fork controller how fast the actuator is actually stopped and how much delay there is. </p>
</blockquote>
<h4 id="inner-tolerance"><a class="header" href="#inner-tolerance">Inner tolerance</a></h4>
<p>Inner tolerance is additional tolerance method that can be used only with reference controlled fork. It can be set with <strong>actuator_inner_tolerance_mm</strong>. The idea is that actuator is started to control if it is outside the outer tolerance, but the control is stopped only when the actuator measurement is inside the inner tolerance from the reference or target value. There is also timer <strong>actuator_inner_tolerance_timer_ms</strong> that would require the actuator to be within the inner tolerance for specific time before the control is stopped.</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/Inner_tolerance.png" alt="" /></p>
<blockquote>
<p>Inner tolerance. Here the <strong>actuator_outer_tolerance_mm</strong> parameter is 5 and <strong>actuator_inner_tolerance_mm</strong> is 3. The actuator control is stopped right on the edge of the inner tolerance. How close to the actual reference the actuator goes, depends on the fork controller how fast the actuator is actually stopped and how much delay there is. If the timer is used, that would make sure that actuator control is still active if the actuator would for example overshoot to the other side of the tolerance.</p>
</blockquote>
<h3 id="load-sensor"><a class="header" href="#load-sensor">Load sensor</a></h3>
<h4 id="load-sensor-in-use"><a class="header" href="#load-sensor-in-use">Load sensor in use</a></h4>
<p>Load sensor data is used in the Navitrol only if load sensor in use bit is 1. This can be checked from the Actuator control form. See &quot;Actuator Control form&quot; chapter.</p>
<h4 id="disable-load-sensor-within-specific-distance-from-pickup-or-dropoff-point"><a class="header" href="#disable-load-sensor-within-specific-distance-from-pickup-or-dropoff-point">Disable load sensor within specific distance from Pickup or Dropoff point</a></h4>
<p>Load sensor can be disabled when AGV is in Auto state and close to Pickup or Dropoff point. Distance to disable the sensor can be set with <strong>actuator_disable_load_sensor_distance</strong>. This is used for example in situations where load sensor would detect the load before AGV has driven all the way under the pallet and would start picking it up too early.</p>
<h4 id="load-sensor-check-before-pickup"><a class="header" href="#load-sensor-check-before-pickup">Load sensor check before Pickup</a></h4>
<p>Load sensor can be checked before and during the pickup action if <strong>actuator_check_load_sensor_status_before_loading</strong> is set. Error is set if load sensor does not detect the load.</p>
<h4 id="load-sensor-check-after-pickup"><a class="header" href="#load-sensor-check-after-pickup">Load sensor check after Pickup</a></h4>
<p>Load sensor can be checked after Pickup action has been done if <strong>actuator_check_load_sensor_status_after_loading</strong> is set. Error is set if load sensor does not detect the load.</p>
<h4 id="load-sensor-check-after-dropoff"><a class="header" href="#load-sensor-check-after-dropoff">Load sensor check after Dropoff</a></h4>
<p>Load sensor can be checked after Dropoff action has been done if <strong>actuator_check_load_sensor_status_after_unloading</strong> is set.
Error is set if load sensor detects the load.</p>
<h4 id="navitrol-load-status-change"><a class="header" href="#navitrol-load-status-change">Navitrol load status change</a></h4>
<p>By default, Navitrol changes the load status whenever the load sensor status changes in Auto state. But if the load sensor is not reliable and causes lots of false positives, this parameter can be set to 1 or 2 to avoid load status to change based on sensor while AGV is driven in Auto state: <strong>change_load_status_only_on_load_state</strong>. The value 2 is optional mode to allow status to change empty if both Navithor and load sensor says so. Check &quot;ERROR_LOAD_SENSOR_STATUS_CHANGED_IN_AUTO&quot; chapter, before changing this parameter.</p>
<h4 id="load-sensor-check-in-auto-state"><a class="header" href="#load-sensor-check-in-auto-state">Load sensor check in Auto state</a></h4>
<p>Checks if load sensor status changes in Auto state and stays on new value within set time. The timer is used to avoid glitches taken into account, meaning that if the sensor just quickly changes to 0 and the back to 1, it does not raise an error. This timer can be set with <strong>load_sensor_status_change_timer_ms</strong> parameter.</p>
<h4 id="load-sensor-conflict"><a class="header" href="#load-sensor-conflict">Load sensor conflict</a></h4>
<p>Load sensor is checked with Navithor load status if the <strong>load_sensor_conflict_mode</strong> is set. Mode 1 is done close to Pickup and Dropoff point, at the beginning of Pickup and Dropoff buffers or when AGV state changes from Manual to Standby. Mode 2 is done when AGV is in Auto state. See &quot;ERROR_LOAD_SENSOR_CONFLICT_WITH_NAVITHOR&quot; chapter.</p>
<h3 id="actuator-safety-height-after-drop-off-interruption"><a class="header" href="#actuator-safety-height-after-drop-off-interruption">Actuator safety height after drop-off interruption</a></h3>
<p>If drop-off is interrupted before it is ready, actuator is kept at the current height for safety reasons until</p>
<ul>
<li>Drop-off is done succesfully again</li>
<li>State is changed to Manual</li>
<li>AGV is in Auto state and further away from the interrupt location than <strong>actuator_keep_height_after_dropoff_aborted_distance_m</strong> parameter.</li>
</ul>
<h3 id="actuator-keep-height-after-dropoff"><a class="header" href="#actuator-keep-height-after-dropoff">Actuator keep height after dropoff</a></h3>
<p>After dropoff action, the actuator height can be set to be at the current height for distance of <strong>docking_limit_leave_speed_and_actuator_height_dist</strong> parameter. This feature should be used for example in situation, where the route height is higher than the height after unload. For example, if the route height is 300 mm for the whole unload buffer, but the unload will be done to the 0 mm height. This feature would then keep the height as 0 mm until the forks are not anymore under the pallet. This feature is not active if the parameter is negative.</p>
<h3 id="actuator-set-to-floor-when-close-to-target-on-pickup-buffer"><a class="header" href="#actuator-set-to-floor-when-close-to-target-on-pickup-buffer">Actuator set to floor when close to target on Pickup buffer</a></h3>
<p>Actuator can be set to floor height <strong>actuator_min_val</strong> when AGV is close enough to the detected target on Pickup buffer. The distance to target is set with parameter <strong>disable_safety_distance_on_buffer</strong>. Requires <strong>load_buffer_mode</strong> being 1 or 2. With this feature, the route height can be set to for example 300mm for the whole buffer lane if that is required for example for safety reasons. This feature is not active if <strong>disable_safety_distance_on_buffer</strong> parameter is negative.</p>
<p>There is also parameter <strong>buffer_stop_AGV_when_decreasing_fork_before_load</strong> that will stop the AGV until the fork is moved to the floor. If this parameter is 0, then AGV will drive at the same time when moving fork to the floor height. </p>
<h3 id="agv-stop-offset-based-on-actuator-position"><a class="header" href="#agv-stop-offset-based-on-actuator-position">AGV stop offset based on actuator position</a></h3>
<p>If the actuator is not at the center of the AGV, like sideloader where the fork has some offset, <strong>fork_pos_x</strong> parameter can be set to define the actuator center position relative to the navigation point. This parameter will affect how the AGV stops to the Pickup and Dropoff symbolic points. Idea is that when AGV stops to the symbolic point, the actuator will be on top the symbolic point. This offset can be imagined as the route that is extended or retracted by this offset. </p>
<ul>
<li>If parameter is negative and AGV is driving forwards, AGV will stop after the symbolic point. </li>
<li>If parameter is negative and AGV is driving backwards, AGV will stop before the symbolic point.</li>
<li>If parameter is positive and AGV is driving forwards, AGV will stop before the symbolic point. </li>
<li>If parameter is positive and AGV is driving backwards, AGV will stop after the symbolic point.</li>
</ul>
<p>On features like <a href="LoadHandling/ActuatorControl/../../LoadHandling/BufferLanes/BufferLanes-en.html">Buffer lanes</a>, <a href="LoadHandling/ActuatorControl/../../LoadHandling/BlockStacking/BlockStacking-en.html">Blockstacking</a> or <a href="LoadHandling/ActuatorControl/../../TargetAndObstacleDetection/PalletDetection/PalletDetection-en.html">Docking</a> this parameter only allows the AGV to drive over the symbolic point by this offset, if needed. It does not affect to the distances where AGV stops relative to the detected pallets.</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/StopOffsetForward.png" alt="" /></p>
<blockquote>
<p>AGV driving to forward direction. On this figure, the <strong>fork_pos_x</strong> is negative, meaning that the actuator center (red dashed line) is behind the navigation point (visualized with black dashed line). When AGV stops to the symbolic point, the actuator center would be on top of the symbolic point and navigation point would overshoot by the value of this parameter.</p>
</blockquote>
<p><img src="LoadHandling/ActuatorControl/./media-en/StopOffsetReverse.png" alt="" /></p>
<blockquote>
<p>AGV is reversing. On this figure, the <strong>fork_pos_x</strong> is negative, meaning that the actuator center (red dashed line) is behind the navigation point (visualized with black dashed line). When AGV stops to the symbolic point, the actuator center would be on top of the symbolic point and navigation point would stop before the end symbolic point.</p>
</blockquote>
<p><img src="LoadHandling/ActuatorControl/./media-en/StopOffsetForwardOver.png" alt="" /></p>
<blockquote>
<p>If the navigation point would overshoot the symbolic point, Navitrol will always create custom route to drive the overshoot distance. This is visualized here with green line next to the black symbolic point. This custom route is created for AGV to be able to drive to location where there is no segment like on this figure.</p>
</blockquote>
<p>If Navitrol should create the custom route, it will be done when AGV is within <strong>apply_actuator_offset_dist</strong> from the end symbolic point.</p>
<h3 id="pickup-and-dropoff-sequences"><a class="header" href="#pickup-and-dropoff-sequences">Pickup and Dropoff sequences</a></h3>
<p>If there are multiple actuators that should be controlled while picking up or dropping off pallet, pickup and dropoff sequences should be used. See <strong>actuator_load_sequence</strong> and <strong>actuator_unload_sequence</strong> parameters. With these sequences, Navitrol will control one actuator to its reference value until next sequence is started. If actuator is set as binary, the reference values are not used, but instead actuator is commanded to increase or decrease based on sequence state.</p>
<h4 id="the-sequence-numbers"><a class="header" href="#the-sequence-numbers">The sequence numbers</a></h4>
<ul>
<li>None
<ul>
<li>0 = none</li>
</ul>
</li>
<li>Lift 
<ul>
<li>1 = lift up. Reference set with <strong>actuator_load_aboard_offset_mm</strong> and <strong>actuator_load_min_val</strong> parameters, route height or <strong>ACTUATOR_LOAD_MIN_VAL</strong> parameter from the machine type parameter file.</li>
<li>2 = lift down. Reference set to route height, <strong>actuator_min_val</strong> parameter or <strong>ACTUATOR_MIN_VAL</strong> parameter from the machine type parameter file. If AGV is in manual mode, reference is current height - <strong>actuator_load_aboard_offset_mm</strong> and <strong>actuator_load_min_val</strong>.</li>
</ul>
</li>
<li>Reach 
<ul>
<li>3 = reach forwards. Reference set with <strong>actuator_reach_load_val</strong> when doing pickup and <strong>actuator_reach_unload_val</strong> when doing dropoff.</li>
<li>4 = reach home. Reference set with <strong>actuator_reach_home_val</strong>.</li>
</ul>
</li>
<li>Tilt
<ul>
<li>5 = tilt down. Reference set with <strong>actuator_tilt_dn_val_deg</strong>.</li>
<li>6 = tilt home. Reference set with <strong>actuator_tilt_home_val_deg</strong>.</li>
<li>7 = tilt up. Reference set with <strong>actuator_tilt_up_val_deg</strong>.</li>
</ul>
</li>
<li>Sideshift
<ul>
<li>8 = side left. Reference set with <strong>actuator_side_shift_left_val</strong>.</li>
<li>9 = side home. Reference set with <strong>actuator_side_shift_home_val</strong>.</li>
<li>10 = side right. Reference set with <strong>actuator_side_shift_right_val</strong>.</li>
</ul>
</li>
<li>Reserved, not used for anything
<ul>
<li>11 = notUsed</li>
</ul>
</li>
<li>Secondary/Auxiliary lift 
<ul>
<li>12 = auxiliary lift up. Reference set to current height + <strong>actuator_auxiliary_lift_load_val_mm</strong>.</li>
<li>13 = auxiliary lift down. Reference set to current height - <strong>actuator_auxiliary_lift_load_val_mm</strong>.</li>
</ul>
</li>
</ul>
<h4 id="example-set-of-parameters-for-sequences"><a class="header" href="#example-set-of-parameters-for-sequences">Example set of parameters for sequences</a></h4>
<pre><code class="language-bash">- I,actuator_load_sequence[0], 3 # Reach forward
- I,actuator_load_sequence[1], 1 # Lift up
- I,actuator_load_sequence[2], 4 # Reach home

- I,actuator_unload_sequence[0], 3 # Reach forward
- I,actuator_unload_sequence[1], 2 # Lift down
- I,actuator_unload_sequence[2], 4 # Reach home
</code></pre>
<p>This load sequence would be as on the Figure down below. At first, the reach actuator is controlled to the forward reference, then the lift is controlled up and finally, the reach is controlled back to home position. The unload sequence would be almost the same, but the lift is controlled down instead of up.</p>
<h4 id="default-sequences"><a class="header" href="#default-sequences">Default sequences</a></h4>
<p>The default sequences are used if those sequence parameters are not set to parameter file. The sequence numbers are the same as on the list above. The default sequences are defined as follows:</p>
<ul>
<li>If <strong>actuator_type</strong> is 2 or 3
<ul>
<li>Pickup sequence: 1</li>
<li>Dropoff sequence: 2</li>
</ul>
</li>
<li>If <strong>actuator_type</strong> is 2 or 3 and <strong>actuator_tilt_enabled</strong> is 1
<ul>
<li>Pickup sequence: 1, 7</li>
<li>Dropoff sequence: 6, 2</li>
</ul>
</li>
<li>If <strong>actuator_type</strong> is 2 or 3 and <strong>actuator_reach_enabled</strong> is 1
<ul>
<li>Pickup sequence: 3, 1, 4</li>
<li>Dropoff sequence: 3, 2, 4</li>
</ul>
</li>
<li>If <strong>actuator_type</strong> is 2 or 3 and <strong>actuator_reach_enabled</strong> is 1 and <strong>actuator_tilt_enabled</strong> is 1
<ul>
<li>Pickup sequence: 6, 3, 1, 4, 7 </li>
<li>Dropoff sequence: 6, 3, 2, 4, 7</li>
</ul>
</li>
</ul>
<h3 id="actuator-types"><a class="header" href="#actuator-types">Actuator types</a></h3>
<h4 id="lift"><a class="header" href="#lift">Lift</a></h4>
<p>Lift is a basic actuator that can be binary (for example lifting table) or reference controlled (for example forklift). It can be enabled with parameter <strong>actuator_type</strong> 2 or 3. </p>
<p><img src="LoadHandling/ActuatorControl/./media-en/ReferenceFork.png" alt="" /></p>
<blockquote>
<p>Example of the reference controlled fork. 1. Fork at the 0 reference. 2. Fork at the loaded height (for example 200 mm).</p>
</blockquote>
<p><img src="LoadHandling/ActuatorControl/./media-en/LiftingTable.png" alt="" /></p>
<blockquote>
<p>Example of the binary controlled lifting table. 1. Lift at low or down position. 2. Lift at high or up position.</p>
</blockquote>
<h4 id="reach"><a class="header" href="#reach">Reach</a></h4>
<p>Reach is an actuator that is able to move forks under the pallet and then back. For example, sideloader that is able to pickup pallets from the rack without moving the AGV. Reach can be used only with the Pickup and Dropoff sequences (<strong>actuator_load_sequence</strong> and <strong>actuator_unload_sequence</strong> values 3 and 4).</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/Reach.png" alt="" /></p>
<blockquote>
<p>Movement of the reach actuator with the sideloader AGV. 1. The fork is inside AGV body and reach is at home position (<strong>actuator_reach_home_val</strong>). 2. Reach is extended out to loaded value (<strong>actuator_reach_load_val</strong>). If AGV has load, target value for this step is <strong>actuator_reach_unload_val</strong>. 3. Lift is moved to loaded position. Usually by <strong>actuator_load_aboard_offset_mm</strong>. 4. Reach is retracted back to the home position (<strong>actuator_reach_home_val</strong>).</p>
</blockquote>
<h4 id="fork-tilt"><a class="header" href="#fork-tilt">Fork tilt</a></h4>
<p>Fork tilt is an actuator that is able to move forks up and down relative to the base of the fork.</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/Tilt.png" alt="" /></p>
<blockquote>
<p>Movement of the tilt actuator. 1. Tilt at the home position (<strong>actuator_tilt_home_val_deg</strong>). 2. Tilt controlled to the down position (<strong>actuator_tilt_dn_val_deg</strong>). 3. Tilt controlled to the up position (<strong>actuator_tilt_up_val_deg</strong>). Tilt can be used only with the Pickup and Dropoff sequences (<strong>actuator_load_sequence</strong> and <strong>actuator_unload_sequence</strong> values 5, 6 and 7)</p>
</blockquote>
<h4 id="fork-side-shift"><a class="header" href="#fork-side-shift">Fork side shift</a></h4>
<p>Fork side shift is an actuator that is able to move forks sideways. There are two ways to use this actuator. </p>
<ul>
<li>With the Pickup or Dropoff sequences <strong>actuator_load_sequence</strong> or <strong>actuator_unload_sequence</strong> values 8, 9 and 10</li>
<li>With Racking and pallet detection features. When pallet is detected on the rack, the side shift can be controlled to the middle of the pallet without moving the AGV. It is moved then back to home position when AGV has picked the pallet and it is driven out from the rack safety distance. See <a href="LoadHandling/ActuatorControl/../../LoadHandling/Racking/Racking-en.html">Racking document</a>. </li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/Sideshift.png" alt="" /></p>
<blockquote>
<p>Movement of the side shift from the above perspective. 1. Side shift at the home position (<strong>actuator_side_shift_home_val</strong>). 2. Side shift moved to the right position (<strong>actuator_side_shift_right_val</strong>). 3. Side shift moved to the left position (<strong>actuator_side_shift_left_val</strong>).</p>
</blockquote>
<h4 id="auxiliarysecondary-lift"><a class="header" href="#auxiliarysecondary-lift">Auxiliary/Secondary lift</a></h4>
<p>Can be used as secondary lift for example on a forklift that has main mast and secondary mast and the secondary lift is used to pick up and drop-off pallet. On the supervisor message 1031 defined as secondary lift. Load sequence can be enabled with <strong>actuator_load_sequence</strong> parameter value 12 and unload sequence can be enabled with <strong>actuator_unload_sequence</strong> parameter value 13. Reference and measurement values can be seen from the Monitor Actuator Control form. Main lift is defined with <strong>actuator_type</strong> being 2, meaning that it is controlled as normal reference forklift.</p>
<ul>
<li>
<p>Enable control logic for an auxiliary lift actuator: <strong>actuator_auxiliary_lift_enabled</strong></p>
</li>
<li>
<p>Control type: <strong>actuator_auxiliary_lift_type</strong></p>
</li>
<li>
<p>Tolerance, min and max values. These are used only if <strong>actuator_auxiliary_lift_type</strong> is 2.</p>
<ul>
<li><strong>actuator_auxiliary_lift_tolerance_mm</strong></li>
<li><strong>actuator_auxiliary_lift_min_val_mm</strong></li>
<li><strong>actuator_auxiliary_lift_max_val_mm</strong></li>
</ul>
</li>
<li>
<p>Target height to which the lift is controlled, when AGV has a load: <strong>actuator_auxiliary_lift_load_val_mm</strong>. Used only if <strong>actuator_auxiliary_lift_type</strong> is 2.</p>
</li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/AuxiliaryLift.png" alt="" /></p>
<blockquote>
<p>Auxiliary lift example figure. The black color shows the auxiliary lift that can be controlled independently from the main lift. 1. The auxiliary lift at the 0 reference. 2. Main lift is controlled to 1m height. Auxiliary lift is still at 0 height. 3. Auxiliary lift is controlled to the loaded reference height. The main mast is not moved.</p>
</blockquote>
<p>Two lifting tables. </p>
<ul>
<li>First lift is setup as normal lift: <strong>actuator_type</strong> parameter as 3. </li>
<li>The second lift is setup as an auxiliary lift: <strong>actuator_auxiliary_lift_enabled</strong> as 1 and <strong>actuator_auxiliary_lift_type</strong> parameter as 3. </li>
<li>Enable pickup/dropoff action for both lifts with <strong>actuator_auxiliary_lift_as_secondary_lifting_device</strong>. </li>
<li>Can be tested with Monitor Actuator control form by pressing &quot;Load&quot; button. That will control both lifts to high position. Pressing &quot;Unload&quot; button will control both to low position.</li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/image_two_lifts.png" alt="" /></p>
<blockquote>
<p>Two lifting table AGV example. 1. Both lifts at the low position. 2. First lift at the high and second lift at the low position. 3. First lift at the low position and second lift at the high position. 4. Both lifts at the high position.</p>
</blockquote>
<h4 id="fork-rotate"><a class="header" href="#fork-rotate">Fork rotate</a></h4>
<p>Fork rotate is an actuator that is able to rotate the fork from other side to the another side of the AGV, or to the middle pointing forwards. At the moment, only way to control this is with Monitor Actuator control form by setting reference values. For example, VNA truck has this kind of actuator that allows it to drive into narrow aisles and pickup pallet from either side of the aisle. </p>
<p>Parameters:</p>
<ul>
<li>Enable control logic for the rotate actuator: <strong>actuator_rotate_enabled</strong></li>
<li>Tolerance: <strong>actuator_rotate_tolerance_deg</strong></li>
<li>Min and max values: <strong>actuator_rotate_min_val_deg</strong> and <strong>actuator_rotate_max_val_deg</strong></li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/Rotate.png" alt="" /></p>
<blockquote>
<p>Movement of the rotate actuator from the above percpective. 1. Fork at middle position. 2. Fork at right position. 3. Fork at left position. </p>
</blockquote>
<h4 id="scanner-lift"><a class="header" href="#scanner-lift">Scanner lift</a></h4>
<p>See <a href="LoadHandling/ActuatorControl/../../LoadHandling/ScannerLiftActuator/ScannerLiftActuator-en.html">Scanner lift document</a>. </p>
<h3 id="navithor-machine-tool-parameters-related-to-actuator"><a class="header" href="#navithor-machine-tool-parameters-related-to-actuator">Navithor Machine Tool parameters related to Actuator</a></h3>
<p>There are few settings on the Machine parameters related to actuators.
Those settings can be adjusted with Machine Tool application.</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/MachineTool.png" alt="" /></p>
<blockquote>
<p>Machine Tool example with Omni fork AGV.</p>
</blockquote>
<p><img src="LoadHandling/ActuatorControl/./media-en/MachineToolActuatorParams.png" alt="" /></p>
<blockquote>
<p>Parameters tab that has actuator related parameters.</p>
</blockquote>
<ul>
<li>
<p>Actuator type</p>
<ul>
<li>
<p>Defines the type of the actuator for NAVITHOR purposes</p>
<ul>
<li>
<p><strong>ACTUATOR_TYPE</strong> -- parameter</p>
<ul>
<li>
<p>0 = No actuator</p>
</li>
<li>
<p>1 = Forklift</p>
</li>
<li>
<p>2 = Lift</p>
</li>
<li>
<p>3 = Hitch (for Tugger-Trailer-type AGVs)</p>
</li>
<li>
<p>4 = Sideloader. Fork that is pointing to the side from the AGV body.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Actuator minimum value</p>
<ul>
<li>
<p>Defines the minimum actuator position from 'floor level' when AGV is not carrying a resource. Default value is 0</p>
<ul>
<li>Should be set to the same value with Navitrol parameter <strong>actuator_min_val</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Actuator minimum value with the load</p>
<ul>
<li>
<p>Defines the minimum actuator position when AGV is carrying a resource. Navithor will force the AGV to lift the actuator to at least this height when pickup action is given. This is a limit from the base level ('floor level') and does not affect actuator position when reference is above this value</p>
<ul>
<li>Should be set to the same value with Navitrol <strong>actuator_load_min_val</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Load sensor to Navithor</p>
<ul>
<li><strong>LOAD_STATUS_KNOWN</strong> defines if AGV has load sensor or not. If this is set to 0, Navithor does not use the load status sent from Navitrol for anything. If this is 1, Navithor can use for example resource mismatch rules or sync the load status based on what Navitrol sends.</li>
</ul>
</li>
<li>
<p>Fork dimensions (If fork type is selected)</p>
<ul>
<li>
<p><strong>DIM_FORK_GAP</strong> defines the gap between 2 forks. Used for visualization of the fork.</p>
</li>
<li>
<p><strong>DIM_FORK_LENGTH</strong> defines the length of the forks. Used for visualization of the fork.</p>
</li>
</ul>
</li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Fork type AGV on the Machine Tool.</p>
</blockquote>
<ul>
<li>Actuator orientation for sideloader
<ul>
<li><strong>ACTUATOR_ORIENTATION</strong> (none, right, left) defines where the fork is pointing relative to the AGV body. On the figure down below the front of the AGV is orange color and rear is grey color and the actuator is pointing to the left side.</li>
</ul>
</li>
</ul>
<p><img src="LoadHandling/ActuatorControl/./media-en/Sideloader.png" alt="" /></p>
<blockquote>
<p>Sideloader AGV on the Machine Tool.</p>
</blockquote>
<p><strong>Route properties in Navithor Tools related to Actuator</strong></p>
<p>Height reference for the fork actuator is set to route in Navithor Tools.
Height can be set separately for both lanes.</p>
<p>User can also define if the &quot;Strict&quot; feature is ON. Strict means that machine won't drive until measured height of the actuator is the same as the reference height.</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/ToolsActuatorValue.png" alt="" /></p>
<blockquote>
<p>Actuator value property on Navithor Tools.</p>
</blockquote>
<p><img src="LoadHandling/ActuatorControl/./media-en/ToolsActuatorStrict.png" alt="" /></p>
<blockquote>
<p>Strict actuator property on Navithor Tools.</p>
</blockquote>
<p><strong>How to set reference height of the actuator on the route.</strong></p>
<ol>
<li>
<p>Select property &quot;Actuator Value (mm)&quot;</p>
</li>
<li>
<p>Select the lane (Single lane or Both)</p>
</li>
<li>
<p>Select the part of the route to be adjusted</p>
</li>
<li>
<p>Set value for the &quot;Actuator Value (mm)&quot; and press <em>Set Selection</em></p>
</li>
</ol>
<p><strong>How to set Strict height of the actuator on the route.</strong></p>
<ol>
<li>
<p>Select property &quot;Strict Actuator&quot;</p>
</li>
<li>
<p>Select the lane (Single or Both)</p>
</li>
<li>
<p>Select the part of the route to be adjusted</p>
</li>
<li>
<p>Set value for the &quot;Strict Actuator&quot; and press <em>Set Selection</em></p>
</li>
</ol>
<h3 id="actuator-control-form"><a class="header" href="#actuator-control-form">Actuator Control form</a></h3>
<p>Once actuator control is activated (<strong>actuator_type</strong> &gt; 0) &quot;Actuator control&quot; -form appears under the tab &quot;Navitrol&quot;</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/Actuator_control_form_reference.png" alt="" /></p>
<blockquote>
<p>Actuator control form with reference controlled fork.</p>
</blockquote>
<p>With this form it is possible to see the measured and reference values of some actuators and to take actuators to Manual control.</p>
<h4 id="measurement-reference-and-other-values"><a class="header" href="#measurement-reference-and-other-values">Measurement, reference and other values</a></h4>
<p>On the left side of the form, there is a list of data. The items are:</p>
<ul>
<li>measured value
<ul>
<li>Measured height of the fork in mm. With binary actuator, this will be 0 always.</li>
</ul>
</li>
<li>reference value
<ul>
<li>Reference or target value for lift. For reference controlled lift, this is the reference height in mm and for binary lift, 0 = no control, 1 = decrease command, 2 = increase command.</li>
</ul>
</li>
<li>activate actuator
<ul>
<li>Navitrol command to activate lift. 1 = lift control active, 0 = no control.</li>
</ul>
</li>
<li>increase actuator
<ul>
<li>Navitrol command to increase lift. 1 = increase active, 0 = no control. Usually when actuator control is active (activate actuator bit), the direction is told with this or the decrease bit.</li>
</ul>
</li>
<li>decrease actuator
<ul>
<li>Navitrol command to decrease lift. 1 = decrease active, 0 = no control. Usually when actuator control is active (activate actuator bit), the direction is told with this or the increase bit.</li>
</ul>
</li>
<li>low limit active
<ul>
<li>Lift actuator at the low limit. Not used with reference controlled lift. This comes usually from customer interface and shows if the actuator is at the low limit sensor (actuator at low position).</li>
</ul>
</li>
<li>high limit active
<ul>
<li>Lift actuator at the high limit. Not used with reference controlled lift. This comes usually from customer interface and shows if the actuator is at the high limit sensor (actuator at high position).</li>
</ul>
</li>
<li>load sensor used
<ul>
<li>If load sensor is in use. This comes usually from customer interface and shows if the AGV has load sensor or not. 1 = sensor is used, 0 = no sensor data. If the number is higher than 1, then the system has more sensors. </li>
</ul>
</li>
<li>load detected
<ul>
<li>Load sensor data. If the load sensor detected the load or not. Not used if the &quot;load sensor used&quot; is 0. Usually the value is 0 = load not detected or 1 = load detected. If the &quot;load sensor used&quot; is higher than 1, Navitrol will set load aboard only when the load is detected with all sensors.</li>
</ul>
</li>
<li>scanner height reference
<ul>
<li>Scanner lift actuator reference value in mm. Relative to the fork, for example -200 means that the scanner lift target is 200 mm below the fork. </li>
</ul>
</li>
<li>scanner height measurement
<ul>
<li>Scanner lift height measurement value in mm. Relative to the fork, for example -200 means that the scanner lift is 200 mm below the fork. </li>
</ul>
</li>
<li>aux lift measurement
<ul>
<li>Auxiliary/Secondary lift measurement value in mm. </li>
</ul>
</li>
<li>aux lift reference
<ul>
<li>Auxiliary/Secondary lift reference or target value in mm. </li>
</ul>
</li>
<li>rotate meas deg
<ul>
<li>Rotate fork measurement value in degrees. 0 = fork pointing forwards, 90 = fork pointing to the left (counter-clockwise), -90 = fork pointing to the right (clockwise) </li>
</ul>
</li>
<li>rotate ref deg
<ul>
<li>Rotate fork reference or target value in degrees. </li>
</ul>
</li>
<li>secondary load sensor used
<ul>
<li>If load sensor is in use for secondary lift. This comes usually from customer interface and shows if the AGV has load sensor or not. 1 = sensor is used, 0 = no sensor data.</li>
</ul>
</li>
<li>secondary load detected
<ul>
<li>Load sensor data for secondary lift. If the load sensor detected the load or not. Not used if the &quot;secondary load sensor used&quot; is 0. 0 = load not detected, 1 = load detected.</li>
</ul>
</li>
</ul>
<h4 id="buttons"><a class="header" href="#buttons">Buttons</a></h4>
<ul>
<li>Start/stop control
<ul>
<li>&quot;Take Control&quot; -button
<ul>
<li>Enables the Actuator manual control and takes AGV into Manual state.</li>
</ul>
</li>
<li>&quot;Stop&quot; -button
<ul>
<li>Stops the manual control and changes state to Standby.</li>
</ul>
</li>
</ul>
</li>
<li>Reference control
<ul>
<li>&quot;Numeric up/down&quot;
<ul>
<li>Sets the reference value for the actuator</li>
</ul>
</li>
<li>&quot;Send&quot; -button
<ul>
<li>Multiple send buttons that will send the current reference value from the left-side numeric up/down to Navitrol. The reference values are not sent if this button is not pressed.</li>
</ul>
</li>
</ul>
</li>
<li>Control buttons
<ul>
<li>&quot;Load / Unload&quot; -button. 
<ul>
<li>Has text &quot;Load&quot; when Navitrol load status is empty.</li>
<li>Has text &quot;Unload&quot; when Navitrol load status is loaded.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="how-to-take-manual-control-of-the-actuator"><a class="header" href="#how-to-take-manual-control-of-the-actuator">How to take Manual control of the actuator</a></h4>
<ol>
<li>
<p>Open Actuator Control form</p>
</li>
<li>
<p>Press &quot;Take Control&quot;</p>
</li>
<li>
<p>Set the wanted &quot;Reference value&quot;</p>
</li>
<li>
<p>Press &quot;Send&quot; and system starts to drive the actuator to the given
reference value.</p>
</li>
<li>
<p>Pressing &quot;Stop&quot; button will stop the Manual control.</p>
</li>
</ol>
<h4 id="pickupdropoff-sequence"><a class="header" href="#pickupdropoff-sequence">Pickup/Dropoff sequence</a></h4>
<p>&quot;Load&quot; -button will start the pickup sequence as described in &quot;Pickup and Dropoff sequences&quot; chapter. This button can be clicked once the &quot;Take Control&quot; is pressed. After the pickup sequence is ready, the button text is changed to &quot;Unload&quot;. Pressing that button will start dropoff sequence. This button is useful for example testing the pickup and dropoff sequences if they are something else than default.</p>
<h4 id="other-actuator-controls"><a class="header" href="#other-actuator-controls">Other actuator controls</a></h4>
<p>Binary actuator can be enabled with <strong>actuator_type</strong> 3. Then its possible to command the lift to increase or decrease. Then the Actuator Control form will look like this:</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/Actuator_control_form_binary.png" alt="" /></p>
<blockquote>
<p>Actuator control form with binary actuator</p>
</blockquote>
<p>Scanner lift control can be enabled with <strong>actuator_scanner_lift_enabled</strong> parameter as 1. Monitor will show &quot;Scanner Height Reference value&quot; where scanner height reference value in mm can be set. </p>
<p>Auxiliary/Secondary lift control can be enabled with <strong>actuator_auxiliary_lift_enabled</strong> parameter as 1. Monitor will show &quot;Aux lift ref&quot; where auxiliry/secondary lift reference value in mm can be set. </p>
<p>Rotate fork control can be enabled with <strong>actuator_rotate_enabled</strong> parameter as 1. Monitor will show &quot;Rotate ref&quot; where rotate fork reference value in degrees can be set. </p>
<p><img src="LoadHandling/ActuatorControl/./media-en/Actuator_control_form_all.png" alt="" /></p>
<blockquote>
<p>Actuator control form with all active actuators</p>
</blockquote>
<h3 id="ethernet-navithor-server----information-to-navithor"><a class="header" href="#ethernet-navithor-server----information-to-navithor">Ethernet Navithor Server -- Information to Navithor</a></h3>
<p>Actuator related information is passed from Navitrol to Navithor by mapping the I/O information to the machine profile. These are not recommended to use anymore after Navithor 2.x.x.x. </p>
<p>Both params.txt and Machine parameter.xml are used for mapping.</p>
<p><img src="LoadHandling/ActuatorControl/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>I/0 binary mapping on Machine Tool</p>
</blockquote>
<ul>
<li>
<p>Actuator Position measurement</p>
<ul>
<li>
<p>Navitrol parameters: <strong>actuator_val_io</strong></p>
</li>
<li>
<p>Machine Tool: ActuatorPosition : i0...iN</p>
</li>
<li>
<p>Example:</p>
<ul>
<li>Actuator height shall be passed to Navithor with the first value of the Integer I/O vector: <strong>actuator_val_io</strong> = 0 and ActuatorPosition = i0</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Actuator Load detected information</p>
<ul>
<li>
<p>Navitrol parameters: <strong>actuator_load_det_io</strong></p>
</li>
<li>
<p>Machine Tool: LoadDetected : b0...bN</p>
</li>
</ul>
</li>
<li>
<p>Actuator Load status information</p>
<ul>
<li>Navitrol parameters: <strong>actuator_trust_io_load_status</strong> and <strong>actuator_load_status_io</strong></li>
</ul>
</li>
</ul>
<h3 id="select-source-for-actuator-inputs"><a class="header" href="#select-source-for-actuator-inputs">Select source for actuator inputs</a></h3>
<p>Typically the actuator inputs of a machine come from one interface/source to Navitrol. However, when the actuator inputs come from multiple different sources, then there can be some ambiguity which input Navitrol uses. For example some machine type might have read the inputs for a lift from custom CAN interface before, but for a new project it is desired that the actuator inputs come from the Ethernet supervisor interface.</p>
<p>To define the actuator input source explicitly, the following parameters can be set:</p>
<ul>
<li>I, actuator_input_source_arr[]</li>
<li>I, actuator_input_type_arr[]</li>
</ul>
<p>If all inputs of actuators are desired to come from one source only, then only <strong>actuator_input_source_arr</strong> needs to be set.
For example to read all the inputs from Supervisor status 3002 actuator section set:</p>
<ul>
<li>I, actuator_input_source_arr[0], 2 # ... 2 = Supervisor status section</li>
</ul>
<p>User can also set different sources for different actuator types. For example if Navitrol has previously read fork's lift and reach input from custom CAN interface, but now the fork's lift input needs to be read from Ethernet supervisor interface, following parameters can be set:<br />
<em>Disclaimer: All configurations not supported. Consult Navitec whether the desired configuration is supported.</em></p>
<ul>
<li>I, actuator_input_source_arr[0], 2 # ... 2 = Supervisor status section</li>
<li>I, actuator_input_source_arr[1], 10 # ... 10 = Custom CAN</li>
<li>I, actuator_input_type_arr[0], 1 # ... 1 = Lift</li>
<li>I, actuator_input_type_arr[1], 3 # ... 3 = Reach</li>
</ul>
<hr />
<h2 id="troubleshooting-39"><a class="header" href="#troubleshooting-39">Troubleshooting</a></h2>
<h3 id="most-common-issues-8"><a class="header" href="#most-common-issues-8">Most common issues</a></h3>
<h4 id="monitor-doesnt-show-correct-actuator-measurement"><a class="header" href="#monitor-doesnt-show-correct-actuator-measurement">Monitor doesn't show correct actuator measurement</a></h4>
<ul>
<li>Check that <strong>actuator_type</strong> parameter is 2.</li>
<li>Check control interface that Navitrol receives correct measurement
<ul>
<li>Ethernet control with supervisor status message ID 3002 actuator section 1: 
<ul>
<li>Set parameter <strong>log_veh_inte_eth</strong> to 1</li>
<li>Check this kind of log line: &quot;veh_inte_ethernet: Supervisor actuator val 0 act 0, lowL 0 highL 0 loadSen 0 loadDet 0&quot;</li>
<li>This log line shows what data Navitrol receives via supervisor message. The values are: 
<ul>
<li>val = Actuator height in mm </li>
<li>act = Actuator is active (0 or 1)</li>
<li>lowL = Low limit sensor (0 or 1) </li>
<li>highL = High limit sensor (0 or 1) </li>
<li>LoadSen = Load sensor is in use (0 or 1) </li>
<li>LoadDet = Load sensor value (0 or 1)</li>
</ul>
</li>
</ul>
</li>
<li>Ethernet control with supervisor message ID 1031/1131
<ul>
<li>Set parameter <strong>log_veh_inte_eth</strong> to 2</li>
<li>Check these kind of log lines: &quot;ETH_CTRL_IN 1031&quot;
<ul>
<li>Verify that the correct actuator type and actuator measured position is received.</li>
</ul>
</li>
</ul>
</li>
<li>CAN Encoder. Schwarzmueller or Curtis
<ul>
<li>Check this log line: &quot;HAL_CopyActuatorMeasToShared&quot;. It should show the actuator measured height.</li>
<li>If this line is not shown, check that this parameter is enabled: <strong>can_actuator_ctrl_model</strong></li>
<li>Check that these parameters are correct: 
<ul>
<li><strong>can_enc_actuator_calib_val_enc</strong></li>
<li><strong>can_enc_actuator_calib_val_act</strong></li>
<li><strong>can_enc_actuator_pulses_per_rev</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="actuator-doesnt-move-to-reference-value"><a class="header" href="#actuator-doesnt-move-to-reference-value">Actuator doesn't move to reference value</a></h4>
<ul>
<li>Check that <strong>actuator_type</strong> parameter is 2.</li>
<li>Check control interface that Navitrol sends out the correct reference
<ul>
<li>Ethernet control with supervisor status message ID 3002 actuator section 1: 
<ul>
<li>Set parameter <strong>log_veh_inte_eth</strong> to 1</li>
<li>Check this kind of log line: &quot;veh_inte_ethernet: Send actuator refVal 0 act 0 inc 0 dec 0 bin1 0 bin2 0 bin3 0 bin4 0&quot;</li>
<li>This log line shows what data Navitrol sends out via supervisor message. The values are: 
<ul>
<li>refVal = Actuator reference in mm </li>
<li>act = Activate command (0 or 1) </li>
<li>inc = Increase command (0 or 1) </li>
<li>dec = Decrease command (0 or 1) </li>
<li>bin1 = Bitmapped value (bit 0: activate, bit 1: increase and bit 2: decrease) </li>
<li>bin2 = Bitmapped value (reserved for future use) </li>
<li>bin3 = Bitmapped value (bit 0: stop and hold active)</li>
<li>bin4 = Bitmapped value (reserved for future use) </li>
</ul>
</li>
</ul>
</li>
<li>Ethernet control with supervisor message ID 1031/1131
<ul>
<li>Set parameter <strong>log_veh_inte_eth</strong> to 2</li>
<li>Check these kind of log lines: &quot;ETH_CTRL_OUT 1131&quot;
<ul>
<li>Verify that the correct actuator type is sent out and there is some reference value.</li>
<li>If the numOfActuators is 0, check that the correct actuator is enabled and correct control type is set on params.txt file. Check also that Navitrol receives actuator data on this log line: &quot;ETH_CTRL_IN 1031&quot;. Navitrol is not answering if it doesn't receive anything.</li>
</ul>
</li>
</ul>
</li>
<li>CAN Encoder. Schwarzmueller or Curtis
<ul>
<li>Check this log line: &quot;HAL_ControlSingleCanActuatorRPM&quot;. It should show actuator rpm and reference values.</li>
<li>If this line is not shown, check that this parameter is enabled: <strong>can_actuator_ctrl_model</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="actuator-overshoots-the-reference"><a class="header" href="#actuator-overshoots-the-reference">Actuator overshoots the reference</a></h4>
<ul>
<li>Check that <strong>actuator_outer_tolerance_mm</strong> has valid value. Increase if possible.</li>
<li>Try to decrease <strong>actuator_inner_tolerance_timer_ms</strong>, if it has some value.</li>
<li>Try to decrease <strong>actuator_inner_tolerance_mm</strong>, if it is non-negative.</li>
</ul>
<h4 id="actuator-does-not-move-when-driving-out-from-drop-off-location"><a class="header" href="#actuator-does-not-move-when-driving-out-from-drop-off-location">Actuator does not move when driving out from drop-off location</a></h4>
<p>Check the distance to the drop-off location and check if any of these parameters are higher than that distance: </p>
<ul>
<li><strong>docking_limit_leave_speed_and_actuator_height_dist</strong></li>
<li><strong>actuator_keep_height_after_dropoff_aborted_distance_m</strong></li>
</ul>
<p>Check this kind of log line: &quot;Actuator use not allowed before driven 1.2 m distance from the last unload location. Dist: 0.5. Act: 0&quot;</p>
<ul>
<li>This is related to the <strong>docking_limit_leave_speed_and_actuator_height_dist</strong> parameter. The actuator control is not allowed until AGV has driven this parameter distance from last unload point.</li>
</ul>
<h4 id="agv-doesnt-go-to-standby-when-arriving-to-pickup-or-dropoff-symbolic-point"><a class="header" href="#agv-doesnt-go-to-standby-when-arriving-to-pickup-or-dropoff-symbolic-point">AGV doesn't go to Standby when arriving to Pickup or Dropoff symbolic point</a></h4>
<p>AGV will go to Standby when actuator control is finished, meaning that actuator is within tolerance from the reference value or it is at the target low/high limit and actuator is not active on AGV system. Check the communication that actuator is not active on the AGV system.</p>
<p>Check if this log line is shown: &quot;Actuator not within limits or is active, move not allowed (inLimits: 0, strictFork: 0, softLimit: 0, actActive: 1&quot;. This indicates if actuator is not within tolerance or it is still active from customer interfaces.</p>
<h4 id="agv-stops-to-pickup-buffer"><a class="header" href="#agv-stops-to-pickup-buffer">AGV stops to Pickup buffer</a></h4>
<p>Check these parameters:</p>
<ul>
<li><strong>disable_safety_distance_on_buffer</strong> is positive.</li>
<li><strong>load_buffer_mode</strong> is 1 or 2. </li>
<li><strong>buffer_stop_AGV_when_decreasing_fork_before_load</strong> is 1. This is 1 by default, so if this parameter is not on the params.txt file, it is set.</li>
</ul>
<p>If those parameters are set, the AGV is stopped, because the fork is trying to go to the floor level, but for some reason can't finish the action. This <strong>buffer_stop_AGV_when_decreasing_fork_before_load</strong> will stop the AGV until the fork has reached the floor level (<strong>actuator_min_val</strong>). </p>
<p>Check the value of <strong>actuator_min_val</strong> and that actuator is at that height. Another option is to disable the stop check by setting the <strong>buffer_stop_AGV_when_decreasing_fork_before_load</strong> to 0. </p>
<h4 id="load-sensor-conflict-with-navithor-after-pickupdropoff-aborted"><a class="header" href="#load-sensor-conflict-with-navithor-after-pickupdropoff-aborted">Load sensor conflict with navithor after Pickup/Dropoff aborted</a></h4>
<p>Navithor load status is kept on wrong value if Pickup/Dropoff is not completed correctly. It can be reset to previous value on abort if this parameter is set <strong>navithor_load_status_reset_on_pickup_dropoff_abort</strong> = 1</p>
<h3 id="errors-and-warnings-17"><a class="header" href="#errors-and-warnings-17">Errors and warnings</a></h3>
<h4 id="warning_pos_cont_fork_war"><a class="header" href="#warning_pos_cont_fork_war">WARNING_POS_CONT_FORK_WAR</a></h4>
<p>This warning is set when AGV is in Auto state and</p>
<ul>
<li>some actuator is moving and AGV is inside strict route property or</li>
<li>reference controlled fork (<strong>actuator_type</strong> = 2) measurement value goes below <strong>ACTUATOR_MIN_VAL</strong> machine_type parameter or</li>
<li>binary controlled actuator (<strong>actuator_type</strong> = 3) is commanded to increase but highlimit bit is not active</li>
</ul>
<p><strong>How to recover:</strong> This is not critical warning, but if it does not reset automatically, check that there are no active actuators and the binary actuator highlimit is set if it is commanded to increase. This should be reset automatically when all actuators are within limits.</p>
<h4 id="error_pos_cont_fork_time_err"><a class="header" href="#error_pos_cont_fork_time_err">ERROR_POS_CONT_FORK_TIME_ERR</a></h4>
<p>This error is triggered if actuator control is not ready within time of <strong>actuator_timer_s</strong> parameter.</p>
<p><strong>How to recover:</strong> Actuator moves too slow to the target value. Try to increase actuator speed or increase this timer parameter.This error has timeout of 20 seconds, so it is reset automatically.</p>
<h4 id="error_actuator_use_not_allowed"><a class="header" href="#error_actuator_use_not_allowed">ERROR_ACTUATOR_USE_NOT_ALLOWED</a></h4>
<p>This error is triggered if <strong>actuator_only_on_sp</strong> is enabled, pickup or dropoff action is active and</p>
<ul>
<li>AGV is not at any symbolic point</li>
<li>Actuator is tried to decrease on Pickup symbolic point</li>
<li>Actuator is tried to increase on Dropoff symbolic point</li>
<li>AGV is further away from symbolic point than <strong>actuator_max_dist_err_from_sp</strong>.</li>
</ul>
<p>This error is also triggered if <strong>actuator_check_load_sensor_status_before_loading</strong> is 1 and <strong>racking_mode</strong> is 1 and load sensor does not detect the load while doing pickup action.</p>
<p><strong>How to recover:</strong> Check the conditions for this error and check if any of those fullfills. This error has timeout of 20 seconds, so it is reset automatically.</p>
<h4 id="warning_actuator_use_not_allowed"><a class="header" href="#warning_actuator_use_not_allowed">WARNING_ACTUATOR_USE_NOT_ALLOWED</a></h4>
<p>This warning is triggered if <strong>actuator_only_on_sp</strong> is enabled, pickup or dropoff action is active and</p>
<ul>
<li>AGV is not at any symbolic point</li>
<li>Actuator is tried to decrease on Pickup symbolic point</li>
<li>Actuator is tried to increase on Dropoff symbolic point</li>
<li>AGV is further away from symbolic point than <strong>actuator_max_dist_err_from_sp</strong>.</li>
</ul>
<p><strong>How to recover:</strong> Check the conditions for this warning and check if any of those fullfills. This warning is reset only when Pickup or Dropoff action is finished.</p>
<h4 id="warning_sensor_failure_in_loading"><a class="header" href="#warning_sensor_failure_in_loading">WARNING_SENSOR_FAILURE_IN_LOADING</a></h4>
<p>Load sensor does not detect the load while doing pickup. This warning is reset if load sensor detects the load or AGV goes to STANDBY state. AGV is stopped from moving until the warning is reset. This error check can be disabled with the <strong>actuator_check_load_sensor_status_before_loading</strong> parameter if the load sensor cannot be used while doing the pickup.</p>
<p><strong>How to recover:</strong> Check that pallet is firmly placed on the forks and move it closer to the sensor if possible. Check the sensor that it reports correct data.</p>
<h4 id="error_load_sensor_conflict_after_pickup"><a class="header" href="#error_load_sensor_conflict_after_pickup">ERROR_LOAD_SENSOR_CONFLICT_AFTER_PICKUP</a></h4>
<p>Load sensor doesn't detect the load after pickup action. This error is fatal error so it has to be reset by customer.
This error check can be disabled with the <strong>actuator_check_load_sensor_status_after_loading</strong> parameter if the sensor cannot be used for this kind of check.</p>
<p><strong>How to recover:</strong> Check that pallet is firmly placed on the forks and move it closer to the sensor if possible. Check the sensor that it reports correct data. Reset the error from Client, Monitor or Supervisor interface.</p>
<h4 id="error_load_sensor_conflict_after_dropoff"><a class="header" href="#error_load_sensor_conflict_after_dropoff">ERROR_LOAD_SENSOR_CONFLICT_AFTER_DROPOFF</a></h4>
<p>Load sensor detects the load after drop-off action has been completed. This error is fatal error so it has to be reset by customer.
This error check can be disabled with the <strong>actuator_check_load_sensor_status_after_unloading</strong> parameter if the sensor cannot be used for this kind of check.</p>
<p><strong>How to recover:</strong> Check the sensor that it reports correct data. Reset the error from Client, Monitor or Supervisor interface.</p>
<h4 id="error_load_sensor_conflict_with_navithor"><a class="header" href="#error_load_sensor_conflict_with_navithor">ERROR_LOAD_SENSOR_CONFLICT_WITH_NAVITHOR</a></h4>
<p>Load sensor and fleet control reported load status does not match. Error is reset after there is no conflict. Two modes that can be selected with <strong>load_sensor_conflict_mode</strong> parameter.</p>
<p><strong>Mode 1:</strong> Check is done in three different situations:</p>
<ol>
<li>At <strong>actuator_disable_load_sensor_distance</strong> distance before AGV drives to the Pickup or Dropoff point.</li>
<li>At the beginning of Pickup or Dropoff buffer.</li>
<li>When AGV state changes from Manual to Standby.</li>
</ol>
<p>On situation 1 the check starts when AGV is at <strong>actuator_disable_load_sensor_distance</strong> distance from the Pickup or Dropoff point and ends when AGV has driven <strong>min_distance_to_check_the_load_sensor</strong> distance. On situation 2 the check starts when AGV is at the beginning of Pickup or Dropoff buffer and ends when AGV has driven <strong>min_distance_to_check_the_load_sensor</strong> distance. There is an option to force AGV to go to Manual state if this error is triggered. That can be done by setting this parameter: <strong>load_sensor_conflict_goes_to_manual</strong>. There is also parameter that defines what source is used for reset the manual state: <strong>load_sensor_conflict_manual_reset_source</strong>.</p>
<p><strong>Mode 2:</strong> Check is done when AGV is in Auto state. Uses <strong>load_sensor_status_change_timer_ms</strong> parameter as a timer to avoid glitches. Not checked if AGV is closer to the Pickup or Dropoff symbolic point than <strong>actuator_disable_load_sensor_distance</strong>.</p>
<p><strong>How to recover:</strong> Check that pallet is firmly placed on the forks and move it closer to the sensor if possible. Check the sensor that it reports correct data. Check Navithor Client that it has correct resource status. If Navithor has incorrect status do pickup/dropoff action from Client or remove/add resource from the AGV to get the status correct.</p>
<h4 id="error_load_sensor_status_changed_in_auto"><a class="header" href="#error_load_sensor_status_changed_in_auto">ERROR_LOAD_SENSOR_STATUS_CHANGED_IN_AUTO</a></h4>
<p>Load sensor status changes in Auto state. Fatal error that requires customer to reset it. Timer is used to avoid glitches taken into account, meaning that if the sensor just quickly changes to 0 and the back to 1, it does not raise an error. Timer timeout can be set with <strong>load_sensor_status_change_timer_ms</strong> parameter.</p>
<p><strong>How to recover:</strong> Move pallet correctly to the sensor and check that load sensor reports correct value. Error can be reset from Client, Monitor or Supervisor interface after the sensor is checked.</p>
<h4 id="error_actuator_safe_zone_violation"><a class="header" href="#error_actuator_safe_zone_violation">ERROR_ACTUATOR_SAFE_ZONE_VIOLATION</a></h4>
<p>Actuator is too far from the reference when AGV is inside <em>Actuator safety zone</em>. This check uses <strong>actuator_outer_tolerance_mm</strong> for checking the difference between reference and measured values. If the AGV is doing Pickup or Dropoff actions <strong>actuator_load_aboard_offset_mm</strong> parameter is used with the tolerance parameter.</p>
<p><strong>How to recover:</strong> Check that the actuator is close enough to the reference. If it drifts slowly or is very close to the outer tolerance, that might trigger this error. This is fatal error that can be reset from Client, Monitor or Supervisor interface after the reason is clear.</p>
<h4 id="error_load_unload_height_too_low"><a class="header" href="#error_load_unload_height_too_low">ERROR_LOAD_UNLOAD_HEIGHT_TOO_LOW</a></h4>
<p>Actuator reference is too low during Pickup or Dropoff actions. This error is used only with reference controlled fork (<strong>actuator_type</strong> = 2)</p>
<ul>
<li>Dropoff: Actuator reference is below <strong>actuator_min_val</strong> - <strong>actuator_outer_tolerance_mm</strong></li>
<li>Pickup: Actuator reference is below the current height - <strong>actuator_outer_tolerance_mm</strong>. Meaning that actuator is tried to decrease when doing pickup.</li>
</ul>
<p><strong>How to recover:</strong> </p>
<p>Check these parameters:</p>
<ul>
<li><strong>actuator_min_val</strong></li>
<li><strong>actuator_outer_tolerance_mm</strong></li>
<li><strong>ACTUATOR_MIN_VAL</strong> from machine_type parameter file</li>
<li><strong>ACTUATOR_LOAD_MIN_VAL</strong> from machine_type parameter file</li>
<li>Route height where the Pickup or Dropoff is done</li>
</ul>
<p>This log line shows the minimum allowed height: &quot;lowest allowed height&quot;.</p>
<p>This is fatal error that can be reset from Client, Monitor or Supervisor interface after the reason is clear.</p>
<h3 id="advanced-troubleshooting-11"><a class="header" href="#advanced-troubleshooting-11">Advanced troubleshooting</a></h3>
<h4 id="useful-log-lines"><a class="header" href="#useful-log-lines">Useful log lines</a></h4>
<p>Load statuses. This log line shows load statuses and some load sensor related information. This log line is visible only if there is load sensor used on the system.</p>
<ul>
<li>&quot;Actuator check load sensor: loadState 0 driveToLoad 0 driveAway 0 end 0 loadAboard 0 loadSensor 1 loadDet 0 navithorLoad 1, stateChanged 0 loadDetScannerHeightInHome 0&quot;
<ul>
<li>loadState = AGV in LOAD state </li>
<li>driveToLoad = AGV is closer to the end symbolic point than <strong>actuator_disable_load_sensor_distance</strong></li>
<li>driveAway = AGV is closer to the last symbolic point than <strong>actuator_disable_load_sensor_distance</strong></li>
<li>end = AGV arrived to the trajectory end</li>
<li>loadAboard = Navitrol load status (bitwise number), 0 = empty, 1 = main lift has load, 2 = secondary lift has load, 3 = both lifts has load.</li>
<li>loadSensor = Load sensor in use</li>
<li>loadDet = Load sensor status. 0 = no load detected, 1 = one sensor detects the load, 2 = two sensors detects the load...</li>
<li>navithoLoad = Navithor load status. 0 = unknown, 1 = empty, 4 = full.</li>
<li>stateChanged = AGV state changed from Manual to Auto</li>
<li>loadDetScannerHeightInHome = Not used for anything</li>
</ul>
</li>
</ul>
<p>Lift actuator control. This log is active when AGV is not in Standby state.</p>
<ul>
<li>&quot;Actuator control: mcsForkMin 0, forkMin 0, forkLoadMin 0, targetVal 100, curVal 0, activate 1, incAct 1, decAct 0, strictFork: 0&quot;
<ul>
<li>mcsForkMin = Minimum fork height from Navithor. Same as <strong>ACTUATOR_MIN_VAL</strong> from machine_type parameter file.</li>
<li>forkMin = Parameter <strong>actuator_min_val</strong></li>
<li>forkLoadMin = Parameter <strong>actuator_load_min_val</strong></li>
<li>targetVal = Fork reference value in mm or binary command (0 = no control, 1 = decrease, 2 = increase)</li>
<li>curVal = Fork measurement in mm</li>
<li>activate = 0 = Actuator control not active, 1 = Actuator control active</li>
<li>incAct = 0 = Actuator not commanded to increase, 1 = Actuator commanded to increase</li>
<li>decAct = 0 = Actuator not commanded to decrease, 1 = Actuator commanded to decrease</li>
<li>strictFork = 0 = AGV is not inside strict property, 1 = AGV is inside strict property</li>
</ul>
</li>
</ul>
<p>Auto state lift actuator.</p>
<ul>
<li>&quot;Act: Auto_state, load sensor in use 0, load det 0, load aboard 0, mcsForkMinH 0, fork_min_val 0, targetVal 100&quot;
<ul>
<li>Load sensor in use = Load sensor in use or not.</li>
<li>load det = Load sensor value</li>
<li>load aboard = Navitrol load status</li>
<li>mcsForkMinH = Minimum fork height from Navithor. Same as <strong>ACTUATOR_MIN_VAL</strong> from machine_type parameter file.</li>
<li>fork_min_val = Parameter <strong>actuator_load_min_val</strong></li>
<li>targetVal = Fork reference value in mm or binary command (0 = no control, 1 = decrease, 2 = increase)</li>
</ul>
</li>
</ul>
<p>Other actuator controls in Auto state.</p>
<ul>
<li>&quot;Actuator control general: type %s, curVal 0.0, targetVal 50.0 (%s), activate 0&quot;
<ul>
<li>type = Actuator type as string</li>
<li>curVal = Actuator measurement value</li>
<li>targetVal = Actuator reference value</li>
<li>(%s) = String to tell if actuator values are in degrees (deg) or millimeters (mm).</li>
<li>activate = Actuator control active</li>
</ul>
</li>
</ul>
<p>Other actuator controls in Load state.</p>
<ul>
<li>&quot;Actuator control load sequence 1 for type %s: curVal 0.0, targetVal 10.0 (%s), activate 0, timer 100 ms&quot;
<ul>
<li>load sequence = Sequence number. See &quot;Pickup and Dropoff sequences&quot; chapter.</li>
<li>type = Actuator type as string</li>
<li>curVal = Actuator measurement value</li>
<li>targetVal = Actuator reference value</li>
<li>(%s) = String to tell if actuator values are in degrees (deg) or millimeters (mm).</li>
<li>activate = Actuator is requested to be active</li>
<li>timer = Time passed since actuator control has started in ms.</li>
</ul>
</li>
</ul>
<p>Load sensor data. Logged in every state.</p>
<ul>
<li>&quot;Actuator loadSenUsed 0 loadDet 0&quot;
<ul>
<li>loadSenUsed = Load sensors in use</li>
<li>loadDet = Load detected with sensors</li>
</ul>
</li>
</ul>
<p>All actuators in the system. Logged in every state. If some actuator is missing, check the communication that Navitrol receives data from all actuators.</p>
<ul>
<li>&quot;CommonActuator 0 type %s, source %d, meas 0.0 (%s)&quot;
<ul>
<li>0 = This first number is only array index for actuator</li>
<li>type = Actuator type as string</li>
<li>source = Source number where the actuator data comes in to the system.</li>
<li>meas = Actuator measurement value</li>
<li>(%s) = String to tell if actuator values are in degrees (deg) or millimeters (mm).</li>
</ul>
</li>
</ul>
<p>Lift actuator control in Manual mode.</p>
<ul>
<li>&quot;Actuator control:  targetVal 100, curVal 0, activate 1, incAct 1, decAct 0&quot;
<ul>
<li>targetVal = Fork reference value in mm or binary command</li>
<li>curVal = Fork measurement in mm</li>
<li>activate = 0 = Actuator control not active, 1 = Actuator control active</li>
<li>incAct = 0 = Actuator not commanded to increase, 1 = Actuator commanded to increase</li>
<li>decAct = 0 = Actuator not commanded to decrease, 1 = Actuator commanded to decrease</li>
</ul>
</li>
</ul>
<p>Lift actuator is active.</p>
<ul>
<li>&quot;Actuator not within limits or is active, move not allowed (inLimits: 0, strictFork: 0, softLimit: 0, actActive: 1&quot;
<ul>
<li>inLimits = 1 when actuator is within tolerances</li>
<li>strictFork = 1 when AGV is within strict property</li>
<li>softLimit = Fork is below <strong>ACTUATOR_MIN_VAL</strong> or below <strong>actuator_load_min_val</strong> when AGV has load or binary lift is not at high limit when it should be.</li>
<li>actActive = Actuator active. This info comes via customer interface.</li>
</ul>
</li>
</ul>
<h4 id="useful-log-lines-for-communication"><a class="header" href="#useful-log-lines-for-communication">Useful log lines for communication</a></h4>
<p>Ethernet control with supervisor status message ID 3002 actuator section 1.
See <a href="LoadHandling/ActuatorControl/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Supervisor document</a>.</p>
<p>Incoming message to Navitrol:</p>
<ul>
<li>Set parameter <strong>log_veh_inte_eth</strong> to 1</li>
<li>&quot;veh_inte_ethernet: Supervisor actuator val 0 act 0, lowL 0 highL 0 loadSen 0 loadDet 0&quot;
<ul>
<li>val = Actuator height in mm </li>
<li>act = Actuator is active (0 or 1)</li>
<li>lowL = Low limit sensor (0 or 1) </li>
<li>highL = High limit sensor (0 or 1) </li>
<li>LoadSen = Load sensor is in use (0 or 1) </li>
<li>LoadDet = Load sensor value (0 or 1)</li>
</ul>
</li>
</ul>
<p>Outcoming message from Navitrol:</p>
<ul>
<li>&quot;veh_inte_ethernet: Send actuator refVal 0 act 0 inc 0 dec 0 bin1 0 bin2 0 bin3 0 bin4 0&quot;
<ul>
<li>refVal = Actuator reference in mm </li>
<li>act = Activate command (0 or 1) </li>
<li>inc = Increase command (0 or 1) </li>
<li>dec = Decrease command (0 or 1) </li>
<li>bin1 = Bitmapped value (bit 0: activate, bit 1: increase and bit 2: decrease) </li>
<li>bin2 = Bitmapped value (reserved for future use) </li>
<li>bin3 = Bitmapped value (bit 0: stop and hold active)</li>
<li>bin4 = Bitmapped value (reserved for future use) </li>
</ul>
</li>
</ul>
<p>Ethernet control with supervisor message ID 1031/1131. See <a href="LoadHandling/ActuatorControl/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Supervisor document</a>.</p>
<p>Incoming message to Navitrol:</p>
<ul>
<li>
<p>Set parameter <strong>log_veh_inte_eth</strong> to 2</p>
</li>
<li>
<p>&quot;ETH_CTRL_IN 1031: MsgNum 123, numOfActs 2, numOfMeas 0, targetSensorsAvailable 0, targetSensors 0, safeSensorsAvailable 0, safeSensors 0&quot;</p>
<ul>
<li>MsgNum = Message number, should be increased by one for each message</li>
<li>numOfActs = Number of actuators to control</li>
<li>numOfMeas = Number of measurement sensors</li>
<li>targetSensorsAvailable = Bitmap value of available sensors</li>
<li>targetSensors = Bitmap value of active sensors</li>
<li>safeSensorsAvailable = Bitmap value of available safety sensors</li>
<li>safeSensors = Bitmap value of active safety sensors</li>
</ul>
</li>
<li>
<p>Actuator array. Logged if numOfActs is greater than 0.</p>
</li>
<li>
<p>&quot;ETH_CTRL_IN 1031: Actuators[0] requestedControl 2, status 1, actPos 50, reserved 0&quot;</p>
<ul>
<li>Actuators[i] = Array index of actuator</li>
<li>requestedControl = Actuator type to control.</li>
<li>status = Actuator status.</li>
<li>actPos = Actuator mesurement in mm or 0.1 degrees.</li>
<li>reserved = Reserved for future use.</li>
</ul>
</li>
<li>
<p>Measurement sensors array. Logged if numOfMeas is greater than 0.</p>
</li>
<li>
<p>&quot;ETH_CTRL_IN 1031: Measurements[0] type 1, measVal 0&quot;</p>
<ul>
<li>Measurements[i] = Array index of sensor.</li>
<li>type = Sensor type.</li>
<li>measVal = Measurement value. Distances in millimeters, angles in 0.1 degrees, weights in kilograms.</li>
</ul>
</li>
</ul>
<p>Outcoming message from Navitrol:</p>
<ul>
<li>
<p>Set parameter <strong>log_veh_inte_eth</strong> to 2</p>
</li>
<li>
<p>&quot;ETH_CTRL_OUT 1131: sent num 124, msgStatus 0, numOfActuators 2&quot;</p>
<ul>
<li>sent num = Message number, should be increased by one for each message</li>
<li>msgStatus = 0 – ok, 1 – configuration error (an actuator section is sent with status bit 15 set)</li>
<li>numOfActuators = Number of actuators that Navitrol controls</li>
</ul>
</li>
<li>
<p>Actuator array. Logged if numOfActuators is greater than 0.</p>
</li>
<li>
<p>&quot;ETH_CTRL_OUT 1131: type 1, refVal 150, binary 1&quot;</p>
<ul>
<li>type = Actuator type</li>
<li>refVal = Actuator reference value in millimeters or 0.1 degrees</li>
<li>binary = Actuator status. Bit0 = activate, bit1 = increase, bit2 = decrease</li>
</ul>
</li>
</ul>
<p>CAN Encoder. Schwarzmueller or Curtis</p>
<p>Incoming mesage to Navitrol:</p>
<ul>
<li>Check that this parameter is enabled: <strong>can_actuator_ctrl_model</strong></li>
<li>&quot;HAL_CopyActuatorMeasToShared: Actuator 0 measured value 50 mm&quot;
<ul>
<li>Actuator = Actuator index</li>
<li>measured value = Measured value in mm.</li>
</ul>
</li>
</ul>
<p>Outcoming message from Navitrol:</p>
<ul>
<li>
<p>Fork up, using rpm.</p>
</li>
<li>
<p>&quot;HAL_ControlSingleCanActuatorRPM: Actuator 0 control: refval 0.5, activate 1, outputRPM 500, maxOutputRPM 1000,  brakes 0&quot;.</p>
<ul>
<li>Actuator = Actuator index</li>
<li>refVal = Reference value in m</li>
<li>activate = If actuator should be activated</li>
<li>outputRPM = RPM value out</li>
<li>maxOutputRPM = Maximum RPM value. <strong>actuator_ctrl_max_output</strong> parameter.</li>
<li>brakes = Brakes enabled or not</li>
</ul>
</li>
<li>
<p>Fork down, using proportional valve.</p>
</li>
<li>
<p>&quot;Actuator p control, out 500, err 10, Pout 1.5, Iout 1000, min 0, max 1000&quot;</p>
<ul>
<li>out = Output value for valve</li>
<li>err = Error value for control</li>
<li>Pout = Proportional value for controller</li>
<li>Iout = Integral value for controller</li>
<li>min = Minimum value of the control. <strong>can_actuator_ctrl_prop_valve_min</strong> parameter.</li>
<li>max = Maximum value of the control. <strong>can_actuator_ctrl_prop_valve_max</strong> parameter.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scanner-lift-actuator"><a class="header" href="#scanner-lift-actuator">Scanner Lift Actuator</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-36"><a class="header" href="#overview-36">Overview</a></h2>
<p>Scanner lift control is a feature that makes it possible to raise and lower 2D laser scanner to detect targets or empty space from multiple heights. This is often required in racking applications.</p>
<p>Scanner lift is controlled with target values given by the Navitrol.
Customer controls the lift based on those references and sends measured scanner height value to Navitrol.</p>
<p>Typically, Navitrol controls the scanner between scanner home position (actuator_scanner_lift_home_val_mm) and detection level (actuator_scanner_lift_detection_level_val_mm), but if there is not enough room to move the scanner reference value can be something between the two.</p>
<p><img src="LoadHandling/ScannerLiftActuator/./media-en/image4.png" alt="" /></p>
<h3 id="use-cases"><a class="header" href="#use-cases">Use cases</a></h3>
<ul>
<li>
<p>Rack height detection</p>
</li>
<li>
<p>Empty space detection</p>
</li>
<li>
<p>Load detection</p>
</li>
<li>
<p>Unload buffers</p>
</li>
</ul>
<h3 id="preconditions-6"><a class="header" href="#preconditions-6">Preconditions</a></h3>
<ul>
<li>Communication interface for sending scanner lift height measurements and reading the height references. For example, supervisor message 1031 actuator type sensor lift can be used.</li>
</ul>
<h2 id="set-up-11"><a class="header" href="#set-up-11">Set up</a></h2>
<h3 id="parameters-10"><a class="header" href="#parameters-10">Parameters</a></h3>
<ol>
<li>
<p><strong>datatype,</strong> <strong>parameter_name,</strong> <strong>default value</strong></p>
</li>
<li>
<p><strong>I, actuator_scanner_lift_enabled, 0</strong></p>
<ul>
<li>
<p>Scanner lift that is attached to fork. 1 enabled, 0, disabled</p>
</li>
<li>
<p><strong>Set to 1</strong></p>
</li>
</ul>
</li>
<li>
<p><strong>I,actuator_scanner_lift_type, 2</strong></p>
<ul>
<li>
<p>1 = manual control, 2 = reference value controlled actuator, 3 = binary controlled actuator (low/high pos only)</p>
</li>
<li>
<p>NOTE! With type 3, the measurement height of the scanner is not known and the safety height check is done only based on the <strong>actuator_scanner_lift_detection_level_val_mm</strong> parameter. The assumption is that the scanner lift is controlled to that height when decreasing it to low position. If the target height goes below the safety height, the scanner lift is increased to high position. </p>
</li>
</ul>
</li>
<li>
<p><strong>I, actuator_scanner_lift_home_val_mm, 0</strong></p>
<ul>
<li>
<p>Home value for scanner lift.</p>
</li>
<li>
<p>If the <strong>actuator_scanner_lift_type</strong> is 3, this parameter should be a height where the scanner is on the high position.</p>
</li>
<li>
<p>Value relative to the fork</p>
<ul>
<li>
<p>Positive &gt; scanner above the fork</p>
</li>
<li>
<p>zero &gt; scanner at the fork level</p>
</li>
<li>
<p>Negative &gt; scanner below the fork</p>
</li>
</ul>
</li>
<li>
<p><strong>Should be safe for any fork height</strong> and a bit above the fork level if used for load detection</p>
</li>
</ul>
</li>
</ol>
<p><img src="LoadHandling/ScannerLiftActuator/./media-en/image5.png" alt="" /></p>
<ul>
<li>
<p><strong>I, actuator_scanner_lift_detection_level_val_mm, -150</strong></p>
<ul>
<li>
<p>Scanner height value in which the scanner can see past a loaded
resource.</p>
</li>
<li>
<p>If the AGV is loaded scanner is moved to this height when it is used for detection</p>
</li>
<li>
<p>If the <strong>actuator_scanner_lift_type</strong> is 3, this parameter should be a height where the scanner is on the low position below the fork.</p>
</li>
<li>
<p>Value relative to fork</p>
<ul>
<li>
<p>Positive &gt; scanner above the fork</p>
</li>
<li>
<p>zero &gt; scanner at the fork level</p>
</li>
<li>
<p>Negative &gt; scanner below the fork</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="LoadHandling/ScannerLiftActuator/./media-en/image6.png" alt="" /></p>
<ul>
<li>
<p><strong>I, actuator_scanner_lift_min_safe_val_mm, 100</strong></p>
<ul>
<li>
<p>Minimum allowed difference from the zero height of the fork to scanner lift height value</p>
</li>
<li>
<p>Measured by lowering the fork to minimum height and then lowering the scanner as low as safely possible. The measured scanner lift height value at that position is the value for <strong>actuator_scanner_lift_min_safe_val_mm</strong></p>
</li>
<li>
<p>This value is used to calculate safe fork references when the scanner is below the fork and could be crushed if the fork is lowered too much.</p>
</li>
</ul>
</li>
</ul>
<p><img src="LoadHandling/ScannerLiftActuator/./media-en/image7.png" alt="" /></p>
<ul>
<li>
<p><strong>I, actuator_scanner_lift_used_for_load_det, 0</strong></p>
<ul>
<li>Scanner in lift is used for load detection. 0 = No, 1 = Yes</li>
</ul>
</li>
<li>
<p><strong>I, actuator_tolerance_scanner_lift_mm, 2</strong></p>
<ul>
<li>Tolerance for scanner lift. Actuator is being controlled towards target value until the measured value is inside this tolerance.</li>
</ul>
</li>
<li>
<p><strong>F, actuator_lower_scanner_before_unload_buffer_dist, 0.6</strong></p>
<ul>
<li>Distance from unload buffer when scanner is lowered (in meters)</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="racking-user-instructions"><a class="header" href="#racking-user-instructions">Racking User Instructions</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="introduction-47"><a class="header" href="#introduction-47">Introduction</a></h2>
<p>Warehouse racking feature introduces large inventory and warehouse support in Navitec software products. From Navitrol's point of view this means ability to load and unload items from multiple heights (shelves) in one location. Racking also comes with a variety of detection features for more accurate and safer operation.</p>
<p>In addition to a normal drive order to symbolic point, Navitrol gets a shelf ID which incorporates height information. Racks and shelves in the production area are defined in Navithor Tools software. Please read the Navithor Tools warehouse racking document for more information.</p>
<h2 id="general-instructions"><a class="header" href="#general-instructions">General Instructions</a></h2>
<p>There are two minimum requirements to start up the feature in Navitrol.</p>
<ol>
<li>
<p>Update racking feature license to AGV</p>
</li>
<li>
<p>Set parameter <strong>racking_mode to 1</strong></p>
</li>
</ol>
<p>For loading and unloading, parameter <strong>actuator_load_aboard_offset_mm</strong> needs to be defined. This tells how much forks are lifted to pick up a pallet. Note that in racking it is required that parameter <strong>actuator_load_min_val is set to 0</strong>.
Next, it is represented how to define fork movements when approaching the rack.</p>
<h2 id="define-fork-movements-close-to-rack"><a class="header" href="#define-fork-movements-close-to-rack">Define fork movements close to rack</a></h2>
<p>For safety, it is important to carefully define the minimum distance from the rack symbolic points outside of which AGV can move the forks while driving. This ensures that if the AGV is still trying to move the forks while inside the distance limit, it will stop to an error avoiding possible collision to shelf. This parameter is called <strong>racking_min_dist_rack_to_move_actuator_meters.</strong> To avoid safety errors, parameter called <strong>racking_check_point_before_min_dist_rack_offset_m</strong> is introduced.
This parameter defines the distance from the safety limit where AGV is triggered to stop if forks are still not at target height or AGV must do some detection routines like pallet detection or empty space detection (see Figure 1). AGV continues driving when the detection routines are ready and forks are on the correct height. This offset parameter is used also when leaving rack to make sure that it is safe to start lowering the fork.</p>
<p>Error: <strong>ERROR_ACTUATOR_OUT_OF_TOLERANCES_CLOSE_TO_RACK</strong></p>
<p><img src="LoadHandling/Racking/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1: Minimum distance from rack symbolic point to allow fork movements (left fig.). Check point to stop AGV for controlling forks to target level and to do detection routines (right fig.).</p>
</blockquote>
<h3 id="define-fork-movements-approaching-rack"><a class="header" href="#define-fork-movements-approaching-rack">Define fork movements approaching rack</a></h3>
<p>There are two options how AGV can approach the rack. In first option, AGV can move the forks to target level while driving before it gets close to the rack. In second option, AGV drives close to the rack forks down and stops in front of the rack to control forks to the target level.</p>
<p>The following set of parameters can be used to control fork movements while approaching the rack:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>actuator_move_allowed_while_driving_loaded</strong></td><td>to allow fork control while driving and carrying a pallet.</td></tr>
<tr><td><strong>actuator_move_allowed_while_driving_unloaded</strong></td><td>to allow fork control while driving without pallet.</td></tr>
<tr><td><strong>racking_max_dist_from_rack_begin_lift_actuator_meters</strong></td><td>defines how early the AGV can start controlling forks to target level.</td></tr>
<tr><td><strong>racking_actuator_speed_loaded_mm_per_s</strong></td><td>tells the speed of the forks when AGV is carrying a pallet. It is used to calculate starting point for lifting the forks so that they are at target level before the check point in front of the rack.</td></tr>
<tr><td><strong>racking_actuator_speed_not_loaded_mm_per_s</strong></td><td>tells the speed of the forks while driving without pallet.</td></tr>
</tbody></table>
<h3 id="define-agv-speed-approaching-and-close-to-rack"><a class="header" href="#define-agv-speed-approaching-and-close-to-rack">Define AGV speed approaching and close to rack</a></h3>
<p>AGV's speed in racking uses the same principals as in normal navigation.
However, there can be an additional limitation for AGV's speed when forks are not at driving level or so-called home position. Even if the speed limitation is not taken into use, the parameters that describe the speed are used for calculating the start point for controlling forks to next target level. This is in case forks can be moved while driving.</p>
<p>Parameters:</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>actuator_not_in_home_position_limit_agv_speed</strong></td><td>to limit speed when forks are not at home position</td></tr>
<tr><td><strong>actuator_not_in_home_position_agv_speed_loaded_m_per_s</strong></td><td>defines the speed when AGV is carrying a pallet and forks are not at home position</td></tr>
<tr><td><strong>actuator_not_in_home_position_agv_speed_unloaded_m_per_s</strong></td><td>defines the speed when AGV is driving without pallet and forks are not at home position</td></tr>
<tr><td><strong>actuator_home_val_mm</strong></td><td>defines the home position when driving without a pallet.<br>This can be either actuator_min_val or the actuator value defined in route properties in Navithor Tools, whichever is larger.</td></tr>
</tbody></table>
<h3 id="actuator-zones"><a class="header" href="#actuator-zones">Actuator zones</a></h3>
<p>Actuator zones are polygons in the map that can be added and edited in Navithor Tools. When AGV is inside a zone, certain detections and actions take place depending on the type of the zone. AGV is considered to be inside Actuator zone when one of its corner points or navigation point is inside the zone. There is also a small safety margin applied around AGV to extend the corner points from the actual dimensions. There are two types of Actuator zones which are next represented in more detail.</p>
<h3 id="safety-zone"><a class="header" href="#safety-zone">Safety zone</a></h3>
<p>Actuator safety zone is planned to be used close to racks. It is meant as a redundant safety method if the main logic would fail. It detects if the target value of the forks differs more than tolerance from the measured value and if so, triggers an error to stop the AGV. This means it only supervises that forks are not controlled of tolerances when they are inside a rack, and that target value does not change when inside a rack. The safety zone feature does not check whether the forks will hit the shelf when driving to the rack and it does not know if a pallet is being pushed for example.</p>
<p>Error: <strong>ERROR_ACTUATOR_SAFE_ZONE_VIOLATION</strong> Parameter(s):</p>
<ul>
<li><strong>actuator_safety_zone_margin_meters</strong> to extend corners of the AGV's frame for actuator safety zone check.</li>
</ul>
<h3 id="home-position-zone"><a class="header" href="#home-position-zone">Home position zone</a></h3>
<p>Home position zone is meant for driving in the cross aisles and generally whenever it is needed to drive with forks down.
When AGV is inside the zone, it is forced to lower the forks to home position which ensures safety driving outside of the rack corridors.
If the AGV enters the zone with forks not at the home position, target value for the forks immediately changes to the home position value. User can choose whether AGV stops or can continue driving while moving the forks to home position.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>actuator_home_val</strong></td><td>is home position when driving without a pallet. When carrying a pallet home position is actuator_home_val + actuator_load_aboard_offset_mm.</td></tr>
<tr><td><strong>actuator_home_pos_safety_margin_meters</strong></td><td>to extend corners of the AGV's frame for actuator home position zone check.</td></tr>
<tr><td><strong>actuator_strict_for_home_pos_zone</strong></td><td>0 = continue driving while controlling forks to home position, 1 = stop the AGV while controlling forks to home position.</td></tr>
</tbody></table>
<p><img src="LoadHandling/Racking/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2: Use of actuator home position zone. When AGV comes out of the rack aisle to the cross aisle, it is forced to control the forks to home position.</p>
</blockquote>
<h2 id="pallet-detection"><a class="header" href="#pallet-detection">Pallet detection</a></h2>
<h3 id="pallet-detection-modes"><a class="header" href="#pallet-detection-modes">Pallet detection modes</a></h3>
<p>Two modes:  </p>
<ul>
<li>
<p>1. Pallet detection: Check pallet location and angle. </p>
</li>
<li>
<p>2. Pocket detection: Scanning the correct height for the pallet legs using scanner and controlling the forks to the middle of the legs. </p>
</li>
</ul>
<p>Docking. Meaning that AGV will change the route to drive to the detected target. </p>
<h3 id="pallet-location-check"><a class="header" href="#pallet-location-check">Pallet location check</a></h3>
<p>Pallet detection in the racking feature means that pallet location and angle is verified using pallet detection. If the angle is too high or if pallet is too far from the expected location, error is set.</p>
<p>Symbolic point location depends on the navigation point (AGV kinematics), so it might not be on the middle of the rack. <strong>docking_stop_distance</strong> parameter is used to check the pallet location related to the symbolic point.
Then the pallet location is verified with parameter <strong>docking_max_dist_error_from_end_point</strong>. If the pallet is further away from the symbolic point, error will be set.
The pallet angle is checked with parameter <strong>docking_max_target_angle</strong>. These checks are done on both modes, also after pocket detection has controlled the forks to the pocket height. </p>
<p><img src="LoadHandling/Racking/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 3: Symbolic point related to the pallet location.</p>
</blockquote>
<h3 id="pocket-detection"><a class="header" href="#pocket-detection">Pocket detection</a></h3>
<p>Pocket detection is a feature that will search the correct height for the pocket (space between the legs) using laser scanner.  </p>
<p>Sequence:  </p>
<ul>
<li>
<p>When the forks are lifted to shelf level, the target height value is decreased by <strong>stack_loading_max_pocket_size_mm</strong> amount to start the scan and to make sure the scanner is below the legs of the pallet. See <em>Min height to allow pockets</em> on Figure 4. </p>
</li>
<li>
<p>Then the pallet detection is activated and target height is set to two times this <strong>stack_loading_max_pocket_size_mm</strong> parameter.
See <em>Max pocket height</em> on a Figure 4.</p>
</li>
<li>
<p>Now during the lifting phase, the low and high heights of the legs are stored. See Figure 5.</p>
</li>
<li>
<p>When the lifting is done, the last found pocket that is over the <strong>stack_loading_min_pocket_size_mm</strong> parameter is chosen. </p>
</li>
<li>
<p>ERROR_PALLET_POCKET_NOT_FOUND is set if there are no pockets found on this phase. </p>
</li>
<li>
<p>Then the actuator is controlled to the middle of the pocket. Here the height difference between the actuator height and scanner height is taken into account using the measurement of the scanner height (if available) + offset parameter or only the offset parameter: <strong>target_detection_actuator_offset_to_scanner_mm</strong>. </p>
</li>
</ul>
<p><img src="LoadHandling/Racking/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 4: Example of the pocket detection.</p>
</blockquote>
<p><img src="LoadHandling/Racking/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 5: Pocket height values. The pocket height is middle of these two values.</p>
</blockquote>
<h3 id="pallet-detection-errors"><a class="header" href="#pallet-detection-errors">Pallet detection errors</a></h3>
<p>This error is set if pocket is not within max and min limit parameters. </p>
<ul>
<li>
<p><strong>ERROR_PALLET_POCKET_NOT_FOUND</strong>: Couldn't find suitable pocket. </p>
</li>
<li>
<p>This will be fatal error, so it would need operator action to reset. </p>
</li>
</ul>
<p>This error is set if target heading is too large or if target is too far from symbolic point or if target is not found. </p>
<ul>
<li>
<p><strong>ERROR_PALLET_DET_FAILURE</strong>: Couldn't find pallet or target is too far away from expected location </p>
</li>
<li>
<p>This will be fatal error, so it would need operator action to reset. </p>
</li>
</ul>
<h3 id="pallet-detection-parameters"><a class="header" href="#pallet-detection-parameters">Pallet detection parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,racking_pallet_det_mode, 1</strong> </td><td> 0 = Disable the check<br>1 = pallet detection checked on precheck state<br>2 = Trying to find the middle point of the pocket by scanning the shelf height +- stack_loading_max_pocket_size_mm. </td></tr>
<tr><td><strong>I,racking_pocket_det_height_offset_mm, 0</strong></td><td>Offset added to the detected pocket height.</td></tr>
<tr><td><strong>I,docking_to_target_enabled, 1</strong> </td><td> 1 = Enables docking to target.<br>2 = docking with custom route </td></tr>
<tr><td><strong>F,docking_stop_distance</strong>,</td><td> Used to calculate new stopping point for AGV navigation point. Calculated from navigation point to the pallet front line. Depends on AGV kinematics. </td></tr>
<tr><td><strong>F,docking_max_dist_error_from_end_point, 0.2</strong> </td><td> Used to check that pallet is found close enough the rack symbolic point </td></tr>
<tr><td><strong>F,docking_max_start_angle, 10.0</strong></td><td> Max allowed angle for the pallet related to the symbolic point. </td></tr>
<tr><td><strong>I,stack_loading_max_pocket_size_mm, 130</strong></td><td> Max  allowed height for pocket. Used also to lift the forks over the shelf height to make sure that we detect the pocket. Shelf height +- this parameter. </td></tr>
<tr><td><strong>I,stack_loading_min_pocket_size_mm, 70</strong></td><td> Min allowed height for pocket. </td></tr>
<tr><td><strong>I,stack_loading_min_hits_top_legs, 2</strong></td><td> Counter for consecutive leg detections. When legs are detected enough times, the height measurement from first detection is used as pocket bottom value. </td></tr>
<tr><td><strong>I,stack_loading_min_false_hits_legs, 2</strong> </td><td> Counter for consecutive false leg detections. When legs are not detected enough times, the height measurement from first scan is used as pocket top value. </td></tr>
<tr><td><strong>I,target_detection_actuator_offset_to_scanner_mm</strong> </td><td> Height offset from the scanner to the fork. Used to get the correct height for the fork when detecting the middle point of pocket with scanner. Because when the scanner sees the middle point, the fork might not be on correct level to be able to drive to the pocket. If the scanner can be moved, then its measurement value + this offset is used instead. </td></tr>
</tbody></table>
<h2 id="beam-detection"><a class="header" href="#beam-detection">Beam detection</a></h2>
<p>The idea with the beam detection is to detect the shelf height with scanner. If the shelf height is only defined in Tools, it might be too risky to use because the height needs to be measured accurately to avoid hitting the shelf.  </p>
<p>NOTE! The beam detection is done only when the AGV is loaded and driving to empty shelf to do unload. </p>
<p><img src="LoadHandling/Racking/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 6: Shelf example.</p>
</blockquote>
<p>Sequence: </p>
<ul>
<li>
<p>On the precheck state, the scanner will be decreased to low position (also might require lowering the forks for a small amount). </p>
</li>
<li>
<p>The forks are lifted to predefined height. The height should be high enough so the whole shelf can be detected with the scanner. </p>
</li>
<li>
<p>The pallet detection is enabled with linear model search. There is assumption for the length of the shelf (<strong>pallet_model_width_y</strong> + <strong>pallet_det_linear_model_max_err</strong>). </p>
</li>
<li>
<p>The detected line is matched for this assumption.  </p>
</li>
<li>
<p>If the shelf is detected, we keep increasing. </p>
</li>
<li>
<p>When the shelf is not detected anymore (meaning that we had detected it before at least once) -&gt; The current detection height is the shelf height.  </p>
</li>
<li>
<p>Then <strong>racking_shelf_height_to_fork_offset_mm</strong> parameter and the scanner height measurement are added to this detected height to get correct height for the actuator. </p>
</li>
<li>
<p>Lines that are longer than the assumption are accepted. There is also check for the x and y coordinates and the angle to makes sure that we detect the shelf and not wall behind the shelf. </p>
</li>
</ul>
<p><img src="LoadHandling/Racking/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 7: The start of the beam detection. Here the AGV is on the Precheck state and the forks are lifted to the shelf level.</p>
</blockquote>
<p>NOTE! <strong>racking_shelf_height_mm</strong> defines the distance from the safe drive-in height to below the shelf height. The forks are lowered to this height just to make sure that we scan the whole shelf. The scan will be started after the forks are at correct position below the shelf. This parameter should be the height of the shelf. If there are shelves with different heights, this parameter should have the value of the shelf that has the largest value.</p>
<p><img src="LoadHandling/Racking/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 8: Start of the scan. Here the scanner is decreased below the shelf to start detecting the beam.</p>
</blockquote>
<p>When the beam detection does not detect the shelf anymore, the lifting is stopped, and that scanning height is used as a shelf height.
The height for the fork will be then measured fork height -- measured scanner height + racking_shelf_height_to_fork_offset_mm </p>
<p><img src="LoadHandling/Racking/./media-en/image11.png" alt="" /></p>
<blockquote>
<p>Figure 9: End of the beam detection. Here the shelf height is detected with the scanner and that is used to control the forks to correct height.</p>
</blockquote>
<h3 id="beam-detection-error"><a class="header" href="#beam-detection-error">Beam detection error</a></h3>
<p>This error is set if the actuator reaches the target height on the lifting phase and the shelf top height is not detected. </p>
<ul>
<li>
<p><strong>ERROR_RACKING_BEAM_DETECTION_FAILED</strong>: Could not find suitable beam for detecting the shelf height. </p>
</li>
<li>
<p>This will be fatal error, so it would need operator action to reset. </p>
</li>
</ul>
<h3 id="beam-detection-parameters"><a class="header" href="#beam-detection-parameters">Beam detection parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,racking_shelf_height_detection_enabled, 1</strong></td><td>1 = enable beam detection<br>0 = disable</td></tr>
<tr><td><strong>I,racking_shelf_height_mm, 100</strong></td><td>Defines roughly the height of the shelf</td></tr>
<tr><td><strong>F,racking_shelf_max_dist_err_m, 0.2</strong></td><td>Maximum distance where the shelf can be from the symbolic point (uses docking_stop_distance)</td></tr>
<tr><td><strong>F,racking_shelf_max_angle_err_deg, 10.0</strong></td><td>Maximum angle error for detected shelf</td></tr>
<tr><td><strong>I,racking_shelf_height_to_fork_offset_mm, 30</strong></td><td>Offset from the accurate shelf height to the fork height, where the AGV can safely drive in and out from the shelf without hitting the shelf.</td></tr>
<tr><td><strong>I,actuator_load_aboard_offset_mm, 100</strong></td><td>Height offset when AGV is loaded</td></tr>
<tr><td><strong>I,actuator_scanner_lift_detection_level_val_mm,</strong></td><td>Detection height for the scanner (related to the fork). If the scanner is not movable, this can be used as an offset.</td></tr>
<tr><td><strong>F,pallet_model_width_y[0], 0.8</strong></td><td>Pallet width. If we detect something that is wider than any of pallet models (+ error), it is defined as beam</td></tr>
<tr><td><strong>F,pallet_det_linear_model_max_err, 0.05</strong></td><td>Error added to the pallet width.</td></tr>
</tbody></table>
<h2 id="empty-space-detection"><a class="header" href="#empty-space-detection">Empty space detection</a></h2>
<p>Empty space detection is a feature that will check if the unload location is empty using the laser scanner. This is used only when the AGV is loaded and driving to unload location.</p>
<p>Sequence:</p>
<ul>
<li>
<p>Starts when the AGV is at precheck state. This detection is used only on unload case.</p>
</li>
<li>
<p>Search area is the pallet size.</p>
</li>
<li>
<p>Search height can be set in two ways:</p>
<ul>
<li>
<p>From the current shelf height to the shelf height above -- offset parameter.</p>
</li>
<li>
<p>Height is current shelf height + height parameter.</p>
</li>
</ul>
</li>
<li>
<p>At first, the scanner is decreased to detection height and forks are lifted to level where the scanner can see above the shelf.</p>
</li>
<li>
<p>AGV starts scanning the area by lifting the forks. The empty space check is done only when lifting up. After the scan, the forks are lowered back to the shelf height.</p>
</li>
<li>
<p>If the area has more scanner points than the limit (the max number of scanner points can be set with parameter), the area is not empty, and error is set. If no scanner points are found, the area is empty and AGV can continue driving to the shelf.</p>
</li>
</ul>
<p>NOTE! If pallet detection is used, the last found pallet model is used to define the search area. If pallet detection is not used, the pallet model with index 0 is used as default.</p>
<p><img src="LoadHandling/Racking/./media-en/image12.png" alt="" /></p>
<blockquote>
<p>Figure 10: Empty space height to the shelf above.</p>
</blockquote>
<p><img src="LoadHandling/Racking/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>Figure 11: Search area from above.</p>
</blockquote>
<p>Symbolic point location depends on the navigation point (AGV kinematics), so it might not be on the middle of the rack. The <strong>docking_stop_distance</strong> is used to check the correct location related to the symbolic point. Then the empty space detection is used only for the area where the pallet will be unloaded. The pallet length and width are known based on the pallet detection results from last load point or the zero index pallet model parameters.</p>
<p>The <strong>Navitrol 6.32</strong> has two additional parameters that can define larger area for empty space detection. These values are added to the pallet dimensions (width and length). The parameters are <strong>empty_space_area_width_addition_m</strong> and <strong>empty_space_area_length_addition_m</strong></p>
<h3 id="empty-space-detection-error"><a class="header" href="#empty-space-detection-error">Empty space detection error</a></h3>
<p>This error is set if scanner points exceed the <strong>occup_check_min_hits</strong> on the search area.</p>
<ul>
<li>
<p><strong>ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED</strong>: Unload area not free, cannot continue driving.</p>
</li>
<li>
<p>This will be fatal error, so it would need operator action to reset.</p>
</li>
</ul>
<h3 id="empty-space-detection-parameters"><a class="header" href="#empty-space-detection-parameters">Empty space detection parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,racking_empty_space_check_mode: 1</strong> </td><td> 0 = Disable the check, 1 = Check to the height of the rack above, 2 = Use only racking_empty_space_det_height_mm parameter to define the height. </td></tr>
<tr><td><strong>I,occup_check_min_hits, 2</strong> </td><td> Defines how many scanner points are needed inside the search area to trigger the error. </td></tr>
<tr><td><strong>I,racking_empty_space_det_height_mm, 200</strong> </td><td> How far from the current shelf we can lift the actuator to check the empty space. By default, the height is taken from the shelf above, but if it is not found this parameter is used. In most cases, increasing only 20cm might already be enough to see if the unload area is empty or not. </td></tr>
<tr><td><strong>I,racking_shelf_height_mm, 100</strong> </td><td> Estimate for the shelf height. Used in empty space detection to get the detection height below the shelf above. </td></tr>
<tr><td><strong>F,docking_stop_distance,</strong> </td><td> Used to get the search area related to the symbolic point. Calculated from symbolic point to the imagined unload location (pallet front line).</td></tr>
<tr><td><strong>F,pallet_model_width_y[0], 0.8</strong> </td><td> Width of the search area. </td></tr>
<tr><td><strong>F,pallet_model_length_x[0], 1.25</strong> </td><td> Length of the search area. Calculated from the symbolic point + docking_stop_distance. </td></tr>
<tr><td><strong>F,empty_space_area_width_addition_m, 0.00</strong></td><td>Positive value increases the width of the empty space detection area. This value is added to the pallet width to both directions. If this value is 0.05 and width is 0.8 the safety area width is 0.9. Min -1.0 Max 1.0 (meters)</td></tr>
<tr><td><strong>F,empty_space_area_length_addition_m, 0.00</strong></td><td>Positive value increases the length of the empty space detection area. This value is added to the pallet length to both directions. If this value is 0.05 and length is 1.25 the safety area length is 1.35. Min -1.0 Max 1.0 (meters)</td></tr>
</tbody></table>
<h2 id="data-matrix-marker-detection-for-position-correction-of-side-loader-loading-position"><a class="header" href="#data-matrix-marker-detection-for-position-correction-of-side-loader-loading-position">Data Matrix marker detection for position correction of side loader loading position</a></h2>
<p>Data matrix detection is used to detect the position of a marked load to ensure the correct picking position. Additionally, the identity of the load is verified to ensure that the correct load is picked. The detection works according to the following sequence.</p>
<ul>
<li>The AGV gets a drive order to a symbolic point for loading.</li>
<li>The AGV stops a certain distance before the loading point and raises the actuator to the basic shelf level increased with an additional marker detection height.</li>
<li>When the actuator is at the search height, the camera gets a start measuring signal</li>
<li>Measurements are collected until five measurements give approximately the same stopping point</li>
<li>The AGV drives further to the calculated stopping point.</li>
<li>When the distance is driven and the AGV has stopped, the stopping position is verified with an additional marker detection. After verification the camera measurements are stopped.</li>
<li>If the AGV position is within accuracy limits, the target marker ID is sent to the fleet control for verification. If the stopping accuracy limit is not met, the picking sequence is interrupted.</li>
<li>If the marker ID is correct, the racking sequence continues with a loading command from fleet control, else the load is not picked and the racking sequence is ended.</li>
<li>A new drive order can be given.</li>
</ul>
<h2 id="marker-detection-errors"><a class="header" href="#marker-detection-errors">Marker detection errors</a></h2>
<p>This error is set if the camera is not providing measurements when requested:</p>
<ul>
<li><strong>ERROR_MARKER_DETECTION_INACTIVE</strong>:  Marker detection sensor not responding to activation, check connections and configuration</li>
</ul>
<p>This error is set if the actuator reference is set too high for marker detection:</p>
<ul>
<li><strong>ERROR_DETECTION_TARGET_REF_TOO_HIGH</strong>: Target detection reference goes higher than actuator_max_val</li>
</ul>
<h3 id="marker-detection-parameters"><a class="header" href="#marker-detection-parameters">Marker detection parameters</a></h3>
<p>The target marker detection is currently implemented for racking, therefore the below racking paramters shall be set.</p>
<p>The camera used for marker detection is handled as an external localization sensor requiring the additional below parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,target_verification_distance_from_sym_point, 0.08</strong> </td><td> Stopping for target position verification at this distance [m] from symbolic point. Suitable values 0.05…0.15 largely depending on camera optics and detection distance . </td></tr>
<tr><td><strong>F,racking_max_dist_from_rack_begin_lift_actuator_meters, 0</strong> </td><td> The earliest point to start moving the actuator to rack level. Distance in meters. Must be bigger than target_verification_distance_from_sym_point </td></tr>
<tr><td><strong>I,target_marker_search_height_mm, 0</strong> </td><td> Additional lifting of the actuator over its nominal level for detection purposes. A slight angle between camera and load is recommended and the height is adjusted accordingly </td></tr>
<tr><td><strong>F,target_marker_stop_accuracy_limit, 0.01</strong> </td><td> Required stopping accuracy to end point of the correction drive. </td></tr>
<tr><td><strong>F,target_marker_position_offset, 0.0</strong> </td><td> Position offset between marker and lifting (mid) point of the load. Positive value when the marker is on the right of the lifting point when the load is seen from the AGV. </td></tr>
<tr><td><strong>I,racking_mode, 1</strong> </td><td> 0 = disabled 1 = enabled. </td></tr>
<tr><td><strong>I,racking_pallet_det_mode, 3</strong> </td><td> 0 = disabled, 1 = check that pallet is found on Precheck state, 2 = check that pocket is found on Precheck state, 3 = marker detection to localize load; min 0, max 3. </td></tr>
<tr><td><strong>I,ext_loc_eth_model[0], 2</strong> </td><td> model 2 is the Sick Lector which currently is the only sensor type for this kind of detection. The first external sensor defined to be of type 2 is selected for use. </td></tr>
<tr><td><strong>S,ext_loc_eth_ip[0]</strong> </td><td> IP according to camera settings. </td></tr>
<tr><td><strong>I,ext_loc_eth_port[0]</strong> </td><td> Port according to camera settings. </td></tr>
<tr><td><strong>F, ext_loc_x_offset[0]</strong> </td><td> camera longitudinal position offset on the vehicle. 0 if in the vehicle navigation point i.e., on Y-axis. </td></tr>
<tr><td><strong>F,ext_loc_y_offset[0]</strong> </td><td> camera transversal position offset, 0 in the vehicle navigation point i.e. on X-axis. </td></tr>
<tr><td><strong>F,ext_loc_h_offset_deg[0]</strong> </td><td> 0 heading offset in degrees between machine coordinate system and camera coordinate system, horizontal heading angle of focal axis. </td></tr>
<tr><td><strong>F,ext_loc_focal_orientation_deg[0]</strong> </td><td> 0 orientation of camera coordinates around focal axis. The rotation angle is the angle between the X-axis of the yellow camera coordinate frame and the X-axis of the red navigation coordinate frame measured from the red X-axis. </td></tr>
</tbody></table>
<p><img src="LoadHandling/Racking/./media-en/image14.png" alt="" /></p>
<blockquote>
<p>Figure 12: Camera coordinate frame and Navitrol coordinate frame. If the camera is mounted cables down, the ext_loc_focal_orientation_deg shall be -90 degrees, if the cables are pointing up-wards it shall be +90 degrees.</p>
</blockquote>
<p>The marker position on the load should match the camera position on the fork or machine. So, the marker position offset parameter should be the same as the camera ext_loc_x_offset.</p>
<p><img src="LoadHandling/Racking/./media-en/image15.png" alt="" /></p>
<blockquote>
<p>Figure 13: Basic case with camera on the centre line of the fork or machine and the marker on the centre line of the loading point.</p>
</blockquote>
<p><img src="LoadHandling/Racking/./media-en/image16.png" alt="" /></p>
<blockquote>
<p>Figure 14: If the camera is set with an offset to the centre line, all markers must have the same offset.</p>
</blockquote>
<p><img src="LoadHandling/Racking/./media-en/image17.png" alt="" /></p>
<blockquote>
<p>Figure 15: Camera offsets relative to the vehicle coordinates i.e., the navigation point of the vehicle.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="buffer-lanes-2"><a class="header" href="#buffer-lanes-2">Buffer Lanes</a></h1>
<p>Updated 23.02.2024</p>
<hr />
<h2 id="introduction-48"><a class="header" href="#introduction-48">Introduction</a></h2>
<p>Buffer lanes are a feature that allows unloading resources one after another and similarly loading first resource from a line of resources.
Normally there can be only one resource per symbolic point but with this feature it is possible to add a buffer area, that can fit multiple resources. Figure 1 shows example of the unload buffer. On that Figure, the object is detected with scanner and then the AGV does the unload in specified distance from that detected object.</p>
<p><img src="LoadHandling/BufferLanes/./media-en/figure1.png" alt="" /></p>
<blockquote>
<p>Figure 1: Example picture of unload buffer.</p>
</blockquote>
<h3 id="unload-buffer"><a class="header" href="#unload-buffer">Unload buffer</a></h3>
<p>Unload buffer is a feature that allows AGV to unload resources in a line. When AGV is inside the buffer area, it uses laser scanner to detect where the last unloaded resource is and calculates the unload location for the carried resource. Then AGV drives to that calculated unload location, performs unload and continues driving to next mission.</p>
<h3 id="load-buffer"><a class="header" href="#load-buffer">Load buffer</a></h3>
<p>Load buffer is a feature that allows AGV to load the last resource from a line of resources. When AGV is inside the buffer area, it uses sensor information to detect where the last resource is on the line and calculates load location to be able to pick the resource. There are two sensor options: 1. Laser scanner to detect where the last resource is on
the buffer area or 2. Load sensor information to know when the forks are under a resource to pick it up. Then AGV drives to the calculated load location, performs load and continues to unload location.</p>
<h2 id="requirements-22"><a class="header" href="#requirements-22">Requirements</a></h2>
<ul>
<li>
<p>Pallet detection license</p>
</li>
<li>
<p>Navitrol 6.28 (6.32 for docking)</p>
</li>
<li>
<p>Laser scanner to detect the object on the buffer area.</p>
</li>
<li>
<p>Navithor 2.3.0.2</p>
</li>
</ul>
<h2 id="buffer-lane-feature"><a class="header" href="#buffer-lane-feature">Buffer lane feature</a></h2>
<p>This Chapter explains buffer lane load and unload features with more detail and Navitrol parameters that affects to the performance.</p>
<h3 id="unload-buffer-1"><a class="header" href="#unload-buffer-1">Unload buffer</a></h3>
<p>Laser scanner for object detection:</p>
<ul>
<li>
<p>Must see the resource when AGV is driving on buffer area</p>
</li>
<li>
<p>Must see a cluster of scanner measurement points</p>
</li>
<li>
<p>Full pallet detection is not needed</p>
</li>
</ul>
<p>Cluster parameters:</p>
<ul>
<li>
<p><strong>pallet_det_min_points_close_to_first_point</strong> defines how many scanner points are required for cluster</p>
</li>
<li>
<p><strong>pallet_det_2_max_dist_to_first_point</strong> defines distance between consecutive cluster points.</p>
</li>
</ul>
<p><strong>AGV distance to detected object:</strong></p>
<ul>
<li><strong>buffer_stop_dist_from_object_when_unloading parameter defines the distance from detected object where to perform the unload.</strong></li>
</ul>
<p><strong>Search area:</strong></p>
<ul>
<li><strong>pallet_model_width_y[0] parameter defines the search area, where the scanner points are searched for. See</strong> Figure 2 <strong>below.</strong></li>
</ul>
<p><img src="LoadHandling/BufferLanes/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 2: Unload search area</p>
</blockquote>
<h3 id="load-buffer-1"><a class="header" href="#load-buffer-1">Load buffer</a></h3>
<p>Load buffer has three different modes:</p>
<ol>
<li>
<p>Object detected with scanner</p>
</li>
<li>
<p>Pallet detected with scanner</p>
</li>
<li>
<p>Load sensor is triggered.</p>
</li>
</ol>
<p><img src="LoadHandling/BufferLanes/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 3: Load buffer search area</p>
</blockquote>
<h4 id="mode-1-object-detection-with-scanner"><a class="header" href="#mode-1-object-detection-with-scanner">Mode 1: Object detection with scanner</a></h4>
<p>This is the same functionality as on the unload. This means that the scanner needs only few scanner points close to each other to detect an object on the route buffer (See above what parameters affects to the clusters).</p>
<ul>
<li><strong>buffer_stop_dist_from_object_when_loading</strong> defines the stopping point from the detected object and the distance is calculated from navigation point to the object.</li>
</ul>
<p>The downside with this mode is that it might detect anything on the route, so the accuracy might vary.</p>
<h4 id="mode-2-pallet-detection-with-scanner"><a class="header" href="#mode-2-pallet-detection-with-scanner">Mode 2: Pallet detection with scanner</a></h4>
<p>This mode uses full pallet detection and also has this object detection feature (same as mode 1) as a safety.</p>
<ul>
<li>
<p><strong>buffer_stop_dist_from_object_when_loading</strong> defines the stopping point and the distance is calculated from navigation point to the pallet's front line.</p>
</li>
<li>
<p><strong>buffer_stop_distance_from_unwanted_object</strong> defines the distance from detected object to stop the AGV if pallet is not detected.</p>
</li>
<li>
<p><strong>buffer_max_dist_from_route_to_target</strong> defines maximum allowed sideways distance that the pallet can have from the route. Error is set if the pallet is further.</p>
</li>
</ul>
<h4 id="mode-3-load-sensor"><a class="header" href="#mode-3-load-sensor">Mode 3: Load sensor</a></h4>
<p>Load sensor needs to give Navitrol information when the AGV has driven under the pallet and is ready for performing the load. The AGV is driving on the route and waiting this load sensor to trigger, otherwise it will just drive to the end symbolic point.</p>
<ul>
<li><strong>buffer_stop_dist_from_object_when_loading</strong> defines the distance how far the AGV can still drive after the load sensor is triggered. In many cases, this can be small number e.g., 0.05, the sign depends on the driving direction.</li>
</ul>
<h4 id="docking-2"><a class="header" href="#docking-2">Docking</a></h4>
<p>Docking is released on 6.32 release. It means that AGV can correct its position sideways on the buffer area. This Chapter explains only the basic idea of Docking. More info can be found from <em>Navitrol Pallet Detection Instructions</em> document</p>
<p>These parameters have to be set to enable docking:</p>
<ul>
<li>
<p><strong>docking_to_target_enabled</strong> 1 (omni or mechanum) or 2 (steer or differential drive AGV)</p>
</li>
<li>
<p><strong>Load_buffer_mode</strong> 2</p>
</li>
<li>
<p><strong>Docking_stop_distance</strong> replaces the <strong>buffer_stop_dist_from_object_when_loading</strong> when docking is used.</p>
</li>
</ul>
<p>NOTE! The <strong>buffer_check_start_dist_offset_m</strong> should have large enough value to allow some space for the docking. If this parameter is zero or too small, the pallet detection starts when the AGV is inside the buffer area. This can be too late to start docking if the buffer is full and the pallet is very close to the buffer start.</p>
<p>Docking requires pallet detection tag to be enabled on Tools, otherwise the AGV will drive only on the route as in normal buffer lane.</p>
<p><img src="LoadHandling/BufferLanes/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 4: Docking requires pallet detection tag for the Symbolic point on Tools.</p>
</blockquote>
<p>The docking has two extra start conditions for load buffer. See Figure 5 and Figure 6.</p>
<ul>
<li>
<p>The calculated stop point has to be closer to the route than the <strong>buffer_max_dist_from_route_to_target</strong> parameter.</p>
</li>
<li>
<p>The calculated stop point cannot be further away from the Symbolic point (behind the SP) than the <strong>docking_max_dist_error_from_end_point</strong> parameter. This replaces the normal docking start condition that check only the target distance to the SP.</p>
</li>
</ul>
<p><img src="LoadHandling/BufferLanes/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 5: First start condition: Distance to route cannot be too high. It is calculated sideways (see the red arrow).</p>
</blockquote>
<p><img src="LoadHandling/BufferLanes/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 6: Second start condition: Stop point cannot be too far behind the Symbolic point.</p>
</blockquote>
<p>Other start conditions and more information about the docking can be found from the Navitrol Pallet Detection Instructions document.</p>
<h2 id="creating-buffer-lanes"><a class="header" href="#creating-buffer-lanes">Creating Buffer Lanes</a></h2>
<p>Creating a buffer lane for a Load or Unload point is done by setting a buffer distance and enabling the buffer. This can only be done for symbolic points with the type Load or Unload. The size of the lane is visualized in magenta. The UI is displayed in Figure 5.</p>
<p>As a limitation buffer lane cannot currently span across multiple links. Additionally, the load or unload point must only have a single link connected thus it needs to be at the end of a link.</p>
<p>NOTE: <strong>buffer_check_start_dist_offset_m,</strong> 2.0 by default**,** parameter is offset value that is added to the buffer lane start point.
If the buffer lane is 10m on the Tools and this parameter is 1.0 m, it means that the buffer is actually 11.0 m long.</p>
<p><img src="LoadHandling/BufferLanes/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 7. Creating Buffer Lanes. 1: Symbolic point type has to be Load or Unload or both. 2: Enable Buffer Lane feature. 3: Set Buffer area distance, illustrated in magenta on the route.</p>
</blockquote>
<h2 id="fleet-control-settings"><a class="header" href="#fleet-control-settings">Fleet control settings</a></h2>
<p>Using buffer buffer lanes in production requires following TCPara­meters to be set:</p>
<ul>
<li>
<p>ResourceManager_ResourceContainerType -- Single</p>
</li>
<li>
<p>ResourceManager_ConstainerStackType -- CombineSameType</p>
</li>
</ul>
<p>Optionally:</p>
<ul>
<li>
<p>ProductionManager_UnloadLocationAssignMode -- buffer_balance</p>
</li>
<li>
<p>SymbolicPoint_BUFFER_FULL_DISTANCE_REMAINING -- any value</p>
</li>
</ul>
<p>Unload location assign mode <strong>buffer_balance</strong> prioritizes unload point with most space left in the buffer. Navithor updates the space remaining in a buffer every time a resource is unloaded to it. The buffer is full if the symbolic point resource count is full or if there is no space on the buffer area to unload anymore pallets. The resource length is taken from the machine type parameter xml file. If the point is set empty, the space left in buffer is also reset.</p>
<p>Buffer full distance remaining sets when we consider the buffer to be full. The buffer is considered full when Navithor believes that the space left in buffer is lower than this value.</p>
<h3 id="grouping-symbolic-points"><a class="header" href="#grouping-symbolic-points">Grouping symbolic points</a></h3>
<p>If there are multiple buffer lanes on the production area, the symbolic points can be grouped. Then the production orders can be set to the whole group and Navithor chooses the target buffer based on the <strong>UnloadLocationAssignMode</strong> parameter. When one buffer becomes full, the order is automatically switched to the next buffer area on that group.</p>
<p><strong>Example edge cases:</strong></p>
<ul>
<li>
<p>You have a buffer that can fit 4 resources and 3 resources are already unloaded to the buffer. 1 resource is taken manually away from the buffer. Now Navithor still has info that there are 3 resources, even though 1 is carried away. Then Navithor will only deliver one resource to the buffer and set the buffer as full, even though in reality there would be space for another resource.</p>
</li>
<li>
<p>Resources are cleared on the buffer symbolic point, even though the area is actually full. Navithor creates order to take pallet to the buffer. When AGV comes to the beginning of the buffer it detects that the area is actually full and send the status to Navithor. Then Navithor changes the status to full, abort the drive to this buffer     and select another available buffer if it is allowed. If selecting another buffer is not possible for example if the symbolic points are not Grouped, the AGV will just wait on that location until the buffer is cleared manually.</p>
</li>
</ul>
<h2 id="navitrol-monitor-buffer-visualization"><a class="header" href="#navitrol-monitor-buffer-visualization">Navitrol Monitor buffer visualization</a></h2>
<p>The load buffer with pallet detection (mode 2) draws normal pallet based on the pallet model parameters to the location where the pallet is found.</p>
<p><img src="LoadHandling/BufferLanes/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 8: Normal pallet with load buffer mode 2.</p>
</blockquote>
<p>The unload buffer and load buffer mode 1 doesn't use full pallet detection so they don't provide enough data to draw the full pallet.
Instead, they will draw a green circle to the location, where the closest cluster is found, see Figure 9. This green circle is also used on the load buffer mode 2 if there is some object ahead and the pallet is not detected. The green circle is added to the 6.30.00 release, but versions before that draws the pallet to the location where the object is found. In some cases, with the old versions, the pallet might be drawn with weird angle, because of the missing data.</p>
<p><img src="LoadHandling/BufferLanes/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 9: The green object detection circle.</p>
</blockquote>
<h2 id="instructions-how-to-set-navitrol-parameters"><a class="header" href="#instructions-how-to-set-navitrol-parameters">Instructions how to set Navitrol parameters</a></h2>
<h3 id="required-parameters-2"><a class="header" href="#required-parameters-2">Required parameters</a></h3>
<p><strong>I,target_detection_type_selection,</strong> <strong>3</strong> # Enables ref docking or pallet detection, 0 = disabled, 1 = refl docking, 2 = pallet detection, 3 = pallet detection ver 2 (allows buffer detection)</p>
<p><strong>I,target_detection_scan_selection, 3</strong> # Defines which scanners are used for target detection: 1 = rear scanner only, 2 = front scanner only, 3 = both scanners (supported only in refl docking and pallet detection ver 2)</p>
<p>Pallet model should be set into the parameters with array index of 0.
Important parameters for buffers are:</p>
<p><strong>I,pallet_model_enabled[0], 1</strong> # 1 = pallet model enabled</p>
<p><strong>F,pallet_model_width_y[0], 0.80</strong> # Used for determining width of the buffer to check if it is free or not Parameters that can be added to params.txt to enable this buffer feature, change how close to the object the AGV stops in the buffer zone and how early it starts checking, if the buffer is free or not:</p>
<p><strong>I,buffer_lanes_enabled, 1</strong> # 0 = disable buffer lane feature, 1 = enable.</p>
<p><strong>F,buffer_stop_dist_from_object_when_unloading, -2.0</strong> # Stopping distance (m) from the closest object, when unloading in a buffer. Calculated from navigation point to the first scanner measurements seen on the buffer zone.</p>
<p><strong>F,buffer_check_start_dist_offset_m, 1.0</strong> # The minimum distance from navigation point to the buffer zone, when the AGV starts checking if the unload buffer is free or not</p>
<p><strong>F,</strong> <strong>buffer_stop_dist_from_object_when_loading, -0.05</strong> # Stopping offset (m) for load buffer. Calculated from navigation point. Depends on the sensor, if this parameter needs to be set. If pallet is detected really early it might be useful to have some value to make sure that the pallet is actually loaded.</p>
<p><strong>I, load_buffer_mode,</strong> <strong>2</strong> # 0 = none, 1 = detect any objects based on scanner measurements, 2 = detect a pallet, 3 = external sensor (Load Detected bit on Supervisor status or CAN)</p>
<p><strong>I, unload_buffer_mode, 1</strong> # 0 = none, 1 = detect any objects based on scanner measurements</p>
<h3 id="increasing-speed-on-buffer-lanes"><a class="header" href="#increasing-speed-on-buffer-lanes">Increasing speed on buffer lanes</a></h3>
<p>Navitrol has implementation, that disables the safety scanner field based on distance from a detected object. This is useful if the AGV has safety scanner installed statically to the body of the AGV, so the scanner doesn't move with the fork.</p>
<p>The main goal for this implementation is to drive faster out from an unload buffer and faster in to a load buffer. If the scanner is safety scanner and its safety has to be disabled when the fork is down, because otherwise it will trigger safety stop. On the buffer lanes, the safety is disabled only when the AGV is close to the load or unload, so the AGV can drive faster and safer further away on the buffer lane.</p>
<p>Driving faster on buffer lanes with this kind of fork setup, requires Navitrol to handle the disable safety message more efficiently based on the distance to the pallet. This means:</p>
<p><strong>On load buffer:</strong></p>
<ul>
<li>
<p>The route has a fork height above scanner, so the scanner can see where the pallet is on the buffer.</p>
</li>
<li>
<p>The route speed can be set to normal driving speed.</p>
</li>
<li>
<p>First, the scanner detects the pallet on the route.</p>
</li>
<li>
<p>The AGV starts slowing down to <strong>disable_safety_limit_speed</strong> when it reaches the <strong>load_buffer_slow_down_distance</strong> from the detected pallet.</p>
</li>
<li>
<p>When AGV reaches the distance of <strong>disable_safety_distance_on_buffer</strong> to the pallet, the safety is requested to be disabled (supervisor status section 11 Disable     safety) and the fork is decreased to <strong>actuator_min_val</strong>.</p>
<ul>
<li>Note! If pallet detection scanner can continue detecting pallet when the fork is on the floor, set this parameter to 1: <strong>buffer_allow_drive_end_update_when_safety_is_disabled</strong></li>
</ul>
</li>
<li>
<p>AGV drives under the pallet and picks it up.</p>
</li>
<li>
<p>Continues to unload location.</p>
</li>
</ul>
<p><strong>On Unload buffer:</strong></p>
<ul>
<li>
<p>The route has a fork height above scanner, so the scanner can see where the last unloaded pallet is on the buffer.</p>
</li>
<li>
<p>The route speed can be set to normal driving speed.</p>
</li>
<li>
<p>First, the scanner detects the pallet on the route.</p>
</li>
<li>
<p>The AGV starts slowing down to <strong>disable_safety_limit_speed</strong> when it reaches the <strong>unload_buffer_slow_down_distance</strong> from the detected pallet.</p>
</li>
<li>
<p>When AGV reaches the distance of <strong>disable_safety_distance_on_buffer</strong> to the pallet, the safety is requested to be disabled (supervisor status section 11 Disable     safety).</p>
</li>
<li>
<p>The AGV drives to Unload location and unloads the pallet.</p>
</li>
<li>
<p>When AGV start driving to next location, it keeps the fork at <strong>actuator_min_val</strong> for the <strong>docking_limit_leave_speed_and_actuator_height_dist</strong> distance from the last unload location.</p>
</li>
<li>
<p>The speed is limited to <strong>docking_limit_leave_speed</strong> until the AGV is further away than this distance parameter or until the fork is above the <strong>actuator_disable_safety_max_value_mm</strong>.</p>
</li>
<li>
<p>The safety is requested to be disabled until the AGV reaches the <strong>disable_safety_distance_on_buffer</strong> distance from the last unload location.</p>
</li>
<li>
<p>When AGV is not anymore on this docking_limit distance, the speed and actuator height is taken from the route.</p>
</li>
</ul>
<p>There is new supervisor section message to send the PLC information when Navitrol want to disable the safety on the scanner that is below the fork. The cases when Navitrol will send this message are:</p>
<ul>
<li>
<p>When fork is decreased too low (the height can be set with parameter)</p>
</li>
<li>
<p>When the AGV is close to the load or unload location (the distance can be set with parameter). Note: the distance is calculated between the AGV and the detected pallet on buffer lane, not the symbolic point.</p>
</li>
</ul>
<h3 id="setting-up-disable-safety-feature"><a class="header" href="#setting-up-disable-safety-feature">Setting up disable safety feature</a></h3>
<ul>
<li>
<p>When setting up the disable safety feature, the <strong>disable_safety</strong> parameter needs to be set to 1. If this parameter is 0, the supervisor message is not sent.</p>
</li>
<li>
<p>Then the <strong>disable_safety_distance_on_buffer</strong> parameter needs to be set to value, where the safety is disabled. This distance is calculated from AGV navigation point to the unload or load location (location where the navigation point is when the load or unload is done). This parameter should be larger than the safety fields on the safety scanner and it is used to disable the safety just before we arrive to load or unload point.</p>
</li>
<li>
<p>The <strong>actuator_disable_safety_max_value_mm</strong> parameter should have a value where the fork is just above the safety field and does not trigger the warning zones.</p>
</li>
<li>
<p>If the AGV has some limited speed when the safety is disabled, <strong>disable_safety_limit_speed</strong> parameter can be set to make sure that the AGV doesn't drive too fast during the limited safety.</p>
</li>
</ul>
<h3 id="disable-safety-supervisor-message"><a class="header" href="#disable-safety-supervisor-message">Disable safety supervisor message</a></h3>
<p>This message is sent from Navitrol to supervisor on the supervisor status field. This section (ID 11) needs to be requested by the supervisor. See <em>Ethernet Communication specification between Navitrol and AGV supervisor_v4</em> document, how to request a message from Navitrol.</p>
<p><strong>Disable safety section</strong></p>
<table><thead><tr><th>Data field</th><th>Type</th><th>Length (bytes)</th><th>Comment</th></tr></thead><tbody>
<tr><td>Section ID = 11</td><td>Unsigned Short</td><td>2</td><td></td></tr>
<tr><td>Section length</td><td>Unsigned Integer</td><td>4</td><td>Length of the section <br>including all data fields of the section</td></tr>
<tr><td>Disable safety</td><td>Byte</td><td>1</td><td>0 = Enable safety <br>1 = Disable safety</td></tr>
</tbody></table>
<h2 id="full-parameter-list"><a class="header" href="#full-parameter-list">Full parameter list</a></h2>
<h3 id="target-detection-parameters"><a class="header" href="#target-detection-parameters">Target detection parameters</a></h3>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Description</th></tr></thead><tbody>
<tr><td>Int</td><td>target_detection_type_selection</td><td>0</td><td>3</td><td>3</td><td>Enables ref docking or pallet detection, 0 = disabled, 1 = refl docking, 2 = pallet detection, 3 = pallet detection ver 2 (allows buffer detection)</td></tr>
<tr><td>Int</td><td>target_detection_scan_selection</td><td>0</td><td>3</td><td>3</td><td>Defines which scanners are used for target detection: 1 = rear scanner only, 2 = front scanner only, 3 = both scanners (supported only in refl docking and pallet detection ver 2)</td></tr>
<tr><td>Int</td><td>target_max_n_times_missing</td><td></td><td>300</td><td></td><td>Defines when the last target is reset. If the target is not found for this amount, the target data is cleared. Recommended value is 300 or smaller on buffer lanes.</td></tr>
</tbody></table>
<h3 id="pallet-model-parameters"><a class="header" href="#pallet-model-parameters">Pallet model parameters</a></h3>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Description</th></tr></thead><tbody>
<tr><td>Int</td><td>pallet_model_enabled[0]</td><td></td><td>1</td><td></td><td>1 = pallet model enabled, 0 = disabled</td></tr>
<tr><td>Float</td><td>pallet_model_width[0]</td><td></td><td>0.8</td><td></td><td>Used for determining width of the buffer to check if it is free or not</td></tr>
</tbody></table>
<h3 id="buffer-lane-parameters"><a class="header" href="#buffer-lane-parameters">Buffer lane parameters</a></h3>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Description</th></tr></thead><tbody>
<tr><td>Float</td><td>buffer_stop_dist_from_object_when_unloading</td><td></td><td>-2.0</td><td></td><td>Stopping distance (m) from the closest object, when unloading in a buffer. Calculated from navigation point to the scanner measurements seen on the buffer zone.</td></tr>
<tr><td>Int</td><td>buffer_lanes_enabled</td><td>0</td><td>0</td><td>1</td><td>0 = disable buffer lane feature, 1 = enable.</td></tr>
<tr><td>Int</td><td>load_buffer_mode</td><td>0</td><td>2</td><td>3</td><td>0 = none, 1 = detect any objects based on scanner measurements, 2 = detect a pallet, 3 = external sensor (Load Detected bit on Supervisor status or CAN)</td></tr>
<tr><td>Int</td><td>unload_buffer_mode</td><td>0</td><td>1</td><td>1</td><td>0 = none, 1 = detect any objects based on scanner measurements</td></tr>
<tr><td>Float</td><td>buffer_check_start_dist_offset_m</td><td>-5.0</td><td>2.0</td><td>5.0</td><td>Higher the value, earlier the machine starts checking, if the buffer is free for unloading</td></tr>
<tr><td>Float</td><td>buffer_stop_dist_from_object_when_loading</td><td>-5.0</td><td>0.0</td><td>5.0</td><td>Stopping offset (m) for load buffer. Calculated from navigation point to the target. If load sensor is used, this is just offset for the load sensor.</td></tr>
<tr><td>Float</td><td>buffer_max_dist_from_route_to_target</td><td>0.0</td><td>0.2</td><td>2.0</td><td>Maximum transverse distance where the target can be from the route. If target is further away than this parameter, AGV is stopped. Also used as docking start condition (if it is enabled)</td></tr>
<tr><td>Int</td><td>buffer_stop_AGV_when_decreasing_fork_before_load</td><td>0</td><td>1</td><td>1</td><td>0 = Allow AGV drive while decreasing the fork, 1 = stop the AGV until the fork is decreased to the floor level. Used only if disable_safety_distance_on_buffer is used.</td></tr>
<tr><td>Float</td><td>buffer_stop_distance_from_unwanted_object</td><td>-1.0</td><td>1.0</td><td>5.0</td><td>Distance to stop the AGV in front of object if using pallet detection. The distance is calculated from AGV frame. The AGV should continue driving when object is removed. Negative value stops the AGV immediately.</td></tr>
<tr><td>Float</td><td>load_buffer_slow_down_distance</td><td>-1.0</td><td>-1.0</td><td>20.0</td><td>Distance to start slow down before target in m. Uses the disable_safety_limit_speed. Negative not used</td></tr>
<tr><td>Float</td><td>unload_buffer_slow_down_distance</td><td>-1.0</td><td>-1.0</td><td>20.0</td><td>Distance to start slow down before target in m. Uses the disable_safety_limit_speed. Negative not used</td></tr>
<tr><td>Int</td><td>unload_buffer_error_when_lane_full</td><td>0</td><td>0</td><td>1</td><td>Trigger fatal error if unload buffer lane is detected to be full when bringing a load.</td></tr>
</tbody></table>
<h3 id="disable-safety-parameters"><a class="header" href="#disable-safety-parameters">Disable safety parameters</a></h3>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Description</th></tr></thead><tbody>
<tr><td>Int</td><td>disable_safety</td><td>0</td><td>0</td><td>1</td><td>Disable safety message is send to supervisor. 0 = not used, 1 = used</td></tr>
<tr><td>Int</td><td>actuator_disable_safety_max_value_mm</td><td>0</td><td>0</td><td>3000</td><td>Disable safety if actuator is lower than this value, 0 = not used</td></tr>
<tr><td>Float</td><td>disable_safety_distance_on_buffer</td><td>-1.0</td><td>-1.0</td><td>20.0</td><td>Disable safety if driving closer than this distance to target in load or unload buffer, Negative or zero not used</td></tr>
<tr><td>Float</td><td>disable_safety_limit_speed</td><td>0.0</td><td>0.2</td><td>1.0</td><td>Limit speed when safety is disabled, if disable_safety_distance_to_load_or_unload &gt; 0. If it is 0, speed is not limited.</td></tr>
<tr><td>Float</td><td>docking_limit_leave_speed_and_actuator_height_dist</td><td>-2.0</td><td>-1.0</td><td>20.0</td><td>Distance from the unload location, where the speed and fork height is limited to the actuator_min_val. If negative, they are not limited. If enabled, had to be smaller than docking_mode_to_fleet_control_dist parameter.</td></tr>
<tr><td>Float</td><td>docking_limit_leave_speed</td><td>0.0</td><td>0.2</td><td>1.0</td><td>Limit speed while driving out from unload location, if docking_limit_leave_speed_and_actuator_height_dist &gt; 0. If it is below 0, speed is not limited.</td></tr>
<tr><td>Int</td><td>buffer_allow_drive_end_update_when_safety_is_disabled</td><td>0</td><td>0</td><td>1</td><td>If new drive order is received to the same destination when fork is set to floor level: 0 = keep the previous drive end, 1 = allows to update drive end point. Related to parameter <strong>disable_safety_distance_on_buffer</strong>. If AGV has pallet detection scanner that can be used when fork is at floor level, set this to 1, otherwise 0</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stack-loading-guide"><a class="header" href="#stack-loading-guide">Stack Loading Guide</a></h1>
<p>Updated 13.09.2024</p>
<hr />
<h2 id="introduction-49"><a class="header" href="#introduction-49">Introduction</a></h2>
<p>Stackloading is a feature to pick up pallet from the top of the pallet stack. </p>
<h3 id="requirements-23"><a class="header" href="#requirements-23">Requirements</a></h3>
<ul>
<li>Sensor to detect the pockets of the pallet
<ul>
<li>Scanner attached to the fork (See Figure 1 for sensor location).
Required to scan the whole stack while increasing the fork. </li>
<li>Possible to use any kind of sensor with <a href="LoadHandling/StackLoading/../../TargetAndObstacleDetection/ExternalTargetDetection/ExternalTargetDetection-en.html">external target detection</a> </li>
</ul>
</li>
<li>Possible safety sensors on the tip of the fork to stop the AGV if it is pushing something while driving in to the pocket. </li>
</ul>
<p><img src="LoadHandling/StackLoading/./media-en/figure1.png" alt="" /></p>
<blockquote>
<p>Figure 1: Example picture</p>
</blockquote>
<h3 id="specification"><a class="header" href="#specification">Specification</a></h3>
<p>This chapter describes the steps that AGV performs when doing the stackloading feature. This can be used as help to check what happens or what might go wrong. See also the end of this document about the pictures of the sequence.</p>
<ul>
<li>
<p>AGV drives towards the Pickup symbolic point where StackLoading is enabled</p>
</li>
<li>
<p>When the undermost pallet in the closest stack to AGV is detected, the stackloading sequence starts and the AGV drives with the forks at route height towards the pallet. At defined distance, the AGV is stopped for scanning the stack and warning <strong>WARNING_CHANGING_LOAD_OR_UNLOAD_HEIGHT</strong> is shown.</p>
</li>
<li>
<p>AGV starts scanning the stack of pallets by increasing the fork height. This step and the next step are skipped with <strong>stack_loading_stop_increase</strong> 5. Then fork is only increased to the estimated height given with the drive order from Navithor and AGV waits for a response from <a href="LoadHandling/StackLoading/../../TargetAndObstacleDetection/ExternalTargetDetection/ExternalTargetDetection-en.html">external target detection</a> before it can continue driving.</p>
</li>
<li>
<p>AGV stop increasing the fork based on what method is used</p>
<ul>
<li>
<p>Occupancy check: If the scanner doesn't see enough points on the area where the first pallet was detected, stop increasing the fork.</p>
</li>
<li>
<p>Leg detection: Stop increase if legs are not detected for a while.</p>
</li>
<li>
<p>Leg detection v2: Stop increase if legs are not detected for a certain height.</p>
</li>
</ul>
</li>
<li>
<p>AGV starts decreasing the fork to the top pallet pocket. The pocket positions and sizes are stored to the system while doing the increase. There is also parameter to define how much the fork can be decreased from this height. If the target pocket height is too low, error is set.</p>
</li>
<li>
<p>If the top pocket is not large enough for the fork to drive in, the next suitable pocket will be chosen. The pocket min and max size can be set with parameters.</p>
</li>
<li>
<p>When the fork height is set to pocket level, the AGV starts driving to the pallet and performs pickup.</p>
</li>
<li>
<p>While lifting the pallet up, the load sensor can be used to check if the pallet is correctly placed on the fork.</p>
</li>
<li>
<p>The assumption is that the pallets on the stack are aligned same way as the bottom pallet.</p>
</li>
<li>
<p>After the load is complete, the AGV will start driving out from the stack.</p>
</li>
<li>
<p>When it reaches the same position, where it was increasing the fork, it will decrease the fork to the route level.</p>
</li>
<li>
<p>AGV continues driving to the unload symbolic point.</p>
</li>
</ul>
<p>This warning is used when the scanning is active: <strong>WARNING_CHANGING_LOAD_OR_UNLOAD_HEIGHT</strong>.</p>
<p>It is enabled when the fork is started to increase for scanning the pallets and reset after the fork is moved to the pocket height and the AGV is ready for driving in to the pocket.</p>
<h3 id="limitations-21"><a class="header" href="#limitations-21">Limitations</a></h3>
<ul>
<li>
<p>Stackloading feature depends a lot on the leg detection part of the <a href="LoadHandling/StackLoading/../../TargetAndObstacleDetection/PalletDetection/PalletDetection-en.html">pallet detection</a> algorithm. Note that pallet detection includes linear model detection (straight line that has the same width as the pallet) and leg detection. If linear model is found, then leg detection is not done. This linear model detection can be used to filter out false positives on leg detection as leg detection might detect straight lines as legs. If the leg detection can't detect the legs properly, it will affect to the stackloading success rate. Exception is the external target detection, where Navitrol only relies on external sensor input and does not do the leg detection.</p>
</li>
<li>
<p>At the moment, there is no proper way in Navitrol to detect if the AGV pushes the pallet while driving in to the pocket. This would require additional sensor (e.g., ultrasonic or laser) to detect if the pallet moves while driving in. However, it is possible to install some sensor to the tip of the fork and stop the AGV with an emergency stop on the PLC or with some other way without Navitrol.</p>
</li>
<li>
<p>If the top pallet's heading differs too much from the bottom pallet, it would be hard to pick it up, with the steer or differential AGVs. These types of AGVs requires much space for adjusting the forks to correct position in sideways, so the fork would hit the pallet leg. However, the stackloading algorithm will try to load the pallet if it can detect the pallet properly.</p>
</li>
</ul>
<h2 id="setup-23"><a class="header" href="#setup-23">Setup</a></h2>
<h3 id="navithor-tools"><a class="header" href="#navithor-tools">Navithor Tools</a></h3>
<p>Stackloading feature uses virtual tag on the symbolic point (and load detection). These features need to be set in Navithor Tools when creating the environment for the AGV.</p>
<p>There are two options to setup the Stackloading:</p>
<ul>
<li>Regular symbolic point without buffer lane. Requires load detection tag.</li>
<li>Load buffer. No load detection tag required, but buffer area tag and buffer distance are required.</li>
</ul>
<p>Note: Stackloading tag is not needed if Navithor can give the stacking command (see Navithor document Using Buffer Lanes). Then the stacking can be decided based on each drive order.</p>
<p><img src="LoadHandling/StackLoading/./media-en/ToolsConfig.png" alt="" /></p>
<blockquote>
<p>Figure 2: Setting up stackloading: 1. Select Pickup type. 2. Enable load detection (not necessary with buffer lanes if docking not needed). 3. Open Edit Tags window. 4. Enable StackLoading tag. 5. Enable buffer lane. 6. Set Buffer lane distance. </p>
</blockquote>
<h3 id="navitrol-parameters-11"><a class="header" href="#navitrol-parameters-11">Navitrol Parameters</a></h3>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Description</th></tr></thead><tbody>
<tr><td>I</td><td><em>stack_loading_enabled</em></td><td>0</td><td>0</td><td>1</td><td><em>1 = Enable stackloading feature. 0 = disabled</em></td></tr>
<tr><td>I</td><td><em>stack_loading_step_mm</em></td><td>1</td><td>1</td><td>5000</td><td><em>How much (in mm) the lift reference is changed in each step when scanning the stack. Recommended 20 or higher. Too low value might cause actuator to slow down and then speed up multiple times when it reaches close to the current target and before it has received the next reference.</em></td></tr>
<tr><td>I</td><td><em>target_detection_actuator_offset_to_scanner_mm</em></td><td>-300</td><td>0</td><td>300</td><td><em>Scanner height offset relative to the actuator. Negative means that scanner is below the actuator. With this offset the fork should be at the correct height for loading.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_occupancy_min_hits</em></td><td>0</td><td>0</td><td>100</td><td><em>0 = disable occupancy check. Defines the minimum hits allowed on the occupancy check area. If the area has more scanner points than this parameter value the fork starts increasing and scanning for the stack until there are less points. Not used anymore as the occupancy zone is not needed anymore, the <strong>occup_check_min_hits</strong> parameter is used instead to check scanner points at the stack location.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_min_hits_top_legs</em></td><td>0</td><td>2</td><td>30</td><td><em>How many times the legs are required to detect before stopping at the top pallet level. Used only if <strong>stack_loading_stop_increase</strong> is 1 or 2.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_min_hits_false</em></td><td>0</td><td>7</td><td>30</td><td><em>How many false detections are required before stopping increasing the fork.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_stop_increase</em></td><td>0</td><td>3</td><td>5</td><td><em>What method is used for stopping increase and defining the stack height. <br>0 = none <br>1 = leg detection. The top of the stack is found when the legs are not detected for <strong>stack_loading_min_hits_false</strong> amount. <br>2 = line model and leg detection. The top of the stack is found when the legs or the linear model is not detected for <strong>stack_loading_min_hits_false</strong> amount. <br>3 = occupancy check. The top of the stack is found when scanner points are seen less than <strong>occup_check_min_hits</strong> inside the area of the first detected pallet. <br>4 = 3D camera. The top of the stack is found when point density is less than <strong>obj_reg_3d_empty_space_max_cluster_density</strong> inside the detected volume at stack location. <br>5 = fork is moved to estimated height. E.g. external target detection can be used to detect the pallet and give final docking height after the fork is increase to estimated height</em></td></tr>
<tr><td>F</td><td><em>stack_loading_max_dist_to_pallet_m</em></td><td>0.0</td><td>1.0</td><td>10.0</td><td><em>Discard found pallets if they are further than this value. Calculated from the scanner to the pallet front side. Used only with target_detection_type_selection = 2</em></td></tr>
<tr><td>F</td><td><em>stack_loading_dist_to_start_increase_m</em></td><td>0.0</td><td>1.0</td><td>10.0</td><td><em>Distance from navigation point to target stopping point to start increasing the fork</em></td></tr>
<tr><td>I</td><td><em>stack_loading_min_pocket_size_mm</em></td><td>0</td><td>10</td><td>500</td><td><em>Minimum vertical pocket height in mm. If pocket is smaller, choose the next pocket. This parameter and the next one is used to avoid the AGV to drive to the pocket that is broken or not detected correctly. Ensures that the pocket size is large enough for the fork.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_max_pocket_size_mm</em></td><td>0</td><td>150</td><td>500</td><td><em>Maximum vertical pocket height to allow docking, in mm. If pocket is higher, choose the next pocket</em></td></tr>
<tr><td>I</td><td><em>stack_loading_min_false_hits_legs</em></td><td>0</td><td>2</td><td>30</td><td><em>How many times the legs are required to false detect before detecting it as a false.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_enable_soft_stop</em></td><td>0</td><td>0</td><td>1</td><td><em>0 = Softstop is used only when increasing the fork to the top pallet level, 1 = Enable softstop also when decreasing the fork back to route level after driving out</em></td></tr>
<tr><td>I</td><td><em>stack_loading_max_height_mm</em></td><td>0</td><td>3000</td><td>10000</td><td><em>The maximum fork height for the scan. If the fork is still increased when reached this value, error is set.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_max_height_raises_error</em></td><td>0</td><td>1</td><td>1</td><td><em>If the fork height goes over the maximum allowed height 0 = stop increasing the fork and decrease to found pocket, 1 = set error.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_max_height_to_load_from_floor_mm</em></td><td>0</td><td>2000</td><td>10000</td><td><em>The maximum fork height after scan is ready where the fork can still decrease to floor. If the fork is higher than this value and the pocket is found on the floor, error is set. Used to avoid picking multiple pallets.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_stop_increase_height_mm</em></td><td>0</td><td>0</td><td>10000</td><td><em>Additional method for the stopping the increase. If this is 0, the <strong>stack_loading_min_hits_false</strong> is used to define when the increase is stopped. If this has some value, the increase is stopped when the legs are not detected while the fork is increased to the defined height. Every time the legs are detected, the target height is increased by this parameter.</em></td></tr>
<tr><td>I</td><td><em>stack_loading_max_decrease_val_after_scan_mm</em></td><td>0</td><td>0</td><td>10000</td><td><em>Maximum allowed decrease when the scan is done. Used to avoid selecting pocket from too low height. Recommended value is the maximum pallet height + some error. 0 not used</em></td></tr>
<tr><td>I</td><td><em>stack_loading_max_retry_if_scanning_fails</em></td><td>0</td><td>0</td><td>5</td><td><em>Maximum number of retries if scanning doesn't find the pocket.</em></td></tr>
<tr><td>F</td><td><em>stack_loading_dist_from_stack_to_move_actuator</em></td><td>0.0</td><td>1.5</td><td>5.0</td><td><em>Distance from navigation point to the detected pallet front line where actuator can be controlled safely without hitting the stack.</em></td></tr>
<tr><td>F</td><td><em>block_stacking_reset_distance_from_increase_location</em></td><td>0.0</td><td>0.5</td><td>10.0</td><td><em>Distance to reset the state machine if AGV is far enough from the location where the increase starts.</em></td></tr>
</tbody></table>
<h2 id="example-set-of-navitrol-parameters"><a class="header" href="#example-set-of-navitrol-parameters">Example set of Navitrol parameters</a></h2>
<p>Stackloading requires that pallet detection is enabled. If occupancy check is used as the increase method, then pallet detection is still used to define the stopping distance before starting to increase the fork. It is recommended to check first that the pallet can be detected before trying stackloading.</p>
<h3 id="pallet-detection-parameters-1"><a class="header" href="#pallet-detection-parameters-1">Pallet detection parameters</a></h3>
<p>This chapter describes the required pallet detection and docking parameters.
The pallet model parameters are based on EUR-pallet and the detection is to be done to the side defined with <strong>pallet_model_width_y</strong> parameter.</p>
<pre><code class="language-bash">I,target_detection_type_selection,                                 3
I,target_detection_scan_selection,                                 1
I,docking_to_target_enabled,                                       1
F,docking_max_start_distance,                                   3.00
F,docking_stop_distance,                                        0.19
F,docking_approach_dist,                                        1.25
I,pallet_model_enabled[0],                                         1
F,pallet_model_width_y[0],                                      0.80
F,pallet_model_length_x[0],                                     1.25
I,pallet_model_n_legs_x[0],                                        3
I,pallet_model_n_legs_y[0],                                        3
F,pallet_model_mid_leg_width_y[0],                             0.075
F,pallet_model_mid_leg_length_x[0],                             0.19
F,pallet_model_side_leg_width_y[0],                             0.09
F,pallet_model_side_leg_length_x[0],                           0.165
</code></pre>
<h3 id="stackloading-parameters"><a class="header" href="#stackloading-parameters">Stackloading parameters</a></h3>
<p>Stackloading parameters for a fork that provides scanner data to Navitrol. Scanner is used for detection. </p>
<pre><code class="language-bash">I,stack_loading_enabled,                                           1 
I,stack_loading_step_mm,                                          20 
I,stack_loading_min_hits_top_legs,                                 2 
I,stack_loading_min_hits_false,                                   30 
I,stack_loading_stop_increase,                                     3 
F,stack_loading_dist_to_start_increase_m,                   2.000000 
I,stack_loading_min_pocket_size_mm,                               10 
I,stack_loading_max_pocket_size_mm,                              150 
I,stack_loading_min_false_hits_legs,                               2 
I,stack_loading_max_height_mm,                                  3000 
I,stack_loading_max_height_raises_error,                           1 
I,stack_loading_max_height_to_load_from_floor_mm,               2000 
I,stack_loading_stop_increase_height_mm,                        1000
F,stack_loading_dist_from_stack_to_move_actuator,                3.7
I,occup_check_min_hits,                                            1
</code></pre>
<h3 id="additional-information-of-parameters"><a class="header" href="#additional-information-of-parameters">Additional information of parameters</a></h3>
<p><em>stack_loading_min_hits_top_legs</em> 0</p>
<p>How many times the pallet legs are required to detect before the leg bottom height is stored. The idea is that the leg bottom and top height are stored and the fork is controlled between those. Increasing this value decreases the possibility of false detection. The detection count can be something between 2 and 20 with one pallet and this depends on the detection angle and distance, lifting speed and scanner measurement speed.</p>
<p><em>stack_loading_stop_increase</em> 3</p>
<p>3 = occupancy check. Check area is square with side length of <strong>pallet_model_width_y</strong> located on the center of the detected target front line.</p>
<p><em>stack_loading_max_dist_to_pallet_m</em> 2.0</p>
<p>Discards detected pallets if they are further than this value from the scanner. Used to avoid detecting pallets too far away. Calculated from the scanner to the pallet front side (in meters). Used only if <strong>target_detection_type_selection</strong> is 2.</p>
<p><em>stack_loading_max_retry_if_scanning_fails</em> 0</p>
<p>Defines how many times the scanning can be retried if suitable pocket is not found. The suitable pocket is checked each time when the fork is increased and the scanning is ready. If there is no suitable pocket, the fork is decreased back to the route level and then the increase and scanning is done again. Then this is repeated by the amount of this parameter. If the retry succeeds and there is a valid pocket, the fork is decreased to the pocket level. If all the retries are done without any suitable pocket, fatal error is set.</p>
<h2 id="user-notes"><a class="header" href="#user-notes">User notes</a></h2>
<ul>
<li>
<p>Pallet detection is used with stackloading, so it is recommended to test first. There are few pallet detection parameters listed on the Example set, but it is not full list. However, using those parameters would be enough in most cases to get started.</p>
</li>
<li>
<p>Stackloading feature needs Navithor to properly perform the loading sequence. Without Navithor, e.g. with Monitor drive orders, the stackloading can be run until it drives under the pallet, but it cannot load the pallet automatically. However, there is Load button on Client and on Monitor Actuator Control that can be used to Load the pallet.</p>
</li>
<li>
<p>NavitrolMonitor is good tool when the parameters are adjusted at the first time. It is easier to adjust the parameters with Monitor to get the fork to correct level.</p>
</li>
<li>
<p>When starting the production with Navithor, the resource is needed on the symbolic point and the stackloading feature is automatically started when the AGV drives close enough to the detected target.</p>
</li>
<li>
<p>Before starting stackloading, test first with Monitor that the pallet can be detected by setting the <strong>target_detection_always_enabled</strong> to 1.</p>
</li>
<li>
<p>If the stack is high, it might be possible that the drive is aborted by Navithor while increasing the fork. Then this Navithor parameter  TrafficController_ABORT_WAIT_TIME_SECONDS should be increased. Generally, the abort shouldn't be happening when the AGV is searching for the top pallet. The parameter should be at least a time how much the AGV is standing still when doing the scan.</p>
</li>
<li>
<p>Searching &quot;<strong>StackLoading1</strong>&quot; from the log shows the scanning results. The &quot;<strong>Legs detected</strong>&quot; line shows the height of the actuator when the legs are detected with the scanner. The &quot;<strong>Legs false detected</strong>&quot; shows where the legs are not detected. This is very useful to see if there are any valid pockets and what are the sizes. See Chapter <a href="LoadHandling/StackLoading/StackLoading-en.html#agv-found-pocket-too-high">Pocket found too high</a> as an example.</p>
</li>
<li>
<p>Searching &quot;<strong>StackLoading: Pocket height saved</strong>&quot; from the log shows what are the heights of stored pockets. The <em>ActVal</em> is actuator height of that detection and <em>level</em> defines if it is the pocket bottom height (1) or top height (2). The pocket height is calculated from those bottom and top values. Even though there might be consecutive bottom heights on the log, they are not used for anything.</p>
</li>
</ul>
<h3 id="aborting-the-state-machine"><a class="header" href="#aborting-the-state-machine">Aborting the state machine</a></h3>
<p>If the AGV got stuck and customer wants to abort the mission and try again, the sequence can be aborted by driving AGV far enough from the stack. If the state machine is active it can be seen from terminal with logging &quot;STACK_LOADING_STATE_&quot;. If there is no logging, the state machine is not active.</p>
<p>The state machine is aborted if</p>
<ul>
<li>
<p>AGV has already started the scanning phase, but hasn't picked the pallet up and new drive order is given to route or symbolic point without Stack loading tag. Actuator is controlled automatically to the route height when AGV has driven <strong>stack_loading_dist_from_stack_to_move_actuator</strong> distance away from the stack. </p>
</li>
<li>
<p>AGV has already started the scanning phase and AGV is driven (manually or with drive order) further away from the stack front than <strong>stack_loading_dist_from_stack_to_move_actuator</strong> + <strong>block_stacking_reset_distance_from_increase_location</strong>. For example, taking the AGV into Manual mode with Monitor keyboard command and drive few meters backwards. The actuator should be controlled automatically to the route height as soon as AGV has received new drive order, if it isn't controlled manually.</p>
</li>
<li>
<p>AGV hasn't started the scanning phase yet and it is outside the load buffer area and docking is not active. For example, driving AGV with drive order out from the buffer area. Actuator is already at route height when this happens.</p>
</li>
</ul>
<h2 id="laser-scanner-view"><a class="header" href="#laser-scanner-view">Laser scanner view</a></h2>
<p><img src="LoadHandling/StackLoading/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 4: Laser scanner view of the stack</p>
</blockquote>
<p>If the last found pocket is too small or too large, error is set. The size of the pocket can be set with parameters. Also, if the actuator reaches the maximum allowed height, error is set.</p>
<p>The scan is always done to the top of the stack and the assumption is that the pallets are quite well aligned to the same location. The general stackloading idea is to just set the fork to the highest legs that are detected, so Navitrol doesn't know anything about the independent pallet heights on the stack beforehand or how many pallets there are on the stack. If there is only one pallet, the scanning is still done.</p>
<h2 id="errors-1"><a class="header" href="#errors-1">Errors</a></h2>
<h3 id="error_stackloading_pocket_found_too_low"><a class="header" href="#error_stackloading_pocket_found_too_low">ERROR_STACKLOADING_POCKET_FOUND_TOO_LOW</a></h3>
<p>Triggered if pocket height is below
<strong>stack_loading_max_decrease_val_after_scan_mm</strong> from the current actuator height.</p>
<h3 id="error_pallet_pocket_not_found"><a class="header" href="#error_pallet_pocket_not_found">ERROR_PALLET_POCKET_NOT_FOUND</a></h3>
<p>Triggered if there is no valid pocket and actuator height is higher than <strong>stack_loading_max_height_to_load_from_floor_mm</strong>.</p>
<h3 id="error_stackloading_target_too_high"><a class="header" href="#error_stackloading_target_too_high">ERROR_STACKLOADING_TARGET_TOO_HIGH</a></h3>
<p>Triggered if the actuator reaches the <strong>stack_loading_max_height_mm</strong> while scanning the stack (<strong>stack_loading_max_height_raises_error</strong> has to be 1).</p>
<h2 id="example-sequence-with-pictures"><a class="header" href="#example-sequence-with-pictures">Example sequence with pictures</a></h2>
<p>These following figures shows the basic sequence when the stackloading is used on load buffer.</p>
<p><img src="LoadHandling/StackLoading/./media-en/image6.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image7.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image8.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image9.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image10.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image11.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image12.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image13.png" alt="" /></p>
<p><img src="LoadHandling/StackLoading/./media-en/image14.png" alt="" /></p>
<h2 id="troubleshooting-40"><a class="header" href="#troubleshooting-40">Troubleshooting</a></h2>
<h3 id="agv-found-pocket-too-high"><a class="header" href="#agv-found-pocket-too-high">AGV found pocket too high</a></h3>
<p>The <em>StackLoading1</em> logging will show the actuator heights where the scanner is detecting legs of the pallet that are defined as the pocket (<em>Legs detected</em>) or something else (<em>Legs false detected</em>) that is usually the stringer board or some noise. On this case the issue was that after the last pocket, the scanner points are scattered and that caused the system to find legs -&gt; this will cause the system to find small pocket at the very top of the stack. When the scanner scans the stack from bottom to top, the pockets are usually seen really well and the usual pocket height for normal pallet is something between 85-115mm. </p>
<ul>
<li>The <strong>stack_loading_min_pocket_size_mm</strong> is used to discard pockets that are too small after all pockets have been found. </li>
<li>The <strong>stack_loading_min_hits_top_legs</strong> parameter is used to store <strong>pocket low</strong> heights to the system when the pocket is seen this parameter amount in consecutive cycles.</li>
<li>The <strong>stack_loading_min_false_hits_legs</strong> parameter is used to store <strong>pocket high</strong> heights to the system when the pocket is not seen this parameter amount in consecutive cycles. </li>
</ul>
<p>On this example, the <strong>stack_loading_min_pocket_size_mm</strong> was on default value 10. <strong>stack_loading_min_hits_top_legs</strong> and <strong>stack_loading_min_false_hits_legs</strong> was 2.</p>
<pre><code class="language-bash">12453.5109 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 86
12453.5748 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 86
12453.6419 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 86
12453.7132 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 86
12453.7750 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 86
12453.8430 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 86
12453.9105 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 86
12453.9744 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 86
12454.0427 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 86
12454.1116 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 86
12454.1743 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 86
12454.2415 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 86
12454.3121 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 87
12454.3747 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 88
12454.4415 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 88
12454.5096 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 89
12454.5750 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 90
12454.6411 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 91
12454.7099 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 92
12454.7753 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 92
12454.8427 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 94
12454.9116 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 94
12454.9747 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 95
12455.0419 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 96
12455.1113 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 97
12455.1748 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 97
12455.2423 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 98
12455.3119 [03:6] StackLoading1: Legs false detected (top line): 1, actval: 99
12455.3748 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 100
12455.4415 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 101
12455.5119 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 102
12455.5745 [03:6] StackLoading1: Legs detected: 1, actval: 103
12455.6419 [03:6] StackLoading1: Legs detected: 0, actval: 103                      -&gt; First pocket low height is 103. Two consecutive leg detections.
12455.7097 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 104
12455.7750 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 105    -&gt; First pocket high height is 104. Two consecutive false leg detections.
12455.8428 [03:6] StackLoading1: Legs detected: 1, actval: 106
12455.9118 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 106
12455.9750 [03:6] StackLoading1: Legs detected: 1, actval: 107
12456.0425 [03:6] StackLoading1: Legs detected: 0, actval: 109                      -&gt; Second pocket low height is 107. Two consecutive leg detections.
12456.1133 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 109
12456.1753 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 110    -&gt; Second pocket high height is 109. Two consecutive false leg detections.
12456.2409 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 111
12456.3108 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 112
12456.3758 [03:6] StackLoading1: Legs detected: 1, actval: 112
12456.4424 [03:6] StackLoading1: Legs detected: 0, actval: 113                      -&gt; Third pocket low height is 112. Two consecutive leg detections.
12456.5121 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 114
12456.5761 [03:6] StackLoading1: Legs detected: 1, actval: 116
12456.6416 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 116
12456.7127 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 117    -&gt; Third pocket high height is 116. Two consecutive false leg detections.
12456.7753 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 118
12456.8429 [03:6] StackLoading1: Legs detected: 1, actval: 119
12456.9111 [03:6] StackLoading1: Legs detected: 0, actval: 120                      -&gt; Fourth pocket low height is 119. Two consecutive leg detections.
12456.9754 [03:6] StackLoading1: Legs detected: 1, actval: 122
12457.0431 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 125
12457.1129 [03:6] StackLoading1: Legs detected: 1, actval: 129
12457.1748 [03:6] StackLoading1: Legs detected: 0, actval: 133                      -&gt; Fifth pocket low height is 129. Two consecutive leg detections.
12457.2437 [03:6] StackLoading1: Legs detected: 1, actval: 137
12457.3130 [03:6] StackLoading1: Legs detected: 0, actval: 142
12457.3752 [03:6] StackLoading1: Legs detected: 1, actval: 145
12457.4426 [03:6] StackLoading1: Legs detected: 0, actval: 149
12457.5117 [03:6] StackLoading1: Legs detected: 1, actval: 156
12457.5750 [03:6] StackLoading1: Legs detected: 0, actval: 161
12457.6427 [03:6] StackLoading1: Legs detected: 1, actval: 168
12457.7124 [03:6] StackLoading1: Legs detected: 0, actval: 179
12457.7753 [03:6] StackLoading1: Legs detected: 1, actval: 186
12457.8422 [03:6] StackLoading1: Legs detected: 0, actval: 192
12457.9127 [03:6] StackLoading1: Legs detected: 1, actval: 199
12457.9746 [03:6] StackLoading1: Legs detected: 0, actval: 204
12458.0407 [03:6] StackLoading1: Legs detected: 1, actval: 210
12458.1104 [03:6] StackLoading1: Legs detected: 0, actval: 217
12458.1751 [03:6] StackLoading1: Legs detected: 1, actval: 223
12458.2428 [03:6] StackLoading1: Legs detected: 0, actval: 230
12458.3115 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 236
12458.3763 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 249    -&gt; Fifth pocket high height is 236. Two consecutive false leg detections.
12458.4411 [03:6] StackLoading1: Legs detected: 1, actval: 254
12458.5127 [03:6] StackLoading1: Legs detected: 0, actval: 262                     -&gt; Sixth pocket low height is 254. Two consecutive leg detections.
12458.5755 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 267
12458.6424 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 272   -&gt; Sixth pocket high height is 267. Two consecutive false leg detections.
12458.7110 [03:6] StackLoading1: Legs detected: 1, actval: 280
12458.7761 [03:6] StackLoading1: Legs detected: 0, actval: 285                     -&gt; Seventh pocket low height is 280. Two consecutive leg detections.
12458.8426 [03:6] StackLoading1: Legs detected: 1, actval: 293
12458.9118 [03:6] StackLoading1: Legs detected: 0, actval: 298
12458.9752 [03:6] StackLoading1: Legs detected: 1, actval: 311
12459.0424 [03:6] StackLoading1: Legs detected: 0, actval: 316
12459.1119 [03:6] StackLoading1: Legs detected: 1, actval: 324
12459.1744 [03:6] StackLoading1: Legs detected: 0, actval: 329
12459.2427 [03:6] StackLoading1: Legs detected: 1, actval: 337
12459.3123 [03:6] StackLoading1: Legs detected: 0, actval: 342
12459.3747 [03:6] StackLoading1: Legs detected: 1, actval: 347
12459.4426 [03:6] StackLoading1: Legs detected: 0, actval: 355
12459.5129 [03:6] StackLoading1: Legs detected: 1, actval: 360
12459.5744 [03:6] StackLoading1: Legs detected: 0, actval: 373
12459.6417 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 378
12459.7130 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 386    -&gt; Seventh pocket high height is 378. Two consecutive false leg detections.
12459.7751 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 391
12459.8419 [03:6] StackLoading1: Legs detected: 1, actval: 399
12459.9106 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 404
12459.9753 [03:6] StackLoading1: Legs detected: 1, actval: 409
12460.0424 [03:6] StackLoading1: Legs detected: 0, actval: 417                     -&gt; Eight pocket low height is 409. Two consecutive leg detections.
12460.1130 [03:6] StackLoading1: Legs detected: 1, actval: 422
12460.1759 [03:6] StackLoading1: Legs detected: 0, actval: 435
12460.2423 [03:6] StackLoading1: Legs detected: 1, actval: 440
12460.3141 [03:6] StackLoading1: Legs detected: 0, actval: 448
12460.3755 [03:6] StackLoading1: Legs detected: 1, actval: 453
12460.4418 [03:6] StackLoading1: Legs detected: 0, actval: 461
12460.5119 [03:6] StackLoading1: Legs detected: 1, actval: 466
12460.5753 [03:6] StackLoading1: Legs detected: 0, actval: 471
12460.6425 [03:6] StackLoading1: Legs detected: 1, actval: 479
12460.7114 [03:6] StackLoading1: Legs detected: 0, actval: 484
12460.7752 [03:6] StackLoading1: Legs detected: 1, actval: 497
12460.8426 [03:6] StackLoading1: Legs detected: 0, actval: 503
12460.9130 [03:6] StackLoading1: Legs detected: 1, actval: 510
12460.9745 [03:6] StackLoading1: Legs detected: 0, actval: 516
12461.0431 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 523
12461.1116 [03:6] StackLoading1: Legs false detected (top line): 0, actval: 529    -&gt; Eight pocket high height is 523. Two consecutive false leg detections.
12461.1746 [03:6] StackLoading1: Legs detected: 1, actval: 534
12461.2422 [03:6] StackLoading1: Legs detected: 0, actval: 541                     -&gt; Ninth pocket low height is 534. Two consecutive leg detections.
12461.3134 [03:6] StackLoading1: Legs detected: 1, actval: 547
12461.3741 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 560
12461.4418 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 565   -&gt; Ninth pocket high height is 560. Two consecutive false leg detections.
12461.5137 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 573
12461.5742 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 578
12461.6415 [03:6] StackLoading1: Legs false detected (no pallet): 1, actval: 586
12461.7125 [03:6] StackLoading1: Legs false detected (no pallet): 0, actval: 591
</code></pre>
<p>From this case the pockets are stored like this (from bottom to top):</p>
<ol>
<li>Low height 103, high height 104 -&gt; pocket size 1. Noise</li>
<li>Low height 107, high height 109 -&gt; pocket size 2. Noise</li>
<li>Low height 112, high height 116 -&gt; pocket size 4. Noise</li>
<li>The fourth pocket didn't have high value, because there was only one high measurement and two was required by parameter <strong>stack_loading_min_false_hits_legs</strong>. Pocket is not stored.</li>
<li>Low height 129, high height 236 -&gt; pocket size 107. Real pocket</li>
<li>Low height 254, high height 267 -&gt; pocket size 13. Noise</li>
<li>Low height 280, high height 378 -&gt; pocket size 98. Real pocket</li>
<li>Low height 409, high height 523 -&gt; pocket size 114. Real pocket</li>
<li><strong>Low height 534, high height 560 -&gt; pocket size 26</strong>. This was noise from top of the stack.</li>
</ol>
<p>After the scan there are 9 pockets (number four not valid) and the system will select the top-most pocket that's height is between the <strong>stack_loading_min_pocket_size_mm</strong> and <strong>stack_loading_max_pocket_size_mm</strong>. Here the top-most pocket is the 9th pocket that's low height is 534 and high height is 560 -&gt; pocket height is 560-534=26mm. If the <strong>stack_loading_min_pocket_size_mm</strong> would have been larger than this 26, then the second top-most pocket would have been selected (that is the correct pocket in this case) and that is 409 and 523 -&gt; pocket height 523-409=114mm.</p>
<h3 id="fork-is-always-too-high-or-too-low-when-driving-in-to-the-pallet-after-scanning-the-stack"><a class="header" href="#fork-is-always-too-high-or-too-low-when-driving-in-to-the-pallet-after-scanning-the-stack">Fork is always too high or too low when driving in to the pallet after scanning the stack</a></h3>
<p>The <strong>target_detection_actuator_offset_to_scanner_mm</strong> parameter is wrong.
This parameter defines how much the fork height needs to be changed from the detected pocket height. If the forklift cannot drive under the pallet, when the final height is set, this parameter should be adjusted. The positive value increases the fork and negative one decreases.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="block-stacking-instructions"><a class="header" href="#block-stacking-instructions">Block Stacking Instructions</a></h1>
<p>Updated 09.09.2024</p>
<hr />
<h2 id="introduction-50"><a class="header" href="#introduction-50">Introduction</a></h2>
<p>Block stacking is a feature that means <strong>unloading</strong> on top of another pallet. This is very specific feature and can only be used with a certain type of forklifts, because the unloading height on top of a pallet needs to be detected with sensor. Basically, the idea is that when driving on the buffer area (purple area on the Figure 5) the AGV start detecting pallet with the laser scanner on front of the route.
When it detects the pallet, it stops and starts increasing the fork.
Using sensor information, the increase is stopped when the sensor detects the top level of the pallet. This height can be searched with laser scanner or with sensors on the fork tip. Then AGV continue the drive on top of that pallet. When reached to the correct unload location, AGV performs the unload. The drive is finished and AGV start
driving to the next location while keeping the height at the same level where it was after the unload. When the AGV has driven far away from the unload place, the fork is decreased to the floor level.</p>
<p>ATTENTION! Before setting up block stacking, <strong>unload buffer</strong> feature should be tested first. Check Figure 1 and Figure 2 for the difference between unload buffer feature and block stacking feature. The unload buffer means feature where the AGV searches the next pallet ahead on the route with the laser scanner and unload on the floor level in specified distance from that pallet. Block stacking can then be enabled to unload pallets on top of each other.</p>
<p>ATTENTION! The fork tip sensor can be used only with custom CAN interface at the moment.</p>
<p><img src="LoadHandling/BlockStacking/./media-en/image3.png" alt="" /></p>
<blockquote>
<p>Figure 1: Unload buffer example</p>
</blockquote>
<p><img src="LoadHandling/BlockStacking/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2: Block stacking example</p>
</blockquote>
<h3 id="requirements-24"><a class="header" href="#requirements-24">Requirements</a></h3>
<p>Block stacking requires sensor that is used to find the correct unloading height. Fork sensors, for example ultrasonic sensor, on the front of the fork or scanner that is  attached to the lifting part of the fork. If the scanner is used, it needs to see the pallet on front even though the forks have the pallet onboard. The sensor is used to detect the height of the pallet and to unload the carried pallet to the correct level. See the Figure 3 and Figure 4 for illustrations about different options for sensor placements.</p>
<p>There are two options for the sensor placements:</p>
<p><img src="LoadHandling/BlockStacking/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Figure 3: Laser distance sensor and laser scanner placement.</p>
</blockquote>
<p>or</p>
<p><img src="LoadHandling/BlockStacking/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 4: Laser scanner placement. The scanner should be able to see past the carried pallet.</p>
</blockquote>
<h3 id="specification-1"><a class="header" href="#specification-1">Specification</a></h3>
<p>This chapter describes the steps that AGV performs with the blockstacking feature. This can be used to check that blockstacking works as it should.</p>
<ul>
<li>
<p>AGV drives inside unload buffer</p>
</li>
<li>
<p>Drive is stopped in front of the pallet based on scanner detecting the pallet on the route or fork tip sensors.</p>
</li>
<li>
<p>AGV starts lifting the fork to search where the pallet top level is.</p>
</li>
<li>
<p>The lifting is stopped on the top pallet based on the fork sensor or scanner measurements. The lifting is also stopped if fork reaches maximum height. If this maximum height is reached, the pallet is unloaded to the floor level, if AGV is on the buffer area, or the state is aborted. If the state is aborted, then AGV waits for fleet control to give new drive order to buffer that has space.</p>
</li>
<li>
<p>If the top height is detected correctly, fork is still lifted by load aboard offset so the AGV can drive on top of the pallet without fork hitting to the pallet.</p>
</li>
<li>
<p>AGV continues driving until the carried pallet is on top of the other pallet</p>
</li>
<li>
<p>AGV unloads the carried pallet.</p>
</li>
<li>
<p>AGV drives out of the pallet and keeps the fork height where it is to avoid hitting the pallet.</p>
</li>
<li>
<p>Load sensor can be checked when we have driven a certain distance out from the unload location. This can be used to make sure that the pallet is not anymore on the fork, before driving too far.</p>
</li>
<li>
<p>When the AGV has driven to the same location where it was increasing the fork, it will lower the fork to the route value.</p>
</li>
</ul>
<h4 id="pyramid-stacking"><a class="header" href="#pyramid-stacking">Pyramid stacking</a></h4>
<p>Pyramid stacking allows the unloading point to be altered lenghtwise from the target. The lengthwise offset is obtained either via fleet control or parameter <strong>block_stacking_pyramid_length_offset_mm</strong>. The aforementioned offset is only applied when unloading to a stack.</p>
<p><img src="LoadHandling/BlockStacking/./media-en/pyramidstacking.PNG" alt="" /></p>
<blockquote>
<p>Pyramid stacking allows for altering the unload point lengthwise</p>
</blockquote>
<p>The process is otherwise the same as for normal blockstacking.</p>
<h3 id="limitations-22"><a class="header" href="#limitations-22">Limitations</a></h3>
<ul>
<li>
<p>This feature is only for a certain type of fork AGVs. It is required that the AGV can see the pallet ahead with some sensor while increasing the fork.</p>
</li>
<li>
<p>The pallet detection scanner is required to see the pallet on front when the AGV is carrying a pallet if the pallet detection is used on the block stacking. This means that the scanner needs to be below the fork.</p>
</li>
<li>
<p>The final height depends on the sensor and the surface of the pallet's top. If there is plastic on the top or the top is uneven, the result might vary, and it can affect the safety.</p>
</li>
<li>
<p>When using fork sensor, for example ultrasonic sensor on the tip of the fork, there has to be also scanner that can detect the pallet on the floor so the AGV can calculate stopping point in front of that pallet early enough. The fork sensors have limited distance to detect objects on front so they are required to trigger close to this calculated stopping point. If the fork sensors are not triggered when the AGV has driven past this stopping point, AGV just unloads the pallet to the floor to avoid pushing other pallets.</p>
</li>
</ul>
<h2 id="setting-up"><a class="header" href="#setting-up">Setting up</a></h2>
<p>Recommended software:</p>
<ul>
<li>
<p>Navithor 2.8.1.0</p>
</li>
<li>
<p>Navitrol 6.26.00</p>
</li>
<li>
<p>Navithor Tools 3.09.10</p>
</li>
</ul>
<h3 id="navithor-tools-1"><a class="header" href="#navithor-tools-1">Navithor Tools</a></h3>
<p>Block stacking needs to be enabled on each symbolic point, where it is used. It can be setup by adding a tag on the symbolic point.</p>
<p>NOTE! Tools version must be higher than 3.09.10!</p>
<ol>
<li>
<p>Create symbolic point and change it to unload type.</p>
</li>
<li>
<p>Edit virtual tag on the symbolic points menu. New window should open.</p>
</li>
<li>
<p>Add new tag by pressing Add tag button. Select NavitrolFeature for the tag type.</p>
</li>
<li>
<p>Select BlockStacking tag from the right-side menu. Exit the window from upper right corner.</p>
</li>
<li>
<p>Select unload buffer feature tag by enabling the Load Unload Buffer</p>
</li>
<li>
<p>Adjust the distance for the buffer lane. The purple line indicates the area where the pallets can be unloaded.</p>
</li>
<li>
<p>Next thing is to add estimate for the number of pallets for the lane. This can be set on the Edit Destinations and Resources menu on the Edit Allowed Resources. The quantity number should be quite close to the maximum number of pallets.</p>
</li>
</ol>
<p><img src="LoadHandling/BlockStacking/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 5: Setting up the blockstacking feature on Tools.</p>
</blockquote>
<h2 id="parameters-11"><a class="header" href="#parameters-11">Parameters</a></h2>
<h3 id="notes-of-navitrol-parameters"><a class="header" href="#notes-of-navitrol-parameters">Notes of Navitrol parameters</a></h3>
<ul>
<li>
<p>First, select the mode with the <strong>block_stacking_mode</strong>. </p>
<ul>
<li>The mode 1 is occupancy check, so basically it means that when searching for the top of the stack, the AGV uses laser scanner to detect when the pallet's top is reached by checking how many scanner points are found on the area where the pallet's front line is. </li>
<li>The mode 3 uses fork sensor information to define when the fork has reached the top of the pallet. </li>
<li>The mode 4 is 3D camera that has interface to Navitrol</li>
<li>The mode 5 is not dependent to any sensor. In this mode, the target is first detected on the ground and then the fork is moved to the estimated height given with the drive order from Navithor. Then AGV waits for a response from <a href="LoadHandling/BlockStacking/../../TargetAndObstacleDetection/ExternalTargetDetection/ExternalTargetDetection-en.html">external target detection</a> before it can continue driving.</li>
</ul>
</li>
<li>
<p>Occupancy check will use scanner that is attached to the increasing part of the fork. The requirement is that when the fork increases, this scanner can see when the fork has reached to the level of the top pallet.</p>
</li>
<li>
<p>Fork sensor uses ultrasonic or laser sensor to detect when there is pallet on front. In general, this kind of sensor is at the end of the fork and will be used for safety as well.</p>
</li>
<li>
<p>The <strong>block_stacking_offset_mm</strong> parameter defines the distance from the level where we detect the top pallet level to the safe driving level. Depending where the sensor is installed, but in general the AGV can't drive over another pallet when the sensor detects the top of the pallet.</p>
</li>
<li>
<p><strong>Reference step</strong> is added to fork height reference on each code cycle, meaning something like 20ms. This reference will increase fast in order to create smooth increase for the fork. Depending the fork control, this value can be 1 or 2.
Sometimes, the fork is so fast that it reaches the target before it is increased to next step, so it the fork seems to decelerate and accelerate every now and then. Then this parameter should be increased. It is also safe to add large value, something like 500, if the AGV fork controller can control the fork smoothly to high values.</p>
</li>
<li>
<p><strong>Occupancy min hits</strong> is used on occupancy check to define how many scanner points we can have at minimum on the target area. If there are less scanner point on that area, the area is defined as empty.
The target area is calculated as a square from the pallet's front.
The side of this square is the width of the pallet.</p>
</li>
<li>
<p><strong>Use scanner to check safety</strong> - parameter is used in cases, when there is a static scanner that can see on top of another pallet if it has already pallet on top. Should be used only if stacks have two pallets. If there could be more pallets, pallets could have different heights or there is no static scanner that could see to the stack drop-off location, this parameter should be set to 0. If this scanner detects something on the stack drop-off location, block stacking sequence is not started and normal unload is done to the floor in front of the stack. See figures below.</p>
</li>
</ul>
<p><img src="LoadHandling/BlockStacking/./media-en/OtherScannerToCheckUnloadArea1.png" alt="" /></p>
<blockquote>
<p>Use scanner to check safety - Drop-off to stack allowed. 1. Scanner that is used to scan the stacking height. 2. E.g. navigation scanner. 3. Stacking drop-off area that is empty. In this case, the scanner 1 is first used to detect the pallet on the floor and to define the location of the possible drop-off area to the stack (3). Then the scanner 2 can be used to check if there is already something on that drop-off area. If there is nothing, then AGV will drive closer and use the scanner 1 to scan the height of the pallet to drop-off on top of it.</p>
</blockquote>
<p><img src="LoadHandling/BlockStacking/./media-en/OtherScannerToCheckUnloadArea2.png" alt="" /></p>
<blockquote>
<p>Use scanner to check safety - Drop-off to stack not allowed. 1. Scanner that is used to scan the stacking height. 2. E.g. navigation scanner. 3. Stacking drop-off area already has a pallet. In this case, the scanner 1 is first used to detect the pallet on the floor and to define the location of the possible drop-off area to the stack (3). Then the scanner 2 can be used to check if there is already something on that drop-off area. If there is something, then AGV will drive closer and drop-off to the floor in front of the stack without scanning the stack.</p>
</blockquote>
<ul>
<li>
<p><strong>Max diff on target pos</strong> - parameter is a safety check that the pallet detection doesn't change the target too much.</p>
</li>
<li>
<p><strong>Dist to check load sensor</strong> - parameter is used to check if the unload is correctly done after we have driven away for this value. This safety check uses load sensor to check if the load is still on board.</p>
</li>
<li>
<p><strong>Dist to unload</strong> - parameter defines the distance from the point where we are lifting the fork to the point where the unload can be done.</p>
</li>
<li>
<p><strong>Max diff from route</strong> - parameter is a safety check for the pallet that is already on the unload location. If this pallet is too far from the route, block stacking is not started for safety reasons. In block stacking, the assumption is that the pallets are always quite straight on the route. Recommended value for this parameter is 0.15 (cm)</p>
</li>
<li>
<p><strong>Min actuator val after ready</strong> - parameter is used to release the AGV for driving after the fork has decreased until this level. This is used after the unload is done and the fork is decreasing to normal route level.</p>
</li>
<li>
<p><strong>Max heading diff</strong> - parameter is safety check for the pallet's heading. If the pallet angle is too high related to the AGV's heading, the block stacking is not started.</p>
</li>
<li>
<p><strong>Block stacking max height</strong> - parameter is used on the increase phase to define what is the maximum level for block stacking. If the fork is increased to this max level and the occupancy check or fork sensor does not detect the top of the pallet, normal unload is done on that position.</p>
</li>
<li>
<p><strong>Max dist to target</strong> - parameter is meant to be used for fork sensor. It was designed to ignore false fork sensor detections before the AGV is close enough to actual the pallet. This parameter can be used also generally to define the distance where the block stacking is started, when using occupancy check.</p>
</li>
<li>
<p><strong>Max extend drive</strong> - parameter is used with fork sensors. When driving to unload buffer, AGV will first calculate the stopping distance in front of the pallet. When AGV has reached this position and fork sensor is not triggered yet, it can drive the distance of this parameter to test if the sensor is triggered. If the sensor is triggered, it will start block stacking, otherwise normal unload is done.</p>
</li>
<li>
<p><strong>Verify unload height</strong> - parameter requires a load sensor that is high when the pallet is on the fork and low when the pallet is not touching the fork level. So, the sensor should inform when the pallet is on the fork when doing the unload and inform when the pallet is placed on top of the other pallet (There is some space between the fork and the pallet). See additional information (<strong>Figure 2</strong>) at the end of this document.</p>
</li>
<li>
<p><strong>Disable fork sensor dist</strong> - parameter is used to avoid doing unload when the AGV is driving normally on top of the pallet and there is another pallet behind. This parameter should be at least the distance between pallets on the row. See Figure 2 at the end of the document.</p>
</li>
</ul>
<h3 id="list-of-navitrol-parameters"><a class="header" href="#list-of-navitrol-parameters">List of Navitrol Parameters</a></h3>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Information</th></tr></thead><tbody>
<tr><td>Int</td><td>block_stacking_mode</td><td>0</td><td>0</td><td>5</td><td>Mode for detecting the top pallet.<br>0 = Disabled<br>1 = Occupancy check<br>2 = Pallet detection<br>3 = Fork sensor<br>4 = 3D camera<br>5 = Fork is moved to estimated height</td></tr>
<tr><td>Int</td><td>block_stacking_offset_mm</td><td>-2000</td><td>0</td><td>2000</td><td>Offset (in mm) from the height where the top level is detected to the safe unload height</td></tr>
<tr><td>Int</td><td>block_stacking_reference_step_mm</td><td>1</td><td>2</td><td>5000</td><td>Increase value added to the current height on each step in mm</td></tr>
<tr><td>Int</td><td>block_stacking_max_detection_wait_time_ms</td><td>0</td><td>30000</td><td>100000</td><td>Max wait time in ms for target detection in front of the stack. Used in both dropoff and pickup and with 3D camera and external target detection.</td></tr>
<tr><td>Int</td><td>occup_check_min_hits</td><td></td><td>1</td><td></td><td>How many scanner points are allowed on the occupancy area</td></tr>
<tr><td>Int</td><td>block_stacking_use_scanner_to_check_safety</td><td>0</td><td>0</td><td>2</td><td>Use scanner to check if block stacking is safe to start. Checks occupancy on top of the pallet where the block stacking should be done. If there is already something, block stacking is not started<br>1 = rear<br>2 = front scanner</td></tr>
<tr><td>Float</td><td>block_stacking_dist_to_check_load_sensor</td><td>-1.0</td><td>-1.0</td><td>5.0</td><td>This distance is used to check if the unload is actually done when driving out from the unload location using load sensor. The AGV is stopped if it tries to move and the load is still detected. Negative = not used</td></tr>
<tr><td>Float</td><td>block_stacking_dist_to_unload</td><td>-10</td><td>-2.0</td><td>10</td><td>Distance from detected target to the unload location. Calculated from target's front line to the navigation point.</td></tr>
<tr><td>Float</td><td>block_stacking_target_max_diff_from_route</td><td>0.0</td><td>0.1</td><td>2.0</td><td>How far the target can be from the route. If the target is too far, normal unload is done</td></tr>
<tr><td>Int</td><td>block_stacking_min_actuator_val_after_ready_mm</td><td>0</td><td>200</td><td>1000</td><td>&gt; 0 Use softstop to move the fork to this parameter value when driving away from stack. 0 = move the fork while driving</td></tr>
<tr><td>Float</td><td>block_stacking_target_max_heading_diff_deg</td><td>0.0</td><td>15.0</td><td>360.0</td><td>The maximum angle difference between target and the AGV for starting the sequence (in degrees)</td></tr>
<tr><td>Int</td><td>block_stacking_max_height_mm</td><td>0</td><td>1500</td><td>6000</td><td>Max allowed height for the block stacking (in mm). Required to be smaller than actuator_max_val</td></tr>
<tr><td>Float</td><td>block_stacking_max_dist_to_target</td><td>0.0</td><td>2.0</td><td>10.0</td><td>Max allowed distance (in m) from navigation point to target to start block stacking. If distance to the target is higher when block stacking is triggered, pause mode is enabled.</td></tr>
<tr><td>Float</td><td>block_stacking_max_extend_drive</td><td>0.0</td><td>0.2</td><td>1.0</td><td>Max allowed distance (in m) to extend the drive after stopped with unload buffer if fork sensor is not triggered</td></tr>
<tr><td>Int</td><td>block_stacking_verify_unload_height_mm</td><td>0</td><td>0</td><td>500</td><td>0 = not used. Verify unload with external sensor, by decreasing the actuator for value of this parameter and checking the sensor status. If sensor detects the pallet when decreased this amount, warning is triggered. If the sensor doesn't detect the pallet during the decrease, unload is considered to be ready.</td></tr>
<tr><td>Float</td><td>block_stacking_disable_fork_sensor_dist</td><td>0.0</td><td>1.2</td><td>5.0</td><td>Distance from unload location to navigation point to disable fork sensor triggering unload to the route level after the stack height is detected and when AGV has started to drive on top of the stack. This parameter should have a value that is close to the fork length. Used only if <strong>block_stacking_mode</strong> is 3. Idea is that fork sensors are used to trigger unload if they detect something ahead, but they should be disabled as soon as the fork is on top of the stack.</td></tr>
<tr><td>Int</td><td>block_stacking_verify_unload_height_sensor_offset_mm</td><td>-500</td><td>0</td><td>500</td><td>0 = not used. Offset value for the unload height when the actuator is stopped using the load sensor.</td></tr>
<tr><td>Float</td><td>block_stacking_reset_distance_from_increase_location</td><td>0.0</td><td>0.5</td><td>10.0</td><td>Distance to reset the state machine if AGV is far enough from the location where the increase starts.</td></tr>
<tr><td>Float</td><td>block_stacking_max_unload_error_behind_SP</td><td>0.0</td><td>0.05</td><td>1.0</td><td>Tolerance for calculated unload point behind symbolic point. If it is more than this parameter, stacking is not done and unload will be done in front of the pallet.</td></tr>
<tr><td>Int</td><td>block_stacking_pyramid_length_offset_mm</td><td>-5000</td><td>0</td><td>5000</td><td>The length offset for pyramid stacking. Only enabled if the pyramid stacking flag is received from Fleet Control.</td></tr>
<tr><td>Float</td><td>block_stacking_dist_from_stack_to_move_actuator</td><td>0.0</td><td>0.0</td><td>5.0</td><td>Distance [m] from navigation point to the detected pallet front line to stop AGV for increasing the actuator. 0 = Stopping point for actuator increase is defined by parameter <strong>buffer_stop_dist_from_object_when_unloading</strong>.</td></tr>
</tbody></table>
<h3 id="example-sets-of-navitrol-parameters"><a class="header" href="#example-sets-of-navitrol-parameters">Example sets of Navitrol parameters</a></h3>
<h4 id="agv-with-scanner-moving-with-the-fork"><a class="header" href="#agv-with-scanner-moving-with-the-fork">AGV with scanner moving with the fork</a></h4>
<p>This set of parameters is from the fork that has scanner moving with the fork. This one scanner is used to scan the stacking height.</p>
<pre><code class="language-bash">I,block_stacking_mode, 1
I,block_stacking_offset_mm, 54
I,block_stacking_reference_step_mm, 2
I,block_stacking_use_scanner_to_check_safety, 0
F,block_stacking_dist_to_unload, -0.62
F,block_stacking_target_max_diff_from_route, 0.15
F,block_stacking_target_max_heading_diff_deg, 35.0
I,block_stacking_max_height_mm, 1500
F,block_stacking_max_dist_to_target, 2.0
</code></pre>
<h4 id="agv-with-two-static-scanners-and-fork-tip-sensor-to-scan-the-stacking-height"><a class="header" href="#agv-with-two-static-scanners-and-fork-tip-sensor-to-scan-the-stacking-height">AGV with two static scanners and fork tip sensor to scan the stacking height</a></h4>
<p>This set of parameters is from the fork that has fork sensor at the tip of the fork. It has safety scanner below the fork that is used for detecting the pallet before lifting. There is also one scanner on top of the fork that can see on top of the pallet where we are unloading. On that project, block stacking is used to unload two pallets on top of
each other and this scanner on top is used to check if the area on top of one pallet is free.</p>
<pre><code class="language-bash">I,block_stacking_mode, 3
I,block_stacking_offset_mm, 54
I,block_stacking_reference_step_mm, 2
I,block_stacking_use_scanner_to_check_safety, 2
F,block_stacking_dist_to_unload, -0.62
F,block_stacking_target_max_diff_from_route, 0.15
F,block_stacking_target_max_heading_diff_deg, 35.0
I,block_stacking_max_height_mm, 1500
F,block_stacking_max_dist_to_target, 2.0
F,block_stacking_max_extend_drive, 0.2
</code></pre>
<h2 id="notes-for-customer"><a class="header" href="#notes-for-customer">Notes for Customer</a></h2>
<p>For safety reasons, the AGV should reserve the route all the way until the end symbolic point when driving to unload buffer.
Otherwise, the unload buffer area is not checked correctly. This route reservation can be checked with Monitor by checking how far ahead the purple part of the route is. If it doesn't reach the symbolic point when the AGV is at the beginning of the buffer area, increase Navithor parameter TrafficController_LIMIT_FOR_WP_LOCK_SECONDS.</p>
<p>If block stacking is aborted by Navithor while increasing the fork, increase Navithor parameter TrafficController_ABORT_WAIT_TIME_SECONDS. Generally, the abort     shouldn't be happening when the AGV is searching for the top pallet.
Changing the <strong>block_stacking_max_height</strong> - parameter increases  the search time if not found the top pallet, so this abort parameter should be larger than the time that it takes to lift the actuator to this max parameter and back to the floor.</p>
<p>If the fork is stopping or slowing down while trying to increase, check these parameters:</p>
<ul>
<li>
<p>actuator_inner_tolerance_mm</p>
</li>
<li>
<p>actuator_outer_tolerance_mm</p>
</li>
<li>
<p>actuator_inner_tolerance_timer_ms</p>
</li>
<li>
<p>block_stacking_reference_step_mm</p>
</li>
</ul>
<p>If the reference step is too slow, the fork might reach the tolerance too fast and stop the control for a while before the reference start increasing again. Increasing the inner tolerance timer might help but it always depends on how fast is the fork actuator control.</p>
<p>If the pallet top is not static or the pallet top is hard to find with fork sensors due to an object on top, try setting <strong>block_stacking_verify_unload_height_mm</strong> parameter to for example 0.2 m. See Figure 6 as an example when there is something on top of the pallet. This parameter requires a load sensor that can detect when the pallet is not anymore on the fork when decreasing it to the other pallet. The idea with this parameter is that the fork is decreased this parameter amount from the calculated unload height and stopped if the load sensor doesn't detect the pallet anymore or if the fork reaches this new target height.</p>
<p><img src="LoadHandling/BlockStacking/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Figure 6: Detecting wrong height due to some object is on top of the pallet.</p>
</blockquote>
<p>The red object on top of the pallet is the plastic or some other light thing that causes the block stacking to go too high, because we can't detect the static top of the pallet. This object should be so light that the pallet can be unloaded on top of it. The red dashed line is the error height, that should be the set to this  <strong>verify_unload_height -</strong> parameter. Without this new sensor check, the block stacking would do the unload based on the height of the object and then the pallet would not touch the static pallet top when trying to unload resulting the AGV to carry the pallet away.</p>
<p><img src="LoadHandling/BlockStacking/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Figure 7: Minimum value for disabling fork sensor and the normal unload to the route level.</p>
</blockquote>
<p>When the AGV is approaching to the pallet, the AGV can perform unload to the ground if the fork sensors are triggered. This might be caused by humans walking in front of the AGV and triggering the block stacking sequence too early. Then the height is detected to wrong height. But in normal case, this shouldn't be triggered and that's why the disable <strong>fork sensor dist</strong> - parameter should be at least the distance between the pallets.</p>
<p>If something goes wrong and blockstacking cannot be completed, its state machine can be reset by driving away from the location where the increase phase was done. The AGV has to drive <strong>block_stacking_reset_distance_from_increase_location</strong> amount away from the increase location, 0.5m by default, to reset the state machine. Then the blockstacking can be tried again. This figure down below shows the location where the state is reset. The sate is reset even though AGV is driven manually away, because it     only checks that navigation point is far enough from the precalculated unload location.</p>
<p><img src="LoadHandling/BlockStacking/./media-en/image10.png" alt="" /></p>
<blockquote>
<p>Figure 8: Location where the state machine is reset if something goes wrong. Defined with block_stacking_reset_distance_from_increase_location.</p>
</blockquote>
<p>Navitrol will remember the distance to the stack, when the AGV starts to increase the fork when driving towards the stack. Then when AGV is driving away after it has unloaded the pallet, this same distance is used to let the fork to be controlled to the route height. One exception is the case, when AGV is driving to empty buffer lane. Then the distance is the difference between these parameters: <strong>buffer_stop_dist_from_object_when_unloading</strong> - <strong>block_stacking_dist_to_unload</strong>.</p>
<h2 id="troubleshooting-41"><a class="header" href="#troubleshooting-41">Troubleshooting</a></h2>
<h3 id="agv-does-drop-off-in-front-of-stack-without-scanning"><a class="header" href="#agv-does-drop-off-in-front-of-stack-without-scanning">AGV does drop-off in front of stack without scanning</a></h3>
<h4 id="stacking-tag-missing-or-stacking-not-allowed"><a class="header" href="#stacking-tag-missing-or-stacking-not-allowed">Stacking tag missing or stacking not allowed</a></h4>
<ul>
<li>Check that symbolic point is Buffer lane and has Blockstacking tag or that Navithor has sent stacking allowed with the drive order.
<ul>
<li>This kind of log line shows Navithor stack data: &quot;ParseDriveCommandV2 received Buffer data. <strong>Stack 1</strong>, estimated height 0, max height 0&quot;</li>
<li>Navithor can order stacking without Blockstacking tag.</li>
</ul>
</li>
</ul>
<h4 id="scanner-sees-something-on-top-of-the-stack"><a class="header" href="#scanner-sees-something-on-top-of-the-stack">Scanner sees something on top of the stack</a></h4>
<ul>
<li>block_stacking_use_scanner_to_check_safety is nonzero and defined scanner sees something on top of the stack.</li>
<li>This kind of log line: &quot;BlockStacking: Sequence couldn't be started. PauseOk 1, <strong>unloadAreaOk 0</strong>, targetDistOk 1, targetAngleOk 1, targetFound 1, distOk 1, Drive end (44.32, 11.99)&quot;</li>
</ul>
<h4 id="pallet-not-detected"><a class="header" href="#pallet-not-detected">Pallet not detected</a></h4>
<ul>
<li>Pallet is required to be detected to start the stacking sequence</li>
<li>This kind of log line: &quot;BlockStacking: Sequence couldn't be started. PauseOk 1, unloadAreaOk 1, targetDistOk 0, targetAngleOk 0, <strong>targetFound 0</strong>, distOk 1, Drive end (44.32, 11.99)&quot;</li>
</ul>
<h4 id="pallet-too-far-from-route"><a class="header" href="#pallet-too-far-from-route">Pallet too far from route</a></h4>
<ul>
<li>block_stacking_target_max_diff_from_route is too small or pallet is too far to the side from the route.</li>
<li>This kind of log line: &quot;BlockStacking: Sequence couldn't be started. PauseOk 1, unloadAreaOk 1, <strong>targetDistOk 0</strong>, targetAngleOk 1, targetFound 1, distOk 1, Drive end (44.32, 11.99)&quot;</li>
</ul>
<h4 id="pallet-angle-difference-relative-to-the-route-is-too-high"><a class="header" href="#pallet-angle-difference-relative-to-the-route-is-too-high">Pallet angle difference relative to the route is too high</a></h4>
<ul>
<li>block_stacking_target_max_heading_diff_deg is too small or pallet angle is too high relative to the route.</li>
<li>This kind of log line: &quot;BlockStacking: Sequence couldn't be started. PauseOk 1, unloadAreaOk 1, targetDistOk 1, <strong>targetAngleOk 0</strong>, targetFound 1, distOk 1, Drive end (44.32, 11.99)&quot;</li>
</ul>
<h4 id="stacking-drop-off-point-too-far-from-symbolic-point"><a class="header" href="#stacking-drop-off-point-too-far-from-symbolic-point">Stacking drop-off point too far from symbolic point</a></h4>
<ul>
<li>block_stacking_max_unload_error_behind_SP is too small or pallet detected on the floor is too far behind symbolic point</li>
<li>This kind of log line: &quot;BlockStacking: Target found, but couldn't start increase. Increase 1, <strong>isStackinUnloadPointValid 0</strong>, distToStartIncrease 0.5, Drive end (44.32, 11.99)&quot;</li>
</ul>
<h3 id="agv-does-drop-off-too-high-in-stack"><a class="header" href="#agv-does-drop-off-too-high-in-stack">AGV does drop-off too high in stack</a></h3>
<p>Detected stack height is too high. If this happens multiple times, decrease <strong>block_stacking_offset_mm</strong>.</p>
<h3 id="agv-drives-too-much-in-to-the-stack"><a class="header" href="#agv-drives-too-much-in-to-the-stack">AGV drives too much in to the stack</a></h3>
<p>AGV stops too late when doing drop-off to the stack. If this happens multiple times, modify <strong>block_stacking_dist_to_unload</strong> closer to 0.</p>
<h3 id="agv-does-drop-off-too-early-on-the-stack"><a class="header" href="#agv-does-drop-off-too-early-on-the-stack">AGV does drop-off too early on the stack</a></h3>
<p>AGV stops too early when doing drop-off to the stack. If this happens multiple times, change <strong>block_stacking_dist_to_unload</strong> higher.</p>
<h3 id="agv-does-drop-off-in-front-of-stack-after-scanning"><a class="header" href="#agv-does-drop-off-in-front-of-stack-after-scanning">AGV does drop-off in front of stack after scanning</a></h3>
<p>The fork reached the maximum height while scanning the stack height. See <strong>block_stacking_max_height_mm</strong> parameter.</p>
<ul>
<li>There is also possibility to get this maximum height from Navithor with Drive order. If Navithor sends 0, then this parameter is used instead. </li>
<li>This kind of log line: &quot;ParseDriveCommandV2 received Buffer data. Stack 0, estimated height 0, <strong>max height 2000</strong>&quot;</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distance-to-target"><a class="header" href="#distance-to-target">Distance to target</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-17"><a class="header" href="#glossary-17">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Navigation software for an individual vehicle.</td></tr>
<tr><td>NavitrolMonitor</td><td>Monitoring software for the Navitrol positioning software running on the individual vehicle.</td></tr>
<tr><td>Navigation point</td><td>Centre point of the vehicle's coordinate system which is used as a reference for all other dimensions.</td></tr>
<tr><td>Fork point</td><td>Centre point of the fork which is used for distance calculation.<br>Look section 2.2 to see how the fork point is defined.</td></tr>
<tr><td>Unload pallet point</td><td>Predicted position of the pallet after unload<br>Look section 5.2 to see how the unload point is defined</td></tr>
</tbody></table>
<h2 id="introduction-51"><a class="header" href="#introduction-51">Introduction</a></h2>
<p><strong>Distance to target</strong> is a Navitrol feature unlockable by parameters.
Distance to target contains two following features:</p>
<ol>
<li>Distance from AGV to the pallet.</li>
</ol>
<p>When AGV is docking to a pallet, Navitrol calculates the perpendicular distance between the fork point and the closest corner of the pallet.
The calculation is performed only when the pallet is not turned too much in respect to the AGV.</p>
<ol start="2">
<li>Distance from AGV to unload point.</li>
</ol>
<p>When AGV is going to unload the pallet, Navitrol calculates the perpendicular distance between the fork point and predicted unload point. The calculation is performed only when the AGV is not turned too much and not too far away from the unload point.</p>
<h3 id="requirements-25"><a class="header" href="#requirements-25">Requirements</a></h3>
<p>To use this feature AGV should be the forklift type. Additionally, the pallet model should be specified in parameters and the pallet detection feature should be enabled in parameters. Please, see the pallet detection feature instructions for additional description.</p>
<h3 id="sequence-of-operation"><a class="header" href="#sequence-of-operation">Sequence of operation</a></h3>
<p>Distance from AGV to the pallet:</p>
<ul>
<li>
<p>AGV is approaching the load symbolic point without any resource on board.</p>
</li>
<li>
<p>AGV detects the pallet (using pallet detection feature).</p>
</li>
<li>
<p>AGV checks if the pallet is not turned too much i.e. AGV is almost perpendicular to the pallet.</p>
</li>
<li>
<p>Calculation activates. Navitrol calculates the perpendicular distance between the fork point and the closest corner of the pallet.</p>
</li>
<li>
<p>Navitrol starts sending data to the CAN and to the NavitrolMonitor.</p>
</li>
<li>
<p>Calculation ends when AGV is loaded or AGV cannot find the pallet for 1.5 seconds.</p>
</li>
</ul>
<p>Distance from AGV to unload point:</p>
<ul>
<li>
<p>AGV is approaching the unload point with a resource on board.</p>
</li>
<li>
<p>AGV checks if it is not turned too much from the unload point (i.e. it is really going to unload the resource).</p>
</li>
<li>
<p>Navitrol checks if AGV is close enough to the unload point to start the calculation.</p>
</li>
<li>
<p>Navitrol calculates the perpendicular distance between the fork point and predicted unload point (taking into account the offset between the fork and the pallet).</p>
</li>
<li>
<p>Navitrol starts sending to the CAN and to the NavitrolMonitor.</p>
</li>
<li>
<p>Calculation ends when AGV is unloaded.</p>
</li>
</ul>
<h2 id="setting-up-1"><a class="header" href="#setting-up-1">Setting up</a></h2>
<p>Required software:</p>
<ul>
<li>
<p>Official release version 6.30.00 or later</p>
</li>
<li>
<p>Navithor Tools 3.03.05 or later</p>
</li>
</ul>
<h3 id="navithor-tools-2"><a class="header" href="#navithor-tools-2">Navithor Tools</a></h3>
<p>Pallet detection needs to be enabled on each symbolic point, where distance to pallet feature is used. It can be done in the following way:</p>
<ul>
<li>
<p>Create an environment and a route</p>
</li>
<li>
<p>Create a symbolic point and change it to load type</p>
</li>
<li>
<p>Enable pallet detection</p>
</li>
</ul>
<p><img src="LoadHandling/DistanceToTarget/./media-en/image3.png" alt="" /></p>
<ul>
<li>
<p>Limit the resources of the current symbolic point (if needed).</p>
</li>
<li>
<p>Create a symbolic point and change it to unload type.</p>
</li>
<li>
<p>Upload the project to Navitrol and to the Database.</p>
</li>
</ul>
<h3 id="notes-of-navitrol-parameters-1"><a class="header" href="#notes-of-navitrol-parameters-1">Notes of Navitrol parameters</a></h3>
<ul>
<li>
<p>First, enable the calculation. Parameter <strong>dist_to_target_enabled</strong> should be set to <strong>1</strong> in order to perform the calculation.</p>
</li>
<li>
<p>The calculation is not performed when the pallet is turned too much.
Parameter <strong>dist_to_target_angle_tolerance_deg</strong> should be set to the maximum allowed angle.</p>
</li>
<li>
<p>The distance is calculated from the fork point. The fork point should be defined in parameters. There are two parameters:
<strong>fork_pos_x</strong> and <strong>fork_pos_y</strong> that describes fork position with respect to the AGV navigation point shown in Figure 1.</p>
</li>
</ul>
<p><em>Note:</em> Parameters can be either positive or negative. Sign is explained in Paragraph 5.2.</p>
<ul>
<li>The distance calculation to the unload point should be started only when AGV is close enough to the unload point. The maximum distance when calculation should start is defined by the parameter <strong>dist_to_target_max_calc_dist</strong>.</li>
</ul>
<h3 id="using-the-feature-in-navitrolmonitor"><a class="header" href="#using-the-feature-in-navitrolmonitor">Using the feature in NavitrolMonitor</a></h3>
<p>After connecting to the AGV in NavitrolMonitor, the feature can be enabled as it is shown in Figure 2.
<img src="LoadHandling/DistanceToTarget/./media-en/image4.png" alt="" /></p>
<blockquote>
<p>Figure 2. Distance To Target in NavitrolMonitor</p>
</blockquote>
<p>When AGV is approaching the target, the results of distance calculation are shown by the line drawn from the fork point to the target position as shown in the picture below.
<img src="LoadHandling/DistanceToTarget/./media-en/image5.png" alt="" />
<img src="LoadHandling/DistanceToTarget/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Figure 3. Examples of distance calculation from AGV to the pallet</p>
</blockquote>
<p>Additionally to the graphic representation, in the left top corner of NavitrolMonitor distance is shown in text format:
<img src="LoadHandling/DistanceToTarget/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Figure 4. Distance displaying</p>
</blockquote>
<h2 id="list-of-navitrol-parameters-1"><a class="header" href="#list-of-navitrol-parameters-1">List of Navitrol Parameters</a></h2>
<table><thead><tr><th>Type</th><th>Name</th><th>Min</th><th>Default</th><th>Max</th><th>Information</th></tr></thead><tbody>
<tr><td>Int</td><td>dist_to_target_enabled</td><td>0</td><td>0</td><td>1</td><td>Distance calculation from AGV to target.<br>Calculates distance from AGV to pallet when AGV is docking, and distance from AGV to unload point when AGV is driving to unload point with a pallet</td></tr>
<tr><td>Float</td><td>dist_to_target_angle_tolerance_deg</td><td>0.0</td><td>30.00</td><td>45.00</td><td>Allowed rotation angle of the pallet with respect to the AGV when distance calculation is enabled</td></tr>
<tr><td>Float</td><td>fork_pos_x</td><td>-</td><td>0.0</td><td>-</td><td>Fork coordinate X with respect to the AGV navigation point.</td></tr>
<tr><td>Float</td><td>fork_pos_y</td><td>-</td><td>0.0</td><td>-</td><td>Fork coordinate Y with respect to the AGV navigation point.</td></tr>
<tr><td>Float</td><td>dist_to_target_max_calc_dist</td><td>0.0</td><td>4.0</td><td>15.0</td><td>Maximum distance from agv to unloading point when calculation starts</td></tr>
</tbody></table>
<h2 id="example-set-of-navitrol-parameters-1"><a class="header" href="#example-set-of-navitrol-parameters-1">Example set of Navitrol parameters</a></h2>
<h2 id="illustration-of-operation"><a class="header" href="#illustration-of-operation">Illustration of operation</a></h2>
<h3 id="distance-from-agv-to-pallet"><a class="header" href="#distance-from-agv-to-pallet">Distance from AGV to pallet</a></h3>
<p>Navitrol performs perpendicular distance calculation between the <strong>fork point</strong> and <strong>closest pallet corner.</strong></p>
<p><img src="LoadHandling/DistanceToTarget/./media-en/figure5.png" alt="" /></p>
<blockquote>
<p>Figure 5: Illustration to distance to pallet feature</p>
</blockquote>
<p><strong>Note!</strong> The calculation is performed only when the pallet is close to the perpendicular to AGV. The maximum allowed angle between AGV and pallet is defined by the parameter
<strong>dist_to_target_angle_tolerance_deg</strong> and cannot exceed 45.0 degrees. The parameter is defined as follows:</p>
<p><img src="LoadHandling/DistanceToTarget/./media-en/figure6.png" alt="" /></p>
<blockquote>
<p>Figure 6: Angle calculation</p>
</blockquote>
<p><strong>The fork point</strong> position is continuously calculated in relation to the AGV position, i.e. navigation point position. Parameters <strong>fork_pos_y</strong> and <strong>fork_pos_x</strong> should be correctly measured and set to Navitrol parameter file in order to have an accurate fork point position.</p>
<p><strong>The closest pallet corner</strong> position is calculated in relation to the AGV position and the pallet position, which is received from the pallet detection feature.</p>
<p><strong>Note!</strong> The calculation is performed only when the pallet has been recognized, and it is dependent on the pallet detection feature.</p>
<h3 id="distance-from-agv-to-unload-point"><a class="header" href="#distance-from-agv-to-unload-point">Distance from AGV to unload point</a></h3>
<p>Navitrol performs calculation of the perpendicular distance between the <strong>fork point</strong> and the <strong>unload pallet point</strong>.</p>
<p><img src="LoadHandling/DistanceToTarget/./media-en/figure7.png" alt="" /></p>
<blockquote>
<p>Figure 7: Illustration of distance to unload point feature</p>
</blockquote>
<p><strong>The fork point</strong> position is continuously calculated in relation to the AGV position, i.e. navigation point position. Parameters <strong>fork_pos_y</strong> and <strong>fork_pos_x</strong> should be correctly measured and set to Navitrol in order to have an accurate fork point position.</p>
<p><strong>The unload pallet point</strong> is the predicted position of the end of the pallet after unloading. When calculating the unload pallet point Navitrol takes into account:</p>
<ul>
<li>
<p><em>Position of unload symbolic point</em> (Which was set in NavithorTools)</p>
</li>
<li>
<p><em>Length of the pallet</em>. During docking, when the pallet is recognized, the pallet length is stored in memory. This pallet length cannot be measured by scanners and it is taken from the parameters. Thus, for the correct operation of the feature, pallet dimensions should be correctly defined in parameters.</p>
</li>
<li>
<p>Correction for <em>fork position</em> (for the cases where fork point differs from navigation point)</p>
</li>
<li>
<p>Correction for an <em>offset between pallet and fork</em>. This offset happens when there is some gap between the pallet and fork as it is shown in Figure 8. This gap is measured by Navitrol during docking.</p>
</li>
</ul>
<p><img src="LoadHandling/DistanceToTarget/./media-en/figure8.png" alt="" /></p>
<blockquote>
<p>Figure 8: Offset between fork and pallet</p>
</blockquote>
<p>The following example is provided in order to illustrate how the unload pallet point is defined by Navitrol. In this example:</p>
<ul>
<li>
<p>Fork parameters:</p>
<ul>
<li>fork_pos_ x -0.20
(negative sign signals that fork is closer to the back of the AGV then navigation point) as shown in the illustration.</li>
</ul>
</li>
</ul>
<p><img src="LoadHandling/DistanceToTarget/./media-en/figure9.png" alt="" /></p>
<blockquote>
<p>Figure 9: Sign of fork parameters</p>
</blockquote>
<ul>
<li>
<p>fork_pos_ y 0.00</p>
</li>
<li>
<p>Pallet parameters:</p>
<ul>
<li>pallet_model_length_x[0] 0.45</li>
</ul>
</li>
<li>
<p>Offset between the pallet and the fork: 0.10 (measured during docking)</p>
</li>
</ul>
<p>The unload pallet point is calculated as it is shown on the figure:
<img src="LoadHandling/DistanceToTarget/./media-en/figure10.png" alt="" /></p>
<blockquote>
<p>Figure 10: Illustration of unload pallet point calculation</p>
</blockquote>
<h2 id="can-message-description"><a class="header" href="#can-message-description">CAN message description</a></h2>
<p>The results of distance calculation are sent through CAN interface.
Information about the CAN customer specific message is shown in the table below.</p>
<p>Table 1. CAN message description</p>
<p><strong>CAN Message 0x60B: Navitrol -&gt; PLC: 20ms.<br>Information for Proximity Based Safety - 20 ms cycle</strong></p>
<table><thead><tr><th>Name</th><th>Byte</th><th>Bit</th><th>Type</th><th>Calibration</th><th>Description</th></tr></thead><tbody>
<tr><td>Distance To Target</td><td>0</td><td>-</td><td>Real</td><td>-</td><td>Distance to target in meters</td></tr>
<tr><td>Distance To Target</td><td>1</td><td>-</td><td>Real</td><td>-</td><td>Distance to target in meters</td></tr>
<tr><td>Distance To Target</td><td>2</td><td>-</td><td>Real</td><td>-</td><td>Distance to target in meters</td></tr>
<tr><td>Distance To Target</td><td>3</td><td>-</td><td>Real</td><td>-</td><td>Distance to target in meters</td></tr>
<tr><td>-</td><td>4</td><td>0</td><td>-</td><td>-</td><td></td></tr>
<tr><td>-</td><td>4</td><td>1</td><td>-</td><td>-</td><td></td></tr>
<tr><td>-</td><td>4</td><td>2</td><td>-</td><td>-</td><td>-</td></tr>
<tr><td>Pick Active</td><td>4</td><td>3</td><td>Bit</td><td>-</td><td>1 for when Pick is active</td></tr>
<tr><td>Place Active</td><td>4</td><td>4</td><td>Bit</td><td>-</td><td>1 for when Place is active</td></tr>
<tr><td>-</td><td>4</td><td>5</td><td>-</td><td>-</td><td></td></tr>
<tr><td>Calculation activated</td><td>4</td><td>6</td><td>Bit</td><td>-</td><td>1 for when the calculation is activated</td></tr>
<tr><td>Toggle Bit</td><td>4</td><td>7</td><td>Bit</td><td>-</td><td>Toggle for every message sent</td></tr>
</tbody></table>
<h2 id="advice-for-user"><a class="header" href="#advice-for-user">Advice for user</a></h2>
<ul>
<li>
<p>Pallet dimensions cannot be measured by Navitrol, but those data are used in distance calculation. So, it is recommended to set the pallet parameters as accurately as possible.</p>
</li>
<li>
<p>Distance calculation highly depends on pallet detection. For best results pallet detection should be properly tuned.</p>
</li>
<li>
<p>In the calculations, it is assumed that AGV stops on the symbolic point. In case if AGV constantly does not stop on the symbolic point, please, contact the Navitec support team. Support team will help you to tune the parameters.</p>
</li>
<li>
<p>In some situations (e.g. in case of wheel slipping) it may occur that AGV is crossing the unload point i.e. distance to the unload point calculated according to the above-mentioned methods is less than the minimum distance. In such unpredictable cases, Navitrol will send (through the CAN and to the NavitrolMonitor) minimal possible distance. Minimal possible distance is the sum of <em>offset between pallet and fork</em> + <em>pallet length</em>.</p>
</li>
<li>
<p>In cases when AGV drives over the symbolic point too much (more, than it is defined in parameter <strong>pc_max_dist_err</strong>), Navitrol detects some unpredicted behavior of the AGV (which can be caused by brake failure, for instance). In such cases, the distance calculation is impossible to perform, so the calculation is deactivated and the minimum distance will be sent to the CAN interface.</p>
</li>
<li>
<p>If you feel that the calculation is not working or working incorrectly, please, set the parameter <strong>log_pallet_detection</strong> to value <strong>1</strong> and take logs from the NavitrolMonitor. Please, sent those logs to the Navitec support team for further instructions.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pallet-detection-1"><a class="header" href="#pallet-detection-1">Pallet Detection</a></h1>
<p>Updated 03.07.2024</p>
<hr />
<h2 id="pallet-detection-requirements"><a class="header" href="#pallet-detection-requirements">Pallet detection requirements</a></h2>
<p><strong>Detecting the pallet -- field of view:</strong></p>
<p>At least one of the legs of the pallet is assumed to be in front of the laser scanner within a field of view of 30 degrees</p>
<p>The algorithm assumes the pallet will be located directly in front of the laser scanner.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/figure1.png" alt="" /></p>
<blockquote>
<p>Field of view explained.</p>
</blockquote>
<p><strong>Detecting the pallet -- maximum error:</strong></p>
<ul>
<li>
<p>The angle of the pallet relative to the laser scanner must be less than 20 degrees.</p>
</li>
<li>
<p>The maximum error for the pallet's nominal location is about +-15 cm (depending on the pallet dimensions).</p>
<ul>
<li>In good circumstances the pallet can be correctly detected even if the displacement is larger, but it can't be always guaranteed.</li>
</ul>
</li>
<li>
<p>The space between the pallets next to each other should differ from the distance between the legs of the pallet.</p>
</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/figure2.png" alt="" /></p>
<blockquote>
<p>Distance between pallets.</p>
</blockquote>
<p><strong>Detecting from stringer board</strong></p>
<ul>
<li>The pallet can be also detected based on the top part of a pallet called stringer board. If the pallet is detected from the stringer board, the pallets must be separated from each other at least by 10 cm.</li>
</ul>
<h2 id="using-pallet-detection"><a class="header" href="#using-pallet-detection">Using pallet detection</a></h2>
<p>Pallet detection can be used to drive the AGV accurately under a pallet, even if the pallet is not perfectly on the location defined as a symbolic point in Navithor Tools. Pallet detection detects the target and corrects the AGVs driving according to it.</p>
<p>Using pallet detection requires Navitrol license which includes the feature, otherwise Navitrol will stop in an error, if the pallet detection is activated without the proper license.</p>
<p>Pallet detection can be used in combination with 'Load' or 'Load, Unload' symbolic point. If pallet detection is enabled for such a location and the AGV is heading towards the location, Navitrol activates pallet detection and tries to find the target. If the target is found and certain restrictions are met, the AGV starts a docking procedure and corrects the trajectory to drive precisely under the pallet. For more information on docking, see <a href="TargetAndObstacleDetection/PalletDetection/../../PositionControl/Docking/Docking-en.html">Docking</a>.</p>
<p>Pallet detection can be enabled with a quick selection in Navithor Tools under the Symbolic Points tool -&gt; Edit Symbolic Points -&gt; 'Enable pallet detection':</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Enabling pallet detection in Navithor Tools</p>
</blockquote>
<p>If pallet detection is not enabled with this checkbox, AGV will drive to the location blindly.</p>
<p>There are several warnings, that can show up, if something goes wrong with pallet detection. If detecting the target fails, Navitrol will show up target detection error. If pallet is found, but the restrictions for starting the docking are not met, Navitrol shows instead a target approach error. If docking is started, but the error is too big to correct when AGV is closer to the pallet, Navitrol will show up the same warning. More detailed explanation about these errors are given in Chapter 8.2. The exact warnings are following:</p>
<p>612, WARNING_TARGET_NOT_DETECTED, &quot;Target for docking not detected&quot;</p>
<p>613, WARNING_TARGET_APPROACH_ERROR, &quot;Target location differs too
much from expected&quot;</p>
<p>Some parameters, which are discussed later in this document, need to be also changed in Navitrol to activate pallet detection.</p>
<h2 id="mounting-laser-scanner-for-pallet-detection"><a class="header" href="#mounting-laser-scanner-for-pallet-detection">Mounting laser scanner for pallet detection</a></h2>
<p>Scanner angle related to the floor is important to consider when the scanner is mounted to the AGV. In ideal case, the scanner can see the legs of the pallet from the distance and also on close range.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image6.png" alt="" /></p>
<blockquote>
<p>Generic options for mounting laser scanner for pallet detection.</p>
</blockquote>
<h2 id="calibrating-laser-scanner-for-pallet-detection"><a class="header" href="#calibrating-laser-scanner-for-pallet-detection">Calibrating laser scanner for pallet detection</a></h2>
<p><strong>NOTE!</strong> If the pallet detection scanner is used only for detecting pallets and not for localization, this method should be used to calibrate the scanner. If it is used also on localization, then it should be calibrated in normal way.</p>
<p>The angle of the pallet detection scanner (<strong>scan_rear_sen_ang</strong> or <strong>scan_front_sen_ang</strong> depending which scanner is used) plays a key role in the pallet detection accuracy. A clear sign of wrong scanner angle is a sidewise drifting pallet position during the approaching drive.</p>
<p>A good method to calibrate the scanner is to do it in a controlled pallet detection drive as follows:</p>
<ul>
<li>
<p>Plan a straight route of approximately 4 meters in an environment with good positioning confidence. Mark a symbolic point with pallet detection tag at the end of the route.</p>
</li>
<li>
<p>Set the pallet detection parameters so that the pallet detection is active during the entire route (<strong>target_detection_type_selection</strong> = 3,     <strong>target_detection_always_enabled</strong> = 1) and disable the docking to keep the AGV on the route (<strong>docking_to_target_enabled</strong> = 0).</p>
</li>
<li>
<p>Place a pallet accurately on the AGV fork and give the AGV a drive order to the symbolic point so that it unloads the pallet accurately at the symbolic point location. The idea is just to have the pallet on the symbolic point.</p>
</li>
<li>
<p>Give the AGV a drive order to the other end of the route.</p>
</li>
<li>
<p>Give the AGV a drive order to the symbolic point where the pallet is and verify that the pallet detection is active during the drive.</p>
</li>
<li>
<p>When the drive is ready, disconnect the Monitor from the navigation so that the drive can be analyzed by sliding back and forth with the progress bar (see below)</p>
</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image7.png" alt="" /></p>
<blockquote>
<p>Monitor Progress bar.</p>
</blockquote>
<ul>
<li>Slide backwards until the first pallet detection visualizations in the beginning of the drive (green pallet square on the map) and freeze the view as shown in the figure below.</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image8.png" alt="" /></p>
<blockquote>
<p>Frozen initial pallet position at start of drive.</p>
</blockquote>
<ul>
<li>
<p>Slide forwards again until the AGV reaches the pallet and monitor how the pallet position is drifting while the AGV approaches the pallet.</p>
</li>
<li>
<p>If the pallet position is constantly drifting sideways in one direction, this is caused by an error in the scanner angle, see the second figure below.</p>
</li>
<li>
<p>Adjust the scanner angle in the parameter file, unfreeze the Monitor view, reconnect the Monitor and request Navitrol to update the parameters.</p>
</li>
<li>
<p>Repeat the pallet detection drive, analyzing the pallet drift during the drive and adjusting the scanner angle until the drift is small and randomly to both sides of the route.</p>
</li>
<li>
<p>Now the scanner angle should be accurately calibrated.</p>
</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image9.png" alt="" /></p>
<blockquote>
<p>Frozen pallet position and current pallet position mismatch.</p>
</blockquote>
<h2 id="required-navitrol-parameters"><a class="header" href="#required-navitrol-parameters">Required Navitrol parameters</a></h2>
<p>Following parameters have to be always set to use pallet detection:</p>
<p><em>I,target_detection_type_selection, 3</em></p>
<p># Enables reflector-based docking or pallet detection, 0 = disabled, 1 = reflector docking, 2 = pallet detection, 3 = pallet detection v2, 4 = external target detection, 5 = supervisor controlled;</p>
<p><strong>NOTE!</strong> There are two pallet detection versions, but version 2 (target_detection_type_selection = 3) should be used from now on. The first version of pallet detection (parameter value 2) should not be used anymore. Navitec Systems have not updated this version anymore since 2018.</p>
<p>Main difference is that version 2 supports using more than 1 scanner for pallet detection, can detect the pallet in any driving direction and works with all omni headings.</p>
<p><em>I,target_detection_scan_selection, 1 or 2</em></p>
<p># Defines which scanners are used for target detection: 1 = rear scanner only, 2 = front scanner only, 3 = both scanners (supported only in reflector-based detection!), 4 = use scanner in driving direction, 5 = alternate between scanners</p>
<p><strong>NOTE!</strong> More than two scanners are supported with target_detection_multi_scan_selection parameter. target_detection_scan_selection has to be 0 to activate that parameter.</p>
<p><em>I,docking_to_target_enabled, 1</em></p>
<p># 1 = Enables docking to target. 2 = docking with custom route. If target_detection_type_selection == 0, won't do anything</p>
<p>F,docking_max_start_distance, 3.5 # Beyond maximum distance docking won't be triggered</p>
<p>Differences between these two docking types are explained in Chapters 8.4 and 8.5.</p>
<p>Pallet models used for the detection has to be defined as Navitrol parameters. They are array parameters and maximum number of models used is 5. The algorithm tries to detect the best match from the different models given. At least one models has to be always defined.</p>
<p>An example of EUR-pallet in Navitrol parameters:</p>
<table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody>
<tr><td>I,pallet_model_enabled[0],</td><td>1</td></tr>
<tr><td>S,pallet_model_description[0],</td><td>&quot;EUR-pallet&quot;</td></tr>
<tr><td>F,pallet_model_width_y[0],</td><td>0.800</td></tr>
<tr><td>F,pallet_model_length_x[0],</td><td>1.200</td></tr>
<tr><td>I,pallet_model_n_legs_x[0],</td><td>3</td></tr>
<tr><td>I,pallet_model_n_legs_y[0],</td><td>3</td></tr>
<tr><td>F,pallet_model_mid_leg_width_y[0],</td><td>0.145</td></tr>
<tr><td>F,pallet_model_mid_leg_length_x[0],</td><td>0.145</td></tr>
<tr><td>F,pallet_model_side_leg_width_y[0],</td><td>0.100</td></tr>
<tr><td>F,pallet_model_side_leg_length_x[0],</td><td>0.145</td></tr>
</tbody></table>
<p>The second model can be given by changing the array index to [1], the third model with [2] and so on. Individual models can be temporarily disabled by changing the <strong>pallet_model_enabled</strong> to 0, so you don't need to remove the whole model from parameter file to disable it. At least one model has to be enabled all the time.</p>
<p><strong>NOTE!</strong> Pallet detection algorithm tries to find the best fitting model from these, but if the models are too similar to each other, false positives can happen.</p>
<ul>
<li>
<p>Larger differences between pallet models is always better.</p>
</li>
<li>
<p>Additional models should be avoided, if not necessary</p>
</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/figure7.png" alt="" /></p>
<blockquote>
<p>Pallet dimensions</p>
</blockquote>
<h2 id="scanner-modes"><a class="header" href="#scanner-modes">Scanner modes</a></h2>
<p>The <strong>target_detection_scan_selection</strong> parameter has different options for the scanner use. This parameter is only meant to define what scanner data is used for pallet detection. The scanner has to be enabled with this parameter: <strong>scan_rear_front_selection.</strong></p>
<ul>
<li>
<p>Mode 1: Uses scanner that is defined with <strong>scanner_model_rear</strong> parameter.</p>
</li>
<li>
<p>Mode 2: Uses scanner that is defined with <strong>scanner_model_front</strong> parameter.</p>
</li>
<li>
<p>Mode 3: Uses data from both front and rear scanners. Not supported with <strong>target_detection_type_selection</strong> = 2, the scanner mode 4 should be used instead.</p>
</li>
<li>
<p>Mode 4: Uses data from scanner based on the driving direction. When driving forward, using front scanner, when driving backwards use the rear scanner. Uses wheel speed to define the driving direction (positive forwards, negative backwards). For example: Steer wheel for steer drive, fastest wheel of diff drive. If the AGV is standing still, using the last scanner.</p>
</li>
</ul>
<p>The <strong>target_detection_multi_scan_selection</strong> parameter supports more scanners. If the <strong>target_detection_scan_selection is 0</strong>, this parameter is used instead. This parameter is array parameter and each array index matches to the scanner:</p>
<p><strong>target_detection_multi_scan_selection[0] = Rear scanner</strong></p>
<p><strong>target_detection_multi_scan_selection[1] = Front scanner</strong></p>
<p><strong>target_detection_multi_scan_selection[2] = Measurement 0 scanner</strong></p>
<p><strong>target_detection_multi_scan_selection[3] = Measurement 1 scanner</strong></p>
<p>Then the parameter values define what mode is used.</p>
<ul>
<li>
<p>Mode 1: Uses this scanner only. For example, <strong>target_detection_multi_scan_selection[2] = 1</strong> uses only measurement 0 scanner for target detection.</p>
</li>
<li>
<p>Mode 2: Uses all defined scanners. For example, <strong>target_detection_multi_scan_selection[2] = 2</strong> and <strong>target_detection_multi_scan_selection[3] = 2</strong> both     measurement 0 and measurement 1 scanners are used for target detection.</p>
</li>
<li>
<p>Mode 3: Alternate primary scanner. The idea is that target detection uses only data from the received scanner (primary or secondary). Mainly used on pattern detection (target_detection_type_selection = 1 and refl_det_version = 2).</p>
</li>
<li>
<p>Mode 4: Alternate secondary scanner.</p>
</li>
<li>
<p>Mode 5: Use this scanner when driving forwards. For example, <strong>target_detection_multi_scan_selection[1] = 5.</strong> Front scanner is used only when AGV is driving forwards.</p>
</li>
<li>
<p>Mode 6: Use this scanner when driving backwards. For example, <strong>target_detection_multi_scan_selection[1] = 6.</strong> Front scanner is used only when AGV is driving backwards.</p>
</li>
<li>
<p>Mode 7: Use this scanner when driving sideways to the right (should be used only with omni).</p>
</li>
<li>
<p>Mode 8: Use this scanner when driving sideways to the left (should be used only with omni).</p>
</li>
</ul>
<h2 id="pallet-detection-2"><a class="header" href="#pallet-detection-2">Pallet detection</a></h2>
<h3 id="search-area"><a class="header" href="#search-area">Search area</a></h3>
<p>The search area is an area that defines what scanner points are included in pallet detection algorithm. </p>
<ul>
<li>For non-buffer lane symbolic points with load detection enabled, the search area is defined first as a circle and then limited based on the pallet width we are searching for (see two figures below). The circle radius comes from pallet model dimension and <strong>pallet_det_2_initial_search_model_width_add</strong> parameter. If there are multiple pallet models defined, then the pallet model that has the largest dimension is used.</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/SearchArea.png" alt="" /></p>
<blockquote>
<p>Circle shaped search area around the symbolic point, marked as dashed blue line. </p>
</blockquote>
<ul>
<li>For buffer lanes, the circle is not used, but the search area is defined initially based on the first pallet model width defined on params.txt file and the <strong>pallet_det_2_initial_search_model_width_add</strong> parameter as on the figure below. If there are multiple pallet models, then the search area is first limited based on the first model width and later limited based on the model we are searching for. </li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image11.png" alt="" /></p>
<blockquote>
<p>Search area based on pallet width. The area between the blue dashed lines is defined from route to the pallet width + <strong>pallet_det_2_initial_search_model_width_add</strong>.</p>
</blockquote>
<h3 id="start-point-for-clustering"><a class="header" href="#start-point-for-clustering">Start point for clustering</a></h3>
<p>The start point for clustering is usually the closest point in AGV coordinate frame. If this point is not found from the closest legs of the pallet, the detection cannot find the pallet. There are two values that are used to select the start point:</p>
<ul>
<li>Distance from scanner point to AGV navigation pose</li>
<li>Scanner point angle relative to the symbolic point. This angle is a difference between line that goes from AGV navigation pose to scanner point, and line that goes from AGV navigation pose to symbolic point</li>
</ul>
<p>Parameter <strong>pallet_det_first_leg_ang_weight</strong> can be used to define the weight between these two values. The bigger the parameter value, the more important is the small angle. The smaller the value, the more important is the small distance.</p>
<p>Parameter <strong>pallet_det_use_dynamic_search_ang</strong> defines how the maximum angle for the start point is calculated. </p>
<ul>
<li>If <strong>pallet_det_use_dynamic_search_ang</strong> is 1, then the angle is calculated with distance from AGV to the symbolic point + <strong>docking_stop_distance</strong> and the half pallet width + <strong>pallet_det_2_initial_search_model_width_add</strong>. The idea is that the angle is little bit higher than the closest corner of the pallet. See figure below. </li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/DynamicAngle.png" alt="" /></p>
<blockquote>
<p>Maximum angle for the start point, illustrated as red line. The angle changes dynamically based on the AGV distance to the symbolic point. 1. <strong>docking_stop_distance</strong> parameter, 2. Pallet half width, 3. <strong>pallet_det_2_initial_search_model_width_add</strong> parameter, 4. Maximum angle, 5. Distance from AGV to symbolic point.</p>
</blockquote>
<ul>
<li>If <strong>pallet_det_use_dynamic_search_ang</strong> is 0, then <strong>pallet_det_limit_initial_search_ang</strong> is used to define the max angle. See figure below.</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/ClosestPointAngleParam.png" alt="" /></p>
<blockquote>
<p>Maximum angle for the start point, illustrated as red line. The angle is static and it does not change based on distance to the symbolic point. 1. Angle is defined only with <strong>pallet_det_limit_initial_search_ang</strong> parameter.</p>
</blockquote>
<h3 id="linear-model"><a class="header" href="#linear-model">Linear model</a></h3>
<p>Linear model is a detection feature that matches straight line for the pallet width. The idea is to detect the stringer board of the pallet or the load on the pallet if it has the width of the pallet.</p>
<p>Linear model can be enabled with parameter <strong>pallet_det_linear_models_enabled.</strong></p>
<p>The parameter <strong>pallet_det_lin_mod_point_threshold</strong> define what is the maximum distance between consecutive points to create the straight line.</p>
<p>The parameter <strong>pallet_det_linear_model_max_err</strong> is maximum error between the model width (<strong>pallet_model_width_y paramater</strong>) and the detected line.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image12.png" alt="" /></p>
<blockquote>
<p>Example of the linear model. The pallet is detected based on the line width.</p>
</blockquote>
<h3 id="asymmetric-pallets"><a class="header" href="#asymmetric-pallets">Asymmetric pallets</a></h3>
<p>An asymmetric pallet is a pallet that is shaped like an isosceles trapezoid, meaning it is symmetric along one axis and asymmetric along the other. Each pallet is assumed to have four legs, visualized below:</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/AsymmetricPalletDetection.PNG" alt="" /></p>
<blockquote>
<p>Dimensions of an asymmetric pallet</p>
</blockquote>
<p>An asymmetric pallet will create four models, from each possible direction of detection. The models are obtained as 0, 90, 180 and 270 degree rotations of the pallet around its axis.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/AsymmetricModels.PNG" alt="" /></p>
<blockquote>
<p>Models obtained from an asymmetric pallet </p>
</blockquote>
<p>The pose estimate (x, y, h) of an asymmetric pallet is obtained as the centre of the facade for the symmetric side or in line with the pallet leg that is nominally closer to the AGV. The side leg angle offset Y is used to compensate the computed heading, visualized in the Figure above. The position of the pallet is visualized as a blue circle in the below Figures</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/AsymmetricPoseEstimation1.PNG" alt="" /><br />
<img src="TargetAndObstacleDetection/PalletDetection/./media-en/AsymmetricPoseEstimation2.PNG" alt="" /></p>
<blockquote>
<p>Pose estimation of an asymmetric pallet</p>
</blockquote>
<p>For asymmetric pallets a heading distinction of 180 degrees must be made. This is done by the sign of the side leg angle offset Y weighted by parameter <strong>pallet_det_fitness_weight[7]</strong>. Asymmetric pallet detection logging has prefix <em>Pallet detection: asymmetric</em> that is visible, when parameter <strong>log_pallet_detection</strong> is set to 1.</p>
<h3 id="locking-the-target"><a class="header" href="#locking-the-target">Locking the target</a></h3>
<p>The target is locked (meaning its position is not updated anymore) after the distance to target is close enough.</p>
<ul>
<li>
<p>If <strong>target_detection_type_selection = 2</strong>, the distance parameter is <strong>pallet_det_min_dist_from_scanner.</strong></p>
</li>
<li>
<p>If <strong>target_detection_type_selection = 3</strong>, the distance parameter is <strong>pallet_det_2_min_dist_from_nav_point_to_traj_end.</strong></p>
</li>
</ul>
<p>There is also model-based parameter <strong>pallet_model_min_dist_from_nav_point_to_traj_end[model index]</strong> that is used if the target should be locked in different distance for different pallet models.</p>
<h3 id="locking-the-model"><a class="header" href="#locking-the-model">Locking the model</a></h3>
<p>This can be used if there are different pallet models. If the target is found multiple times in a row the algorithm can be locked to search only that specific model by setting the parameter <strong>pallet_det_2_lock_model_if_found_number_of_times</strong> to some reasonable value (e.g. 10 times). However, it is important to check if the old target is reset between different symbolic points. This can be tested by driving between two pallet detection points that has different pallet models and see which model is locked. If the last pallet model seems to be detected also on the next location, it indicates that the model is not reset between those locations. The old result is reset after there is no detection in number of times set by this parameter: <strong>target_max_n_times_missing</strong> (e.g. start with 100 times missing and decrease if still detect the model from the last symbolic point).</p>
<h3 id="wall-check"><a class="header" href="#wall-check">Wall check</a></h3>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image13.png" alt="" /></p>
<blockquote>
<p>Wall check example shows where the holes and walls are checked.</p>
</blockquote>
<table><thead><tr><th>Parameter</th><th>Values</th><th>Description</th></tr></thead><tbody>
<tr><td>I,pallet_det_wall_check[0],</td><td>0 to 2</td><td></td></tr>
<tr><td>I,pallet_det_wall_check[1], </td><td>0 or 1 </td><td></td></tr>
<tr><td>I,pallet_det_wall_check_points, </td><td>3</td><td>How many points at maximum from the leg are checked in the wall checks, before a decision is made that if there is empty space or not</td></tr>
<tr><td>F,pallet_det_wall_point_dist_threshold,</td><td>0.01, 0.05, 0.20</td><td>Maximum distance (meters) between points, that they are estimated to be linked together in the wall checks</td></tr>
</tbody></table>
<p>There are three modes on the wall check:</p>
<p><em>Mode 1:</em> <strong>pallet_det_wall_check[0] = 1</strong></p>
<p>Check that there is empty space <strong>between</strong> the legs. If the space is not empty, solution is discarded.</p>
<p><em>Mode 2:</em> <strong>pallet_det_wall_check[0] = 2</strong></p>
<p>Check if there is a wall <strong>next</strong> to the legs. If found wall, discard the solution.</p>
<p><em>Mode 3:</em> <strong>pallet_det_wall_check[1] = 1</strong></p>
<p>Additional check that if there are pallets next to each other and the pallet detected is actually <strong>bigger model</strong> than should be (outer legs detected instead of the inner ones)</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image14.png" alt="" /></p>
<blockquote>
<p>Example of wall check. The points circled with red are considered as leg and blue ones are included to the wall check. Here the pallet_det_wall_check_points is 6 and it means that if there are 6 scanner points next to the leg, the wall check will discard that result. The pallet_det_wall_point_dist_threshold is 0.05 so the purple point is too far from the blue points, so it is not included and then the blue ones below doesn't have enough points to be considered as wall.</p>
</blockquote>
<h3 id="search-only-front-legs"><a class="header" href="#search-only-front-legs">Search only front legs</a></h3>
<p>If the rear legs are not visible with the scanner or if they don't match with the pallet model parameters (e.g. the leg shape is not rectangle), it is possible to use only front legs for the detection. There might be also something else on the rear that doesn't give any reasonable results for the algorithm. For example, on the figure down below, the rear legs are different size than the front legs so it does not make sense to try to detect the rear legs.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image15.png" alt="" /></p>
<blockquote>
<p>Example of poor pallet detection scanner data on the rear legs.</p>
</blockquote>
<p>If <strong>pallet_det_2_detect_only_front_legs</strong> is set to 1, the algorithm detects only front legs.</p>
<h3 id="object-detection"><a class="header" href="#object-detection">Object detection</a></h3>
<p>Object detection is a sub feature of pallet detection in which instead of a pallet any group of scanner points that are close to each other and within the search area can be detected as the target. If several groups are found, the closest one is selected as the target.</p>
<p>The downsides of the object detection is that it can detect anything on the route, so the accuracy might vary and that it does not provide the angle of the target. The downsides makes object detection only compatible with docking methods, that do not use the target angle, such as docking with only distance control. </p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>pallet_det_object_det_enabled</td><td>Int</td><td>1</td><td>Enables object detection so that instead of pallets any cluster of scanner points inside the search area is detected as a target. target_detection_type_selection must have value 3 for this parameter to have an effect.</td></tr>
</tbody></table>
<p>As a sub feature of pallet detection many of the parameters affecting pallet detection affect object detection as well with some differences. For example, <strong>pallet_model_width_y[0]</strong> is used to visualize the width of the found target.</p>
<p>Related parameters that can be adjusted:</p>
<ul>
<li><strong>target_detection_min_search_radius</strong></li>
<li><strong>target_detection_type_selection</strong></li>
<li><strong>pallet_det_min_points_close_to_first_point</strong></li>
<li><strong>pallet_det_2_max_dist_to_first_point</strong></li>
<li><strong>pallet_det_use_dynamic_search_ang</strong></li>
<li><strong>pallet_det_limit_initial_search_ang</strong></li>
<li><strong>target_detection_max_dist_to_symbolic_point</strong></li>
</ul>
<h3 id="unwanted-cluster-between-legs"><a class="header" href="#unwanted-cluster-between-legs">Unwanted cluster between legs</a></h3>
<p>The unwanted cluster is a feature that tries to find object between the two-legged pallet on the first row. The main idea is to add cost to model that has something between its legs or to discard that model. On the picture down below is an example case where there are two small pallets next to each other and larger model (the green box) is detected instead. This has been created mainly to avoid detecting large two-legged models, if there are also smaller models. For example, if the picture down below would have large model (the green box) that would fit to the outer legs, but we want to detect only the smaller one this would be useful.</p>
<p>The parameter <strong>pallet_det_2_fitness_cost_percentage_for_unwanted_cluster</strong> defines if the fitness of that result is only decreased by some percentage value or if the model is discarded (negative value) when unwanted cluster is found between the legs.</p>
<p>The parameter <strong>pallet_det_2_min_points_to_create_unwanted_cluster</strong> define how many points is needed between the legs to create cluster. On the
figure down below, the unwanted cluster is circled with red.</p>
<p>The parameter
<strong>pallet_det_2_max_point_diff_for_unwanted_cluster</strong> define the
point difference related to the side legs. The idea is to detect only
similar size clusters as the outer legs.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image16.png" alt="" /></p>
<blockquote>
<p>Unwanted cluster example. The pallet has unwanted cluster (the red circle), between the front legs. Depending on the case, the result can be discarded or the fitness value can be decreased to add more weight to other results.</p>
</blockquote>
<h2 id="target-filtering"><a class="header" href="#target-filtering">Target filtering</a></h2>
<p>Target detection results are filtered, before they are given for route planner to calculate a docking path.</p>
<p>Target detection filtering parameters:</p>
<p><strong>F,target_detection_results_dampening, (0.30 by default)</strong></p>
<p>Dampening value for the results; min = 0.0, max = 1</p>
<p>Filters as a low pass filter, so bigger value means that location is updated faster, lower means more filtering is done</p>
<p><strong>I, target_min_n_times_detected, (20 by default)</strong></p>
<p>Minimum number of times target must be detected successfully before target is approved as found.</p>
<p><strong>I, target_max_n_times_missing, (300 by default)</strong></p>
<p>Maximum number of times last known location of target is given if no target detected</p>
<p>This means that, if the target was detected successfully <strong>target_min_n_times_detected</strong> -times, the algorithm still uses the last known location for route planning, even if the target is not detected in less than <strong>target_max_n_times_missing</strong> -cycles. If target is not detected for larger amount of cycles, it is considered lost.</p>
<h2 id="navitrol-monitor-pallet-detection-form"><a class="header" href="#navitrol-monitor-pallet-detection-form">Navitrol Monitor Pallet Detection form</a></h2>
<p>Navitrol Pallet Detection form can be opened in Navitrol Monitor from the menu Navitrol -&gt; Pallet Detection Form, when the Monitor is connected to an AGV. It can be used for testing and debugging the pallet detection and the docking procedure it should execute.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image43.png" alt="" /></p>
<blockquote>
<p>The pallet detection form in Navitrol Monitor</p>
</blockquote>
<p>All the Navitrol parameters shown on the form can be changed to Navitrol params.txt by changing the value on the field manually and pressing the button 'Upload &amp; Save parameters'. It saves the new parameters and reloads them into use. If the checkbox 'Save new params to file' is unchecked, parameters are only loaded into use for current run, but are not saved to the params.txt. 'Reload current parameters' can be then used to use again the parameters on the params.txt.</p>
<p><strong>Short explanations for the fields shown on the form:</strong></p>
<p><em>Driving to location with pallet det enabled</em></p>
<p>When the end location of the current driving order has the pallet detection enabled from Navithor Tools, this box turns green and shows 1.
Otherwise it is red and 0 and the docking procedure will never start.</p>
<p><em>Pallet detection algorithm started</em></p>
<p>If pallet detection is activated in Navitrol parameters, the AGV is driving into a location with pallet detection enabled and we are close enough to the symbolic point (on default 6 meters), the AGV starts to search for the pallet and this box turns green and shows 1. The algorithm can be also always activated with Navitrol parameters, but
that should be usually used only for debugging purposes.</p>
<p><em>Target found</em></p>
<p>This box turns green and shows 1, when the target is found.</p>
<p><em>Target detected n times</em></p>
<p>Shows how many times in a row the target is properly seen. There is a parameter to limit for how many times the target has to be first send, before the target is locked and docking can be started.</p>
<p>The parameter is shown on the right side:
<strong>target_min_n_times_detected</strong></p>
<p><em>Target missing n times</em></p>
<p>If the target is already locked (the target is seen enough, so that the limit above is fulfilled), the old location for the target is used even if the algorithm doesn't detect the pallet every calculation round. Only after the target is missing for too long time, the docking procedure is cancelled. The parameter for how many times the target can be missing is shown on the right side: <strong>target_max_n_times_missing</strong></p>
<p><em>Distance from scanner to the target</em></p>
<p>Minimum distance from the scanner to the <em>calculated stopping point</em> for the target location to be updated. Scanners usually have more error in close ranges, so this parameter can be used to just use the last known location for the target, after it is closer than the distance specified in <strong>pallet_det_min_dist_from_scanner.</strong></p>
<p><strong>NOTE:</strong> If <strong>target_detection_type_selection</strong> is 3, <strong>pallet_det_2_min_dist_from_nav_point_to_traj_end</strong> is used instead for the same purpose.</p>
<p><em>Docking started</em></p>
<p>The box will stay red until all the 5 restrictions below are met and the docking can be started. After that the box will turn green.</p>
<p><strong>Limits for starting the docking procedure</strong></p>
<p><em>Distance from navigation point to the target stopping point</em></p>
<p>Parameter to change: <strong>docking_max_start_distance</strong></p>
<p><em>Angle difference between symbolic point heading and angle from navigation point to the symbolic point</em></p>
<p>Parameter to change: <strong>docking_max_start_angle</strong></p>
<p><em>Angle difference between symbolic point's and AGV's headings</em></p>
<p>Parameter to change: <strong>docking_max_start_heading</strong></p>
<p><em>Angle difference between target angle and symbolic point's heading</em></p>
<p>Parameter to change: <strong>docking_max_target_angle</strong></p>
<p><em>Distance error between symbolic point and the calculated target stopping point (stopping offset included)</em></p>
<p>Parameter to change: <strong>docking_max_dist_error_from_end_point</strong></p>
<p><strong>Other Navitrol parameters shown on the form:</strong></p>
<p><strong>docking_stop_distance</strong></p>
<p><strong>docking_y_offset</strong></p>
<p><strong>pallet_det_heading_offset (used only with target_detection_type_selection = 2)</strong></p>
<p><strong>docking_dist_gain</strong></p>
<p><strong>docking_heading_gain</strong></p>
<p>Below is shown two example screenshots, how the Pallet Detection Form looks like in Navitrol Monitor and how the target is visualized. In the first screenshot the target is found, but all restrictions for starting the docking procedure are not yet met, so the AGV is not yet correcting its path according to the target found.</p>
<p>On the second screenshot docking is started. The new stopping point is visualized with a blue arrow and the green arrow shows the trajectory, where the AGV is currently trying to correct its path.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image44.png" alt="" /></p>
<blockquote>
<p>Target is detection, but docking is not yet started, because the distance to target is too high, the heading is not within allowed limits and start angle is not within limits.</p>
</blockquote>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image45.png" alt="" /></p>
<blockquote>
<p>Docking procedure started when the start conditions are met.</p>
</blockquote>
<h2 id="troubleshoot"><a class="header" href="#troubleshoot">Troubleshoot</a></h2>
<p>This chapter introduces some issues that customer might face with pallet detection or docking and how to resolve them.</p>
<h3 id="pallet-detection-is-not-started-when-driving-to-symbolic-point"><a class="header" href="#pallet-detection-is-not-started-when-driving-to-symbolic-point">Pallet detection is not started when driving to symbolic point</a></h3>
<p>When driving to Symbolic point, there is <strong>no green box</strong> on the Monitor or Client that indicates that pallet has been found. There might be several reasons, but here are the most common ones.</p>
<h3 id="tag-missing"><a class="header" href="#tag-missing">Tag missing</a></h3>
<p><strong>Problem</strong>: In this case, there is no warning or error, because the pallet detection or docking is not activated.</p>
<p><strong>What to do</strong>: Check that the symbolic point has pallet detection tag on Tools.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image5.png" alt="" /></p>
<blockquote>
<p>Pallet detection tag for symbolic point on Tools.</p>
</blockquote>
<h3 id="target-detection-not-enabled"><a class="header" href="#target-detection-not-enabled">Target detection not enabled</a></h3>
<p><strong>Problem:</strong> On this case, there is no error or warning, because the feature is not enabled. Even if there is the pallet detection tag.</p>
<p><strong>What to do:</strong> Check that <strong>target_detection_type_selection</strong> has 2 or 3.</p>
<h3 id="closest-point-not-found"><a class="header" href="#closest-point-not-found">Closest point not found</a></h3>
<p><strong>Problem:</strong> The AGV stops with TARGET_APPROACH_ERROR and on the log just before this error there is a line &quot;<em>Pallet detection ERROR: Closest point for lin mod</em>&quot; or &quot;<em>Pallet det: Closest point for legs not found.</em>&quot;</p>
<p><strong>What to do:</strong></p>
<ul>
<li>If <strong>pallet_det_use_dynamic_search_ang</strong> is set to 1, check that <strong>pallet_det_2_initial_search_model_width_add</strong> has large enough value. It is used to calculate the search area for the closest point.</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image46.png" alt="" /></p>
<blockquote>
<p>Dynamic search angle calculation for two-legged and three-legged pallet. It is calculated based on distance to target and model width +  pallet_det_2_initial_search_model_width_add parameter.</p>
</blockquote>
<ul>
<li>
<p>If <strong>pallet_det_use_dynamic_search_ang</strong> is set to 0, check that <strong>pallet_det_limit_initial_search_ang</strong> has large enough search angle.</p>
</li>
<li>
<p>Check that <strong>pallet_det_min_points_close_to_first_point</strong> has smaller value than scanner points in the smallest cluster on the front row.</p>
</li>
</ul>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image47.png" alt="" /></p>
<blockquote>
<p>The middle leg has only two scanner points and the value for the pallet_det_min_points_close_to_first_point parameter was 2.
Meaning that there should be total of three points in a distance of pallet_det_2_max_dist_to_first_point.</p>
</blockquote>
<h3 id="scanner-points-are-discarded"><a class="header" href="#scanner-points-are-discarded">Scanner points are discarded</a></h3>
<p><strong>Problem:</strong> If <strong>target_detection_type_selection</strong> is 3, the parameter <strong>pallet_det_min_dist_from_scanner</strong> is used to discard scanner points that are too close to the scanner. One indication for this case is on the log print where the pallet detection is started. If there is this kind of log print: &quot;<em>Starting pallet det v2 algorithm, pointsnbr 0</em>&quot;, it means that there are no scanner points for the algorithm.</p>
<p><strong>What to do:</strong> Set this <strong>pallet_det_min_dist_from_scanner</strong> parameter to small value, so it doesn't discard points in too far distance.</p>
<h3 id="pallet-model-parameters-are-incorrect"><a class="header" href="#pallet-model-parameters-are-incorrect">Pallet model parameters are incorrect</a></h3>
<p><strong>Problem:</strong> The model is not found, because the width and length are incorrect or the number of legs is not correct. In many cases it is better to verify the actual leg size and pallet width from Monitor (using the Measurement tape button on the top bar), because the sizes depend on the scanner resolution and the distance. The longer the distance to the target, the less accurate scanner data is, because of the scanner resolution.</p>
<p>The <strong>pallet_model_width_y</strong> parameters is always the front side where the AGV is approaching to the pallet and <strong>pallet_model_length_x</strong> is the side. For example, when picking the EUR-pallet from normal direction, the width is 0.8 m and the length is 1.2 m. If this same EUR-pallet can be picked up from the side (approaching from the 1.2 m side), then there has to be other model that defines its dimensions. Then that model width is 1.2 m and length is 0.8 m. Also, the leg dimensions have to be set accordingly.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image48.png" alt="" /></p>
<blockquote>
<p>Here the pallet dimensions are same, but there has to be different model based on approaching direction.</p>
</blockquote>
<p><strong>What to do:</strong> Check Chapter 5 to verify that the model parameters are okay in general.</p>
<h3 id="pallet-detected-in-wrong-location"><a class="header" href="#pallet-detected-in-wrong-location">Pallet detected in wrong location</a></h3>
<h4 id="pallet-is-too-much-on-the-side"><a class="header" href="#pallet-is-too-much-on-the-side">Pallet is too much on the side</a></h4>
<p><strong>Problem</strong>: There are several pallets next to each other. The pallet is found too much to the side, based on the pallet next to the desired one.</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image49.png" alt="" /></p>
<blockquote>
<p>Pallet detected on side. The desired result is the two-legged one close to the symbolic point.</p>
</blockquote>
<p><strong>What to do:</strong> Decrease <strong>pallet_det_2_initial_search_model_width_add</strong> to decrease the search area or decrease <strong>pallet_det_2_max_dist_to_route</strong> to discard pallets that are found too far from the route.</p>
<h3 id="pallet-angle-changes-during-drive"><a class="header" href="#pallet-angle-changes-during-drive">Pallet angle changes during drive</a></h3>
<p><strong>Problem:</strong> AGV drives towards the pallet, but the target angle changes suddenly. This causes AGV to turn off the route, because it will try to reach the changed target. On the three example pictures down below, the scanner sees first the stringer board, then some part between the legs and the stringer board and finally the legs of the pallet. The main problem here is that the scanner is lifted during the docking procedure.
In general, during the pallet detection, the scanner should only see points that can be detected as a pallet (for example not the floor in front of the pallet).</p>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image50.png" alt="" /></p>
<blockquote>
<p>Pallet is seen from the stringer board. Docking is not started yet.</p>
</blockquote>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image51.png" alt="" /></p>
<blockquote>
<p>Pallet is seen a bit below the stringer board or the scanner sees something below the pallet. This part of the pallet is not very reasonable for the detection and causes wrong angle. The docking is started based on this detection.</p>
</blockquote>
<p><img src="TargetAndObstacleDetection/PalletDetection/./media-en/image52.png" alt="" /></p>
<blockquote>
<p>Pallet is seen from the legs.</p>
</blockquote>
<p><strong>What to do:</strong></p>
<ul>
<li>
<p>Change the <strong>docking_start_distance</strong> so the docking starts only after the pallet is detected correctly.</p>
</li>
<li>
<p>Check tilt of the scanner. The scanner should see only the legs or the stringer board of the pallet.</p>
</li>
<li>
<p>Decrease <strong>pallet_det_2_max_pallet_angle_error</strong> to discard pallets that have too high angle error.</p>
</li>
</ul>
<h2 id="most-common-parameters"><a class="header" href="#most-common-parameters">Most common parameters</a></h2>
<p>This list includes most commonly used parameters that are often changed in normal use. On this list there are three values for each parameter:
min, default and max. If there is only one value, that is the default value. If the parameter is not set on the params.txt file, the default value is used. The first letter states the type of the parameter (I = Integer, F = Float, S = String).</p>
<h3 id="target-detection-parameters-1"><a class="header" href="#target-detection-parameters-1">Target detection parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,target_detection_type_selection, 0, 0, 5</strong></td><td>Enables reflector-based docking or pallet detection, 0 = disabled, 1 = reflector docking, 2 = pallet detection, 3 = pallet detection v2, 4 = external target detection, 5 = supervisor controlled;</td></tr>
<tr><td><strong>I,target_detection_scan_selection, 0, 1, 5</strong></td><td>Defines which scanners are used for target detection: 0 = enable target_detection_multi_scan_selection, 1 = rear scanner only, 2 = front scanner only, 3 = both scanners (supported only in reflector-based detection!), 4 = use scanner in driving direction, 5 = alternate between scanners target_detection_multi_scan_selection is used only when target_detection_scan_selection is 0!</td></tr>
<tr><td><strong>I,target_detection_multi_scan_selection[Indexes 0-3], 0, 0, 8</strong></td><td>Indexes: 0=rear, 1=front, 2=meas0, 3=meas1. 1 = use as only scanner, 2 = together with others (all at once), 3 = alternating with other as primary, 4 = alternating with other as secondary, 5 = use when driving forwards, 6 = use when driving backwards, 7 = use when driving transversal right, 8 = use when driving transversal left</td></tr>
<tr><td><strong>I,target_detection_always_enabled, 0, 0, 1</strong></td><td>1 = Enables target detection algorithm always. Note! Should be used only for initial test or calibration and disabled after that! 0 = detect target only when close to target detection tagged symbolic point.</td></tr>
<tr><td><strong>F,target_detection_max_dist_to_symbolic_point, 6.0</strong></td><td>Max distance to the end point to start the algorithm</td></tr>
<tr><td><strong>F,target_detection_maximum_iterations, 1, 10, 50</strong></td><td>The maximum number of target detection iterations before responding to target detection query</td></tr>
<tr><td><strong>F,target_detection_min_search_radius, 0, 0, 100</strong></td><td>Defines the minimum search radius around the expected target location, such as symbolic point, from which the target is searched. </br>For pallet detection see also model widths and pallet_det_2_initial_search_model_width_add parameter.</br>For reflector detection see also docking_max_dist_error_from_end_point.</td></tr>
</tbody></table>
<h4 id="docking-parameters"><a class="header" href="#docking-parameters">Docking parameters</a></h4>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,docking_to_target_enabled, 0, 0, 2</strong></td><td>1 = Enables docking to target. 2 = docking with custom route. If target_detection_type_selection == 0, won't do anything</td></tr>
<tr><td><strong>F,docking_max_start_distance, 3.5</strong></td><td>Beyond maximum distance docking won't be triggered</td></tr>
<tr><td><strong>F,docking_max_start_angle, 15.0</strong></td><td>Max angle difference from navigation point to the target compared to trajectory's end point's heading, when starting to dock [-degrees fov]</td></tr>
<tr><td><strong>F,docking_max_start_heading, 5.0</strong></td><td>Max angle diff for vehicle heading and trajectory's end point heading, when starting to dock [+-degrees fov]</td></tr>
<tr><td><strong>F,docking_max_dist_error_from_end_point, 0.5</strong></td><td>Maximum distance difference for the stopping point compared to the symbolic point</td></tr>
<tr><td><strong>F,docking_max_target_angle, 15.0</strong></td><td>Maximum difference between target and end point's headings</td></tr>
<tr><td><strong>F,docking_stop_distance, 0.50</strong></td><td>Defines how close to the target vehicle tries to drive (calculated from navigation point to target)</td></tr>
<tr><td><strong>F,docking_y_offset, 0.0</strong></td><td>Offset in y-coordinate for docking (in machine coordinates)</td></tr>
<tr><td><strong>F,docking_approach_dist, 1.25</strong></td><td>When approaching target closer than this distance, vehicle stops if the approach error is too big</td></tr>
<tr><td><strong>F,docking_dist_gain, 1.0</strong></td><td>Dist gain while docking, 0 = use pc_pid_dist_p</td></tr>
<tr><td><strong>F,docking_heading_gain, 1.0</strong></td><td>Heading gain while docking, 0 = use pc_pid_heading_p</td></tr>
<tr><td><strong>I,docking_ref_v_source, 0, 0, 2</strong></td><td>Speed source when doing docking, 0 = calculated from distance to target, 1 = using route velocity value, 2 = use fixed parameter docking_speed</td></tr>
<tr><td><strong>F, docking_speed, 0.3</strong></td><td>Speed while docking, if docking_ref_v_source == 2. If it is 0, this is minimum starting speed for the docking drive.</td></tr>
<tr><td><strong>I,docking_leave_unload_loc_straight, 0</strong></td><td>Limit curvature after unload if set to 1</td></tr>
<tr><td><strong>F,docking_leave_unload_loc_straight_dist, 1.0</strong></td><td>Limit curvature after unload if set to 1</td></tr>
</tbody></table>
<p><em><strong>// Docking with custom route. docking_to_target_enabled = 2</strong></em></p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,docking_control_point_1_dist_from_machine, 0.0, 0.20, 10.0</strong></td><td>Minimum distance for the node straight to the AGV heading.</td></tr>
<tr><td><strong>F,docking_control_point_2_dist_from_target, 0.0, 0.80, 10.0</strong></td><td>Distance for the node to create straight route before target.</td></tr>
<tr><td><strong>I,docking_allow_custom_route_update, 0, 0, 1</strong></td><td>0 = custom route is locked after it is created, 1 = custom route is updated if the target changes.</td></tr>
<tr><td><strong>F,docking_custom_route_min_xy_diff, -1.0, 0.02, 0.50</strong></td><td>Minimum distance difference (in meters) between the old pallet and the new to update the last part of the custom route. If set to positive, custom route is updated. Also uses target_detection_max_diff_in_xy_results to check that the difference is not too large.</td></tr>
<tr><td><strong>F,docking_custom_route_min_angle_diff, -1.0, 2.0, 20.0</strong></td><td>Minimum angle difference (in degrees) between the old pallet and the new to update the last part of the custom route. If set to positive, custom route is updated. Also uses target_detection_max_diff_in_angle_results to check that the difference is not too large.</td></tr>
<tr><td><strong>F,docking_custom_route_max_allowed_xy_diff_for_target, 0.0, 0.2, 1.0</strong></td><td>Maximum limit (in meters) for the custom route update related to the initial target. The custom route is not updated if the new target is further away than this parameter from the initial target (target location when the custom route is created for the first time).</td></tr>
</tbody></table>
<h3 id="pallet-model-parameters-1"><a class="header" href="#pallet-model-parameters-1">Pallet model parameters</a></h3>
<p>These parameters define the pallet model we are searching for. These are array parameters and the maximum number of models is 5 (indexes from 0 to 4).
Example set for EUR-pallet can be found from Chapter 5</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,pallet_model_enabled[index], -1</strong></td><td>0 = pallet model is currently not used for detection, 1 = model enabled</td></tr>
<tr><td><strong>S,pallet_model_description[index], &quot;&quot;</strong></td><td>Description of the pallet (for example 'EUR-pallet')</td></tr>
<tr><td><strong>F,pallet_model_width_y[index], 0.0</strong></td><td>Total width of the pallet (measured from stringer board)</td></tr>
<tr><td><strong>F,pallet_model_length_x[index], 0.0</strong></td><td>Total length of the pallet</td></tr>
<tr><td><strong>I,pallet_model_n_legs_x[index], 0</strong></td><td>Number of legs (2 or 3) in X-direction (lengthwise)</td></tr>
<tr><td><strong>I,pallet_model_n_legs_y[index], 0</strong></td><td>Number of legs (2 or 3) in Y-direction (widthwise)</td></tr>
<tr><td><strong>F,pallet_model_mid_leg_width_y[index], 0.0</strong></td><td>Width (y-dimension) of the legs in middle column</td></tr>
<tr><td><strong>F,pallet_model_mid_leg_length_x[index], 0.0</strong></td><td>Length (x-dimension) of the legs in middle column</td></tr>
<tr><td><strong>F,pallet_model_side_leg_width_y[index], 0.0</strong></td><td>Width (y-dimension) of the legs on both side columns</td></tr>
<tr><td><strong>F,pallet_model_side_leg_length_x[index], 0.0</strong></td><td>Length (x-dimension) of the legs on both side columns</td></tr>
</tbody></table>
<h3 id="pallet-detection-parameters-2"><a class="header" href="#pallet-detection-parameters-2">Pallet detection parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,pallet_det_linear_models_enabled, 0, 1, 1</strong></td><td>Enables pallet detection from stringer board (top part of the pallet), which can be seen as a line</td></tr>
<tr><td><strong>I,pallet_det_min_points_in_cluster[index from 0 to 1], 5</strong></td><td>Minimum num of meas points in leg, second limit for a smaller leg, recommended values 5 for first and 4 for second</td></tr>
<tr><td><strong>F,pallet_det_linear_model_max_err, 0.001, 0.07, 0.25</strong></td><td>Maximum difference (in meters) between the found line model and width of the pallet model for solution to be accepted</td></tr>
<tr><td><strong>F,pallet_det_min_dist_from_scanner, 0.00, 0.20, 5.00</strong></td><td>Minimum distance from scanner to pallet that pallet position is updated (on ver2, the scanner points that are closer than this parameter are discarded)</td></tr>
<tr><td><strong>F,pallet_det_2_min_dist_from_nav_point_to_traj_end, 0.00, 0.50, 25.0</strong></td><td>Minimum distance from navigation point to trajectory end that pallet position is still updated. This parameter is ignored, if model specific distances are defined.</td></tr>
<tr><td><strong>F,pallet_det_2_initial_search_model_width_add, -0.50, 0.50, 2.00</strong></td><td>Increase the search area by adding this value to the model width.</td></tr>
<tr><td><strong>I,pallet_det_2_detect_only_front_legs, 0, 0, 1</strong></td><td>If set to 1, algorithm detects only first legs and calculates target position based on this. Sometimes increases accuracy, because front legs are seen most accurately.</td></tr>
<tr><td><strong>F,pallet_det_2_max_dist_to_route, 0.0, 0.2, 2.0</strong></td><td>Maximum distance to the route (line that is aligned to the route heading). Calculated from the pallet center. If the pallet is found further that this parameter, that result is discarded.</td></tr>
<tr><td><strong>F,pallet_det_maximum_target_pose_error,  0.05, 0.2, 3.0</strong></td><td>Maximum target distance deviation between estimated centre point and target. Applicable to supervisor target detection.</td></tr>
</tbody></table>
<h2 id="advanced-parameters"><a class="header" href="#advanced-parameters">Advanced parameters</a></h2>
<p>This list includes more advanced parameters that are not necessarily needed in normal use.</p>
<p><strong>NOTE!</strong> If need to change some of these parameters, make sure to understand what these parameters do or contact Navitec for more information.</p>
<p>On this list there are three values for each parameter: min, default and max. If there is only one value, that is the default value. If the parameter is not set on the params.txt file, the default value is used. The first letter states the type of the parameter (I = Integer, F = Float, S = String).</p>
<h3 id="target-detection-parameters-2"><a class="header" href="#target-detection-parameters-2">Target detection parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,target_detection_results_dampening, 0.0, 0.3, 1.0</strong></td><td>Dampening value for the results</td></tr>
<tr><td><strong>F,target_detection_max_diff_in_xy_results, 0.20</strong></td><td>How much difference (meters) is allowed in xy-location before the new result is updated without dampening</td></tr>
<tr><td><strong>F,target_detection_max_diff_in_angle_results, 5.0</strong></td><td>How much difference (degrees) is allowed in angle before the new result is updated without dampening</td></tr>
<tr><td><strong>I,target_min_n_times_detected, 20</strong></td><td>Minimum number of times target must be detected before giving results</td></tr>
<tr><td><strong>I,target_max_n_times_missing, 300</strong></td><td>Max num of times last known location for target is given if no target detected; min = 0</td></tr>
<tr><td><strong>I,target_detection_supervisor_update_message_enabled, 0, 1, 2</strong></td><td>0 = Disabled, 1 = Use message 4101, 2 = Use message 4104 (contains more info)</td></tr>
</tbody></table>
<h3 id="docking-parameters-1"><a class="header" href="#docking-parameters-1">Docking parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,docking_approach_max_dist_err, 0.10</strong></td><td>If distance between reference and navigation point is bigger than this in approach area, vehicle stops</td></tr>
<tr><td><strong>F,docking_approach_max_h_err, 5.0</strong></td><td>If heading error between reference and AGV heading is bigger than this (degrees) in approach area, vehicle stops</td></tr>
<tr><td><strong>F,docking_limit_curv_on_leave, 0.05</strong></td><td>Limit curvature on leave (approach distance)</td></tr>
<tr><td><strong>F,docking_small_gains_dist, 0.50</strong></td><td>The distance to limit curvature on approach</td></tr>
<tr><td><strong>F,docking_limit_corr_dist, 0.50</strong></td><td>The distance before stopping which is driven only with odometry (docking_max_xy_corr and docking_max_h_corr used instead of normal gains)</td></tr>
<tr><td><strong>I,docking_small_gains, 1</strong></td><td>Limit curvature on approach</td></tr>
<tr><td><strong>F,docking_max_xy_corr, 0.0001</strong></td><td>Max loc xy corr while approaching target</td></tr>
<tr><td><strong>F,docking_max_h_corr, 0.003</strong></td><td>Max loc h corr while approaching target</td></tr>
<tr><td><strong>F,docking_limit_curv_on_approach, 0.1</strong></td><td>Limit curvature on approach after small gains dist</td></tr>
<tr><td><strong>F,docking_limit_leave_speed, 0.0, 0.2, 1.0</strong></td><td>Limit speed while driving out from docking location, if docking_limit_leave_speed_and_actuator_height_dist &gt; 0. If it is below 0, speed is not limited.</td></tr>
<tr><td><strong>F,docking_limit_leave_speed_and_actuator_height_dist, -2.0, -1.0, 20.0</strong></td><td>Distance from the unload location, where the speed and fork height is limited to the actuator_min_val. If negative, they are not limited. If enabled, had to be smaller than docking_mode_to_fleet_control_dist parameter.</td></tr>
<tr><td><strong>F,docking_mode_to_fleet_control_dist, 2.5</strong></td><td>Inform fleet control of docking mode after leaving the location</td></tr>
<tr><td><strong>F,docking_notify_approach_dist, 0.50</strong></td><td>Distance from docking target when a notification is sent to the AGV control</td></tr>
<tr><td><strong>I,docking_stopping_point_offset_mode, 0, 0, 1</strong></td><td>0 = Use general stopping offsets, 1 = offsets are defined individually for each pallet model with parameters</td></tr>
<tr><td><strong>I,docking_follow_route_properties, 0, 1, 1</strong></td><td>Use defined properties on the route while docking to target</td></tr>
<tr><td><strong>F,docking_refpoint_max_err, -1.0, -0.5, 10.0</strong></td><td>Max error (in m) for the docking point after started docking. Indicate pushing pallet. If negative, not used.</td></tr>
</tbody></table>
<p><em><strong>// P-controller These are array parameters with indexes from 0 to 2.</strong></em></p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,pc_pid_docking_dist_limit[index], 0.0</strong></td><td>Change PID settings after the distance to docking target is smaller than given here (0.0 == disabled)</td></tr>
<tr><td><strong>F,pc_pid_docking_dist_p[index], 0.0, 0.0, 100.0</strong></td><td>distance gain</td></tr>
<tr><td><strong>F,pc_pid_docking_heading_p[index], 0.0, 0.0, 100.0</strong></td><td>heading gain</td></tr>
</tbody></table>
<h3 id="pallet-model-parameters-2"><a class="header" href="#pallet-model-parameters-2">Pallet model parameters</a></h3>
<p>These parameters define the pallet model we are searching for. These are array parameters and the maximum number of models is 5 (indexes from 0 to 4).
Example set for EUR-pallet can be found from Chapter 5</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,pallet_model_y_offset[index], 0.0</strong></td><td>Offset in y-coordinate for docking (in machine coordinates)</td></tr>
<tr><td><strong>F,pallet_model_stop_distance[index], 0.0</strong></td><td>Defines how close to the target vehicle tries to drive (calculated from navigation point to target)</td></tr>
<tr><td><strong>F,pallet_model_min_dist_from_nav_point_to_traj_end[index], -1.0</strong></td><td>Model specific minimum distance from navigation point to trajectory end that pallet position is still updated. -1.0 = disabled and the generic parameter pallet_det_2_min_dist_from_nav_point_to_traj_end is used instead.</td></tr>
<tr><td><strong>I,pallet_model_discard_outlier_points[index], 0, 0, 1</strong></td><td>Discard outlier points on leg cluster. Uses average distance on cluster to detect outliers. Might be useful if the leg length is small and there are no points to see on the side.</td></tr>
</tbody></table>
<h3 id="pallet-detection-parameters-3"><a class="header" href="#pallet-detection-parameters-3">Pallet detection parameters</a></h3>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>F,pallet_det_lin_mod_point_threshold, 0.01, 0.07, 0.20</strong></td><td>Max distance between points (meters), when detecting a pallet from stringer board</td></tr>
<tr><td><strong>F,pallet_det_limit_initial_search_ang, 5.0, 20.0, 135.0</strong></td><td>Limits the search field of view in front of the scanner for the first leg (+-degrees)</td></tr>
<tr><td><strong>I,pallet_det_use_dynamic_search_ang, 0, 1, 1</strong></td><td>If set to 1, algorithm dynamically makes the search fov bigger, if the target to be detected is closer and vice versa.</td></tr>
<tr><td><strong>F,pallet_det_limit_search_space, 0.30, 3.00, 10.0</strong></td><td>Limits the searching space in front of the laser scanner. Maximum distance (meters) sideways for points to be  considered for pallet.</td></tr>
<tr><td><strong>F,pallet_det_first_leg_ang_weight, 0.10, 0.75, 5.00</strong></td><td>The two factors deciding the location for the first leg of the pallet we try to detect are angle and distance compared to the expected location. If parameter is bigger, having small angle errors is more important than distance error.</td></tr>
<tr><td><strong>F,pallet_det_point_filter_dist, 0.02, 0.10, 0.30</strong></td><td>Filters all the points away from calculations, which don't have any close neighbors within this (meters)</td></tr>
<tr><td><strong>F,pallet_det_leg_dist_err, 0.2, 0.5, 2.0</strong></td><td>Scales how much error is allowed for the points in the side legs (measured from the supposed center points). Allowed distance error is this parameter multiplied with pallet leg width, so the dimensions of the model also affect the result.</td></tr>
<tr><td><strong>F,pallet_det_leg_dist_err_back, 0.01, 0.07, 0.15</strong></td><td>How much distance error (meters) is allowed for points in clusters behind the first row</td></tr>
<tr><td><strong>F,pallet_det_leg_ang_err, 1.0, 7.0, 15.0</strong></td><td>How many degrees of error is allowed for individual points in the first row of legs</td></tr>
<tr><td><strong>F,pallet_det_leg_ang_err_back, 0.5, 2.5, 10.0</strong></td><td>After detecting the legs and correcting the cluster locations, how many degrees of errors is allowed for the cluster location compared to expected for the legs behind the first row to be valid.</td></tr>
<tr><td><strong>F,pallet_det_max_leg_dist_err, 0.01, 0.07, 0.20</strong></td><td>How many meters of distance error is allowed for the cluster locations compared to expected in the first row of legs for the whole solution to be valid. If error is bigger, solution is not accepted at all.</td></tr>
<tr><td><strong>F,pallet_det_max_leg_ang_err, 1.0, 7.0, 15.0</strong></td><td>How many degrees of error is allowed for the cluster locations compared to expected in the first row of legs for the whole solution to be valid. If error is bigger, solution is not accepted at all.</td></tr>
<tr><td><strong>I,pallet_det_wall_check[index from 0 to 1], 0</strong></td><td>Enable wall checks, can be 0, 1 or 2, recommended values 1 for first and 0 for second. Depending on the mode, the algorithm discards the solution, if between the legs the holes are not seen, or if on the sides of the legs it looks like there is a wall instead of empty space.</td></tr>
<tr><td><strong>I,pallet_det_wall_check_points, 1, 6, 100</strong></td><td>Affects how many points at maximum from the leg are checked in the wall checks, before a decision is made that if there is empty space or not</td></tr>
<tr><td><strong>F,pallet_det_wall_point_dist_threshold, 0.01, 0.05, 0.20</strong></td><td>Maximum distance (meters) between points, that they are estimated to be linked together in the wall checks</td></tr>
<tr><td><strong>I,pallet_det_new_validity_check, 0, 1, 1</strong></td><td>New check for pallet validity. Pallet model is discarded if at least validity_check_discard_ratio of points is further away than pallet_det_wall_point_dist_threshold * 10</td></tr>
<tr><td><strong>F,pallet_det_new_validity_check_min_discard_ratio, 0.0, 0.3, 1.0</strong></td><td>How many outlier points are required before pallet model is discarded</td></tr>
<tr><td><strong>I,pallet_det_correction_recursion_enabled, 0, 1, 1</strong></td><td>If set to 1, if cluster correction algorithm doesn't find points that could be used for correcting the location, the function can be called recursively (for max 10 times) with a wider search angle. If 0, the search angles are always fixed and wider.</td></tr>
<tr><td><strong>F,pallet_det_cluster_correction_angle_offset, -45.0, 0.0, 45.0</strong></td><td>On default no offset given, but if the shape of the leg requires this (some non-standard non-square shape). Changing off the offset requires in most case testing with different values to see how it exactly behaves, so no clear instructions can't be given for how to use it.</td></tr>
<tr><td><strong>I,pallet_det_cluster_corr_mode, 0, 0, 1</strong></td><td>On default setting of 0 tries to correct X- and Y- directions independently. On 1, tries to check point's only on the nearest corner to the scanner and corrects both directions based on this.</td></tr>
<tr><td><strong>F,pallet_det_y_corr_threshold_ang, 0.0, 4.0, 15.0</strong></td><td>If the angle difference from laser to the leg compared to leg heading is really small (smaller than this parameter), we don't really see either side of the leg so it's better to just calculate an average of the Y-direction.</td></tr>
<tr><td><strong>I,pallet_det_cluster_corr_min_points, 1, 1, 20</strong></td><td>Minimum number of points used when correcting pallet legs. If 0 points found, making a correction is not possible. If there is a lot of variance and noise in individual points, should be set higher than 1.</td></tr>
<tr><td><strong>F,pallet_det_cluster_dist[index from 0 to 2], 0.90</strong></td><td>Distance check multiplier for leg points in first row of legs</td></tr>
<tr><td><strong>F,pallet_det_front_row_weight, 0.5, 3.0, 15.0</strong></td><td>How much weight is given for the front row of legs compared to other legs, when calculating the final result of XYH for pallet. Front row is usually seen more accurately, so on default it has more weight.</td></tr>
<tr><td><strong>F,pallet_det_fitness_weight[index from 0 to 7], 1.0</strong></td><td>Array to change weight of the different parts for how good a solution is considered to be, if several are found (bigger scale means bigger weight). <br> Fit0 is the first found leg on the middle? fit1 how many legs found in the first row? fit2 number of legs in the back rows, solutions with more found legs are preferred. fit3 the difference between center of the pallet compared to the expected location. fit4 angle of the target compared to the expected (symbolic point heading basically). fit5 cluster width compared to model leg width. fit6 cluster outer distance compared to model width. fit7 is for determining the heading ambiguity of asymmetric pallets.</td></tr>
<tr><td><strong>I,pallet_det_allow_only_middle_leg, 0, 0, 1</strong></td><td>If set to 1, accept only solutions for 3-leg pallets, where the closest leg to a line drawn from the navigation point towards the direction of the scanner (straight fw or bw) is the middle leg instead of a side leg</td></tr>
<tr><td><strong>F,pallet_det_split_threshold, 0.02, 0.06, 0.50</strong></td><td>Used for deciding, if one cluster should be splitted into separate clusters. A line is calculated between start and end point and then the distance of cluster points is compared to this line. If there is a point with longer distance from the line defined by this parameter (in meters), cluster is splitted.</td></tr>
<tr><td><strong>I,pallet_det_min_points_close_to_first_point, 1, 3, 50</strong></td><td>Min number of points next to the first point we are searching for.</td></tr>
<tr><td><strong>F,pallet_det_heading_offset, -45.0, 0.0, 45.0</strong></td><td>Heading offset in degrees added to the target angle. Used only with target_detection_type_selection = 2.</td></tr>
<tr><td><strong>F,pallet_det_2_max_dist_to_first_point, 0.01, 0.05, 0.30</strong></td><td>Max difference between consecutive closest points.</td></tr>
<tr><td><strong>I,pallet_det_2_cluster_only_based_on_distance_and_index, 0, 0, 1,</strong></td><td>Create clusters based on distance between points (pallet_det_lin_mod_point_threshold) and index.</td></tr>
<tr><td><strong>F,pallet_det_2_min_leg_cluster_coverage, 0.0, 0.7, 1.0</strong></td><td>Minimum average percentage for legs to cover the cluster. If the percentage is lower, that model is discarded. Uses fit5 value as the percentage. Used only if pallet_det_2_cluster_only_based_on_distance_and_index is set to 1</td></tr>
<tr><td><strong>F,pallet_det_2_max_pallet_width_error, 0.0, 0.2, 5.0</strong></td><td>Maximum error between pallet width compared to side legs outer distance (in meters). If the error is higher, that model is discarded. Uses fit6 value as the error. Used only if pallet_det_2_cluster_only_based_on_distance_and_index is set to 1</td></tr>
<tr><td><strong>F,pallet_det_2_fitness_cost_percentage_for_unwanted_cluster, -1.0, 0.8, 1.0</strong></td><td>Percentage cost for the total fitness if found cluster between the side legs. Used only with two-legged pallets and only on the front row. If set to negative, discards the model.</td></tr>
<tr><td><strong>I,pallet_det_2_min_points_to_create_unwanted_cluster, 0, 4, 30</strong></td><td>How many scanner points are required between the side legs to try creating unwanted cluster.</td></tr>
<tr><td><strong>I,pallet_det_2_max_point_diff_for_unwanted_cluster, 0, 4, 30</strong></td><td>How many points less are needed on the cluster on the middle related to the amount on the side legs. Used to find only similar size cluster as the side legs.</td></tr>
<tr><td><strong>F,pallet_det_2_max_pallet_angle_error, 0.00, 30.00, 360.00</strong></td><td>Maximum angle (in degrees) for the pallet related to the symbolic point heading.</td></tr>
<tr><td><strong>F,pallet_det_2_max_error_for_outlier_point, 0.0, 1.4, 5.0</strong></td><td>Maximum error allowed for outlier points. Used to discard points from cluster if pallet_model_discard_outlier_points is enabled.</td></tr>
<tr><td><strong>I,pallet_det_2_lock_model_if_found_enough_times, 0, 10, 1000</strong></td><td>How many times same model is required to detect in a row before searching only that model. Cause issues if last pallet model is not reset between consecutive pallet detections (if target_max_n_times_missing is too high, the last pallet is not reset)</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="3d-load-detection"><a class="header" href="#3d-load-detection">3D Load detection</a></h1>
<p>Updated 15.07.2024</p>
<hr />
<h2 id="overview-37"><a class="header" href="#overview-37">Overview</a></h2>
<h3 id="introduction-52"><a class="header" href="#introduction-52">Introduction</a></h3>
<p>The feature performs load detection with a 3D camera, enabling a better overall view of the load. The 3D load detection estimates object pose by matching 3D sensor data with CAD models. The feature allows for accurate pose estimation of single as well as several stacked objects. The feature can also be used for empty space detection, which means searching for an empty space in a rack or ground for unloading. A license is required for this feature.</p>
<h3 id="requirements-26"><a class="header" href="#requirements-26">Requirements</a></h3>
<ul>
<li>A 3D camera providing XYZI values</li>
<li>The pose of the camera w.r.t. the navigation point is known (x,y,z,roll,pitch,yaw)</li>
<li>Third party licenses installed</li>
<li>Load CAD file (.stl) -- Z-axis is pointing upwards</li>
<li>Debian Buster or Bullseye</li>
</ul>
<h3 id="limitations-23"><a class="header" href="#limitations-23">Limitations</a></h3>
<ul>
<li>The computing time differs on the scene, the 3D camera, and how many objects of interest are stacked but the detection takes approximately 200 to 350 milliseconds, including data acquisition.</li>
<li>The field-of-view of a 3D camera is limited in comparison to 2D range scanners, normally 40-60 deg</li>
<li>Incompatible with 2D load detection </li>
<li>Maximum of three different pallet models supported at the same system. See ModelIndex.</li>
<li>Maximum of four different 3D sensors supported at the same system. See SensorIndex.</li>
</ul>
<h2 id="setup-24"><a class="header" href="#setup-24">Setup</a></h2>
<h3 id="quick-start-14"><a class="header" href="#quick-start-14">Quick start</a></h3>
<p>The symbolic point is defined as load or unload, with option <em>Enable load detection</em> in Tools.</p>
<p>Transfer the third party libraries folder <em>dependencies.7z</em> to the IPC. Unzip the folder.<br />
<code>cd dependencies</code><br />
<code>dpkg -i *</code><br />
<code>apt-get install xvfb</code></p>
<p>Add to the startNavitrol.sh to the end of the file, the following line to create a virtual screen to allow rendering the partial views<br />
<code>nano startNavitrol.sh</code> in <code>/home/navitec</code><br />
copy-paste in:<br />
<code>Xvfb :99 -screen 0 1024x768x24 &gt; /dev/null 2&gt;&amp;1 &amp;</code></p>
<p>Set the required parameters prior to generating partial views. Uploading the CAD file creates offline a database of 2.5D rendered partial views. The generated files are saved as .ply and .txt in folder <code>/home/navitec/poses</code>, and .bin and .idx in folder <code>/home/navitec</code>. Upload the CAD file to the IPC by pressing <code>Upload to Navitrol</code> in Navitrol Monitor<br />
<img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/image7.png" alt="" /></p>
<p><strong>Required parameters</strong></p>
<p>ModelIndex should be between [0..2].</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>target_detection_type_selection</td><td>I</td><td>4</td><td>Defines the source of load detection output</td></tr>
<tr><td>obj_reg_3d_enabled</td><td>I</td><td>1</td><td>3D load detection enabled</td></tr>
<tr><td>obj_reg_3d_model_name[ModelIndex]</td><td>S</td><td></td><td>Model name is the CAD file excl. the file extension</td></tr>
<tr><td>obj_reg_3d_object_length[ModelIndex]</td><td>F</td><td>0.0</td><td>Length of the model in meters</td></tr>
<tr><td>obj_reg_3d_object_width[ModelIndex]</td><td>F</td><td>0.0</td><td>Width of the model in meters</td></tr>
<tr><td>obj_reg_3d_object_height[ModelIndex]</td><td>F</td><td>0.0</td><td>Height of the model in meters</td></tr>
</tbody></table>
<p><strong>Optional parameters</strong></p>
<p>SensorIndex should be between [0..3].</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>obj_reg_3d_sensor_fov_vertical_deg[SensorIndex]</td><td>F</td><td>0.0</td><td>The sensor's vertical field of view [deg]. Used for empty space detection and pose verification. By default 45.0 for O3D, 60.0 for Visionary. Depends on roll angle.</td></tr>
<tr><td>obj_reg_3d_sensor_fov_horizontal_deg[SensorIndex]</td><td>F</td><td>0.0</td><td>The sensor's horizontal field of view [deg]. Used for empty space detection and pose verification. By default 60.0 for O3D, 70.0 for Visionary. Depends on roll angle.</td></tr>
<tr><td>obj_reg_3d_sensor_translation_x[SensorIndex]</td><td>F</td><td>0.0</td><td>The x offset of the 3D camera from navigation point in meters</td></tr>
<tr><td>obj_reg_3d_sensor_translation_y[SensorIndex]</td><td>F</td><td>0.0</td><td>The y offset of the 3D camera from navigation point in meters</td></tr>
<tr><td>obj_reg_3d_sensor_translation_z[SensorIndex]</td><td>F</td><td>0.0</td><td>The z offset of the 3D camera from fork centre point in meters, or floor if <strong>obj_reg_3d_sensor_height_fixed</strong> is 1</td></tr>
<tr><td>obj_reg_3d_sensor_internal_rotation_roll_deg[SensorIndex]</td><td>F</td><td>0.0</td><td>The roll angle offset of the 3D camera w.r.t. its own X-axis</td></tr>
<tr><td>obj_reg_3d_sensor_internal_rotation_pitch_deg[SensorIndex]</td><td>F</td><td>0.0</td><td>The pitch angle offset of the 3D camera w.r.t. its own Y-axis</td></tr>
<tr><td>obj_reg_3d_sensor_internal_rotation_yaw_deg[SensorIndex]</td><td>F</td><td>0.0</td><td>Sensor calibration yaw. Sensor's internal coordinate frame.</td></tr>
<tr><td>obj_reg_3d_sensor_model[SensorIndex]</td><td>I</td><td>0</td><td>Sensor model <br> 0 -- disabled<br> 1 -- IFM O3D<br> 2 -- SICK Visionary-T Mini<br> 3 -- DDS pointcloud topic</td></tr>
<tr><td>obj_reg_3d_sensor_external_rotation_yaw_deg[SensorIndex]</td><td>F</td><td>0.0</td><td>The angular deviation between the transformed 3d sensor's X and AGV's X in machine coordinate frame (heading).</td></tr>
<tr><td>dds_pointcloud2_topic_name[SensorIndex]</td><td>S</td><td></td><td>The topic name for the pointcloud2 message.</td></tr>
<tr><td>obj_reg_3d_sensor_ip[SensorIndex]</td><td>S</td><td></td><td>The IP address of the 3D camera</td></tr>
<tr><td>obj_reg_3d_sensor_height_fixed[SensorIndex]</td><td>I</td><td>0</td><td>The camera is mounted statically and is independent of the actuator</td></tr>
<tr><td>obj_reg_3d_pointcloud_logging</td><td>I</td><td>0</td><td>Enable pointcloud logging - 0 -- disabled, 1 -- enabled</td></tr>
<tr><td>obj_reg_3d_number_of_pointcloud_logs</td><td>I</td><td>0</td><td>The maximum number of pointcloud logs saved to folder</td></tr>
<tr><td>obj_reg_3d_region_of_interest_min_x</td><td>F</td><td>1.0</td><td>Bounding box, all points outside limit w.r.t. camera's local coordinate frame will be filtered out</td></tr>
<tr><td>obj_reg_3d_region_of_interest_max_x</td><td>F</td><td>5.0</td><td>Bounding box, all points outside limit w.r.t. camera's local coordinate frame will be filtered out</td></tr>
<tr><td>obj_reg_3d_region_of_interest_min_z</td><td>F</td><td>0.0</td><td>Bounding box, all points outside limit w.r.t. camera's local coordinate frame will be filtered out</td></tr>
<tr><td>obj_reg_3d_region_of_interest_max_z</td><td>F</td><td>0.6</td><td>Bounding box, all points outside limit w.r.t. camera's local coordinate frame will be filtered out</td></tr>
<tr><td>obj_reg_3d_intensity_filter_scale</td><td>F</td><td>0.85</td><td>Points with lower intensity than nominal for distance will be filtered. Larger value is stricter</td></tr>
<tr><td>obj_reg_3d_cluster_tolerance_dist</td><td>F</td><td>0.096</td><td>Distance tolerance for clustering two points together</td></tr>
<tr><td>obj_reg_3d_cluster_min_size</td><td>I</td><td>40</td><td>Minimum number of points in cluster to be regarded</td></tr>
<tr><td>obj_reg_3d_minimum_model_inlier</td><td>F</td><td>0.25</td><td>Percentage of inliers for accepting a model, the higher the value the stricter</td></tr>
<tr><td>obj_reg_3d_distance_between_pallet_legs[ModelIndex]</td><td>F</td><td>0.0</td><td>Distance between two pallet legs, to minimize false positives. Required for stacked objects. 0.0 -- not used for discrimination</td></tr>
<tr><td>obj_reg_3d_min_rack_beam_width</td><td>F</td><td>1.5</td><td>The minimum width of a rack beam to be detected. Recommended to be larger than the largest model width or length. 0.0 -- not used</td></tr>
<tr><td>obj_reg_3d_stop_for_target_detection_dist</td><td>F</td><td>2.0</td><td>Maximum distance from the object before AGV stops and tries detection on standstill. Distance from AGV:s navigation point to the detected object</td></tr>
<tr><td>obj_reg_3d_target_min_n_times_validated_consecutively</td><td>I</td><td>2</td><td>Minimum number of times target must be validated consecutively before giving results</td></tr>
<tr><td>obj_reg_3d_target_max_n_times_measured_while_stopped</td><td>I</td><td>15</td><td>The maximum detection attempts at standstill until driving closer to target.</td></tr>
<tr><td>obj_reg_3d_max_diff_in_xy_results,</td><td>F</td><td>0.03</td><td>The maximum deviation of the pose in x,y,z between pose estimates to be considered conforming</td></tr>
<tr><td>obj_reg_3d_max_diff_in_angle_results_deg</td><td>F</td><td>2.5</td><td>The maximum heading deviation between pose estimates to be considered conforming</td></tr>
<tr><td>obj_reg_3d_empty_space_width_margin</td><td>F</td><td>0.1</td><td>Margin added to the empty space width when creating the bounding box</td></tr>
<tr><td>obj_reg_3d_empty_space_length_margin</td><td>F</td><td>0.1</td><td>Margin added to the empty space length when creating the bounding box</td></tr>
<tr><td>obj_reg_3d_empty_space_height_margin</td><td>F</td><td>0.1</td><td>Margin added to the empty space height when creating the bounding box</td></tr>
<tr><td>obj_reg_3d_empty_space_max_cluster_density</td><td>I</td><td>50</td><td>Maximum number of allowed measurement points per cubic meter inside empty space</td></tr>
<tr><td>obj_reg_3d_view_blocked_by_load_aboard</td><td>I</td><td>0</td><td>The empty space detection is omitted as the 3D camera is blocked by the load. 0 -- empty space enabled, 1 -- disabled</td></tr>
<tr><td>obj_reg_3d_empty_space_min_material_width</td><td>F</td><td>0.3</td><td>Minimum solid material width beneath empty space</td></tr>
<tr><td>target_detection_max_dist_to_symbolic_point</td><td>F</td><td>6.0</td><td>Distance to start detection from symbolic point. Calculated along trajectory</td></tr>
<tr><td>buffer_check_start_dist_offset_m</td><td>F</td><td>2.0</td><td>Distance before buffer area to start detection</td></tr>
</tbody></table>
<h2 id="how-to-use-22"><a class="header" href="#how-to-use-22">How to use</a></h2>
<h3 id="limitations-24"><a class="header" href="#limitations-24">Limitations</a></h3>
<ul>
<li>The height of the object is assumed to be known, the object is assumed to be within starting height <strong>obj_reg_3d_region_of_interest_min_z</strong> and parameter <strong>obj_reg_3d_object_height</strong>. </li>
<li>The bottom-most object in a cluster is assumed to be the object of interest, if a match is not found from the bottom-most subcluster the feature will evaluate the next cluster (to optimize the search)</li>
<li>Parameter <strong>obj_reg_3d_distance_between_pallet_legs</strong> is used to avoid false positives, it is based on the assumption that the object has 3 legs and between these legs a space between. This allows to differentiate between boxes of similar size and pallets. The matching can be done without the parameter but is then only based on how well the sensor view fits the CAD model, which may be noisy.</li>
<li>Stacked objects are assumed to be in similar pose and if the pose deviates too much the algorithm will not be able to find the stacked objects.</li>
<li>The load detection tracks the object to some extent and updates, however, if the object is completely removed from the scene the AGV will drive to last estimated pose. The pose is not cleared during docking if it does not see it any longer, as the field-of-view of the sensor is limited, and it may not see the object during docking.</li>
</ul>
<h3 id="creating-training-database-of-a-cad-model"><a class="header" href="#creating-training-database-of-a-cad-model">Creating training database of a CAD model</a></h3>
<p>Accessible from Navitrol Monitor, under <code>Navitrol</code> → <code>Generate Partial Views from CAD Form - 3D sensor</code>. The scale factor is for transforming the CAD file from millimeters to meters or from inches to meters. The CAD rendering options is for determining how many partial views will be generated. The <em>Normal</em>-option generates 18 partial views that correspond the most likely sensor point clouds. Generating partial views from CAD file is performed offline and takes a while, thus requires that the AGV is in STANDBY mode when uploading to Navitrol. Generating partial views takes a while and is therefore not safe to run in normal operation, as the thread is frozen. The partial views will be generated from the CAD file selected in Browse.<br />
<img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/image7.png" alt="" /></p>
<p>The message from Monitor is logged as<br />
<em>MONITOR STL PACKET -- filename</em><br />
A pop-up message will appear in Monitor depicting the status of the partial view generation, an example is visualized in the Figure below. </p>
<p><img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/image8.png" alt="" /></p>
<p>The statuses include:</p>
<ul>
<li>Invalid filename</li>
<li>Error occurred during rendering - try again</li>
<li>Invalid scale factor</li>
<li>Successful</li>
</ul>
<p>The partial view files (.bin, .idx, .ply, .txt) are parsed at startup and when a new model is generated.</p>
<p>The Figure below visualizes a subset of the generated partial views for a eur-pallet.</p>
<p><img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/partial_views.PNG" alt="" /></p>
<h3 id="3d-camera-setup"><a class="header" href="#3d-camera-setup">3D camera setup</a></h3>
<h4 id="ifm-o3d"><a class="header" href="#ifm-o3d">IFM O3D</a></h4>
<p>If the used 3D camera is the IFM O3D303 or O3DP03 the configuration of the camera must be uploaded to the camera. In the IPC write the following commands, by replacing the below IP with the IP of the camera. The configuration file must only be uploaded once for the O3D303 and after each reboot for the O3DP03. Follow the steps below to modify the IFM parameters:</p>
<ol>
<li>Upload the provided <em>configurationFileIFM</em> script to the IPC.</li>
<li>Give script permission - <code>chmod +x configurationFileIFM</code></li>
<li><code>./configurationFileIFM IP-ADDRESS</code></li>
<li>Verify that the configuration file was successfully updated from console</li>
</ol>
<h5 id="dds"><a class="header" href="#dds">DDS</a></h5>
<p>Set parameter <strong>dds_pointcloud2_topic_name[]</strong> and <strong>dds_enabled</strong> to 1, and <strong>obj_reg_3d_sensor_model[]</strong> to 3. </p>
<p>IFM O3R:</p>
<p>The sensor provides Z-buffer data, i.e. Z is by default pointing &quot;forward&quot;</p>
<ol>
<li><em>docker load &lt; ifm3d_ros_driver.tar.gz</em></li>
<li>Run script: <em>./start_ifm_ros2_driver.sh</em></li>
<li><em>cd colcon_ws</em></li>
<li><em>source install/setup.bash</em></li>
<li><em>cd src/ifm3d-ros2/launch/examples</em></li>
</ol>
<p>If the IP address of the VPU has been changed the following modifications need to be performed before launching the script.</p>
<ol>
<li>apt install nano</li>
<li>nano /home/ifm/colcon_ws/install/ifm3d_ros2/share/ifm3d_ros2/config/examples/o3r_3d.yaml</li>
<li>Modify ip: to the desired IP address</li>
<li>nano /home/ifm/colcon_ws/install/ifm3d_ros2/share/ifm3d_ros2/config/examples/o3r_2d.yaml</li>
<li>Modify ip: to the desired IP address</li>
</ol>
<p>Launch script:
<em>ros2 launch example_o3r_2d_and_3d.launch.py</em></p>
<p>The topic name is by default rt/ifm3d/camera_3d/cloud for the O3R-driver.</p>
<h3 id="coordinate-frame"><a class="header" href="#coordinate-frame">Coordinate frame</a></h3>
<p>The sensor pointcloud is transformed according to the above parameters to obtain the object pose in map coordinates. The translation components x and y are the deviations from the navigation point in the AGV's coordinate frame. The translation z component is defined with respect to the fork centre height or w.r.t. the floor if <strong>obj_reg_3d_sensor_height_fixed</strong> is set to 1.</p>
<p>The left-most sensor shows the &quot;raw&quot; internal sensor coordinate frame and the right-most the transformed coordinate frame. The below example sensor provides Z-buffer data, which means that &quot;forward&quot; would be Z, instead of X. The detection algorithm assumes an X-buffer, so the sensor's internal rotation must be changed. In the below case the <strong>obj_reg_3d_sensor_internal_rotation_roll_deg</strong> would be 90 degrees and <strong>obj_reg_3d_sensor_internal_rotation_yaw_deg</strong> would be -90 degrees. </p>
<p><img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/sensor_rotation.PNG" alt="" /></p>
<blockquote>
<p>Sensor's internal rotation</p>
</blockquote>
<p>The roll, pitch and yaw angles are defined as the rotation along the x, y and z-axes of the sensor, respectively, as shown in the Figure below. The <strong>obj_reg_3d_sensor_external_rotation_yaw_deg</strong> angle is defined with respect to the AGV coordinate frame, the external yaw of the 3d sensor in the Figure below would be either 180 or -180 degrees.</p>
<p><img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/figure1.png" alt="" /></p>
<p>The sensor is rendered in Monitor based on parameters:
<strong>obj_reg_3d_sensor_translation_x</strong>, <strong>obj_reg_3d_sensor_translation_y</strong> and
<strong>obj_reg_3d_sensor_external_rotation_yaw_deg</strong>. The triangle inside the square represents the viewing direction of the sensor, as visualized in the Figure below</p>
<p><img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/image2.png" alt="" /></p>
<h3 id="filtering--clustering"><a class="header" href="#filtering--clustering">Filtering &amp; Clustering</a></h3>
<p>The search space can be minimized, to make processing faster and to avoid possible false positives, via parameters with prefix <strong>obj_reg_3d_region_of_interest_</strong>. The region of interest is described in the sensor's local coordinate frame.</p>
<p>The intensity is quadratically dependent on the distance to the 3D camera. The intensity of points is also dependent on the material, and the default value is based on wood. The strictness of the intensity filter can be scaled by parameter.
The higher the value the more strict the filtering. <strong>F, obj_reg_3d_intensity_filter_scale, # Range [0.0, 1.0]</strong></p>
<p>Objects far from the 3D camera may have sparsely distributed points, meaning a small value for <strong>obj_reg_3d_cluster_tolerance_dist</strong> might not be able to cluster the entire object, and too large values might result in adjacent objects being clustered together.</p>
<h3 id="detection-and-pose-estimation"><a class="header" href="#detection-and-pose-estimation">Detection and pose estimation</a></h3>
<p>The detection is started when </p>
<ul>
<li>AGV is in Auto state </li>
<li>AGV heading is within +-45 degrees from the end symbolic point. This takes frame heading into account</li>
<li>The distance is ok. This is calculated in two ways: 
<ul>
<li>AGV is inside target buffer area + <strong>buffer_check_start_dist_offset_m</strong> parameter or</li>
<li>AGV is within <strong>target_detection_max_dist_to_symbolic_point</strong> from the end symbolic point</li>
</ul>
</li>
</ul>
<p>The detection is based on matching the sensor pointcloud to the partial views of several CAD files of different models, until a match returning the smallest error and largest number of inliers is found.</p>
<p>In the case the object of interest has three legs on both the shorter and longer side, such as a eur-pallet, the parameter <strong>obj_reg_3d_distance_between_pallet_legs</strong> is defined as the distance between the shorter side's legs, for each model. The Figure below depicts the parameter selection for a eur-pallet, for which the value would be 0.35. This minimizes the risk of false positives for solid facades of similar dimensions.</p>
<p><img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/figure5.png" alt="" /></p>
<p>The number of inliers between the CAD partial view and the sensor pointclouds is used for rejecting false-positive estimations, and can be tuned by <strong>obj_reg_3d_minimum_model_inlier</strong>.
The higher the value the smaller the risk of false positive matches, but also the risk of rejecting true positives increases. The inlier fraction is logged in the console after a successful registration as: <em>Object registration - registration successful. Inlier fraction(s):</em></p>
<p>The <strong>obj_reg_3d_minimum_model_inlier</strong> can be increased to a higher value if the inlier fraction is noticed to be higher during a successful match. Depending on the quality of the data and the model, the inlier fraction can be between 0.4 to 0.6.</p>
<p>The returned pose is the centre point of the model facade and is computed from the length and width of the model. The acquired pose is transformed to map coordinates and given as x, y, z, heading.
An initial docking target is found after obtaining <strong>obj_reg_3d_target_min_n_times_validated_consecutively</strong> consecutive conforming poses. For more information on docking, see <a href="TargetAndObstacleDetection/3dTargetDetection/../../PositionControl/Docking/Docking-en.html">Docking</a>. The pose is continuously updated if the new pose estimates conform with previous estimations. The allowed deviation between poses is determined by parameters <strong>obj_reg_3d_max_diff_in_xy_results</strong> and <strong>obj_reg_3d_max_diff_in_angle_results_deg</strong>. The smaller the value the stricter the estimation will be, but may result in false negatives. In case several similar objects are stacked the pose closest to the target actuator height is returned.</p>
<p>The status of the detection is logged with the prefix<br />
<em>Object registration -</em></p>
<p>The pose of the object is logged as<br />
<em>Object registration pose [map coord] : (x, y, z, h)</em></p>
<h3 id="empty-space-detection-1"><a class="header" href="#empty-space-detection-1">Empty space detection</a></h3>
<p>The empty space detection is used for unloading AGVs. The exact unload position is assumed to be known in x, y and heading.</p>
<p>An empty space is defined as a volume of object dimension, plus margins, with less points than a threshold. The maximum number of points allowed within the entire volume is defined by <strong>obj_reg_3d_empty_space_min_cluster</strong>. The object dimensions are obtained from parameters <strong>obj_reg_3d_object_length/width/height</strong>.</p>
<p>If <strong>obj_reg_3d_view_blocked_by_load_aboard</strong> is 1, the empty space will always return true and the AGV will unload blindly to the unload symbolic point, without verifying if an empty space is found.</p>
<p>If the volume is larger than the field of view of the sensor from current distance to the unload point, an error message is logged. An empty space is only valid if there is solid material underneath, width defined by <strong>obj_reg_3d_empty_space_min_material_width</strong>. This is to prevent empty spaces being found mid-air.</p>
<p>The empty space detection returns a height for which an empty volume that meets the above requirements. The status of the empty space detection is logged with the prefix: <em>Empty space -</em></p>
<p>The detection is initiated if the symbolic point is unload, there is a load aboard and <strong>obj_reg_3d_view_blocked_by_load_aboard</strong> is set to 0. The status of the detection initiation can be seen from <em>Empty space status -</em></p>
<h3 id="buffer-lane-detection"><a class="header" href="#buffer-lane-detection">Buffer lane detection</a></h3>
<p>Blockstacking, meaning the detection of stacks for loading and unloading, requires buffer lane enabled in Tools and the correct parameter set-up. See document <a href="TargetAndObstacleDetection/3dTargetDetection/../../LoadHandling/BufferLanes/BufferLanes-en.html">Navitrol - Buffer lanes</a> for more information.</p>
<p>All objects in a stack are assumed to be of same model and in similar orientation.</p>
<p>The detection for loading from a stack is performed by finding the bottom-most object closest to the AGV in the buffer lane, and raising the forks until the top of the stack is found. The top of the stack is found by finding an empty space with less points than <strong>obj_reg_3d_empty_space_min_cluster</strong> above the current top-most object. After the empty space is found, the AGV will load the top-most object from the stack.See document <a href="TargetAndObstacleDetection/3dTargetDetection/../../LoadHandling/StackLoading/StackLoading-en.html">Navitrol - Stackloading</a> for more information.<br />
The current top-most pallet in the stack is logged as: <em>Object registration - buffer area current top-most pallet (x,y,z,h)</em></p>
<p>Unloading to a buffer stack is done by detecting the bottom-most object and increasing until finding a height where there is less points than <strong>obj_reg_3d_empty_space_min_cluster</strong>. If the bottom-most object is not found in the stack or stacking is not allowed, the AGV will unload in front of the obstacle in the buffer lane, based on the closest point in the obstacle. The closest obstacle in the buffer lane, in map coordinates, can be seen in the log as <em>Buffer lane obstacle closest position (x, y)</em>. See document <a href="TargetAndObstacleDetection/3dTargetDetection/../../LoadHandling/BlockStacking/BlockStacking-en.html">Navitrol - Blockstacking</a> for more information.</p>
<h3 id="stopping-while-executing-3d-object-registration"><a class="header" href="#stopping-while-executing-3d-object-registration">Stopping while executing 3d object registration</a></h3>
<p>During 3D object registration it is possible to stop the AGV and give more time for the feature to detect the target. Stopping will occur when the AGV is closer than <strong>obj_reg_3d_stop_for_target_detection_dist</strong> distance to unrecognized object or a cluster. Stopping will not occur if object is validated and detected correctly already further away.</p>
<p>Workflow for the detection sequence while being stopped is the following:</p>
<ol>
<li>Stop the AGV when object is <strong>obj_reg_3d_stop_for_target_detection_dist</strong> distance away from the AGV</li>
<li>Detect and validate the target <strong>obj_reg_3d_target_min_n_times_validated_consecutively</strong> times in a row</li>
<li>After <strong>obj_reg_3d_target_max_n_times_measured_while_stopped</strong> detection attempts, continue moving towards the target again</li>
<li>If detection successful, start docking</li>
</ol>
<h2 id="troubleshooting-42"><a class="header" href="#troubleshooting-42">Troubleshooting</a></h2>
<h3 id="partial-views"><a class="header" href="#partial-views">Partial views</a></h3>
<h4 id="invalid-scale-factor-of-partial-view"><a class="header" href="#invalid-scale-factor-of-partial-view">Invalid scale factor of partial view</a></h4>
<ul>
<li>The dimension of the partial view is incorrect. Verify that the scale factor for the CAD file is correct</li>
</ul>
<h4 id="upload-to-navitrol-causes-navitrol-to-crash-and-lose-connection-to-agv-the-following-line-is-logged-in-the-console"><a class="header" href="#upload-to-navitrol-causes-navitrol-to-crash-and-lose-connection-to-agv-the-following-line-is-logged-in-the-console">Upload to Navitrol causes Navitrol to crash and lose connection to AGV. The following line is logged in the console</a></h4>
<ul>
<li><em>vtkXOpenGLRenderWindow (0x7f5c3c01f0c0): bad X server connection. DISPLAY=:99. Aborting.</em> -- Verify that Xvfb is installed from <code>which Xvfb</code>. If not, <code>apt-get install xvfb</code>. Otherwise, try restarting the virtual screen manually by <code>Xvfb :99 -screen 0 1024x768x24 \&gt; /dev/null 2\&gt;&amp;1 &amp;</code></li>
</ul>
<h4 id="invalid-filename-of-partial-view"><a class="header" href="#invalid-filename-of-partial-view">Invalid filename of partial view</a></h4>
<ul>
<li>Verify that the Monitor package, logged as <em>MONITOR STL PACKET -- filename</em> has been received and parsed correctly and that the filename matches the CAD file name excluding the file extension (.stl), and that the provided .stl file is not corrupted and has more than 4 points</li>
</ul>
<h3 id="load-detection-3d-form"><a class="header" href="#load-detection-3d-form">Load detection 3d form</a></h3>
<p><img src="TargetAndObstacleDetection/3dTargetDetection/./media-en/load_detection_form.png" alt="" /></p>
<blockquote>
<p>Load detection 3d form</p>
</blockquote>
<p>A green color indicates the requirements are met, red means they are not.</p>
<h4 id="agv-distance-within-detection-range"><a class="header" href="#agv-distance-within-detection-range">AGV distance within detection range</a></h4>
<ul>
<li>The AGV's distance to the symbolic point along trajectory is more than <strong>target_detection_max_dist_to_symbolic_point</strong>.</li>
</ul>
<h4 id="agv-heading-within-detection-range"><a class="header" href="#agv-heading-within-detection-range">AGV heading within detection range</a></h4>
<ul>
<li>The AGV's heading is more than +-45 degrees from the symbolic point heading.</li>
</ul>
<h4 id="symbolic-point-has-load-detection-enabled"><a class="header" href="#symbolic-point-has-load-detection-enabled">Symbolic point has load detection enabled</a></h4>
<ul>
<li>Enable load detection in Navithor Tools for the symbolic point.</li>
</ul>
<h4 id="partial-views-ok"><a class="header" href="#partial-views-ok">Partial views ok</a></h4>
<ul>
<li>The model name in parameter <strong>obj_reg_3d_model_name[]</strong> is not correct or no CAD file (.stl) has been uploaded via the Generate partial views from CAD form - 3D sensor.</li>
</ul>
<h4 id="load-detection-status"><a class="header" href="#load-detection-status">Load detection status</a></h4>
<ul>
<li>
<p>&quot;Region of interest too small for model&quot; - The parameters <strong>obj_reg_3d_region_of_interest_min/max_z</strong> are too strict. Check the validity of parameters <strong>obj_reg_3d_region_of_interest_min/max_z</strong> and/or <strong>obj_reg_3d_object_height</strong>.</p>
</li>
<li>
<p>&quot;Intensity filter failed&quot; - Parameter value <strong>obj_reg_3d_intensity_filter_scale_factor</strong> is too high and no points have intensity above threshold.</p>
</li>
<li>
<p>&quot;Passthrough filter (x, y) failed&quot; - Verify that parameters <strong>obj_reg_3d_sensor_translation_x/y</strong> and <strong>obj_reg_3d_region_of_interest_min/max_x</strong> are valid.</p>
</li>
<li>
<p>&quot;Passthrough filter z failed&quot; - Verify <strong>obj_reg_3d_sensor_translation_z</strong> and <strong>obj_reg_3d_sensor_rotation_pitch_deg</strong>, or all <strong>obj_reg_3d_sensor_rotation</strong>-prefixed parameters if sensor provides Z-buffer pointcloud.</p>
</li>
<li>
<p>&quot;Euclidean segmentation failed&quot; - The parameter <strong>obj_reg_3d_cluster_min_size</strong> is too high or <strong>obj_reg_3d_cluster_tolerance_dist</strong> is too small.</p>
</li>
<li>
<p>&quot;No match found - model file corrupted&quot; - Reupload the partial views for CAD file(s). The log line with prefix &quot;2.5D rendered model&quot; will inform the index of the corrupted model file.</p>
</li>
<li>
<p>&quot;No match found - model not found&quot; - A model giving a larger inlier fraction than <strong>obj_reg_3d_minimum_model_inlier</strong> is not found, or a subcluster of model height with more points than <strong>obj_reg_3d_cluster_min_size</strong> is not found.</p>
</li>
<li>
<p>&quot;No match found - fitness value too high&quot; - The error of the fine tuned pose is too high. </p>
</li>
<li>
<p>&quot;No match found - pose invalid&quot; - The computed pose doesn't have any neighbouring points in the sensor pointcloud. </p>
</li>
<li>
<p>&quot;No match found - pocket detection failed&quot; - Pockets have not been detected for the model, defined based on:
<strong>obj_reg_3d_distance_between_pallet_legs</strong></p>
</li>
<li>
<p>&quot;Detection ok&quot; - The detection was successful, a pose estimate was obtained.</p>
</li>
</ul>
<h4 id="target-found"><a class="header" href="#target-found">Target found</a></h4>
<ul>
<li>Two consecutive pose estimates deviating less than <strong>obj_reg_3d_max_diff_in_xy_results</strong> and <strong>obj_reg_3d_max_diff_in_angle_results_deg</strong> has not been obtained. </li>
</ul>
<h4 id="the-dimensions-of-the-load-are-ok"><a class="header" href="#the-dimensions-of-the-load-are-ok">The dimensions of the load are ok</a></h4>
<ul>
<li>An object has been loaded</li>
</ul>
<h4 id="empty-space-detection-status"><a class="header" href="#empty-space-detection-status">Empty space detection status</a></h4>
<ul>
<li>
<p>&quot;The sensor field of views are smaller than the object or object is not in the sensor field of view.&quot; - Based on the current distance to query point, the sensor transformation and parameters <strong>obj_reg_3d_sensor_fov_vertical_deg</strong> and <strong>obj_reg_3d_sensor_fov_horizontal_deg</strong>.</p>
</li>
<li>
<p>&quot;The empty space was found on floor level&quot; - An empty space around the query point on floor level was found. No solid material required to be seen.</p>
</li>
<li>
<p>&quot;The empty space detection failed - space occupied.&quot; - The empty space around the query points has more points than <strong>obj_reg_3d_empty_space_max_cluster_density</strong> multiplied by the volume of the empty space (length * width * height) with margins.</p>
</li>
<li>
<p>&quot;The empty space detection failed - no rack found.&quot; - No solid material of minimum width <strong>obj_reg_3d_empty_space_min_material_width</strong> found below the empty space, the empty space is invalidated.</p>
</li>
<li>
<p>&quot;The empty space was found&quot; - The empty space was found around the query point. Unloading will commence. </p>
</li>
</ul>
<h4 id="the-unload-query-point-in-map-coordinates-x-y-z-h"><a class="header" href="#the-unload-query-point-in-map-coordinates-x-y-z-h">The unload query point in map coordinates (x, y, z, h)</a></h4>
<ul>
<li>The centre point (x, y) of the volume used for empty space detection</li>
</ul>
<h4 id="the-dimensions-of-the-load-incl-margins-l-w-h"><a class="header" href="#the-dimensions-of-the-load-incl-margins-l-w-h">The dimensions of the load, incl. margins (L, W, H)</a></h4>
<ul>
<li>The length, width and height of the volume and margins, <strong>obj_reg_3d_empty_space_length_margin</strong>, <strong>obj_reg_3d_empty_space_width_margin</strong>, and <strong>obj_reg_3d_empty_space_height_margin</strong>, used for empty space detection.</li>
</ul>
<h3 id="errors-and-warnings-18"><a class="header" href="#errors-and-warnings-18">Errors and warnings</a></h3>
<h4 id="562---error_3d_partial_views_invalid"><a class="header" href="#562---error_3d_partial_views_invalid">562 - ERROR_3D_PARTIAL_VIEWS_INVALID</a></h4>
<ul>
<li>The partial views for 3d detection are invalid and parsing was unsuccessful. Verify that the <strong>obj_reg_3d_model_name</strong> corresponds to the name of the CAD file and that the files exist in <code>/home/navitec/</code> and <code>/home/navitec/poses/</code> and are not corrupted.</li>
</ul>
<h4 id="563---error_3d_prerequisites_not_found"><a class="header" href="#563---error_3d_prerequisites_not_found">563 - ERROR_3D_PREREQUISITES_NOT_FOUND</a></h4>
<ul>
<li>The required 3rd party libraries could not be found. Verify that all the packages in the <em>dependencies.7z</em> have been installed.</li>
</ul>
<h4 id="665---warning_3d_sensor_data_not_received"><a class="header" href="#665---warning_3d_sensor_data_not_received">665 - WARNING_3D_SENSOR_DATA_NOT_RECEIVED</a></h4>
<ul>
<li>A sensor pointcloud is not received, verify network settings and ip address. Check <strong>obj_reg_3d_sensor_model</strong> and <strong>obj_reg_3d_sensor_ip</strong> or <strong>dds_pointcloud2_topic_name</strong></li>
</ul>
<h3 id="advanced-troubleshooting-12"><a class="header" href="#advanced-troubleshooting-12">Advanced troubleshooting</a></h3>
<h4 id="pointcloud-logs"><a class="header" href="#pointcloud-logs">Pointcloud logs</a></h4>
<ul>
<li>If pointcloud logging is enabled, pointclouds will be saved to <code>/home/navitec/pointcloud_logs/</code> folder. The pointcloud logs are saved as <em>pointcloud_error_log_n.ply</em>. The newest file is the 0<sup>th</sup>, and the oldest logs are deleted after reaching <strong>obj_reg_3d_number_of_pointcloud_logs</strong>. The pointclouds are saved to .ply format and can be viewed in e.g. Meshlab, which is a free software.</li>
<li>The Navitrol timestamp of the pointcloud is visible as a comment in the <em>.ply</em> file, the files are written in ASCII format. The width of the pointcloud is also written as a comment to the <em>.ply</em> file.</li>
</ul>
<h4 id="unsuccessful-parsing-of-partial-views"><a class="header" href="#unsuccessful-parsing-of-partial-views">Unsuccessful parsing of partial views</a></h4>
<ul>
<li>In the log there is visible the following line: <em>Could not open file:</em>. The number of partial views parsed can be deduced from log lines 
<em>Could not open file: ./poses/modelname_poses_3.txt for reading</em><br />
<em>Could not open file: ./poses/modelname_cluster_3.ply for reading.</em><br />
In the above example only 3 partial views were parsed for <em>modelname.</em> If the number is 0 for either .txt or .ply, no file  matching the filename could be found in the required folder. To check for file corruption search in the log for prefix <em>Partial view parsing -</em></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pattern-detection"><a class="header" href="#pattern-detection">Pattern Detection</a></h1>
<p>Updated 04.06.2024</p>
<hr />
<h2 id="pattern-detection-versions"><a class="header" href="#pattern-detection-versions">Pattern detection versions</a></h2>
<p>This document describes the interface between Navitrol and an AGV controller in the special application of reflector target detection.
It is designed for measuring the position and angle of a target marked with reflectors or the relative position between two AGVs.
The measuring is based on reflectors mounted in a known configuration on a station, carrier or AGV, which are detected with one or two scanners on the controlled AGV.</p>
<p>The measuring is based on reflectors mounted in a known configuration on a station, carrier or AGV, which are detected with one or two scanners on the controlled AGV. The position, angle and height of the marked target  can be used for docking to stations or another AGV, picking an object or driving AGV's in synchronized motion (coupled drive).</p>
<p>Version 1 of the system is using two or preferably four reflectors on the target and one scanner on the measuring AGV. It assumes full visibility between the AGV and the target at all times, i.e. all target reflectors need to be detected every time.
If the line of sight is broken the measurement is not giving any result.</p>
<p>The reflectors are positioned in a simple pattern defined by two distances A and B. The reflectors also must have a defined width Rw.</p>
<p><img src="TargetAndObstacleDetection/PatternDetection/./media-en/image1.png" alt="" /></p>
<p>Version 2 of the target detection is based on a more complex reflector pattern enabling detection also when only a part of the reflectors are detected.
In this version up to 8 reflectors can be used.
All reflectors must have the same width Rw and the distances between all reflectors must differ from each other with at least 70 mm.
A pattern example is shown below.</p>
<p><img src="TargetAndObstacleDetection/PatternDetection/./media-en/image2.png" alt="" /></p>
<p>Version 2 also supports detection with two scanners.
In case the line of sight is obstructed, each scanner can give a separate result if at least 3 reflectors are detected, but the detections can also be combined from both scanners to give a common solution.</p>
<p>Version 3 of the target detection is a combination of pattern detection for position determination with an addition of one angled reflector used for height detection. The angled reflector is added into the middle of the pattern of vertical reflectors to form a gap between two opposite triangles. Due to the angle, this reflector is detected in a different location relative to the vertical reflectors depending on the height position of the laser field. Since there are two different measurements within one pattern, all reflectors need to be detected every time, else the detection is undefined. The pattern is shown below.</p>
<p><img src="TargetAndObstacleDetection/PatternDetection/./media-en/heightPattern.png" alt="" /></p>
<p>As in the other detection versions, the distances A,B,C,.. between reflectors and their widths Rw must be defined. The distances between vertical reflectors may differ from each other, but the angled reflector must be symmetrically positioned between its neighbouring vertical reflectors. Also, the width of the angled reflector shall be calculated to give a similar detection width as the vertical reflectors, and therefore it must be somewhat narrower. Define its widt by calculating Rwa = Rw*cos(ang) where ang is its angle CCW from vertical. The height of the reflectors must also be defined as it defines the available height detection range.</p>
<p>The height detection requires some additional scanner position and reflector position parameters in order to give a defined position from ground or relative position to a moving target with variable height. In case of a fixed target with constant height, the height of the vehicle reference point (in this case the platform height) is defined as in the figure below:
<img src="TargetAndObstacleDetection/PatternDetection/./media-en/fixed_target.png" alt="" /></p>
<p>If the target is another vehicle with variable height, the parameters can be defined as in the figure below. By giving a negative height for the Pattern offset (Platform down to pattern base), the offset calculation results in the height difference between the reference levels on the machines (in this case the platform surfaces). Adding half the Range to the Pattern offset moves the zero point to the middle of the reflector target, giving a +/- value range to the height difference.</p>
<p><img src="TargetAndObstacleDetection/PatternDetection/./media-en/leveling_target.png" alt="" /></p>
<p>If both Pattern offset and Scanner offset are set to zero, the raw Height detection value is reported and can be used as a relative measurement without binding to the platform dimensions.</p>
<h2 id="parameters-12"><a class="header" href="#parameters-12">Parameters</a></h2>
<h3 id="general-parameters-1"><a class="header" href="#general-parameters-1">General parameters</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value (suggestion for v2)</th><th>Description</th></tr></thead><tbody>
<tr><td>target_detection_type_selection</td><td>I</td><td>0 (1)</td><td>Enables reflector docking or pallet detection  0 = disabled 1 = reflector docking 2 = pallet detection</td></tr>
<tr><td>target_detection_always_enabled</td><td>I</td><td>0</td><td>0 = detect target only when docking 1 = enables target detection algorithm always (AGV to AGV positioning)</td></tr>
<tr><td>target_detection_scan_selection</td><td>I</td><td>0 (any selection except for 3)</td><td>Defines which scanners are used for target detection:  <br> 1 = rear scanner only <br> 2 = front scanner only <br>3 = both scanners simultaneously <br> 4 = use scanner in driving direction <br>5 = both scanners alternately (only version 2 reflector detection)  Note! selection 3 does not work with V2 and V3 detection.</td></tr>
<tr><td>target_detection_results_dampening</td><td>F</td><td>0.3</td><td>Dampening value for the results; min = 0, max = 1</td></tr>
<tr><td>target_detection_max_diff_in_xy_results</td><td>F</td><td>0.2</td><td>How big difference is allowed in xy-location (metres) before the new result is updated without dampening</td></tr>
<tr><td>target_detection_max_diff_in_angle_results</td><td>F</td><td>5.0</td><td>How big difference is allowed in angle (degrees) before the new result is updated without dampening</td></tr>
<tr><td>target_min_n_times_detected</td><td>I</td><td>20</td><td>Minimum number of times target must be detected before giving results</td></tr>
<tr><td>target_max_n_times_missing</td><td>I</td><td>300</td><td>Max number of times the last known target location is given if no target is detected; min = 0</td></tr>
</tbody></table>
<h3 id="reflector-detection-parameters"><a class="header" href="#reflector-detection-parameters">Reflector detection parameters</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value (version note)</th><th>Description</th></tr></thead><tbody>
<tr><td>refl_det_version</td><td>I</td><td>0</td><td>1 - reflector detection ver 1  <br> 2 - reflector pattern for ver 2 <br> 3 - reflector pattern with height detection</td></tr>
<tr><td>refl_det_refl_width</td><td>F</td><td>0.15</td><td>Width of the reflectors used for docking purposes (in metres)</td></tr>
<tr><td>refl_det_refl_dist_A</td><td>F</td><td>0.55 (ver 1 only)</td><td>The distance between the reflectors in the middle (in metres, from centre point to centre point) (in metres)</td></tr>
<tr><td>refl_det_refl_dist_B</td><td>F</td><td>0.65 (ver 1 only)</td><td>The distance between the reflectors on the sides (not used with 2 refs, with 4 refs left and right pair) (in metres)</td></tr>
<tr><td>refl_det_num_of_reflectors</td><td>I</td><td>4 (ver 1 only)</td><td>Number of reflectors used for detection. <br> Version 1: 2 or 4 <br> Version 2: not needed <br> Version 3: not needed</td></tr>
<tr><td>refl_det_refl_dist_pattern[7]</td><td>F</td><td>0.0 (ver 2, 3)</td><td>max 7 distance values (m) for max eight reflectors. The distance is measured from center to center of the reflectors. The parameters should contain distances from    leftmost [0] to rightmost [6] (the first zero distance cuts the pattern). The distances on each side of the angled height reflector are equal and half of the distance between the neighbouring vertical refelectors.</td></tr>
<tr><td>refl_det_refl_dist_max_error</td><td>F</td><td>0.06</td><td>Maximum allowed error for the distance between reflectors (in metres)</td></tr>
<tr><td>refl_det_refl_width_max_error</td><td>F</td><td>0.05</td><td>Maximum allowed error for the width of the reflector (in metres)</td></tr>
<tr><td>refl_max_dist_from_line</td><td>F</td><td>0.1 (ver 2, 3)</td><td>Maximum deviation from reflector line for discarding a reflector detection from the reflector pattern</td></tr>
<tr><td>refl_discard_undersized</td><td>I</td><td>0 (ver 2, 3)</td><td>1 to discard undersized reflector detections from the reflector pattern</td></tr>
<tr><td>scanner_heading_offset_gain</td><td>F</td><td>0.02 (ver 2 only)</td><td>Heading auto correction gain for right scanner when using two scanners for reflector pattern detection</td></tr>
<tr><td>scanner_pos_x_offset_gain</td><td>F</td><td>0.02 (ver 2 only)</td><td>Scanner x-position auto correction gain for right scanner when using two scanners for reflector pattern detection</td></tr>
<tr><td>scanner_pos_y_offset_gain</td><td>F</td><td>0.02 (ver 2 only)</td><td>Scanner y-position auto correction gain for right scanner when using two scanners for reflector pattern detection</td></tr>
<tr><td>refl_det_min_points_in_cluster</td><td>I</td><td>5</td><td>Minimum number of measurement points in reflector clusters, recommended value 5</td></tr>
</tbody></table>
<h3 id="reflector-detection-height-parameters"><a class="header" href="#reflector-detection-height-parameters">Reflector detection height parameters</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>refl_height_detection_gap_reflector_angle_deg</td><td>F</td><td>45.0</td><td>The angle of the gap reflector CCW from vertical</td></tr>
<tr><td>refl_height_detection_gap_reflector_width</td><td>F</td><td>0.05</td><td>The width Rw [m] of the vertical reflectors and the gap angle ang from vertical, gives the gap reflector width Rwa = Rw * cos(ang)</td></tr>
<tr><td>refl_height_detection_gap_reflector_index</td><td>I</td><td>2</td><td>Index of the gap reflector in the reflector pattern (indexes start with 0)</td></tr>
<tr><td>refl_height_detection_reflector_height</td><td>F</td><td>0.4</td><td>The height of the vertical reflectors and the vertical height of the gap angle reflector. Gives the range of use in height detection. The height detection zero point is in the low end of the reflectors.</td></tr>
<tr><td>refl_height_detection_pattern_height_offset</td><td>F</td><td>0.0</td><td>The height offset between the low end of the reflector pattern and the ground for fixed objects or a reference plane on a vehicle. Positive distance when pattern above the reference level, else negative.</td></tr>
<tr><td>refl_height_detection_scanner_height_offset</td><td>F</td><td>0.0</td><td>The height offset between the scanner and the reference plane on the vehicle. Positive if the scanner is above the reference plane.</td></tr>
<tr><td>target_detection_height_result_dampening</td><td>F</td><td>0.3</td><td>Low pass filtering gain to dampen the variation of the output value of the target height detection: minimum = 0 (using old value), maximum = 1 (using new value).</td></tr>
<tr><td>target_detection_max_diff_in_height_results</td><td>F</td><td>0.15</td><td>How much difference [m] is allowed in height before the new result is updated without dampening.</td></tr>
</tbody></table>
<h3 id="general-parameters-to-calibrate"><a class="header" href="#general-parameters-to-calibrate">General parameters to Calibrate</a></h3>
<p>See <a href="TargetAndObstacleDetection/PatternDetection/../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">initial calibration guide</a> on how to configure scanners correctly.</p>
<h2 id="calibrating-the-continuous-output-version-2-system"><a class="header" href="#calibrating-the-continuous-output-version-2-system">Calibrating the continuous output version 2 system</a></h2>
<p>Manual calibration of the scanner positions and headings so that both units give the same result from the same reflector target is very difficult. Therefore the target detection calculation has an automatic calibration function, which is continuously calculating offsets between the results of the scanners. The offsets are uppdated only when both scanners see the entire reflector target. As soon as a part of the target is hidden from either scanner the offsets are frozen and used for correction of the calculation results to give the best fit between the scanners.</p>
<p>The front (left) scanner is the master scanner in the sense, that the detection result is always output without offset correction. The detection result of the rear (right) scanner is auto calibrated based on the offsets. Therefore, the front scanner shall first be calibrated manually to give the correct position of a target in a known location. When the front scanner has been calibrated to a satisfying accuracy, the rear scanner can be calibrated based on the offsets calculated to match the front scanner. This sequence is described stepwise below.</p>
<ul>
<li>Put a target on a 5-10 m distance from the scanners with the target point (center point between the outmost reflectors) on the extension of the center line of the vehicle.</li>
</ul>
<p><img src="TargetAndObstacleDetection/PatternDetection/./media-en/calibration_sequence_1.png" alt="calibration1" /></p>
<ul>
<li>
<p>Adjust the front scanner x,y-position parameters and angle parameter until the target position result matches the real position and angle.</p>
</li>
<li>
<p>Adjust the rear scanner x,y-position parameters and angle parameter until the target detections with both scanners are approximately in the same position in the Monitor view.</p>
</li>
<li>
<p>Let both scanners detect the entire target for a few minutes. If you are running Navitrol from the console, you will see the calibration result <em>FinalScanPosOffsets</em> every now and then. If you are running Navitrol from boot, you must open an extra console (e.g. Putty) and start a navitrol application in dump line mode to see the offset values. Use command <code>./Navitrol dumpl 10 ”FinalScanPosOffsets:” </code> to get 10 lines of logged offsets, or use 0 instead of 10 to get continuous output. Quit the continuous logging by a Ctrl-C command.</p>
</li>
<li>
<p>Pick the offset values from the log lines <code>FinalScanPosOffsets: ang -0.266 X -0.015 Y 0.024</code> and subtract them from the currrent parameter values of <strong>scan_rear_sen_ang</strong>, <strong>scan_rear_x</strong> and <strong>scan_rear_y</strong> in the params.txt file. Then command Navitrol to read in the updated parameter file. If the values are added correctly, the target detections of both scanners should be in the same location on the Monitor screen and the FinalScanPosOffsets should be remarkably smaller than before.</p>
</li>
<li>
<p>The parameter values can be updated a few times to get the best result.</p>
</li>
<li>
<p>The scanner calibration can be verified by changing the parameters <strong>scanner_heading_offset_gain</strong>, <strong>scanner_pos_x_offset_gain</strong> and <strong>scanner_pos_y_offset_gain</strong> all to 0.0 to prevent offset calibration, restart Navitrol and verify that the target detection result from front and rear scanners are approximately the same (below a centimetre from each other). <em>NOTE</em>, that Navitrol must be restarted here to zero the initial offsets. Remember to reset the parameter values back to original if you have zeroed them!</p>
</li>
</ul>
<p>The calibration is now ready and the system can be run in production.</p>
<h2 id="normal-operation-of-the-continuous-output-version-2-system"><a class="header" href="#normal-operation-of-the-continuous-output-version-2-system">Normal operation of the continuous output version 2 system</a></h2>
<p>When using the system in production, always start Navitrol so that the reflector target is visible for both scanners to ensure that the position offset calculation can calibrate itself.</p>
<p>When the common data field in the data output contains position data, the calibration is ready and the system will give offset corrected position data even when a part of the reflector pattern is hidden.</p>
<p>Drive the AGV’s under the load and use the reflector detection results with the following priority:</p>
<ol>
<li>
<p>Prioritize the common data field. The common data is a combination of the separate detections and therefore has the best accuracy and fitness. It is also somewhat filtered for flickering as it is a mean of two detections. If the separate scanners give diverging results, the common data reports the data with better fitness, so also in this case it is better.</p>
</li>
<li>
<p>If the auto calibration has not worked or goes off because of too big differences in the separate scanner positions, the common data gets empty (all values zero).</p>
<ul>
<li>
<p>In this case the front (left) scanner is the master and should preferably be used.</p>
</li>
<li>
<p>If the front (left) scanner has a very low fitness and the rear scanner (right) has a very high fitness the rear scanner data can be used until both scanners see the entire pattern again and the auto calibration can correct the offset. <strong>NOTE</strong>, that in this case there is an offset between front and rear scanner and it must be taken into account in the AGV control and the rear scanner must then be used until auto calibration can correct the offset again.</p>
</li>
</ul>
</li>
</ol>
<p>The separate front and rear data fields will be zero when less than 3 reflectors are detected with that scanner.</p>
<h2 id="target-detection-output-of-the-version-2-system-in-continuous-mode"><a class="header" href="#target-detection-output-of-the-version-2-system-in-continuous-mode">Target detection output of the version 2 system in continuous mode</a></h2>
<p>Positioning result from two scanners with a common part with combined data.</p>
<p>The combined data is empty if only one scanner is used. When two scanners are used, the common data contains a combination of both scanners’ results always, when the separate results match with a certain accuracy.</p>
<p>There is an automatic offset calibration between the scanners, which is removing small scanner position parameter errors. It is active when both scanners see the whole reflector pattern. When the offset has tuned in, so that both scanners give the same result the common data is filled, even when the scanners are not detecting the entire reflector pattern.</p>
<table><thead><tr><th><strong>Data field</strong></th><th><strong>Type</strong></th><th><strong>Length (bytes)</strong></th><th><strong>Value / Explanation</strong></th></tr></thead><tbody>
<tr><td>Protocol version</td><td>Uint</td><td>2</td><td>4</td></tr>
<tr><td>Message ID</td><td>Uint</td><td>2</td><td>4104</td></tr>
<tr><td>Message length</td><td>Uint</td><td>4</td><td>52</td></tr>
<tr><td>Scanner1 Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in world coordinates</td></tr>
<tr><td>Scanner1 Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in world coordinates</td></tr>
<tr><td>Scanner1 Target Angle</td><td>Float</td><td>4</td><td>Target Angle in radians in world coordinates</td></tr>
<tr><td>Scanner1 Target found</td><td>Byte</td><td>1</td><td>0 - Target not found, N[3…8] reflectors detected</td></tr>
<tr><td>Scanner1 Fitness</td><td>Byte</td><td>1</td><td>0…100 %   <br> 0 - target not found  <br> 100 - all reflectors detected, ideal match</td></tr>
<tr><td>Scanner1 comms</td><td>Byte</td><td>1</td><td>Scanner communication status	: 1 OK <br> 0 Not OK</td></tr>
<tr><td>Scanner2 Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in world coordinates</td></tr>
<tr><td>Scanner2 Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in world coordinates</td></tr>
<tr><td>Scanner2 Target Angle</td><td>Float</td><td>4</td><td>Target Angle in radians in world coordinates</td></tr>
<tr><td>Scanner2 Target found</td><td>Byte</td><td>1</td><td>0 - Target not found, N[3…8] reflectors detected</td></tr>
<tr><td>Scanner2 Fitness</td><td>Byte</td><td>1</td><td>0…100 %   <br> 0 - target not found  <br> 100 - all reflectors detected, ideal match</td></tr>
<tr><td>Scanner2 comms</td><td>Byte</td><td>1</td><td>Scanner communication status	: 1 OK <br> 0 Not OK</td></tr>
<tr><td>Combined Target X</td><td>Float</td><td>4</td><td>Target X-coordinate in world coordinates</td></tr>
<tr><td>Combined Target Y</td><td>Float</td><td>4</td><td>Target Y-coordinate in world coordinates</td></tr>
<tr><td>Combined Target Angle</td><td>Float</td><td>4</td><td>Target Angle in radians in world coordinates</td></tr>
<tr><td>Combined Target found</td><td>Byte</td><td>1</td><td>0 - Target not found, N[3…8] reflectors detected</td></tr>
<tr><td>Combined Fitness</td><td>Byte</td><td>1</td><td>0…100 %   <br> 0 - target not found  <br> 100 - all reflectors detected, ideal match</td></tr>
</tbody></table>
<h2 id="setting-up-and-calibrating-a-version-2-system-for-target-detection-and-docking"><a class="header" href="#setting-up-and-calibrating-a-version-2-system-for-target-detection-and-docking">Setting up and calibrating a version 2 system for target detection and docking</a></h2>
<p>In normal target detection applications for localizing and docking to a target, the version 2 system is set up as the continuous one, except for the measurement mode</p>
<p><strong>I,target_detection_always_enabled,	0 for docking</strong></p>
<p>defining that detection is only activated when approaching a symbolic point with target detection enabled. For more information on docking, see <a href="TargetAndObstacleDetection/PatternDetection/../../PositionControl/Docking/Docking-en.html">Docking</a>.</p>
<p>Since the target is normally approached with one scanner directed towards the target, the scanner selection is set to one scanner use:</p>
<p><strong>I,target_detection_scan_selection,	1 - rear scanner only, 2 - front scanner only</strong></p>
<p>Since the detection scanner is normally also used for navigation, the scan data should be more extensively used.</p>
<p><strong>I,scan_pef_use_nth_meas,	2 to maximize the scan points for positioning</strong></p>
<p>In this mode the detection data is used internally for controlling the vehicle to the target marked with the reflectors. The extensive detection data is not output to the PLC.</p>
<p>The scanner calibration is done as in the pallet detection case.</p>
<p>The detection range is approximately as below</p>
<p><img src="TargetAndObstacleDetection/PatternDetection/./media-en/detection_range.png" alt="detection range" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="obstacle-detection-1"><a class="header" href="#obstacle-detection-1">Obstacle Detection</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="introduction-53"><a class="header" href="#introduction-53">Introduction</a></h2>
<p>Obstacle detection feature detects the obstacles in a predefined area around the AGV and outputs them as a list of lines. The detected obstacles does not affect driving in any way, so the AGV will not slow down, stop, or try to avoid those obstacles.</p>
<p>Obstacle detection feature is most commonly used with positioning only AGV systems and in AGV systems that have their own external obstacle avoidance logic implemented.</p>
<p>This feature should not be confused with the &quot;Obstacle Avoidance&quot; feature, which is capable to stop the AGV before detected obstacles and plan routes around them. In case you are interested in those functionalities check &quot;Navitrol - Obstacle Avoidance&quot; document.</p>
<h2 id="setting-up-and-navitrol-parameters"><a class="header" href="#setting-up-and-navitrol-parameters">Setting Up and Navitrol Parameters</a></h2>
<p>This feature requires</p>
<ul>
<li>&quot;obstacle avoidance&quot;-license, so please order that it to enable obstacle detection.</li>
<li>The ethernet supervisor interface with messages 3049 and 3149 implemented</li>
</ul>
<p>In Navitrol, add and adjust the following parameters to enable and fine tune the feature:</p>
<table><thead><tr><th>Parameters</th><th>Description</th></tr></thead><tbody>
<tr><td>I, obst_detection_mode, 1</td><td>Enable obstacle detection:<br>0 = disabled<br>1 = enabled</td></tr>
<tr><td>I, obst_detection_scanners, 3</td><td>Defines which localization scanners are used for obstacle detection:<br>0 = none<br>1 = rear scanner only<br>2 = front scanner only<br>3 = both scanners</td></tr>
<tr><td>I, obst_detection_meas_scanners, 0</td><td>Defines which measurement scanners are used for obstacle detection:<br>0 = none<br>1 = first scanner only<br>2 = second scanner only<br>3 = both scanners</td></tr>
<tr><td>F,obst_detection_max_dist_in_object, 0.20</td><td>Maximum distance between scan points for them to be considered the same detected object.<br>For example, in this case if there are two scan point clusters that are more than 20 cm apart, they will be considered two separate objects, so separate lines will be detected for each</td></tr>
<tr><td>F, obst_detection_max_dist_from_line, 0.05</td><td>Maximum distance a scan point can have from the detected line. This means that there will be a scan point in the detected area maximum this much away from detected lines.</td></tr>
<tr><td>I, log_obst_detection</td><td>Log obstacle detection, 0 - none, 1 - result line counts, 2 - detailed logging, 3- log all lines<br>It is recommended to set this value to 2 when starting to use the feature and to 3 if there is any issues. Otherwise it can be kept disabled with 0 value.</td></tr>
</tbody></table>
<p>Once these parameters are set, the predefined obstacle detection area can be defined as explained in Chapter 3, and the detected lines will be provided in the format explained in Chapter 4.</p>
<h2 id="obstacle-detection-area"><a class="header" href="#obstacle-detection-area">Obstacle Detection Area</a></h2>
<p>The obstacle detection area is defined in the AGV coordinate system as a partial circle. This area should be provided by defining its radius, starting angle and end angle using the &quot;Ethernet supervisor interface&quot;. Starting and ending angles should be defined in degrees between -180 and 180, such that directly in front of the AGV is considered 0 degrees, and counter-clockwise angles are positive. A representation of this convention can be seen in the figure below.</p>
<p><img src="TargetAndObstacleDetection/ObstacleDetection/./media-en/image3.PNG" alt="" /></p>
<p>If it the AGV should detect obstacles in all angles within the radius, the starting angle should be set to -180 and the end angle should be 180 degrees. Conversely, to not detect any obstacles, the radius can be set to 0 meters.</p>
<p><img src="TargetAndObstacleDetection/ObstacleDetection/./media-en/image4.PNG" alt="" /></p>
<p>For example, in the picture above, the radius is 3 meters, starting angle is -60 degrees and end angle is 60 degrees.</p>
<p><img src="TargetAndObstacleDetection/ObstacleDetection/./media-en/image5.PNG" alt="" /></p>
<p>Conversely, in the picture above, starting angle is 60 degrees while end angle is -60 degrees.</p>
<p>The obstacle detection area can be defined with the message 3049 from supervisor. Please see the ethernet communication document for the expected format of the message.</p>
<h2 id="detected-obstacle-lines"><a class="header" href="#detected-obstacle-lines">Detected Obstacle Lines</a></h2>
<p>Navitrol will provide obstacles in form of lines, that are defined by starting point coordinates and end point coordinates. The detected lines will also be visualized in Navitrol Monitor as black lines, as visualized in the figure below:</p>
<p><img src="TargetAndObstacleDetection/ObstacleDetection/./media-en/image6.PNG" alt="" /></p>
<p>All scanner points that are in the detected area will be at most &quot;obst_detection_max_dist_from_line&quot; away from one of the lines. In case a single point is detected that could not be in any of the lines, it will be given as a line with the same starting and end point.</p>
<p>The detected lines will be reported to the supervisor with the message 3149. Please see the ethernet communications document for the format of the message.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="external-target-detection"><a class="header" href="#external-target-detection">External Target Detection</a></h1>
<p>Updated 26.07.2024</p>
<hr />
<h2 id="introduction-54"><a class="header" href="#introduction-54">Introduction</a></h2>
<p>External target detection stands for a target detection feature where Navitrol receives target X,Y and heading difference to the target and external sensor detects this target. Thus, Navitrol does not do target detection itself, Navitrol only receives the position of the desired target from external target detection system.</p>
<p>This external target detection system can be whatever (meaning laser scanner, camera, ultrasound sensor etc) as long as it can produce X.Y and heading difference information of the target to Navitrol.</p>
<h2 id="functionality-1"><a class="header" href="#functionality-1">Functionality</a></h2>
<p>For the external target detection, Navitrol will send this information:</p>
<ol>
<li>
<p>When to start detection of the target, based on requirements below:</p>
<ul>
<li>
<p>Normal Pickup symbolic point</p>
<ul>
<li>The maximum angle between the camera and symbolic point before starting the detection.</li>
<li>Distance to the symbolic point before starting the detection.</li>
</ul>
</li>
<li>
<p>Racking</p>
<ul>
<li>When AGV is close to the shelf and actuator is lifted to the shelf height, but AGV has not yet driven in to the shelf.</li>
</ul>
</li>
<li>
<p>Buffer lanes</p>
<ul>
<li>AGV is inside buffer area + <strong>buffer_check_start_dist_offset_m</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>X, Y, Z and angle difference to the assumed target position (symbolic point) with respect to the sensor in AGV coordinates. With this external target detection system can define the area where to search the target (pallet width + max allowed position error).</p>
</li>
<li>
<p>Information if target is detected too far away from the route/symbolic point.</p>
</li>
</ol>
<p>Navitrol receives target position difference and target locked information. In addition, Error code and Device type fields to the message (message <strong>3035 external target detection request</strong>)</p>
<p>Navitrol has to receive the position information of the target from the external target detection system:</p>
<ol>
<li>
<p><strong>dX and dY</strong> With respect to the sensor in sensor coordinate as frame as defined in Navitrol (values <strong>dX</strong> and <strong>dY)</strong></p>
</li>
<li>
<p>Heading H as the target heading with respect to the sensor heading.
(<strong>H</strong> target heading is 90 degrees in this picture)</p>
</li>
</ol>
<p><img src="TargetAndObstacleDetection/ExternalTargetDetection/./media-en/image4.jpeg" alt="" /></p>
<p><img src="TargetAndObstacleDetection/ExternalTargetDetection/./media-en/image5.png" alt="" /></p>
<h3 id="buffer-lanes-3"><a class="header" href="#buffer-lanes-3">Buffer lanes</a></h3>
<ul>
<li>AGV start requesting detection as soon as it is inside the buffer area + <strong>buffer_check_start_dist_offset_m</strong>.</li>
<li>The initial target position is the symbolic point, but the once the target is found the target position is updated to the detected target position. The target height (Z) is 0.</li>
<li>Can be configured in a way that AGV waits only one result or update within specified interval. See <strong>ext_target_det_sensor_update_rate_ms</strong> parameter below.</li>
<li>AGV does not stop for detection. </li>
<li>Pickup: If no target result received until the end of the buffer, Navitrol will trigger WARNING_TARGET_APPROACH_ERROR.</li>
<li>Dropoff: If no target result received until the end of the buffer, Navitrol will perform dropoff on top of symbolic point.</li>
</ul>
<h3 id="racking-1"><a class="header" href="#racking-1">Racking</a></h3>
<ul>
<li>AGV start requesting detection when it is close to the shelf and actuator is lifted to the shelf height, but AGV has not yet driven in to the shelf.
<ul>
<li>The assumed target position is the symbolic point, the target height (Z) is the shelf height.</li>
</ul>
</li>
<li>Should be configured in a way that AGV waits only one result. <strong>ext_target_det_sensor_update_rate_ms</strong> parameter as 0.
<ul>
<li>AGV continues driving and docks to the target once target position is received</li>
<li>If no target result is received within 3 seconds or received target is too far from the symbolic point, ERROR_PALLET_DET_FAILURE error is set. See <a href="TargetAndObstacleDetection/ExternalTargetDetection/../../LoadHandling/Racking/Racking-en.html">Racking</a> document for more info.</li>
</ul>
</li>
</ul>
<h3 id="stacking"><a class="header" href="#stacking">Stacking</a></h3>
<ul>
<li>AGV start requesting detection as soon as it is inside the buffer area + <strong>buffer_check_start_dist_offset_m</strong>.</li>
<li>The initial target position is the symbolic point, but once the target is found the target position is updated to the detected target position. The target height (Z) is the estimated height. See <strong>ext_target_det_height_mode</strong> parameter.</li>
<li>Can be configured in a way that AGV waits only one result or update within specified interval. See <strong>ext_target_det_sensor_update_rate_ms</strong> parameter below.</li>
<li>AGV does not stop for detection. </li>
<li>When target position is received, Navitrol will stop in front of the stack and move the actuator to estimated height that is given with a drive order from fleet control.</li>
<li>New target detection is requested and target Z is needed to tell the target height for the actuator.</li>
<li>If target detection is not received within <strong>block_stacking_max_detection_wait_time_ms</strong>, 
<ul>
<li>On Pickup, ERROR_PALLET_POCKET_NOT_FOUND is set.</li>
<li>On Dropoff, dropoff is performed to the ground if there is space on the buffer lane or if buffer is full, AGV waits for new drive order. </li>
</ul>
</li>
<li>If target detection is received, Navitrol will control the actuator to the specified height and will continue driving to stack for pickup or dropoff.</li>
<li>See <a href="TargetAndObstacleDetection/ExternalTargetDetection/../../LoadHandling/StackLoading/StackLoading-en.html">Pickup from stack</a> and <a href="TargetAndObstacleDetection/ExternalTargetDetection/../../LoadHandling/BlockStacking/BlockStacking-en.html">Dropoff to stack</a> documents for more info.</li>
</ul>
<h2 id="mode"><a class="header" href="#mode">Mode</a></h2>
<p>There are two possible modes for external target detection. </p>
<ol>
<li>Navitrol expects detection results within <strong>ext_target_det_sensor_update_rate_ms</strong> timer when detection is requested. If detection result is coming later than this parameter, detection is not requested.</li>
<li>Navitrol expects only one detection result. This can be activated with <strong>ext_target_det_sensor_update_rate_ms</strong> as 0. Navitrol request detection until it has received the result. Error is set if response is not received in time. See <strong>ext_target_det_response_timeout_ms</strong> parameter.</li>
</ol>
<h2 id="parameters-13"><a class="header" href="#parameters-13">Parameters</a></h2>
<p>These parameters must be set to params.txt file when external target detection is used. For more information on docking, see <a href="TargetAndObstacleDetection/ExternalTargetDetection/../../PositionControl/Docking/Docking-en.html">Docking</a>.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>I,target_detection_type_selection, 4</strong></td><td>4 = external target detection. This parameter activates external target detection feature.</td></tr>
<tr><td><strong>F,target_detection_max_dist_to_symbolic_point, 6.0</strong></td><td>Max distance to the symbolic point to start sending &quot;start observing&quot; signal to the external target detection sensor</td></tr>
<tr><td><strong>I,docking_to_target_enabled, 1</strong></td><td>1 = Enables docking to target.<br>2 = **not supported with external target detection</td></tr>
<tr><td><strong>F,docking_max_start_distance, 3.5</strong></td><td>Beyond maximum distance docking won't be triggered</td></tr>
<tr><td><strong>F,docking_max_start_angle, 20.000000</strong></td><td>Max angle difference from navigation point to the target compared to tarjectory's end point's heading, when starting to dock [+-degrees fov]</td></tr>
<tr><td><strong>F,docking_max_start_heading, 45.000000</strong></td><td>Max angle diff for vehicle heading and trajectory's end point heading, when starting to dock [+-degrees fov]</td></tr>
<tr><td><strong>F,ext_target_det_sensor_x_pos, 0.0</strong></td><td>External target detection sensor x position with respect to the AGV navigation point. Positive towards front of the vehicle</td></tr>
<tr><td><strong>F,ext_target_det_sensor_y_pos, 0.0</strong></td><td>External target detection sensor y position with respect to the AGV navigation point. Positive to the left side of the vehicle</td></tr>
<tr><td><strong>F,ext_target_det_sensor_angle_deg, 0.0</strong></td><td>External target detection sensor heading with respect to the AGV heading.</td></tr>
<tr><td><strong>I,ext_target_det_sensor_update_rate_ms, 500</strong></td><td>External target detection data is sent to supervisor every second when target is not detected. This parameter defines the update interval when target detection is activated. Maximum value 900 ms. 0 = Expect target detection only once when requested.</td></tr>
<tr><td><strong>I,ext_target_det_measurement_delay_ms, 50</strong></td><td>Delay of sensor measurement in ms relative to AGV position measurements. Maximum value 300 milliseconds</td></tr>
<tr><td><strong>F,ext_target_min_dist_from_traj_end_to_nav_point, 0.40</strong></td><td>Minimum distance from navigation point to trajectory end that target position is still updated</td></tr>
<tr><td><strong>F,ext_target_det_target_rendering_width, 0.9</strong></td><td>External target detection target width when rendered to NavitrolMonitor. Does not affect to any calculations.</td></tr>
<tr><td><strong>F,ext_target_det_target_rendering_length, 0.4</strong></td><td>External target detection target width when rendered to Monitor. Does not affect to any calculations.</td></tr>
<tr><td><strong>I,ext_target_det_height_mode, 0</strong></td><td>0 = External target detection z value is used as reference height for actuator. E.g. z = 0.9m, actuator reference will be 900mm. <br>1 = z value is in sensor coordinates. E.g. value 0.2m would lift actuator 200mm from its current height.</td></tr>
<tr><td><strong>U, log_ext_target_det, 0</strong></td><td>Enables logging of external target detection data. 0 - disabled, 1 - enabled</td></tr>
<tr><td><strong>I,ext_target_det_response_timeout_ms, 2000</strong></td><td>Time to wait [ms] for target detection response. Error is set if Navitrol doesn't receive response within this time. If set to 0, error is never set. Only used when ext_target_det_sensor_update_rate_ms is 0.</td></tr>
</tbody></table>
<h2 id="supervisor-interface-configuration"><a class="header" href="#supervisor-interface-configuration">Supervisor interface configuration</a></h2>
<h3 id="3135----external-target-detection-request"><a class="header" href="#3135----external-target-detection-request">3135 -- External target detection request</a></h3>
<p>Navitrol sends this message periodically to the <em>Supervisor/PLC for</em> external target detection. The sending interval is 1 Hz while the target detection is inactive. When the target detection is active, the sending interval is according to a parameter. The parameter value shall be set according to the sensor update rate. Target searching is activated at a certain distance to the symbolic point and deactivated again when the target is reached or when the target finding fails because of too short remaining distance to the symbolic point.</p>
<table><thead><tr><th>Data field</th><th>Type</th><th>Length (bytes)</th><th>Comment</th></tr></thead><tbody>
<tr><td>Protocol Version = 4</td><td>Unsigned Short</td><td>2</td><td>Navitrol ethernet protocol version</td></tr>
<tr><td>Message ID = 3135</td><td>Unsigned Short</td><td>2</td><td></td></tr>
<tr><td>Message length = 28</td><td>Unsigned Integer</td><td>4</td><td>Message length in bytes including all data fields (including Protocol Version and Message ID)</td></tr>
<tr><td>Start detection</td><td>Unsigned Short</td><td>2</td><td>1 - Start detecting the target<br>0 - Stop detecting</td></tr>
<tr><td>Assumed target position X difference</td><td>Float</td><td>4</td><td>Distance from sensor position along the centre line of the detection sensor view.</td></tr>
<tr><td>Assumed target position Y difference</td><td>Float</td><td>4</td><td>Distance from sensor position perpendicular to the center line of the detection sensor view.<br>Positive to the left.</td></tr>
<tr><td>Assumed target position Z difference</td><td>Float</td><td>4</td><td>Distance from sensor position in vertical direction.<br>Positive direction upwards.<br>Value forced to 0</td></tr>
<tr><td>Assumed target angle difference</td><td>Float</td><td>4</td><td>Angle of the target with respect to the X-axis.<br>Positive in CCW direction.</td></tr>
<tr><td>Detection too far from route</td><td>Unsigned short</td><td>2</td><td>1 = target detected too far away.<br>Otherwise, value is 0</td></tr>
</tbody></table>
<h3 id="3035----external-target-detection-response"><a class="header" href="#3035----external-target-detection-response">3035 -- External target detection response</a></h3>
<p>The supervisor replies to the detection request from Navitrol with target found information and target x, y, z and angle. Additionally, the Supervisor sends the error code if the sensor goes into error state. </p>
<table><thead><tr><th>Data field</th><th>Type</th><th>Length (bytes)</th><th>Comment</th></tr></thead><tbody>
<tr><td>Protocol Version = 4</td><td>Unsigned Short</td><td>2</td><td>Navitrol ethernet protocol version</td></tr>
<tr><td>Message ID = 3035</td><td>Unsigned Short</td><td>2</td><td></td></tr>
<tr><td>Message length = 38</td><td>Unsigned Integer</td><td>4</td><td>Message length in bytes including all data fields (including Protocol Version and Message ID)</td></tr>
<tr><td>Target X difference from sensor</td><td>Float</td><td>4</td><td>X is the center line of the detection sensor view</td></tr>
<tr><td>Target Y difference from sensor</td><td>Float</td><td>4</td><td>Y to the left from sensor  X-axis</td></tr>
<tr><td>Target Z difference from sensor</td><td>Float</td><td>4</td><td>Z is in vertical direction.<br>Positive direction upwards.<br>Value forced to 0</td></tr>
<tr><td>Target angle difference between sensor heading and target heading</td><td>Float</td><td>4</td><td>0 along sensor X-axis, positive in CCW direction</td></tr>
<tr><td>Target found</td><td>Unsigned short</td><td>2</td><td>0 = target not found<br>1 = target found</td></tr>
<tr><td>Error code</td><td>Unsigned integer</td><td>4</td><td>Device error code number<br>Value 0 = no errors</td></tr>
<tr><td>Reserved bytes</td><td>Integer</td><td>4</td><td>Value forced to 0</td></tr>
<tr><td>Reserved bytes</td><td>Integer</td><td>4</td><td>Value forced to 0</td></tr>
</tbody></table>
<h3 id="troubleshooting-43"><a class="header" href="#troubleshooting-43">Troubleshooting</a></h3>
<p>To enable more extensive logging set parameter U, log_ext_target_det, 1. The logging has prefix &quot;ExtTarDet:&quot;.</p>
<p>Different errors related to external target detection can be found from <a href="TargetAndObstacleDetection/ExternalTargetDetection/../../Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html">Error Descriptions</a> document.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="table-detection"><a class="header" href="#table-detection">Table detection</a></h1>
<p>Updated 21.03.2024</p>
<h2 id="overview-38"><a class="header" href="#overview-38">Overview</a></h2>
<h3 id="introduction-55"><a class="header" href="#introduction-55">Introduction</a></h3>
<p>The table detection feature can be used to accurately dock under a table in situations where static environment is scarce or occluded by the table legs.</p>
<p>The initial location of the table is detected using the pallet detection feature but further positioning and docking is done based on the table legs instead of the static environment. This ensures increased docking accuracy compared to pure pallet detection. For more information on docking, see <a href="TargetAndObstacleDetection/TableDetection/../../PositionControl/Docking/Docking-en.html">Docking</a>.</p>
<h3 id="requirements-27"><a class="header" href="#requirements-27">Requirements</a></h3>
<p>For the table detection feature to work following requirements must be met:</p>
<ul>
<li>Pallet detection v2 set up so that the table can be detected
<ul>
<li>See <a href="TargetAndObstacleDetection/TableDetection/../PalletDetection/PalletDetection-en.html">Navitrol - Pallet Detection Instructions</a> document for more information.</li>
<li>Note: requires pallet detection license</li>
</ul>
</li>
<li>The scanners must be 
<ul>
<li>Calibrated </li>
<li>Properly placed so that the table legs are visible during the entire docking procedure. See Figure on clustering of table legs</li>
</ul>
</li>
</ul>
<h3 id="limitations-25"><a class="header" href="#limitations-25">Limitations</a></h3>
<ul>
<li>The table must have four legs</li>
</ul>
<h3 id="dependencies-15"><a class="header" href="#dependencies-15">Dependencies</a></h3>
<p>Requires that Pallet detection v2 is active so other target detection features cannot be used simultaneously.</p>
<h2 id="how-to-use-23"><a class="header" href="#how-to-use-23">How to use</a></h2>
<p>The AGV detects the table using pallet detection v2 as normally, and automatically continues detection using this feature once the target is locked, if the feature is enabled. The detection continues inside the table. The pose of the table is estimated most accurately when both the front and rear legs are detected, but will also work when only the rear legs are detected. Each cluster, in this case leg, will provide two geometric centroids, a centre point (x,y) coordinate for the vertical and horizontal segments, totalling 8 centroids in total at maximum for the table. The centroid are used to estimate the table pose. A centroid in this context refers to the centre of mass for the scanner points. The pallet is visible as a green rectangle in the Monitor. </p>
<h2 id="set-up-12"><a class="header" href="#set-up-12">Set up</a></h2>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I,pallet_det_2_relative_target_det_after_locking</td><td>1</td><td>Enable the table detection by setting to 1</td></tr>
<tr><td>F,pallet_det_polygon_cluster_margin_width</td><td>0.1</td><td>Width margin for clustering polygons, visualized in Figure below</td></tr>
<tr><td>F,pallet_det_polygon_cluster_margin_length</td><td>0.1</td><td>Length margin for clustering polygons, visualized in Figure below</td></tr>
<tr><td>I, log_table_detection</td><td>1</td><td>Enable detailed logging mode by setting to 1</td></tr>
</tbody></table>
<p>The clustering of the table legs is done based on the locked pose and target model, obtained from pallet detection v2. The clusters are centered around the geometric centre point of the leg. All points inside the polygons, in the Figure below seen as orange rectangles, are clustered together.</p>
<p><img src="TargetAndObstacleDetection/TableDetection/./media-en/clustering.PNG" alt="" /></p>
<blockquote>
<p>Clustering of table legs. The orange rectangles are the polygons, the black rectangles is the table and its legs, and the grey rectangle is the AGV. </p>
</blockquote>
<p>The size of the clusters is determined by parameters:<br />
<strong>pallet_det_polygon_cluster_margin_length</strong><br />
<strong>pallet_det_polygon_cluster_margin_width</strong><br />
<strong>pallet_model_side_leg_length_x</strong><br />
<strong>pallet_model_side_leg_width_y</strong></p>
<p>The assumption is that the table has four legs and that at least 8 scanner points are detected per horizontal and vertical side of the table leg. This is dependent on the distance to legs and the resolution of the scanner(s). The clusters are filtered based on distance and angle, to create vertical and horizontal segments of each cluster. </p>
<h3 id="fine-tuning-10"><a class="header" href="#fine-tuning-10">Fine tuning</a></h3>
<p>The larger the margins, the bigger the risk of false positives, as surrounding scanner points might be clustered to one table leg. However, if the margins are too small, the table legs might not be clustered if the AGV pose drifts. The default values are recommended, however, in the event that the AGV pose drift is larger the margins can be increased. If the AGV pose drift is normally small during docking and the tables are close to each other, decreasing the margins is recommended to prevent clustering neighbouring table legs.</p>
<h2 id="troubleshooting-44"><a class="header" href="#troubleshooting-44">Troubleshooting</a></h2>
<h3 id="the-target-docking-pose-is-too-sensitive-to-agv-pose-fluctuations"><a class="header" href="#the-target-docking-pose-is-too-sensitive-to-agv-pose-fluctuations">The target docking pose is too sensitive to AGV pose fluctuations</a></h3>
<p>Decrease <strong>target_detection_results_dampening</strong>. The aforementioned parameter is used to compute the average pose of several measurements.</p>
<h3 id="the-target-docking-pose-is-not-sensitive-enough-to-agv-pose-fluctuations"><a class="header" href="#the-target-docking-pose-is-not-sensitive-enough-to-agv-pose-fluctuations">The target docking pose is not sensitive enough to AGV pose fluctuations</a></h3>
<p>Increase <strong>target_detection_results_dampening</strong></p>
<h3 id="advanced-troubleshooting-13"><a class="header" href="#advanced-troubleshooting-13">Advanced troubleshooting</a></h3>
<p>Read this section for help with troubleshooting, if the table has been detected by pallet detection v2 and the docking target has been locked, but the docking target does not update continuosly. </p>
<p>The centroids are logged in map coordinates as <strong>Table detection - centroids</strong>, the validity of the centroids are logged with prefix <strong>Table detection - flv</strong>.</p>
<table><thead><tr><th>Abbrevation</th><th>Explanation</th></tr></thead><tbody>
<tr><td><strong>flv</strong></td><td>front left vertical segment</td></tr>
<tr><td><strong>frv</strong></td><td>front right vertical segment</td></tr>
<tr><td><strong>rlv</strong></td><td>rear left vertical segment</td></tr>
<tr><td><strong>rlh</strong></td><td>rear left horizontal segment</td></tr>
<tr><td><strong>rrv</strong></td><td>rear right vertical segment</td></tr>
<tr><td><strong>rrh</strong></td><td>rear right horizontal segment</td></tr>
</tbody></table>
<blockquote>
<p>Centroid logging abbreviations</p>
</blockquote>
<p>The logging for this feature has prefix <strong>Table detection</strong>. </p>
<p>If the deviation from last computed table pose is less than <strong>pallet_det_polygon_cluster_margin_width</strong> and <strong>pallet_det_polygon_cluster_margin_length</strong> the pose is valid, and the following will be logged:<br />
<strong>Table detection pose valid</strong></p>
<p>The estimated table pose in global coordinates is logged as:<br />
<strong>Table detection pose [map coord]</strong>, providing the x,y,h (degrees) pose of the table.</p>
<h3 id="the-centroids-are-found-but-do-not-conform-with-scanner-data-for-legs"><a class="header" href="#the-centroids-are-found-but-do-not-conform-with-scanner-data-for-legs">The centroids are found, but do not conform with scanner data for legs</a></h3>
<p>Decrease or increase the polygon margins (<strong>pallet_det_polygon_cluster_margin_width/length</strong>), depending on the initial values</p>
<h3 id="the-centroids-are-invalid-and-a-pose-estimate-is-not-obtained"><a class="header" href="#the-centroids-are-invalid-and-a-pose-estimate-is-not-obtained">The centroids are invalid and a pose estimate is not obtained</a></h3>
<p>Increase the polygon margins (<strong>pallet_det_polygon_cluster_margin_width/length</strong>)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wall-monitoring"><a class="header" href="#wall-monitoring">Wall monitoring</a></h1>
<p>Updated 26.01.2024</p>
<h2 id="overview-39"><a class="header" href="#overview-39">Overview</a></h2>
<h3 id="introduction-56"><a class="header" href="#introduction-56">Introduction</a></h3>
<p>The wall monitoring feature is used for obstacle detection. A slowdown or stop trigger is activated if the AGV's frame is at a certain distance from the obstacle. For obstacle avoidance, see document <a href="TargetAndObstacleDetection/Wallmonitoring/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance</a>.</p>
<h3 id="limitations-26"><a class="header" href="#limitations-26">Limitations</a></h3>
<ul>
<li>Not a safety feature</li>
<li>Only applicable to position control machine types</li>
<li>Maximum two scanners</li>
<li>The AGV frame dimensions cannot be smaller than the difference between slow and stop distance</li>
</ul>
<h2 id="how-to-use-24"><a class="header" href="#how-to-use-24">How to use</a></h2>
<p>All valid scanner points at a distance larger than <strong>wallmon_min_scan_dist</strong> are evaluated for wall monitoring. The AGV frame is extrapolated in the current AGV frame direction in increments of <strong>wallmon_pred_ds</strong>. The AGV frame is defined by parameters <strong>dim_rear</strong>, <strong>dim_front</strong>, <strong>dim_left</strong>, <strong>dim_right</strong> and <strong>wallmon_pred_safety_margin</strong>. See Figure below. If more points than <strong>wallmon_min_hits</strong> occupy the AGV frame, the AGV will either slow down or stop depending on the distance to the obstacle.</p>
<p><img src="TargetAndObstacleDetection/Wallmonitoring/./media-en/agv_frame_and_margin.png" alt="" /></p>
<blockquote>
<p>The AGV frame used for wall monitoring. The black dashed rectangle visualizes the complete AGV frame including the margin.</p>
</blockquote>
<h2 id="set-up-13"><a class="header" href="#set-up-13">Set up</a></h2>
<h3 id="quick-start-15"><a class="header" href="#quick-start-15">Quick start</a></h3>
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>I, wallmon_enabled</td><td>1</td><td>Enables wall monitor feature that can be used to stop the AGV based on detected nearby objects.</td></tr>
<tr><td>F, wallmon_slow_dist</td><td>0.4</td><td>Slow down if scan points are detected closer than this</td></tr>
<tr><td>F, wallmon_stop_dist</td><td>0.1</td><td>Stop if scan points are detected closer than this.</td></tr>
</tbody></table>
<h3 id="fine-tuning-11"><a class="header" href="#fine-tuning-11">Fine-tuning</a></h3>
<p><strong>Optional parameters</strong></p>
<table><thead><tr><th>Parameter</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>F, wallmon_stop_manual_speed</td><td>0.0</td><td>Control speed that is used instead of stopping when soft stop, hard stop or emergency stop is active during manual mode.</td></tr>
<tr><td>F, wallmon_pred_ds</td><td>0.01</td><td>Step size for wall monitor collision prediction in meters. Lower value takes more processing time but is more accurate.</td></tr>
<tr><td>F, wallmon_pred_safety_margin</td><td>0.05</td><td>How close to the AGV's predicted frame the scans must be to trigger slow or stop.</td></tr>
<tr><td>I, wallmon_min_hits</td><td>3</td><td>Minimum scanner measurement hits required within wall monitor's stop and slow safety areas to trigger slow or stop.</td></tr>
<tr><td>F, wallmon_min_scan_dist</td><td>0.01</td><td>Scanner measurements from shorter distances [m] than this are ignored. Can be used to avoid false positives caused by noise.</td></tr>
</tbody></table>
<h2 id="troubleshooting-45"><a class="header" href="#troubleshooting-45">Troubleshooting</a></h2>
<h3 id="advanced-troubleshooting-14"><a class="header" href="#advanced-troubleshooting-14">Advanced troubleshooting</a></h3>
<p>All related logging is under prefix &quot;Wallmon&quot;.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="occupancy-check"><a class="header" href="#occupancy-check">Occupancy check</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-40"><a class="header" href="#overview-40">Overview</a></h2>
<h3 id="introduction-57"><a class="header" href="#introduction-57">Introduction</a></h3>
<p>Occupancy check is a feature for detecting with laser scanners if an area is occupied and preventing the AGV from driving there. The area is linked to a symbolic point. The occupancy of the area is checked when the AGV is driving towards the symbolic point on the AGV's path. The AGV is stopped waiting in front of the symbolic point in Auto state if the area is occupied. The AGV continues to drive towards the symbolic point when the area becomes free again.</p>
<p><img src="TargetAndObstacleDetection/OccupancyCheck/./media-en/OccupancyCheckMonitor.png" alt="" /></p>
<h3 id="requirements-28"><a class="header" href="#requirements-28">Requirements</a></h3>
<ul>
<li>Navitrol 6.24.00 or later</li>
<li>NavithorTools</li>
<li>Scanner position and heading is calibrated, see <a href="TargetAndObstacleDetection/OccupancyCheck/../../Introduction/InitialCalibrationGuide/InitialCalibrationGuide-en.html">Initial calibration guide</a></li>
</ul>
<h3 id="limitations-27"><a class="header" href="#limitations-27">Limitations</a></h3>
<ul>
<li>Supports 2D laser scanners only</li>
<li>Occupancy check is based on number of scanner beam hits inside of the occupancy check area. No filtering or pattern detection is applied.</li>
<li>The feature can be used to prevent AGV from driving into area where a collision might happen but it is not a safety system.</li>
</ul>
<hr />
<h2 id="set-up-14"><a class="header" href="#set-up-14">Set up</a></h2>
<h3 id="quick-start-16"><a class="header" href="#quick-start-16">Quick start</a></h3>
<p><img src="TargetAndObstacleDetection/OccupancyCheck/./media-en/OccupancyCheckTools.PNG" alt="" /></p>
<ul>
<li>Create a route that has symbolic point in Navithor Tools</li>
<li>Enable occupancy check for the symbolic point and modify the area polygon if needed</li>
<li>Upload the area to the AGV</li>
<li>Enable occupancy check with Navitrol parameters <strong>occup_check_enabled, 1</strong></li>
<li>Select which scanners are used for the occupancy check with <strong>occup_check_scan_selection</strong> (value 15 will use all possible scanners)</li>
<li>Place an object inside the occupancy area</li>
<li>Give a drive order to the symbolic point</li>
<li>AGV should stop before reaching the symbolic point and raise a warning WARNING_SYMBOL_POINT_OCCUPIED</li>
</ul>
<h3 id="required-parameters-3"><a class="header" href="#required-parameters-3">Required parameters</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Required value</th><th>Description</th></tr></thead><tbody>
<tr><td>occup_check_enabled</td><td>Int</td><td>1</td><td>Enables occupancy check around symbolic point. AGV stops if it detects that zone linked to symbolic point is occupied.</td></tr>
</tbody></table>
<h3 id="other-parameters"><a class="header" href="#other-parameters">Other parameters</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>occup_check_start_dist</td><td>Float</td><td>3.0</td><td>Distance [m] to symbolic point to trigger occupancy check. Measured from the front or rear of the vehicle depending of driving direction.</td></tr>
<tr><td>occup_check_stop_dist</td><td>Float</td><td>0.2</td><td>Distance [m] to symbolic point to stop checking occupancy.</td></tr>
<tr><td>occup_check_min_hits</td><td>Int</td><td>1</td><td>Minimum hits required in occupancy area to stop the vehicle.</td></tr>
<tr><td>occup_check_min_hits_mode</td><td>Int</td><td>1</td><td>Defines mode how the laser hits from assigned scanners are compared to the <strong>occup_check_min_hits</strong> threshold which sets the occupancy of the area: 1 = Sum of hits from all assigned scanners are equal or above threshold, 2 = Hits from at least one assigned scanner are equal or above threshold, 3 = Hits from each and every assigned scanner are equal or above threshold.</td></tr>
<tr><td>occup_check_scan_selection</td><td>Int</td><td>1</td><td>Defines which scanners are used for occupancy check: Bit 0 = rear scanner, Bit 1 = front scanner, Bit 2 = measurement 0 scanner, Bit 3 = measurement 1 scanner. For example to use rear and front scanner, set value to 3 (0011)</td></tr>
<tr><td>occup_check_mode</td><td>Int</td><td>0</td><td>Occupancy check mode: 0 = check always, 1 = disable when AGV is not carrying a load, 2 = disable when AGV carries a load, 3 = disable for a Pick up symbolic point when AGV is not carrying a load.</td></tr>
</tbody></table>
<hr />
<h2 id="how-to-use-25"><a class="header" href="#how-to-use-25">How to use</a></h2>
<h3 id="navithor-tools-3"><a class="header" href="#navithor-tools-3">Navithor Tools</a></h3>
<p>There can be one Occupancy area defined for one symbolic point. The area is a polygon which size, number of vertices and position can be edited after clicking the <em>settings</em> button on the right side of the <em>Enable occupancy check</em> text.
The symbolic point is not required to be inside the area. There can be also multiple symbolic points that have occupancy check enabled on the path that AGV is driving.</p>
<h3 id="configure"><a class="header" href="#configure">Configure</a></h3>
<h4 id="when-occupancy-is-checked"><a class="header" href="#when-occupancy-is-checked">When occupancy is checked</a></h4>
<p>Occupancy check is active for a defined distance range before the symbolic point. The distance range can be modified using parameters <strong>occup_check_start_dist</strong> and <strong>occup_check_stop_dist</strong>. The distances are measured from the front or rear of the AGV depending on the driving direction. Note that it is Euclidean distance and not distance along the path. Image below shows how the distance is measured when AGV is driving forwards to the symbolic point. Occupancy check can not be activated after the AGV has passed the symbolic point.<br />
<img src="TargetAndObstacleDetection/OccupancyCheck/./media-en/OccupancyCheckDistance.png" alt="" /></p>
<h4 id="determining-the-occupancy-of-the-area"><a class="header" href="#determining-the-occupancy-of-the-area">Determining the occupancy of the area</a></h4>
<p>The occupancy of the area is determined by the number of 2D laser scanner beam hits inside the area. When there are equal or more hits inside the area than the threshold <strong>occup_check_min_hits</strong>, the area is occupied. With <strong>occup_check_min_hits_mode</strong>, the user can configure the way the laser scanner beam hits are calculated from the different scanners. There are three different modes:</p>
<ol>
<li><strong>Sum of hits from all assigned scanners are equal or above threshold</strong></li>
</ol>
<pre><code>Assigned scanners: Rear and Front
occup_check_min_hits = 10
Number of hits:
Rear = 4, Front = 5, Total = 9 (Area not occupied)
Rear = 4, Front = 6, Total = 10 (Area is occupied)
</code></pre>
<ol start="2">
<li><strong>Hits from at least one assigned scanner are equal or above threshold</strong></li>
</ol>
<pre><code>Assigned scanners: Rear and Front
occup_check_min_hits = 10
Number of hits:
Rear = 4, Front = 7, (Area not occupied)
Rear = 10, Front = 1 (Area is occupied)
</code></pre>
<ol start="3">
<li><strong>Hits from each and every assigned scanner are equal or above threshold</strong></li>
</ol>
<pre><code>Assigned scanners: Rear and Front
occup_check_min_hits = 10
Number of hits:
Rear = 10, Front = 7, (Area is not occupied)
Rear = 10, Front = 10 (Area is occupied)
</code></pre>
<h4 id="selecting-the-scanners-for-the-occupancy-check"><a class="header" href="#selecting-the-scanners-for-the-occupancy-check">Selecting the scanners for the occupancy check</a></h4>
<p>There are up to four scanners that can be assigned for the occupancy check. Rear scanner, front scanner and two measurement scanners. These can be configured freely with <strong>occup_check_scan_selection</strong> parameter. Note that the parameter value is a bitfield.<br />
Parameter value examples:
| Parameter value | Binary | Description |
| --- | --- | --- |
| 1 | 0001 | Bit0 = Only Rear scanner |
| 2 | 0010 | Bit1 = Only Front scanner |
| 3 | 0011 | Bit0 &amp; Bit1 = Rear and Front scanners |
| 4 | 0100 | Bit2 = Only Measurement 0 scanner | 
| ... |
| 15 | 1111 | All four scanners are assigned |</p>
<h4 id="disable-occupancy-check-based-on-the-agvs-load-status"><a class="header" href="#disable-occupancy-check-based-on-the-agvs-load-status">Disable occupancy check based on the AGV's load status</a></h4>
<p>Occupancy check can be configured to be disabled based on the AGV's load status. For example if occupancy of an area should not be checked when AGV is not carrying a load, disable by setting <strong>occup_check_mode</strong> to 1. Disable occupancy check when AGV is carrying a load by setting the parameter to 2. The mode 3 is targeted for empty space detection in a pick up / drop off symbolic point. Idea is that when AGV goes to pick up the load, occupancy check is disabled.</p>
<hr />
<h2 id="troubleshooting-46"><a class="header" href="#troubleshooting-46">Troubleshooting</a></h2>
<h3 id="common-issues"><a class="header" href="#common-issues">Common issues</a></h3>
<h4 id="agv-does-not-stop-even-if-there-is-obstacle-in-the-area"><a class="header" href="#agv-does-not-stop-even-if-there-is-obstacle-in-the-area">AGV does not stop even if there is obstacle in the area</a></h4>
<ul>
<li>Verify that the correct scanners are selected for the occupancy check <strong>occup_check_scan_selection</strong>. The default value of 1 (Bit 0) defines that only rear scanner is used for the occupancy check.</li>
</ul>
<h3 id="warning"><a class="header" href="#warning">Warning</a></h3>
<h4 id="620---warning_symbol_point_occupied"><a class="header" href="#620---warning_symbol_point_occupied">620 - WARNING_SYMBOL_POINT_OCCUPIED</a></h4>
<p>This warning is raised when AGV has stopped due to occupancy of the area. When the area is cleared, the warning is reset and the AGV is allowed to continue its current drive. If the area can not be cleared from obstacles, the warning can be reset by aborting the current drive which also puts the AGV from Auto state to Standby state.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="error-descriptions"><a class="header" href="#error-descriptions">Error Descriptions</a></h1>
<p>Updated 10.09.2024</p>
<hr />
<h2 id="error-classification"><a class="header" href="#error-classification">Error Classification</a></h2>
<p>Navitrol errors are classified into three categories</p>
<ul>
<li>Fatal errors</li>
<li>Errors</li>
<li>Warnings</li>
</ul>
<p>Fatal errors and errors stop automatic operation of Navitrol. Depending on the error in question, manual driving using Navitrol may still be possible. Fatal errors differ from normal errors so that they have to be acknowledged by the user before they are cleared. Some fatal errors can't be acknowledged and require Navitrol restart. Fatal errors can be divided into following three categories:</p>
<ul>
<li>Only manual driving is allowed, user acknowledgement is required.</li>
<li>No driving is allowed, user acknowledgement is required.</li>
<li>No driving is allowed, can't be acknowledged at run time. Navitrol restart is required.</li>
</ul>
<p>Warnings are set as a notification only. Navitrol operation (like automatic driving) is not stopped in case of a warning. Depending on the warning in question, Navitrol operation can be affected though.
Therefore, one should always figure out why a specific warning is set and what it means from Navitrol functional point of view.</p>
<h3 id="overriding-severity-levels"><a class="header" href="#overriding-severity-levels">Overriding Severity Levels</a></h3>
<p>It is possible to raise the severity level of errors and warnings.
In other words, the severity level of <code>Error</code> can be increased to <code>Fatal error</code>, and <code>Warning</code> can be increased to either <code>Error</code> or <code>Fatal error</code>.</p>
<p>To override the severity level of an error or a warning, we need to specify its id and the new severity level.
The error/warning id is the numeric value mentioned at the beginning of the title of each errors/warnings (e.g., the error id of <code>ERROR_SCANNER_PROTOCOL_ERROR</code> is <code>101</code>).</p>
<h3 id="parameters-14"><a class="header" href="#parameters-14">Parameters</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>error_override_id[0...9]</td><td>Int</td><td>-1</td><td>The error or warning id that its severity level needs to be overridden (-1 means no error id).</td></tr>
<tr><td>error_override_level[0...9]</td><td>Int</td><td>0</td><td>New severity level:<br> 0: default severity level <br> 1: warning <br> 2: error <br> 3: fatal error</td></tr>
</tbody></table>
<h2 id="general-critical-errors"><a class="header" href="#general-critical-errors">General Critical Errors</a></h2>
<h3 id="101-error_scanner_protocol_error"><a class="header" href="#101-error_scanner_protocol_error">101 ERROR_SCANNER_PROTOCOL_ERROR</a></h3>
<p>Description: Sick S300 scanner protocol differs from 1.2 or 1.3</p>
<p>Error Level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol communicates with SICK S300. The scanner reports a communication protocol that is unknown to Navitrol.</p>
<p>How to recover: Contact a system specialists at Navitec or SICK.</p>
<h3 id="102-error_map_file_read"><a class="header" href="#102-error_map_file_read">102 ERROR_MAP_FILE_READ</a></h3>
<p>Description: The map file could not be read</p>
<p>Error Level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Something is wrong in the map file (.nte) in the /home/navitec folder. Navitrol is not able to read the file. The file may be corrupted.</p>
<p>How to recover: Try to transfer a new map file to Navitrol. If it does not help contact Navitec.</p>
<h3 id="103-error_multiple_maps_per_floor"><a class="header" href="#103-error_multiple_maps_per_floor">103 ERROR_MULTIPLE_MAPS_PER_FLOOR</a></h3>
<p>Description: More than one map is found for a floor</p>
<p>Error Level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: There are several map files for the same floor in the /home/navitec folder. Navitrol can only have one map file for each floor.</p>
<p>How to recover: Check the files in the /home/navitec folder. Remove the wrong files.</p>
<h3 id="104-error_too_many_map_files"><a class="header" href="#104-error_too_many_map_files">104 ERROR_TOO_MANY_MAP_FILES</a></h3>
<p>Description: More than supported number of map files</p>
<p>Error Level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: There are more than 200 map files for more than 200 floors in the Navitrol folder.</p>
<p>How to recover: Check the files in the /home/navitec folder. Remove the wrong files.</p>
<h3 id="105-error_param_parse"><a class="header" href="#105-error_param_parse">105 ERROR_PARAM_PARSE</a></h3>
<p>Description: Error parsing parameter file</p>
<p>Error Level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The parameter file params.txt in the /home/navitec folder is not OK. The file may be corrupted, it may have typing errors (even invisible characters) or wrong number of parameters.</p>
<p>How to recover: Check the error prints in the startlog.txt file.
Navitrol tells what is wrong with the parameter file.</p>
<h3 id="106-error_no_license_code-1"><a class="header" href="#106-error_no_license_code-1">106 ERROR_NO_LICENSE_CODE</a></h3>
<p>Description: The license key is invalid</p>
<p>Error Level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: There is no valid license key in the Navitrol IPC.</p>
<p>How to recover: Retrieve a new license key from the Navitrol License Server or contact Navitec.</p>
<h3 id="107-error_thread_non_responsive"><a class="header" href="#107-error_thread_non_responsive">107 ERROR_THREAD_NON_RESPONSIVE</a></h3>
<p>Description: One or more of the monitored threads in SW is not responsive enough.</p>
<p>Error Level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: CPU overload.</p>
<p>How to recover: SW recovers from this ERROR by itself. This ERROR should be quite exceptional. If it happens though, take a log and contact Navitec for finding a reason for the error.</p>
<h3 id="108-error_drive_config"><a class="header" href="#108-error_drive_config">108 ERROR_DRIVE_CONFIG</a></h3>
<p>Description: Error in drive motor configuration.</p>
<p>Error Level: Fatal Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Error in drive motor configuration - like parameters related to drive input/output inversion or scaling.</p>
<p>How to recover: Check and fix all driving related configuration parameters. If reason is not resolved, take a log and contact Navitec.</p>
<h3 id="109-error_steer_angle_config"><a class="header" href="#109-error_steer_angle_config">109 ERROR_STEER_ANGLE_CONFIG</a></h3>
<p>Description: Error in steer angle configuration</p>
<p>Error level: Fatal error</p>
<p>Machine types: Steer</p>
<p>Error reason: Parameters related to input/output inversion or scaling wrong. Steer angle has deviated from the target longer than <strong>mot_ctrl_drive_angle_diag_time_ms</strong></p>
<p>How to recover: Check and fix all steering related configuration parameters. If reason is not resolved, take a log and contact Navitec.</p>
<h3 id="110-error_odometry_source"><a class="header" href="#110-error_odometry_source">110 ERROR_ODOMETRY_SOURCE</a></h3>
<p>Description: This error indicates that the odometry source is not defined preventing Navitrol from positioning.</p>
<p>Error level: Fatal error - requires restart after parameter values have been checked and fixed.</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Parameter <strong>odometry_source</strong> has not been properly defined.</p>
<p>How to recover: Check and fix related configuration parameter <strong>odometry_source</strong>.</p>
<h3 id="111-error_parameter_reconfigure_needed"><a class="header" href="#111-error_parameter_reconfigure_needed">111 ERROR_PARAMETER_RECONFIGURE_NEEDED</a></h3>
<p>Description: This error indicates that reconfiguration of some parameter file is needed, because parameters used for some specific purpose have changed, and parameter files need to be modified accordingly. This error may be triggered by an issue in any of the parameter files used by Navitrol. Issues triggering this error are rather complex in nature, and are typically related to Navitrol SW updates.</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Some parameter values need to be redefined or parameter used for some specific thing needs to be changed.</p>
<p>How to recover: Run command <code>.\Navitrol paramreconfigure</code>. This command gives detailed information about changes needed. It can even fix the parameter file(s) automatically in many cases, if given a permission to do so.</p>
<h2 id="general-errors"><a class="header" href="#general-errors">General Errors</a></h2>
<h3 id="201-error_veh_inte_msg_parse"><a class="header" href="#201-error_veh_inte_msg_parse">201 ERROR_VEH_INTE_MSG_PARSE</a></h3>
<p>Description: message parsing error in the vehicle interface</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: This error is triggered when a message from the Ethernet interface cannot be parsed correctly.</p>
<p>How to recover: The error is automatically gone when a correct message is received. This error should however never happen. Please check the messages that are sent to Navitrol. There is most likely something wrong in the message contents.</p>
<h3 id="202-error_scanner_msg_parse"><a class="header" href="#202-error_scanner_msg_parse">202 ERROR_SCANNER_MSG_PARSE</a></h3>
<p>Description: Scanner message parsing error</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The message received from the scanner cannot be parsed.
There is something wrong with the data.</p>
<p>How to recover: This error should not happen. In case of serial interface check that the cables are ok. Otherwise contact Navitec.</p>
<h3 id="203-error_no_scan_from_front_scanner"><a class="header" href="#203-error_no_scan_from_front_scanner">203 ERROR_NO_SCAN_FROM_FRONT_SCANNER</a></h3>
<p>Description: front scanner hasn't received scans</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received scanner measurements from the front scanner</p>
<p>How to recover: Check the cables, scanners and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="204-error_no_scan_from_rear_scanner"><a class="header" href="#204-error_no_scan_from_rear_scanner">204 ERROR_NO_SCAN_FROM_REAR_SCANNER</a></h3>
<p>Description: rear scanner hasn't received scans</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received scanner measurements from the rear scanner</p>
<p>How to recover: Check the cables, scanners and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="205-error_meas_cnt_mismatch_front"><a class="header" href="#205-error_meas_cnt_mismatch_front">205 ERROR_MEAS_CNT_MISMATCH_FRONT</a></h3>
<p>Description: A measurement in a single scan does not contain expected number of measurements, check the configuration of the rear scanner.</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The Sick S300 scanner has wrong configuration</p>
<p>How to recover: Change the scanner configuration with the SICK CDS software</p>
<h3 id="206-error_meas_cnt_mismatch_rear"><a class="header" href="#206-error_meas_cnt_mismatch_rear">206 ERROR_MEAS_CNT_MISMATCH_REAR</a></h3>
<p>Description: A measurement in a single scan does not contain expected number of measurements, check the configuration of the rear scanner</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The Sick S300 scanner has wrong configuration</p>
<p>How to recover: Change the scanner configuration with the SICK CDS software</p>
<h3 id="207-error_position_confidence_low"><a class="header" href="#207-error_position_confidence_low">207 ERROR_POSITION_CONFIDENCE_LOW</a></h3>
<p>Description: The position confidence is too low</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has lost the position confidence. There can be several reasons for this, including: The scanner view is blocked, bad scanner or vehicle kinematics calibration, bad environment model, slipping of the wheels, positioning parameters are not correct for the environment, etc.</p>
<p>How to recover: Take a log and contact Navitec for finding a reason for the error. Initialize the position to continue.</p>
<h3 id="208-error_not_enough_ref_det"><a class="header" href="#208-error_not_enough_ref_det">208 ERROR_NOT_ENOUGH_REF_DET</a></h3>
<p>Description: Not enough reflectors detected</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: If the Navitrol parameter min_reflectors_seen is set to a higher value than 0, this error is triggered when less reflectors than the value of the parameter are detected.</p>
<p>How to recover: Check that the parameter value min_reflectors_seen is making sense in relation to the amount of reflectors that should be visible. Add more reflectors if needed or change the parameter value.</p>
<h3 id="209-error_position_not_initialized"><a class="header" href="#209-error_position_not_initialized">209 ERROR_POSITION_NOT_INITIALIZED</a></h3>
<p>Description: The position hasn't been initialized</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The position has not been initialized and the parameter require_position_initialization is set to 1.</p>
<p>How to recover: Initialize position again.</p>
<h3 id="210-error_localize_not_ready"><a class="header" href="#210-error_localize_not_ready">210 ERROR_LOCALIZE_NOT_READY</a></h3>
<p>Description: The localization task is not ready</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The localize task is not ready to do its work. It may be starting or it is reading in files or Navitrol is shutting down.</p>
<p>How to recover: In case of startup this failure disappears automatically. If this error stays on, take a log and contact Navitec.</p>
<h3 id="211-error_deadrec_high_dt"><a class="header" href="#211-error_deadrec_high_dt">211 ERROR_DEADREC_HIGH_DT</a></h3>
<p>Description: Too long since last deadrec update</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received a dead reckoning message from the vehicle controller for a time longer than the parameter
odo_max_interval_ms.</p>
<p>How to recover: Check the message sending interval from the vehicle controller. Adjust the parameter or fix the message sending.</p>
<h3 id="212-error_poscont_high_dt"><a class="header" href="#212-error_poscont_high_dt">212 ERROR_POSCONT_HIGH_DT</a></h3>
<p>Description: Too long since last position control update</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: No position controller update for a time longer than the parameter poscont_max_interval_ms. For some reason the poscont task does not run normally.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="213-error_scanner_front_high_dt"><a class="header" href="#213-error_scanner_front_high_dt">213 ERROR_SCANNER_FRONT_HIGH_DT</a></h3>
<p>Description: The intervals between received laser scans from the front scanner is too high</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Scanner measurement messages are not received for a time exceeding the parameter scan_max_dt_err_ms.</p>
<p>How to recover: Check the cables, front scanner and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="214-error_no_scan_from_safety_scanner"><a class="header" href="#214-error_no_scan_from_safety_scanner">214 ERROR_NO_SCAN_FROM_SAFETY_SCANNER</a></h3>
<p>Description: No scans have been received from the safety scanner</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received scanner measurements from the safety scanner</p>
<p>How to recover: Check the cables, scanners and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="215-error_meas_cnt_mismatch_safety"><a class="header" href="#215-error_meas_cnt_mismatch_safety">215 ERROR_MEAS_CNT_MISMATCH_SAFETY</a></h3>
<p>Description: A measurement in a single scan does not contain expected number of measurements, check the configuration of the safety scanners</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The Sick S300 scanner has wrong configuration</p>
<p>How to recover: Change the scanner configuration with the SICK CDS software</p>
<h3 id="216-error_enc_data"><a class="header" href="#216-error_enc_data">216 ERROR_ENC_DATA</a></h3>
<p>Description: Invalid encoder data</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The received encoder data is out of range</p>
<p>How to recover: Take a log and send to Navitec</p>
<h3 id="217-error_license_option_missing-1"><a class="header" href="#217-error_license_option_missing-1">217 ERROR_LICENSE_OPTION_MISSING</a></h3>
<p>Description: The current license doesn't include permission to use a feature that is being activated</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: A feature requiring an additional license is enabled in the params.txt file without the corresponding license.</p>
<p>How to recover: Take a log and send to Navitec.</p>
<h3 id="218-error_pos_ini_not_enough_ref_det"><a class="header" href="#218-error_pos_ini_not_enough_ref_det">218 ERROR_POS_INI_NOT_ENOUGH_REF_DET</a></h3>
<p>Description: Not enough reflectors detected during position initialization</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Fewer reflectors than the parameter pos_ini_min_reflectors_seen are detected during position initialization. If the parameter pos_ini_min_reflectors_seen is 0 no reflectors are needed</p>
<p>How to recover: Make sure that enough reflectors are visible when initializing position or change the parameter value.</p>
<h3 id="219-error_config_parameter_value"><a class="header" href="#219-error_config_parameter_value">219 ERROR_CONFIG_PARAMETER_VALUE</a></h3>
<p>Description: Incorrect parameter value in verification</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: A parameter is set to incorrect value.</p>
<p>How to recover: The incorrect parameter can be seen in the Navitrol text log file. Check the log file, or send it to Navitec.</p>
<h3 id="220-error_pos_ini_not_enough_ref_det_driv"><a class="header" href="#220-error_pos_ini_not_enough_ref_det_driv">220 ERROR_POS_INI_NOT_ENOUGH_REF_DET_DRIV</a></h3>
<p>Description: Not enough reflectors detected during position initialization while driving</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The vehicle doesn't see the specified number of reflectors during a specified distance after position initialization. The number of reflectors and the distance are specified using Navitrol parameters.</p>
<p>How to recover: Reinitialize the position and make sure the machine sees enough reflectors.</p>
<h3 id="221-error_no_data_from_ext_loc_sensor"><a class="header" href="#221-error_no_data_from_ext_loc_sensor">221 ERROR_NO_DATA_FROM_EXT_LOC_SENSOR</a></h3>
<p>Description: No data received from external localization sensor</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received data from the external localization sensor</p>
<p>How to recover: Check the cables, the external sensor and computer. In case of Ethernet communication other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="222-error_ext_loc_sensor_msg_parse"><a class="header" href="#222-error_ext_loc_sensor_msg_parse">222 ERROR_EXT_LOC_SENSOR_MSG_PARSE</a></h3>
<p>Description: Parsing error of message from external localization sensor</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The message received from the localization sensor cannot be parsed. There is something wrong with the data.</p>
<p>How to recover: This error should not happen. In case of serial interface check that cables are ok. Otherwise take a log and contact Navitec.</p>
<h3 id="223-error_ext_loc_too_long_since_measurement"><a class="header" href="#223-error_ext_loc_too_long_since_measurement">223 ERROR_EXT_LOC_TOO_LONG_SINCE_MEASUREMENT</a></h3>
<p>Description: Too long time since a message has been received from the external localization sensor</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The sensor is not switched on, the sensors' communication is not initiated or the cables are not connected.</p>
<p>How to recover: Check that the sensor is on and its' cables are connected. Re-initialize the sensor communication by activating it from the master unit or restarting the master unit. Take a log and contact Navitec.</p>
<h3 id="224-error_scanner_rear_high_dt"><a class="header" href="#224-error_scanner_rear_high_dt">224 ERROR_SCANNER_REAR_HIGH_DT</a></h3>
<p>Description: The interval between received laser scans from the rear scanner is too high</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Scanner measurement messages have not been received for a time exceeding the parameter scan_max_dt_err_ms.</p>
<p>How to recover: Check the cables, rear scanner and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="225-error_no_data_from_line_following_sensor"><a class="header" href="#225-error_no_data_from_line_following_sensor">225 ERROR_NO_DATA_FROM_LINE_FOLLOWING_SENSOR</a></h3>
<p>Description: No data has been received from the line following sensor</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: No line following data has been received via ethernet UDP</p>
<p>How to recover: Check connection and cables</p>
<h3 id="226-error_msg_parse_line_following_sensor"><a class="header" href="#226-error_msg_parse_line_following_sensor">226 ERROR_MSG_PARSE_LINE_FOLLOWING_SENSOR</a></h3>
<p>Description: Error parsing line following sensor message</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Line following data parsed either via CAN or ethernet is invalid</p>
<p>How to recover: Check connection and cables, if message is sent via ethernet check that the sending counter is valid</p>
<h3 id="227-error_line_following_no_measurement"><a class="header" href="#227-error_line_following_no_measurement">227 ERROR_LINE_FOLLOWING_NO_MEASUREMENT</a></h3>
<p>Description: No measurement received from sensor</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: AGV is driving on a route with line following tag without detecting the line for a distance of parameter line_following_max_dist_since_last_meas, from either front or rear sensor</p>
<p>How to recover: If the sensors are theoretically on the route and should detect the line, check connection and verify everything is ok. Error is reset by driving manually or disabling parameter line_following_sensor_communication.</p>
<h3 id="228-error_license_file-1"><a class="header" href="#228-error_license_file-1">228 ERROR_LICENSE_FILE</a></h3>
<p>Description: License file missing or invalid - missing or conflicting data in license file.</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: License file 'LicenseDetails.json' in subfolder &quot;license&quot; is missing or corrupted.</p>
<p>How to recover: This error is not recoverable. It requires fixing the issue and then restarting Navitrol. Send 'startlog.txt' and license file (if exists) to Navitec support.</p>
<h3 id="229-error_license_content-1"><a class="header" href="#229-error_license_content-1">229 ERROR_LICENSE_CONTENT</a></h3>
<p>Description: License file conflicting with the License content or License content inconsistent.</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: License content has inconsistent information. Possible reasons are</p>
<ul>
<li>Corrupted license file 'LicenseDetails.json' in subfolder &quot;license&quot;.</li>
<li>When updating/upgrading license, either license file or License has not been truly updated.</li>
</ul>
<p>How to recover: This error is not recoverable. It requires fixing the issue and then restarting Navitrol. Send 'startlog.txt' and license file ('LicenseDetails.json' in subfolder &quot;license&quot;) to Navitec support.</p>
<h3 id="230-error_test_version_time_limit_reached"><a class="header" href="#230-error_test_version_time_limit_reached">230 ERROR_TEST_VERSION_TIME_LIMIT_REACHED</a></h3>
<p>Description: Test version time limit has been reached. You can continue testing by restarting Navitrol.</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Test versions are meant for testing purposes only, and therefore the run time has been limited.</p>
<p>How to recover: This error is not recoverable. Navitrol can be restarted to restart the test time. When feature being tested has been verified to work ok, request for updated non-test version of Navitrol.</p>
<h2 id="general-warnings"><a class="header" href="#general-warnings">General Warnings</a></h2>
<h3 id="300-warning_unauthorized_setting"><a class="header" href="#300-warning_unauthorized_setting">300 WARNING_UNAUTHORIZED_SETTING</a></h3>
<p>Description: Unauthorized parameter setting</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Unauthorized parameter setting</p>
<p>How to recover: Contact Navitec</p>
<h3 id="302-warning_too_many_log_files"><a class="header" href="#302-warning_too_many_log_files">302 WARNING_TOO_MANY_LOG_FILES</a></h3>
<p>Description: there are too many log files in the logs -directory, the oldest was overwritten</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Too many log files</p>
<p>How to recover: No need to do anything, this warning is just informative</p>
<h3 id="303-warning_log_dump"><a class="header" href="#303-warning_log_dump">303 WARNING_LOG_DUMP</a></h3>
<p>Description: log dump failed</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol is not able to save the log file</p>
<p>How to recover: Clean the /home/navitec/logs folder. Reboot the system,
contact Navitec.</p>
<h3 id="304-warning_not_enough_free_space"><a class="header" href="#304-warning_not_enough_free_space">304 WARNING_NOT_ENOUGH_FREE_SPACE</a></h3>
<p>Description: Not enough free disk space</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: There is less free hard drive space than the parameter min_free_disk_space_mb.</p>
<p>How to recover: Check the following subfolders located under Navitrol &quot;home&quot; (defaults to /home/navitec) folder: /logs, /old, /params_backup, /teach. Remove unnecessary old files and reboot the system. If that does not help, contact Navitec.</p>
<h3 id="305-warning_teaching_already_on"><a class="header" href="#305-warning_teaching_already_on">305 WARNING_TEACHING_ALREADY_ON</a></h3>
<p>Description: teaching is already on</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: A new command to start teaching is received when Navitrol is already in teaching mode</p>
<p>How to recover: Recovers automatically, no need to do anything</p>
<h3 id="306-warning_front_scanner_protection_zone"><a class="header" href="#306-warning_front_scanner_protection_zone">306 WARNING_FRONT_SCANNER_PROTECTION_ZONE</a></h3>
<p>Description: The front laser scanner protection zone is violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The front scanner sees something inside the protection
zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the protection zone is not triggered.</p>
<h3 id="307-warning_rear_scanner_protection_zone"><a class="header" href="#307-warning_rear_scanner_protection_zone">307 WARNING_REAR_SCANNER_PROTECTION_ZONE</a></h3>
<p>Description: The rear laser scanner protection zone is violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The rear scanner sees something inside the protection zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the protection zone is not triggered.</p>
<h3 id="308-warning_front_scanner_warning_zone1"><a class="header" href="#308-warning_front_scanner_warning_zone1">308 WARNING_FRONT_SCANNER_WARNING_ZONE1</a></h3>
<p>Description: The front laser scanner warning zone 1 is violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The front scanner sees something inside the first warning zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the warning zone is not triggered.</p>
<h3 id="309-warning_rear_scanner_warning_zone1"><a class="header" href="#309-warning_rear_scanner_warning_zone1">309 WARNING_REAR_SCANNER_WARNING_ZONE1</a></h3>
<p>Description: The rear laser scanner warning zone 1 is violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The rear scanner sees something inside the first warning
zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the warning zone is not triggered.</p>
<h3 id="310-warning_front_scanner_warning_zone2"><a class="header" href="#310-warning_front_scanner_warning_zone2">310 WARNING_FRONT_SCANNER_WARNING_ZONE2</a></h3>
<p>Description: The front laser scanner warning zone 2 is violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The front scanner sees something inside the second warning zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the warning zone is not triggered.</p>
<h3 id="311-warning_rear_scanner_warning_zone2"><a class="header" href="#311-warning_rear_scanner_warning_zone2">311 WARNING_REAR_SCANNER_WARNING_ZONE2</a></h3>
<p>Description: The rear laser scanner warning zone 2 is violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The rear scanner sees something inside the second warning
zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the warning zone is not triggered.</p>
<h3 id="312-warning_front_scanner_dirty"><a class="header" href="#312-warning_front_scanner_dirty">312 WARNING_FRONT_SCANNER_DIRTY</a></h3>
<p>Description: The front laser scanner reports dirty window</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The scanner window is dirty</p>
<p>How to recover: Clean the scanner lens.</p>
<h3 id="313-warning_rear_scanner_dirty"><a class="header" href="#313-warning_rear_scanner_dirty">313 WARNING_REAR_SCANNER_DIRTY</a></h3>
<p>Description: The rear laser scanner reports dirty window</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The scanner window is dirty</p>
<p>How to recover: Clean the scanner lens.</p>
<h3 id="314-warning_high_logging_rate"><a class="header" href="#314-warning_high_logging_rate">314 WARNING_HIGH_LOGGING_RATE</a></h3>
<p>Description: The text log writing rate is high and may affect performance</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: More log events than recommended are collected into the log.</p>
<p>How to recover: If the warning happens only every now and then there is no need to do anything. If the warning stays on please tune the logging parameters in the params.txt file together with Navitec.</p>
<h3 id="315-warning_too_large_auto_ang_rate_corr"><a class="header" href="#315-warning_too_large_auto_ang_rate_corr">315 WARNING_TOO_LARGE_AUTO_ANG_RATE_CORR</a></h3>
<p>Description: Too large odometry turning rate auto correction</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The vehicle turning rate is corrected more than the parameter odo_auto_corr_max_dherr_deg allows. The vehicle kinematics parameters are not correctly calibrated.</p>
<p>How to recover: Recalibrate the vehicle. Remove the startInfo.bin file from the /home/navitec folder. Reboot Navitrol.</p>
<h3 id="316-warning_too_large_auto_odo_corr"><a class="header" href="#316-warning_too_large_auto_odo_corr">316 WARNING_TOO_LARGE_AUTO_ODO_CORR</a></h3>
<p>Description: Too large odometry distance auto correction</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The odometry distance is corrected more than the parameter odo_auto_corr_max_dserr allows. The odometry is not correctly calibrated.</p>
<p>How to recover: Recalibrate the vehicle. Remove the startInfo.bin file from the /home/navitec folder. Reboot Navitrol.</p>
<h3 id="317-warning_teach_mode_enabled"><a class="header" href="#317-warning_teach_mode_enabled">317 WARNING_TEACH_MODE_ENABLED</a></h3>
<p>Description: The position correction is disabled while teaching</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol is in teach mode.</p>
<p>How to recover: Not really an error, just a warning to tell that teaching is on. The warning disappears when the teaching is deactivated.</p>
<h3 id="318-warning_too_large_auto_ang_corr"><a class="header" href="#318-warning_too_large_auto_ang_corr">318 WARNING_TOO_LARGE_AUTO_ANG_CORR</a></h3>
<p>Description: Too large odometry heading auto correction</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The odometry heading angle is corrected more than the parameter odo_auto_corr_max_herr_deg allows. The vehicle kinematics is not correctly calibrated.</p>
<p>How to recover: Recalibrate the vehicle. Remove the startInfo.bin file from the /home/navitec folder. Reboot Navitrol.</p>
<h3 id="319-warning_initializing_position"><a class="header" href="#319-warning_initializing_position">319 WARNING_INITIALIZING_POSITION</a></h3>
<p>Description: The position is being initialized</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol is initializing the position.</p>
<p>How to recover: Not really an error, just a warning to tell that the position initializing is on. The warning disappears when the position initialization gets rady.</p>
<h3 id="320-warning_large_cum_xy_correction"><a class="header" href="#320-warning_large_cum_xy_correction">320 WARNING_LARGE_CUM_XY_CORRECTION</a></h3>
<p>Description: Large cumulative position correction over last meter</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The position is corrected more than the parameter loc_cum_xy_corr_warn allows during the last driven meter.</p>
<p>How to recover: Navitrol recovers from this error automatically when the position correction does not exceed the limit anymore. It is important to know the reason why Navitrol needed to correct the position so much.
Take a log and contact Navitec.</p>
<h3 id="321-warning_large_cum_heading_correction"><a class="header" href="#321-warning_large_cum_heading_correction">321 WARNING_LARGE_CUM_HEADING_CORRECTION</a></h3>
<p>Description: Large cumulative heading correction over last meter</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The heading is corrected more than the parameter loc_cum_h_corr_warn allows over the last driven meter.</p>
<p>How to recover: Navitrol recovers from this error automatically when the heading correction does not exceed the limit anymore. It is important to know the reason why Navitrol needed to correct the heading so much. Take a log and contact Navitec.</p>
<h3 id="322-warning_safety_scanner_protection_zone"><a class="header" href="#322-warning_safety_scanner_protection_zone">322 WARNING_SAFETY_SCANNER_PROTECTION_ZONE</a></h3>
<p>Description: Safety laser scanner protection zone violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The safety scanner sees something inside the protection zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the protection zone is not triggered.</p>
<h3 id="323-warning_safety_scanner_warning_zone1"><a class="header" href="#323-warning_safety_scanner_warning_zone1">323 WARNING_SAFETY_SCANNER_WARNING_ZONE1</a></h3>
<p>Description: Safety laser scanner warning zone 1 violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The safety scanner sees something inside the first warning zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the protection zone is not triggered.</p>
<h3 id="324-warning_safety_scanner_warning_zone2"><a class="header" href="#324-warning_safety_scanner_warning_zone2">324 WARNING_SAFETY_SCANNER_WARNING_ZONE2</a></h3>
<p>Description: Safety laser scanner warning zone 2 violated</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The safety scanner sees something inside the second warning zone.</p>
<p>How to recover: Check the scanner view with the monitor. Remove obstacles. Clean the scanner if necessary. Check the scanner zone settings. Recovers automatically when the protection zone is not triggered.</p>
<h3 id="325-warning_safety_scanner_dirty"><a class="header" href="#325-warning_safety_scanner_dirty">325 WARNING_SAFETY_SCANNER_DIRTY</a></h3>
<p>Description: Safety laser scanner reports dirty window</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Scanner window is dirty</p>
<p>How to recover: Clean the scanner lens.</p>
<h3 id="326-warning_cannot_run_monitor"><a class="header" href="#326-warning_cannot_run_monitor">326 WARNING_CANNOT_RUN_MONITOR</a></h3>
<p>Description: The Navitrol Monitor view cannot be updated due to missing scanner or odometry data</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Either scanner or odometry data is missing</p>
<p>How to recover: Check the communication to the scanners. Check that Navitrol receives odometry data from the vehicle.</p>
<h3 id="327-warning_deadrec_high_dt_stdev"><a class="header" href="#327-warning_deadrec_high_dt_stdev">327 WARNING_DEADREC_HIGH_DT_STDEV</a></h3>
<p>Description: The vehicle motor controller interface update interval standard deviation is too high</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The standard deviation between odometry messages exceeds the odo_max_interval_stdev_us. Navitrol does not receive odometry data at constant intervals.</p>
<p>How to recover: Navitrol expects to get odometry data at constant intervals. The parameter odo_max_interval_stdev_us value must match with the capability of the vehicle controller.</p>
<h3 id="328-warning_odometry_slipping"><a class="header" href="#328-warning_odometry_slipping">328 WARNING_ODOMETRY_SLIPPING</a></h3>
<p>Description: The wheels are slipping or the odometry is incorrect, increasing correction gains temporarily</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Odometry slipping detection triggered</p>
<p>How to recover: Navitrol recovers from the error automatically. If the warning shows when the wheels do not slip take a log and contact Navitec.</p>
<h3 id="329-warning_generic"><a class="header" href="#329-warning_generic">329 WARNING_GENERIC</a></h3>
<p>Description: Generic warning, check log for more details</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Generic warning that could be triggered from various reasons</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="330-warning_front_scanner_wrong_mode"><a class="header" href="#330-warning_front_scanner_wrong_mode">330 WARNING_FRONT_SCANNER_WRONG_MODE</a></h3>
<p>Description: The front laser scanner is in wrong operating mode</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The scanner is not correctly configured</p>
<p>How to recover: Check the configuration of the scanner.</p>
<h3 id="331-warning_rear_scanner_wrong_mode"><a class="header" href="#331-warning_rear_scanner_wrong_mode">331 WARNING_REAR_SCANNER_WRONG_MODE</a></h3>
<p>Description: The rear laser scanner is in wrong operating mode</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The scanner is not correctly configured</p>
<p>How to recover: Check the configuration of the scanner.</p>
<h3 id="332-warning_front_scanner_no_zone_info"><a class="header" href="#332-warning_front_scanner_no_zone_info">332 WARNING_FRONT_SCANNER_NO_ZONE_INFO</a></h3>
<p>Description: The front laser scanner does not send protection/warning zone intrusion data.</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The scanner is not responding to commands as expected.</p>
<p>How to recover: If error &quot;203 ERROR_NO_SCAN_FROM_FRONT_SCANNER&quot; is active, clear that issue first. If error &quot;203 ERROR_NO_SCAN_FROM_FRONT_SCANNER&quot; is not active, take a log and contact Navitec.</p>
<h3 id="333-warning_rear_scanner_no_zone_info"><a class="header" href="#333-warning_rear_scanner_no_zone_info">333 WARNING_REAR_SCANNER_NO_ZONE_INFO</a></h3>
<p>Description: The rear laser scanner does not send protection/warning zone intrusion data.</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The scanner is not responding to commands as expected.</p>
<p>How to recover: How to recover: If error &quot;204 ERROR_NO_SCAN_FROM_REAR_SCANNER&quot; is active, clear that issue first.
If error &quot;204 ERROR_NO_SCAN_FROM_REAR_SCANNER&quot; is not active, take a log and contact Navitec.</p>
<h3 id="334-warning_no_remote_control"><a class="header" href="#334-warning_no_remote_control">334 WARNING_NO_REMOTE_CONTROL</a></h3>
<p>Description: Remote control via the WEB interface is not possible due to a version mismatch</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: The version of the WEB service does not match the Navitrol version</p>
<p>How to recover: Contact Navitec for the correct WEB application.</p>
<h3 id="335-warning_position_not_initialized"><a class="header" href="#335-warning_position_not_initialized">335 WARNING_POSITION_NOT_INITIALIZED</a></h3>
<p>Description: The position hasn't been initialized but the vehicle can be driven as position initialization is not required</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: If the parameter require_position_initialization is set to 0 to allow automatic initialization at stat-up instead of requiring external position  initialization, there is a risk that the automatic initialization fails and the position gets uninitialized. Driving is still possible though, since this is just a warning.</p>
<p>How to recover: Initialize the position manually.</p>
<h3 id="336-warning_pos_init_timeout"><a class="header" href="#336-warning_pos_init_timeout">336 WARNING_POS_INIT_TIMEOUT</a></h3>
<p>Description: Position initialization stopped due to timeout</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="337-warning_charger_fault"><a class="header" href="#337-warning_charger_fault">337 WARNING_CHARGER_FAULT</a></h3>
<p>Description: Fault received from charger</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="338-warning_bms"><a class="header" href="#338-warning_bms">338 WARNING_BMS</a></h3>
<p>Description: Warning received from BMS</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="339-warning_no_scan_from_front_scanner"><a class="header" href="#339-warning_no_scan_from_front_scanner">339 WARNING_NO_SCAN_FROM_FRONT_SCANNER</a></h3>
<p>Description: Front scanner hasn't received scans</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received scanner measurements from the front scanner. Error is considered only as a warning, because the scanner is not used for localization. Otherwise it will stop AGV.</p>
<p>How to recover: Check the cables, scanners and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="340-warning_no_scan_from_rear_scanner"><a class="header" href="#340-warning_no_scan_from_rear_scanner">340 WARNING_NO_SCAN_FROM_REAR_SCANNER</a></h3>
<p>Description: Rear scanner hasn't received scans</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received scanner measurements from the
rear scanner. Error is considered only as a warning, because the scanner
is not used for localization. Otherwise it will stop AGV.</p>
<p>How to recover: Check the cables, scanners and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="341-warning_scanner_front_high_dt"><a class="header" href="#341-warning_scanner_front_high_dt">341 WARNING_SCANNER_FRONT_HIGH_DT</a></h3>
<p>Description: The intervals between received laser scans from the front scanner is too high</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Scanner measurement messages are not received for a time exceeding the parameter scan_max_dt_err_ms. Error is considered only as a warning, because the scanner is not used for localization. Otherwise it will stop AGV.</p>
<p>How to recover: Check the cables, front scanner and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="342-warning_scanner_rear_high_dt"><a class="header" href="#342-warning_scanner_rear_high_dt">342 WARNING_SCANNER_REAR_HIGH_DT</a></h3>
<p>Description: The interval between received laser scans from the rear scanner is too high</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Scanner measurement messages have not been received for a time exceeding the parameter scan_max_dt_err_ms. Error is considered only as a warning, because the scanner is not used for localization. Otherwise it will stop AGV.</p>
<p>How to recover: Check the cables, rear scanner and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="343-warning_distance_to_target"><a class="header" href="#343-warning_distance_to_target">343 WARNING_DISTANCE_TO_TARGET</a></h3>
<p>Description: AGV has driven too far away from unload point. Distance calculation is impossible</p>
<p>Error level: Warning Machine types: All vehicles</p>
<p>Error reason: Two possible reasons: if AGV stops on the symbolic point, the fork position is defined incorrectly in the parameter file. If AGV drives over the symbolic point then something wrong with the parameters (pc_stop_distance_offset) or/and with the AGV (it cannot be controlled by the Navitrol in such cases as wheel slipping or brakes
fail).</p>
<p>How to recover: In case of the first reason check the Distance To Target feature description document to see how the fork parameters should be defined, pay attention to the sign of those parameters. In case of the second reason, check the mechanical part of the AGV, turn the parameter log_pallet_detection, take logs and sent them to the Navitec support team.</p>
<h3 id="344-warning_no_scan_from_meas_scanner"><a class="header" href="#344-warning_no_scan_from_meas_scanner">344 WARNING_NO_SCAN_FROM_MEAS_SCANNER</a></h3>
<p>Description: One of the measurements scanners hasn't received scans (other than front/rear)</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol has not received scanner measurements from the measurement scanner. Error is considered only as a warning unless feature using data triggers an error.</p>
<p>How to recover: Check the cables, scanners and computer. In case of Ethernet scanner other possible reasons are IP addresses, ports, Ethernet switches, etc.</p>
<h3 id="345-warning_loading_environment"><a class="header" href="#345-warning_loading_environment">345 WARNING_LOADING_ENVIRONMENT</a></h3>
<p>Description: Loading environment and segment file data. Loading must be finished before driving can continue</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Environment and segment data is being uploaded to the Navitrol (from different sources, for instance, from NavithorTools).</p>
<p>How to recover: Resets automatically after upload process is finished.</p>
<h3 id="350-warning_driving_not_allowed"><a class="header" href="#350-warning_driving_not_allowed">350 WARNING_DRIVING_NOT_ALLOWED</a></h3>
<p>Description: Driving by Navigation SW not allowed due to AGV control mode (not in automatic mode) or fault. Prevents also Navigation SW manual driving (WebUI, Supervisor, Monitor).</p>
<p>Error level: Warning</p>
<p>Machine types: Navigation SW with driving</p>
<p>Error reason: There are multiple possibilities for this warning; motor controller fault, Supervisor fault, AGV in
manual mode, internal fault.</p>
<p>How to recover: 1. Check active ERRORs, 2. Verify that AGV is in AUTO mode. If neither of these explains why driving is not allowed, then take a log and contact Navitec.</p>
<h3 id="351-warning_license_expiration-1"><a class="header" href="#351-warning_license_expiration-1">351 WARNING_LICENSE_EXPIRATION</a></h3>
<p>Description: Time limited License is about to expire soon.</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: License is a Trial License or other time limited License, and it is about to expire soon. This warning is set when License expires within number of days as defined by parameter <strong>license_warning_period_days</strong>. This warning can also be disabled by setting parameter <strong>license_warning_period_days</strong> to 0.</p>
<p>How to recover: License update is required. Expiry date can be checked by taking a log. In the beginning of log.txt one can see all License details, including expiry date if License is time limited.</p>
<h3 id="352-warning_imu_calibration_ongoing"><a class="header" href="#352-warning_imu_calibration_ongoing">352 WARNING_IMU_CALIBRATION_ONGOING</a></h3>
<p>Description: The IMU calibration is ongoing, sensor fusion is not active yet</p>
<p>Error level: Warning</p>
<p>Error reason: The sensor fusion has not yet received enough IMU measurement</p>
<p>How to recover: After enough IMU measurements it will automatically reset, however, if the issue persists, check the sensor fusion and IMU parameters</p>
<h3 id="353-warning_sensor_fusion_startup_ongoing"><a class="header" href="#353-warning_sensor_fusion_startup_ongoing">353 WARNING_SENSOR_FUSION_STARTUP_ONGOING</a></h3>
<p>Description: The sensor fusion startup is ongoing, which means that it is not used for localization</p>
<p>Error level: Warning</p>
<p>Error reason: The sensor fusion has not yet received odometry, or the IMU calibration is unfinished</p>
<p>How to recover: Verify why no odometry is received, if the issue persists, take a log and contact Navitec</p>
<h3 id="354-warning_fleet_control_msg_parse"><a class="header" href="#354-warning_fleet_control_msg_parse">354 WARNING_FLEET_CONTROL_MSG_PARSE</a></h3>
<p>Description: A message from Fleet Control cannot be parsed.</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol received a message from Fleet Control, but its content does not follow the protocol between them.</p>
<p>How to recover: This warning should not happen. Please take a log and contact Navitec.</p>
<h3 id="355-warning_slam_active"><a class="header" href="#355-warning_slam_active">355 WARNING_SLAM_ACTIVE</a></h3>
<p>Description: SLAM is active</p>
<p>Error level: Warning</p>
<p>Machine types: All</p>
<p>Error reason: SLAM is activated and is currently building a map in the background</p>
<p>How to recover: From <em>Navitrol Monitor</em>, select <em>Navitrol</em> -&gt; <em>Stop SLAM</em></p>
<h3 id="356-warning_sensor_fusion_not_used_for_loc"><a class="header" href="#356-warning_sensor_fusion_not_used_for_loc">356 WARNING_SENSOR_FUSION_NOT_USED_FOR_LOC</a></h3>
<p>Description: Sensor fusion enabled but not used for localization due to position initialization.</p>
<p>Error level: Warning</p>
<p>Machine types: All</p>
<p>Error reason: Sensor fusion is enabled by parameter, sf_use_sensor_fusion, but the position initialization is ongoing or has not been performed. The position initialization must be performed if require_position_initialization is 1, otherwise sensor fusion is inactive whenever position initialization is active. </p>
<p>How to recover: Perform position initialization or stop initializing the position, depending on parameter value.</p>
<h2 id="position-control-critical-errors"><a class="header" href="#position-control-critical-errors">Position Control Critical Errors</a></h2>
<h3 id="401-error_veh_inte_high_dt"><a class="header" href="#401-error_veh_inte_high_dt">401 ERROR_VEH_INTE_HIGH_DT</a></h3>
<p>Description: Vehicle motor controller interface update interval is too high</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol cannot communicate with the vehicle controller correctly.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="402-error_motor_control_fault-1"><a class="header" href="#402-error_motor_control_fault-1">402 ERROR_MOTOR_CONTROL_FAULT</a></h3>
<p>Description: Motor controller indicates fault</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Error comes from the motor controller.</p>
<p>How to recover: Check the error from the motor controller (for instance, using Linux terminal or from Navitrol log)</p>
<h3 id="403-error_motor_control_comms"><a class="header" href="#403-error_motor_control_comms">403 ERROR_MOTOR_CONTROL_COMMS</a></h3>
<p>Description: Motor controller communication fault</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Possible reason can be found from the log. Could be that for example that Navitrol cannot read encoder values.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="404-error_io"><a class="header" href="#404-error_io">404 ERROR_IO</a></h3>
<p>Description: I/O interface is in error state</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: IO board communication fails</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="405-error_pos_cont_seg_file_parsing_error"><a class="header" href="#405-error_pos_cont_seg_file_parsing_error">405 ERROR_POS_CONT_SEG_FILE_PARSING_ERROR</a></h3>
<p>Description: PosCont segment file parsing failed</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol cannot read segment file. There is something wrong with the segment file inside /home/navitec folder</p>
<p>How to recover: Update the segment file</p>
<h2 id="position-control-errors"><a class="header" href="#position-control-errors">Position Control Errors</a></h2>
<h3 id="501-error_pos_cont_heading_err"><a class="header" href="#501-error_pos_cont_heading_err">501 ERROR_POS_CONT_HEADING_ERR</a></h3>
<p>Description: PosCont too high heading error</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle heading compared to route heading differentiates more than parameter pc_max_head_err. Vehicle cannot start driving.</p>
<p>How to recover: Drive vehicle closer to the route manually.</p>
<h3 id="502-error_pos_cont_pos_err"><a class="header" href="#502-error_pos_cont_pos_err">502 ERROR_POS_CONT_POS_ERR</a></h3>
<p>Description: PosCont too high position error</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle is too far from the path.</p>
<p>How to recover: Drive vehicle closer to the route manually.</p>
<h3 id="503-error_veh_inte_not_ready"><a class="header" href="#503-error_veh_inte_not_ready">503 ERROR_VEH_INTE_NOT_READY</a></h3>
<p>Description: This error indicates that Navitrol's primary vehicle interface is not operational preventing operation.</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle interface is not ready at start.</p>
<p>How to recover: Error is not active anymore when Navitrol can communicate with vehicle. If error stays on take a log and contact Navitec.</p>
<h3 id="504-error_veh_inte_connection"><a class="header" href="#504-error_veh_inte_connection">504 ERROR_VEH_INTE_CONNECTION</a></h3>
<p>Description: Communication to vehicle motor controller not working</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle interface is not working.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="505-error_pos_cont_fork_time_err"><a class="header" href="#505-error_pos_cont_fork_time_err">505 ERROR_POS_CONT_FORK_TIME_ERR</a></h3>
<p>Description: PosCont fork value did not reach reference value within time limit</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Fork does not follow the command in time. Fork position should reach the reference within the time set by parameter actuator_timer_s.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="506-error_pos_cont_speed_high"><a class="header" href="#506-error_pos_cont_speed_high">506 ERROR_POS_CONT_SPEED_HIGH</a></h3>
<p>Description: Speed value difference too high above the reference value</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle speed is higher than the reference</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="507-error_pos_cont_speed_low"><a class="header" href="#507-error_pos_cont_speed_low">507 ERROR_POS_CONT_SPEED_LOW</a></h3>
<p>Description: Speed value difference too high below the reference value</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle speed is lower than the reference</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="508-error_pos_cont_fork_limit_err"><a class="header" href="#508-error_pos_cont_fork_limit_err">508 ERROR_POS_CONT_FORK_LIMIT_ERR</a></h3>
<p>Description: PosCont fork value outside of hard limits</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Fork measurement is outside limits</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="509-error_pos_cont_seg_error"><a class="header" href="#509-error_pos_cont_seg_error">509 ERROR_POS_CONT_SEG_ERROR</a></h3>
<p>Description: PosCont segment error</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Something is wrong with the drive command. Navitrol is not able to find the correct segment. One of the possible reasons is mismatch between Navitrol and Navithor segment files. Another possible reason could be an attempt to create a drive order to the symbolic point where AGV is standing.</p>
<p>How to recover: Try to increase project version of Tools project and upload it. Check drive order data sent to Navitrol. If this does not help, take a log and contact Navitec.</p>
<h3 id="510-error_actuator_data_missing_from_segments"><a class="header" href="#510-error_actuator_data_missing_from_segments">510 ERROR_ACTUATOR_DATA_MISSING_FROM_SEGMENTS</a></h3>
<p>Description: Segment file does not actuator control values</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Segment file is not right for the machine.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="511-error_motor_temp_sensor"><a class="header" href="#511-error_motor_temp_sensor">511 ERROR_MOTOR_TEMP_SENSOR</a></h3>
<p>Description: Motor over temperature</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Motor temperature is too high</p>
<p>How to recover: Check the motor and brakes.</p>
<h3 id="512-error_safety_circuit_comms"><a class="header" href="#512-error_safety_circuit_comms">512 ERROR_SAFETY_CIRCUIT_COMMS</a></h3>
<p>Description: Safety circuit connection error</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol cannot communicate with safety logic.</p>
<p>How to recover: Check the communication to safety logic.</p>
<h3 id="513-error_dead_reck_jump"><a class="header" href="#513-error_dead_reck_jump">513 ERROR_DEAD_RECK_JUMP</a></h3>
<p>Description: Deadreckoning detected a jump in raw odometry</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Dead reckoning value jumps.</p>
<p>How to recover: Something is wrong with the dead reckoning values. Take a log and contact Navitec.</p>
<h3 id="514-error_load_position_error"><a class="header" href="#514-error_load_position_error">514 ERROR_LOAD_POSITION_ERROR</a></h3>
<p>Description: Actuator activation blocked, because AGV is too far away from the symbolic point</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Requested load status is unknown, or target symbolic point is not reached.</p>
<p>How to recover: Error is reset automatically with timer. Try to drive AGV again to symbolic point. The load process should start if the AGV reaches the target symbolic point.</p>
<h3 id="515-error_actuator_use_not_allowed"><a class="header" href="#515-error_actuator_use_not_allowed">515 ERROR_ACTUATOR_USE_NOT_ALLOWED</a></h3>
<p>Description: Tried to activate actuator on wrong location, e.g. load on unload symbolic point</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="516-error_racking_wrong_parameters"><a class="header" href="#516-error_racking_wrong_parameters">516 ERROR_RACKING_WRONG_PARAMETERS</a></h3>
<p>Description: Racking parameters are limiting drive mission to given height</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Target shelf height is not within range of defined actuator parameters. Another reason is that pallet detection parameters are not defined when target symbolic point has pallet detection feature enabled.</p>
<p>How to recover: Error reason is printed to console and to log.txt. Check which parameter was rejecting the drive and find whether target shelf height or parameter is wrong. Other option is to take a log and contact Navitec.</p>
<h3 id="517-error_actuator_safe_zone_violation"><a class="header" href="#517-error_actuator_safe_zone_violation">517 ERROR_ACTUATOR_SAFE_ZONE_VIOLATION</a></h3>
<p>Description: Too high difference between target and measured values in actuator safe zone</p>
<p>Error level: Fatal</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: AGV is inside actuator safe zone and measured actuator value is not within tolerances from the target value</p>
<p>How to recover: Check that actuator safety zone is defined so that AGV is never inside it when it is safe to move actuator while driving. Check that safe area around AGV is not too big actuator_safety_zone_marging_meters. Feature works only when actuator_load_min_val is 0. Acknowledge when fatal error can be cleared.</p>
<h3 id="518-error_racking_agv_too_close_rack"><a class="header" href="#518-error_racking_agv_too_close_rack">518 ERROR_RACKING_AGV_TOO_CLOSE_RACK</a></h3>
<p>Description: AGV too close to rack to be able to move actuator</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: AGV's distance to given target rack is within minimum allowed distance to move actuator.</p>
<p>How to recover: If AGV is in production, check if fleet control is able to drive the AGV first away from the rack automatically. Otherwise, drive AGV away from the rack manually.</p>
<h3 id="519-error_pallet_det_found_and_searched_mismatch"><a class="header" href="#519-error_pallet_det_found_and_searched_mismatch">519 ERROR_PALLET_DET_FOUND_AND_SEARCHED_MISMATCH</a></h3>
<p>Description: Target detection - found target does not match the searched ones set in message 3032</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Pallet detection found a target that does not match the ones defined in supervisor message 3032</p>
<p>How to recover: Resolve mismatch manually (remove the unwanted pallet) or add the found target to the searched ones.</p>
<h3 id="520-error_battery_high_temperature"><a class="header" href="#520-error_battery_high_temperature">520 ERROR_BATTERY_HIGH_TEMPERATURE</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="521-error_cannot_change_racking_state"><a class="header" href="#521-error_cannot_change_racking_state">521 ERROR_CANNOT_CHANGE_RACKING_STATE</a></h3>
<p>Description: AGV does not fulfill required criteria to change the current racking state and move to next one</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Multiple reasons. For example, rack was not empty when going to unload a pallet.</p>
<p>How to recover: Check that rack is empty when AGV is going to unload.
Check that pallet can be detected when going to load.</p>
<h3 id="522-error_racking_empty_space_not_detected"><a class="header" href="#522-error_racking_empty_space_not_detected">522 ERROR_RACKING_EMPTY_SPACE_NOT_DETECTED</a></h3>
<p>Description: Unload area not free. AGV cannot continue driving</p>
<p>Error level: Fatal</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: See description</p>
<p>How to recover: Check that shelf is correct and find out reason why sensor sees there an object. Acknowledge when fatal error can be cleared.</p>
<h3 id="523-error_pallet_pocket_not_found"><a class="header" href="#523-error_pallet_pocket_not_found">523 ERROR_PALLET_POCKET_NOT_FOUND</a></h3>
<p>Description: Couldn't find suitable pocket.</p>
<p>Error level: Fatal</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Pallet pocket was not found when AGV was going to load a pallet.</p>
<p>How to recover: Check that there is a pallet on the shelf. Check whether pocket size parameters are correct and that pallet detection works. Acknowledge when fatal error can be cleared.</p>
<h3 id="524-error_racking_beam_detection_failed"><a class="header" href="#524-error_racking_beam_detection_failed">524 ERROR_RACKING_BEAM_DETECTION_FAILED</a></h3>
<p>Description: Couldn't find suitable beam for detecting the shelf height</p>
<p>Error level: Fatal</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: See description</p>
<p>How to recover: Check that shelf height defined for the area is correct. Check whether parameters affecting beam detection are set properly. Acknowledge when fatal error can be cleared.</p>
<h3 id="525-error_pallet_det_failure"><a class="header" href="#525-error_pallet_det_failure">525 ERROR_PALLET_DET_FAILURE</a></h3>
<p>Description: Couldn't find pallet or target is too far away from
expected location</p>
<p>Error level: Fatal</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: See description</p>
<p>How to recover: Check that there is a pallet at the load location and it is not too far or have too much angle offset from expected position. Acknowledge when fatal error can be cleared.</p>
<h3 id="526-error_actuator_out_of_tolerances_close_rack"><a class="header" href="#526-error_actuator_out_of_tolerances_close_rack">526 ERROR_ACTUATOR_OUT_OF_TOLERANCES_CLOSE_RACK</a></h3>
<p>Description: Too high difference between target and measured value close to rack</p>
<p>Error level: Fatal</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: AGV is closer than minimum allowed distance from rack to be able to move the actuator while driving and measured actuator value is not within tolerances from the target value.</p>
<p>How to recover: Check that actuator can keep its position within tolerances when it is not controller. If error came in loading/unloading, check that actuator is not overshooting the tolerances when controlled to target value. Adjust parameter racking_check_point_before_min_dist_rack_offset_m and/or mot_ctrl_max_wheel_dec_ramped_fast_stop if AGV does not stop early enough in front of minimum allowed distance from rack when still controlling actuator to correct height. Acknowledge when fatal error can be cleared.</p>
<h3 id="527-error_racking_pallet_loading_unloading_issue"><a class="header" href="#527-error_racking_pallet_loading_unloading_issue">527 ERROR_RACKING_PALLET_LOADING_UNLOADING_ISSUE</a></h3>
<p>Description: The pallet is either being pushed or dragged during loading or unloading respectively</p>
<p>Error level: Fatal</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Pallet is detected to be pushed when going for load the pallet or pallet is detected to be dragged when leaving the rack.</p>
<p>How to recover: Check whether detection gave a false positive or if pallet was actually pushed or dragged. Take a log to Navitec for further analysis. Handle the situation with manual driving and loading operations and acknowledge when fatal error can be cleared.</p>
<h3 id="528-error_load_sensor_conflict_with_navithor"><a class="header" href="#528-error_load_sensor_conflict_with_navithor">528 ERROR_LOAD_SENSOR_CONFLICT_WITH_NAVITHOR</a></h3>
<p>Description: Load sensor does not match with Navithor load status.</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: If load_sensor_conflict_gives_error = 1: The sensor does not match Navithor status at the beginning of the buffer lane, at actuator_disable_load_sensor_distance from symbolic point or when the state is changed from Manual. If load_sensor_conflict_gives_error = 2: The sensor does not match Navithor status in Auto state.</p>
<p>How to recover: Check load sensor. If the sensor does not give correct info, check how the pallet is located on the forks. If the sensor gives correct information, the Navithor load status might be incorrect. Doing Unload on Navithor should sync the correct load status to Navithor.</p>
<h3 id="529-error_vehicle_position_not_changing_while_driving"><a class="header" href="#529-error_vehicle_position_not_changing_while_driving">529 ERROR_VEHICLE_POSITION_NOT_CHANGING_WHILE_DRIVING</a></h3>
<p>Description: Odometry data is indicating a change, but position is not changing</p>
<p>Error level: Fatal</p>
<p>Error reason: Common case is the vehicle spinning on spot when trying to drive.</p>
<p>How to recover: User has to physically check the reason and acknowledge the error through NavitrolMonitor, Fleet Control or Navitrol WebInterface.</p>
<h3 id="530-error_curvature_too_high"><a class="header" href="#530-error_curvature_too_high">530 ERROR_CURVATURE_TOO_HIGH</a></h3>
<p>Description: AGV will not be able to drive given trajectory it has limited steer angle</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving (steer drives and omni drives)</p>
<p>Error reason: The given trajectory has too high maximum curvature for the defined steering limits.</p>
<p>How to recover: If the trajectory was automatically generated, user needs to redefine paths using Navithor Tools. If it was custom route, new custom route must be given with lower curvature. If it occurs while driving, take a log and contact Navitec Support.</p>
<h3 id="531-error_racking_pallet_detection_data_not_updated"><a class="header" href="#531-error_racking_pallet_detection_data_not_updated">531 ERROR_RACKING_PALLET_DETECTION_DATA_NOT_UPDATED</a></h3>
<p>Description: The pallet detection data is not available for detecting pushing/dragging of pallet</p>
<p>Error level: Error</p>
<p>Error reason: Pallet is not detected and the distance to pallet cannot be calculated.</p>
<p>How to recover: Check that pallet can be detected with close range. If not, try to change racking_pallet_drag_push_dist_to_pall_loc to have more distance before pallet detection is used. The error is reset with timer. If pallet cannot be detected at all, test pallet detection feature or contact Navitec for pallet detection support.</p>
<h3 id="532-error_racking_disabled"><a class="header" href="#532-error_racking_disabled">532 ERROR_RACKING_DISABLED</a></h3>
<p>Description: Received drive order to Rack point, but racking is disabled</p>
<p>Error level: Error</p>
<p>Error reason: Navitrol has received drive order to Rack Symbolic point when the racking feature is disabled on Navitrol side.</p>
<p>How to recover: If the drive to Rack Symbolic point is intentional, enable the racking feature with this parameter: I,racking_mode to 1. If the drive was meant to be only for normal Symbolic point, remove the Rack feature from the Symbolic point using Navithor Tools.</p>
<h3 id="533-error_modbus_comms"><a class="header" href="#533-error_modbus_comms">533 ERROR_MODBUS_COMMS</a></h3>
<p>Description: Modbus connection error</p>
<p>Error level: Error</p>
<p>Error reason: Navitrol has problems with connection to the Modbus device.</p>
<p>How to recover: Try to ping the Modbus device. If it is not possible to ping the Modbus from the IPC, check the settings for the IP addres of IPC and Modbus device and check the Ethernet connection. If it possible to ping Modbus device, put parameter log_modbus to 1, take a log and contact Navitec support.</p>
<h3 id="534-error_stackloading_target_too_high"><a class="header" href="#534-error_stackloading_target_too_high">534 ERROR_STACKLOADING_TARGET_TOO_HIGH</a></h3>
<p>Description: The scanning height is over the maximum limit.</p>
<p>Error level: Fatal error</p>
<p>Error reason: Fork height goes over the stack_loading_max_height_mm.</p>
<p>How to recover: Increase the max height parameter. If the fork is at the maximum mechanical height already, set this parameter to 0: stack_loading_max_height_raises_error. Then the fork is decreased to the last found pocket if it reaches this maximum limit. If these doesn't help, take a log and contact Navitec support.</p>
<h3 id="539-error_cannot_create_custom_route"><a class="header" href="#539-error_cannot_create_custom_route">539 ERROR_CANNOT_CREATE_CUSTOM_ROUTE</a></h3>
<p>Description: AGV is too close to target to create custom route</p>
<p>Error level: Fatal error</p>
<p>Error reason: Docking with custom route is failed, because there is not enough space for the custom route. Meaning that the target is too close to the AGV.</p>
<p>How to recover: The custom route requires at least this much of space:
docking_control_point_1_dist_from_machine + docking_control_point_2_dist_from_target for AGV to drive it successfully. These parameters can be set to smaller value and then try again. If there are still issues, contact Navitec for support. The fatal error can be cleared from Monitor or Navithor Client by pressing the Clear Fatal Errors -button.</p>
<h3 id="540-error_buffer_lane_stop_point_not_inside_buffer_area"><a class="header" href="#540-error_buffer_lane_stop_point_not_inside_buffer_area">540 ERROR_BUFFER_LANE_STOP_POINT_NOT_INSIDE_BUFFER_AREA</a></h3>
<p>Description: Stop point is not calculated inside the buffer area, cannot perform pick/drop there.</p>
<p>Error level: Fatal error</p>
<p>Error reason: Calculated stopping point for buffer lane has to be inside the buffer area, otherwise pick/drop cannot be performed.</p>
<p>How to recover: If AGV is going for a pick, move the pallet inside the buffer area and check that the stop distance parameter is correct. docking_stop_distance if docking_to_target_enabled is used and buffer_stop_dist_from_object_when_loading for normal load buffer without docking. If AGV is going for a drop, check that there is still space in the buffer lane and check the stop distance parameter buffer_stop_dist_from_object_when_unloading. If there are still issues, contact Navitec for support. The fatal error can be cleared from Monitor or Navithor Client by pressing the Clear Fatal Errors -button.</p>
<h3 id="541-error_drive_order_too_close_to_rack"><a class="header" href="#541-error_drive_order_too_close_to_rack">541 ERROR_DRIVE_ORDER_TOO_CLOSE_TO_RACK</a></h3>
<p>Description: Drive order given too close to rack, cannot drive closer</p>
<p>Error level: Error</p>
<p>Error reason: AGV has a drive order to or close to a rack symbolic point which it cannot reach safely.</p>
<p>How to recover: Give drive order to rack with the shelf ID if it is needed to drive there. Check that the safety limit parameters are not affecting the drive on the aisles (e.g., racking_min_dist_rack_to_move_actuator_meters)</p>
<h3 id="542-error_racking_shelf_id_not_valid"><a class="header" href="#542-error_racking_shelf_id_not_valid">542 ERROR_RACKING_SHELF_ID_NOT_VALID</a></h3>
<p>Description: Received non-positive shelf ID, cannot continue driving.</p>
<p>Error level: Error</p>
<p>Error reason: AGV receives a racking drive order that contains unknown shelf ID.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="543-error_coupled_drive_active_errors"><a class="header" href="#543-error_coupled_drive_active_errors">543 ERROR_COUPLED_DRIVE_ACTIVE_ERRORS</a></h3>
<p>Description: Errors are active on one or more machines in coupled drive</p>
<p>Error level: Error</p>
<p>Error reason: See description.</p>
<p>How to recover: Check what error(s) is active on a follower AGV(s) and act according to the error.</p>
<h3 id="544-error_ext_loc_not_safe_to_drive"><a class="header" href="#544-error_ext_loc_not_safe_to_drive">544 ERROR_EXT_LOC_NOT_SAFE_TO_DRIVE</a></h3>
<p>Description: Driving safety using external localization is not guaranteed.</p>
<p>Error level: Error</p>
<p>Error reason: AGV is given a drive order close to QR stop point after restart of software or after AGV has already driven to the same symbolic point.</p>
<p>How to recover: Drive AGV away from the symbolic point (further than ext_loc_check_path_ready_dist). Then, AGV can be driven back to the symbolic point.</p>
<h3 id="545-error_ext_loc_stop_point_not_reached"><a class="header" href="#545-error_ext_loc_stop_point_not_reached">545 ERROR_EXT_LOC_STOP_POINT_NOT_REACHED</a></h3>
<p>Description: AGV has not reached the external localization stop point.</p>
<p>Error level: Error</p>
<p>Error reason: AGV has been given a drive order to symbolic point that has QR stop point defined but it stops to symbolic point using normal scanner navigation.</p>
<p>How to recover: Check that QR stop point is needed in the symbolic point and if so check that ext_loc_stop_point_enabled has been set to 1 and that QR stop point is correct. Drive AGV away from the symbolic point (further than ext_loc_check_path_ready_dist). Then, AGV can be driven back to the symbolic point.</p>
<h3 id="546-error_pocket_det_target_too_high"><a class="header" href="#546-error_pocket_det_target_too_high">546 ERROR_POCKET_DET_TARGET_TOO_HIGH</a></h3>
<p>Description: Pocket detection target goes higher than actuator_max_val</p>
<p>Error level: Fatal error</p>
<p>Error reason: Pocket detection target height goes over max actuator val. Pocket detection maximum height is calculated from target shelf height + stack_loading_max_pocket_size_mm parameter. If that height goes over actuator_max_val parameter, this error is shown.</p>
<p>How to recover: Decrease the stack_loading_max_pocket_size_mm or increase the actuator_max_val parameter.</p>
<h3 id="547-error_barrier_stop_failed"><a class="header" href="#547-error_barrier_stop_failed">547 ERROR_BARRIER_STOP_FAILED</a></h3>
<p>Description: Barrier stop has failed.</p>
<p>Error level: Fatal error</p>
<p>Error reason: Either the agv reached the end destination without reaching all signals, or a timeout happened after reaching the first signal but not the others. Another possible reason is that another error was triggered during the barrier stop process.</p>
<p>How to recover: Check the barrier stop sensors on the agv. Ensure the barrier_stop_check_dist and barrier_stop_signal_max_wait_time_ms are set correctly.</p>
<h3 id="548-error_agv_at_rack_after_startup"><a class="header" href="#548-error_agv_at_rack_after_startup">548 ERROR_AGV_AT_RACK_AFTER_STARTUP</a></h3>
<p>Description: AGV is too close to rack after start. Cannot do anything.</p>
<p>Error level: Fatal error</p>
<p>Error reason: AGV is on the rack symbolic point or inside the racking_min_dist_rack_to_move_actuator_meters from the rack symbolic point when the system is started.</p>
<p>How to recover: Drive the AGV manually away from the rack (further away than the racking_min_dist_rack_to_move_actuator_meters) and clear the fatal error from the Monitor or from the Client.</p>
<h3 id="549-error_stackloading_pocket_found_too_low"><a class="header" href="#549-error_stackloading_pocket_found_too_low">549 ERROR_STACKLOADING_POCKET_FOUND_TOO_LOW</a></h3>
<p>Description: The found pocket was found too low.</p>
<p>Error level: Fatal error</p>
<p>Error reason: The pocket (space between pallet legs) is lower than stack_loading_max_decrease_val_after_scan_mm from the current fork height.</p>
<p>How to recover: Increase this parameter. The idea is that this parameter is a bit higher than the highest pallet on the stack. It is used to avoid the fork to pick multiple pallets as one. If the AGV is allowed to pick multiple pallets this parameter can be set to 0 to disable this check. If changing this parameter doesn't help, take a log and contact Navitec support.</p>
<h3 id="550-error_load_unload_height_too_low"><a class="header" href="#550-error_load_unload_height_too_low">550 ERROR_LOAD_UNLOAD_HEIGHT_TOO_LOW</a></h3>
<p>Description: The loading or unloading target height is too low. Cannot perform load or unload.</p>
<p>Error level: Fatal error</p>
<p>Error reason: Loading target height is lower that current actuator height or unloading target height is lower than minimum actuator height.</p>
<p>How to recover: Fatal error can be cleared from Monitor or Client. Check these parameters: from Navitrol params.txt: actuator_load_aboard_offset_mm, actuator_load_min_val and actuator_min_val. From machine type parameter file: ACTUATOR_MIN_VAL and ACTUATOR_LOAD_MIN_VAL. And the route heights. The load target height should be in general case, the route height + offset or minimum load height. The unload target height is in general case, the route height**.** This error takes automatic log. Take that from the IPC logs folder (folder name is same as the error) and contact Navitec support.</p>
<h3 id="551-error_rtr_and_vector_drive_conflict"><a class="header" href="#551-error_rtr_and_vector_drive_conflict">551 ERROR_RTR_AND_VECTOR_DRIVE_CONFLICT</a></h3>
<p>Description: Return to route is not possible when vector drive is used, turn off vector drive to use return to route.</p>
<p>Error level: error</p>
<p>Error reason: Vector driving and return to route both use custom route functionality and therefore cannot be used simultaneously. For using return to route, vector driving must be deactivated..</p>
<p>How to recover: Deactivate vector driving over the CAN interface to enable return to route.</p>
<h3 id="553-error_speed_control_stopped_agv_did_not_move"><a class="header" href="#553-error_speed_control_stopped_agv_did_not_move">553 ERROR_SPEED_CONTROL_STOPPED_AGV_DID_NOT_MOVE</a></h3>
<p>Description: AGV did not move within the time limit. Stopping speed control</p>
<p>Error level: Fatal error</p>
<p>Error reason: One of the driving motors is standing still even though target speed is non-zero,</p>
<p>How to recover: Check if the motor is physically rotating. Check odometry data (speed/encoder values) from the motor controllers. Make sure that parameter &quot;speed_timer_s&quot; values are higher than motor response time.</p>
<h3 id="554-error_destination_update_failed"><a class="header" href="#554-error_destination_update_failed">554 ERROR_DESTINATION_UPDATE_FAILED</a></h3>
<p>Description: Failed to find acceptable route to updated destination</p>
<p>Error level: error</p>
<p>Error reason: Updated destination from Supervisor can not be reached from current AGV position and driving direction.</p>
<p>How to recover: The error will stop the AGV and will reset by itself. Last drive order is terminated when this error is triggered. Supervisor can send a new drive order to desired destination after error has reset.</p>
<h3 id="555-error_load_sensor_status_changed_in_auto"><a class="header" href="#555-error_load_sensor_status_changed_in_auto">555 ERROR_LOAD_SENSOR_STATUS_CHANGED_IN_AUTO</a></h3>
<p>Description: Load sensor status changed in auto state. Check that sensor is reporting correct status or that load is placed firmly on the AGV</p>
<p>Error level: Fatal error</p>
<p>Error reason: Load sensor status changed in Auto state and it has been on the new value for <strong>load_sensor_status_change_timer_ms</strong> amount of time.</p>
<p>How to recover: Check that load sensor reports the correct value and check that load is placed firmly to the AGV.</p>
<h3 id="556-error_load_sensor_conflict_after_pickup"><a class="header" href="#556-error_load_sensor_conflict_after_pickup">556 ERROR_LOAD_SENSOR_CONFLICT_AFTER_PICKUP</a></h3>
<p>Description: Load sensor does not detect pallet after pick up.</p>
<p>Error level: Fatal error</p>
<p>Error reason: Load sensor is 0 after pick up is done.</p>
<p>How to recover: Check that load sensor reports the correct value and check that load is placed firmly to the AGV. If the sensor cannot be used after the pick up for some reason, this error can be disabled with this parameter: <strong>actuator_check_load_sensor_status_after_loading</strong>.</p>
<h3 id="557-error_load_sensor_conflict_after_dropoff"><a class="header" href="#557-error_load_sensor_conflict_after_dropoff">557 ERROR_LOAD_SENSOR_CONFLICT_AFTER_DROPOFF</a></h3>
<p>Description: Load sensor detects pallet after drop off.</p>
<p>Error level: Fatal error</p>
<p>Error reason: Load sensor is 1 after drop off is done.</p>
<p>How to recover: Check that load sensor reports the correct value. If the sensor cannot be used after the drop off, this error can be disabled with this parameter: <strong>actuator_check_load_sensor_status_after_unloading</strong>.</p>
<h3 id="558-error_too_many_similar_actuators"><a class="header" href="#558-error_too_many_similar_actuators">558 ERROR_TOO_MANY_SIMILAR_ACTUATORS</a></h3>
<p>Description: Too many similar actuators requested for control.</p>
<p>Error level: error</p>
<p>Error reason: The supervisor requests control of too many similar actuators at the same time.</p>
<p>How to recover: Reduce the amount of requested simultaneously controlled similar actuators and control them alternately.</p>
<h3 id="559-error_actuator_safety_violated"><a class="header" href="#559-error_actuator_safety_violated">559 ERROR_ACTUATOR_SAFETY_VIOLATED</a></h3>
<p>Description: Safety sensor reported that actuator or AGV is colliding. Stopping all actuator controls.</p>
<p>Error level: Fatal error</p>
<p>Error reason: Some protruding goods or other obstacle is causing a collision risk for the AGV body or the actuator.</p>
<p>How to recover: Inspect the surroundings of the AGV, actuator and load before moving out the AGV.</p>
<h3 id="560-error_target_detection_ref_too_high"><a class="header" href="#560-error_target_detection_ref_too_high">560 ERROR_TARGET_DETECTION_REF_TOO_HIGH</a></h3>
<p>Description: Target detection reference goes higher than actuator_max_val.</p>
<p>Error level: Fatal error</p>
<p>Error reason: The combination of shelf height and target detection height addition exceeds the actuator maximum height.</p>
<p>How to recover: If the actuator_max_val cannot be increased, the detection addition must be decreased or the shelf cannot be used for this kind of load detection.</p>
<h3 id="561-error_cleaning_actuator_timeout"><a class="header" href="#561-error_cleaning_actuator_timeout">561 ERROR_CLEANING_ACTUATOR_TIMEOUT</a></h3>
<p>Description: Cleaning actuator did not reach reference value within the time limit.</p>
<p>Error level: Error</p>
<p>Error reason: Some of the cleaning actuator did not follow the command for some time.</p>
<p>How to recover: Check the command and measurement from the interface. Check the actuator wiring, position and limit switches position (if applicable).</p>
<h3 id="562-error_3d_partial_views_invalid"><a class="header" href="#562-error_3d_partial_views_invalid">562 ERROR_3D_PARTIAL_VIEWS_INVALID</a></h3>
<p>Description: 3D detection is enabled but the partial views for 3d detection are invalid or could not be found.</p>
<p>Error level: Error</p>
<p>Error reason: The required files for detection could not be found on the AGV, based on parameter obj_reg_3d_model_name[i]</p>
<p>How to recover: Upload the CAD file via Monitor form, verify that the parameter name is correct</p>
<h3 id="563-error_3d_prerequisites_not_found"><a class="header" href="#563-error_3d_prerequisites_not_found">563 ERROR_3D_PREREQUISITES_NOT_FOUND</a></h3>
<p>Description: 3D detection is enabled but the required 3rd party libraries could not be found on the AGV.</p>
<p>Error level: Error</p>
<p>Error reason: The third party library have not been properly installed on the AGV.</p>
<p>How to recover: Follow the installation instructions provided in the documentation</p>
<h3 id="564-error_abs_pos_too_large_estimate_deviation"><a class="header" href="#564-error_abs_pos_too_large_estimate_deviation">564 ERROR_ABS_POS_TOO_LARGE_ESTIMATE_DEVIATION</a></h3>
<p>Description: The absolute positioning pose estimate deviates too much from current pose.</p>
<p>Error level: Error</p>
<p>Machine types: Any</p>
<p>Error reason: The obtained absolute positioning pose estimate deviates by more than sf_abspos_max_position_deviation or sf_abspos_max_angle_deviation_deg from the current pose</p>
<p>How to recover: Increase the parameter values or verify why the absolute positioning pose estimate deviates from the current. If the issue persists, take a log and contact Navitec.</p>
<h3 id="565-error_abs_pos_no_conf_received"><a class="header" href="#565-error_abs_pos_no_conf_received">565 ERROR_ABS_POS_NO_CONF_RECEIVED</a></h3>
<p>Description: No valid absolute position measurement confidence received in a time interval of parameter sf_abspos_max_time_since_valid_conf_ms_arr[]</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicle communicating with ROS.</p>
<p>Error reason: Navitrol has not received any valid absolute positioning measurement confidence in a time interval of parameter sf_abspos_max_time_since_valid_conf_ms_arr[].</p>
<p>How to recover:</p>
<ul>
<li>Check that Navitec ROS Docker container is running (<code>docker ps -a</code>)</li>
<li>Check that GIM ROS Docker containers are running (<code>docker ps -a</code>)</li>
<li>Check the 'Absolute positioning' document for
<ul>
<li>Advanced troubleshooting</li>
<li>Required parameters for ROS and sensor fusion</li>
</ul>
</li>
</ul>
<h3 id="566-error_no_permission_to_drive_custom_route"><a class="header" href="#566-error_no_permission_to_drive_custom_route">566 ERROR_NO_PERMISSION_TO_DRIVE_CUSTOM_ROUTE</a></h3>
<p>Description: Cannot drive custom route, because fleet control did not give permission.</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Fleet control didn't allow driving custom route. Check that the area is not reserved by any other AGV. If Navithor is the fleet control, check Navithor logs for more details why the custom route was rejected.</p>
<p>How to recover: Error is reset automatically with a timer. Move the blocking AGVs away and try again.</p>
<h3 id="567-error_custom_route_fleet_control_permission_timeout"><a class="header" href="#567-error_custom_route_fleet_control_permission_timeout">567 ERROR_CUSTOM_ROUTE_FLEET_CONTROL_PERMISSION_TIMEOUT</a></h3>
<p>Description: Cannot drive custom route, didn't receive fleet control permission in time.</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Fleet control didn't answer to Navitrol if it is okay to drive custom route within <strong>fleet_control_wait_time_for_answer_s</strong> time. Increase the parameter or check Navithor (if that is the fleet control) logs for more details why there was no answer within time.</p>
<p>How to recover: Error is reset automatically with a timer. Try again and if the issue persist, take fleet control log and contact Navitec.</p>
<h3 id="568-error_pickup_or_dropoff_failure"><a class="header" href="#568-error_pickup_or_dropoff_failure">568 ERROR_PICKUP_OR_DROPOFF_FAILURE</a></h3>
<p>Description: Cannot perform pickup or drop-off, trajectory does not exist or base height not valid.</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: No trajectory, invalid current trajectory point or couldn't get any base height when trying to do pickup or drop-off </p>
<p>How to recover: Error is reset automatically with a timer. Drive AGV away and then back and try again pickup or drop-off and if the issue persist, take log and contact Navitec.</p>
<h3 id="569-error_docking_failed-1"><a class="header" href="#569-error_docking_failed-1">569 ERROR_DOCKING_FAILED</a></h3>
<p>Description: <a href="Miscellaneous/ErrorDescriptions/../../PositionControl/Docking/Docking-en.html">Docking</a> failed in a way that requires manual intervention. </p>
<p>Error level: Fatal error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Fatal failure during docking process.</p>
<p>How to recover: See the automatically taken log for more details and resolve the docking situation and the error reason manually. Release the fatal error and retry docking from the beginning.</p>
<h3 id="571-error_driving_towards_stack_not_allowed"><a class="header" href="#571-error_driving_towards_stack_not_allowed">571 ERROR_DRIVING_TOWARDS_STACK_NOT_ALLOWED</a></h3>
<p>Description: Driving towards stack in wrong state, drive away to reset the stacking state. Used in both <a href="Miscellaneous/ErrorDescriptions/../../LoadHandling/StackLoading/StackLoading-en.html">Picking from stack</a> and <a href="Miscellaneous/ErrorDescriptions/../../LoadHandling/BlockStacking/BlockStacking-en.html">Drop-off to stack</a> features.</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>How to recover: Drive AGV away from the stack to reset the state.</p>
<h2 id="position-control-warnings"><a class="header" href="#position-control-warnings">Position Control Warnings</a></h2>
<h3 id="601-warning_agv_low_battery"><a class="header" href="#601-warning_agv_low_battery">601 WARNING_AGV_LOW_BATTERY</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="602-warning_pos_cont_fork_war"><a class="header" href="#602-warning_pos_cont_fork_war">602 WARNING_POS_CONT_FORK_WAR</a></h3>
<p>Description: PosCont fork value not within limits. Move not allowed</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Fork height is too far from the reference value</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="603-warning_estop_active"><a class="header" href="#603-warning_estop_active">603 WARNING_ESTOP_ACTIVE</a></h3>
<p>Description: Emergency stop is active</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: ESTOP is active</p>
<p>How to recover: Release ESTOP</p>
<h3 id="604-warning_fw_obstacle"><a class="header" href="#604-warning_fw_obstacle">604 WARNING_FW_OBSTACLE</a></h3>
<p>Description: Obstacle detected in front of vehicle. Speed may be limited</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Scanner detects obstacle in front of the vehicle</p>
<p>How to recover: Recovers automatically when the obstacle is not seen anymore. Remove the obstacle, change the route or modify warning zones.</p>
<h3 id="605-warning_bw_obstacle"><a class="header" href="#605-warning_bw_obstacle">605 WARNING_BW_OBSTACLE</a></h3>
<p>Description: Obstacle detected behind of vehicle. Speed may be limited</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Scanner detects obstacle behind the vehicle</p>
<p>How to recover: Recovers automatically when the obstacle is not seen anymore. Remove the obstacle, change the route or modify warning zones.</p>
<h3 id="606-warning_slowed_down_external_source"><a class="header" href="#606-warning_slowed_down_external_source">606 WARNING_SLOWED_DOWN_EXTERNAL_SOURCE</a></h3>
<p>Description: Slow down request received from external source (e.g. PLC or IO)</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: See the reason from PLC or IO</p>
<p>How to recover: Recovers automatically when PLC does not ask Navitrol to slow down anymore</p>
<h3 id="607-warning_safety_scanner_obstacle"><a class="header" href="#607-warning_safety_scanner_obstacle">607 WARNING_SAFETY_SCANNER_OBSTACLE</a></h3>
<p>Description: Obstacle detected by one of safety scanners. Speed may be limited</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: One of the safety scanners detects obstacle</p>
<p>How to recover: Recovers automatically when the obstacle is not seen anymore. Remove the obstacle, change the route or modify warning zones.</p>
<h3 id="608-warning_veh_inte_high_dt_stdev"><a class="header" href="#608-warning_veh_inte_high_dt_stdev">608 WARNING_VEH_INTE_HIGH_DT_STDEV</a></h3>
<p>Description: Vehicle motor controller interface update interval standard deviance is too high</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle control interval is longer than parameter control_interval_max_stdev_us</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="609-warning_standalone_disabled"><a class="header" href="#609-warning_standalone_disabled">609 WARNING_STANDALONE_DISABLED</a></h3>
<p>Description: Standalone feature disabled. Possible reasons Navithor is connected or Production simulation is enabled in Monitor</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: When Navitrol is connected to Navithor or Production simulation is enabled at Navitrol monitor they have control and Navitrol cannot be commanded as standalone</p>
<p>How to recover: Close other connections.</p>
<h3 id="610-warning_no_seg_file"><a class="header" href="#610-warning_no_seg_file">610 WARNING_NO_SEG_FILE</a></h3>
<p>Description: Segment file not found</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: There is no segment file in /home/navitec folder</p>
<p>How to recover: Upload segment file to Navitrol</p>
<h3 id="611-warning_agv_no_battery_level"><a class="header" href="#611-warning_agv_no_battery_level">611 WARNING_AGV_NO_BATTERY_LEVEL</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="612-warning_target_not_detected-1"><a class="header" href="#612-warning_target_not_detected-1">612 WARNING_TARGET_NOT_DETECTED</a></h3>
<p>Description: Target for docking not detected</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol cannot find the target for docking</p>
<p>How to recover: Make sure that target is present. If this is already a case, take a log and contact Navitec.</p>
<h3 id="613-warning_target_approach_error-1"><a class="header" href="#613-warning_target_approach_error-1">613 WARNING_TARGET_APPROACH_ERROR</a></h3>
<p>Description: Target location differs too much from expected during <a href="Miscellaneous/ErrorDescriptions/../../PositionControl/Docking/Docking-en.html">docking</a>.</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol cannot find the target anymore or is not capable to drive to target</p>
<p>How to recover: Make sure that target is present at correct place. If this is already a case, take a log and contact Navitec.</p>
<h3 id="614-warning_driving_with_only_odometry"><a class="header" href="#614-warning_driving_with_only_odometry">614 WARNING_DRIVING_WITH_ONLY_ODOMETRY</a></h3>
<p>Description: Location correction disabled, driving with only odometry</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol is driving with odometry only because it is told to do so because of the segment properties</p>
<p>How to recover: Information only. Not an error</p>
<h3 id="615-warning_low_pos_conf_slowed_down"><a class="header" href="#615-warning_low_pos_conf_slowed_down">615 WARNING_LOW_POS_CONF_SLOWED_DOWN</a></h3>
<p>Description: Slowing down due to low position confidence</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Position confidence has dropped below the limits. Slowing down.</p>
<p>How to recover: Should recover automatically. If not initialize position. If the warning keeps coming take a log and contact Navitec.</p>
<h3 id="616-warning_navithor_not_connected"><a class="header" href="#616-warning_navithor_not_connected">616 WARNING_NAVITHOR_NOT_CONNECTED</a></h3>
<p>Description: Couldn't connect to Navithor</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol has no communication to Navitrol.</p>
<p>How to recover: Make sure that communication parameters are correct. Check that Navitrol server is running.</p>
<h3 id="617-warning_speed_limited"><a class="header" href="#617-warning_speed_limited">617 WARNING_SPEED_LIMITED</a></h3>
<p>Description: Speed limited e.g. because of load status</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol has limited speed because vehicle is loaded</p>
<p>How to recover: Information only</p>
<h3 id="618-warning_load_position_error"><a class="header" href="#618-warning_load_position_error">618 WARNING_LOAD_POSITION_ERROR</a></h3>
<p>Description: Actuator activation was blocked, because AGV is too far
away from the symbolic point</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="619-warning_actuator_use_not_allowed"><a class="header" href="#619-warning_actuator_use_not_allowed">619 WARNING_ACTUATOR_USE_NOT_ALLOWED</a></h3>
<p>Description: Tried to activate actuator on wrong location, e.g. load on
unload symbolic point</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="620-warning_symbol_point_occupied"><a class="header" href="#620-warning_symbol_point_occupied">620 WARNING_SYMBOL_POINT_OCCUPIED</a></h3>
<p>Description: Object detected in occupancy check area</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="621-warning_drive_order_disabled"><a class="header" href="#621-warning_drive_order_disabled">621 WARNING_DRIVE_ORDER_DISABLED</a></h3>
<p>Description: Drive order was disabled by an external source</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="622-warning_obstacle_detected"><a class="header" href="#622-warning_obstacle_detected">622 WARNING_OBSTACLE_DETECTED</a></h3>
<p>Description: Detected an obstacle</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: There are scan points on current route and the AGV will collide into them if it continues driving</p>
<p>How to recover: Obstacle disappears</p>
<p>Related features:</p>
<ul>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></li>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidance/ObstacleAvoidance-en.html">Obstacle Avoidance</a></li>
</ul>
<h3 id="623-warning_obstacle_avoidance_v2_high_dt"><a class="header" href="#623-warning_obstacle_avoidance_v2_high_dt">623 WARNING_OBSTACLE_AVOIDANCE_V2_HIGH_DT</a></h3>
<p>Description: Obstacle avoidance V2 is not performing frequently enough</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Obstacle avoidance V2 lacks of sufficient computational resources</p>
<p>How to recover: Reduce the value of the following parameters to save computational resources:</p>
<ul>
<li><code>ros_obst_av_max_plan_dist</code></li>
<li><code>ros_obst_det_max_scan_dist</code></li>
<li><code>ros_obst_av_publish_map</code> (to 0)</li>
</ul>
<p>Related features:</p>
<ul>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></li>
</ul>
<h3 id="624-warning_waiting_obstacle_bypass_permission"><a class="header" href="#624-warning_waiting_obstacle_bypass_permission">624 WARNING_WAITING_OBSTACLE_BYPASS_PERMISSION</a></h3>
<p>Description: Waiting for fleet control permission to drive around the obstacle</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: The AGV needs permission from fleet control to leave nominal route and drive around the obstacle</p>
<p>How to recover: Get permission from fleet control</p>
<p>Related features:</p>
<ul>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></li>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidance/ObstacleAvoidance-en.html">Obstacle Avoidance</a></li>
</ul>
<h3 id="625-warning_no_obstacle_zones"><a class="header" href="#625-warning_no_obstacle_zones">625 WARNING_NO_OBSTACLE_ZONES</a></h3>
<p>Description: Cannot use obstacle avoidance because no obstacle zones have been defined</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: There are no obstacle zones in the environment (segment file)</p>
<p>How to recover: Load a new environment (segment file) with obstacle avoidance zones. Use parameter obst_av_zones,0 to not require or use zones at all.</p>
<h3 id="626-warning_moving_obstacle"><a class="header" href="#626-warning_moving_obstacle">626 WARNING_MOVING_OBSTACLE</a></h3>
<p>Description: Cannot drive around the obstacle because the obstacle is
moving.</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: There is a moving obstacle around the current route</p>
<p>How to recover: Obstacle stops moving or disappears</p>
<h3 id="627-warning_bypass_route_out_of_zone"><a class="header" href="#627-warning_bypass_route_out_of_zone">627 WARNING_BYPASS_ROUTE_OUT_OF_ZONE</a></h3>
<p>Description: Cannot drive around the obstacle because the route would be outsize obstacle avoidance zone</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Cannot drive around the obstacle because the route would be outsize obstacle avoidance zone</p>
<p>How to recover: The algorithm will try the other side if possible. Else, change the obstacle avoidance zones or wait that the obstacle disappears</p>
<h3 id="628-warning_obstacle_too_close"><a class="header" href="#628-warning_obstacle_too_close">628 WARNING_OBSTACLE_TOO_CLOSE</a></h3>
<p>Description: Cannot drive around the obstacle because it is too close to
the AGV</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Obstacle is too close to the AGV</p>
<p>How to recover: Obstacle disappears</p>
<p>Related features:</p>
<ul>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></li>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidance/ObstacleAvoidance-en.html">Obstacle Avoidance</a></li>
</ul>
<h3 id="629-warning_cannot_bypass_reversing_to_nominal_route"><a class="header" href="#629-warning_cannot_bypass_reversing_to_nominal_route">629 WARNING_CANNOT_BYPASS_REVERSING_TO_NOMINAL_ROUTE</a></h3>
<p>Description: Cannot drive around the obstacle. Reversing back to nominal route</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Tried to plan a route around the obstacle for the maximum allowed time without success</p>
<p>How to recover: The AGV will drive back to the nominal route automatically and the warning will disappear</p>
<h3 id="630-warning_cannot_bypass_did_not_get_fleet_control_permission"><a class="header" href="#630-warning_cannot_bypass_did_not_get_fleet_control_permission">630 WARNING_CANNOT_BYPASS_DID_NOT_GET_FLEET_CONTROL_PERMISSION</a></h3>
<p>Description: Cannot drive around the obstacle because fleet control permission was not granted</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Fleet control did not give permission to drive around the obstacle</p>
<p>How to recover: Wait, try again later or obstacle disappears</p>
<p>Related features:</p>
<ul>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></li>
<li><a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidance/ObstacleAvoidance-en.html">Obstacle Avoidance</a></li>
</ul>
<h3 id="631-warning_beginning_driving_around_obstacle"><a class="header" href="#631-warning_beginning_driving_around_obstacle">631 WARNING_BEGINNING_DRIVING_AROUND_OBSTACLE</a></h3>
<p>Description: Beginning to drive around the obstacle</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: The AGV will leave the nominal route and begin driving around the obstacle</p>
<p>How to recover: This warning is just to inform the user -- it is not an error. The warning will disappear itself</p>
<h3 id="632-warning_could_not_create_extend_drive_while_bypassing"><a class="header" href="#632-warning_could_not_create_extend_drive_while_bypassing">632 WARNING_COULD_NOT_CREATE_EXTEND_DRIVE_WHILE_BYPASSING</a></h3>
<p>Description: Extend drive while bypassing failed</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Could not extend the current route while driving around the obstacle</p>
<p>How to recover: Change fleet control extend drive parameters or try again</p>
<h3 id="633-warning_wrong_agv_status_message_version"><a class="header" href="#633-warning_wrong_agv_status_message_version">633 WARNING_WRONG_AGV_STATUS_MESSAGE_VERSION</a></h3>
<p>Description: Cannot use obstacle avoidance with fleet control because
AGV status message version is wrong</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: The value of the parameter agv_status_message_version is not 2 when using fleet control</p>
<p>How to recover: Either do not use fleet control or change agv_status_message_version to 2</p>
<h3 id="634-warning_cannot_bypass_obstacle_too_wide"><a class="header" href="#634-warning_cannot_bypass_obstacle_too_wide">634 WARNING_CANNOT_BYPASS_OBSTACLE_TOO_WIDE</a></h3>
<p>Description: Cannot drive around the obstacle because it is too wide</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: The AGV would have to make too sharp a turn and get far away from the nominal route</p>
<p>How to recover: Obstacle disappears</p>
<h3 id="635-warning_battery_full_charge_needed"><a class="header" href="#635-warning_battery_full_charge_needed">635 WARNING_BATTERY_FULL_CHARGE_NEEDED</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="636-warning_battery_error_or_warning_active"><a class="header" href="#636-warning_battery_error_or_warning_active">636 WARNING_BATTERY_ERROR_OR_WARNING_ACTIVE</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="637-warning_load_detection_conflict"><a class="header" href="#637-warning_load_detection_conflict">637 WARNING_LOAD_DETECTION_CONFLICT</a></h3>
<p>Description: Load detection sensor conflicts with fleet control's status of loading state</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Measurement from load detection sensor is not what fleet control expects</p>
<p>How to recover: Check sensor reading is valid. Take a log and contact Navitec.</p>
<h3 id="638-warning_sensor_failure_in_loading"><a class="header" href="#638-warning_sensor_failure_in_loading">638 WARNING_SENSOR_FAILURE_IN_LOADING</a></h3>
<p>Description: Load detection sensor doesn't recognize a load</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Load detection sensor doesn't find a load onboard after the loading sequence has been completed or during the load sequence.</p>
<p>How to recover: Check sensor reading is valid. If there is a pallet on the forks, check why the sensor is not triggered. If there is no pallet, abort drive and do Unload on Navithor to update the Navithor load status.</p>
<h3 id="639-warning_charging_active"><a class="header" href="#639-warning_charging_active">639 WARNING_CHARGING_ACTIVE</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="642-warning_external_speed_limitation"><a class="header" href="#642-warning_external_speed_limitation">642 WARNING_EXTERNAL_SPEED_LIMITATION</a></h3>
<p>Description: Speed is limited below reference by external source</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol has received information that speed is limited by vehicle controller and vehicle is currently not following reference speed value.</p>
<p>How to recover: Vehicle speed is close enough to reference value</p>
<h3 id="643-warning_obstacle_too_long"><a class="header" href="#643-warning_obstacle_too_long">643 WARNING_OBSTACLE_TOO_LONG</a></h3>
<p>Description: Length of bypassed obstacle is limited</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol cannot bypass obstacle because it is too long.</p>
<p>How to recover: Check the dimensions of the obstacle and check value in the parameter obst_max_obstacle_bypassed.</p>
<h3 id="644-warning_changing_load_or_unload_height"><a class="header" href="#644-warning_changing_load_or_unload_height">644 WARNING_CHANGING_LOAD_OR_UNLOAD_HEIGHT</a></h3>
<p>Description: The correct height is detected with sensor.</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Block stacking or stack loading started. AGV is stopped and is scanning the stack of pallets with a sensor for defining the correct unload or load height. Should be cleared when the height is set and the AGV continues driving.</p>
<p>How to recover: This warning is just to inform the user -- it is not an error. The warning will disappear itself in normal case. If it is enabled far away from the load or unload symbolic point or the AGV is not on the buffer area, reboot the AGV or take a log and contact Navitec.</p>
<h3 id="645-warning_load_aboard_when_driving_to_load_buffer"><a class="header" href="#645-warning_load_aboard_when_driving_to_load_buffer">645 WARNING_LOAD_ABOARD_WHEN_DRIVING_TO_LOAD_BUFFER</a></h3>
<p>Description: Navitrol load status is load aboard. Can't drive to load buffer with load.</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol believes that it has a pallet loaded when driving to load buffer.</p>
<p>How to recover: The Navitrol load status needs to be changed by checking the load sensor (if it is used and the sensor is read during drive) or doing unload from fleet control.</p>
<h3 id="646-warning_battery_high_temperature"><a class="header" href="#646-warning_battery_high_temperature">646 WARNING_BATTERY_HIGH_TEMPERATURE</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="647-warning_decreasing_fork_to_route_level"><a class="header" href="#647-warning_decreasing_fork_to_route_level">647 WARNING_DECREASING_FORK_TO_ROUTE_LEVEL</a></h3>
<p>Description: Vehicle is stopped until fork reaches the route height</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Used in situation where after Stackloading the AGV has picked a pallet from the stack, driven out from the stack and start to decreasing the fork back to the route level. This is used only to give customer information what is going on. The AGV is stopped with softstop and it doesn't show any information on the Monitor.</p>
<p>How to recover: Should be reset automatically when the fork height reaches the target value.</p>
<h3 id="648-warning_racking_prechecks"><a class="header" href="#648-warning_racking_prechecks">648 WARNING_RACKING_PRECHECKS</a></h3>
<p>Description: AGV stopped due to racking prechecks</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Information that AGV is executing prechecks before driving to the rack. Prechecks can be for example empty space detection or pallet detection.</p>
<p>How to recover: Normally it is used just for information. If the warning persists for long time and AGV is not able to continue task execution, take a log and contact Navitec.</p>
<h3 id="649-warning_barrier_stop_failed"><a class="header" href="#649-warning_barrier_stop_failed">649 WARNING_BARRIER_STOP_FAILED</a></h3>
<p>Description: Performing Barrier stop feature failed</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: The AGV did drive to a symbolic point location that has Barrier stop tag enabled without getting both stop signals.</p>
<p>How to recover: Automatically reset after few seconds.</p>
<h3 id="650-warning_slowed_down_source_monitor"><a class="header" href="#650-warning_slowed_down_source_monitor">650 WARNING_SLOWED_DOWN_SOURCE_MONITOR</a></h3>
<p>Description: Slow down request received from monitoring software.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Slow down is received from NavitrolMonitor. Probably, abort or pause button has been pressed.</p>
<p>How to recover: Automatically reset after few seconds.</p>
<h3 id="651-warning_slowed_down_source_supervisor"><a class="header" href="#651-warning_slowed_down_source_supervisor">651 WARNING_SLOWED_DOWN_SOURCE_SUPERVISOR</a></h3>
<p>Description: Slow down request received from supervisor interface.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Slow down/abort command is received from Supervisor.</p>
<p>How to recover: Automatically reset after few seconds.</p>
<h3 id="652-warning_slowed_down_source_fleet_control"><a class="header" href="#652-warning_slowed_down_source_fleet_control">652 WARNING_SLOWED_DOWN_SOURCE_FLEET_CONTROL</a></h3>
<p>Description: Slow down request received from fleet control.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Slow down/abort command is received from fleet control (Navithor or external fleet control).</p>
<p>How to recover: Automatically reset after few seconds.</p>
<h3 id="653-warning_slowed_down_source_console"><a class="header" href="#653-warning_slowed_down_source_console">653 WARNING_SLOWED_DOWN_SOURCE_CONSOLE</a></h3>
<p>Description: Slow down request received from console.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Slow down/abort command is received from console.</p>
<p>How to recover: Automatically reset after few seconds.</p>
<h3 id="654-warning_slowed_down_source_active_error"><a class="header" href="#654-warning_slowed_down_source_active_error">654 WARNING_SLOWED_DOWN_SOURCE_ACTIVE_ERROR</a></h3>
<p>Description: Slow down request because of active error.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol has slowed down because of error active while driving.</p>
<p>How to recover: Automatically reset after few seconds. Check error that activated while driving in this document.</p>
<h3 id="655-warning_slowed_down_coupled_drive_comm"><a class="header" href="#655-warning_slowed_down_coupled_drive_comm">655 WARNING_SLOWED_DOWN_COUPLED_DRIVE_COMM</a></h3>
<p>Description: Slow down because of coupled drive communication issues.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol has slowed down because of issues in coupled drove communications.</p>
<p>How to recover: Automatically reset after few seconds. Check coupled drive communications.</p>
<h3 id="656-warning_slowed_down_auto_move_delay"><a class="header" href="#656-warning_slowed_down_auto_move_delay">656 WARNING_SLOWED_DOWN_AUTO_MOVE_DELAY</a></h3>
<p>Description: Slow down because of auto move delay.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol has slowed down because of active auto move delay.</p>
<p>How to recover: Automatically reset after auto move delay has been reset. Check auto move delay parameters.</p>
<h3 id="657-warning_return_to_route_failed"><a class="header" href="#657-warning_return_to_route_failed">657 WARNING_RETURN_TO_ROUTE_FAILED</a></h3>
<p>Description: Return to route feature could not find a suitable return point or command was rejected as the AGV was not in standby state.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Either the AGV was not on standby mode when the signal was given, or a suitable return route (determined by the parameters) was not found.</p>
<p>How to recover: Will be reset automatically after a few seconds. If the AGV was not on standby, abort the previous task and try again. If a suitable path was not found, either move the AGV manually closer to a defined path or try adjusting the parameters to allow larger errors.</p>
<h3 id="658-warning_detecting_target"><a class="header" href="#658-warning_detecting_target">658 WARNING_DETECTING_TARGET</a></h3>
<p>Description: AGV is doing target detection and is stopped because of the active detection.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: AGV is closer to a detected object than parameter value (obj_reg_3d_stop_before_object_is_detected_and_found_dist). AGV will try to do the detection while being stopped</p>
<p>How to recover: Will be reset automatically if the AGV can detect the target while being stopped or if the target has been missed obj_reg_3d_target_max_n_times_missing times</p>
<h3 id="659-warning_obstacle_avoidance_v2_suspended"><a class="header" href="#659-warning_obstacle_avoidance_v2_suspended">659 WARNING_OBSTACLE_AVOIDANCE_V2_SUSPENDED</a></h3>
<p>Description: Obstacle avoidance V2 is suspended momentarily</p>
<p>Error level: Warning</p>
<p>Machine types: All</p>
<p>Error reason: Obstacle avoidance V2 is suspended due to other feature being active</p>
<p>How to recover: See warning <a href="Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html#355-warning_slam_active">355 WARNING_SLAM_ACTIVE</a></p>
<h3 id="660-warning_waiting_custom_route_fleet_control_permission"><a class="header" href="#660-warning_waiting_custom_route_fleet_control_permission">660 WARNING_WAITING_CUSTOM_ROUTE_FLEET_CONTROL_PERMISSION</a></h3>
<p>Description: Waiting for fleet control permission before driving custom route.</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol is waiting for fleet control to give permission to drive custom route.</p>
<p>How to recover: Warning is reset after permission is given or if ERROR_NO_PERMISSION_TO_DRIVE_CUSTOM_ROUTE or ERROR_CUSTOM_ROUTE_FLEET_CONTROL_PERMISSION_TIMEOUT is set.</p>
<h3 id="661-warning_route_free_navigation_failed"><a class="header" href="#661-warning_route_free_navigation_failed">661 WARNING_ROUTE_FREE_NAVIGATION_FAILED</a></h3>
<p>Description: Route-free navigation command was given, but couldn't complete</p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: There is something preventing the completion of a route-free navigation command to the given ocation. Maybe it can not be reached or the planner is not enabled or connected.</p>
<p>How to recover: Try planning to a different position first. Ensure that the correct parameters are set.</p>
<h3 id="662-warning_bypass_route_planning_active"><a class="header" href="#662-warning_bypass_route_planning_active">662 WARNING_BYPASS_ROUTE_PLANNING_ACTIVE</a></h3>
<p>Description: Obstacle avoidance V2 tries to find actively a bypass path around the obstacle(s)</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Obstacle avoidance V2 has detected at least one obstacle along the route, and the distance between the AGV and the (first) obstacle is less than the defined threshold value for starting the bypass route planning (see parameter <code>ros_obst_av_bypass_planning_dist</code>) </p>
<p>How to recover: Warning disappears once the obstacle disappears / moves off from the route / a valid bypass route has been found</p>
<h3 id="665-warning_3d_sensor_data_not_received"><a class="header" href="#665-warning_3d_sensor_data_not_received">665 WARNING_3D_SENSOR_DATA_NOT_RECEIVED</a></h3>
<p>Description: The 3d sensor data is not received. If DDS is used the message initialization might also be the root cause.</p>
<p>Error level: Warning</p>
<p>Machine types: Any</p>
<p>Error reason: The 3d sensor data is not received. If DDS is used the message initialization might also be the root cause.</p>
<p>How to recover: Verify that the sensor IP is correct, parameter obj_reg_3d_sensor_ip. If DDS is used, check that the dds_pointcloud2_topic_name is correct and that the sensor's driver is running and relaying sensor data. Verify network configurations are correct.</p>
<h2 id="hardwaremachine-specific-critical-errors"><a class="header" href="#hardwaremachine-specific-critical-errors">Hardware/Machine Specific Critical Errors</a></h2>
<h3 id="701-error_scanner_params_not_valid"><a class="header" href="#701-error_scanner_params_not_valid">701 ERROR_SCANNER_PARAMS_NOT_VALID</a></h3>
<p>Description: Scanner parameters are not valid</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Scanner parameters inside params.txt file are wrong</p>
<p>How to recover: Correct the parameter file</p>
<h3 id="702-error_front_scanner_fault"><a class="header" href="#702-error_front_scanner_fault">702 ERROR_FRONT_SCANNER_FAULT</a></h3>
<p>Description: Front scanner reports internal hardware fault</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Check the scanner</p>
<p>How to recover: Fix the scanner</p>
<h3 id="703-error_rear_scanner_fault"><a class="header" href="#703-error_rear_scanner_fault">703 ERROR_REAR_SCANNER_FAULT</a></h3>
<p>Description: Rear scanner reports internal hardware fault</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Check the scanner</p>
<p>How to recover: Fix the scanner</p>
<h3 id="704-error_lift_ctrl_nocomms"><a class="header" href="#704-error_lift_ctrl_nocomms">704 ERROR_LIFT_CTRL_NOCOMMS</a></h3>
<p>Description: Lift motor controller communication failure</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with lift0,</p>
<p>Error reason: Communication to lift controller fails</p>
<p>How to recover: Check the cables and lift controller. Take a log and contact Navitec.</p>
<h3 id="705-error_lift_ctrl_controller_fault"><a class="header" href="#705-error_lift_ctrl_controller_fault">705 ERROR_LIFT_CTRL_CONTROLLER_FAULT</a></h3>
<p>Description: Lift motor controller indicates fault</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: Lift controller indicates fault</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="706-error_lift_ctrl_calib_failed_out_of_limits"><a class="header" href="#706-error_lift_ctrl_calib_failed_out_of_limits">706 ERROR_LIFT_CTRL_CALIB_FAILED_OUT_OF_LIMITS</a></h3>
<p>Description: Lift height measurement calibration failed to move lift so
limit switches would be released</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: Lift needs to drive to limit in order to calibrate it. Now
this driving to limit failed.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="707-error_plc_failure"><a class="header" href="#707-error_plc_failure">707 ERROR_PLC_FAILURE</a></h3>
<p>Description: PLC error</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: PLC is in error state. No driving is allowed</p>
<p>How to recover: Check the PLC</p>
<h3 id="708-error_no_plc_data"><a class="header" href="#708-error_no_plc_data">708 ERROR_NO_PLC_DATA</a></h3>
<p>Description: no communication to PLC</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol cannot communicate with PLC</p>
<p>How to recover: Check the PLC and cables. Take a log and contact Navitec.</p>
<h3 id="709-error_can_failure"><a class="header" href="#709-error_can_failure">709 ERROR_CAN_FAILURE</a></h3>
<p>Description: CAN bus, hardware or driver error. </p>
<p>Error level: Error</p>
<p>Machine types: Machines with CAN bus</p>
<p>Error reason: Something is wrong with the CAN bus. CAN initialization fails or Rx/Tx counters are accumulating</p>
<p>How to recover: </p>
<ul>
<li>Check IPC CAN interface and related parameters; can_ch, can_bitrate_k.</li>
<li>Check the CAN bus status with CAN Analyser.</li>
<li>Check for bus issues: CAN bus topology and termination, CAN wiring (HI/LO), grounding</li>
<li>Check for nodes with different speeds</li>
</ul>
<h3 id="710-error_too_large_steer_angle"><a class="header" href="#710-error_too_large_steer_angle">710 ERROR_TOO_LARGE_STEER_ANGLE</a></h3>
<p>Description: Measured Steering angle too large</p>
<p>Error level: Error</p>
<p>Machine types: Steer drive machines with Schwarzmueller controller</p>
<p>Error Reason: Steering encoder reports larger value than parameter
mot_ctrl_steer_angle_hard_limit_deg</p>
<p>How to recover: Check that steering is within reasonable limits. Check the parameter value.</p>
<h3 id="711-error_safety_scanner_fault"><a class="header" href="#711-error_safety_scanner_fault">711 ERROR_SAFETY_SCANNER_FAULT</a></h3>
<p>Description: Safety scanner reports internal hardware fault</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Check the scanner</p>
<p>How to recover: Fix the scanner</p>
<h3 id="712-error_safe_outputs_active"><a class="header" href="#712-error_safe_outputs_active">712 ERROR_SAFE_OUTPUTS_ACTIVE</a></h3>
<p>Description: Safe outputs are active: Speed outputs are being zeroed and actuator controls disabled</p>
<p>Error level: Error</p>
<p>Machine types: Ethernet and CAN controlled machines</p>
<p>Error reason: Navitrol internal fault</p>
<p>How to recover: Take a log and contact Navitec</p>
<h3 id="713-error_trailer_transport_coupling"><a class="header" href="#713-error_trailer_transport_coupling">713 ERROR_TRAILER_TRANSPORT_COUPLING</a></h3>
<p>Description: Failure in trailer coupling or uncoupling sequence</p>
<p>Error level: Fatal error</p>
<p>Machine types: Omni drive (only when trailer transport feature is enabled)</p>
<p>Error reason:</p>
<ul>
<li>Trailer was lost or connected unexpectedly
<ul>
<li>While coupled or uncoupled the trailer coupling status from supervisor is changed unexpectedly.</li>
<li>For example, while Navitrol thinks that the trailer is coupled to the AGV and driving and coupling status changes to uncoupled.</li>
<li>No error is raised on unexpected changes during coupling and uncoupling sequences</li>
</ul>
</li>
<li>Kingpin was not found
<ul>
<li>During coupling when reversing to kingpin the maximum drive distance is reached without coupling status indicating that the kingpin is detected.</li>
<li>Max drive distance is determined by trailer_kingpin_straight_drive_dist</li>
</ul>
</li>
<li>The AGV system does not respond to coupling action requests
<ul>
<li>During coupling and coupling sequence the state has been same for too long.</li>
<li>Max wait time is determined by trailer_error_timer_ms</li>
</ul>
</li>
<li>During uncoupling if the automatic return to route fails
<ul>
<li>Either return to route parameters have not been calibrated correctly or the AGV is too far from the route to return.</li>
</ul>
</li>
</ul>
<p>How to recover: User should 1. check the situation. 2. correct the cause of the issue 3. send correct coupling status to Navitrol 4. reset the fatal error. After resetting the error Navitrol will initialize trailer transport state based on the given coupling status.</p>
<h3 id="714-error_trailer_status_not_received"><a class="header" href="#714-error_trailer_status_not_received">714 ERROR_TRAILER_STATUS_NOT_RECEIVED</a></h3>
<p>Description: Valid trailer transport status not received</p>
<p>Error level: Error</p>
<p>Machine types: Omni drive (only when trailer transport feature is enabled)</p>
<p>Error reason: This error is set if valid trailer status has been received once but after that either the communication is lost, or data received is invalid for more than one second.</p>
<p>How to recover: To fix the issue make sure that the supervisor sends <strong>Message 3002 -- Supervisor status, Trailer transport status section (section ID = 12)</strong> with valid data.</p>
<h3 id="715-error_trailer_angle_not_detected"><a class="header" href="#715-error_trailer_angle_not_detected">715 ERROR_TRAILER_ANGLE_NOT_DETECTED</a></h3>
<p>Description: Failed to detect the trailer angle</p>
<p>Error level: Error</p>
<p>Machine types: Omni drive (only when trailer transport feature is enabled)</p>
<p>Error reason: This error is set if trailer angle is not detected successfully when coupled to a trailer. Possible reasons are that the pallet detection is not enabled and set up correctly or the angle detection scanner does find the wheels in the near the axles defined with &quot;Set trailer dimensions&quot;-supervisor message.</p>
<p>How to recover: Make sure that the scanner and pallet detection parameters has been configured correctly and that the scanner sees the wheels of the trailer. The error is automatically reset when the trailer angle is successfully detected -- Successfully detected angle is rendered as a green line in Navitrol Monitor.</p>
<h3 id="716-error_trailer_angle_too_large"><a class="header" href="#716-error_trailer_angle_too_large">716 ERROR_TRAILER_ANGLE_TOO_LARGE</a></h3>
<p>Description: Detected trailer angle exceeds the set limits</p>
<p>Error level: Error</p>
<p>Machine types: Omni drive (only when trailer transport feature is enabled)</p>
<p>Error reason: This error is set if detected trailer angle error compared to the AGV angle is larger than the limits set with parameters <strong>trailer_max_heading_err_close_deg</strong> and <strong>trailer_max_heading_err_far_deg.</strong> See the parameters chapter for more information.</p>
<p>How to recover: The error is automatically reset when the trailer angle is back within the limits. However, getting the angle error to the limits while error is active will most likely require manual control since automatic driving is prevented by the error.</p>
<h2 id="hardwaremachine-specific-errors"><a class="header" href="#hardwaremachine-specific-errors">Hardware/Machine Specific Errors</a></h2>
<h3 id="801-error_plc_comms_stop"><a class="header" href="#801-error_plc_comms_stop">801 ERROR_PLC_COMMS_STOP</a></h3>
<p>Description: PLC stopped machine due to communication break</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with PLC controlling the driving</p>
<p>Error reason: PLC has noticed communication error and stops the driving</p>
<p>How to recover: Check the communication with PLC</p>
<h3 id="802-error_generic_io_definitions"><a class="header" href="#802-error_generic_io_definitions">802 ERROR_GENERIC_IO_DEFINITIONS</a></h3>
<p>Description: error or problem in generic I/O definitions</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with PLC controlling the driving</p>
<p>Error reason: IO definitions are wrong</p>
<p>How to recover: Check the IO definitions at the parameter file and PLC</p>
<h3 id="803-error_eth_error"><a class="header" href="#803-error_eth_error">803 ERROR_ETH_ERROR</a></h3>
<p>Description: Error on AGV</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Ethernet interface</p>
<p>Error reason: Message received over Ethernet interface shows that there is an active error and driving is not allowed</p>
<p>How to recover: Recovers automatically when the error disappears. Check the error reason from the source.</p>
<h3 id="804-error_eth_unknown_status"><a class="header" href="#804-error_eth_unknown_status">804 ERROR_ETH_UNKNOWN_STATUS</a></h3>
<p>Description: AGV sent unknown error status</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Ethernet interface</p>
<p>Error reason: PLC sent unknown status for driving enabled</p>
<p>How to recover: Check why PLC sent this value. Correct the source.</p>
<h3 id="805-error_can_all_nodes_not_oper"><a class="header" href="#805-error_can_all_nodes_not_oper">805 ERROR_CAN_ALL_NODES_NOT_OPER</a></h3>
<p>Description: One or more nodes not operational or all receive messages
not detected</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN interface</p>
<p>Error reason: Some nodes are missing from the CAN bus</p>
<p>How to recover: Check the CAN bus with CAN tools. Check that all the nodes that should be visible are sending data.</p>
<h3 id="806-error_can_rx_timeout"><a class="header" href="#806-error_can_rx_timeout">806 ERROR_CAN_RX_TIMEOUT</a></h3>
<p>Description: Receive timeout in one or more receive messages. All required messages have however been seen at least once in this case. One typical reason for these errors is configuration error of a CANOpen slave device; more specifically the transmission mode (see section CANOpen basics for more details)</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN interface</p>
<p>Error reason: Some message(s) are not received in time.</p>
<p>How to recover: Set parameter log_can_summary to 1 and check the &quot;RX_SUM&quot; logging. Check the CAN bus with CAN Analyser and validate that all the messages are on the bus. Take a log and contact Navitec.</p>
<h3 id="807-error_can_data"><a class="header" href="#807-error_can_data">807 ERROR_CAN_DATA</a></h3>
<p>Description: Invalid data in CAN msg</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN interface</p>
<p>Error reason: CAN data that Navitrol received is not correct</p>
<p>How to recover: Set parameter log_can to 1, take a log and contact Navitec.</p>
<h3 id="808-error_can_config"><a class="header" href="#808-error_can_config">808 ERROR_CAN_CONFIG</a></h3>
<p>Description: CAN slave configuration failure</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN interface</p>
<p>Error reason:  Two possible reason:</p>
<ul>
<li>Navitrol was not able to configure the CAN slaves. Navitrol is not a NMT master even if slave configurations (SDO messages) are expected. Check parameter can_nmt_master.</li>
<li>SDO write to a slave node fails.</li>
</ul>
<p>How to recover: Set parameter log_can to 1. Take a log and contact Navitec</p>
<h3 id="809-error_agv_controller-1"><a class="header" href="#809-error_agv_controller-1">809 ERROR_AGV_CONTROLLER</a></h3>
<p>Description: AGV controller alarm</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN or EhterCAT interface</p>
<p>Error reason: AGV controller reports error to Navitrol</p>
<p>How to recover: Check the error on AGV controller. Recovers automatically when the error is gone.</p>
<h3 id="810-error_rls_sensor"><a class="header" href="#810-error_rls_sensor">810 ERROR_RLS_SENSOR</a></h3>
<p>Description: RLS sensor failure</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with RLS sensor</p>
<p>Error reason: RLS sensor reports error</p>
<p>How to recover: Fix the sensor</p>
<h3 id="811-error_hitch_tongue_present_timeout"><a class="header" href="#811-error_hitch_tongue_present_timeout">811 ERROR_HITCH_TONGUE_PRESENT_TIMEOUT</a></h3>
<p>Description: Hitch tongue wasn't detected within time limit</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with hitch</p>
<p>Error reason: Tongue is not detected within time limit set by <strong>hitch_tongue_present_timeout_ms</strong></p>
<p>How to recover: Check the sensor and confirm that tongue is present.</p>
<h3 id="812-error_hitch_open_timeout"><a class="header" href="#812-error_hitch_open_timeout">812 ERROR_HITCH_OPEN_TIMEOUT</a></h3>
<p>Description: Hitch didn't open within time limit</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with hitch</p>
<p>Error reason: Hitch is closed for longer than
<strong>hitch_pin_open_close_max_time_ms</strong></p>
<p>How to recover: Check why the hitch does not open. Check the hitch closed sensor.</p>
<h3 id="813-error_hitch_close_timeout"><a class="header" href="#813-error_hitch_close_timeout">813 ERROR_HITCH_CLOSE_TIMEOUT</a></h3>
<p>Description: Hitch didn't close within time limit</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with hitch</p>
<p>Error reason: Hitch did not close within time limit set by <strong>hitch_pin_open_close_max_time_ms</strong></p>
<p>How to recover: Check why the hitch does not close. Also check why the sensor does not detect the pin.</p>
<h3 id="814-error_hitch_tongue_not_detected"><a class="header" href="#814-error_hitch_tongue_not_detected">814 ERROR_HITCH_TONGUE_NOT_DETECTED</a></h3>
<p>Description: Hitch tongue should be detected but is not</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with hitch</p>
<p>Error reason: Tongue is not detected even when it should</p>
<p>How to recover: Check the tongue sensor.</p>
<h3 id="815-error_hitch_pin_opened"><a class="header" href="#815-error_hitch_pin_opened">815 ERROR_HITCH_PIN_OPENED</a></h3>
<p>Description: Hitch pin opened even though it should stay closed</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with hitch</p>
<p>Error reason: Hitch is opened even when it should be closed</p>
<p>How to recover: Close the hitch. This error can be ignored with parameter hitch_ignore_pin_state_after_change</p>
<h3 id="816-error_hitch_pin_closed"><a class="header" href="#816-error_hitch_pin_closed">816 ERROR_HITCH_PIN_CLOSED</a></h3>
<p>Description: Hitch pin closed even though it should stay open</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with hitch</p>
<p>Error reason: Hitch is closed even when it should be opened</p>
<p>How to recover: Open the hitch. This error can be ignored with parameter hitch_ignore_pin_state_after_change</p>
<h3 id="817-error_hitch_already_closed"><a class="header" href="#817-error_hitch_already_closed">817 ERROR_HITCH_ALREADY_CLOSED</a></h3>
<p>Description: Hitch pin was already closed when trying to close it</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with hitch</p>
<p>Error reason: Error not used anymore</p>
<p>How to recover:</p>
<h3 id="818-error_can_config_sync"><a class="header" href="#818-error_can_config_sync">818 ERROR_CAN_CONFIG_SYNC</a></h3>
<p>Description: CAN error - no rx sync objects defined</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN interface</p>
<p>Error reason: System configuration error, no receive synchronization objects defined.</p>
<p>How to recover: Try setting parameter can_sync_rx_mode to value 0 and restart. If that does not help, then take a log (startlog.txt) and contact Navitec.</p>
<h3 id="819-error_plc"><a class="header" href="#819-error_plc">819 ERROR_PLC</a></h3>
<p>Description: PLC Error received</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="820-error_can_config_param"><a class="header" href="#820-error_can_config_param">820 ERROR_CAN_CONFIG_PARAM</a></h3>
<p>Description: CAN configuration parameter failure</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN interface</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="821-error_no_supervisor_comms"><a class="header" href="#821-error_no_supervisor_comms">821 ERROR_NO_SUPERVISOR_COMMS</a></h3>
<p>Description: No communication to Supervisor</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Ethernet control</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="822-error_ethernet_feedback_data_isnan"><a class="header" href="#822-error_ethernet_feedback_data_isnan">822 ERROR_ETHERNET_FEEDBACK_DATA_ISNAN</a></h3>
<p>Description: Vehicle control over Ethernet interface. Feedback data defined as float values are converted to nan or inf.</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Ethernet control</p>
<p>Error reason: Data is not correctly converted in the PLC.</p>
<p>How to recover: Reprogramming the conversion.</p>
<h3 id="823-error_ethernet_feedback_exceeding_limit"><a class="header" href="#823-error_ethernet_feedback_exceeding_limit">823 ERROR_ETHERNET_FEEDBACK_EXCEEDING_LIMIT</a></h3>
<p>Description: Vehicle control over Ethernet interface. Feedback data exceeds the speed or angle limits set in the parameters with more than 20%.</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Ethernet control</p>
<p>Error reason: The speed measurement is not correctly scaled or the vehicle drives faster than the reference.</p>
<p>How to recover: Rescale the measurement or limit the control in the vehicle.</p>
<h3 id="824-error_can_sdo_file"><a class="header" href="#824-error_can_sdo_file">824 ERROR_CAN_SDO_FILE</a></h3>
<p>Description: CAN SDO write configuration file sdo_write.txt failure.</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Ethernet control</p>
<p>Error reason: One/some of the configured SDO operations are not according to syntax or value is out of bounds (below minimum or above maximum value).</p>
<p>How to recover: Check the content of file sdo_write.txt. If you are unsure which line causes the problem, you can comment out lines by simply adding '#' in start of the line.</p>
<h3 id="825-error_imu_failure"><a class="header" href="#825-error_imu_failure">825 ERROR_IMU_FAILURE</a></h3>
<p>Description: IMU (Inertial Measurement Unit) error or no connection</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: No IMU data - IMU communication failed. Because IMU has been defined as the only source for heading changes (imu_dh_use).</p>
<p>How to recover: If value of parameter imu_dh_use is right, then check the IMU connection and related parameters (imu_type, imu_serial_port, imu_id).</p>
<h3 id="826-error_can_high_dt"><a class="header" href="#826-error_can_high_dt">826 ERROR_CAN_HIGH_DT</a></h3>
<p>Description: Vehicle interface to CAN update interval is too high.</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with CAN interface</p>
<p>Error reason: Navitrol internal sync issue or CPU overload.</p>
<p>How to recover: Take a log and contact Navitec.</p>
<h3 id="827-error_stopped_by_ultrasonic_sensors"><a class="header" href="#827-error_stopped_by_ultrasonic_sensors">827 ERROR_STOPPED_BY_ULTRASONIC_SENSORS</a></h3>
<p>Description: An error is displayed, if AGV is stopped, because of ultrasonic sensors are reporting that something is too close to the AGV.</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles using ultrasonic sensors, that are communicating with Navitrol</p>
<p>Error reason: AGV stopped by ultrasonic sensors</p>
<p>How to recover: If ultrasonic sensors are reporting false positive, they might need to be physically adjusted. Navitrol array parameters uss_sensor_zone1_dist_slow and uss_sensor_zone1_dist_fast decide, what is the maximum distance to trigger the slowdown. Ask Navitec for more details, if necessary.</p>
<h3 id="828-error_external_target_detection_sensor"><a class="header" href="#828-error_external_target_detection_sensor">828 ERROR_EXTERNAL_TARGET_DETECTION_SENSOR</a></h3>
<p>Description: An error is displayed, if AGV is stopped, because external target detection scanner is in error state</p>
<p>Error level: Error</p>
<p>Machine types: All vehicles using External target detection sensor, that are communicating with Navitrol with Supervisor interface</p>
<p>Error reason: External target detection sensor is sending an error to Navitrol</p>
<p>How to recover: Supervisor is sending the error message to Navitrol. Check what is wrong with the external target detection sensor or why Supervisor is sending this error message to Navitrol</p>
<h3 id="829-error_supervisor_feedback_invalid"><a class="header" href="#829-error_supervisor_feedback_invalid">829 ERROR_SUPERVISOR_FEEDBACK_INVALID</a></h3>
<p>Description: Vehicle control over Ethernet interface. Feedback data is invalid, reason being</p>
<ul>
<li>Message number sequencing fails</li>
<li>float values nan or inf</li>
</ul>
<p>Exact reason can be found from Navitrol log.</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Supervisor control</p>
<p>Error reason: Data is not correctly built and transmitted in the PLC.</p>
<p>How to recover: Reprogramming the message build or socket handling.</p>
<h3 id="830-error_gps_no_connection"><a class="header" href="#830-error_gps_no_connection">830 ERROR_GPS_NO_CONNECTION</a></h3>
<p>Description: There is no connection to the GPS receiver.</p>
<p>Error level: Error</p>
<p>Machine types: All</p>
<p>Error reason: No data is received from the receiver.</p>
<p>How to recover: Check the power supply of the receiver, check the connection cable. Check if the web interface of the receiver is accessible.</p>
<h3 id="832-error_ethernet_control_message_timeout"><a class="header" href="#832-error_ethernet_control_message_timeout">832 ERROR_ETHERNET_CONTROL_MESSAGE_TIMEOUT</a></h3>
<p>Description: Ethernet control message timeout, Navitrol does not receive the required control data in time.</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles with Ethernet control</p>
<p>Error reason: No ethernet control message has been received for 500 ms.</p>
<p>How to recover: Send control messages to Navitrol regularly with a message interval less than 500 ms.</p>
<h3 id="833-error_actuator_update_measurement_timeout"><a class="header" href="#833-error_actuator_update_measurement_timeout">833 ERROR_ACTUATOR_UPDATE_MEASUREMENT_TIMEOUT</a></h3>
<p>Description: Ethernet actuator control message timeout, Navitrol does not receive the required control data in time.</p>
<p>Error level: Error</p>
<p>Machine types: Vehicles where Navitrol controls the actuator and the control data is passed via message 1030 (protocol version 4).</p>
<p>Error reason: No actuator control message has been received for 2000 ms.</p>
<p>How to recover: Send actuator control data via message 1030 to Navitrol regularly with a message interval less than 2000 ms.</p>
<h3 id="835-error_ros_no_connection"><a class="header" href="#835-error_ros_no_connection">835 ERROR_ROS_NO_CONNECTION</a></h3>
<p>Description: Navitrol has lost/no connection with ROS by not receiving any messages from ROS for a short period of time.</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicle communicating with ROS.</p>
<p>Error reason: Navitrol has not received any messages from ROS for 500 ms. (Note: This is <strong>not dependent on</strong> whether there is any message traffic in ROS's internal network or not.)</p>
<p>How to recover:</p>
<ul>
<li>Check that ROS Docker container <code>ros_obstacle_avoidance</code> is running (by command <code>docker ps -a</code>)</li>
<li>More information: <a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></li>
</ul>
<p>Advanced information:</p>
<ul>
<li>The following ROS - Navitrol connection parameters are not required to be set. If they are set, they should be:
<ul>
<li><code>S, ros_ip, 0.0.0.0</code></li>
<li><code>I, ros_port_in, 13579</code></li>
<li><code>I, ros_port_out, 24680</code></li>
<li><code>S, nav_ipc_ip, 0.0.0.0</code></li>
</ul>
</li>
</ul>
<h3 id="836-error_obst_av_v2_no_path"><a class="header" href="#836-error_obst_av_v2_no_path">836 ERROR_OBST_AV_V2_NO_PATH</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></p>
<h3 id="837-error_obstacle_avoidance_v2_communication_timeout"><a class="header" href="#837-error_obstacle_avoidance_v2_communication_timeout">837 ERROR_OBSTACLE_AVOIDANCE_V2_COMMUNICATION_TIMEOUT</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></p>
<h3 id="839-error_abs_pos_no_meas_received"><a class="header" href="#839-error_abs_pos_no_meas_received">839 ERROR_ABS_POS_NO_MEAS_RECEIVED</a></h3>
<p>Description: Navitrol has not received any valid absolute positioning measurement in a time interval of parameter sf_abspos_max_time_since_valid_meas_ms_arr[].</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicle communicating with ROS.</p>
<p>Error reason: Navitrol has not received any valid absolute positioning measurement in a time interval of parameter sf_abspos_max_time_since_valid_meas_ms_arr[].</p>
<p>How to recover:</p>
<ul>
<li>Check that Navitec ROS Docker container is running (<code>docker ps -a</code>)</li>
<li>Check that GIM ROS Docker containers are running (<code>docker ps -a</code>)</li>
<li>Check the 'Absolute positioning' document for
<ul>
<li>Advanced troubleshooting</li>
<li>Required parameters for ROS and sensor fusion</li>
</ul>
</li>
</ul>
<h3 id="840-error_ethercat_no_comms-1"><a class="header" href="#840-error_ethercat_no_comms-1">840 ERROR_ETHERCAT_NO_COMMS</a></h3>
<p>Description: Navitrol has no connection to EtherCAT/EtherCAT slaves or no valid data has been received for 100 ms.</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicle communicating with EtherCAT.</p>
<p>Error reason: Navitrol has not been able to intialize/configure EtherCAT properly or slaves at run time are not working as expected.</p>
<p>How to recover:</p>
<ul>
<li>Check that EtherCAT parameters (ethercat_mode, ethercat_inte_primary, ethercat_inte_redundant) are defined correctly in Navitrol's params.txt</li>
<li>Check that EtherCAT is connected to defined interface(s)</li>
<li>Check that all EtherCAT HW and slaves are properly connected and powered</li>
</ul>
<h3 id="842-error_config_generic"><a class="header" href="#842-error_config_generic">842 ERROR_CONFIG_GENERIC</a></h3>
<p>Description: Generic error during configuration.</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicle.</p>
<p>Error reason: Configuration failed. Check the log for more details.</p>
<p>How to recover: Check the log for more details. Contact Navitec support.</p>
<h3 id="843-error_ethercat_config-1"><a class="header" href="#843-error_ethercat_config-1">843 ERROR_ETHERCAT_CONFIG</a></h3>
<p>Description: Error during Ethercat slave configuration.</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicle communicating with EtherCAT.</p>
<p>Error reason: Ethercat slave configuration failed. Check that Ethercat HW and slaves are properly connected and powered.</p>
<p>How to recover: Check the log for more details. Contact Navitec support.</p>
<h3 id="844-error_ethercat_high_dt-1"><a class="header" href="#844-error_ethercat_high_dt-1">844 ERROR_ETHERCAT_HIGH_DT</a></h3>
<p>Description: Update interval from vehicle interface to EtherCAT is too high.</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicle communicating with EtherCAT.</p>
<p>Error reason: Vehicle interface is not responding to EtherCAT.</p>
<p>How to recover: In most cases, this error is caused by some other Ethercat error or issue with initialization of AGV. Might be caused by CPU overload. Check the log or console for more details. Contact Navitec support.</p>
<h3 id="845-error_conflicting_feedback_sensor_type"><a class="header" href="#845-error_conflicting_feedback_sensor_type">845 ERROR_CONFLICTING_FEEDBACK_SENSOR_TYPE</a></h3>
<p>Description: Feedback sensor type defined by parameters conflicts with the one coming from the controller.</p>
<p>Error level: Fatal Error</p>
<p>Machine types: Any vehicle communicating with Roboteq motor controller via CAN bus.</p>
<p>Error reason: Wrong or missing script in Roboteq controller.</p>
<p>How to recover: Check that Roboteq script is latest available. If problem is not solved, take a log and contact Navitec.</p>
<h3 id="846-error_encoder_model_invalid"><a class="header" href="#846-error_encoder_model_invalid">846 ERROR_ENCODER_MODEL_INVALID</a></h3>
<p>Description: Encoder model is not valid</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicles.</p>
<p>Error reason: Encoder model is not properly defined in parameters or in the software.</p>
<p>How to recover: Check encoder model parameters. Contact Navitec support.</p>
<h3 id="847-error_ethercat_device_not_found-1"><a class="header" href="#847-error_ethercat_device_not_found-1">847 ERROR_ETHERCAT_DEVICE_NOT_FOUND</a></h3>
<p>Description: At least one EtherCAT slave device is not found on the bus</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicles.</p>
<p>Error reason: Some of the devices expected by Navitrol are missing from the bus.</p>
<p>How to recover: Check the log or terminal for more details. Check that all devices are powered and connected to the bus. Check Navitrol parameters. Contact Navitec support.</p>
<h3 id="848-error_encoder_config-1"><a class="header" href="#848-error_encoder_config-1">848 ERROR_ENCODER_CONFIG</a></h3>
<p>Description: Invalid encoder configuration. Check encoder parameters</p>
<p>Error level: Error</p>
<p>Machine types: Any vehicles.</p>
<p>Error reason: Some of the encoder parameter is not valid.</p>
<p>How to recover: Check the log or terminal for more details. Check Navitrol parameters. Contact Navitec support.</p>
<h3 id="849-error_no_profinet_comms"><a class="header" href="#849-error_no_profinet_comms">849 ERROR_NO_PROFINET_COMMS</a></h3>
<p>Description: No communication to Profinet Supervisor</p>
<p>Error level: Error</p>
<p>Machine types: AGVs that are controlled over Profinet interface</p>
<p>Error reason: Profinet interface has been enabled but the communication between Navitrol and (PLC) Supervisor is not operational.</p>
<p>How to recover:</p>
<ul>
<li>Check that Profinet Supervisor is running and trying to connect to Navitrol</li>
<li>Check that the ethernet cables are connected</li>
<li>Check port and IP address parameters with &quot;profinet_&quot;-prefix from params.txt</li>
<li>Reboot AGV</li>
</ul>
<h3 id="850-error_profinet_config"><a class="header" href="#850-error_profinet_config">850 ERROR_PROFINET_CONFIG</a></h3>
<p>Description: Profinet slave configuration failure.</p>
<p>Error level: Fatal Error</p>
<p>Machine types: Any</p>
<p>Error reason: Profinet interface has not been configured correctly.</p>
<p>How to recover: Check Navitrol parameters with &quot;profinet_&quot;-prefix and restart Navitrol. If the problem remains take a log an contact Navitec support.</p>
<h3 id="853-error_3d_positioning_map_mismatch"><a class="header" href="#853-error_3d_positioning_map_mismatch">853 ERROR_3D_POSITIONING_MAP_MISMATCH</a></h3>
<p>Description: There is a map mismatch between Navitrol's map and the 3d positioning map.</p>
<p>Error level: Error</p>
<p>Machine types: Any</p>
<p>Error reason: A 3d positioning map corresponding to the unique id from the environment file could not be found.</p>
<p>How to recover: Upload the correct 3d positioning map.</p>
<h3 id="854-error_3d_position_not_initialized"><a class="header" href="#854-error_3d_position_not_initialized">854 ERROR_3D_POSITION_NOT_INITIALIZED</a></h3>
<p>Description: 3D position has not been initialized.</p>
<p>Error level: Error</p>
<p>Machine types: Any</p>
<p>Error reason: A valid 3D position has not been yet found (due to a bad or missing pose input).</p>
<p>How to recover: Give an initial pose input e.g. from Navitrol Monitor. If error <a href="Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html#835-error_ros_no_connection">ROS_NO_CONNECTION</a> is active, resolve that error first.</p>
<h3 id="855-error_3d_positioning"><a class="header" href="#855-error_3d_positioning">855 ERROR_3D_POSITIONING</a></h3>
<p>Description: The 3D positioning software is having an active error. Automatic driving is disabled.</p>
<p>Error level: Error</p>
<p>Machine types: Any</p>
<p>Error reason: The 3D positioning software is having an active error.</p>
<p>How to recover: A device error will occur, providing a more detailed error explanation. If the issue persists, take a log and contact Navitec.</p>
<h3 id="858-error_simove_nav_no_comms"><a class="header" href="#858-error_simove_nav_no_comms">858 ERROR_SIMOVE_NAV_NO_COMMS</a></h3>
<p>Description: No communication to SIMOVE navigation interface.</p>
<p>Error level: Error</p>
<p>Machine types: Machines using SIMOVE interface</p>
<p>Error reason: No data has been received from SIMOVE navigation interface within a time limit.</p>
<p>How to recover: Verify that SIMOVE connection parameters are correct (ip, port). Restart Navitrol after modifying connection parameters.</p>
<h3 id="859-error_simove_ctrl_no_comms"><a class="header" href="#859-error_simove_ctrl_no_comms">859 ERROR_SIMOVE_CTRL_NO_COMMS</a></h3>
<p>Description: No communication to SIMOVE controller interface.</p>
<p>Error level: Error</p>
<p>Machine types: Machines using SIMOVE interface</p>
<p>Error reason: No data has been received from SIMOVE controller interface within a time limit.</p>
<p>How to recover: Verify that SIMOVE connection parameters are correct (ip, port). Restart Navitrol after modifying connection parameters.</p>
<h4 id="860-error_external_target_detection_no_detection"><a class="header" href="#860-error_external_target_detection_no_detection">860 ERROR_EXTERNAL_TARGET_DETECTION_NO_DETECTION</a></h4>
<p>Description: External target detection didn't detect target within specified time.</p>
<p>Error Level: Fatal error</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol didn't receive target detected message from external target detection within <strong>ext_target_det_response_timeout_ms</strong> time. This error is used only in event based mode where Navitrol expects only one response after it has requested the detection.</p>
<p>How to recover: The external target detection device has to be checked why it didn't response within time. If it is just too slow, this <strong>ext_target_det_response_timeout_ms</strong> parameter can be increased. Acknowledge when fatal error can be cleared.</p>
<h3 id="861-error_simove_action_failed"><a class="header" href="#861-error_simove_action_failed">861 ERROR_SIMOVE_ACTION_FAILED</a></h3>
<p>Description: Action failure reported by SIMOVE controller</p>
<p>Error level: Fatal error</p>
<p>Machine types: Machines using SIMOVE interface</p>
<p>Error reason: Action has finished in FAILED state and can't recover automatically</p>
<p>How to recover: Find the reason for the failed action and verify that AGV is in safe state to continue. Fatal errors must be acknowledged by the user.</p>
<h2 id="hardwaremachine-specific-warnings"><a class="header" href="#hardwaremachine-specific-warnings">Hardware/Machine Specific Warnings</a></h2>
<h3 id="901-warning_lift_ctrl_enc_file_fail"><a class="header" href="#901-warning_lift_ctrl_enc_file_fail">901 WARNING_LIFT_CTRL_ENC_FILE_FAIL</a></h3>
<p>Description: Lift height encoder configuration file parsing failed</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: enc_data.txt file cound not be read in</p>
<p>How to recover: Check that the file exist and is valid</p>
<h3 id="902-warning_lift_ctrl_cfg_failed"><a class="header" href="#902-warning_lift_ctrl_cfg_failed">902 WARNING_LIFT_CTRL_CFG_FAILED</a></h3>
<p>Description: Lift motor controller configuration failure</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: Could not configure the lift controller</p>
<p>How to recover: Take a log and contact Navitec</p>
<h3 id="903-warning_lift_ctrl_calib_failed"><a class="header" href="#903-warning_lift_ctrl_calib_failed">903 WARNING_LIFT_CTRL_CALIB_FAILED</a></h3>
<p>Description: Lift height measurement calibration failure</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: Could not calibrate the lift controller</p>
<p>How to recover: Try to calibrate again. If it fails take a log and contact Navitec.</p>
<h3 id="904-warning_lift_ctrl_move_timeout"><a class="header" href="#904-warning_lift_ctrl_move_timeout">904 WARNING_LIFT_CTRL_MOVE_TIMEOUT</a></h3>
<p>Description: Lift movement timeout</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: Lift did not reach the target in time</p>
<p>How to recover: Take a log and contact Navitec</p>
<h3 id="905-warning_lift_ctrl_calib_notdone"><a class="header" href="#905-warning_lift_ctrl_calib_notdone">905 WARNING_LIFT_CTRL_CALIB_NOTDONE</a></h3>
<p>Description: Lift height measurement not calibrated</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: Lift is not calibrated</p>
<p>How to recover: Calibrate the lift. If there are problems take a log and contact Navitec</p>
<h3 id="906-warning_lift_ctrl_disabled"><a class="header" href="#906-warning_lift_ctrl_disabled">906 WARNING_LIFT_CTRL_DISABLED</a></h3>
<p>Description: Lift height control disabled</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with lift</p>
<p>Error reason: Error not used anymore</p>
<p>How to recover:</p>
<h3 id="907-warning_ui_not_connected"><a class="header" href="#907-warning_ui_not_connected">907 WARNING_UI_NOT_CONNECTED</a></h3>
<p>Description: No connection to UI</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with touch screen user interface from Navitec</p>
<p>Error reason: UI software may not be started</p>
<p>How to recover: Take a log and contact Navitec</p>
<h3 id="908-warning_plc_safety_scanner_stop"><a class="header" href="#908-warning_plc_safety_scanner_stop">908 WARNING_PLC_SAFETY_SCANNER_STOP</a></h3>
<p>Description: Safety scanner stop on PLC</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with PLC checking the safety scanners</p>
<p>Error reason: PLC reports safety stop</p>
<p>How to recover: Remove the obstacles from the scanner view either by moving them or vehicle</p>
<h3 id="909-warning_plc_soft_stop"><a class="header" href="#909-warning_plc_soft_stop">909 WARNING_PLC_SOFT_STOP</a></h3>
<p>Description: Soft stop activated on PLC</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with PLC</p>
<p>Error reason: PLC reports soft stop</p>
<p>How to recover: Check the soft stop reason from PLC</p>
<h3 id="910-warning_plc_slow_down"><a class="header" href="#910-warning_plc_slow_down">910 WARNING_PLC_SLOW_DOWN</a></h3>
<p>Description: PLC slowing down due to obstacle</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with PLC</p>
<p>Error reason: PLC reports slow down</p>
<p>How to recover: Recovers automatically when obstacle is not visible anymore</p>
<h3 id="911-warning_dead_reck_high_rate"><a class="header" href="#911-warning_dead_reck_high_rate">911 WARNING_DEAD_RECK_HIGH_RATE</a></h3>
<p>Description: excessive movement rate detected</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with PLC</p>
<p>Error reason: PLC reports too fast movement</p>
<p>How to recover: Take a log and contact Navitec</p>
<h3 id="912-warning_eth_manual_mode"><a class="header" href="#912-warning_eth_manual_mode">912 WARNING_ETH_MANUAL_MODE</a></h3>
<p>Description: AGV on manual mode</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with Ethernet interface</p>
<p>Error reason: AGV controller reports that vehicle is in manual mode</p>
<p>How to recover: Switch to automatic mode</p>
<h3 id="913-warning_agv_em_stop"><a class="header" href="#913-warning_agv_em_stop">913 WARNING_AGV_EM_STOP</a></h3>
<p>Description: Emergency stop on AGV</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: AGV is in emergency stop</p>
<p>How to recover: Release emergency stop on AGV</p>
<h3 id="914-warning_agv_controller"><a class="header" href="#914-warning_agv_controller">914 WARNING_AGV_CONTROLLER</a></h3>
<p>Description: AGV controller warning</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: AGV controller reports warning</p>
<p>How to recover: Check the controller for the reason</p>
<h3 id="915-warning_dyn_map_server_not_connected"><a class="header" href="#915-warning_dyn_map_server_not_connected">915 WARNING_DYN_MAP_SERVER_NOT_CONNECTED</a></h3>
<p>Description: No connection to dynamic mapping server</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Navitrol cannot connect to dynamic mapping server</p>
<p>How to recover: Check that dynamic map server is running. Take a log and contact Navitec.</p>
<h3 id="916-warning_dyn_map_server_map_mismatch"><a class="header" href="#916-warning_dyn_map_server_map_mismatch">916 WARNING_DYN_MAP_SERVER_MAP_MISMATCH</a></h3>
<p>Description: Dynamic mapping server map doesn't match Navitrol map</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Dynamic mapping server noticed that Navitrol map is not matching the version on dynamic mapping</p>
<p>How to recover: Recovers automatically</p>
<h3 id="917-warning_dyn_map_server_storage_error"><a class="header" href="#917-warning_dyn_map_server_storage_error">917 WARNING_DYN_MAP_SERVER_STORAGE_ERROR</a></h3>
<p>Description: Dynamic mapping server storage read/write error</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Dynamic mapping server reported error</p>
<p>How to recover: Contact Navitec</p>
<h3 id="918-warning_rls_sensor"><a class="header" href="#918-warning_rls_sensor">918 WARNING_RLS_SENSOR</a></h3>
<p>Description: RLS sensor warning</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with RLS sensor</p>
<p>Error reason: RLS sensor reports warning</p>
<p>How to recover: Fix the sensor</p>
<h3 id="919-warning_no_supervisor_coms"><a class="header" href="#919-warning_no_supervisor_coms">919 WARNING_NO_SUPERVISOR_COMS</a></h3>
<p>Description: No communication to Supervisor</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: No communication to supervisor</p>
<p>How to recover: Make sure that supervisor is connected to Navitrol, Take a log and contact Navitec</p>
<h3 id="920-warning_ui_parsing_error"><a class="header" href="#920-warning_ui_parsing_error">920 WARNING_UI_PARSING_ERROR</a></h3>
<p>Description: UI data parsing failed</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: UI does not match with Navitrol</p>
<p>How to recover: Take a log and contact Navitec</p>
<h3 id="921-warning_ext_battery"><a class="header" href="#921-warning_ext_battery">921 WARNING_EXT_BATTERY</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../Miscellaneous/Charging/Charging-en.html">Charge and Battery management</a>.</p>
<h3 id="922-warning_plc"><a class="header" href="#922-warning_plc">922 WARNING_PLC</a></h3>
<p>Description: PLC Warning received</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason:</p>
<p>How to recover:</p>
<h3 id="923-warning_can2_failure"><a class="header" href="#923-warning_can2_failure">923 WARNING_CAN2_FAILURE</a></h3>
<p>Description: CAN secondary bus, hw or driver error</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Error reasons and things to check are identical to those described in case of error <a href="Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html#709-error_can_failure">709 ERROR_CAN_FAILURE</a></p>
<p>How to recover:</p>
<h3 id="924-warning_imu_failure"><a class="header" href="#924-warning_imu_failure">924 WARNING_IMU_FAILURE</a></h3>
<p>Description: IMU (Inertial Measurement Unit) error or no connection</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Wrong parameters, connection lost, IMU HW error</p>
<p>How to recover: Check the IMU connection and related parameters (imu_type, imu_serial_port, imu_id).</p>
<h3 id="925-warning_no_supervisor_sec_coms"><a class="header" href="#925-warning_no_supervisor_sec_coms">925 WARNING_NO_SUPERVISOR_SEC_COMS</a></h3>
<p>Description: Secondary supervisor is not connected and cannot communicate with Navitrol.</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: No communication to supervisor</p>
<p>How to recover: Make sure that supervisor is connected to Navitrol, that the ip and the port are correct and the parameters are set correctly. If not possible to resolve, Take a log and contact Navitec</p>
<h3 id="926-warning_fstop_fleet_control"><a class="header" href="#926-warning_fstop_fleet_control">926 WARNING_FSTOP_FLEET_CONTROL</a></h3>
<p>Description: AGV stopped by Fleet control</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason:</p>
<p>How to recover: Release FSTOP from Fleet control</p>
<h3 id="927-warning_drive_motor_control_limit"><a class="header" href="#927-warning_drive_motor_control_limit">927 WARNING_DRIVE_MOTOR_CONTROL_LIMIT</a></h3>
<p>Description: Motor controller operation - acceleration/deceleration/speed is limited</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles</p>
<p>Error reason: Motor controller specific</p>
<p>How to recover: Motor controller specific -- if you don't know what is the reason behind, take a log and contact Navitec.</p>
<h3 id="928-warning_ethernet_feedback_exceeding_limit"><a class="header" href="#928-warning_ethernet_feedback_exceeding_limit">928 WARNING_ETHERNET_FEEDBACK_EXCEEDING_LIMIT</a></h3>
<p>Description: A warning is displayed if speed or angle feedback values exceed limits with 5-20% in the Ethernet control interface. In auto mode 20% causes an error, but in manual mode any value is a warning.</p>
<p>Error level: Warning</p>
<p>Machine types: Ethernet controlled vehicles</p>
<p>Error reason: In auto mode, the speed/angle sensor calibration or control action should be checked. In manual mode some values may be intentionally exceed on the users' responsibility.</p>
<p>How to recover: verify calibrations and whether the limits may be safely exceeded. Limit control.</p>
<h3 id="929-warning_slowed_down_ultrasonic_sensors"><a class="header" href="#929-warning_slowed_down_ultrasonic_sensors">929 WARNING_SLOWED_DOWN_ULTRASONIC_SENSORS</a></h3>
<p>Description: A warning is displayed, if AGV is slowing down, because of ultrasonic sensors are reporting that something is too close to the AGV.</p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles using ultrasonic sensors, that are communicating with Navitrol</p>
<p>Error reason: Slow down triggered by ultrasonic sensors</p>
<p>How to recover: If ultrasonic sensors are reporting false positive, they might need to be physically adjusted. Navitrol array parameters uss_sensor_zone3_dist_slow and uss_sensor_zone3_dist_fast decide, what is the maximum distance to trigger the slowdown. Ask Navitec for more details, if necessary.</p>
<h3 id="931-warning_omni_steer_limit_adjusting_wheels"><a class="header" href="#931-warning_omni_steer_limit_adjusting_wheels">931 WARNING_OMNI_STEER_LIMIT_ADJUSTING_WHEELS</a></h3>
<p>Description: A warning is displayed, when omni steer limit feature is enabled and at least one of the omni wheels has reached the defined steer limit. The AGV will perform soft stop and rotate the wheel until it is in the middle area of the defined angle range. When the adjusting is done the warning will be removed automatically.</p>
<p>Error level: Warning</p>
<p>Machine types: Those omni drives where Navitrol have control over every limited omni wheel.</p>
<p>Error reason: Defined omni steer limit reached.</p>
<p>How to recover: Navitrol will automatically reset the error when the wheel adjustment is ready. If the warning stays on and the Navitrol is not controlling the wheels anymore please take a log and contact Navitec.</p>
<h3 id="932-warning_limited_steering_active"><a class="header" href="#932-warning_limited_steering_active">932 WARNING_LIMITED_STEERING_ACTIVE</a></h3>
<p>Description: The warning is displayed, when steer limit feature is enabled and at least one of the limited wheels has reached the defined steer limit.</p>
<p>Error level: Warning</p>
<p>Machine types: Steer and omni drives with defined steering limits</p>
<p>Error reason: Defined steer limit reached.</p>
<p>How to recover: The warning is automatically reset when the references are back within the limits. This can be done for example giving straight drive order.</p>
<h3 id="933-warning_conflicting_motor_controller_types"><a class="header" href="#933-warning_conflicting_motor_controller_types">933 WARNING_CONFLICTING_MOTOR_CONTROLLER_TYPES</a></h3>
<p>Description: Feedback sensor type defined by parameter conflicts with the one coming from the controller.</p>
<p>Error level: Warning</p>
<p>Machine types: Any vehicle communicating with Roboteq motor controller via CAN bus.</p>
<p>Error reason: Wrong or missing script in Roboteq controller. Note: Prior to Navitrol 6.44 this warning can be unavoidable if several Roboteq controllers with different feedback sensor types are used.</p>
<p>How to recover: Check that Roboteq script is latest available. Check that sensor type parameter roboteq_angle_sensor_type has right value. In Navitrol 6.44 or later, parameter array roboteq_angle_sensor_type_arr is available if multiple controllers with different feedback sensor types are used. If problem is not solved, take a log and contact Navitec.</p>
<h3 id="934-warning_no_gps_fix"><a class="header" href="#934-warning_no_gps_fix">934 WARNING_NO_GPS_FIX</a></h3>
<p>Description: The long since the last GPS fix, driving without it.</p>
<p>Error level: Warning</p>
<p>Machine types: All</p>
<p>Error reason: GPS receiver is not providing data that is &quot;RTK fixed&quot;.</p>
<p>How to recover: Check that the antennas have a clear view of the sky, there is no interference such as metal objects nearby. Make sure that the base station is connected properly. Check that auxiliary antenna is also receiving good signal quality.</p>
<h3 id="935-warning_can_encoder"><a class="header" href="#935-warning_can_encoder">935 WARNING_CAN_ENCODER</a></h3>
<p>Description: This warning is displayed when CAN encoder has some issues with initialization by Navigation SW.</p>
<p>Error level: Warning</p>
<p>Machine types: Can vehicles</p>
<p>Error reason: There are some problems either with encoder parameters or with the CAN bus.</p>
<p>How to recover: Check the CAN bus, contact Navitec.</p>
<h3 id="937-warning_obst_av_v2_path_rejected_due_frame_heading"><a class="header" href="#937-warning_obst_av_v2_path_rejected_due_frame_heading">937 WARNING_OBST_AV_V2_PATH_REJECTED_DUE_FRAME_HEADING</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></p>
<h3 id="938-warning_unable_to_bypass_obstacle"><a class="header" href="#938-warning_unable_to_bypass_obstacle">938 WARNING_UNABLE_TO_BYPASS_OBSTACLE</a></h3>
<p>See feature documentation for <a href="Miscellaneous/ErrorDescriptions/../../DriveControl/ObstacleAvoidanceV2/ObstacleAvoidanceV2-en.html">Obstacle avoidance V2</a></p>
<h3 id="941-warning_code_reader_no_comms"><a class="header" href="#941-warning_code_reader_no_comms">941 WARNING_CODE_READER_NO_COMMS</a></h3>
<p>Description: Optical code reader communication is not working</p>
<p>Error level: Warning</p>
<p>Machine types: All</p>
<p>Error reason: There are problems with code reader communication parameters, IPC Ethernet settings or connection to the code reader.</p>
<p>How to recover: Check the connections, IPC and reader IP settings and related Navigation SW parameters.</p>
<h3 id="942-warning_code_reader_status_not_ok"><a class="header" href="#942-warning_code_reader_status_not_ok">942 WARNING_CODE_READER_STATUS_NOT_OK</a></h3>
<p>Description: Optical code reader reports an issue.</p>
<p>Error level: Warning</p>
<p>Machine types: All</p>
<p>Error reason: There are some problems with code reader.</p>
<p>How to recover: Refer to device specific documentation or contact Navitec support.</p>
<h3 id="943-warning_no_profinet_comms"><a class="header" href="#943-warning_no_profinet_comms">943 WARNING_NO_PROFINET_COMMS</a></h3>
<p>Description: No communication to Profinet Supervisor.
Error level: Warning
Machine types: All
Error reason &amp; How to recover: See <a href="Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html#850-error_profinet_config">850 ERROR_PROFINET_CONFIG</a></p>
<h3 id="944-warning_test_version"><a class="header" href="#944-warning_test_version">944 WARNING_TEST_VERSION</a></h3>
<p>Description: Test version in use. NOT FOR USE IN PRODUCTION.
Error level: Warning
Machine types: All
Error reason: Test version in use (Navitrol .99 version installed)
How to recover: Install a non-test version and restart Navitrol</p>
<h3 id="945-warning_initializing_3d_position"><a class="header" href="#945-warning_initializing_3d_position">945 WARNING_INITIALIZING_3D_POSITION</a></h3>
<p>Description: 3D position initialization is currently in progress.</p>
<p>Error level: Warning</p>
<p>Machine types: Any</p>
<p>Error reason: 3D position system tries actively to find a valid 3D pose for the AGV.</p>
<p>How to recover: If the 3D position initialization process appears to take too long (over 15 seconds), try setting initial pose again. Error <a href="Miscellaneous/ErrorDescriptions/ErrorDescriptions-en.html#854-error_3d_position_not_initialized">ERROR_3D_POSITION_NOT_INITIALIZED</a> is always active along this warning.</p>
<h3 id="946-warning_3d_positioning"><a class="header" href="#946-warning_3d_positioning">946 WARNING_3D_POSITIONING</a></h3>
<p>Description: The 3D positioning software is having an active warning.</p>
<p>Error level: Warning</p>
<p>Machine types: Any</p>
<p>Error reason: The 3D positioning software is having an active warning.</p>
<p>How to recover: A device error will occur, providing a more detailed error explanation. If the issue persists, take a log and contact Navitec.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-guide-logging"><a class="header" href="#user-guide-logging">User Guide Logging</a></h1>
<p>Updated 18.07.2024</p>
<hr />
<h2 id="glossary-18"><a class="header" href="#glossary-18">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>Navitrol</td><td>Linux program for navigation and positioning of an AGV</td></tr>
<tr><td>Navitrol Monitor</td><td>Windows program for observing and controlling a single Navitrol</td></tr>
<tr><td>Navithor Server</td><td>Windows program for automatically controlling a fleet of AGVs</td></tr>
<tr><td>Navithor Client</td><td>Windows program to observe and command a fleet of AGVs</td></tr>
<tr><td>Text log</td><td>A log file ending with &quot;.txt&quot;, these can be read by humans</td></tr>
<tr><td>Binary log</td><td>A log file ending with &quot;.gz&quot;. These can be opened in Navitrol Monitor for visual playback</td></tr>
<tr><td>&quot;The log folder&quot;</td><td>Folder on the IPC running Navitrol where the logs are stored. By default: &quot;/home/navitec/logs&quot;</td></tr>
<tr><td>Supervisor interface</td><td>Ethernet communication interface between Navitrol and supervisor -- typically a PLC.</td></tr>
</tbody></table>
<hr />
<h2 id="overview-41"><a class="header" href="#overview-41">Overview</a></h2>
<h3 id="what-is-a-log"><a class="header" href="#what-is-a-log">What is a log?</a></h3>
<p>A Navitrol log is a file containing the history of most important data processed by Navitrol.</p>
<p>The purpose of a log is to store data so that possible issues can be easily located and solved.</p>
<p>Typically, logs are taken by the user when a problem is detected and sent to Navitec for further inspection to locate and solve the problem.
However, advanced users can utilize the logs by themselves to solve simple problems.</p>
<h3 id="what-data-a-log-contains"><a class="header" href="#what-data-a-log-contains">What data a log contains?</a></h3>
<p>With default settings a log contains around one minute's worth of history data -- the oldest data is constantly overwritten.</p>
<p>Logged data can be adjusted with Navitrol parameters, see section <code>How to adjust logging -- parameters</code></p>
<p><strong>Examples of data logged by Navitrol:</strong></p>
<ul>
<li>
<p>Position of the AGV</p>
</li>
<li>
<p>Inputs from and outputs to connected devices and software, such as</p>
<ul>
<li>
<p>Scanners</p>
</li>
<li>
<p>Motor controllers and encoders</p>
</li>
<li>
<p>Supervisor / PLC</p>
</li>
<li>
<p>Fleet control</p>
</li>
</ul>
</li>
<li>
<p>The state of Navitrol and its threads</p>
</li>
<li>
<p>Errors and warnings</p>
</li>
</ul>
<h3 id="where-are-the-logs-stored"><a class="header" href="#where-are-the-logs-stored">Where are the logs stored?</a></h3>
<p>By default, the logs are stored into &quot;/home/navitec/logs&quot;-folder of the IPC that is running Navitrol.</p>
<p>File system of the IPC can be accessed from Windows with programs, such as Samba or WinSCP, see section How to retrieve a log from the IPC.</p>
<p>The logs can also be downloaded when taking them using Navitrol Monitor or Navithor Client.</p>
<h2 id="log-types"><a class="header" href="#log-types">Log types</a></h2>
<p>An overview to log types is given in this section. For instructions on how to a take log, see section.</p>
<p>There are two main log types: text logs and binary logs.</p>
<h3 id="text-logs"><a class="header" href="#text-logs">Text logs</a></h3>
<p>There are three different types of text logs:</p>
<ul>
<li>
<p>Basic Log</p>
</li>
<li>
<p>Start Log</p>
</li>
</ul>
<h4 id="basic-log---logtxt"><a class="header" href="#basic-log---logtxt">Basic log - log.txt</a></h4>
<p>A text log contains the basic runtime data as described in section <code>What data a log contains?</code>.</p>
<p>It is used in problem solving to see minor details about inner functions of Navitrol.</p>
<p>The data is readable by humans -- written in English.</p>
<p>The text log file names end with &quot;.txt&quot; and can be opened with any text editor, such as notepad++.</p>
<p>&quot;log.txt&quot; is included in most binary log packages excluding <a href="Miscellaneous/Logging/Logging-en.html#continuous--long-visual-log----log_cont">Continuous</a> and <a href="Miscellaneous/Logging/Logging-en.html#monitors-visual-log----log_monitor">Monitor's</a> visual logs. Optionally it can be taken separately using Linux console commands.</p>
<h4 id="start-log----startlogtxt"><a class="header" href="#start-log----startlogtxt">Start log -- startlog.txt</a></h4>
<p>A start log contains the same data as the <code>basic log</code> but is saved automatically to the log folder on the IPC after 5 seconds of Navitrol start.</p>
<p>A start log can be used to identify start up issues, such as invalid parameters in parameter file, and to see initialization data.</p>
<p>It is always named &quot;startlog.txt&quot; and previous start log will be overwritten when the program is started again.</p>
<h3 id="long-log----longlogtxt"><a class="header" href="#long-log----longlogtxt">Long log -- longlog.txt</a></h3>
<p>A text log containing only data logged as high priority, such as position of an AGV and active errors. The log covers a longer period of time compared to the <code>basic log</code> but is much less detailed.</p>
<p>A long log can be used to see issues over long period of time. However, in most cases it does not contain enough details to solve those issues.
Long logs are named &quot;longlogXX.txt&quot; where XX is running number: 01, 02.....</p>
<h3 id="binary-logs"><a class="header" href="#binary-logs">Binary logs</a></h3>
<p>Navitrol binary logs contain data that go through the positioning and navigation, including laser scanner measurements and the environment (also known as map).</p>
<p>They can be used to see an overview of problematic situation, such as an area with low position confidence.</p>
<p>Binary logs are in binary format which means that they can be opened with Navitrol Monitor for a log playback by dragging and dropping a zipped file into Monitor window.</p>
<p>Zipped binary log file names end with &quot;.gz&quot;.</p>
<p><strong>Naming</strong></p>
<ul>
<li>
<p>Log name explained</p>
<ul>
<li>
<p><code>log_&lt;type&gt;&lt;number/index&gt;_&lt;year.month.day&gt;_&lt;hour.minute.second&gt;_&lt;AGV position x coordinate&gt;_&lt;AGV position y coordinate&gt;_&lt;Navitrol version&gt;.gz</code></p>
</li>
<li>
<p>Note that <strong>AGV position coordinates</strong> are only added when they are available.</p>
</li>
</ul>
</li>
<li>
<p>Examples</p>
<ul>
<li>
<p>log_remote_mon0091_2020.10.15_13.36.36_1.0_6.0_6.29.45.gz</p>
</li>
<li>
<p>log_con0075_2020.10.13_09.14.55_6.29.43.gz</p>
</li>
<li>
<p>log_cont_2020.10.21_10.51.22_192.168.56.101_-2,9_6,0.gz</p>
</li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> Binary logs are zipped packages that contain <code>basic log</code> and <code>start log</code> text logs. The text logs can be extracted by unzipping the &quot;.gz&quot;-file twice.</p>
<h3 id="monitor-log----log_remote_mon"><a class="header" href="#monitor-log----log_remote_mon">Monitor log -- log_remote_mon</a></h3>
<p>A binary log taken using Navitrol Monitor.</p>
<p>Example:</p>
<p>log_remote_mon0091_2020.10.15_13.36.36_1.0_6.0_6.29.45.gz</p>
<h3 id="console-log----log_conlog_cons"><a class="header" href="#console-log----log_conlog_cons">Console log -- log_con/log_cons</a></h3>
<p>A binary log taken using Linux console commands.</p>
<p>Example:</p>
<p>log_con0075_2020.10.13_09.14.55_6.29.43.gz (Navitrol version &lt; 6.34)</p>
<p>log_cons0075_2020.10.13_09.14.55_6.29.43.gz (Navitrol versions 6.34 and later)</p>
<h3 id="external-log---log_ext"><a class="header" href="#external-log---log_ext">External log - log_ext</a></h3>
<p>A binary log taken using external command, such as Supervisor interface</p>
<p>To adjust see the related <a href="Miscellaneous/Logging/Logging-en.html#misc">parameters</a>.</p>
<p>Example:</p>
<p>log_ext0001_2020.10.15_17.36.02_1.0_6.0_6.29.45.gz</p>
<h3 id="error-log----log_err"><a class="header" href="#error-log----log_err">Error log -- log_err</a></h3>
<p>A binary log is taken automatically when an error is activated.</p>
<p>By default, only <strong>predefined errors</strong> are logged automatically.
However, automatic logging for other <strong>general errors</strong> can be enabled with parameters.</p>
<p>Error logs are stored to separate error log folders under the log folder.</p>
<p>To adjust see the related <a href="Miscellaneous/Logging/Logging-en.html#error-log">parameters</a>.</p>
<p>Example:</p>
<p>log_err_401_ERROR_VEH_INTE_HIGH_DT_1143_2020.10.15_11.56.29_-2.7_6.0_6.29.45.gz</p>
<h3 id="continuous--long-visual-log----log_cont"><a class="header" href="#continuous--long-visual-log----log_cont">Continuous / Long visual log -- log_cont</a></h3>
<p>Continuous logs can be taken with Navitrol Monitor and depending on the selection they are saved either to Navitrol PC or to PC running the Navitrol Monitor application (see section <a href="Miscellaneous/Logging/Logging-en.html#advanced-navitrol-monitor-logging">Advanced Monitor logging</a>).</p>
<p>Continuous logging to PC running Navitrol Monitor must be separately started from &quot;Save and download logs&quot;-window of Navitrol Monitor.</p>
<p>These logs can be activated to capture problems that happen rarely, and user cannot react in time to take a regular log that includes the incident.</p>
<p>To adjust logs saved to Navitrol PC, see the related <a href="Miscellaneous/Logging/Logging-en.html#continuous-log-long-visual">parameters</a>.</p>
<p><strong>Note:</strong> does not include text logs.</p>
<p>Example:</p>
<p>log_cont_2020.10.21_10.51.22_192.168.56.101_-2,9_6,0.gz</p>
<h3 id="monitors-visual-log----log_monitor"><a class="header" href="#monitors-visual-log----log_monitor">Monitor's visual log -- log_monitor</a></h3>
<p>This log can be saved with Navitrol Monitor and contains the currently saved binary log data in Navitrol Monitor's memory that can be played back (see more in section <a href="Miscellaneous/Logging/Logging-en.html#advanced-navitrol-monitor-logging">Advanced Monitor logging</a>).</p>
<p>Hence, this log can be saved even if the connection to the AGV is lost.</p>
<p><strong>Note:</strong> does not include text logs.</p>
<p>Example:</p>
<p>log_monitor0001_2023.10.20_15.05.08.47_6.49.02.gz</p>
<h3 id="thread-monitor-log----log_mon"><a class="header" href="#thread-monitor-log----log_mon">Thread monitor log -- log_mon</a></h3>
<p>A binary log taken in case of an automatic restart.</p>
<p>Thread monitor is a part of Navitrol that restarts Navitrol in case of an unexpected shutdown.</p>
<p>To adjust see the related <a href="Miscellaneous/Logging/Logging-en.html#thread-monitor-log">parameters</a>.</p>
<p>Example:</p>
<p>log_mon0037_2020.05.14_12.39.47_0.0_0.0_6.27.25.gz</p>
<h3 id="fstop-log----log_fstop"><a class="header" href="#fstop-log----log_fstop">FSTOP log -- log_fstop</a></h3>
<p>A binary log automatically taken in case of state change triggered to FSTOP for any reason.</p>
<p>This feature can be enabled with the parameter log_dump_on_fstop_max_files (max number of logs stored; defaults to 0).</p>
<p>Example:</p>
<p>log_fstop0007_2020.05.14_12.39.47_0.0_0.0_6.27.25.gz</p>
<h3 id="fstop-on-estop-log----log_estop"><a class="header" href="#fstop-on-estop-log----log_estop">FSTOP on ESTOP log -- log_estop</a></h3>
<p>A binary log automatically taken in case of state change triggered to FSTOP on ESTOP.</p>
<p>This feature can be enabled with the parameter log_dump_on_estop_max_files (max number of logs stored; defaults to 0). If FSTOP logging using parameter log_dump_on_fstop_max_files is enabled then this log is not stored.</p>
<p>Also parameter pc_fstop_on_estop should be set (defaults to 1).</p>
<p>Example:</p>
<p>log_estop0007_2020.05.14_12.39.47_0.0_0.0_6.27.25.gz</p>
<h3 id="other-2"><a class="header" href="#other-2">Other</a></h3>
<h4 id="navigation-log----navigationlogtxt"><a class="header" href="#navigation-log----navigationlogtxt">Navigation log -- navigationlog.txt</a></h4>
<p>A separate text log named &quot;navigationlog.txt&quot; containing only times and
related positions.</p>
<p>Compatible only with &quot;positioning only&quot;-AGVs. (Navitrol does not control
the AGV).</p>
<p>Can be enabled with the parameter <code>log_to_navigationlog</code> <a href="Miscellaneous/Logging/Logging-en.html#misc">Misc parameters</a>.</p>
<h4 id="battery-log----battery_logtxt"><a class="header" href="#battery-log----battery_logtxt">Battery log -- battery_log.txt</a></h4>
<p>A separate text log named &quot;battery_log.txt&quot; containing only battery
related information.</p>
<p>It can be enabled and adjusted with <a href="Miscellaneous/Logging/Logging-en.html#battery-log">parameters</a>.</p>
<h4 id="core-dump----core"><a class="header" href="#core-dump----core">Core dump -- core</a></h4>
<p>A separate log named &quot;core&quot; that can be included in the zipped <code>Thread monitor log</code>. If you encounter this log type, please forward it to the Navitec support.</p>
<h2 id="how-to-take-a-log"><a class="header" href="#how-to-take-a-log">How to take a log</a></h2>
<h3 id="navitrol-monitor"><a class="header" href="#navitrol-monitor">Navitrol Monitor</a></h3>
<h4 id="step-by-step-instructions"><a class="header" href="#step-by-step-instructions">Step by step instructions</a></h4>
<ol>
<li>Start Navitrol Monitor by running NavitrolMonitor.exe</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/image3.png" alt="" /></p>
<ol start="2">
<li>
<p>Log in by entering the password (default: ntnavitec)</p>
</li>
<li>
<p>Connect to Navitrol running on the AGV</p>
</li>
</ol>
<ul>
<li>Select an AGV and IP from the dropdown list in top left corner.
<ul>
<li>If the dropdown list is empty. Click &quot;Edit&quot;-button next to it and add new machine name and IP-address.</li>
</ul>
</li>
<li>Click &quot;Connect&quot;-button</li>
</ul>
<ol start="4">
<li>Click &quot;Save Logs&quot;-button to open &quot;Save and download logs&quot;-window.</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/MonitorSaveLogsButton.png" alt="" /></p>
<ol start="5">
<li>Take a log by pressing &quot;Save Log&quot; button.</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/SaveLogButtonInForm.PNG" alt="" /></p>
<ol start="6">
<li>Wait for the &quot;Download Log Files&quot; view and &quot;Last saved: &quot; text to be updated.</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/SaveLogFinished.PNG" alt="" /></p>
<p><strong>The log is now saved to the IPC and it can be downloaded using the &quot;Download&quot; button.</strong></p>
<h4 id="advanced-navitrol-monitor-logging"><a class="header" href="#advanced-navitrol-monitor-logging">Advanced Navitrol Monitor logging</a></h4>
<p>For advanced options click the &quot;Advanced&quot; field.<br />
<img src="Miscellaneous/Logging/./media-en/AdvancedLogs.PNG" alt="" /></p>
<p>This expands the view of the form for additional logging options.<br />
<img src="Miscellaneous/Logging/./media-en/AdvancedLogFormWithNumbers.png" alt="" /></p>
<ol>
<li><strong>Additional logs</strong>
<ul>
<li>Tick the checkbox for saving long visual logs (only binary) in Navitrol PC. When taking the logs with &quot;Save log&quot; button, <em>log_cont*.gz</em> logs (one or more) will be saved along with the regular <em>log_remote_mon*.gz</em> log. This can be useful when the log could not be saved immediately after the incident.</li>
<li>Tick the checkbox for saving Monitor's visual logs (only binary) in the PC running the Navitrol Monitor application. Click the &quot;Browse..&quot; button before saving the log with the &quot;Save log&quot; button to determine the location to store the <em>log_monitor*.gz</em> log. This log can be saved even if the connection to the AGV is already lost.</li>
</ul>
</li>
<li><strong>Continuous logs</strong>
<ul>
<li>Tick the checkbox for saving continuosly long visual logs (only binary) to a folder the user can define clicking the &quot;Browse..&quot; button. This can be useful when the issue happens rarely. Remember to untick the checkbox before trying to playback the <em>log_cont*.gz</em> logs. Note also that Navitrol Monitor needs to be all the time connected to the AGV for saving the logs continuously.</li>
</ul>
</li>
<li><strong>SSH Credentials</strong>
<ul>
<li>Click the &quot;SSH Credentials..&quot; button to determine the username and password for Navitrol PC connection. The credentials are needed for downloading / deleting the logs from the Navitrol PC. </li>
</ul>
</li>
</ol>
<h3 id="linux-console"><a class="header" href="#linux-console">Linux console</a></h3>
<p><strong>Instructions:</strong></p>
<ol>
<li>
<p>Open Linux console on the AGV running Navitrol
-Usually done using PuTTY connection
- Default user: &quot;root&quot; and password: &quot;navitrol&quot;</p>
<ul>
<li>Another option is to directly connect a screen and keyboard to the IPC</li>
</ul>
</li>
<li>
<p>Select log type to dump</p>
</li>
</ol>
<ul>
<li><em>Binary log</em>
<ul>
<li>Log command: <strong>./Navitrol dump</strong></li>
</ul>
</li>
<li><em>Text log</em>
<ul>
<li>Log command: <strong>./Navitrol dumpf</strong></li>
</ul>
</li>
</ul>
<ol start="3">
<li>
<p>Type the log command of selected log type and press enter</p>
<ul>
<li>See previous step for available commands.</li>
<li>Example:
<img src="Miscellaneous/Logging/./media-en/image7.png" alt="" /></li>
</ul>
</li>
<li>
<p>Wait for the line telling that logging is finished.
<img src="Miscellaneous/Logging/./media-en/image8.png" alt="" /></p>
</li>
</ol>
<p><strong>The log is now saved to the IPC and can be downloaded using the &quot;Download&quot; button</strong></p>
<p><strong>Advanced console logging:</strong></p>
<p>It is possible to filter the data written to the log file and filter and print log lines to the console while Navitrol is running. For further instructions, see section <code>Advanced logging</code>.</p>
<h3 id="supervisor-interface-1"><a class="header" href="#supervisor-interface-1">Supervisor interface</a></h3>
<p>If supervisor interface is used, <code>external-log---log_ext</code> can be taken by sending message 1007. See &quot;<strong>Ethernet Communication specification between Navitrol and AGV supervisor_v4.docx</strong>&quot;-doument for details.</p>
<h3 id="navithor-client"><a class="header" href="#navithor-client">Navithor client</a></h3>
<p>When taking a log with Navitrol client it is possible to include binary logs (<code>monitor-log-log_remote_mon</code>) from individual AGVs. Further instructions can be found from Navithor documents.</p>
<p><strong>Basic steps:</strong></p>
<ol>
<li>
<p>Open Navithor client</p>
</li>
<li>
<p>Click &quot;Save logs&quot;-button on lower left corner to open &quot;Log saver&quot;-window.</p>
</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/image9.png" alt="" /></p>
<ol start="3">
<li>Select the AGV (or AGVs) from upper left section. (Navitrol logs are included only for selected AGVs)</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/image10.png" alt="" /></p>
<ol start="4">
<li>
<p>Click &quot;Save the log files&quot;-button in the bottom of the window.</p>
</li>
<li>
<p>Wait for pop-up window informing that saving the log was successful.
<strong>The log is now saved to the Windows system into the folder shown in the pop up window.</strong></p>
</li>
</ol>
<p><strong>Note:</strong> By default, the log is saved to the Navithor Server's folder, but the pop-up window gives an option to download the files to the computer running Navithor client. See document &quot;<strong>Navithor System - overview and Client user instructions</strong> &quot; for further details.</p>
<h3 id="automatic-logging"><a class="header" href="#automatic-logging">Automatic logging</a></h3>
<table><thead><tr><th>Log type</th><th>More information</th></tr></thead><tbody>
<tr><td>Start log</td><td>See <code>Start log -- startlog.txt</code></td></tr>
<tr><td>Error log</td><td>See <code>Error log -- log_err</code></td></tr>
<tr><td>FSTOP</td><td>See <code>FSTOP log -- log_fstop</code></td></tr>
<tr><td>FSTOP on ESTOP</td><td>See <code>FSTOP on ESTOP log -- log_estop</code></td></tr>
<tr><td>Thread monitor log</td><td>See <code>Thread monitor log -- log_mon</code></td></tr>
<tr><td>Core dump</td><td>See <code>Core dump -- core</code></td></tr>
</tbody></table>
<h2 id="how-to-retrieve-a-log-from-the-ipc"><a class="header" href="#how-to-retrieve-a-log-from-the-ipc">How to retrieve a log from the IPC</a></h2>
<p>The log files can be retrieved from the IPC running Navitrol in multiple different ways. This section describes the most common ones.</p>
<h3 id="winscp"><a class="header" href="#winscp">WinSCP</a></h3>
<ol>
<li>Open WinSCP</li>
<li>Connect to the AGV</li>
<li>Navigate to the log folder</li>
<li>Copy or move the files where wanted</li>
</ol>
<h3 id="navitrol-monitor-1"><a class="header" href="#navitrol-monitor-1">Navitrol Monitor</a></h3>
<ol>
<li>
<p>Open the &quot;Save and download logs&quot;-window from the Navitrol Monitor clicking &quot;Save Logs&quot; button.</p>
</li>
<li>
<p>Click the &quot;Refresh&quot;-button located in lower left corner.</p>
</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/RefreshLogs.PNG" alt="" /></p>
<ol start="3">
<li>Select the logs you want to download and click the &quot;Download&quot;-button</li>
</ol>
<p><img src="Miscellaneous/Logging/./media-en/DownloadLog.PNG" alt="" /></p>
<ol start="4">
<li>Select the file location by following the instructions of the opened pop-up window.</li>
</ol>
<h3 id="file-explorer--samba"><a class="header" href="#file-explorer--samba">File explorer / samba</a></h3>
<ol>
<li>Open Windows file explorer</li>
<li>Type the AGVs IP to the top bar: <em><strong>&lt;IP&gt;</strong></em>/home/Navitec</li>
<li>Copy or move the files where wanted</li>
</ol>
<p><strong>Note:</strong> Some Windows settings and versions may prevent remote access using this method.</p>
<h2 id="how-to-read-a-log"><a class="header" href="#how-to-read-a-log">How to read a log</a></h2>
<h3 id="reading-a-text-log"><a class="header" href="#reading-a-text-log">Reading a text log</a></h3>
<p>A text log can be opened with text editors, such as notepad++.</p>
<p><strong>What you can do with a text log:</strong></p>
<ol>
<li>See the main operations and diagnostics of the AGV over a longer period of time (compared to binary logs)</li>
<li>See XY coordinates and heading value</li>
<li>See Received and performed drive orders</li>
<li>See errors and warnings that are active or have been set / reset</li>
<li>Analyze and troubleshoot low level information, such as:</li>
</ol>
<ul>
<li>Received and sent data values between Navitrol and other systems or sensors</li>
<li>Communication intervals</li>
<li>Values and information from active Navitrol features and functions</li>
</ul>
<p><strong>Structure of the text log -- Start of the file:</strong></p>
<p><img src="Miscellaneous/Logging/./media-en/image13.png" alt="" /></p>
<ol>
<li>When the log was taken
<ul>
<li>Date and time</li>
</ul>
</li>
<li>Navitrol build information
<ul>
<li>Navitrol version</li>
<li>Build time</li>
<li>Machine type</li>
</ul>
</li>
<li>Kernel version</li>
<li>Enabled license options</li>
<li>Parameters from the params.txt
<ul>
<li>Data type, name, value # comment</li>
</ul>
</li>
<li>Parameters from the memory (not in the image)
<ul>
<li>Located just after &quot;Parameters from the params.txt&quot;-section</li>
</ul>
</li>
</ol>
<p><strong>Structure of the text log -- A log line:</strong></p>
<p><img src="Miscellaneous/Logging/./media-en/image14.png" alt="" /></p>
<ol>
<li>&quot;Time&quot;
<ul>
<li>Counted from the start of Navitrol</li>
</ul>
</li>
<li>&quot;Thread : level&quot;
<ul>
<li>Thread
<ul>
<li>From which thread the log line is coming from</li>
<li>See <code>List of log threads</code></li>
</ul>
</li>
<li>Level
<ul>
<li>Priority of the information</li>
<li>The smaller the number the higher the priority</li>
</ul>
</li>
</ul>
</li>
<li>&quot;Logged data&quot;
<ul>
<li>Typically starts with a description and ends with a list of values</li>
</ul>
</li>
</ol>
<h3 id="binary-log-playback-1"><a class="header" href="#binary-log-playback-1">Binary log playback</a></h3>
<p>Binary logs can be played back using Navitrol Monitor.</p>
<p><strong>Note:</strong> Versions of Navitrol and Navitrol Monitor must match.</p>
<p><strong>How to start playback:</strong></p>
<ol>
<li>Start Navitrol Monitor</li>
<li>Make sure that you are not connected to any AGV
<ul>
<li>To disconnect from an AGV press &quot;Disconnect&quot; button located next to &quot;Save Logs&quot; button.</li>
</ul>
</li>
<li>Open a zipped binary log file
<ul>
<li>Option 1 - Drag and drop the file to the map section of Monitor window
<ul>
<li>&quot;The map section&quot; is the grid with coordinates on the sides</li>
</ul>
</li>
<li>Option 2 - Select file to open
<ul>
<li>Open &quot;File&quot;-menu from top left corner.</li>
<li>Select &quot;Open log&quot;-option</li>
<li>Follow the pop-ups</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>What can you do with playback:</strong></p>
<ol>
<li>Review localization performance
<ul>
<li>Graphs and visualization of scanner measurements, environment points and reflectors</li>
<li>Ability to match scanner measurements to the environment points and reflectors</li>
<li>Amount of performed correction</li>
</ul>
</li>
<li>Review driving performance
<ul>
<li>Graphs and visualization of the position and heading of the AGV</li>
<li>Measured position and heading compared to the route and the stopping points</li>
<li>Measured speed values compared to the target values</li>
</ul>
</li>
<li>Review the quality of the environment
<ul>
<li>Position confidence graph values</li>
<li>Amount of visible environment points</li>
</ul>
</li>
</ol>
<p><strong>How to use:</strong></p>
<ol>
<li>
<p>Charts and data can be viewed as if an AGV was connected</p>
</li>
<li>
<p>Log time can be scrolled by</p>
<ul>
<li>Dragging the blue slider in the bottom middle</li>
<li>Or with arrow keys</li>
</ul>
<p><img src="Miscellaneous/Logging/./media-en/BlueSlider.png" alt="" /></p>
</li>
<li>
<p>A time interval can be pinpointed by</p>
<ul>
<li>Dragging the ends of the time slider</li>
</ul>
<p><img src="Miscellaneous/Logging/./media-en/image16.png" alt="" /></p>
</li>
</ol>
<p><strong>Helpful information that can be seen with the log playback:</strong></p>
<ol>
<li>How well the scanner measurements match the environment</li>
<li>Position confidence</li>
<li>Warnings and errors</li>
<li>Graphs of given references and received measurements</li>
</ol>
<p><strong>Tip:</strong> If Navitrol Monitor has been connected to an AGV and then disconnected, the last moments can be played back as it were a binary log.</p>
<h2 id="how-to-adjust-logging---parameters"><a class="header" href="#how-to-adjust-logging---parameters">How to adjust logging - Parameters</a></h2>
<p>Logging can be adjusted with Navitrol parameters by modifying <code>params.txt</code> file and reloading the parameters. Most of these parameters are optional, which means that if they are not defined in the <code>params.txt</code> their default values are used. From Navitrol version 6.30.00 forward all logging parameters have default value of 0 and are all optional.</p>
<p><strong>Note:</strong> Most of these parameters affect only the text logging as data of binary logging cannot be adjusted by the user.</p>
<p><strong>Note:</strong> When changing parameters, check if the parameter is already defined before adding one. If a parameter is defined twice, the Navitrol gets parse error and will not work.</p>
<h3 id="file-handling"><a class="header" href="#file-handling">File handling</a></h3>
<p>This section lists parameters that define log sizes and how many logs of  certain type can be stored.</p>
<h4 id="general-4"><a class="header" href="#general-4">General</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_vehicle_stopped_speed</td><td>Float</td><td>0.05</td><td>Stops continuous logging and increases startinfo update interval when AGV's speed is less than the given value (m/s)<br><code>Startinfo.bin</code> is a binary file storing data from previous Navitrol run. It is used for example when initializing the AGV to last know coordinates.</td></tr>
<tr><td>min_free_disk_space_mb</td><td>Int</td><td>1000</td><td>Minimum available disk space required when dumping log files or writing teach data (Mb)</td></tr>
<tr><td>logging_rate_warning_limit</td><td>Int</td><td>800000</td><td>Amount of characters per second for high logging rate warning to be triggered</td></tr>
<tr><td>log_trigger_pass_to_supervisor</td><td>Int</td><td>0</td><td>If set to 1, when Navitrol receives a log trigger from fleet control or monitor the trigger is redirected to Supervisor interface (message 4100) and Navitrol will not take a log.</td></tr>
</tbody></table>
<h4 id="binary-log-length"><a class="header" href="#binary-log-length">Binary log length</a></h4>
<p>These parameters can be used to increase or decrease the size of the binary logs. The log_loc_log_size alone determines the length of visual playback. However, if there is less position control data than localization data (timewise) only localization data will be visualized in the beginning of the log.</p>
<p><strong>Note:</strong> For visual playback, a binary log must always have localization data, but position control data is optional.</p>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_loc_log_size</td><td>Int</td><td>30</td><td>Size of localization binary log buffer (Mb)<br>Affects the amount of localization data, such as scanner measurements and odometry, in log_dynamic.ntl file inside the zipped binary log.<br>About 7 seconds per Mb</td></tr>
<tr><td>log_pos_cont_log_size</td><td>Int</td><td>30</td><td>Size of position controller binary log buffer (Mb)<br>Affects the amount of position control data, such as wheel references, in log_poscont.ntl file inside the zipped binary log.</td></tr>
<tr><td>dyn_map_pt_min_weight_logged</td><td>Float</td><td>0.05</td><td>Limit amount of dynamic points written to log. SSet minimum map weigh for point to be included in the log.Recommended 0.0 - 0.2<br>For systems with dynamic mapping this parameter limits amount of logged dynamic mapping data greatly increasing the length of the log.</td></tr>
</tbody></table>
<h4 id="error-log"><a class="header" href="#error-log">Error log</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_err_txt_log_dump_size</td><td>Int</td><td>10</td><td>Size of text log to dump on error (Mb)</td></tr>
<tr><td>log_dump_on_error_cooldown_secs</td><td>Int</td><td>15</td><td>Minimum cooldown before taking new automatic error log (in seconds)</td></tr>
<tr><td>log_dump_on_error_max_files</td><td>Int</td><td>20</td><td>Maximum number of error log files to keep on disk -- from <strong>predefined</strong> errors.<br>Default changed 50 -&gt;20 starting from Navitrol version 6.34</td></tr>
<tr><td>log_dump_on_any_error_max_files</td><td>Int</td><td>0</td><td>Maximum number of error log files to keep on disk -- from <strong>general</strong> errors.</td></tr>
<tr><td>log_dump_on_specific_errors_only_arr[]</td><td>Int</td><td>0</td><td>Can be used to define any specific errors/warnings to trigger automatic logs. Any valid error/warning number can be used. If defined, automatic log taking is not triggered by any other error/warning.</td></tr>
</tbody></table>
<h4 id="thread-monitor-log"><a class="header" href="#thread-monitor-log">Thread monitor log</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_dump_thrmon_txt_log_size</td><td>Int</td><td>10</td><td>Size of text log to dump on thread monitoring error (Mb)</td></tr>
<tr><td>log_dump_thrmon_max_files</td><td>Int</td><td>20</td><td>Maximum number of thread monitoring log files to keep on disk.</td></tr>
</tbody></table>
<h4 id="continuous-log-long-visual"><a class="header" href="#continuous-log-long-visual">Continuous log (long visual)</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_cont_log_chunk_size</td><td>Int</td><td>30</td><td>Size of continuous log chunk (Mb)</td></tr>
<tr><td>log_cont_log_chunks</td><td>Int</td><td>10</td><td>Number of continuous log chunks</td></tr>
<tr><td>log_cont_log_when_moving_only</td><td>Int</td><td>1</td><td>Record continuous log data only when moving. Enabled = 1, Disabled = 0</td></tr>
<tr><td>log_cont_log_stopped_timer</td><td>Int</td><td>5</td><td>Time to keep logging after stopping in seconds</td></tr>
</tbody></table>
<h4 id="battery-log"><a class="header" href="#battery-log">Battery log</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>battery_log_mode</td><td>Int</td><td>0</td><td>0 = disabled,<br>1 = voltage and driveWheelV,<br>2 = percentage and driveWheelV,<br>3 = percentage, wheelV, current, state of health and status<br><br>Note: creates separate text log file: battery_log.txt</td></tr>
<tr><td>log_battery_file_size_mb</td><td>Int</td><td>20</td><td>Maximum battery log file size</td></tr>
<tr><td>log_battery_update_interval_ms</td><td>Int</td><td>50</td><td>Interval in milliseconds for writing a new line to battery log</td></tr>
</tbody></table>
<h4 id="misc"><a class="header" href="#misc">Misc</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>log_dump_external_max_files</td><td>Int</td><td>10</td><td>Maximum number of log files from external trigger to keep on disk.<br>Supervisor logging uses this parameter.</td></tr>
<tr><td>log_to_navigationlog</td><td>Int</td><td>0</td><td>Log position to separate navigation log text file: navigationlog.txt</td></tr>
<tr><td>log_dump_vdma_max_files</td><td>Int</td><td>20</td><td>Maximum number of log files triggered by VDMA to keep on disk.</td></tr>
<tr><td>log_dump_thrmon_max_files</td><td>Int</td><td>20</td><td>Maximum number of log files triggered by thread monitoring to keep on disk.</td></tr>
<tr><td>log_dump_remote_mon_max_files</td><td>Int</td><td>20</td><td>Maximum number of log files triggered from Monitor/Fleet control to keep on disk.</td></tr>
<tr><td>log_dump_on_fstop_max_files</td><td>Int</td><td>0</td><td>Maximum number of log files triggered by any FSTOP to keep on disk.</td></tr>
<tr><td>log_dump_on_estop_max_files</td><td>Int</td><td>0</td><td>Maximum number of log files triggered by FSTOP on ESTOP to keep on disk.</td></tr>
<tr><td>log_sys_resoures_interval_s</td><td>Int</td><td>10</td><td>Time interval [s] to log resources of the operating system: 0 = disable. This can be helpful if there is reason to suspect that the IPC is running out of resources. The related lines can be found from the log by searching &quot;systeminfo:&quot;</td></tr>
</tbody></table>
<h3 id="amount-of-logging"><a class="header" href="#amount-of-logging">Amount of logging</a></h3>
<p>Amount of logging to text files can be adjusted with parameters. Each logging parameter adjusts the logging of a single Navitrol feature.</p>
<p><strong>Effects of high and low logging rates explained:</strong></p>
<table><thead><tr><th>Attribute</th><th>Low</th><th>High</th><th>Comment</th></tr></thead><tbody>
<tr><td>Time period saved</td><td>Long</td><td>Short</td><td>The longer period of time the log covers, the easier it is to catch information about an issue into it, because the user has more time to take the log.<br>In worst cases the logs are filled in less than 5 seconds making it almost impossible to capture an error.</td></tr>
<tr><td>Amount of details</td><td>Low</td><td>High</td><td>The higher the amount of logged details, the easier it is to solve an issue.<br>Solving some issues might be impossible to solve with minimal logging.<br>Very high logging rates can also cause data to be lost because of hardware limits.</td></tr>
</tbody></table>
<p>As a rule of thumb, the amount of logging should be kept low unless there is reason to suspect problems with a certain feature. For example, supervisor logging should be increased when taking new messages to use and decreased when they are tested and working.</p>
<p>With logging parameters value 0 means that logging is disabled. Values above that increase the amount of logging step by step until the parameter specific max value is reached.</p>
<p>From Navitrol version 6.30.00 forward, all logging parameters are optional, and they are disabled by default.</p>
<p>All logging parameters of integer type can be set in params.txt followingly:</p>
<p>I,<em><strong>parameter_name</strong></em>, <em><strong>value</strong></em></p>
<p>Example: <code>I,log_veh_inte_eth, 1</code></p>
<p>While logging parameters of unsinged integer type should start with <code>U</code>:</p>
<p>Example: <code>U, log_ext_target_det, 1</code></p>
<p><strong>Note:</strong> If some feature is not used, changing its logging level will not have any effect.</p>
<h4 id="connected-devices"><a class="header" href="#connected-devices">Connected devices</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Max level</th><th>Description</th></tr></thead><tbody>
<tr><td>log_scanner</td><td>Int</td><td>5</td><td>Log scanner data details.</td></tr>
<tr><td>log_sensors</td><td>Int</td><td>1</td><td>Log sensor data</td></tr>
<tr><td>log_bms</td><td>Int</td><td>1</td><td>Log external battery management system communication.</td></tr>
<tr><td>log_motor_controllers</td><td>Int</td><td>2</td><td>Log motor controller details</td></tr>
<tr><td>log_imu</td><td>Int</td><td>2</td><td>Log IMU details:<br>1 - parsed data<br>2 - raw data</td></tr>
<tr><td>log_gps</td><td>Int</td><td>3</td><td>Log GPS localization details: <br> 0 = disable,<br> 1 = log outputs, <br> 2 = log antenna points, <br> 3 = log messages.</td></tr>
<tr><td>log_pointcloud_interface</td><td>Int</td><td>2</td><td>Log pointcloud interface: <br> 0 = No, <br> 1 = Basic, <br> 2 = Detailed</td></tr>
<tr><td>log_actuators</td><td>Int</td><td>1</td><td>Log actuator control details: 0 = general, 1 = detailed.</td></tr>
</tbody></table>
<h4 id="control-interfaces"><a class="header" href="#control-interfaces">Control interfaces</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Max level</th><th>Description</th></tr></thead><tbody>
<tr><td>log_veh_inte_eth</td><td>Int</td><td>4</td><td>Log ethernet supervisor messages:<br>1 - message info<br>4 - all bytes</td></tr>
<tr><td>log_can</td><td>Int</td><td>1</td><td>Log primary CAN details, including all messages byte by byte</td></tr>
<tr><td>log_can2</td><td>Int</td><td>1</td><td>Log secondary CAN details, including all messages byte by byte</td></tr>
<tr><td>log_can_msgs</td><td>Int</td><td>1</td><td>Log parsed and built can messages.</td></tr>
<tr><td>log_can_summary</td><td>Int</td><td>1</td><td>Log CAN msg summary<br>0 - on ERR condition only<br>1 -- periodically</td></tr>
<tr><td>log_keyb_ctrl_io</td><td>Int</td><td>1</td><td>Log keyboard controls from Navitrol Monitor</td></tr>
<tr><td>log_modbus</td><td>Int</td><td>1</td><td>Log parsed and built modbus message data</td></tr>
<tr><td>log_ethercat</td><td>Int</td><td>3</td><td>Log EtherCAT communication details.</td></tr>
<tr><td>log_profinet</td><td>Int</td><td>2</td><td>Log profinet interface details: <br> 0 = general,  <br> 1 = detailed,  <br> 2 = log binary data.</td></tr>
</tbody></table>
<h4 id="position-control-2"><a class="header" href="#position-control-2">Position control</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Max level</th><th>Description</th></tr></thead><tbody>
<tr><td>log_speed_limit</td><td>Int</td><td>1</td><td>Enable detailed logging for active speed limitations</td></tr>
<tr><td>log_segparsing</td><td>Int</td><td>1</td><td>Log segment parsing details</td></tr>
<tr><td>log_get_traj</td><td>Int</td><td>3</td><td>Log trajectory generation</td></tr>
<tr><td>log_omni_control</td><td>Int</td><td>3</td><td>Log omni control details.<br>1 - log drive time<br>2 - route filtering<br>3 - speed limits</td></tr>
<tr><td>log_rtr_generation</td><td>Int</td><td>1</td><td>Enables logging of return to route generation.</td></tr>
</tbody></table>
<h4 id="localization-1"><a class="header" href="#localization-1">Localization</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Max level</th><th>Description</th></tr></thead><tbody>
<tr><td>log_correlation</td><td>Int</td><td>5</td><td>Log various correlation calculations used for localisation.</td></tr>
<tr><td>log_positioning</td><td>Int</td><td>5</td><td>Log various calculations related to poses and positioning</td></tr>
<tr><td>log_deadrec</td><td>Int</td><td>5</td><td>Log dead reckoning calculations.</td></tr>
<tr><td>log_reflector_pos</td><td>Int</td><td>5</td><td>Log the reflector positions.<br>Warning: high levels can cause very high logging rate.</td></tr>
<tr><td>log_thrd_localize</td><td>Int</td><td>1</td><td>Log state and events of localize thread</td></tr>
<tr><td>log_ext_loc</td><td>Int</td><td>3</td><td>Log external localization: <br>0 = disable, <br> 1 = enable, <br> values 2...3 for more detailed logging with some sensors.</td></tr>
</tbody></table>
<h4 id="target-detection-1"><a class="header" href="#target-detection-1">Target detection</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Max level</th><th>Description</th></tr></thead><tbody>
<tr><td>log_pallet_detection</td><td>Int</td><td>1</td><td>Log pallet detection calculation details</td></tr>
<tr><td>log_pattern_detection</td><td>Int</td><td>1</td><td>Log pattern detection details<br>Note: very detailed and should be enabled only when testing.</td></tr>
<tr><td>log_ext_target_det</td><td>Uint</td><td>1</td><td>Log external target detection data</td></tr>
<tr><td>log_table_detection</td><td>Int</td><td>1</td><td>Log table detection details: 0 = general, 1 = detailed.</td></tr>
<tr><td>log_target_detection</td><td>Int</td><td>1</td><td>Log target detection calculation details: 0 = general, 1 = detailed.</td></tr>
</tbody></table>
<h4 id="misc-features"><a class="header" href="#misc-features">Misc features</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Max level</th><th>Description</th></tr></thead><tbody>
<tr><td>log_pos_ini_refl</td><td>Int</td><td>1</td><td>Log reflector-based position initialisation</td></tr>
<tr><td>log_racking</td><td>Int</td><td>1</td><td>Log warehouse racking details</td></tr>
<tr><td>log_driving_with_stop_pts</td><td>Int</td><td>1</td><td>Log driving with stop points details.</td></tr>
<tr><td>log_ext_fleet_control</td><td>Int</td><td>2</td><td>Log external fleet control</td></tr>
<tr><td>log_sensor_fusion</td><td>Int</td><td>3</td><td>Detailed logging for sensor fusion<br>1 - location estimates<br>2 - location and velocity<br>3 - max</td></tr>
<tr><td>log_trailer_transport</td><td>Int</td><td>1</td><td>Enables logging of trailer transport details.</td></tr>
<tr><td>log_coupled_drive</td><td>Int</td><td>2</td><td>Log coupled drive control details.</td></tr>
<tr><td>log_obst_detection</td><td>Int</td><td>3</td><td>Log obstacle detection: <br> 0 = none, <br> 1 = result line counts, <br> 2 = detailed logging, <br> 3 = log all lines.</td></tr>
<tr><td>log_ros</td><td>Int</td><td>2</td><td>Log ros specific details: <br> 0 = disable, <br> 1 = enable, <br> 2 = log detailed path information</td></tr>
</tbody></table>
<h4 id="misc-internal"><a class="header" href="#misc-internal">Misc internal</a></h4>
<table><thead><tr><th>Parameter name</th><th>Type</th><th>Max level</th><th>Description</th></tr></thead><tbody>
<tr><td>log_events</td><td>Int</td><td>1</td><td>Log all internal events between different Navitrol threads.</td></tr>
<tr><td>log_timer_thread</td><td>Int</td><td>1</td><td>Log internal timers.</td></tr>
</tbody></table>
<h2 id="trouble-shooting"><a class="header" href="#trouble-shooting">Trouble shooting</a></h2>
<h3 id="warning_high_logging_rate"><a class="header" href="#warning_high_logging_rate">WARNING_HIGH_LOGGING_RATE</a></h3>
<p>WARNING_HIGH_LOGGING_RATE is a warning activated when logging rate of the text.log exceeds characters per second rate defined by the parameter <code>logging_rate_warning_limit</code>.</p>
<p>Too high logging rate can cause logged data to be lost or corrupted. It might also decrease the overall performance of the Navitrol.</p>
<p>It is recommended to fix this warning by <code>how-to-adjust-logging---parameters</code>.</p>
<p>Other option is to increase the value of the parameter. However, this approach only hides the problem instead of solving it.</p>
<h3 id="navitrol-monitor-gives-an-error-when-opening-binary-log"><a class="header" href="#navitrol-monitor-gives-an-error-when-opening-binary-log">Navitrol Monitor gives an error when opening binary log</a></h3>
<p>Make sure that the Monitor version matches the version of the Navitrol which was running when the log was taken.</p>
<p><img src="Miscellaneous/Logging/./media-en/MonitorDLLVersion.PNG" alt="" /></p>
<p><img src="Miscellaneous/Logging/./media-en/LogFileNavitrolVersion.PNG" alt="" /></p>
<h3 id="navitrol-monitor-does-not-accept-a-log-file"><a class="header" href="#navitrol-monitor-does-not-accept-a-log-file">Navitrol Monitor does not accept a log file</a></h3>
<p>Make sure that the file type is &quot;.gz&quot; in lower case. For example, &quot;LOG_BIN.GZ&quot; will not open but &quot;LOG_BIN.gz&quot; will.</p>
<h3 id="other-problems"><a class="header" href="#other-problems">Other problems</a></h3>
<p>If you are facing a logging related problem and you cannot find an answer from this document, please contact Navitec support.</p>
<h2 id="advanced"><a class="header" href="#advanced">Advanced</a></h2>
<h3 id="filtered-console-logging"><a class="header" href="#filtered-console-logging">Filtered console logging</a></h3>
<p>It is possible to use filtered text logging with Linux console commands.
The list of commands that can be used in order to write specific log messages to files and/or view them in real time are presented below. Amount of log lines and the threads of interest can be specified manually.</p>
<p>If [n] is 0 when using <em>dumps</em> or <em>dumpl</em>, log lines are displayed in real time as they are output by '.'.</p>
<p><strong>Note:</strong> All available Navitrol console commands can be seen with <em><strong>./Navitrol help</strong></em> -- Linux console command.</p>
<h4 id="to-the-console-screen"><a class="header" href="#to-the-console-screen">To the console screen</a></h4>
<p>Dumping filtered data to console screen in `real time` can be helpful when running tests as often user is interested only in certain log lines and seeing them from the console screen is faster than taking a log and opening it separately.</p>
<p><strong>Related commands:</strong></p>
<p><strong>'./Navitrol dumps'</strong> - echo last 100 lines of log on screen.<br />
<strong>'./Navitrol dumps [n]'</strong> - echo last [n] lines of log on screen.<br />
<strong>'./Navitrol dumps [n] [t]'</strong> - echo last [n] lines of log from thread [t] on screen.<br />
<strong>'./Navitrol dumps [n] [t1] [t2]'</strong> - echo last [n] lines of log from threads [t1] and [t2] on screen.<br />
<strong>'./Navitrol dumpl [n] &quot;[string1]&quot; &quot;[string2]&quot; &quot;[...]&quot;' -</strong> dump last n lines of log that contain any of the specified strings.<br />
<strong>'./Navitrol dumpt [start] [end]' -</strong> dump lines between timestamps [start] and [end].</p>
<h4 id="to-a-text-log"><a class="header" href="#to-a-text-log">To a text log</a></h4>
<p>Dumping filtered data to a text log is rarely useful as user can dump whole log and filter it with text editor.</p>
<p><strong>Related commands:</strong></p>
<p><strong>'./Navitrol dumpf'</strong> - dump whole log to ./logs/log.txt.<br />
<strong>'./Navitrol dumpf [n]'</strong> - dump last [n] lines of log to ./logs/log.txt.<br />
<strong>'./Navitrol dumpf [n] [t]'</strong> - dump last [n] lines of log from thread [t] to ./logs/log.txt.<br />
<strong>'./Navitrol dumpf [n] [t1] [t2]'</strong> - dump last [n] lines of log from threads [t1] and [t2] to ./logs/log.txt. </p>
<h3 id="list-of-log-threads"><a class="header" href="#list-of-log-threads">List of log threads</a></h3>
<p>Log threads tell the user from which part of the code a log line has been written. See <code>Reading a text log</code>.</p>
<p>Up to date list of threads can be seen with Linux console command <em><strong>./Navitrol help</strong></em></p>
<p><strong>Example list of available threads:</strong></p>
<pre><code>log_dump: -2
main: -1
veh_inte: 0
scanner_rear: 1
scanner_front: 2
localize: 3
lift_ctrl: 4
ui: 5
io: 6
remote_mon: 7
can_inte_primary: 8
veh_inte_supervisor: 9
dyn_map_server: 10
route_driver: 11
safety_scanner0: 12
safety_scanner1: 13
safety_scanner2: 14
safety_scanner3: 15
pilz_inte: 16
charger_inte: 17
log_handler: 18
ext_loc_sensor0: 19
ext_loc_sensor1: 20
ext_loc_sensor2: 21
ext_loc_sensor3: 22
traj_man: 23
can_inte_secondary: 24
imu_inte: 25
tools_inte: 26
file_io_handler: 27
pos_cont: 28
mcs_inte: 29
</code></pre>
<h2 id="obsolete-log-types"><a class="header" href="#obsolete-log-types">Obsolete log types</a></h2>
<p>Here is a list log files that have been in use but are no longer available. If you see any of these in IPC they can be deleted or ignored.</p>
<table><thead><tr><th>Log type</th><th>Name example</th><th>Comment</th></tr></thead><tbody>
<tr><td>Real time log</td><td>log_realtime1.txt</td><td><strong>Removed</strong> because of too excessive disk writes causing potential Navitrol performance and disk reliability issues.</td></tr>
<tr><td>Leuze scanner log</td><td>Leuze_udp_trace.txt</td><td><strong>Removed</strong></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-image-installation"><a class="header" href="#linux-image-installation">Linux image installation</a></h1>
<p>Updated 26.01.2024</p>
<ul>
<li><a href="Miscellaneous/LinuxImageInstallation/./Clonezilla/ClonezillaInstallation-en.html">Clonezilla</a></li>
<li><a href="Miscellaneous/LinuxImageInstallation/./CanDrivers/CanDrivers-en.html">CAN drivers</a></li>
<li><a href="Miscellaneous/LinuxImageInstallation/./DebianBuster/DebianBusterInstallation-en.html">Debian Buster</a></li>
<li><a href="Miscellaneous/LinuxImageInstallation/./DebianBullseye/DebianBullseyeInstallation-en.html">Debian Bullseye</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="can-interface-and-can-drivers"><a class="header" href="#can-interface-and-can-drivers">CAN interface and CAN drivers</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-42"><a class="header" href="#overview-42">Overview</a></h2>
<p>Traditional &quot;old style&quot; CAN drivers for Linux are based on the model of character devices and provide comparatively little functionality. Typically, these drivers are manufacturer specific and therefore tied to a specific hardware. Exchanging the CAN controller or even the manufacturer of the hardware requires employment of another device driver and often the need for adaption of the application to the new driver's API.</p>
<p>SocketCAN was designed to overcome the limitations of dedicated character device drivers. SocketCAN is part of standard Linux kernel distribution and since Debian 9 (Stretch) was released, SocketCAN has been the preferred CAN interface to be use with Navitrol.</p>
<h2 id="socketcan"><a class="header" href="#socketcan">SocketCAN</a></h2>
<h3 id="socketcan-basics"><a class="header" href="#socketcan-basics">SocketCAN basics</a></h3>
<p>SocketCAN is a set of open-source CAN drivers and a networking stack contributed by Volkswagen Research to the Linux kernel. SocketCAN concept extends the Berkeley sockets API in Linux by introducing a new protocol family, PF_CAN, that coexists with other protocol families, such as PF_INET for the Internet Protocol. The communication with the CAN bus is therefore done analogously to the use of the Internet Protocol via sockets. </p>
<p>Fundamental components of SocketCAN are the network device drivers for different CAN controllers and the implementation of the CAN protocol family. SocketCAN supports natively many commonly used CAN controllers. For example, Kvaser and Peak (Navitec standard offering) CAN cards are supported natively. There is no need to install any additional drivers.</p>
<p>There are also CAN controllers/cards that are not natively supported but come with SocketCAN compatible <strong>network device drivers</strong>. Additional driver for the CAN hardware should be installed only in this case. </p>
<h3 id="socketcan-benefits"><a class="header" href="#socketcan-benefits">SocketCAN benefits</a></h3>
<p>SocketCAN provides multiple benefits over manufacturer specific character device drivers:</p>
<ul>
<li>SocketCAN is the &quot;official&quot; CAN API of the Linux kernel and is included in standard Linux.</li>
<li>Linux comes with device drivers for all major CAN controllers used in various architectures and bus types.</li>
<li>Because of wide use and acceptance, manufacturers of non-natively supported hardware typically provide SocketCAN compatible network device drivers.</li>
<li>Applications, like Navitrol, have standardized communication API that works with any hardware having native support or compatible drivers. Changing CAN hardware provider does not require any modifications to the application. See figure below.</li>
<li>As the SocketCAN concept uses the model of network devices, multiple SocketCAN user space applications are allowed to access one CAN device simultaneously. This makes it possible to use different kind of utilities to interact with the CAN bus. Most commonly used utility pack, can-utils, includes several tools to send/receive/dump/monitor CAN messages in any system. One can for example monitor CAN traffic from a Linux console using <strong>candump</strong> utility while Navitrol is running.</li>
</ul>
<p><img src="Miscellaneous/LinuxImageInstallation/CanDrivers/./media-en/socketCAN.png" alt="" /></p>
<h3 id="socketcan-device-availability-and-testing"><a class="header" href="#socketcan-device-availability-and-testing">SocketCAN device availability and testing</a></h3>
<p>Simple test to check availability of SocketCAN devices is to write command &quot;<strong>ip a</strong>&quot; on the Linux console. Detected SocketCAN devices should appear on the list of available network interfaces as shown below; having device names like can0, can1,...</p>
<pre><code>    4: can0: &lt;NOARP,ECHO&gt; mtu 16 qdisc noop state DOWN group default qlen 10
    link/can
    5: can1: &lt;NOARP,ECHO&gt; mtu 16 qdisc noop state DOWN group default qlen 10
    link/can
</code></pre>
<p>At startup, SocketCAN devices are in &quot;link down&quot; state. If CAN interface is connected to working CAN bus having messaging on the bus, then for testing purposes one can configure and &quot;activate&quot; SocketCAN devices writing commands:</p>
<pre><code>    sudo ip link set can0 type can bitrate 250000
    sudo ip link set can0 up
    candump can0
</code></pre>
<p>Utility candump (part of can-utils package) will then dump all messages on the bus to the console as shown below.</p>
<pre><code>    navitec@debian11:~$ candump can0
    can0  041   [4]  00 00 00 00
    can0  7B8   [1]  01
    can0  0F9   [1]  02
    can0  7AE   [0]
    can0  669   [8]  04 00 00 00 00 00 00 00
    can0  11C   [1]  05
    can0  5A6   [1]  06
    can0  0FE   [1]  07
    can0  12F   [3]  08 00 00
    can0  140   [7]  09 00 00 00 00 00 00
    can0  220   [2]  0A 00
    can0  5DF   [4]  0B 00 00 00
    can0  714   [8]  0C 00 00 00 00 00 00 00
    can0  79D   [6]  0D 00 00 00 00 00
    can0  70B   [2]  0E 00
    can0  3B1   [5]  0F 00 00 00 00
</code></pre>
<p>Another option is to use Navitrol for testing that CAN interface works as expected. Typically, these simple console commands are however a faster way to get assurance of a working interface.</p>
<h2 id="navitec-systems-linux-images-and-can-support"><a class="header" href="#navitec-systems-linux-images-and-can-support">Navitec Systems Linux images and CAN support</a></h2>
<h3 id="debian-7-debian-8-and-debian-9"><a class="header" href="#debian-7-debian-8-and-debian-9">Debian 7, Debian 8 and Debian 9</a></h3>
<p>Older Navitec Systems Linux images, based on Debian 7 (Wheezy) and 8 (Jessie), had two character device CAN drivers pre-installed. Those drivers provided support for CAN card offering from Kvaser and Peak. </p>
<p>SocketCAN has been the default and recommended interface for Navitrol since Debian 9 (Stretch). Manufacturer specific character device drivers have not been installed in Linux images based on Debian 9 or later by Navitec Systems.</p>
<p><strong>NOTE</strong>: Debian 7, Debian 8 and Debian 9 are supported by Navitrol versions up to 6.42.xx only.</p>
<h3 id="debian-10-or-later"><a class="header" href="#debian-10-or-later">Debian 10 or later</a></h3>
<p>Support for Debian versions older than Debian 10 (Buster) is dropped by Navitrol version 6.44, released March 2023. At the same time SocketCAN becomes the only supported CAN interface. Therefore, Kvaser and Peak dedicated character device drivers can't be used anymore.</p>
<h2 id="debian-10-or-later---character-device-driver-for-can-installed"><a class="header" href="#debian-10-or-later---character-device-driver-for-can-installed">Debian 10 or later - character device driver for CAN installed</a></h2>
<p>Navitec Systems has instructed not to install Kvaser and Peak character device drivers to new Linux systems. Installing Kvaser or Peak character device driver to Linux not only installs that dedicated driver, but also effectively removes SocketCAN from use by &quot;blacklisting&quot; it. This blacklisting typically involves only the specific hardware the character device driver has been installed for. For example, Kvaser character device driver installation blacklists SocketCAN for Kvaser interfaces and outputs to console this for each supported interface type</p>
<pre><code>Checking for loaded SocketCAN driver for Kvaser USB devices.
Unloading SocketCAN driver...
Blacklisting SocketCAN Kvaser USB driver to prevent it from auto-loading.
</code></pre>
<p>So, if Kvaser or Peak dedicated character device driver has been installed, SocketCAN can't be used with that hardware unless that driver is uninstalled first and SocketCAN &quot;re-activated&quot;. In such a case, some extra work is needed prior to updating to Navitrol 6.44.xx or later. This means </p>
<ul>
<li>Uninstalling character device driver in question.</li>
<li>Removing the SocketCAN driver from blacklisted drivers.</li>
</ul>
<p>Instructions for this procedure are presented in the following. Fortunately both Kvaser and Peak latest driver packages manage these both operations gracefully.</p>
<h2 id="uninstalling-kvaser-or-peak-dedicated-character-device-driver"><a class="header" href="#uninstalling-kvaser-or-peak-dedicated-character-device-driver">Uninstalling Kvaser or Peak dedicated character device driver</a></h2>
<h3 id="uninstalling-kvaser-canlib-character-device-driver"><a class="header" href="#uninstalling-kvaser-canlib-character-device-driver">Uninstalling Kvaser CANlib character device driver</a></h3>
<p><strong>NOTE</strong>: Some older Kvaser CANlib packages did not handle uninstall at all, so you can get this response: </p>
<pre><code>root@navitrol:/home/navitec/linuxcan# sudo make uninstall
make: *** No rule to make target 'uninstall'.  Stop.
</code></pre>
<p>So, if you have issues with uninstalling the driver or package is not available anymore, download the latest linuxcan driver package (linuxcan.tar.gz) from Kvaser web-site: http://www.kvaser.com/. Sample outputs below are from Bullseye Linux with Kvaser driver version 5.40.102 (which was the latest one at the time of writing this).</p>
<p>If linuxcan driver package is not available anymore at target IPC (or you wish to use the latest driver for uninstalling), you need to do the following steps prior to actual uninstall:</p>
<ul>
<li>Copy linuxcan.tar.gz to your target system</li>
<li>Extract linuxcan: &quot;<strong>tar xvzf linuxcan.tar.gz</strong>&quot;</li>
<li>Change directory: &quot;<strong>cd linuxcan</strong>&quot;</li>
<li>Inside of the linuxcan directory, run &quot;<strong>make</strong>&quot; to build everything which is required before you can uninstall</li>
</ul>
<p>To uninstall the driver</p>
<ul>
<li>
<p>Run: &quot;<strong>sudo make uninstall</strong>&quot;. Output of this is shown below. As the output shows, SocketCAN Kvaser drivers are also removed from blacklist.</p>
</li>
<li>
<p>Reboot IPC to finalize and verify correct operation using SocketCAN.</p>
<pre><code>  navitec@debian11:~/linuxcan$ sudo make uninstall
  Uninstalling pciefd
  Remove SocketCAN Kvaser PCI driver from blacklist.
  Uninstalling pcican2
  Remove SocketCAN Kvaser PCI driver from blacklist.
  Uninstalling pcican
  Remove SocketCAN Kvaser PCI driver from blacklist.
  Uninstalling virtualcan
  Uninstalling usbcanII
  Remove SocketCAN Kvaser USB driver from blacklist.
  Uninstalling mhydra
  Remove SocketCAN Kvaser USB driver from blacklist.
  Uninstalling leaf
  *************************************************************************
  WARNING: leaf could not be removed! Either unplug USB device and
          remove leaf manually after uninstallation or do a reboot.
  *************************************************************************
  Remove SocketCAN Kvaser USB driver from blacklist.
  Uninstalling common
  *************************************************************************
  WARNING: kvcommon could not be removed! Either unplug USB device and
          remove kvcommon manually after uninstallation or do a reboot.
  *************************************************************************
  make -C canlib uninstall
  make[1]: Entering directory '/home/navitec/linuxcan/canlib'
  make[1]: Warning: File '../make/pkgconfig.mk' has modification time 2789510 s in the future
  rm -f /usr/lib/pkgconfig/canlib.pc
  make -C examples uninstall
  make[2]: Entering directory '/home/navitec/linuxcan/canlib/examples'
  make[2]: Warning: File '../../make/gflags.mk' has modification time 2789510 s in the future
  rm -rf /usr/doc/canlib/examples
  make[2]: warning:  Clock skew detected.  Your build may be incomplete.
  make[2]: Leaving directory '/home/navitec/linuxcan/canlib/examples'
  rm -f /usr/lib/libcanlib.so   \
      /usr/lib/libcanlib.so.1    \
      /usr/lib/libcanlib.so.1.10.1   \
      /usr/include/canlib.h \
      /usr/include/canstat.h \
      /usr/include/obsolete.h
  /sbin/ldconfig
  rm -rf /usr/doc/canlib
  make[1]: warning:  Clock skew detected.  Your build may be incomplete.
  make[1]: Leaving directory '/home/navitec/linuxcan/canlib'
  make -C linlib uninstall
  make[1]: Entering directory '/home/navitec/linuxcan/linlib'
  make[1]: Warning: File '../make/pkgconfig.mk' has modification time 2789510 s in the future
  rm -f /usr/lib/pkgconfig/linlib.pc
  rm -f /usr/lib/liblinlib.so   \
      /usr/lib/liblinlib.so.1    \
      /usr/lib/liblinlib.so.1.6.6   \
      /usr/include/linlib.h
  make[1]: warning:  Clock skew detected.  Your build may be incomplete.
  make[1]: Leaving directory '/home/navitec/linuxcan/linlib'
  rm -f /etc/udev/rules.d/10-kvaser.rules
  rm -f /etc/modules-load.d/kvaser.conf
</code></pre>
</li>
</ul>
<h3 id="uninstalling-peak-character-device-driver"><a class="header" href="#uninstalling-peak-character-device-driver">Uninstalling Peak character device driver</a></h3>
<p>If you have issues with uninstalling the driver or package is not available anymore, download the latest driver package (peak-linux-driver-X.Y.Z.tar.gz) from Peak web-site: https://www.peak-system.com. Bullseye Linux with driver version 8.15.2 (which was the latest one at the time of writing this) has been used to verify correct operation.</p>
<p>If Peak driver package is not available anymore at target IPC (or you wish to use the latest driver for uninstalling), you need to do the following steps prior to uninstall:</p>
<ul>
<li>Copy peak-linux-driver-X.Y.Z.tar.gz to your target system</li>
<li>Extract driver package: &quot;<strong>tar -xzf peak-linux-driver-X.Y.Z.tar.gz</strong>&quot;</li>
</ul>
<p>To uninstall the driver</p>
<ul>
<li>Change directory: &quot;<strong>cd peak-linux-driver-X.Y.Z</strong>&quot;</li>
<li>Run &quot;<strong>sudo make uninstall</strong>&quot;. Output of this is shown below.</li>
<li>Optionally result can be pre-checked before rebooting by &quot;<strong>sudo dmesg | grep pcan</strong>&quot;. See example output below. </li>
<li>Reboot IPC to finalize and verify correct operation using SocketCAN.</li>
</ul>
<p>Output for command &quot;<strong>sudo make uninstall</strong>&quot;:</p>
<pre><code>    navitec@debian11:~/peak-linux-driver-8.15.2$ sudo make uninstall
    make[1]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/driver'
    rmmod pcan 2&gt; /dev/null || true
    if [ -f /lib/modules/5.10.0-19-rt-amd64/misc/pcan.ko ]; then\
            rm -f /lib/modules/5.10.0-19-rt-amd64/misc/pcan.ko;\
            depmod 5.10.0-19-rt-amd64;\
    fi
    [ ! -d /var/lib/dkms/peak-linux-driver ] || \
            /usr/sbin/dkms remove peak-linux-driver/8.15.2 --all || true
    rm -f   /usr/src/peak-linux-driver-8.15.2 \
            /tmp/peak-linux-driver-8.15.2-dkms.stderr
    rm -rf /var/lib/dkms/peak-linux-driver
    rm -f   /usr/include/pcan.h \
            /usr/include/pcanfd.h \
            /usr/local/bin/pcan_make_devices \
            /usr/local/bin/lspcan \
            /usr/local/bin/pcanosdiag.sh \
            /etc/udev/rules.d/45-pcan.rules \
            /usr/local/bin/pcan_usb_minor_check.bash \
            /etc/modprobe.d/blacklist-peak.conf \
            /etc/modprobe.d/pcan.conf
    make[1]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/driver'
    make[1]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/lib'
    rm -f /usr/include/libpcan.h \
        /usr/include/libpcanfd.h
    for f in libpcan.so libpcan.so.6 libpcanfd.so libpcanfd.so.8 libpcanfd.a; do \
            rm -f /usr/lib/$f; \
            rm -f /usr/lib32/$f; \
    done
    /sbin/ldconfig
    make[1]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/lib'
    make[1]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/test'
    cd /usr/local/bin; rm -f receivetest transmitest bitratetest filtertest pcanfdtst pcan-settings receivetest_posix transmitest_posix
    make[1]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/test'
    make[1]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic'

    ***
    *** Processing 'pcanbasic' directory...
    ***
    make[2]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/pcanbasic'

    ***
    *** Uninstalling PCANBasic library...
    ***
    rm /usr/include/PCANBasic.h
    rm /usr/lib/libpcanbasic.so
    rm /usr/lib/libpcanbasic.so.0
    rm /usr/lib/libpcanbasic.so.4
    rm /usr/lib/libpcanbasic.so.4.6.2
    rm /usr/lib32/libpcanbasic.so
    rm: cannot remove '/usr/lib32/libpcanbasic.so': No such file or directory
    make[2]: [Makefile_latest.mk:276: uninstall] Error 1 (ignored)
    rm /usr/lib32/libpcanbasic.so.0
    rm: cannot remove '/usr/lib32/libpcanbasic.so.0': No such file or directory
    make[2]: [Makefile_latest.mk:277: uninstall] Error 1 (ignored)
    rm /usr/lib32/libpcanbasic.so.4
    rm: cannot remove '/usr/lib32/libpcanbasic.so.4': No such file or directory
    make[2]: [Makefile_latest.mk:278: uninstall] Error 1 (ignored)
    rm /usr/lib32/libpcanbasic.so.4.6.2
    rm: cannot remove '/usr/lib32/libpcanbasic.so.4.6.2': No such file or directory
    make[2]: [Makefile_latest.mk:279: uninstall] Error 1 (ignored)
    /sbin/ldconfig
    make[2]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/pcanbasic'

    ***
    *** Processing 'pcaninfo' directory...
    ***
    make[2]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/pcaninfo'

    ***
    *** Uninstalling pcaninfo...
    ***
    rm /usr/local/bin/pcaninfo
    make[2]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/pcaninfo'

    ***
    *** Processing 'examples' directory...
    ***
    make[2]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples'

    ***
    *** Processing examples 'console' directory...
    ***
    make[3]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/console'

    ***
    *** Processing 'C' directory (console examples)...
    ***
    make[4]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/console/c'
    #-cd /usr/local/bin; rm -f pcanwrite pcanread pcaneventread pcaneventwrite
    make[4]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/console/c'

    ***
    *** Processing 'NativeC++' directory (console examples)...
    ***
    make[4]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/console/NativeC++'
    make[4]: 'uninstall' is up to date.
    make[4]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/console/NativeC++'
    make[3]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/console'

    ***
    *** Processing examples 'gui' directory...
    ***
    make[3]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/gui'

    ***
    *** Processing 'python' directory (GUI examples)...
    ***
    make[4]: Entering directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/gui/python'
    make[4]: Nothing to be done for 'uninstall'.
    make[4]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/gui/python'
    make[3]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples/gui'
    make[2]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic/examples'
    make[1]: Leaving directory '/home/navitec/peak-linux-driver-8.15.2/libpcanbasic'
</code></pre>
<p>End result after uninstall (and prior to reboot) can be checked by command &quot;<strong>sudo dmesg | grep pcan</strong>&quot;:</p>
<pre><code>navitec@debian11:~/peak-linux-driver-8.15.2$ sudo dmesg | grep pcan
[    4.467507] pcan: loading out-of-tree module taints kernel.
[    4.497265] pcan: module verification failed: signature and/or required key missing - tainting kernel
[    4.540298] pcan: Release_20220929_n (le)
[    4.540302] pcan: driver config [mod] [isa] [pci] [pec] [usb]
[    4.540460] pcan 0000:03:00.0: PCAN-miniPCIe sub-system id 2h (1 channels)
[    4.596459] pcan: PCB v4h FPGA v1.3.0 (mode 3)
[    4.596490] pcan: - pci/pcie device minor 0 found
[    4.596584] usbcore: registered new interface driver pcan
[    4.609183] pcan: major 245.
[  331.784590] usbcore: deregistering interface driver pcan
[  331.784759] pcan: removed.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="clonezilla-installation-instructions"><a class="header" href="#clonezilla-installation-instructions">Clonezilla Installation Instructions</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="installation-1"><a class="header" href="#installation-1">Installation</a></h2>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image1.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image2.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image3.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image4.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image5.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image6.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image7.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image8.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image9.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image10.jpeg" alt="" /></p>
<p><img src="Miscellaneous/LinuxImageInstallation/Clonezilla/./media-en/image11.jpeg" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debian-10-buster-installation"><a class="header" href="#debian-10-buster-installation">Debian 10.* Buster Installation</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="installation-2"><a class="header" href="#installation-2">Installation:</a></h2>
<p>Debian version used: 10.* stable release</p>
<ul>
<li>
<p>Esc while booting to boot to BIOS</p>
</li>
<li>
<p>SCU Enable USB boot</p>
</li>
<li>
<p>Boot manager USB stick</p>
</li>
<li>
<p>Debian installation:</p>
<ul>
<li>
<p>Language = ???</p>
</li>
<li>
<p>Country = ???</p>
</li>
<li>
<p>Locale</p>
</li>
<li>
<p>Keyboard = ???</p>
</li>
<li>
<p>Network = ???</p>
</li>
<li>
<p>Host name = Navitec</p>
</li>
<li>
<p>Domain name = ---</p>
</li>
<li>
<p>Root password = navitrol</p>
</li>
<li>
<p>User account = navitec</p>
</li>
<li>
<p>Username = navitec</p>
</li>
<li>
<p>User password = navitrol</p>
</li>
<li>
<p>Force UEFI installation = no</p>
</li>
<li>
<p>Partitioning method = Guided -- use entire disk</p>
</li>
<li>
<p>Disk partition = hard drive</p>
</li>
<li>
<p>Partition scheme = Separate /home partition</p>
<ul>
<li>Make sure root (/) partition has at least 16 GB, needed for RT kernel installation</li>
</ul>
</li>
<li>
<p>Finish partitioning and write changes to disk</p>
</li>
<li>
<p>Write changes to disk</p>
</li>
<li>
<p>Debian archive mirror country = ???</p>
</li>
<li>
<p>HTTP proxy = ---</p>
</li>
<li>
<p>Participate in the package usage survey = no</p>
</li>
<li>
<p>Software selection = SSH server &amp; Standard system utilities</p>
</li>
<li>
<p>Install GRUB boot loader = yes</p>
</li>
<li>
<p>Device for boot loader installation = /dev/sda</p>
</li>
</ul>
</li>
</ul>
<h2 id="updating-to-real-time-kernel"><a class="header" href="#updating-to-real-time-kernel">Updating to real time kernel:</a></h2>
<pre><code class="language-bash">apt-get update
apt-get install linux-image-4.9.0.9-rt-amd64 # Use uname -a to check the kernel version before this step, installed kernel has to match with standard kernel version
</code></pre>
<ul>
<li>
<p>updated to kernel 4.9.0-9-rt-amd64</p>
</li>
<li>
<p>Double check that systems has preempt_rt kernel installed and in use before proceeding to following steps, by running <em>uname -a</em> And checking that the running kernel is actually real time patched.</p>
</li>
</ul>
<h2 id="packages-installed"><a class="header" href="#packages-installed">Packages installed</a></h2>
<ol>
<li>
<p><code>apt-get update</code></p>
</li>
<li>
<p><code>apt-get dist-upgrade</code></p>
</li>
<li>
<p><code>apt-get install linux-headers-4.9.0-9-rt-amd64</code></p>
</li>
<li>
<p><code>apt-get install make</code></p>
</li>
<li>
<p><code>apt-get install gcc</code></p>
</li>
<li>
<p><code>apt-get install valgrind</code></p>
</li>
<li>
<p><code>apt-get install aptitude</code></p>
</li>
<li>
<p><code>aptitude install cpufrequtils</code></p>
</li>
<li>
<p><code>aptitude install sysfsutils</code></p>
</li>
<li>
<p><code>apt-get install screen</code></p>
</li>
<li>
<p><code>apt-get install build-essential</code></p>
</li>
<li>
<p><code>apt-get install libpopt-dev</code></p>
</li>
<li>
<p><code>apt-get install insserv</code></p>
</li>
<li>
<p><code>apt install tcpdump</code> # For recording tcp communication</p>
</li>
<li>
<p><code>apt install can-utils</code></p>
</li>
<li>
<p><code>apt install net-tools</code> # ifconfig tool installed</p>
</li>
<li>
<p><code>apt install acpid</code> # power button handling</p>
</li>
</ol>
<h2 id="setting-cpu-frequency-to-performance"><a class="header" href="#setting-cpu-frequency-to-performance">Setting CPU frequency to performance</a></h2>
<pre><code class="language-bash">cd /etc/default
cat &gt; cpufrequtils

#*Input the following*
GOVERNOR=&quot;performance&quot;
#*save*
</code></pre>
<h2 id="ignition-pin-configuration"><a class="header" href="#ignition-pin-configuration">Ignition pin configuration</a></h2>
<p>Optional step to make IPC shutdown with IGN pin with systems having hardware support for that:</p>
<p><code>nano /etc/acpi/events/power</code></p>
<p>Write to the file:</p>
<pre><code class="language-bash">event=button/power
action=/sbin/shutdown now
</code></pre>
<h2 id="setting-up-samba"><a class="header" href="#setting-up-samba">Setting up Samba</a></h2>
<pre><code class="language-bash">apt-get install samba
nano /etc/samba/smb.conf
</code></pre>
<p><em>change the following settings</em></p>
<p>Under [global]</p>
<pre><code class="language-bash">min protocol = SMB2
max protocol = SMB3
client min protocol = SMB2
client max protocol = SMB3
client ipc min protocol = SMB2
client ipc max protocol = SMB3
server min protocol = SMB2
server max protocol = SMB3
</code></pre>
<p>Under [homes]</p>
<p><code>read only = no</code></p>
<p><em>save</em></p>
<p><code>service smbd restart</code> # To apply changes without restart</p>
<h2 id="add-password-for-user-navitec-for-samba"><a class="header" href="#add-password-for-user-navitec-for-samba">Add password for user navitec for Samba</a></h2>
<pre><code class="language-bash">smbpasswd -a navitec
password: navitrol
</code></pre>
<h2 id="ethernet-configurations"><a class="header" href="#ethernet-configurations">Ethernet configurations</a></h2>
<p>This step is not necessary for Navitrol to run. Performing this step affects only the naming of the network interfaces not the functionality.</p>
<p><code>ip a</code></p>
<p>If ethernet interface name are not classic eth0, eth1, etc., for example:</p>
<p>2: eno0
3: eno1
4: eno2
5: can0</p>
<p>...perform following steps:</p>
<pre><code class="language-bash">nano /etc/default/grub
</code></pre>
<p><em>enter the following to the file</em></p>
<p><code>GRUB\_CMDLINE\_LINUX=\&quot;net.ifnames=0 biosdevname=0\&quot; &gt; grub-mkconfig -o /boot/grub/grub.cfg</code></p>
<pre><code class="language-bash">reboot
ip a
</code></pre>
<p>2: eth0
3: eth1
4: eth2
5: can0</p>
<p><code>nano /etc/network/interfaces</code></p>
<p><em>example below for the Navitec default settings</em></p>
<pre><code class="language-bash"># The primary network interface
allow-hotplug eth0
iface eth0 inet static
address 10.10.6.100
netmask 255.255.255.0

allow-hotplug eth1
iface eth1 inet dhcp

#auto wlan0
#iface wlan0 inet static
#address x.x.x.x
#netmask x.x.x.x
#gateway x.x.x.x
#wpa-ssid xxxxxxxxxxxxxx
#wpa-psk xxxxxxxxxxxxxx
</code></pre>
<h2 id="booting-to-homenavitec"><a class="header" href="#booting-to-homenavitec">Booting to /home/navitec</a></h2>
<p><code>nano /etc/passwd</code></p>
<p><em>change the following settings</em></p>
<p><code>root:x:0:0:root:/home/navitec:/bin/bash</code></p>
<h2 id="remote-control-support-web-interface"><a class="header" href="#remote-control-support-web-interface">Remote Control Support (web interface)</a></h2>
<pre><code class="language-bash">apt-get install lighttpd
apt-get install libfcgi0ldbl
</code></pre>
<h3 id="lighttpd-configuration"><a class="header" href="#lighttpd-configuration">Lighttpd configuration</a></h3>
<h3 id="default-configuration"><a class="header" href="#default-configuration">Default configuration</a></h3>
<p>Edit <code>/etc/lighttpd/lighttpd.conf</code> to following. Please note that different versions of lighttpd require bit different configurations.
Best approach is to add missing configurations (leave <em>include_shell</em> as they are) to existing file, instead of replacing the file completely.</p>
<pre><code class="language-bash">server.modules = (
  &quot;mod_access&quot;,
  &quot;mod_alias&quot;,
  &quot;mod_compress&quot;,
  &quot;mod_redirect&quot;,
  &quot;mod_fastcgi&quot;,
  &quot;mod_auth&quot;,
)

server.document-root = &quot;/var/www/html&quot;
server.upload-dirs = ( &quot;/var/cache/lighttpd/uploads&quot; )
server.errorlog = &quot;/var/log/lighttpd/error.log&quot;
server.pid-file = &quot;/var/run/lighttpd.pid&quot;
server.username = &quot;www-data&quot;
server.groupname = &quot;www-data&quot;
server.port = 80

index-file.names = ( &quot;index.php&quot;, &quot;index.html&quot;, &quot;index.lighttpd.html&quot; )
url.access-deny = ( &quot;~&quot;, &quot;.inc&quot; )
static-file.exclude-extensions = ( &quot;.php&quot;, &quot;.pl&quot;, &quot;.fcgi&quot; )
compress.cache-dir = &quot;/var/cache/lighttpd/compress/&quot;
compress.filetype = ( &quot;application/javascript&quot;, &quot;text/css&quot;, &quot;text/html&quot;, &quot;text/plain&quot; )

# default listening port for IPv6 falls back to the IPv4 port
include_shell &quot;/usr/share/lighttpd/use-ipv6.pl &quot; + server.port
include_shell &quot;/usr/share/lighttpd/create-mime.conf.pl&quot;
include_shell &quot;/usr/share/lighttpd/include-conf-enabled.pl&quot;

fastcgi.server += (
  &quot;remote_control&quot; =&gt; (
  &quot;remote_control.fcgi.handler&quot; =&gt; (
    &quot;socket&quot; =&gt; &quot;/tmp/remote_control.fcgi.socket&quot;,
    &quot;check-local&quot; =&gt; &quot;disable&quot;,
    &quot;bin-path&quot; =&gt; &quot;/home/navitec/remote_control.fcgi&quot;,
    &quot;max-procs&quot; =&gt; 1
  ))
)
</code></pre>
<h3 id="enable-authentication"><a class="header" href="#enable-authentication">Enable authentication</a></h3>
<p>This step is optional.</p>
<p>Create file <code>/home/navitec/.lighttpdpassword</code> and to that file add line with desired password and username separated with column (:):</p>
<p><em>username:password(MD5 hashed)</em></p>
<p>Add following lines to <code>/etc/lighttpd/lighttpd.conf</code>:</p>
<pre><code class="language-bash">auth.backend = &quot;htpasswd&quot;

auth.backend.htpasswd.userfile = &quot;/home/navitec/.lighttpdpassword&quot;

auth.require = ( &quot;/&quot; =&gt;
  (
  &quot;method&quot; =&gt; &quot;basic&quot;,
  &quot;realm&quot; =&gt; &quot;Password protected area&quot;,
  &quot;require&quot; =&gt; &quot;valid-user&quot;
  )
)
</code></pre>
<h3 id="enable-https"><a class="header" href="#enable-https">Enable HTTPS</a></h3>
<p>This step is optiona.</p>
<ol>
<li>
<p>Run: <code>mkdir /etc/lighttpd/certs/</code></p>
</li>
<li>
<p>Add your certificate file (.pem) to just created location. If using self-signed cert, run following commands in created directory:</p>
</li>
</ol>
<p><code>openssl req -new -x509 -keyout lighttpd.pem -out lighttpd.pem -days 358000 -nodes</code></p>
<p>Note:</p>
<ul>
<li>
<p>Days can be adjusted</p>
</li>
<li>
<p>Using self-signed certificate requires user to manually trust the certificate</p>
</li>
</ul>
<ol start="3">
<li>Add following lines to the end of <code>/etc/lighttpd/lighttpd.conf</code> file:</li>
</ol>
<pre><code class="language-bash">$SERVER[&quot;socket&quot;] == &quot;:443&quot; {
  protocoll = &quot;https://&quot;
  ssl.engine = &quot;enable&quot;
  ssl.pemfile = &quot;/etc/lighttpd/certs/lighttpd.pem&quot;

} else $HTTP[&quot;scheme&quot;] == &quot;http&quot; {
  # In case of unsecure connection, redirect to secure*
  $HTTP[&quot;host&quot;] =~ &quot;.*&quot; {
    # redirect to https, port 443:
    url.redirect = (&quot;.*&quot; =&gt; &quot;https://%0$0&quot;)
  }
}
</code></pre>
<h2 id="allow-root-access-through-ssh"><a class="header" href="#allow-root-access-through-ssh">Allow Root access through SSH</a></h2>
<p>nano /etc/ssh/sshd_config</p>
<p><em>edit the following lines</em></p>
<pre><code class="language-bash">#PermitRootLogin without-password

# to

PermitRootLogin yes
</code></pre>
<p>Restart ssh server: <code>/etc/init.d/ssh restart</code></p>
<h2 id="disabling-suspend-and-problematic-services"><a class="header" href="#disabling-suspend-and-problematic-services">Disabling suspend and problematic services</a></h2>
<p>Run as root. If services do not exist (possibly installed as a part of graphical desktop, and installation of the desktop should be avoided):</p>
<p><code>systemctl disable NetworkManager.service</code></p>
<p><code>systemctl disable ModemManager.service*</code></p>
<p>Run as root. Disable all suspends and sleeps:</p>
<p><code>systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target</code></p>
<h2 id="navitrol-ui-support-touchpad-interface"><a class="header" href="#navitrol-ui-support-touchpad-interface">Navitrol UI support (touchpad interface)</a></h2>
<pre><code class="language-bash">apt-get install qt5
apt-get install libqt5multimedia5
apt-get install devilspie2

NavitrolUI.desktop /etc/xdg/autostart
</code></pre>
<p>Change from Wayland to X11 when logging in and enable automatic login: <code>nano /etc/gdm3/daemon.conf</code></p>
<pre><code class="language-bash">WaylandEnable = false

AutomaticLoginEnable = true
AutomaticLogin = navitec
</code></pre>
<p>Setting NavitrolUI to run fullscreen:</p>
<p><code>nano /home/navitec/.config/devilspie2/maxim.lua</code></p>
<p><em>add the following into the file</em></p>
<pre><code class="language-bash">If(get\_window\_name()==&quot;NavitrolUI&quot;) then\
set\_window\_fullscreen(true);\
end
</code></pre>
<p>Setting the correct resolution on boot:</p>
<p><code>touch .xprofile</code>
<code>nano .xprofile</code></p>
<p><em>Add the following into the file</em></p>
<pre><code class="language-bash">xrandr \--newmode &quot;1280X960 60.00&quot; 101.25 1280 1360 1488 1696
960 963 967 996\
xrandr \--addmode eDP-1 &quot;1280X960 60.00&quot;
</code></pre>
<p><code>chmod -x .xprofile</code></p>
<p>Set screen to not turn off or be dimmed when idle:</p>
<pre><code class="language-bash">gsettings set org.gnome.desktop.screensaver lock-enabled false
gsettings set org.gnome.settings-daemon.plugins.power idle-dim false
gsettings set org.gnome.desktop.session idle-delay 0

Hide cursor on boot:

`apt-get install unclutter`

`nano /etc/xdg/autostart/unclutter.desktop`

*Creates a new file, add the following in*

`unclutter -idle 0`
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debian-11-bullseye-installation"><a class="header" href="#debian-11-bullseye-installation">Debian 11 Bullseye Installation</a></h1>
<p>Updated 14.02.2024</p>
<hr />
<h2 id="overview-43"><a class="header" href="#overview-43">Overview</a></h2>
<p>Debian Bullseye is a Linux distribution that can be used on the AGV:s computer (eg. VBOX) to run Navitrol and other related software. This document guides you throuh the process of installing Bullseye using our custom installer. This customized installer makes it easier to set up a correct running environment for Navitrol. There are also a couple of things that you may want to customize after the installation that are also mentioned here.</p>
<h3 id="introduction-58"><a class="header" href="#introduction-58">Introduction</a></h3>
<p>Debian Bullseye was released August 14 2021 and will be supported by the Debian Long Term Support team and Debian Security Team for 5 years.
In December 2022 Navitec has made available the customized installer for Bullseye that creates a suitable running environment for Navitrol using a streamlined installation process. Almost all the configuration that was done manually to the previous versions and delivered in a CloneZilla image is now part of the installer itself. </p>
<h4 id="whats-new-in-this-version-of-debian-image"><a class="header" href="#whats-new-in-this-version-of-debian-image">What's new in this version of Debian image?</a></h4>
<ul>
<li>This image includes Docker, which should allow running containerized applications on the AGV. For example ROS based applications can be installed this way.</li>
<li>The image also includes 'sudo' which can be used to become root when needed.</li>
<li>Web interface uses SSL by default. It also has password protection enabled by default. The username and password are the same as you would use to login through SSH.</li>
<li>The release notes for Debian Bullseye are found at https://www.debian.org/releases/bullseye/amd64/release-notes/</li>
<li>The kernel version that is installed by the installer is 5.10.0-19-rt. The kernel includes support for CAN devices through SocketCAN and shouldn't require any extra drivers to be installed. </li>
</ul>
<h3 id="requirements-29"><a class="header" href="#requirements-29">Requirements</a></h3>
<ul>
<li>A computer that can boot from USB and has a hard-drive that will be used for installation. To run the installer, there should be at least a keyboard and monitor connected to the computer. You may also prefer to have a mouse for navigating the installer.</li>
<li>An installation medium, typically a USB stick that has at least 2Gb of space. If you prepare the installation media yourself, you also need the ISO image and a computer running the suitable software (eg. Rufus) to make a bootable USB stick from the ISO file. 
<ul>
<li>Rufus is available at https://rufus.ie/en/</li>
<li>The ISO file can be downloaded from https://www.dropbox.com/s/e11v2ynzt0g88eh/bullseye-installer.iso?dl=0</li>
</ul>
</li>
<li>The computer used should satisfy hardware requirements for Navitrol. The Debian installation itself isn't a limiting factor from hardware point of view.</li>
</ul>
<h3 id="limitations-28"><a class="header" href="#limitations-28">Limitations</a></h3>
<ul>
<li>The installer doesn't install packages for supporting Touch UI. If that feature is required the support packages will have to be manually installed.</li>
<li>The installer doesn't install packages for supporting 3D object detection. If that feature is required the support packages will have to be manually installed.</li>
<li>To make the setup easier, most of the decisions you normally make when installing Debian have been made for you. This means that:
<ul>
<li>It will pick the installation drive automatically. Do not connect other drives during installation.</li>
<li>It will partition disk automatically, so you can't customize that.</li>
<li>locale will be en_US.UTF-8</li>
</ul>
</li>
</ul>
<h3 id="dependencies-16"><a class="header" href="#dependencies-16">Dependencies</a></h3>
<ul>
<li>Navitrol installer (.deb package) supports installing on Debian Bullseye starting from version 6.42</li>
</ul>
<h2 id="set-up-15"><a class="header" href="#set-up-15">Set up</a></h2>
<h3 id="making-a-bootable-media"><a class="header" href="#making-a-bootable-media">Making a bootable media</a></h3>
<p>Take the ISO image and burn it to DVD or USB stick. On Windows, software called Rufus can be used for this task. Select the DD mode and not the ISO mode when writing to USB.</p>
<ol>
<li>Plug in your USB stick </li>
<li>Start Rufus</li>
<li>Windows will give you a dialog where you should select &quot;Allow this program to make modifications&quot;</li>
<li>Select your USB stick as the &quot;Device&quot;</li>
<li>Select the ISO image by clicking the &quot;SELECT&quot; button under &quot;Boot selection&quot;</li>
<li>The rest of the options can stay at their defaults:
<ul>
<li>Partition scheme: MBR</li>
<li>Target system: BIOS or UEFI</li>
<li>File system: FAT32</li>
</ul>
</li>
<li>Click &quot;START&quot;</li>
<li>It shows a dialog titled &quot;ISOHybrid image detected&quot; with options &quot;Write in ISO image mode (recommended)&quot; and &quot;Write in DD Image mode&quot;. Select &quot;Write in DD Image mode&quot; and press OK</li>
<li>Wait for it to finish before removing the USB stick</li>
</ol>
<h3 id="installation-3"><a class="header" href="#installation-3">Installation</a></h3>
<p>These installation instructions are tested on VBOX, but the installation should be similar on other PCs as well. The specific keys and boot menu may of course be different.</p>
<ol>
<li>Plug the USB stick to USB2 port on the back of VBOX (the black one, not one of the blue ones). If you use a blue port, the installer will start, but will run into problems in the middle of the installation.</li>
<li>Enter the BIOS on machine startup by pressing the ESC key (may be different on other machines), select the USB stick as the boot device
<ul>
<li>Use arrow keys to browse to the 'boot' tab</li>
<li>Select Boot option #1 using the arrow keys</li>
<li>Press Enter and select the USB key using arrow keys, press Enter again</li>
<li>Press F4 to &quot;Save and exit&quot;</li>
</ul>
</li>
<li>Boot the machine</li>
<li>The installer should start and ask for keyboard layout, select the desired layout.</li>
<li>The installer should ask for the name of the host. Enter desired name for your AGV.</li>
<li>Installer now runs for a while, but should ask no further questions.</li>
<li>In the end, the installer will warn you that the computer is going to restart. Remove USB stick and press ok.</li>
</ol>
<h3 id="fine-tuning-12"><a class="header" href="#fine-tuning-12">Fine tuning</a></h3>
<h4 id="network-configuration"><a class="header" href="#network-configuration">Network configuration</a></h4>
<p>To view current network interfaces and their status
<code>ip a</code></p>
<p>Network configuration can be changed with.
<code>sudo nano /etc/network/interfaces.d/navitec</code></p>
<p><em>The example below are the Navitec default settings.</em> These settings are active if you don't configure anything else.</p>
<pre><code class="language-bash"># The primary network interface
allow-hotplug enp1s0
iface enp1s0 inet static
address 10.10.6.100
netmask 255.255.255.0

allow-hotplug enp2s0
iface enp2s0 inet dhcp
</code></pre>
<p>You can also configure a wlan network if needed. This can be in the same file or under a different file, eg. in ´/etc/network/interfaces.d/wlan´</p>
<pre><code class="language-bash">auto wlp3s0
iface wlp3s0 inet static
address x.x.x.x
netmask x.x.x.x
gateway x.x.x.x
wpa-ssid xxxxxxxxxxxxxx
wpa-psk xxxxxxxxxxxxxx
</code></pre>
<p>Newer versions of the Bullseye installer provided by Navitec (V3 and up) uses the new Debian naming convention for network interfaces. The new naming convention binds the network names with physical PCI lanes which makes the interface name to physical port correspondence more consistent. With the new interface names you would typically have enp1s0, enp2s0 and wlp3s0 instead of eth0, eth1 and wlan0. To revert the interface names to the old naming style, follow these steps:</p>
<ol>
<li>Open the following file with a text editor, for example
<code>nano /etc/default/grub</code></li>
<li>Locate the line with <code>GRUB_CMDLINE_LINUX</code> and add <code>net.ifnames=0 biosdevname=0</code>.
The line should look like this after modifying
<code>GRUB_CMDLINE_LINUX=&quot;net.ifnames=0 biosdevname=0&quot;</code></li>
<li>Update GRUB to use the new configuration
<code>update-grub2</code></li>
<li>Reboot the machine
<code>sudo reboot</code></li>
<li>Now you can check the interface names with
<code>ip a</code></li>
</ol>
<p>Now you have to change the network interfaces file to correspond with the old names</p>
<pre><code class="language-bash"># The primary network interface 
allow-hotplug eth0
iface eth0 inet static
address 10.10.6.100
netmask 255.255.255.0

allow-hotplug eth1
iface eth1 inet dhcp
</code></pre>
<p>You can also configure a wlan network if needed. This can be in the same file or under a different file, eg. in ´/etc/network/interfaces.d/wlan´</p>
<pre><code class="language-bash">auto wlan0
iface wlan0 inet static
address x.x.x.x
netmask x.x.x.x
gateway x.x.x.x
wpa-ssid xxxxxxxxxxxxxx
wpa-psk xxxxxxxxxxxxxx
</code></pre>
<h4 id="setting-the-time-zone"><a class="header" href="#setting-the-time-zone">Setting the time zone</a></h4>
<p>To get the list of time zones give the following command over SSH</p>
<pre><code class="language-bash">timedatectl list-timezones
</code></pre>
<p>and then you can select your timezone using this command:</p>
<pre><code class="language-bash">sudo timedatectl set-timezone &lt;your_time_zone&gt;
</code></pre>
<h3 id="lighttpd-configuration-1"><a class="header" href="#lighttpd-configuration-1">Lighttpd configuration</a></h3>
<p>The Lighttpd server is configured correctly by default. SSL and password authentication are enabled by default.</p>
<h4 id="disable-authentication"><a class="header" href="#disable-authentication">Disable authentication</a></h4>
<p>The authentication can be disabled by removing the file ´/etc/lighttpd/conf-enabled/require_password.conf´.</p>
<h4 id="change-the-password"><a class="header" href="#change-the-password">Change the password</a></h4>
<p>Edit file <code>/etc/lighttpd/nt_password</code>. That file should have a line with desired password and username separated with column (:):
<em>username:password(MD5 hashed)</em>
It is using htpasswd as the backend, so you should create the hash accordingly.</p>
<h4 id="disable-ssl-https"><a class="header" href="#disable-ssl-https">Disable SSL (HTTPS)</a></h4>
<p>You can disable the SSL by removing <code>/etc/lighttpd/conf-enabled/enable-ssl.conf</code>.</p>
<h2 id="how-to-use-26"><a class="header" href="#how-to-use-26">How to use</a></h2>
<h3 id="user-accounts-ssh"><a class="header" href="#user-accounts-ssh">User accounts (SSH)</a></h3>
<p>The installed system will have a user called <code>navitec</code> with the customary default password. The system will allow logins through SSH and will have the default network settings described above. You can use eg. PuTTY to connect to the computer running Debian from a Windows computer, or just ssh from terminal if you are connecting form Linux or MacOS. You can transfer files to and from the computer using SFTP.</p>
<h3 id="navitrol-updater"><a class="header" href="#navitrol-updater">Navitrol Updater</a></h3>
<p>Navitrol Updater is a separate piece of software that can be used to install Navitrol on the Debian. It can also be used to send other files. For more information, see <a href="Miscellaneous/LinuxImageInstallation/DebianBullseye/../../../Introduction/NavitrolUserInstructions/NavitrolUserInstructions-en.html">Navitrol User Instructions</a>.</p>
<h2 id="troubleshooting-47"><a class="header" href="#troubleshooting-47">Troubleshooting</a></h2>
<h3 id="installer-is-not-starting-at-all"><a class="header" href="#installer-is-not-starting-at-all">Installer is not starting at all</a></h3>
<ul>
<li>Ensure that the USB stick is selected as a boot device from the BIOS</li>
</ul>
<h3 id="installer-encounters-a-problem-cant-find-installation-media"><a class="header" href="#installer-encounters-a-problem-cant-find-installation-media">Installer encounters a problem (can't find installation media)</a></h3>
<ul>
<li>Ensure that the USB stick was made using DD mode and not ISO mode</li>
<li>Ensure that you are using USB2 port to install, the USB3 ports may not work with all firmware</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parameter-zones"><a class="header" href="#parameter-zones">Parameter zones</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-44"><a class="header" href="#overview-44">Overview</a></h2>
<p>Navitrol parameter zones can be used to change active parameters of the AGV on the fly based on the AGV's position.</p>
<p>The parameter zones can be used for example to define separate position confidence limits for different areas on the map.</p>
<p><strong>Important note:</strong> Before taking this feature into use contact Navitec support to discuss what you are planning to do. This is required because changing some parameters at runtime might cause unwanted side effects and some might not do anything as they are only updated at Navitrol startup.</p>
<h2 id="how-to-use-27"><a class="header" href="#how-to-use-27">How to use</a></h2>
<h3 id="preconditions-7"><a class="header" href="#preconditions-7">Preconditions</a></h3>
<ul>
<li>Minimum software version requirements
<ul>
<li>Navitrol 6.42.00</li>
<li>Navithor Tools 5.0.0.0</li>
</ul>
</li>
<li>Discuss with Navitec support that this feature will work as intended for your use case.</li>
</ul>
<h3 id="basics-1"><a class="header" href="#basics-1">Basics</a></h3>
<p>Parameter set</p>
<ul>
<li>A set of parameters that will replace the normal ones defined in params.txt</li>
<li>Defined using params_zoneX.txt files that must be located in the same folder as Navitrol executable
<ul>
<li>&quot;X&quot; refers to the index of the parameter set. Valid values are 0, 1, 2 and 3.</li>
<li>For example &quot;params_zone2.txt&quot;</li>
</ul>
</li>
<li>The parameters defined in the parameter sets will override the ones defined in the params.txt
<ul>
<li>This means that only the ones that you want to change should be defined in the params_zoneX.txt</li>
<li>Does not alter params.txt file</li>
</ul>
</li>
<li>Parameter sets of different indexes do not affect each other in any way</li>
</ul>
<p>Parameter zone</p>
<ul>
<li>Defines an environment zone and a related parameter set index.</li>
<li>Related parameters are taken into use when the AGV enters a zone
<ul>
<li>AGV is considered to enter a zone when its navigation point has been within it for 200ms</li>
</ul>
</li>
<li>When the AGV leaves a zone the parameters from params.txt are taken back into use</li>
<li>There can be any number of parameter zones</li>
</ul>
<h3 id="set-up-16"><a class="header" href="#set-up-16">Set up</a></h3>
<p>Define parameter zones</p>
<ul>
<li>Open the Navithor Tools project</li>
<li>Select &quot;Zones&quot;-tab from the menu on the left
<ul>
<li>The tab is located near the bottom of the menu</li>
</ul>
</li>
<li>From &quot;Zone type&quot;-dropdown menu select &quot;ParameterZone&quot;-option
<ul>
<li>If the option cannot be found, update the software</li>
</ul>
</li>
<li>Click on the map to define corners of the desired area for a parameter set</li>
<li>From &quot;Zone options&quot;-dropdown menu select the desired parameter set for the created zone</li>
<li>For more zones, repeat the previous three steps</li>
</ul>
<p>Define parameter sets</p>
<ul>
<li>Create a new text file params_zoneX.txt
<ul>
<li>Parameter set indexes does not have to be defined in order. For example, you can have only parameter set of index 2 without defining indexes 0 and 1.</li>
</ul>
</li>
<li>Add the parameters that should be changed within zones using that parameter set
<ul>
<li>Uses same format as params.txt</li>
<li>Tip: You can copy the parameters you want to change from the params.txt and change their values</li>
</ul>
</li>
</ul>
<p>Additional info</p>
<ul>
<li>If parameter zone is defined but corresponding params_zoneX.txt file is missing, WARNING_PARAMETER_ZONE_PARAMETERS_NOT_FOUND is set and the parameters from params.txt will be used.
<ul>
<li>In practice this means that the zone has no effect</li>
</ul>
</li>
<li>The defined zones can overlap. In case of overlapping zones Navitrol will use the zone with lowest ID defined in tools. see Figure 1
<ul>
<li><strong>NOTE</strong> : Zone ID is different than parameter set index (for example ParameterSet_0)</li>
</ul>
</li>
</ul>
<p><img src="Miscellaneous/ParameterZones/./media-en/image1.png" alt="" /></p>
<blockquote>
<p>Figure 1: In case of overlapping zones, Navitrol uses lowest zone ID.</p>
</blockquote>
<ul>
<li>If parameter set (params_zoneX.txt) is defined but corresponding parameter zone is missing, parameter set is parsed in but never used.</li>
</ul>
<h2 id="related-features-1"><a class="header" href="#related-features-1">Related features</a></h2>
<h3 id="parameter-set-override-through-supervisor-interface"><a class="header" href="#parameter-set-override-through-supervisor-interface">Parameter set override through supervisor interface</a></h3>
<p>Starting with Navitrol version 6.50 the parameter set can also be selected through <a href="Miscellaneous/ParameterZones/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">supervisor interface</a> message 1035. That selection takes precedence over the parameter zones.</p>
<h2 id="troubleshooting-48"><a class="header" href="#troubleshooting-48">Troubleshooting</a></h2>
<h3 id="i-defined-the-parameters-zones-but-now-navitrol-does-not-start"><a class="header" href="#i-defined-the-parameters-zones-but-now-navitrol-does-not-start">I defined the parameters zones but now Navitrol does not start</a></h3>
<ol>
<li>Check that minimum software version defined in Preconditions section is fulfilled.</li>
</ol>
<h3 id="agv-enters-a-parameter-zone-but-nothing-seems-to-happen"><a class="header" href="#agv-enters-a-parameter-zone-but-nothing-seems-to-happen">AGV enters a parameter zone but nothing seems to happen</a></h3>
<ol>
<li>
<p>Check if WARNING_PARAMETER_ZONE_PARAMETERS_NOT_FOUND is active.
If it is, the params_zoneX.txt with the index X that matches the parameter set index of the entered zone (defined in Navithor Tools) is missing. Create the file, save it and reload parameters (or restart Navitrol).</p>
</li>
<li>
<p>Check that parameter zones are correctly defined in the Navitrol's map file by enabling Navitrol monitor zone visualization:</p>
<ul>
<li>Open Navitrol monitor</li>
<li>Connect to the AGV</li>
<li>From the top bar select &quot;View&quot;-menu to open a dropdown menu</li>
<li>From the dropdown menu select &quot;Visualization Options&quot;-option</li>
<li>From &quot;Zone visualization&quot;-box check &quot;Parameter zones&quot;-option
<ul>
<li>If the &quot;Parameter zones&quot;-option is disabled or there is no zones visible when it is checked.
<ul>
<li>Check that the Tools project was correctly modified and successfully uploaded to Navitrol</li>
</ul>
</li>
<li>If parameter zones option does not exist
<ul>
<li>Check that minimum software version defined in Preconditions section is fulfilled.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Check that you are trying to change parameters that can be changed on the fly.
If you have not contacted Navitec support to discuss your use case, do it now.</p>
</li>
</ol>
<h3 id="navitrol-behavior-changes-in-an-unintended-manner-when-entering-a-parameter-zone"><a class="header" href="#navitrol-behavior-changes-in-an-unintended-manner-when-entering-a-parameter-zone">Navitrol behavior changes in an unintended manner when entering a parameter zone</a></h3>
<ol>
<li>Check that you are trying to change parameters that can be changed on the fly.
If you have not contacted Navitec support to discuss your use case, do it now.</li>
</ol>
<h3 id="i-have-any-other-issue-or-the-troubleshooting-tips-did-not-work-for-me"><a class="header" href="#i-have-any-other-issue-or-the-troubleshooting-tips-did-not-work-for-me">I have any other issue or the troubleshooting tips did not work for me</a></h3>
<ol>
<li>Take a log covering the problem situation.</li>
<li>Contact Navitec support and provide the log for further analyzation.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reflectors-1"><a class="header" href="#reflectors-1">Reflectors</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-45"><a class="header" href="#overview-45">Overview</a></h2>
<p>This document includes generic information about using reflectors with Navitrol. Feature specific detailed information is found in documentation for each feature.</p>
<h3 id="requirements-30"><a class="header" href="#requirements-30">Requirements</a></h3>
<p>In order to use reflectors for any purpose, the scanner(s) used obviously need to support reflector detection, see &quot;Scanners – reflector detection&quot; below.</p>
<h3 id="whywhen-to-use-reflectors"><a class="header" href="#whywhen-to-use-reflectors">Why/when to use reflectors</a></h3>
<p>Navitrol basic positioning and most additional features have been designed to work without added infrastructure. There are however cases that benefit from use of reflectors, while some special features even require use of reflectors.</p>
<h4 id="positioning-1"><a class="header" href="#positioning-1">Positioning</a></h4>
<p>Navitrol positioning is designed to work using natural features only, i.e. infrastructure free. Guidelines for good environment can be found in <a href="Miscellaneous/Reflectors/../../Localization/EnvironmentGuidelines/EnvironmentGuidelines-en.html">Environment Guidelines</a>. </p>
<p>Sometimes visible static features are just not enough or out of reach for reliable positioning of the AGV. In such a case the options are </p>
<ul>
<li>Adding artificial static objects/features to the environment </li>
<li>Adding reflectors to the environment </li>
<li>Using additional sensors, like IMU unit and sensor fusion </li>
<li>Using Dynamic mapping feature</li>
</ul>
<p>Reflectors can be added to only problematic areas or distributed all over the production area. Navitrol can then use either static environment or reflectors or both in combination for positioning. When using reflectors together with natural features, even a single reflector can help with positioning. If reflectors are used alone, then a minimum of two reflectors are needed to be visible at the same time.</p>
<p>Use of reflectors typically does not result in better positioning accuracy, but rather improved reliability where static features are not enough or do not exist at all. Additionally,</p>
<ul>
<li>Reflectors can be seen further away than natural features, which makes them a viable option in large open 
areas. </li>
<li>Reflectors can be distinguished from the other objects which again means more reliable positioning.</li>
<li>Reflectors do not take much space and can be easily added to the environment. </li>
</ul>
<h4 id="precision-positioning-2"><a class="header" href="#precision-positioning-2">Precision positioning</a></h4>
<p>Sometimes higher positioning accuracy is needed in specific areas, like loading/docking points. One option then to improve accuracy in such limited sized areas is to use precision positioning, with or without reflectors. This feature is documented in <a href="Miscellaneous/Reflectors/../../Localization/PrecisionPositioning/PrecisionPositioning-en.html">Precision Positioning</a>.</p>
<h4 id="position-initialization-1"><a class="header" href="#position-initialization-1">Position initialization</a></h4>
<p>Position initialization is done on request (like by fleet control or supervisor) or automatically. Automatic position initialization can be done </p>
<ul>
<li>At startup based on last stored position and scanner views (stored in startInfo.bin).</li>
<li>At any time based on reflectors, as documented in <a href="Miscellaneous/Reflectors/../../Localization/ReflectorBasedPositionInitialization/ReflectorBasedPositionInitialization-en.html">Reflector Based Position Initialization</a>.</li>
</ul>
<h4 id="load-and-target-detection"><a class="header" href="#load-and-target-detection">Load and target detection</a></h4>
<p>These features are typically implemented using 2D or 3D data without reflectors. Some special cases use reflectors for detecting load or some other target. </p>
<p>Detection of target, other than load, can be used for example to docking to target or just measuring relative position and angle to the target. One example is to use special reflector patterns mounted in a known configuration on a station, carrier or another AGV. This feature is documented in <a href="Miscellaneous/Reflectors/../../TargetAndObstacleDetection/PatternDetection/PatternDetection-en.html">Pattern Detection</a>.</p>
<hr />
<h2 id="scanners--reflector-detection"><a class="header" href="#scanners--reflector-detection">Scanners – reflector detection</a></h2>
<p>The method by which reflectors are detected with different laser scanners can be classified into three categories as follows</p>
<ul>
<li>Reflector detection by scanner itself. In this case the scanner provides information for each measurement point whether it is hitting a reflector or not. Navitrol parameters have therefore no effect on this detection. Scanner models providing this information are
<ul>
<li>Sick microScan/nanoScan</li>
<li>Sick S300 Expert</li>
<li>Keyence SZ-V 32N</li>
</ul>
</li>
<li>Reflector detection by Navitrol based on signal strength or return intensity (RSSI) reported by the scanner. Scanner models in this category are
<ul>
<li>Pepperl+Fuchs R2000</li>
<li>Sick Tim/LMS (Tim5xx, Tim571, Tim781S, LMS1xx, LMS5xx)</li>
<li>Leuze RSL400</li>
<li>Omron OS32C</li>
<li>Hokuyo scanners (SCIP: UAM-05LP, UST-10LX-H02 &amp; UAM-05LP “native”)</li>
</ul>
</li>
<li>Reflectors not detected at all. Scanner models in this category are
<ul>
<li>Sick S300 other than Expert</li>
<li>Quanergy M1 Core/Plus/Ultra (NOTE: M1E has optional support)</li>
</ul>
</li>
</ul>
<h3 id="reflector-detection-based-on-return-intensity"><a class="header" href="#reflector-detection-based-on-return-intensity">Reflector detection based on return intensity</a></h3>
<p>This option is used with scanners that do not provide reflector detection information, but do provide return intensity (RSSI) for each measurement point. In this case nominal RSSI values for diamond grade reflector are tested by Navitec and defined as a look-up table in Navitrol code. This means that scanner models in this category can be used for reflector detection only if tested by Navitec.</p>
<p>The look-up table in Navitrol defines optimal RSSI values for different distances. Optimal values are though not always realistic in real life. Therefore, Navitrol uses a lower relative threshold level for the decision whether a measured point is a reflector or not. This threshold level is defined by parameter <strong>reflector_rssi_min_ratio</strong> as the ratio (0.0 - 1.0) used for reflector detection. The picture below shows an example of such a look-up table, the blue line being the look-up table RSSI value as a function of detection distance (X-axis). The red line shows the threshold level used with parameter setting <strong>reflector_rssi_min_ratio</strong> = 0.75.</p>
<p><img src="Miscellaneous/Reflectors/./media-en/rssi_lookup_table.png" alt="" /></p>
<hr />
<h2 id="how-to-use-28"><a class="header" href="#how-to-use-28">How to use</a></h2>
<h3 id="reflector-material"><a class="header" href="#reflector-material">Reflector material</a></h3>
<p>Diamond grade reflector material shall be used for reflectors. The reflector material recommended is 3M™ Diamond Grade™ DG Reflective Sheeting 4090 White. It is important that the microstructure/grooves are vertical; if not, the reflector will not work optimally. This material has proved to work well with all scanner types. One can also refer to scanner manufacturer’s recommendation for more details.</p>
<h3 id="reflector-types-supported"><a class="header" href="#reflector-types-supported">Reflector types supported</a></h3>
<p>Navitrol supports two types of reflectors, round and flat. Triangle (two flat reflectors together) shaped reflectors are not supported. </p>
<p>For positioning purposes round and flat reflectors can be mixed. When a reflector can be seen only from a single direction, the flat shape is preferred. When a reflector is seen from different directions when the AGV is driving around, the round shape gives better results.</p>
<h3 id="reflector-size"><a class="header" href="#reflector-size">Reflector size</a></h3>
<p>The recommended diameter/width of the reflector depends on many aspects, like scanner model used and maximum distances to reflectors. The generic recommendation is 5 - 10 cm. A quite common width used in low/mid-distance ranges is 5 cm.</p>
<p>Another important measure is the vertical length of the reflectors used. Tilting of the AGV results in scanner beams hitting the target at different heights. This height difference from the scanner’s mounting height depends on floor/AGV tilt angles and maximum distances from scanner to reflector. </p>
<h3 id="reflector-mounting"><a class="header" href="#reflector-mounting">Reflector mounting</a></h3>
<p>Even on quite even floors some AGV’s tend to swing noticeably while driving. If the reflectors are too short or mounted at a wrong height, the set of visible reflectors can change frequently while driving. This can have a negative impact on positioning performance.</p>
<p>With a top mounted scanner, reflectors should obviously be mounted so that the vertical mid-point of the reflector is on the same height as the scanner. With a scanner mounted very low, like a safety scanner, there is obviously no such option.</p>
<h3 id="reflectors-for-positioning"><a class="header" href="#reflectors-for-positioning">Reflectors for positioning</a></h3>
<p>There are some aspects to consider when deciding the number and locations of reflectors used for positioning or position initialization. Some general things to take into account are:</p>
<ul>
<li>Consider if reflectors are truly needed. Add reflectors only to areas where they are needed and provide additional value.</li>
<li>Reflectors should not be mounted too close to each other. Having reflectors too close to each other causes potential problems rather than solves them. The minimum recommended distance between two reflectors is 50 cm, preferably more.</li>
<li>Optimally at least 3 reflectors are seen at the same time. Less than 3 at a time can be used by Navitrol for positioning though. </li>
<li>More is not always better - use a reasonable number, well planned and well matching reflectors.
<ul>
<li>Pay attention to achievable geometries and distances between reflectors rather than just number of reflectors seen. </li>
<li>Make sure that reflectors on the map match with static features seen at the same time. If this is the case, the reflectors are presumably improving positioning performance. If the match is not good, the reflectors potentially disturb the positioning in certain areas.</li>
</ul>
</li>
<li>Good “geometry” of the reflectors seen by the scanner(s) is the key to a solid performance. The geometry is good if the scanner sees reflectors in multiple directions, the angles between these directions being quite evenly distributed. For example, reflectors seen in one direction or in opposite directions only, do not provide a good geometry for positioning purposes. See <a href="Miscellaneous/Reflectors/../../Localization/EnvironmentGuidelines/EnvironmentGuidelines-en.html">Environment Guidelines</a> for more information.</li>
</ul>
<p>Reflector locations are added to the map as part of the map making process. Navithor Tools has the capability to automatically detect and add reflectors to the map. As mentioned, for optimal performance one should check that the reflector detections truly match with the static environment in the final map.</p>
<h3 id="generic-parameters"><a class="header" href="#generic-parameters">Generic parameters</a></h3>
<p>There are plenty of feature specific parameters when it comes to using reflectors. The following includes only parameters common to all features.</p>
<table><thead><tr><th>Name</th><th>Data Type</th><th>Default Value</th><th>Comments</th></tr></thead><tbody>
<tr><td>reflector_rssi_min_ratio</td><td>Float</td><td>0.85</td><td>Required RSSI value for reflector detection, when compared to optimal lookup table value. <br> Recommended initial values for different scanner models can be found in <a href="Miscellaneous/Reflectors/../../AgvInterfaces/ScannerConfigurations/ScannerConfigurations-en.html">Scanner Configurations</a></td></tr>
<tr><td>scan_halo_ang</td><td>Float</td><td>1.5 deg m/s</td><td>Halo angle in degrees around reflectors. <br> All measurements within this halo are effectively disabled.</td></tr>
</tbody></table>
<hr />
<h2 id="troubleshooting-49"><a class="header" href="#troubleshooting-49">Troubleshooting</a></h2>
<p>Some generic issues related to reflector detection are listed below. In order to do successful troubleshooting, it is important to understand the way the scanner(s) in use detect reflectors (see &quot;Scanners – reflector detection&quot;).</p>
<h3 id="most-common-issues-9"><a class="header" href="#most-common-issues-9">Most common issues</a></h3>
<p>Reflectors are not detected at all</p>
<ul>
<li>Check if the scanner in use supports reflector detection.</li>
<li>Try detection with a reflector close to the scanner. Make sure that the scanner beam hits the reflector.</li>
<li>Check the reflector material in use, and it's orientation relative to the scanner.</li>
<li>If the detection is based on the RSSI value, check the value of parameter <strong>reflector_rssi_min_ratio</strong>. Try a smaller value.</li>
<li>Clean the scanner lens.</li>
</ul>
<p>Reflectors are not detected reliably</p>
<ul>
<li>Check the things mentioned in the previous checklist.</li>
<li>Check the mounting of the scanner and verify that it sees the reflectors - check that the scanner beam truly hits the reflector at all times. With a scanner mounted low, like a safety scanner, the scanner beam might occasionally hit the floor whenever the AGV is tilting and/or distances are large.</li>
<li>Check the length of the reflectors as well as their mounting height. Uneven floors cause tilting of the AVG, which may occasionally direct the scanner beam over or under the reflector. This can be improved by making the reflector long enough and mounted at the correct height.</li>
</ul>
<p>Reflectors are not detected at larger distances</p>
<ul>
<li>Check the things mentioned in previous checklists.</li>
<li>Try if wider reflectors would work better.</li>
<li>Try better scanner angular resolution when possible (Pepperl+Fuchs R2000).</li>
</ul>
<p>Non-reflective targets are detected as reflectors</p>
<ul>
<li>If detection is based on RSSI value, check the value of parameter <strong>reflector_rssi_min_ratio</strong>. Try larger value.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssltls-connection-setup-and-certificate-creation"><a class="header" href="#ssltls-connection-setup-and-certificate-creation">SSL/TLS connection setup and certificate creation</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="glossary-19"><a class="header" href="#glossary-19">Glossary</a></h2>
<table><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody>
<tr><td>MMC</td><td>Microsoft management console</td></tr>
<tr><td>CN</td><td>Common Name</td></tr>
<tr><td>.crt</td><td>Certificate file appendix</td></tr>
<tr><td>.csr</td><td>Certificate signing request file appendix</td></tr>
<tr><td>.key</td><td>Certificate private key appendix</td></tr>
<tr><td>.pfx</td><td>Personal exchange format file appendix. Combination of private key (.key) and certificate file (.crt)</td></tr>
</tbody></table>
<hr />
<h2 id="overview-46"><a class="header" href="#overview-46">Overview</a></h2>
<p>SSL support is currently implemented in Navitrol-Monitor, Navitrol-Navithor and Navithor-MES communication interfaces. It requires the support to be enabled by parameter on each end and the correct certificates to be installed. If only one end is configured to use encryption, connection can't be made.</p>
<p>The use of SSL aims at both encrypting the communications, so that it can not be eavesdropped, and identifying the communicating parties, so that unauthorized parties can not give commands or feed false information into the system. For this purpose, both ends are using certificates, signed by a common trusted root certificate. The different parties have a different common name in the certificate, which prevents stolen certificate from being used to communicate in another role in the system (eg. Navitrol certificate can't be used as Navithor).</p>
<p>This document gives instructions on how to create a root certificate and use that to sign the per-role certificates. It also explains how to install the certificate in windows (where it has to be done system-wide) and Linux (where it is local for only Navitrol). Relevant parameters are listed and some tips are given for debugging issues.</p>
<h2 id="create-root-ca-done-once"><a class="header" href="#create-root-ca-done-once">Create Root CA (Done once)</a></h2>
<h3 id="create-root-key"><a class="header" href="#create-root-key">Create Root Key</a></h3>
<p><strong>Attention:</strong> this is the key used to sign the certificate requests, anyone holding this can sign certificates on your behalf. So keep it in a safe place!</p>
<p><code>openssl genrsa -out rootCA.key 4096</code></p>
<h3 id="create-and-self-sign-the-root-certificate"><a class="header" href="#create-and-self-sign-the-root-certificate">Create and self sign the Root Certificate</a></h3>
<p><code>openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 5024 -out rootCA.crt</code></p>
<h2 id="create-a-certificate"><a class="header" href="#create-a-certificate">Create a certificate</a></h2>
<p>This procedure needs to be followed for each server/appliance that needs a trusted certificate from our CA</p>
<h3 id="create-the-certificate-key"><a class="header" href="#create-the-certificate-key">Create the certificate key</a></h3>
<p><code>openssl genrsa -out example\_cert.key 2048</code></p>
<h3 id="create-the-signing-request-csr"><a class="header" href="#create-the-signing-request-csr">Create the signing request (csr)</a></h3>
<p>The certificate signing request is where you specify the details for the certificate you want to generate. This request will be processed by the owner of the Root key (you in this case since you create it earlier) to generate the certificate.</p>
<p><strong>Important:</strong> Please mind that while creating the signing request it is important to specify the <strong>Common Name</strong> providing the name for the service, otherwise the certificate cannot be verified. Navitrol server Common Name (CN) default is &quot;Navitrol&quot;</p>
<p>Openssl will ask you questions about the certificate to generate like the organization details and the <strong>Common Name (CN)</strong> that is normally the web address you are creating the certificate for. Navitrol instead uses the role of the machine as the common name.</p>
<p><code>openssl req -new -key example\_cert.key -out example\_cert.csr</code></p>
<h3 id="verify-the-csrs-content"><a class="header" href="#verify-the-csrs-content">Verify the csr's content</a></h3>
<p><code>openssl req -in example\_cert.csr -noout -text</code></p>
<h3 id="generate-the-certificate-using-the-example_cert-csr-and-key-along-with-the-ca-root-key"><a class="header" href="#generate-the-certificate-using-the-example_cert-csr-and-key-along-with-the-ca-root-key">Generate the certificate using the example_cert csr and key along with the CA Root key</a></h3>
<p><code>openssl x509 -req -in example\_cert.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out example\_cert.crt -days 5000 -sha256</code></p>
<h3 id="verify-the-certificates-content"><a class="header" href="#verify-the-certificates-content">Verify the certificate's content</a></h3>
<p><code>openssl x509 -in example\_cert.crt -text -noout</code></p>
<h2 id="quick-guide-for-creating-root-client-and-server-cert-for-navitrol-----navitrolmonitor-communication"><a class="header" href="#quick-guide-for-creating-root-client-and-server-cert-for-navitrol-----navitrolmonitor-communication">Quick guide for creating root, client and server cert for Navitrol --- NavitrolMonitor communication</a></h2>
<p>Create a folder /home/navitec/openSSLCerts in Debian.</p>
<p>Go inside this folder and follow the commands below.</p>
<ol>
<li>
<p><strong>Create root key:</strong><br />
<code>openssl genrsa -out NavitecCA.key 4096</code></p>
</li>
<li>
<p><strong>Create and self sign root cert:</strong><br />
<code>openssl req -x509 -new -nodes -key NavitecCA.key -sha256 -days 5024 -out NavitecCA.crt</code></p>
</li>
<li>
<p><strong>Create the certificate private key for Navitrol:</strong><br />
<code>openssl genrsa -out agv.key 2048</code></p>
</li>
<li>
<p><strong>Create the signing csr for Navitrol:</strong><br />
<code>openssl req -new -sha256 -key agv.key -out agv.csr</code></p>
</li>
<li>
<p><strong>Verify the csr's content:</strong><br />
<code>openssl req -in agv.csr -noout -text</code></p>
</li>
<li>
<p><strong>Generate the Navitrol certificate by using csr and private key:</strong><br />
<code>openssl x509 -req -in agv.csr -CA NavitecCA.crt -CAkey NavitecCA.key -CAcreateserial -out agv.crt -days 5024 -sha256</code></p>
</li>
<li>
<p><strong>Verify Navitrol cert content:</strong><br />
<code>openssl x509 -in agv.crt -text -noout</code></p>
</li>
<li>
<p><strong>Create the certificate private key for NavitrolMonitor:</strong><br />
<code>openssl genrsa -out monitor.key 2048</code></p>
</li>
<li>
<p><strong>Create the signing csr for NavitrolMonitor:</strong><br />
<code>openssl req -new -sha256 -key monitor.key -out monitor.csr</code></p>
</li>
<li>
<p><strong>Verify the csr's content:</strong><br />
<code>openssl req -in monitor.csr -noout -text</code></p>
</li>
<li>
<p><strong>Generate the NavitrolMonitor certificate by using csr and private key:</strong><br />
<code>openssl x509 -req -in monitor.csr -CA NavitecCA.crt -CAkey NavitecCA.key -CAcreateserial -out monitor.crt -days 5024 -sha256</code></p>
</li>
<li>
<p><strong>Verify NavitrolMonitor cert content:</strong><br />
<code>openssl x509 -in monitor.crt -text -noout</code></p>
</li>
<li>
<p><strong>Change Navitrolmonitor key + cert .pfx file</strong><br />
<code>openssl pkcs12 -export -out monitor.pfx -inkey monitor.key -in monitor.crt</code></p>
</li>
<li>
<p><strong>Copy root cert and monitor cert (monitor.pfx) to Windows mmc</strong></p>
<ol>
<li>add root cert (example <em>NavitecCA.crt)</em> under MMC Certificates/Trusted Root Certification Authorities/</li>
<li>add monitor pfx cert (example <em>monitor.pfx)</em> under MMC Certificates/Personal/</li>
</ol>
</li>
</ol>
<h2 id="setting-up-ssl-in-navitrol"><a class="header" href="#setting-up-ssl-in-navitrol">Setting up SSL in Navitrol</a></h2>
<p><strong>1. Default setup</strong></p>
<p>If you use the following names for the certificate files and don't set passwords for them, the setup is just these three steps:</p>
<ol>
<li>Set the ssl_enabled parameter to 1</li>
<li>Copy the certificate and key with &quot;Navitrol&quot; common name on the AGV</li>
<li>Copy the root certificate (but not the key) on the AGV</li>
</ol>
<table><thead><tr><th>File</th><th>Name</th></tr></thead><tbody>
<tr><td>Navitrol certificate</td><td>/home/navitec/agv_certs/agv.crt</td></tr>
<tr><td>Navitrol key</td><td>/home/navitec/agv_certs/agv.key</td></tr>
<tr><td>The root certificate (that was used to sign the other keys)</td><td>/home/navitec/agv_certs/root.crt</td></tr>
</tbody></table>
<p><strong>2. Extra steps if you don't use the default places for files</strong></p>
<ol>
<li>Set the ssl_agv_certificate_file to the certificate file path</li>
<li>Set the ssl_agv_key_file parameter to the key file path</li>
<li>Set the ssl_ca_file parameter to point to the trusted root certificate</li>
</ol>
<p><strong>3. Other options</strong></p>
<ol>
<li>If the key requires a password, set the password in ssl_pem_password parameter</li>
</ol>
<h2 id="ssl-parameters-in-navitrol"><a class="header" href="#ssl-parameters-in-navitrol">SSL parameters in Navitrol</a></h2>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Default value</th></tr></thead><tbody>
<tr><td>ssl_enabled</td><td>Whether to use SSL to encrypt connections</td><td>0</td></tr>
<tr><td>ssl_verify_server_cert</td><td>Whether to verify the certificate when Navitrol is connecting as a client</td><td>1</td></tr>
<tr><td>ssl_verify_client_cert</td><td>Whether to verify the certificate when Navitrol is acting as a server</td><td>0</td></tr>
<tr><td>ssl_agv_certificate_file</td><td>The certificate the AGV uses to communicate</td><td></td></tr>
<tr><td>ssl_agv_key_file</td><td>The key the AGV uses to communicate</td><td></td></tr>
<tr><td>ssl_pem_password</td><td>Password needed to unlock the key (if any)</td><td></td></tr>
<tr><td>ssl_ca_file</td><td>The root certificate filename</td><td></td></tr>
<tr><td>ssl_cipher_list</td><td>List of accepted cipher suites in preference order</td><td>Long list of defaults</td></tr>
<tr><td>ssl_dh_param_file</td><td>Diffie-Helman parameter file needed by some cipher suites. Needs to be pre-generated if those ciphers are used.</td><td>/home/navitec/dh_param_2048.pem</td></tr>
</tbody></table>
<h3 id="example-parameters-1"><a class="header" href="#example-parameters-1">Example parameters:</a></h3>
<pre><code class="language-bash">## Secure communication parameters: Navitrol &lt;-&gt; NavitrolMonitor
I,ssl_enabled, 1
I,ssl_verify_server_cert, 1
I,ssl_verify_client_cert, 0
S,ssl_agv_certificate_file, /home/navitec/agv_certs/agv.crt #Navitrol private certificate
S,ssl_agv_key_file, /home/navitec/agv_certs/agv.key # certificate private key
S,ssl_ca_file, /home/navitec/agv_certs/NavitrolCA.crt # root cert
S,ssl_pem_password, navitrol # agv_certificate_file password
</code></pre>
<h2 id="common-names-cn-for-various-roles"><a class="header" href="#common-names-cn-for-various-roles">Common names CN for various roles</a></h2>
<table><thead><tr><th>Role</th><th>Common name</th></tr></thead><tbody>
<tr><td>Fleet control</td><td>MCSServer</td></tr>
<tr><td>Monitor</td><td>RemoteMonClient</td></tr>
<tr><td>AGV</td><td>Navitrol</td></tr>
<tr><td>MES</td><td>NavithorMES</td></tr>
</tbody></table>
<h2 id="setting-up-ssl-in-windows"><a class="header" href="#setting-up-ssl-in-windows">Setting up SSL in Windows</a></h2>
<h3 id="add-root-cert"><a class="header" href="#add-root-cert">Add root cert</a></h3>
<p>Navitrol root certificate (NavitrolCA.crt) must be added to MMC so that SSL communication works between Navitec products.</p>
<ol>
<li>
<p>Open MMC
<img src="Miscellaneous/SslCertificates/./media-en/image3.png" alt="" /></p>
</li>
<li>
<p>Click File Add/Remove Snap-in...</p>
</li>
<li>
<p>Choose certificates and then click Add
<img src="Miscellaneous/SslCertificates/./media-en/image4.png" alt="" /></p>
</li>
<li>
<p>Select &quot;Computer account&quot; and click Next</p>
</li>
<li>
<p>Select Local computer and click Finish</p>
</li>
<li>
<p>Press Ok to close &quot;Add or Remove Snap-ins&quot; pop-up window</p>
</li>
<li>
<p>Now in your MMC view you should have a Certificates section. Navigate to Certificates/Trusted Root Certification Authorities/Certificates
<img src="Miscellaneous/SslCertificates/./media-en/image5.png" alt="" /></p>
</li>
<li>
<p>Click More Actions -&gt; All tasks import
<img src="Miscellaneous/SslCertificates/./media-en/image6.png" alt="" /></p>
</li>
<li>
<p>Add root Cert (example NavitrolCA.crt)</p>
</li>
</ol>
<p>I. Browse the Correct cert</p>
<p>II. Choose &quot;Place all certificates in the following store&quot;</p>
<p>III. Click finish<br />
<img src="Miscellaneous/SslCertificates/./media-en/image7.png" alt="" /></p>
<h3 id="adding-a-certificate"><a class="header" href="#adding-a-certificate">Adding a certificate</a></h3>
<p>If two-way authentication is needed/wanted, a client-side certificate is needed also. This is the certificate for NavitrolMonitor or Navithor.
MES interface does not require a client certificate to be sent. The certificate needs to be added under MMC Certificates/Personal/. In this example the client-side certificate is named monitor.pfx</p>
<ol>
<li>
<p>Open MMC</p>
</li>
<li>
<p>Add Certificates Snap-in as Computer account local computer as done in Chapter 1.</p>
</li>
<li>
<p>Navigate to Certificates/Personal/Certificates</p>
</li>
<li>
<p>Import new certificate
<img src="Miscellaneous/SslCertificates/./media-en/image8.png" alt="" /></p>
</li>
<li>
<p>Browse and choose the <strong>.pfx</strong> file
<img src="Miscellaneous/SslCertificates/./media-en/image9.png" alt="" /></p>
</li>
<li>
<p>Type the certificate password if it had one</p>
</li>
</ol>
<h3 id="server-and-client-certificate-common-names-cn"><a class="header" href="#server-and-client-certificate-common-names-cn">Server and Client certificate Common Names (CN)</a></h3>
<p>By default, Navitrol/Server certificate (agvcrt) Common Name is <em>Navitrol</em> and Monitor certificate (monitor.pfx) CommonName is <em>RemoteMonClient</em>.</p>
<p>If these must be changed, do the following:</p>
<ol>
<li>
<p>Go to the folder where you have NavitrolMonitor</p>
</li>
<li>
<p>Open Parameters.xml</p>
</li>
<li>
<p>Search &lt;ServerCommonName&gt; and change the Server common name to match the server certificate common name (agv.crt Common name)</p>
</li>
<li>
<p>Search &lt;ClientCommonName&gt; and change the Client common name to match the client certificate common name (monitor.pfx common name)</p>
</li>
</ol>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Default value</th></tr></thead><tbody>
<tr><td>ServerCommonName</td><td>Navitrol certificate common name (must match to it, example agv.crt)</td><td>Navitrol</td></tr>
<tr><td>ClientCommonName</td><td>Monitor side certificate common Name (Must match to it, example monitor.pfx)</td><td>RemoteMonClient</td></tr>
</tbody></table>
<h3 id="enabling-ssl-on-navitrolmonitor"><a class="header" href="#enabling-ssl-on-navitrolmonitor">Enabling SSL on NavitrolMonitor</a></h3>
<p>Open NavitrolMonitor and click &quot;SSL comms&quot; to enable SSL. Make sure that Navitrol has SSL enabled as well and SSL certificates configured according to the image below
<img src="Miscellaneous/SslCertificates/./media-en/image10.png" alt="" /></p>
<h3 id="enabling-ssl-on-navithor"><a class="header" href="#enabling-ssl-on-navithor">Enabling SSL on Navithor</a></h3>
<p>Open settings in Navithor Client and set the following parameters in NavithorServer.exe.config to configure the wanted common names of the certificates. Certicates with the names must be placed into the certificate storage as described earlier in section 8. This must be done before server startup.</p>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Default Value</th></tr></thead><tbody>
<tr><td>secureSocketCertCommonName</td><td>Common name of the certificate used by Navithor. Both when acting as server for MES or when connecting as a client to Navitrol</td><td>MCSServer</td></tr>
<tr><td>secureSocketNavitrolCertName</td><td>Common name of the certificate received from Navitrol</td><td>Navitrol</td></tr>
</tbody></table>
<p>Now that the common names are configured, you can choose to enable SSL communications from Navithor Client under TC parameters.</p>
<table><thead><tr><th>Parameter</th><th>Description</th><th>Default Value</th></tr></thead><tbody>
<tr><td>Machine_CommunicationEncrypted</td><td>Enables SSL in Navitrol-Navithor communication.</td><td>false</td></tr>
<tr><td>MES_CommunicationEncrypted</td><td>Enables SSL in Navithor-MES Interface communication.</td><td>false</td></tr>
</tbody></table>
<h2 id="troubleshooting-50"><a class="header" href="#troubleshooting-50">Troubleshooting</a></h2>
<h3 id="navitrol-ssl-initialization"><a class="header" href="#navitrol-ssl-initialization">Navitrol SSL initialization</a></h3>
<ul>
<li>
<p>Check that you have root certificate, Navitrol certificate (agv.crt) and Navitrol certificate private key (agv.key). Also check that the paths of these are set correctly in params.txt. Check that SSL is enabled in parameters.</p>
</li>
<li>
<p>In addition to following log messages, errors originating from SSL library are logged as messages starting with CCSSL_LogError</p>
</li>
</ul>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Note</th></tr></thead><tbody>
<tr><td>OpenSSL initialized</td><td>SSL library initialization was successful</td><td>Contains the SSL library version, sometimes useful for debugging</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>Client context created<br>Server context created</td><td>SSL is enabled and SSL certificates &amp; ciphers were successfully set up</td><td>ssl_enabled</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>Socket &quot;name&quot; should be encrypted but SSL is disabled</td><td>SSL is turned off from the parameter file</td><td>ssl_enabled</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>Failed to load certificate file<br>Failed to load root certificate<br>Failed to load key file</td><td>The file is not correctly named<br>The file rights are wrong (chmod)<br>The file is not a certificate/key file<br>Wrong certificate/key file format</td><td>ssl_ca_file<br>ssl_agv_certificate_file<br>ssl_agv_key_file</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>Private key does not match the public certificate</td><td>The key file and certificate file are both valid, but the key is not for this certificate.</td><td>ssl_agv_certificate_file<br>ssl_agv_key_file</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>SSL cipher list from params</td><td>List of allowed ciphers have been modified by user using parameters</td><td>ssl_cipher_list</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>Could not set cipher list</td><td>User provided cipher list contains unsupported values<br>SSL library internal error</td><td>ssl_cipher_list</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>SSL: No DH paramfile found</td><td>DH parameter file (required for certain ciphers) has been set in the parameters, but wasn't found<br>The user doesn't have rights to read the parameter file (chmod)</td><td>ssl_dh_param_file</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>SSL: Could not read DH params<br>Could not set DH params</td><td>DH parameter file (required for certain ciphers) has been set in the parameters, but was in incorrect format</td><td>ssl_dh_param_file</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th></tr></thead><tbody>
<tr><td>Failed to create client method<br>Failed to create client context<br>Failed to set minimum protocol version<br>Failed to set session ID<br>Failed to create server method<br>Failed to create server context<br>Couldn't create elliptic curve<br>Couldn't set ecdh parameters</td><td>Internal error</td></tr>
</tbody></table>
<h3 id="navitrol-ssl-connecting"><a class="header" href="#navitrol-ssl-connecting">Navitrol SSL connecting</a></h3>
<ul>
<li>
<p>When connecting with Monitor or fleet control, Navitrol acts as the server</p>
</li>
<li>
<p>Navitrol verifies the client certificate</p>
</li>
<li>
<p>Check that both ends have SSL enabled</p>
</li>
<li>
<p>In addition to following log messages, errors originating from SSL library are logged as messages starting with CCSSL_LogError</p>
</li>
</ul>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>SSL connection accepted using &quot;SOME_CIPHER_NAME&quot; cipher</td><td>Connection was successfully established and the negotiated cipher was selected</td><td>ssl_cipher_list</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th></tr></thead><tbody>
<tr><td>Certificate name 'some_name' matches</td><td>The client provided a certificate with the correct name</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>Peer did not provide a certificate</td><td>The certificate is not configured right on the connecting software</td><td>ssl_verify_client_cert</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th><th>Parameters</th></tr></thead><tbody>
<tr><td>Certificate name doesn't match expected name</td><td>Wrong certificate in use by the connecting software<br>The common name (CN) of the certificate was mistyped</td><td>ssl_verify_client_cert</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th></tr></thead><tbody>
<tr><td>Error verifying certificate common name</td><td>Internal error<br>Corrupted certificate<br>Certificate doesn't have a common name</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th></tr></thead><tbody>
<tr><td>Common name location failed<br>Failed to extract common name field<br>Failed to get data from common name field<br>Null character inside certificate common name -&gt; discard</td><td>The certificate is missing CN (Common name) field<br>The common name field is malformed</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th></tr></thead><tbody>
<tr><td>Exhausted max read time</td><td>Poor network connection<br>Other end of the connection crashed</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th></tr></thead><tbody>
<tr><td>Failed to accept SSL connection</td><td>Failed to negotiate a cipher<br>The other end is not using SSL<br>Other error in forming the SSL connection</td></tr>
</tbody></table>
<table><thead><tr><th>Log message</th><th>Cause</th></tr></thead><tbody>
<tr><td>Failed to create SSL<br>CCSSL_Accept poll error<br>Can't set the socket to blocking in CCSSL_Shutdown<br>CCSSL_Read, poll failed</td><td>Internal error</td></tr>
</tbody></table>
<h3 id="navitrol-monitor-ssl-authentication-failed"><a class="header" href="#navitrol-monitor-ssl-authentication-failed">Navitrol Monitor SSL Authentication failed</a></h3>
<ul>
<li>If NavitrolMonitor is using SSL, but SSL is not enabled on Navitrol enable ssl_enabled parameter on Navitrol</li>
</ul>
<p><img src="Miscellaneous/SslCertificates/./media-en/image11.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="battery-overtemperature-actions"><a class="header" href="#battery-overtemperature-actions">Battery overtemperature actions</a></h1>
<p>Updated 26.01.2024</p>
<hr />
<h2 id="overview-47"><a class="header" href="#overview-47">Overview</a></h2>
<p>Battery overtemperature actions can be used to perform an emergency unload followed by an emergency drive of predefined length straight forward in case battery overtemperature is detected when the AGV has load aboard. These emergency actions cannot be aborted as long as the battery overtemperature is active.</p>
<p><img src="Miscellaneous/BatteryOvertemperatureActions/./media-en/image_batt_overtemp_actions_overview.png" alt="" /></p>
<blockquote>
<p>Figure 1: Overview of the battery overtemperature actions.</p>
</blockquote>
<p>One might want to use this feature to move the AGV from under the load it carries to provide easier access to the overheated battery.</p>
<p><strong>Important note:</strong> For this feature to function, the AGV must be operational regardless of the battery overtemperature.</p>
<h2 id="how-to-use-29"><a class="header" href="#how-to-use-29">How to use</a></h2>
<h3 id="preconditions-8"><a class="header" href="#preconditions-8">Preconditions</a></h3>
<ul>
<li>Minimum software version requirements
<ul>
<li>Navitrol 6.38.00</li>
</ul>
</li>
<li>A source, such as BMS or supervisor interface, for reporting battery overtemperature and/or battery temperature.</li>
<li>AGV that can drive straight forward after unloading a resource without colliding into it.</li>
<li>A safety system that stops the AGV, if the it would collide during the emergency drive.</li>
</ul>
<h3 id="basics-2"><a class="header" href="#basics-2">Basics</a></h3>
<p>Use case example:</p>
<ol>
<li>AGV is driving with a load when a battery management system (BMS) reports battery overtemperature.</li>
<li>Navitrol stops the AGV</li>
<li>Navitrol commands emergency unload to be performed</li>
<li>Navitrol drives straight forward for a predefined distance
<ul>
<li>The drive distance and maximum speed can be configured with parameters</li>
</ul>
</li>
<li>Emergency persons can now access the battery department of the AGV</li>
</ol>
<h3 id="set-up-17"><a class="header" href="#set-up-17">Set up</a></h3>
<p>Add following parameters to desired values to the params.txt file<br />
F,battery_overtemperature_drive_dist,             1.0 # Defines the overtemperature emergency drive distance. 0 = disabled<br />
F,battery_overtemperature_drive_max_v,            0.4 # The maximum drive speed when driving forward from the resource after the unload</p>
<p>If one would use the temperature measurement from battery instead or in addition to overtemperature signal add following parameter<br />
I,battery_high_temperature_error_limit_C,  100 # If battery temperature (Celsius) increases over the limit an error set. 0 = disabled, 127 = max</p>
<h2 id="troubleshooting-51"><a class="header" href="#troubleshooting-51">Troubleshooting</a></h2>
<h3 id="i-defined-the-parameters-but-now-navitrol-does-not-start"><a class="header" href="#i-defined-the-parameters-but-now-navitrol-does-not-start">I defined the parameters but now Navitrol does not start</a></h3>
<ol>
<li>Check that minimum software version defined in the &quot;Preconditions&quot;-section is fulfilled.</li>
</ol>
<h3 id="i-have-any-other-issue-or-the-troubleshooting-tips-did-not-work-for-me-1"><a class="header" href="#i-have-any-other-issue-or-the-troubleshooting-tips-did-not-work-for-me-1">I have any other issue or the troubleshooting tips did not work for me</a></h3>
<ol>
<li>Take a log covering the problem situation.</li>
<li>Contact Navitec support and provide the log for further analyzation.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="charging-and-battery-management"><a class="header" href="#charging-and-battery-management">Charging and battery management</a></h1>
<p>Updated 26.01.2024</p>
<h2 id="overview-48"><a class="header" href="#overview-48">Overview</a></h2>
<p>This document explains charging logic and battery related information. Battery management systems (BMS) are also covered.</p>
<h3 id="introduction-59"><a class="header" href="#introduction-59">Introduction</a></h3>
<p>Navitrol can monitor, log, relay and visualize battery information and perform opportunity charging. Navitrol can communicate with Battery Management Systems via Supervisor interface or via model specific CAN interface. Navitrol can receive charging commands from Navithor or Supervisor interface.</p>
<p>If searching for the battery overtemperature actions see <a href="Miscellaneous/Charging/../../Miscellaneous/BatteryOvertemperatureActions/BatteryOvertemperatureActions.html">Battery Overtemperature Actions</a> document.</p>
<h3 id="requirements-31"><a class="header" href="#requirements-31">Requirements</a></h3>
<ul>
<li>Battery</li>
<li>Interface to send Navitrol the battery data</li>
</ul>
<h3 id="dependencies-17"><a class="header" href="#dependencies-17">Dependencies</a></h3>
<ul>
<li>Charge type symbolic point, if charging is required.</li>
</ul>
<hr />
<h2 id="setup-25"><a class="header" href="#setup-25">Setup</a></h2>
<h3 id="quick-start-17"><a class="header" href="#quick-start-17">Quick start</a></h3>
<h4 id="set-charge-command-source"><a class="header" href="#set-charge-command-source">Set charge command source</a></h4>
<p>Set the <strong>charging_cmd_source</strong> to value where the charging command should come. This means that what source is used to give the start charge action. The options are:</p>
<ol>
<li>Fleet control (Navithor or VDA5050)</li>
<li>Oportunity Charging: Start charging whenever AGV is stopped at Charge type symbolic point</li>
<li>BMS will give the command.</li>
</ol>
<h4 id="set-interface-for-communicating-data-tofrom-navitrol"><a class="header" href="#set-interface-for-communicating-data-tofrom-navitrol">Set interface for communicating data to/from Navitrol</a></h4>
<p>Set the <strong>extbatt_if_type</strong> parameter to correct value depending what interface is used to send battery data to Navitrol. The options are:</p>
<ol>
<li>Motor controller. Set <strong>extbatt_if_type</strong> parameter to -1. More information could be found from each motor controller manual. Supported motor controllers to sent battery data:
<ul>
<li>Schwarzmueller</li>
<li>Roboteq</li>
<li>Curtis. See <a href="Miscellaneous/Charging/../../AgvInterfaces/MotorControllers/Curtis/CurtisMotorController-en.html">Curtis</a> document.</li>
<li>MiControl</li>
<li>Oriental</li>
<li>Ethercat Synapticon</li>
</ul>
</li>
<li>Supervisor interface. Can be used as a general communication protocol without committing to any BMS model. Set <strong>extbatt_if_type</strong> parameter to 5. With this setup, customer would need a PLC that communicates with the BMS or battery and sends the data to Navitrol via the supervisor interface. See <em>Battery section</em> 8 on the supervisor status message 3002 for more information: <a href="Miscellaneous/Charging/../../AgvInterfaces/GenericInterfaces/EthernetSupervisorInterface/EthernetSupervisorInterface-en.html">Supervisor Interface</a>.</li>
<li>BMS CAN interface for specific models. Ask Navitec about the CAN specification. The description of the <strong>extbatt_if_type</strong> parameter has list of what models Navitrol supports and what is the related value for this parameter. If Navitrol does not already have the interface for some model, that would require then custom development.</li>
<li>Custom CAN interface. Set <strong>extbatt_if_type</strong> to -1. Some custom interfaces will send Navitrol the battery percentage or voltage or both. Contact Navitec if not sure if this applies to your project. <!-- At least these customers seems to send battery data: Nielsen, Mabi, some WFT machines, kovasat, Torwegge, DSH --></li>
</ol>
<h4 id="navithor-tools-4"><a class="header" href="#navithor-tools-4">Navithor Tools</a></h4>
<p>Add Charge type symbolic point to the route.</p>
<p><img src="Miscellaneous/Charging/./media-en/ChargeSP.png" alt="" /></p>
<blockquote>
<p>Charge symbolic point type on Navithor Tools. </p>
</blockquote>
<h4 id="navithor"><a class="header" href="#navithor">Navithor</a></h4>
<p>If using Navithor see the <em>Managing Battery Levels</em> chapter in Navithor document. Navithor can for example, give drive orders to Charge if battery level goes too low or it can keep always some amount of AGV in a Charge point. </p>
<hr />
<p><strong>Required parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Recommended value</th><th>Description</th></tr></thead><tbody>
<tr><td>charging_cmd_source</td><td>Int</td><td>1</td><td>0 = disabled, 1 = fleet control (Navithor or VDA5050), 2 = opportunity charging (Start charging whenever AGV is inside Charge type symbolic point), 3 = external source (Supervisor or other BMS, see <strong>extbatt_if_type</strong> parameter), 4 = project specific (Customer specific CAN interface)</td></tr>
<tr><td>charging_prevents_driving</td><td>Int</td><td>1</td><td>When charging is active: 0 = driving allowed, 1 = driving preventented with soft stop</td></tr>
<tr><td>battery_level_known</td><td>Int</td><td>1</td><td>1 to read battery percentage from external device (motor controller or bms), 0 to calculate it from battery voltage based on <strong>battery_voltage</strong> and <strong>battery_percentage</strong> parameters</td></tr>
</tbody></table>
<h3 id="fine-tuning-13"><a class="header" href="#fine-tuning-13">Fine-tuning</a></h3>
<p><strong>Battery alert parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>battery_alert_from</td><td>Int</td><td>0</td><td>-1 no alert, 0 to alert from low voltage, 1 to alert from low battery percentage</td></tr>
<tr><td>battery_alert_percentage</td><td>Float</td><td>5.0</td><td>Percentage lower than this value will set alert</td></tr>
<tr><td>battery_alert_voltage</td><td>Float</td><td>29.5</td><td>Voltage lower than this value will set alert</td></tr>
<tr><td>battery_high_temperature_warning_limit_C</td><td>Int</td><td>0</td><td>If battery temperature (Celcius) increases over the limit a warning set. 0 = disabled, 127 = max</td></tr>
<tr><td>battery_high_temperature_error_limit_C</td><td>Int</td><td>0</td><td>If battery temperature (Celcius) increases over the limit an error set. 0 = disabled, 127 = max</td></tr>
</tbody></table>
<p><strong>General voltage parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>battery_voltage_gain</td><td>Float</td><td>0.01</td><td>Gain for updating the voltage. 1.0 = new voltage value is used without gain. Increase this parameter if voltage is updated too slow. Used like this: voltage = voltage + gain * (newVoltage - voltage)</td></tr>
<tr><td>battery_voltage_input_scale</td><td>Float</td><td>0.0</td><td>Scale battery voltage input by multiplying with this value, 0.0 = do not scale.</td></tr>
</tbody></table>
<p><strong>Calculating percentage from voltage</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>battery_empty_voltage</td><td>Float</td><td>24.0</td><td>Limit to set percentage to 0. Used also to calculate new percentage value. Used only if <strong>battery_level_known</strong>  is 0.</td></tr>
<tr><td>battery_voltage1</td><td>Float</td><td>25.4</td><td>Voltage limit used to calculate percentage between <strong>battery_empty_voltage</strong> and this value. Used only if <strong>battery_level_known</strong>  is 0.</td></tr>
<tr><td>battery_percentage1</td><td>Float</td><td>5.0</td><td>Percentage value used to calculate percentage from voltage below <strong>battery_voltage1</strong>. Used only if <strong>battery_level_known</strong>  is 0.</td></tr>
<tr><td>battery_voltage2</td><td>Float</td><td>26.85</td><td>Voltage limit used to calculate percentage between <strong>battery_voltage2</strong> and  <strong>battery_full_voltage</strong>. Used only if <strong>battery_level_known</strong>  is 0.</td></tr>
<tr><td>battery_percentage2</td><td>Float</td><td>60.0</td><td>Percentage value used to calculate percentage from voltage above <strong>battery_voltage2</strong>. Used only if <strong>battery_level_known</strong>  is 0.</td></tr>
<tr><td>battery_full_voltage</td><td>Float</td><td>29.1</td><td>Voltage limit to consider battery percentage to be 100%. Used only if <strong>battery_level_known</strong>  is 0.</td></tr>
</tbody></table>
<p><strong>battery_log.txt related parameters</strong></p>
<p>See <em>Battery log</em> chapter and parameters on the <a href="Miscellaneous/Charging/../../Miscellaneous/Logging/Logging-en.html">Logging</a> document.</p>
<p><strong>External Battery Management System parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>extbatt_if_type</td><td>Int</td><td>-1</td><td>External battery interface type: -1 = disabled, 0 = MasterVolt, 1 = SL BMS, 2 = Jungheinrich, 3 = RoboteQ, 4 = Voltabox, 5 = Ethernet Supervisor (message ID 3002 section 8), 6 = MEB battery, 7 = JLN, 8 = Wiferion</td></tr>
<tr><td>can_extbatt_if_node_id</td><td>Int</td><td>0</td><td>Can node id for external battery interface</td></tr>
<tr><td>extbatt_if_max_interval_ms</td><td>Int</td><td>10000</td><td>Maximum update interval (ms)</td></tr>
<tr><td>can_extbatt_if_secondary_bus</td><td>Int</td><td>0</td><td>0 = Primary CAN Bus, 1 = Secondary CAN Bus</td></tr>
<tr><td>log_bms</td><td>Int</td><td>0</td><td>0 = no bms logging, 1 = Log external battery management system communication.</td></tr>
</tbody></table>
<p><strong>Opportunity charging parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>charging_opp_min_at_charger_timer_ms</td><td>Int</td><td>3000</td><td>Timer for opportunity charging which defines how long vehicle has to stay in charging station before charging is requested</td></tr>
</tbody></table>
<p><strong>Customer specific parameters</strong></p>
<p>These parameters are related only to customer specific interfaces. Ask Navitec if these are related to your project.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody>
<tr><td>charge_request_interval_ms</td><td>Int</td><td>1000</td><td>Charger request interval in msecs</td></tr>
<tr><td>battery_update_interval_ms</td><td>Int</td><td>1000</td><td>Battery value update interval in msecs</td></tr>
<tr><td>charging_collector_arm_extend_option</td><td>Int</td><td>0</td><td>Onboard charger collector arm extend options. 0 = extend one side only, 1 = extend two sides separately</td></tr>
</tbody></table>
<hr />
<h2 id="how-to-use-30"><a class="header" href="#how-to-use-30">How to use</a></h2>
<h3 id="sending-only-battery-data-to-navitrol-without-charging"><a class="header" href="#sending-only-battery-data-to-navitrol-without-charging">Sending only battery data to Navitrol without charging</a></h3>
<p>Set these parameters:</p>
<ul>
<li><strong>charging_cmd_source</strong> to 0</li>
<li><strong>extbatt_if_type</strong> to value where the data is sent to Navitrol. Use -1 if value is read directly from motor controller.</li>
<li><strong>battery_level_known</strong> to 1</li>
</ul>
<p>Check the Monitor main screen bottom to see if the values are received correctly to Navitrol.</p>
<h3 id="reading-percentage-values-from-voltage-without-charging"><a class="header" href="#reading-percentage-values-from-voltage-without-charging">Reading percentage values from voltage without charging</a></h3>
<p>Set these parameters:</p>
<ul>
<li><strong>charging_cmd_source</strong> to 0</li>
<li><strong>extbatt_if_type</strong> to value where the data is sent to Navitrol. Use -1 if value is read directly from motor controller.</li>
<li><strong>battery_level_known</strong> to 0</li>
</ul>
<h3 id="example-charging-sequence-with-navithor-and-bms-connected-to-navitrol-via-supervisor-interface"><a class="header" href="#example-charging-sequence-with-navithor-and-bms-connected-to-navitrol-via-supervisor-interface">Example charging sequence with Navithor and BMS connected to Navitrol via supervisor interface.</a></h3>
<p>Set these parameters:</p>
<ul>
<li><strong>charging_cmd_source</strong> to 1</li>
<li><strong>extbatt_if_type</strong> to 5</li>
<li><strong>charging_prevents_driving</strong> to 1</li>
<li><strong>battery_level_known</strong> to 1</li>
</ul>
<p><img src="Miscellaneous/Charging/./media-en/ChargeDiagram.png" alt="" /></p>
<blockquote>
<ol>
<li>BMS send battery percentage to PLC.</li>
<li>PLC send the percentage to Navitrol via supervisor interface.</li>
<li>Battery percentage is sent to Navithor.</li>
<li>Navithor will give drive order for the AGV to Charge symbolic point when battery percentage is too low. </li>
<li>AGV will drive to the Charge symbolic point and Navitrol reports that AGV is at Charge symbolic point.</li>
<li>Navithor request charging.</li>
<li>Navitrol -&gt; PLC: Charging required set to 1.</li>
<li>PLC -&gt; BMS: Charge start command sent.</li>
<li>BMS -&gt; PLC: Charge started.</li>
<li>PLC -&gt; Navitrol: Charging 1 (the AGV is charging). At this point, WARNING_CHARGING_ACTIVE is set.</li>
<li>Navitrol -&gt; PLC: Charging required 1, charging 1 (it still needs to charge and is charging).</li>
<li>Navithor stops charge and want AGV to run production or battery status is full enough. </li>
<li>Navitrol -&gt; PLC: Charging required 0 while charging still 1.</li>
<li>PLC -&gt; BMS: Stop charging.</li>
<li>BMS -&gt; PLC: Charging stopped.</li>
<li>PLC -&gt; Navitrol: Charging 0. At this point, WARNING_CHARGING_ACTIVE is reset.</li>
<li>Navitrol -&gt; PLC: Charging 0.</li>
<li>Navitrol -&gt; Navithor: Charging stopped, Navithor can give drive order to the AGV.</li>
</ol>
</blockquote>
<h3 id="opportunity-charging"><a class="header" href="#opportunity-charging">Opportunity charging</a></h3>
<p>AGV start charging whenever is at Charge type symbolic point. Can be enabled with <strong>charging_cmd_source</strong> as 2. AGV will start charging whenever it is </p>
<ul>
<li>in Standby state </li>
<li>closer than <strong>symbol_point_enter_dist</strong> parameter from the Charge type symbolic point. </li>
<li>Has been in Standby for <strong>charging_opp_min_at_charger_timer_ms</strong> time.</li>
</ul>
<p>Charging is active only if AGV has stayed at the Charge symbolic point and has been in Standby for this time period. If the state changes to Auto or Manual while AGV is charging, the charge is stopped and the charge is started again when the start conditions are met.</p>
<h3 id="monitor"><a class="header" href="#monitor">Monitor</a></h3>
<h4 id="battery-manager-overview"><a class="header" href="#battery-manager-overview">Battery Manager Overview</a></h4>
<p>Battery Manager Overview is a form in Monitor that shows Battery and Charging related data that Navitrol receives from the BMS. It is a useful tool for checking what is the status of battery or charging. By default, all the data is 0, but it should be updated once Navitrol receives the data from BMS.</p>
<p><img src="Miscellaneous/Charging/./media-en/BatteryManagerOverview.png" alt="" /></p>
<blockquote>
<p>Battery manager overview form. </p>
</blockquote>
<p>Battery Manager Overview shows the following data:</p>
<ul>
<li>Battery percentage</li>
<li>Battery voltage</li>
<li>Battery status in numerical and in text form</li>
<li>Battery errors in numerical and in text form</li>
<li>State of health in percentages</li>
<li>Current draw in Ampers</li>
<li>Charger voltage</li>
<li>Time left before battery is full in minutes</li>
<li>Voltage of the minimum cell</li>
<li>Battery temperature in Celsius degrees</li>
<li>Load cycles. How many times battery has loaded</li>
<li>Operating hours. How many hours the battery has run</li>
<li>Remaining capacity. How much Amper Hours the battery has.</li>
</ul>
<h4 id="battery-percentage-and-voltage"><a class="header" href="#battery-percentage-and-voltage">Battery percentage and voltage</a></h4>
<p><img src="Miscellaneous/Charging/./media-en/MonitorBattery.png" alt="" /></p>
<blockquote>
<p>Battery percentage and voltage can be seen on the bottom of the Monitor main screen. </p>
</blockquote>
<hr />
<h2 id="troubleshooting-52"><a class="header" href="#troubleshooting-52">Troubleshooting</a></h2>
<h3 id="most-common-issues-10"><a class="header" href="#most-common-issues-10">Most common issues</a></h3>
<h4 id="warning_agv_low_battery-is-active-even-though-percentage-is-high-enough"><a class="header" href="#warning_agv_low_battery-is-active-even-though-percentage-is-high-enough">WARNING_AGV_LOW_BATTERY is active even though percentage is high enough</a></h4>
<ul>
<li>Check the percentage and voltage that they are shown correctly on bottom of the Monitor main screen. See chapter <em>Monitor</em>.</li>
<li>Check parameter <strong>battery_alert_from</strong> to see if the warning is set based on percentage or voltage.</li>
<li>Check parameter <strong>battery_level_known</strong> to see if Navitrol calculates the percentage or if it is received from external source.</li>
</ul>
<hr />
<h3 id="errors-and-warnings-19"><a class="header" href="#errors-and-warnings-19">Errors and warnings</a></h3>
<h4 id="639---warning_charging_active"><a class="header" href="#639---warning_charging_active">639 - WARNING_CHARGING_ACTIVE</a></h4>
<p>Description: Vehicle is stopped due to charging</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Vehicle is stopped with softstop because of charging. Set only if <strong>charging_prevents_driving</strong> is set to 1 and charging is active. </p>
<p>How to recover: Reset automatically when charging is finished. If stopping is undesired, check sensor status for charging.</p>
<h4 id="520---error_battery_high_temperature"><a class="header" href="#520---error_battery_high_temperature">520 - ERROR_BATTERY_HIGH_TEMPERATURE</a></h4>
<p>Description: Battery temperature has exceeded the error limit</p>
<p>Error level: Error</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Battery temperature reported by battery management system (BMS) has exceeded the limit defined with a parameter <strong>battery_high_temperature_error_limit_C</strong></p>
<p>How to recover: Let the battery cool down or modify the limit</p>
<h4 id="601---warning_agv_low_battery"><a class="header" href="#601---warning_agv_low_battery">601 - WARNING_AGV_LOW_BATTERY</a></h4>
<p>Description: AGV battery level low</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Battery level is too low. </p>
<ul>
<li>If <strong>battery_alert_from</strong> is 0, battery voltage is lower than <strong>battery_alert_voltage</strong>. </li>
<li>If <strong>battery_alert_from</strong> is 1, battery percentage is lower than <strong>battery_alert_percentage</strong>.</li>
</ul>
<p>How to recover: Charge the battery</p>
<h4 id="611---warning_agv_no_battery_level"><a class="header" href="#611---warning_agv_no_battery_level">611 - WARNING_AGV_NO_BATTERY_LEVEL</a></h4>
<p>Description: AGV battery level unknown</p>
<p>Error level: Warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Navitrol cannot read battery level. Two reasons: </p>
<ol>
<li>External bms initialization failed
<ul>
<li>CAN interface error. Check that node IDs are correct if using CAN interface. Check that <strong>extbatt_if_type</strong> is on correct value.</li>
<li>Check if there is this kind of log line: &quot;ExtBattCanInit CanRegisterMsgDefs for node id&quot;. It will show what node ID has been failed to register.</li>
</ul>
</li>
<li>Timeout.
<ul>
<li>Data not received within <strong>extbatt_if_max_interval_ms</strong> time.</li>
</ul>
</li>
</ol>
<p>How to recover: Reset when data received within time or when initialization is successful. If it does not reset take a log and contact Navitec</p>
<h4 id="635---warning_battery_full_charge_needed"><a class="header" href="#635---warning_battery_full_charge_needed">635 - WARNING_BATTERY_FULL_CHARGE_NEEDED</a></h4>
<p>Description: Battery needs a full (reference) charge</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with external battery interface</p>
<p>Error reason: Too many load cycles without full charge. Related to Voltabox BMS only, see <strong>extbatt_if_type</strong>. Reference charge might be necessary, if battery has not been fully charged for a long time (30 load cycles). </p>
<p>How to recover: Battery charge to full capacity. Warning is reset when the status is cleared from Voltabox side. Check Voltabox specification for more information. </p>
<h4 id="636---warning_battery_error_or_warning_active"><a class="header" href="#636---warning_battery_error_or_warning_active">636 - WARNING_BATTERY_ERROR_OR_WARNING_ACTIVE</a></h4>
<p>Description: Battery management has active error or warning</p>
<p>Error level: Warning</p>
<p>Machine types: Vehicles with external battery interface</p>
<p>Error reason: Used battery management system has an error</p>
<p>How to recover: Resolve error in battery management system</p>
<h4 id="646---warning_battery_high_temperature"><a class="header" href="#646---warning_battery_high_temperature">646 - WARNING_BATTERY_HIGH_TEMPERATURE</a></h4>
<p>Description: Battery temperature has exceeded the warning limit. </p>
<p>Error level: warning</p>
<p>Machine types: Navitrol with driving</p>
<p>Error reason: Battery temperature reported by battery management system (BMS) has exceeded the limit defined with a parameter battery_high_temperature_warning_limit_C</p>
<p>How to recover: Let the battery cool down or modify the limit</p>
<h4 id="921---warning_ext_battery"><a class="header" href="#921---warning_ext_battery">921 - WARNING_EXT_BATTERY</a></h4>
<p>Description: BatteryFaults bit received from customer CAN interface. Contact Navitec for more information. </p>
<p>Error level: Warning</p>
<p>Machine types: All vehicles </p>
<p>Error reason: Communication failure with external battery management system</p>
<p>How to recover: Reset when BatteryFaults bit is not received anymore.</p>
<h3 id="advanced-troubleshooting-15"><a class="header" href="#advanced-troubleshooting-15">Advanced troubleshooting</a></h3>
<p>Here are some useful log lines related to battery and BMS:</p>
<p>&quot;ExtBattData read, V 24.1 SoC 10.000 extraData 0&quot;</p>
<ul>
<li>External battery voltage and percentage. extraData tells if extra info is received.</li>
</ul>
<p>&quot;ExtBattData&quot;</p>
<ul>
<li>All external battery logging.</li>
</ul>
<p>&quot;Updated battery&quot;</p>
<ul>
<li>Current battery voltage and percentage in the system. Input values that Navitrol receives are in parenthesis. Useful logging if Navitrol should calculate the battery percentage from voltage (<strong>battery_level_known</strong> parameter 0).</li>
</ul>
<p>&quot;veh_inte_ethernet: Parse battery section&quot;</p>
<ul>
<li>Data that Navitrol receives from supervisor battery section. Logged only if <strong>log_veh_inte_eth</strong> is greater than 0.</li>
</ul>
<p>&quot;veh_inte_ethernet: Battery, pct: 50.0 current 24.0&quot;</p>
<ul>
<li>Percentage and current in Amperes that Navitrol sends to supervisor via battery secion. </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hardware-requirements-1"><a class="header" href="#hardware-requirements-1">Hardware requirements</a></h1>
<p>Updated 13.03.2024</p>
<hr />
<h2 id="overview-49"><a class="header" href="#overview-49">Overview</a></h2>
<p>Navitrol IPC hardware requirements can be divided into two categories:</p>
<ul>
<li>Generic requirements imposed by working environment and electrical and mechanical constraints.</li>
<li>Requirements imposed by Navitrol software - this means mainly resources needed by Navitrol (CPU, RAM, mass storage, connections) for robust operation and good performance.</li>
</ul>
<h2 id="generic-hardware-requirements"><a class="header" href="#generic-hardware-requirements">Generic hardware requirements</a></h2>
<p>Suitability for mobile use is the key for reliable operation. As working environments and target machines have huge variation, generic hardware requirements discussed in this section are rather things to take into consideration than detailed requirements.</p>
<h3 id="working-environment"><a class="header" href="#working-environment">Working environment</a></h3>
<p>Working environments can be very different in different cases. Some things to consider and check when estimating suitability of the IPC are:</p>
<ul>
<li>Working environment ambient temperatures.</li>
<li>Working environment ambient humidity levels.</li>
<li>Working environment dust levels and possible water or other liquid sprays.</li>
<li>Vibrations and shocks while driving.</li>
</ul>
<p>If the IPC is supposed to withstand excessive dust levels or liquid sprays, then the enclosure of the IPC should be IP rated correspondingly. Another option is to mount IPC inside a protective enclosure, which may affect the cooling (see below).</p>
<p>Vibrations and shocks of some magnitude are unavoidable in mobile robots. Therefore, one generic requirement is that IPC should not have moving parts, like HDD's or fans. Additionally, all connectors used should have some form of locking mechanism.</p>
<h3 id="cooling"><a class="header" href="#cooling">Cooling</a></h3>
<p>The IPC selected should have passive cooling like heat sinks and cooling through natural convection instead of fans. This approach mitigates potential issues caused by dust, vibrations, and maintenance complexities, ensuring consistent and efficient performance. Failure to cool down the CPU to acceptable temperature levels can in worst case result in CPU to shut down.</p>
<p>Mounting place of the IPC has significant impact on cooling. IPC should not be mounted next to excessive heat generating objects. Special attention should be paid also to cases where IPC is mounted inside a separate protective enclosure. In such a case the ventilation and cooling of this enclosure must be effective enough for the IPC cooling to work as expected.</p>
<h3 id="mounting---electricalmechanical-aspects"><a class="header" href="#mounting---electricalmechanical-aspects">Mounting - electrical/mechanical aspects</a></h3>
<p>IPC form factor, mounting options and especially mounting place are something that require attention. Poorly selected mounting place introduces risks for </p>
<ul>
<li>Inadequate cooling.</li>
<li>Extra vibrations that can result in premature malfunction of the IPC. IPC should always be mounted on a rigid body part of the machine. It is also important to assure enough free space for all connectors and cables.</li>
<li>Physical damage to IPC or connectors caused by collisions or people using IPC as a step when working on the machine.</li>
<li>Problems for maintenance if IPC itself and connectors are not easily accessible.</li>
</ul>
<p>Input voltage range of the IPC, and it's compatibility with the machine's power system is one thing to check. For flexibility the IPC should have broad input voltage range, like 9 - 36V or 18 - 36V. If the IPC requires a regulated voltage source, that may require additional hardware to be installed.</p>
<h2 id="hardware-requirements-imposed-by-navitrol"><a class="header" href="#hardware-requirements-imposed-by-navitrol">Hardware requirements imposed by Navitrol</a></h2>
<h3 id="additional-notes-about-requirements-imposed-by-navitrol"><a class="header" href="#additional-notes-about-requirements-imposed-by-navitrol">Additional notes about requirements imposed by Navitrol</a></h3>
<h4 id="application"><a class="header" href="#application">Application</a></h4>
<p>Navitrol IPC hardware requirements for CPU, RAM and mass storage capacity depend very much on the overall system in use as well as environmental factors.</p>
<p>When it comes to CPU, RAM and mass storage capacity, significant factors are for example the following:</p>
<ul>
<li>Is Navitrol used for position only or controlling AGV.</li>
<li>What sensors are used. Especially the model and number of laser scanners used for positioning is significant factor.</li>
<li>Which Navitrol features are used. CPU intensive features matter the most. Features listed below are considered CPU intensive:
<ul>
<li>Dynamic mapping</li>
<li>3D load detection</li>
<li>Obstacle avoidance V2</li>
</ul>
</li>
<li>Linux installation details, especially whether graphical User Interface is installed and running (affects amount of RAM required).</li>
</ul>
<h4 id="cpu"><a class="header" href="#cpu">CPU</a></h4>
<p>Because the GHz value of a CPU doesn't describe the performance very well, CPU requirements are defined using specific Intel processor models as an example. These processors are the ones that have been used in Navitec standard IPC offering. When evaluating an IPC with some other CPU, and comparing those to ones used as examples, one can refer Passmark software CPU benchmarking on the web at https://www.cpubenchmark.net/. The key figure is then the Single thread rating that should match or exceed the ratings of the example CPU’s. See table below:</p>
<table><thead><tr><th>CPU</th><th>Speed</th><th>Single thread rating</th><th>CPU Mark</th></tr></thead><tbody>
<tr><td>Intel Celeron 2980U</td><td>1.6 GHz</td><td>929</td><td>1056</td></tr>
<tr><td>Intel i3-6100U</td><td>2.3 GHz</td><td>1334</td><td>2639</td></tr>
<tr><td>Intel i5-6300U</td><td>2.4 GHz</td><td>1669</td><td>3240</td></tr>
<tr><td>Intel i3-1115G4E</td><td>2.2 GHz</td><td>2634</td><td>5912</td></tr>
</tbody></table>
<p>Recommended single thread rating is higher than 1800 units and minimum clock speed is 2.2 GHz.</p>
<h4 id="mass-storage"><a class="header" href="#mass-storage">Mass storage</a></h4>
<p>Solid State Drive (SSD) should always be used as a mass storage device for faster data access and more robust operation in mobile robots.</p>
<h4 id="scanners-3"><a class="header" href="#scanners-3">Scanners</a></h4>
<p>Regarding scanners, requirements below use the following classification:</p>
<ul>
<li>Low/medium resolution scanners – scanners with angular resolution of 0.2 degrees or more.</li>
<li>High resolution scanners – scanners with angular resolution smaller than 0.2 degrees.</li>
</ul>
<h3 id="hardware-requirements---navitrol-positioning-only"><a class="header" href="#hardware-requirements---navitrol-positioning-only">Hardware Requirements - Navitrol positioning only</a></h3>
<p>Minimum</p>
<ul>
<li>Conditions  - low/medium resolution scanners, max. Production area 200mx200m</li>
<li>CPU: 2 core Intel Celeron 2980U, 1.6 GHz</li>
<li>RAM: 4 GB</li>
<li>SSD: 16 GB, industrial grade</li>
</ul>
<p>Recommended</p>
<ul>
<li>Conditions - high resolution scanners</li>
<li>CPU: 2 core Intel i3-6100U, 2.3 GHz</li>
<li>RAM: 4 GB</li>
<li>SSD: 16 GB, industrial grade</li>
</ul>
<h3 id="hardware-requirements---navitrol-controlling-agv"><a class="header" href="#hardware-requirements---navitrol-controlling-agv">Hardware Requirements - Navitrol controlling AGV</a></h3>
<p>Minimum</p>
<ul>
<li>Conditions - low/medium resolution scanners, no CPU intensive features used, max. Production area 100mx50m</li>
<li>CPU: 2 core Intel i3-6100, 2.3 GHz</li>
<li>RAM: 4 GB</li>
<li>SSD: 32 GB, industrial grade</li>
</ul>
<p>Recommended</p>
<ul>
<li>Conditions - high resolution scanners, any CPU intensive features used</li>
<li>CPU: 2 core Intel i3-1115G4E, 2.2 GHz</li>
<li>RAM: 16 GB</li>
<li>SSD: 128 GB, industrial grade</li>
</ul>
<h3 id="connectivity"><a class="header" href="#connectivity">Connectivity</a></h3>
<p>Basic connections needed in the IPC are</p>
<ul>
<li>Gigabit Ethernet port(s) - preferably two or more.</li>
<li>Wi-Fi for remote connectivity.</li>
<li>SocketCAN compatible CAN interface if Navitrol should communicate via CAN to other devices. CAN interface is typically a separate add-on card mounted into IPC (see Expansion slots below).</li>
<li>Serial ports (RS232/RS422) on need basis – serial communication has been used with some motor controllers, IMU units and scanners. RS232 serial communication is very prone to disturbances and can’t be recommended for any device communication.</li>
<li>Expansion slots (1 or 2 PCIe slots) inside the IPC may be needed for potential hardware upgrades or additional functionalities. Most commonly used expansion card is CAN communication interface.</li>
</ul>
<h2 id="running-other-sw-in-same-ipc-with-navitrol"><a class="header" href="#running-other-sw-in-same-ipc-with-navitrol">Running other SW in same IPC with Navitrol</a></h2>
<p>It is recommended NOT to run additional customer SW in Navitrol IPC, as that can have negative impact on performance of positioning and control of the AGV.</p>
<p>In some cases, however, it may be necessary and justified to do so. If such additional SW is very &quot;light-weight&quot; when it comes to using resources, like CPU/RAM/Communication/Disk I/O, then it might be safe to run it without extra precaution. Responsibility on such a decision is obviously on end-user side.</p>
<p>General guidelines for running any additional SW in the Navitrol IPC along with Navitrol are:</p>
<p>CPU</p>
<ul>
<li>CPU should have minimum 2 cores dedicated for Navitrol use only - basically this means CPU with 4 cores or more.
<ul>
<li>If several CPU intensive features are used, then 2 cores is not enough for Navitrol.</li>
</ul>
</li>
<li>Single thread rating shall still match the basic requirements.</li>
<li>Additional SW shall be run in dedicated and pre-specified core. That core shall not be used by Navitrol (this can be excluded using Navitrol parameter <strong>cpu_core_exclusion_mask</strong>, see below).</li>
</ul>
<p>RAM</p>
<ul>
<li>RAM requirements by additional SW shall be added to basic requirements.</li>
</ul>
<p>SSD / Disk I/O</p>
<ul>
<li>Additional SW shall avoid or minimize reading/writing disk at run time.</li>
<li>SSD size requirements are affected only if additional SW uses extensive amount of disk space (several GB).</li>
</ul>
<p>Communication by additional SW</p>
<ul>
<li>WLAN/WiFi data throughput shall be minimal or not existing at all.</li>
<li>Wired Ethernet data throughput shall not be extensive.</li>
<li>Transmitting messages over CAN bus is not allowed without consulting Navitec. Poor CAN data object design may result in dramatic performance loss or even malfunction. NOTE: This applies also to CAN devices that are not used for positioning or control purposes.</li>
<li>Use of any other additional communication shall be consulted with Navitec.</li>
</ul>
<p>If these guidelines are not followed, normal Navitrol operation and performance is compromized. In worst case, some of the following issues can happen:</p>
<ul>
<li>Delayed processing or event handling in Navitrol can generate an ERROR, which results in stopping the AGV.</li>
<li>Communication slowed down or even communication breaks, causing sluggish operation of User Interfaces.</li>
<li>Filesystem corruption when power is switched off.</li>
<li>Navitrol running out of memory, which can result in Navitrol shutdown and restart.</li>
</ul>
<h3 id="how-to-control-cpu-cores-used-by-navitrol"><a class="header" href="#how-to-control-cpu-cores-used-by-navitrol">How to control CPU cores used by Navitrol</a></h3>
<p>Parameter <strong>cpu_core_exclusion_mask</strong> can be used to control which CPU cores Navitrol is using. This parameter, as the name implies, is an exclusion mask - any bit set means that corresponding CPU core shall not be used by Navitrol. For example, binary exclusion mask value 11b (decimal value 3), means that Navitrol will not use CPU cores 0 and 1.</p>
<p><strong>U,cpu_core_exclusion_mask, 3</strong></p>
<p>By default Navitrol allocates all available cores in use. Consult Navitec in case of any doubts how to set this in appropriate way.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
                
    </body>
</html>
